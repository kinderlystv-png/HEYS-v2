---
applyTo: '**/*.{ts,tsx}'
description: Правила для @heys/shared — типы, утилиты, мониторинг, безопасность
---

# @heys/shared — правила разработки

## Модуль

- **TypeScript strict mode**, ESM (`import`/`export`)
- Путь: `@heys/shared` (алиас в tsconfig)
- Версия: 14.x — обратная совместимость при изменении публичного API

## Структура модулей

| Модуль         | Назначение                           | Ключевые экспорты                                        |
| -------------- | ------------------------------------ | -------------------------------------------------------- |
| `database/`    | DB service layer                     | `DatabaseService`                                        |
| `logging/`     | Унифицированный логгер               | `createConsoleAdapter`, `createPinoAdapter`              |
| `monitoring/`  | Мониторинг производительности        | `measure`, `PerformanceMonitor`, `RealtimeMonitor`       |
| `performance/` | Оптимизация (lazy, splitting, cache) | `PerformanceProfiler`, `SmartCacheManager`, `LazyLoader` |
| `security/`    | Заголовки, валидация                 | `headers`, `validation`                                  |
| `types/`       | Общие типы (Day, Product, Client)    | TypeScript типы                                          |
| `day/`         | Утилиты для работы с днями           | Day-специфичная логика                                   |

## Правила кода

- **Строгая типизация**: `noUnusedLocals`, `exactOptionalPropertyTypes`,
  `noUncheckedIndexedAccess`
- **Чистые функции**: без side-effects в утилитах
- **Тесты обязательны**: vitest, покрытие >= 80%
- `import` только из `src/` — не из `node_modules` напрямую в типах

## Зависимости

- `zod` — валидация рантайм данных
- `dompurify` — санитизация HTML
- `@heys/logger` — логирование

## При добавлении нового модуля

1. Создать директорию в `src/`
2. Добавить `index.ts` с реэкспортами
3. Добавить экспорт в `src/index.ts`
4. Написать тесты в `__tests__/`
5. Обновить `package.json` exports map если нужно
