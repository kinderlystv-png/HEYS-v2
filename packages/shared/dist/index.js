import { z as z$1 } from 'zod';
import _ from 'dompurify';

var h=class{metrics=[];errors=[];config;batchTimer;constructor(e){this.config=e,e.enabled&&e.flushInterval&&this.startBatchReporting();}recordMetric(e,t,r="ms",i){if(!this.config.enabled)return;let s={name:e,value:t,unit:r,timestamp:Date.now(),...i&&{tags:i}};this.metrics.push(s),this.config.batchSize&&this.metrics.length>=this.config.batchSize&&this.flush();}recordError(e,t="medium",r){if(!this.config.enabled)return;let i={id:this.generateId(),message:typeof e=="string"?e:e.message,timestamp:Date.now(),severity:t,sessionId:this.getSessionId(),...typeof e=="object"&&e.stack&&{stack:e.stack},...r&&{context:r}};this.errors.push(i),(t==="critical"||this.config.batchSize&&this.errors.length>=this.config.batchSize)&&this.flush();}async measureAsync(e,t,r){let i=performance.now();try{let s=await t(),o=performance.now()-i;return this.recordMetric(e,o,"ms",r),s}catch(s){let o=performance.now()-i;throw this.recordMetric(`${e}_error`,o,"ms",r),this.recordError(s,"high",{operation:e,...r}),s}}measure(e,t,r){let i=performance.now();try{let s=t(),o=performance.now()-i;return this.recordMetric(e,o,"ms",r),s}catch(s){let o=performance.now()-i;throw this.recordMetric(`${e}_error`,o,"ms",r),this.recordError(s,"high",{operation:e,...r}),s}}getMetrics(){return [...this.metrics]}getErrors(){return [...this.errors]}async flush(){if(!this.config.endpoint||!this.metrics.length&&!this.errors.length)return;let e={metrics:this.metrics,errors:this.errors,timestamp:Date.now()};try{await fetch(this.config.endpoint,{method:"POST",headers:{"Content-Type":"application/json",...this.config.apiKey&&{Authorization:`Bearer ${this.config.apiKey}`}},body:JSON.stringify(e)}),this.metrics=[],this.errors=[];}catch(t){console.warn("Failed to send monitoring data:",t);}}startBatchReporting(){this.batchTimer&&clearInterval(this.batchTimer),this.batchTimer=setInterval(()=>{this.flush();},this.config.flushInterval);}stop(){this.batchTimer&&(clearInterval(this.batchTimer),this.batchTimer=void 0),this.flush();}generateId(){return `${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getSessionId(){if(typeof window<"u"&&window.sessionStorage){let e=window.sessionStorage.getItem("monitoring_session_id");return e||(e=this.generateId(),window.sessionStorage.setItem("monitoring_session_id",e)),e}return "server-session"}},u=new h({enabled:process.env.NODE_ENV==="production",batchSize:100,flushInterval:3e4,enableRealtime:false}),S=(n,e,t,r)=>u.recordMetric(n,e,t,r),x=(n,e,t)=>u.recordError(n,e,t),R=(n,e,t)=>u.measureAsync(n,e,t),A=(n,e,t)=>u.measure(n,e,t);var y=class{constructor(e){this.websocketUrl=e;e&&this.connect();}ws;alerts=[];alertRules=[];liveMetrics=new Map;subscribers=new Map;connect(){if(!(typeof globalThis<"u"&&globalThis.process?.env?.NODE_ENV==="test")&&!(!this.websocketUrl||this.ws&&this.ws.readyState===1))try{if(typeof WebSocket>"u"){console.warn("WebSocket not available in this environment");return}this.ws=new WebSocket(this.websocketUrl),this.ws.onopen=()=>{console.log("Real-time monitoring connected"),this.emit("connection",{status:"connected"});},this.ws.onmessage=e=>{try{let t=JSON.parse(e.data);this.handleMessage(t);}catch(t){console.error("Failed to parse WebSocket message:",t);}},this.ws.onclose=()=>{console.log("Real-time monitoring disconnected"),this.emit("connection",{status:"disconnected"}),setTimeout(()=>this.connect(),5e3);},this.ws.onerror=e=>{console.error("WebSocket error:",e),this.emit("error",{error:e});};}catch(e){console.error("Failed to connect to WebSocket:",e);}}disconnect(){this.ws&&(this.ws.close(),this.ws=void 0);}subscribe(e,t){return this.subscribers.has(e)||this.subscribers.set(e,new Set),this.subscribers.get(e).add(t),()=>{this.subscribers.get(e)?.delete(t);}}addAlertRule(e){let t={id:this.generateId(),...e};return this.alertRules.push(t),this.emit("alert_rule_added",t),t.id}removeAlertRule(e){let t=this.alertRules.findIndex(r=>r.id===e);if(t>=0){let r=this.alertRules.splice(t,1)[0];return this.emit("alert_rule_removed",r),true}return  false}updateMetric(e,t,r="ms"){let i=this.liveMetrics.get(e),s={name:e,current:t,previous:i?.current??t,trend:this.calculateTrend(t,i?.current),unit:r,timestamp:Date.now()};this.liveMetrics.set(e,s),this.emit("metric_updated",s),this.checkAlerts(e,t);}getLiveMetrics(){return Array.from(this.liveMetrics.values())}getActiveAlerts(){return this.alerts.filter(e=>!e.acknowledged&&!e.resolvedAt)}acknowledgeAlert(e){let t=this.alerts.find(r=>r.id===e);return t&&!t.acknowledged?(t.acknowledged=true,this.emit("alert_acknowledged",t),true):false}resolveAlert(e){let t=this.alerts.find(r=>r.id===e);return t&&!t.resolvedAt?(t.resolvedAt=Date.now(),this.emit("alert_resolved",t),true):false}send(e){this.ws?.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(e));}handleMessage(e){switch(e.type){case "metric":this.updateMetric(e.name,e.value,e.unit);break;case "alert":this.handleIncomingAlert(e);break;case "system_status":this.emit("system_status",e);break;default:this.emit("message",e);}}handleIncomingAlert(e){let t={id:e.id||this.generateId(),ruleId:e.ruleId,message:e.message,severity:e.severity,timestamp:e.timestamp||Date.now(),acknowledged:false};this.alerts.push(t),this.emit("alert_triggered",t);}checkAlerts(e,t){let r=this.alertRules.filter(i=>i.enabled&&i.metric===e);for(let i of r)this.evaluateRule(i,t)&&this.triggerAlert(i,t);}evaluateRule(e,t){switch(e.operator){case "gt":return t>e.threshold;case "gte":return t>=e.threshold;case "lt":return t<e.threshold;case "lte":return t<=e.threshold;case "eq":return t===e.threshold;default:return  false}}triggerAlert(e,t){if(this.alerts.find(s=>s.ruleId===e.id&&Date.now()-s.timestamp<(e.duration||60)*1e3&&!s.resolvedAt))return;let i={id:this.generateId(),ruleId:e.id,message:`${e.name}: ${e.metric} is ${t} (threshold: ${e.threshold})`,severity:t>e.threshold*2?"critical":"warning",timestamp:Date.now(),acknowledged:false};this.alerts.push(i),this.emit("alert_triggered",i);}calculateTrend(e,t){return !t||t===e?"stable":e>t?"up":"down"}emit(e,t){let r=this.subscribers.get(e);r&&r.forEach(i=>{try{i(t);}catch(s){console.error(`Error in subscriber for event ${e}:`,s);}});}generateId(){return `${Date.now()}-${Math.random().toString(36).substr(2,9)}`}},f=new y(process.env.MONITORING_WS_URL||(typeof window<"u"?"ws://localhost:8080/monitoring":void 0)),$=n=>f.addAlertRule(n),V=n=>f.removeAlertRule(n),z=(n,e,t)=>f.updateMetric(n,e,t),j=()=>f.getLiveMetrics(),L=()=>f.getActiveAlerts();var N=(n={})=>({enabled:process.env.NODE_ENV==="production",batchSize:100,flushInterval:3e4,enableRealtime:false,...n}),W=n=>{let e=N(n);if(typeof window<"u"&&(window.addEventListener("error",t=>{u.recordError(t.error||t.message,"high",{filename:t.filename,lineno:t.lineno,colno:t.colno});}),window.addEventListener("unhandledrejection",t=>{u.recordError(t.reason,"high",{type:"unhandled_promise_rejection"});})),typeof window<"u"&&"PerformanceObserver"in window)try{new PerformanceObserver(s=>{for(let o of s.getEntries())u.recordMetric("lcp",o.startTime,"ms",{type:"core_web_vital"});}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(s=>{for(let o of s.getEntries())u.recordMetric("fid",o.processingStart-o.startTime,"ms",{type:"core_web_vital"});}).observe({entryTypes:["first-input"]}),new PerformanceObserver(s=>{for(let o of s.getEntries())o.hadRecentInput||u.recordMetric("cls",o.value,"score",{type:"core_web_vital"});}).observe({entryTypes:["layout-shift"]});}catch(t){console.warn("Failed to setup Core Web Vitals monitoring:",t);}return {config:e,monitor:u,recordMetric:S,recordError:x,measureAsync:R,measure:A}};var Z={user:z$1.object({id:z$1.string().uuid(),email:z$1.string().email(),username:z$1.string().min(3).max(50).regex(/^[a-zA-Z0-9_-]+$/),password:z$1.string().min(8).max(128),role:z$1.enum(["admin","user","moderator","guest"]),isActive:z$1.boolean().default(true),createdAt:z$1.date().optional(),updatedAt:z$1.date().optional()}),content:z$1.object({id:z$1.string().uuid(),title:z$1.string().min(1).max(200),content:z$1.string().max(1e4),authorId:z$1.string().uuid(),tags:z$1.array(z$1.string()).max(10).optional(),isPublic:z$1.boolean().default(false),metadata:z$1.record(z$1.unknown()).optional()}),file:z$1.object({name:z$1.string().min(1).max(255),type:z$1.string().regex(/^[a-zA-Z0-9\/\-\.]+$/),size:z$1.number().min(1).max(10*1024*1024),content:z$1.string().or(z$1.instanceof(ArrayBuffer))}),apiRequest:z$1.object({method:z$1.enum(["GET","POST","PUT","DELETE","PATCH"]),path:z$1.string().regex(/^\/[a-zA-Z0-9\/_-]*$/),headers:z$1.record(z$1.string()).optional(),body:z$1.unknown().optional(),query:z$1.record(z$1.string()).optional()})},P=class{dompurify;config;constructor(){this.dompurify=_,this.config={ALLOWED_TAGS:["b","i","em","strong","a","p","br"],ALLOWED_ATTR:["href","title"],ALLOW_DATA_ATTR:false,ALLOW_UNKNOWN_PROTOCOLS:false,SANITIZE_DOM:true,KEEP_CONTENT:true};}sanitizeHTML(e){if(typeof e!="string")throw new Error("Input must be a string");return this.dompurify.sanitize(e,this.config)}sanitizeText(e){if(typeof e!="string")throw new Error("Input must be a string");return this.dompurify.sanitize(e,{ALLOWED_TAGS:[]})}sanitizeSQL(e){if(typeof e!="string")throw new Error("Input must be a string");let t=[/('|(\\'))/gi,/(;|--|\||\|\||&&)/gi,/(union|select|insert|update|delete|drop|create|alter|exec|execute)/gi,/(\*|%|_)/gi],r=e;return t.forEach(i=>{r=r.replace(i,"");}),r.trim()}sanitizeFileName(e){if(typeof e!="string")throw new Error("Input must be a string");return e.replace(/[^a-zA-Z0-9._-]/g,"").replace(/\.{2,}/g,".").substring(0,255)}},l={noXSS:{name:"XSS Protection",validator:n=>typeof n!="string"?true:![/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/javascript:/gi,/on\w+\s*=/gi,/<iframe/gi,/<object/gi,/<embed/gi].some(t=>t.test(n)),message:"Potential XSS attack detected",severity:"critical"},noSQLInjection:{name:"SQL Injection Protection",validator:n=>typeof n!="string"?true:![/('|(\\'))/gi,/(;|--|\||\|\||&&)/gi,/\b(union|select|insert|update|delete|drop|create|alter|exec|execute)\b/gi].some(t=>t.test(n)),message:"Potential SQL injection detected",severity:"critical"},validEmail:{name:"Email Validation",validator:n=>typeof n!="string"?false:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n),message:"Invalid email format",severity:"medium"},strongPassword:{name:"Strong Password",validator:n=>typeof n!="string"?false:n.length>=8&&/[A-Z]/.test(n)&&/[a-z]/.test(n)&&/[0-9]/.test(n)&&/[^A-Za-z0-9]/.test(n),message:"Password must be at least 8 characters with uppercase, lowercase, number, and special character",severity:"high"},noPathTraversal:{name:"Path Traversal Protection",validator:n=>typeof n!="string"?true:!/(\.\.\/|\.\.\\)/g.test(n),message:"Path traversal attempt detected",severity:"high"}},b=class{sanitizer;customRules;constructor(){this.sanitizer=new P,this.customRules=new Map;}addRule(e,t){this.customRules.set(e,t);}removeRule(e){this.customRules.delete(e);}async validateSchema(e,t,r={}){let i={isValid:true,errors:[],warnings:[]};try{let s=e;r.sanitize&&typeof e=="object"&&e!==null&&(s=this.sanitizeObject(e),i.sanitized=s);let o=t.safeParse(s);if(o.success||(o.error.errors.forEach(c=>{i.errors.push({field:c.path.join("."),rule:"schema",message:c.message,severity:"medium",value:c.code});}),i.isValid=!1),r.customRules){let c=this.applySecurityRules(s,r.customRules);i.errors.push(...c),c.length>0&&(i.isValid=!1);}if(r.strictMode){let c=Object.keys(l),g=this.applySecurityRules(s,c);i.errors.push(...g),g.length>0&&(i.isValid=!1);}}catch(s){i.isValid=false,i.errors.push({field:"root",rule:"validation",message:s instanceof Error?s.message:"Validation failed",severity:"critical"});}return i}validateInput(e,t,r={}){let i={isValid:true,errors:[],warnings:[]};if(r.required&&(e==null||e===""))return i.isValid=false,i.errors.push({field:"value",rule:"required",message:"Value is required",severity:"medium"}),i;if(e==null)return i;switch(t){case "email":l.validEmail&&!l.validEmail.validator(e)&&(i.isValid=false,i.errors.push({field:"value",rule:"validEmail",message:l.validEmail.message,severity:l.validEmail.severity}));break;case "password":l.strongPassword&&!l.strongPassword.validator(e)&&(i.isValid=false,i.errors.push({field:"value",rule:"strongPassword",message:l.strongPassword.message,severity:l.strongPassword.severity}));break;case "text":typeof e=="string"&&(r.sanitize&&(i.sanitized=this.sanitizer.sanitizeText(e)),l.noXSS&&!l.noXSS.validator(e)&&(i.isValid=false,i.errors.push({field:"value",rule:"noXSS",message:l.noXSS.message,severity:l.noXSS.severity})));break;case "html":typeof e=="string"&&r.sanitize&&(i.sanitized=this.sanitizer.sanitizeHTML(e));break;case "filename":typeof e=="string"&&(r.sanitize&&(i.sanitized=this.sanitizer.sanitizeFileName(e)),l.noPathTraversal&&!l.noPathTraversal.validator(e)&&(i.isValid=false,i.errors.push({field:"value",rule:"noPathTraversal",message:l.noPathTraversal.message,severity:l.noPathTraversal.severity})));break}return i}sanitizeObject(e){if(typeof e=="string")return this.sanitizer.sanitizeText(e);if(Array.isArray(e))return e.map(t=>this.sanitizeObject(t));if(e&&typeof e=="object"){let t={};for(let[r,i]of Object.entries(e))t[r]=this.sanitizeObject(i);return t}return e}applySecurityRules(e,t){let r=[];return t.forEach(i=>{let s=l[i]||this.customRules.get(i);s&&!s.validator(e)&&r.push({field:"data",rule:i,message:s.message,severity:s.severity,value:e});}),r}};function J(n=[]){return function(e,t,r){let i=r.value,s=new b;r.value=async function(...o){for(let c=0;c<o.length;c++){let g=await s.validateSchema(o[c],z$1.unknown(),{strictMode:true,customRules:n});if(!g.isValid)throw new E(`Security validation failed for argument ${c}`,g.errors)}return i.apply(this,o)};}}var E=class extends Error{errors;constructor(e,t=[]){super(e),this.name="SecurityError",this.errors=t;}},m=new b,K={email:n=>m.validateInput(n,"email",{required:true}),password:n=>m.validateInput(n,"password",{required:true}),text:(n,e=true)=>m.validateInput(n,"text",{sanitize:e}),html:(n,e=true)=>m.validateInput(n,"html",{sanitize:e}),filename:(n,e=true)=>m.validateInput(n,"filename",{sanitize:e})};var p=class n{directives={};constructor(e={}){this.directives={...e};}setDirective(e,t){return typeof t=="boolean"?this.directives[e]=t:this.directives[e]=[...t],this}addToDirective(e,t){(!this.directives[e]||typeof this.directives[e]=="boolean")&&(this.directives[e]=[]);let r=this.directives[e];return this.directives[e]=[...r,...t],this}build(){let e=[];return Object.entries(this.directives).forEach(([t,r])=>{typeof r=="boolean"&&r?e.push(t):Array.isArray(r)&&r.length>0&&e.push(`${t} ${r.join(" ")}`);}),e.join("; ")}static strict(){return new n({"default-src":["'none'"],"script-src":["'self'"],"style-src":["'self'","'unsafe-inline'"],"img-src":["'self'","data:","https:"],"font-src":["'self'"],"connect-src":["'self'"],"media-src":["'self'"],"object-src":["'none'"],"frame-src":["'none'"],"base-uri":["'self'"],"form-action":["'self'"],"frame-ancestors":["'none'"],"upgrade-insecure-requests":true,"block-all-mixed-content":true})}static development(){return new n({"default-src":["'self'"],"script-src":["'self'","'unsafe-eval'","'unsafe-inline'","localhost:*"],"style-src":["'self'","'unsafe-inline'","localhost:*"],"img-src":["'self'","data:","https:","localhost:*"],"font-src":["'self'","localhost:*"],"connect-src":["'self'","localhost:*","ws:","wss:"],"media-src":["'self'","localhost:*"],"object-src":["'none'"],"frame-src":["'self'","localhost:*"],"base-uri":["'self'"],"form-action":["'self'"]})}},T=class n{config;isDevelopment;constructor(e={},t=false){this.config=e,this.isDevelopment=t;}generateHeaders(){let e={};if(this.config.csp){let t=new p(this.config.csp);e["Content-Security-Policy"]=t.build();}else {let t=this.isDevelopment?p.development():p.strict();e["Content-Security-Policy"]=t.build();}if(this.config.hsts!==false&&!this.isDevelopment){let t=this.config.hsts||{},i=`max-age=${t.maxAge||31536e3}`;t.includeSubDomains!==false&&(i+="; includeSubDomains"),t.preload&&(i+="; preload"),e["Strict-Transport-Security"]=i;}if(e["X-Frame-Options"]=this.config.frameOptions||"DENY",this.config.contentTypeOptions!==false&&(e["X-Content-Type-Options"]="nosniff"),this.config.xssProtection!==false&&(e["X-XSS-Protection"]="1; mode=block"),e["Referrer-Policy"]=this.config.referrerPolicy||"strict-origin-when-cross-origin",this.config.permissionsPolicy){let t=Object.entries(this.config.permissionsPolicy).map(([r,i])=>`${r}=(${i.join(" ")})`).join(", ");e["Permissions-Policy"]=t;}else e["Permissions-Policy"]=["camera=()","microphone=()","geolocation=()","payment=()","usb=()","magnetometer=()","accelerometer=()","gyroscope=()"].join(", ");return e["Cross-Origin-Embedder-Policy"]=this.config.crossOriginEmbedderPolicy||"unsafe-none",e["Cross-Origin-Opener-Policy"]=this.config.crossOriginOpenerPolicy||"same-origin-allow-popups",e["Cross-Origin-Resource-Policy"]=this.config.crossOriginResourcePolicy||"same-origin",e}applyToResponse(e){let t=this.generateHeaders();Object.entries(t).forEach(([r,i])=>{e.setHeader(r,i);});}getFetchHeaders(){let e=new Headers,t=this.generateHeaders();return Object.entries(t).forEach(([r,i])=>{e.set(r,i);}),e}validateCSP(){let e=[],t=[],r=this.config.csp||{};return Object.entries(r).forEach(([i,s])=>{Array.isArray(s)&&(s.includes("'unsafe-inline'")&&e.push(`${i} allows 'unsafe-inline' which can enable XSS attacks`),s.includes("'unsafe-eval'")&&e.push(`${i} allows 'unsafe-eval' which can enable code injection`),s.includes("*")&&e.push(`${i} allows wildcard (*) which is overly permissive`));}),!r["default-src"]&&!r["script-src"]&&t.push("Missing script-src directive - scripts can be loaded from anywhere"),r["object-src"]||e.push("Consider setting object-src to prevent plugin injection"),r["base-uri"]||e.push("Consider setting base-uri to prevent base tag injection"),{isValid:t.length===0,warnings:e,errors:t}}static forEnvironment(e,t={}){let i={...{development:{csp:p.development().directives,hsts:false,frameOptions:"SAMEORIGIN"},staging:{csp:p.strict().addToDirective("script-src",["staging.example.com"]).directives,frameOptions:"DENY"},production:{csp:p.strict().directives,hsts:{maxAge:31536e3,includeSubDomains:true,preload:true},frameOptions:"DENY"}}[e],...t};return new n(i,e==="development")}},v=class n{config;constructor(e={}){this.config={origin:false,methods:["GET","POST","PUT","DELETE","OPTIONS"],allowedHeaders:["Content-Type","Authorization"],exposedHeaders:[],credentials:false,maxAge:86400,optionsSuccessStatus:204,...e};}isOriginAllowed(e){return e?typeof this.config.origin=="boolean"?this.config.origin:typeof this.config.origin=="string"?this.config.origin===e:Array.isArray(this.config.origin)?this.config.origin.includes(e):typeof this.config.origin=="function"?this.config.origin(e):false:true}generateHeaders(e){let t={};return this.isOriginAllowed(e)&&(this.config.credentials?t["Access-Control-Allow-Origin"]=e||"*":t["Access-Control-Allow-Origin"]="*"),this.config.methods&&this.config.methods.length>0&&(t["Access-Control-Allow-Methods"]=this.config.methods.join(", ")),this.config.allowedHeaders&&this.config.allowedHeaders.length>0&&(t["Access-Control-Allow-Headers"]=this.config.allowedHeaders.join(", ")),this.config.exposedHeaders&&this.config.exposedHeaders.length>0&&(t["Access-Control-Expose-Headers"]=this.config.exposedHeaders.join(", ")),this.config.credentials&&(t["Access-Control-Allow-Credentials"]="true"),this.config.maxAge!==void 0&&(t["Access-Control-Max-Age"]=this.config.maxAge.toString()),t}static secure(e){return new n({origin:e,methods:["GET","POST","PUT","DELETE"],allowedHeaders:["Content-Type","Authorization","X-Requested-With"],credentials:true,maxAge:86400})}static development(){return new n({origin:true,methods:["GET","POST","PUT","DELETE","OPTIONS","PATCH"],allowedHeaders:["*"],credentials:true})}},ee=T.forEnvironment(process.env.NODE_ENV==="production"?"production":"development"),te=process.env.NODE_ENV==="production"?v.secure([]):v.development();var O=class{name="XSS Scanner";description="Cross-Site Scripting vulnerability detection";severity="high";xssPayloads=['<script>alert("XSS")</script>','"><script>alert("XSS")</script>','<img src=x onerror=alert("XSS")>','javascript:alert("XSS")','<svg onload=alert("XSS")>','"><script>alert("XSS")</script>','<script>console.log("XSS")</script>',`<iframe src="javascript:alert('XSS')"></iframe>`];async scan(e){let t=[];for(let[r,i]of Object.entries(e))if(typeof i=="string")for(let s of this.xssPayloads){let o=i+s,c=m.validateInput(o,"html",{sanitize:true}),g=c.sanitized;g&&(g.includes("script")||g.includes("javascript:"))&&t.push({id:this.generateId(),scanner:this.name,severity:this.severity,title:"Cross-Site Scripting (XSS) Vulnerability",description:`Field "${r}" is vulnerable to XSS attacks`,location:r,evidence:{payload:s,original:i,sanitized:c.sanitized},remediation:"Implement proper input validation and output encoding",timestamp:new Date});}return t}generateId(){return `xss-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}},C=class{name="SQL Injection Scanner";description="SQL Injection vulnerability detection";severity="critical";sqlPayloads=["' OR '1'='1","'; DROP TABLE users; --","1' OR '1'='1","admin'--","admin'/*","' OR 1=1--","' UNION SELECT * FROM users--","1; UPDATE users SET password='hacked'--"];async scan(e){let t=[];for(let[r,i]of Object.entries(e))if(typeof i=="string")for(let s of this.sqlPayloads)this.detectSQLInjection(i+s)&&t.push({id:this.generateId(),scanner:this.name,severity:this.severity,title:"SQL Injection Vulnerability",description:`Field "${r}" may be vulnerable to SQL injection`,location:r,evidence:{payload:s,original:i},remediation:"Use parameterized queries and input validation",cve:"CWE-89",timestamp:new Date});return t}detectSQLInjection(e){return [/(\bOR\b|\bAND\b).*?=.*?(\b1\b|\b'1'\b)/i,/(\bUNION\b|\bSELECT\b|\bINSERT\b|\bUPDATE\b|\bDELETE\b|\bDROP\b)/i,/('|\").*?(\bOR\b|\bAND\b).*?('|\")/i,/--|\#|\/\*/].some(r=>r.test(e))}generateId(){return `sqli-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}},I=class{name="Input Validation Scanner";description="Input validation and sanitization testing";severity="medium";async scan(e){let t=[];for(let[r,i]of Object.entries(e)){let s=[{name:"Long input",value:"A".repeat(1e4)},{name:"Special characters",value:`!@#$%^&*()_+{}|:"<>?[]\\;',./`},{name:"Unicode characters",value:"\u{1F680}\u{1F389}\u{1F4BB}\u{1F525}\u26A1"},{name:"Null bytes",value:"test\0test"},{name:"HTML entities",value:"&lt;script&gt;alert(&quot;test&quot;)&lt;/script&gt;"}];for(let o of s)try{let c=m.validateInput(o.value,"text",{sanitize:!0,required:!1});!c.isValid&&!c.errors?.length&&t.push({id:this.generateId(),scanner:this.name,severity:this.severity,title:"Insufficient Input Validation",description:`Field "${r}" may not properly validate ${o.name}`,location:r,evidence:{testCase:o.name,input:o.value},remediation:"Implement comprehensive input validation",timestamp:new Date});}catch(c){t.push({id:this.generateId(),scanner:this.name,severity:"high",title:"Input Validation Error",description:`Field "${r}" causes validation errors with ${o.name}`,location:r,evidence:{testCase:o.name,error:c.message},remediation:"Fix input validation error handling",timestamp:new Date});}}return t}generateId(){return `input-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}},k=class{name="Authentication Bypass Scanner";description="Authentication and authorization vulnerability testing";severity="critical";async scan(e){let t=[],r=["password","token","auth","authorization","session"],i=["",null,void 0,"admin","password","123456","null","false","0","[]","{}"];for(let s of r)if(e.hasOwnProperty(s))for(let o of i)t.push({id:this.generateId(),scanner:this.name,severity:this.severity,title:"Potential Authentication Bypass",description:`Authentication field "${s}" should be tested against bypass attempts`,location:s,evidence:{field:s,bypassAttempt:o},remediation:"Implement secure authentication validation and proper session management",cve:"CWE-287",timestamp:new Date});return t}generateId(){return `auth-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}},M=class{scanners=[];constructor(){this.registerScanner(new O),this.registerScanner(new C),this.registerScanner(new I),this.registerScanner(new k);}registerScanner(e){this.scanners.push(e);}async runPenetrationTest(e,t,r={}){let i=new Date,s=[],o=this.scanners;r.includeScanners&&(o=o.filter(d=>r.includeScanners.includes(d.name))),r.excludeScanners&&(o=o.filter(d=>!r.excludeScanners.includes(d.name))),r.severity&&(o=o.filter(d=>r.severity.includes(d.severity)));for(let d of o)try{console.log(`Running ${d.name}...`);let w=await d.scan(t);s=s.concat(w);}catch(w){console.error(`Scanner ${d.name} failed:`,w);}let c=new Date,g={totalVulnerabilities:s.length,criticalCount:s.filter(d=>d.severity==="critical").length,highCount:s.filter(d=>d.severity==="high").length,mediumCount:s.filter(d=>d.severity==="medium").length,lowCount:s.filter(d=>d.severity==="low").length},D=this.generateRecommendations(s);return {id:`pentest-${Date.now()}`,targetName:e,startTime:i,endTime:c,vulnerabilities:s,summary:g,recommendations:D}}generateRecommendations(e){let t=new Set;return e.forEach(r=>{r.remediation&&t.add(r.remediation),r.scanner.includes("XSS")&&(t.add("Implement Content Security Policy (CSP) headers"),t.add("Use secure templating engines with auto-escaping")),r.scanner.includes("SQL")&&(t.add("Use parameterized queries or ORM"),t.add("Implement principle of least privilege for database access")),r.scanner.includes("Auth")&&(t.add("Implement multi-factor authentication"),t.add("Use secure session management"),t.add("Implement account lockout mechanisms"));}),e.length>0&&(t.add("Conduct regular security audits"),t.add("Implement security monitoring and logging"),t.add("Keep all dependencies updated"),t.add("Provide security training for development team")),Array.from(t)}exportReport(e){return JSON.stringify(e,null,2)}generateHtmlReport(e){let t={critical:"#dc3545",high:"#fd7e14",medium:"#ffc107",low:"#198754"};return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penetration Test Report - ${e.targetName}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .header { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .summary-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .vulnerability { background: white; padding: 20px; margin-bottom: 20px; border-left: 4px solid #ddd; border-radius: 4px; }
        .critical { border-left-color: ${t.critical}; }
        .high { border-left-color: ${t.high}; }
        .medium { border-left-color: ${t.medium}; }
        .low { border-left-color: ${t.low}; }
        .recommendations { background: #e7f3ff; padding: 20px; border-radius: 8px; margin-top: 30px; }
        .severity-badge { padding: 4px 8px; color: white; border-radius: 4px; font-size: 12px; }
        code { background: #f1f3f4; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Penetration Test Report</h1>
        <p><strong>Target:</strong> ${e.targetName}</p>
        <p><strong>Test Period:</strong> ${e.startTime.toISOString()} - ${e.endTime.toISOString()}</p>
        <p><strong>Duration:</strong> ${Math.round((e.endTime.getTime()-e.startTime.getTime())/1e3)} seconds</p>
    </div>

    <div class="summary">
        <div class="summary-card">
            <h3>Total Vulnerabilities</h3>
            <h2>${e.summary.totalVulnerabilities}</h2>
        </div>
        <div class="summary-card">
            <h3>Critical</h3>
            <h2 style="color: ${t.critical}">${e.summary.criticalCount}</h2>
        </div>
        <div class="summary-card">
            <h3>High</h3>
            <h2 style="color: ${t.high}">${e.summary.highCount}</h2>
        </div>
        <div class="summary-card">
            <h3>Medium</h3>
            <h2 style="color: ${t.medium}">${e.summary.mediumCount}</h2>
        </div>
        <div class="summary-card">
            <h3>Low</h3>
            <h2 style="color: ${t.low}">${e.summary.lowCount}</h2>
        </div>
    </div>

    <h2>Vulnerabilities</h2>
    ${e.vulnerabilities.map(r=>`
        <div class="vulnerability ${r.severity}">
            <h3>${r.title}</h3>
            <span class="severity-badge" style="background-color: ${t[r.severity]}">${r.severity.toUpperCase()}</span>
            <p><strong>Scanner:</strong> ${r.scanner}</p>
            <p><strong>Location:</strong> ${r.location||"N/A"}</p>
            <p><strong>Description:</strong> ${r.description}</p>
            ${r.remediation?`<p><strong>Remediation:</strong> ${r.remediation}</p>`:""}
            ${r.evidence?`<p><strong>Evidence:</strong> <code>${JSON.stringify(r.evidence,null,2)}</code></p>`:""}
            ${r.cve?`<p><strong>CVE:</strong> ${r.cve}</p>`:""}
            <p><strong>Timestamp:</strong> ${r.timestamp.toISOString()}</p>
        </div>
    `).join("")}

    <div class="recommendations">
        <h2>Recommendations</h2>
        <ul>
            ${e.recommendations.map(r=>`<li>${r}</li>`).join("")}
        </ul>
    </div>
</body>
</html>
    `}},se=new M;var de=n=>n.toISOString().split("T")[0],ue=()=>crypto.randomUUID();

export { k as AuthBypassScanner, v as CORSManager, p as CSPBuilder, P as InputSanitizer, I as InputValidationScanner, M as PenetrationTestFramework, h as PerformanceMonitor, y as RealtimeMonitor, C as SQLInjectionScanner, J as SecurityBoundary, E as SecurityError, T as SecurityHeadersManager, l as SecurityRules, b as SecurityValidator, Z as ValidationSchemas, O as XSSScanner, $ as addAlert, N as createMonitoringConfig, te as defaultCORS, se as defaultPentestFramework, ee as defaultSecurityHeaders, m as defaultValidator, de as formatDate, ue as generateId, L as getActiveAlerts, j as getLiveMetrics, A as measure, R as measureAsync, u as monitor, f as realtimeMonitor, x as recordError, S as recordMetric, V as removeAlert, W as setupMonitoring, z as updateLiveMetric, K as validate };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map