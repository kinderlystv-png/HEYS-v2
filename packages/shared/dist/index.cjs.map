{"version":3,"sources":["../../../node_modules/.pnpm/pino-std-serializers@7.0.0/node_modules/pino-std-serializers/lib/err-helpers.js","../../../node_modules/.pnpm/pino-std-serializers@7.0.0/node_modules/pino-std-serializers/lib/err-proto.js","../../../node_modules/.pnpm/pino-std-serializers@7.0.0/node_modules/pino-std-serializers/lib/err.js","../../../node_modules/.pnpm/pino-std-serializers@7.0.0/node_modules/pino-std-serializers/lib/err-with-cause.js","../../../node_modules/.pnpm/pino-std-serializers@7.0.0/node_modules/pino-std-serializers/lib/req.js","../../../node_modules/.pnpm/pino-std-serializers@7.0.0/node_modules/pino-std-serializers/lib/res.js","../../../node_modules/.pnpm/pino-std-serializers@7.0.0/node_modules/pino-std-serializers/index.js","../../../node_modules/.pnpm/pino@9.9.4/node_modules/pino/lib/caller.js","../../../node_modules/.pnpm/fast-redact@3.5.0/node_modules/fast-redact/lib/validator.js","../../../node_modules/.pnpm/fast-redact@3.5.0/node_modules/fast-redact/lib/rx.js","../../../node_modules/.pnpm/fast-redact@3.5.0/node_modules/fast-redact/lib/parse.js","../../../node_modules/.pnpm/fast-redact@3.5.0/node_modules/fast-redact/lib/redactor.js","../../../node_modules/.pnpm/fast-redact@3.5.0/node_modules/fast-redact/lib/modifiers.js","../../../node_modules/.pnpm/fast-redact@3.5.0/node_modules/fast-redact/lib/restorer.js","../../../node_modules/.pnpm/fast-redact@3.5.0/node_modules/fast-redact/lib/state.js","../../../node_modules/.pnpm/fast-redact@3.5.0/node_modules/fast-redact/index.js","../../../node_modules/.pnpm/pino@9.9.4/node_modules/pino/lib/symbols.js","../../../node_modules/.pnpm/pino@9.9.4/node_modules/pino/lib/redaction.js","../../../node_modules/.pnpm/pino@9.9.4/node_modules/pino/lib/time.js","../../../node_modules/.pnpm/quick-format-unescaped@4.0.4/node_modules/quick-format-unescaped/index.js","../../../node_modules/.pnpm/atomic-sleep@1.0.0/node_modules/atomic-sleep/index.js","../../../node_modules/.pnpm/sonic-boom@4.2.0/node_modules/sonic-boom/index.js","../../../node_modules/.pnpm/on-exit-leak-free@2.1.2/node_modules/on-exit-leak-free/index.js","../../../node_modules/.pnpm/thread-stream@3.1.0/node_modules/thread-stream/package.json","../../../node_modules/.pnpm/thread-stream@3.1.0/node_modules/thread-stream/lib/wait.js","../../../node_modules/.pnpm/thread-stream@3.1.0/node_modules/thread-stream/lib/indexes.js","../../../node_modules/.pnpm/thread-stream@3.1.0/node_modules/thread-stream/index.js","../../../node_modules/.pnpm/pino@9.9.4/node_modules/pino/lib/transport.js","../../../node_modules/.pnpm/pino@9.9.4/node_modules/pino/lib/tools.js","../../../node_modules/.pnpm/pino@9.9.4/node_modules/pino/lib/constants.js","../../../node_modules/.pnpm/pino@9.9.4/node_modules/pino/lib/levels.js","../../../node_modules/.pnpm/pino@9.9.4/node_modules/pino/lib/meta.js","../../../node_modules/.pnpm/pino@9.9.4/node_modules/pino/lib/proto.js","../../../node_modules/.pnpm/safe-stable-stringify@2.5.0/node_modules/safe-stable-stringify/index.js","../../../node_modules/.pnpm/pino@9.9.4/node_modules/pino/lib/multistream.js","../../../node_modules/.pnpm/pino@9.9.4/node_modules/pino/pino.js","../src/monitoring/performance.ts","../src/monitoring/realtime.ts","../src/monitoring/index.ts","../src/security/headers.ts","../src/security/pentest.ts","../src/security/validation.ts","../src/database/DatabaseService.ts","../src/security/SecurityAnalyticsService.ts","../src/monitoring/structured-logger.ts","../src/security/threat-detection-bridge.ts","../src/index.ts"],"names":["require_err_helpers","__commonJSMin","exports","module","isErrorLike","err","getErrorCause","cause","causeResult","_stackWithCauses","seen","stack","stackWithCauses","_messageWithCauses","skip","message","skipIfVErrorStyleCause","messageWithCauses","require_err_proto","rawSymbol","pinoErrProto","val","require_err","errSerializer","pinoErrorSymbols","toString","_err","key","require_err_with_cause","errWithCauseSerializer","require_req","mapHttpRequest","reqSerializer","pinoReqProto","req","connection","_req","path","require_res","mapHttpResponse","resSerializer","pinoResProto","res","_res","require_pino_std_serializers","reqSerializers","resSerializers","customSerializer","require_caller","noOpPrepareStackTrace","_","originalPrepare","entries","fileNames","entry","require_validator","validator","opts","ERR_PATHS_MUST_BE_STRINGS","ERR_INVALID_PATH","s","paths","expr","require_rx","require_parse","rx","parse","wildcards","wcLen","secret","o","strPath","ix","p","leadingBracket","star","before","beforeStr","after","nested","require_redactor","redactor","serialize","strict","isCensorFct","censorFctTakesPath","state","redact","strictImpl","redactTmpl","dynamicRedactTmpl","resultTmpl","escPath","arrPath","delim","hops","match","index","input","existence","circularDetection","censorArgs","hasWildcards","require_modifiers","groupRedact","groupRestore","nestedRedact","nestedRestore","keys","values","target","length","i","k","censor","get","keysLength","pathLength","pathWithKey","instructions","value","current","store","ns","specialSet","has","obj","prop","afterPath","afterPathLen","lastPathIndex","originalKey","n","nv","ov","oov","wc","kIsWc","wcov","consecutive","level","depth","redactPathCurrent","tree","wcKeys","j","wck","node","iterateNthLevel","rv","restoreInstr","l","parent","child","require_restorer","restorer","resetters","resetTmpl","restoreTmpl","circle","reset","clear","require_state","compileRestore","builder","require_fast_redact","validate","noop","DEFAULT_CENSOR","fastRedact","remove","require_symbols","setLevelSym","getLevelSym","levelValSym","levelCompSym","useLevelLabelsSym","useOnlyCustomLevelsSym","mixinSym","lsCacheSym","chindingsSym","asJsonSym","writeSym","redactFmtSym","timeSym","timeSliceIndexSym","streamSym","stringifySym","stringifySafeSym","stringifiersSym","endSym","formatOptsSym","messageKeySym","errorKeySym","nestedKeySym","nestedKeyStrSym","mixinMergeStrategySym","msgPrefixSym","wildcardFirstSym","serializersSym","formattersSym","hooksSym","needsMetadataGsym","require_redaction","CENSOR","redaction","handle","shape","str","first","next","nextPath","result","topCensor","args","wrappedCensor","require_time","nullTime","epochTime","unixTime","isoTime","require_quick_format_unescaped","tryStringify","format","f","ss","offset","len","objects","argLen","a","lastPos","flen","type","require_atomic_sleep","sleep","ms","nil","require_sonic_boom","fs","EventEmitter","inherits","assert","BUSY_WRITE_TIMEOUT","kEmptyBuffer","MAX_WRITE","kContentModeBuffer","kContentModeUtf8","major","minor","kCopyBuffer","openFile","file","sonic","fileOpened","fd","reopening","flags","mode","SonicBoom","dest","minLength","maxLength","maxWrite","periodicFlush","sync","append","mkdir","retryEAGAIN","fsync","contentMode","fsWriteSync","fsWrite","writeBuffer","flushBuffer","flushBufferSync","actualWriteBuffer","write","flush","flushSync","actualWrite","releasedBufObj","releaseWritingBuf","actualClose","emitDrain","name","writingBuf","mergeBuf","bufs","data","lens","callFlushCallbackOnDrain","cb","onDrain","onError","error","buf","release","written","closeWrapped","done","require_on_exit_leak_free","refs","functions","onExit","onBeforeExit","registry","ensureRegistry","install","event","uninstall","callRefs","ref","fn","_register","register","registerBeforeExit","unregister","_obj","require_package","require_wait","wait","expected","timeout","max","prior","check","backoff","waitDiff","require_indexes","require_thread_stream","version","Worker","join","pathToFileURL","WRITE_INDEX","READ_INDEX","buffer","kImpl","MAX_STRING","FakeWeakRef","FakeFinalizationRegistry","FinalizationRegistry","WeakRef","worker","createWorker","stream","filename","workerData","toExecute","onWorkerMessage","onWorkerExit","drain","nextFlush","writeIndex","leftover","end","toWrite","toWriteBytes","destroy","msg","code","ThreadStream","transferList","writeSync","readIndex","spins","require_transport","createRequire","getCallers","isAbsolute","sep","setupOnExit","autoEnd","buildStream","workerOpts","onReady","transport","fullOptions","pipeline","targets","levels","dedupe","caller","options","callers","bundlerOverrides","fixTarget","t","origin","filePath","context","require_tools","isMainThread","genLog","hook","LOG","formatParams","asString","last","found","point","asJson","num","time","stringify","stringifySafe","stringifiers","chindings","serializers","formatters","messageKey","errorKey","wildcardStringifier","propStr","stringifier","strKey","msgStr","asChindings","instance","bindings","formatter","hasBeenTampered","buildSafeSonicBoom","filterBrokenPipe","eventName","createArgsNormalizer","defaultOptions","customLevels","enabled","onChild","stringifySafeFn","buildFormatters","log","normalizeDestFileDescriptor","destination","require_constants","DEFAULT_LEVELS","SORTING_ORDER","require_levels","levelMethods","logFatal","nums","initialLsCache","genLsCache","labels","cache","label","isStandardLevel","useOnlyCustomLevels","setLevel","preLevelVal","levelVal","useOnlyCustomLevelsVal","levelComparison","getLevel","isLevelEnabled","logLevel","logLevelVal","compareLevel","direction","genLevelComparison","mappings","customNums","assertDefaultLevelFound","defaultLevel","assertNoLevelCollisions","assertLevelComparison","require_meta","require_proto","parsedChindingsSym","constructor","prototype","setBindings","lvl","resetChildingsFormatter","parentSymbols","ks","bk","bindingsSymbols","bi","bks","formatOpts","childLevel","chindingsJson","bindingsFromJson","newBindings","defaultMixinMergeStrategy","mergeObject","mixinObject","mixin","mixinMergeStrategy","streamWriteHook","require_safe_stable_stringify","hasOwnProperty","configure","strEscapeSequencesRegExp","strEscape","sort","array","comparator","currentValue","position","typedArrayPrototypeGetSymbolToStringTag","isTypedArrayWithEntries","stringifyTypedArray","separator","maximumBreadth","whitespace","getCircularValueOption","circularValue","getDeterministicOption","getBooleanOption","getPositiveIntegerOption","getItemCount","number","getUniqueReplacerSet","replacerArray","replacerSet","getStrictOption","fail","bigint","deterministic","maximumDepth","stringifyFnReplacer","replacer","spacer","indentation","originalIndentation","maximumValuesToStringify","tmp","removedKeys","keyLength","maximumPropertiesToStringify","stringifyArrayReplacer","stringifyIndent","stringifySimple","hasLength","space","require_multistream","metadata","DEFAULT_INFO_LEVEL","multistream","streamsArray","streamLevels","add","emit","clone","streams","recordedLevel","initLoopVar","checkLoopVar","adjustLoopVar","lastTime","lastMsg","lastObj","lastLogger","isStream","stream_","dest_","compareByLevel","id","b","require_pino","os","stdSerializers","proto","symbols","pid","hostname","defaultErrorSerializer","normalize","pino","crlf","timestamp","nestedKey","base","hooks","depthLimit","edgeLimit","msgPrefix","allFormatters","stringifyFn","coreChindings","timeSliceIndex","levelCompFunc","PerformanceMonitor","config","unit","tags","metric","severity","errorReport","start","duration","payload","sessionId","monitor","recordMetric","recordError","measureAsync","measure","RealtimeMonitor","websocketUrl","callback","rule","alertRule","previous","alert","metricName","applicableRules","subscribers","realtimeMonitor","addAlert","removeAlert","updateLiveMetric","getLiveMetrics","getActiveAlerts","createMonitoringConfig","setupMonitoring","monitoringConfig","list","CSPBuilder","_CSPBuilder","initialDirectives","directive","existing","policies","SecurityHeadersManager","_SecurityHeadersManager","isDevelopment","headers","csp","defaultCSP","hsts","hstsValue","feature","allowlist","securityHeaders","warnings","errors","env","customConfig","CORSManager","_CORSManager","allowedOrigins","defaultSecurityHeaders","defaultCORS","XSSScanner","vulnerabilities","testValue","containsDangerousPatterns","patterns","detectedPatterns","pattern","SQLInjectionScanner","InputValidationScanner","_value","testCases","testCase","validation","defaultValidator","AuthBypassScanner","authFields","bypassAttempts","field","attempt","PenetrationTestFramework","scanner","targetName","startTime","allVulnerabilities","scannersToRun","endTime","summary","v","recommendations","vuln","report","severityColors","rec","defaultPentestFramework","DOMPurify","z","ValidationSchemas","InputSanitizer","purifier","dangerous","sanitized","SecurityRules","SecurityValidator","schema","processedData","parseResult","securityErrors","defaultRules","strictErrors","item","ruleNames","ruleName","SecurityBoundary","rules","_target","_propertyName","descriptor","method","SecurityError","sanitize","createClient","DatabaseService","supabaseUrl","supabaseKey","userId","clientId","limit","query","incident","status","updates","period","startDate","endDate","iocType","iocValue","session","sessionToken","import_pino","LogLevelSchema","LoggerConfigSchema","StructuredLogger","_StructuredLogger","defaultContext","baseConfig","consoleApi","levelToConsoleMethod","levelValue","levelLabel","consoleMethodName","consoleMethod","mergedContext","logData","errorLog","componentLabel","perfLog","operationId","operation","success","component","action","url","statusCode","resolve","loggerCandidate","combinedMetadata","combinedTags","baseTags","additionalTags","combined","globalLogger","getGlobalLogger","ThreatDetectionService","_event","SecurityAnalyticsService","threatIntel","normalizedError","savedEvent","analysisResult","integratedEvent","incidentPayload","normalizedMatches","normalizedResponses","normalizedTimeline","normalizedImpact","incidentRecord","timeRange","securityMetrics","topThreats","recentIncidents","recentEvents","threatDistribution","riskScore","trends","events","results","batch","batchResults","eventsToProcess","historicalEvents","trainingData","responseTime","actions","distribution","count","metrics","incidents","score","openIncidents","criticalIncidents","formatDate","date","generateId"],"mappings":"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","sourcesContent":["'use strict'\n\n// **************************************************************\n// * Code initially copied/adapted from \"pony-cause\" npm module *\n// * Please upstream improvements there                         *\n// **************************************************************\n\nconst isErrorLike = (err) => {\n  return err && typeof err.message === 'string'\n}\n\n/**\n * @param {Error|{ cause?: unknown|(()=>err)}} err\n * @returns {Error|Object|undefined}\n */\nconst getErrorCause = (err) => {\n  if (!err) return\n\n  /** @type {unknown} */\n  // @ts-ignore\n  const cause = err.cause\n\n  // VError / NError style causes\n  if (typeof cause === 'function') {\n    // @ts-ignore\n    const causeResult = err.cause()\n\n    return isErrorLike(causeResult)\n      ? causeResult\n      : undefined\n  } else {\n    return isErrorLike(cause)\n      ? cause\n      : undefined\n  }\n}\n\n/**\n * Internal method that keeps a track of which error we have already added, to avoid circular recursion\n *\n * @private\n * @param {Error} err\n * @param {Set<Error>} seen\n * @returns {string}\n */\nconst _stackWithCauses = (err, seen) => {\n  if (!isErrorLike(err)) return ''\n\n  const stack = err.stack || ''\n\n  // Ensure we don't go circular or crazily deep\n  if (seen.has(err)) {\n    return stack + '\\ncauses have become circular...'\n  }\n\n  const cause = getErrorCause(err)\n\n  if (cause) {\n    seen.add(err)\n    return (stack + '\\ncaused by: ' + _stackWithCauses(cause, seen))\n  } else {\n    return stack\n  }\n}\n\n/**\n * @param {Error} err\n * @returns {string}\n */\nconst stackWithCauses = (err) => _stackWithCauses(err, new Set())\n\n/**\n * Internal method that keeps a track of which error we have already added, to avoid circular recursion\n *\n * @private\n * @param {Error} err\n * @param {Set<Error>} seen\n * @param {boolean} [skip]\n * @returns {string}\n */\nconst _messageWithCauses = (err, seen, skip) => {\n  if (!isErrorLike(err)) return ''\n\n  const message = skip ? '' : (err.message || '')\n\n  // Ensure we don't go circular or crazily deep\n  if (seen.has(err)) {\n    return message + ': ...'\n  }\n\n  const cause = getErrorCause(err)\n\n  if (cause) {\n    seen.add(err)\n\n    // @ts-ignore\n    const skipIfVErrorStyleCause = typeof err.cause === 'function'\n\n    return (message +\n      (skipIfVErrorStyleCause ? '' : ': ') +\n      _messageWithCauses(cause, seen, skipIfVErrorStyleCause))\n  } else {\n    return message\n  }\n}\n\n/**\n * @param {Error} err\n * @returns {string}\n */\nconst messageWithCauses = (err) => _messageWithCauses(err, new Set())\n\nmodule.exports = {\n  isErrorLike,\n  getErrorCause,\n  stackWithCauses,\n  messageWithCauses\n}\n","'use strict'\n\nconst seen = Symbol('circular-ref-tag')\nconst rawSymbol = Symbol('pino-raw-err-ref')\n\nconst pinoErrProto = Object.create({}, {\n  type: {\n    enumerable: true,\n    writable: true,\n    value: undefined\n  },\n  message: {\n    enumerable: true,\n    writable: true,\n    value: undefined\n  },\n  stack: {\n    enumerable: true,\n    writable: true,\n    value: undefined\n  },\n  aggregateErrors: {\n    enumerable: true,\n    writable: true,\n    value: undefined\n  },\n  raw: {\n    enumerable: false,\n    get: function () {\n      return this[rawSymbol]\n    },\n    set: function (val) {\n      this[rawSymbol] = val\n    }\n  }\n})\nObject.defineProperty(pinoErrProto, rawSymbol, {\n  writable: true,\n  value: {}\n})\n\nmodule.exports = {\n  pinoErrProto,\n  pinoErrorSymbols: {\n    seen,\n    rawSymbol\n  }\n}\n","'use strict'\n\nmodule.exports = errSerializer\n\nconst { messageWithCauses, stackWithCauses, isErrorLike } = require('./err-helpers')\nconst { pinoErrProto, pinoErrorSymbols } = require('./err-proto')\nconst { seen } = pinoErrorSymbols\n\nconst { toString } = Object.prototype\n\nfunction errSerializer (err) {\n  if (!isErrorLike(err)) {\n    return err\n  }\n\n  err[seen] = undefined // tag to prevent re-looking at this\n  const _err = Object.create(pinoErrProto)\n  _err.type = toString.call(err.constructor) === '[object Function]'\n    ? err.constructor.name\n    : err.name\n  _err.message = messageWithCauses(err)\n  _err.stack = stackWithCauses(err)\n\n  if (Array.isArray(err.errors)) {\n    _err.aggregateErrors = err.errors.map(err => errSerializer(err))\n  }\n\n  for (const key in err) {\n    if (_err[key] === undefined) {\n      const val = err[key]\n      if (isErrorLike(val)) {\n        // We append cause messages and stacks to _err, therefore skipping causes here\n        if (key !== 'cause' && !Object.prototype.hasOwnProperty.call(val, seen)) {\n          _err[key] = errSerializer(val)\n        }\n      } else {\n        _err[key] = val\n      }\n    }\n  }\n\n  delete err[seen] // clean up tag in case err is serialized again later\n  _err.raw = err\n  return _err\n}\n","'use strict'\n\nmodule.exports = errWithCauseSerializer\n\nconst { isErrorLike } = require('./err-helpers')\nconst { pinoErrProto, pinoErrorSymbols } = require('./err-proto')\nconst { seen } = pinoErrorSymbols\n\nconst { toString } = Object.prototype\n\nfunction errWithCauseSerializer (err) {\n  if (!isErrorLike(err)) {\n    return err\n  }\n\n  err[seen] = undefined // tag to prevent re-looking at this\n  const _err = Object.create(pinoErrProto)\n  _err.type = toString.call(err.constructor) === '[object Function]'\n    ? err.constructor.name\n    : err.name\n  _err.message = err.message\n  _err.stack = err.stack\n\n  if (Array.isArray(err.errors)) {\n    _err.aggregateErrors = err.errors.map(err => errWithCauseSerializer(err))\n  }\n\n  if (isErrorLike(err.cause) && !Object.prototype.hasOwnProperty.call(err.cause, seen)) {\n    _err.cause = errWithCauseSerializer(err.cause)\n  }\n\n  for (const key in err) {\n    if (_err[key] === undefined) {\n      const val = err[key]\n      if (isErrorLike(val)) {\n        if (!Object.prototype.hasOwnProperty.call(val, seen)) {\n          _err[key] = errWithCauseSerializer(val)\n        }\n      } else {\n        _err[key] = val\n      }\n    }\n  }\n\n  delete err[seen] // clean up tag in case err is serialized again later\n  _err.raw = err\n  return _err\n}\n","'use strict'\n\nmodule.exports = {\n  mapHttpRequest,\n  reqSerializer\n}\n\nconst rawSymbol = Symbol('pino-raw-req-ref')\nconst pinoReqProto = Object.create({}, {\n  id: {\n    enumerable: true,\n    writable: true,\n    value: ''\n  },\n  method: {\n    enumerable: true,\n    writable: true,\n    value: ''\n  },\n  url: {\n    enumerable: true,\n    writable: true,\n    value: ''\n  },\n  query: {\n    enumerable: true,\n    writable: true,\n    value: ''\n  },\n  params: {\n    enumerable: true,\n    writable: true,\n    value: ''\n  },\n  headers: {\n    enumerable: true,\n    writable: true,\n    value: {}\n  },\n  remoteAddress: {\n    enumerable: true,\n    writable: true,\n    value: ''\n  },\n  remotePort: {\n    enumerable: true,\n    writable: true,\n    value: ''\n  },\n  raw: {\n    enumerable: false,\n    get: function () {\n      return this[rawSymbol]\n    },\n    set: function (val) {\n      this[rawSymbol] = val\n    }\n  }\n})\nObject.defineProperty(pinoReqProto, rawSymbol, {\n  writable: true,\n  value: {}\n})\n\nfunction reqSerializer (req) {\n  // req.info is for hapi compat.\n  const connection = req.info || req.socket\n  const _req = Object.create(pinoReqProto)\n  _req.id = (typeof req.id === 'function' ? req.id() : (req.id || (req.info ? req.info.id : undefined)))\n  _req.method = req.method\n  // req.originalUrl is for expressjs compat.\n  if (req.originalUrl) {\n    _req.url = req.originalUrl\n  } else {\n    const path = req.path\n    // path for safe hapi compat.\n    _req.url = typeof path === 'string' ? path : (req.url ? req.url.path || req.url : undefined)\n  }\n\n  if (req.query) {\n    _req.query = req.query\n  }\n\n  if (req.params) {\n    _req.params = req.params\n  }\n\n  _req.headers = req.headers\n  _req.remoteAddress = connection && connection.remoteAddress\n  _req.remotePort = connection && connection.remotePort\n  // req.raw is  for hapi compat/equivalence\n  _req.raw = req.raw || req\n  return _req\n}\n\nfunction mapHttpRequest (req) {\n  return {\n    req: reqSerializer(req)\n  }\n}\n","'use strict'\n\nmodule.exports = {\n  mapHttpResponse,\n  resSerializer\n}\n\nconst rawSymbol = Symbol('pino-raw-res-ref')\nconst pinoResProto = Object.create({}, {\n  statusCode: {\n    enumerable: true,\n    writable: true,\n    value: 0\n  },\n  headers: {\n    enumerable: true,\n    writable: true,\n    value: ''\n  },\n  raw: {\n    enumerable: false,\n    get: function () {\n      return this[rawSymbol]\n    },\n    set: function (val) {\n      this[rawSymbol] = val\n    }\n  }\n})\nObject.defineProperty(pinoResProto, rawSymbol, {\n  writable: true,\n  value: {}\n})\n\nfunction resSerializer (res) {\n  const _res = Object.create(pinoResProto)\n  _res.statusCode = res.headersSent ? res.statusCode : null\n  _res.headers = res.getHeaders ? res.getHeaders() : res._headers\n  _res.raw = res\n  return _res\n}\n\nfunction mapHttpResponse (res) {\n  return {\n    res: resSerializer(res)\n  }\n}\n","'use strict'\n\nconst errSerializer = require('./lib/err')\nconst errWithCauseSerializer = require('./lib/err-with-cause')\nconst reqSerializers = require('./lib/req')\nconst resSerializers = require('./lib/res')\n\nmodule.exports = {\n  err: errSerializer,\n  errWithCause: errWithCauseSerializer,\n  mapHttpRequest: reqSerializers.mapHttpRequest,\n  mapHttpResponse: resSerializers.mapHttpResponse,\n  req: reqSerializers.reqSerializer,\n  res: resSerializers.resSerializer,\n\n  wrapErrorSerializer: function wrapErrorSerializer (customSerializer) {\n    if (customSerializer === errSerializer) return customSerializer\n    return function wrapErrSerializer (err) {\n      return customSerializer(errSerializer(err))\n    }\n  },\n\n  wrapRequestSerializer: function wrapRequestSerializer (customSerializer) {\n    if (customSerializer === reqSerializers.reqSerializer) return customSerializer\n    return function wrappedReqSerializer (req) {\n      return customSerializer(reqSerializers.reqSerializer(req))\n    }\n  },\n\n  wrapResponseSerializer: function wrapResponseSerializer (customSerializer) {\n    if (customSerializer === resSerializers.resSerializer) return customSerializer\n    return function wrappedResSerializer (res) {\n      return customSerializer(resSerializers.resSerializer(res))\n    }\n  }\n}\n","'use strict'\n\nfunction noOpPrepareStackTrace (_, stack) {\n  return stack\n}\n\nmodule.exports = function getCallers () {\n  const originalPrepare = Error.prepareStackTrace\n  Error.prepareStackTrace = noOpPrepareStackTrace\n  const stack = new Error().stack\n  Error.prepareStackTrace = originalPrepare\n\n  if (!Array.isArray(stack)) {\n    return undefined\n  }\n\n  const entries = stack.slice(2)\n\n  const fileNames = []\n\n  for (const entry of entries) {\n    if (!entry) {\n      continue\n    }\n\n    fileNames.push(entry.getFileName())\n  }\n\n  return fileNames\n}\n","'use strict'\n\nmodule.exports = validator\n\nfunction validator (opts = {}) {\n  const {\n    ERR_PATHS_MUST_BE_STRINGS = () => 'fast-redact - Paths must be (non-empty) strings',\n    ERR_INVALID_PATH = (s) => `fast-redact  Invalid path (${s})`\n  } = opts\n\n  return function validate ({ paths }) {\n    paths.forEach((s) => {\n      if (typeof s !== 'string') {\n        throw Error(ERR_PATHS_MUST_BE_STRINGS())\n      }\n      try {\n        if (//.test(s)) throw Error()\n        const expr = (s[0] === '[' ? '' : '.') + s.replace(/^\\*/, '').replace(/\\.\\*/g, '.').replace(/\\[\\*\\]/g, '[]')\n        if (/\\n|\\r|;/.test(expr)) throw Error()\n        if (/\\/\\*/.test(expr)) throw Error()\n        /* eslint-disable-next-line */\n        Function(`\n            'use strict'\n            const o = new Proxy({}, { get: () => o, set: () => { throw Error() } });\n            const  = null;\n            o${expr}\n            if ([o${expr}].length !== 1) throw Error()`)()\n      } catch (e) {\n        throw Error(ERR_INVALID_PATH(s))\n      }\n    })\n  }\n}\n","'use strict'\n\nmodule.exports = /[^.[\\]]+|\\[((?:.)*?)\\]/g\n\n/*\nRegular expression explanation:\n\nAlt 1: /[^.[\\]]+/ - Match one or more characters that are *not* a dot (.)\n                    opening square bracket ([) or closing square bracket (])\n\nAlt 2: /\\[((?:.)*?)\\]/ - If the char IS dot or square bracket, then create a capture\n                         group (which will be capture group $1) that matches anything\n                         within square brackets. Expansion is lazy so it will\n                         stop matching as soon as the first closing bracket is met `]`\n                         (rather than continuing to match until the final closing bracket).\n*/\n","'use strict'\n\nconst rx = require('./rx')\n\nmodule.exports = parse\n\nfunction parse ({ paths }) {\n  const wildcards = []\n  var wcLen = 0\n  const secret = paths.reduce(function (o, strPath, ix) {\n    var path = strPath.match(rx).map((p) => p.replace(/'|\"|`/g, ''))\n    const leadingBracket = strPath[0] === '['\n    path = path.map((p) => {\n      if (p[0] === '[') return p.substr(1, p.length - 2)\n      else return p\n    })\n    const star = path.indexOf('*')\n    if (star > -1) {\n      const before = path.slice(0, star)\n      const beforeStr = before.join('.')\n      const after = path.slice(star + 1, path.length)\n      const nested = after.length > 0\n      wcLen++\n      wildcards.push({\n        before,\n        beforeStr,\n        after,\n        nested\n      })\n    } else {\n      o[strPath] = {\n        path: path,\n        val: undefined,\n        precensored: false,\n        circle: '',\n        escPath: JSON.stringify(strPath),\n        leadingBracket: leadingBracket\n      }\n    }\n    return o\n  }, {})\n\n  return { wildcards, wcLen, secret }\n}\n","'use strict'\n\nconst rx = require('./rx')\n\nmodule.exports = redactor\n\nfunction redactor ({ secret, serialize, wcLen, strict, isCensorFct, censorFctTakesPath }, state) {\n  /* eslint-disable-next-line */\n  const redact = Function('o', `\n    if (typeof o !== 'object' || o == null) {\n      ${strictImpl(strict, serialize)}\n    }\n    const { censor, secret } = this\n    const originalSecret = {}\n    const secretKeys = Object.keys(secret)\n    for (var i = 0; i < secretKeys.length; i++) {\n      originalSecret[secretKeys[i]] = secret[secretKeys[i]]\n    }\n\n    ${redactTmpl(secret, isCensorFct, censorFctTakesPath)}\n    this.compileRestore()\n    ${dynamicRedactTmpl(wcLen > 0, isCensorFct, censorFctTakesPath)}\n    this.secret = originalSecret\n    ${resultTmpl(serialize)}\n  `).bind(state)\n\n  redact.state = state\n\n  if (serialize === false) {\n    redact.restore = (o) => state.restore(o)\n  }\n\n  return redact\n}\n\nfunction redactTmpl (secret, isCensorFct, censorFctTakesPath) {\n  return Object.keys(secret).map((path) => {\n    const { escPath, leadingBracket, path: arrPath } = secret[path]\n    const skip = leadingBracket ? 1 : 0\n    const delim = leadingBracket ? '' : '.'\n    const hops = []\n    var match\n    while ((match = rx.exec(path)) !== null) {\n      const [ , ix ] = match\n      const { index, input } = match\n      if (index > skip) hops.push(input.substring(0, index - (ix ? 0 : 1)))\n    }\n    var existence = hops.map((p) => `o${delim}${p}`).join(' && ')\n    if (existence.length === 0) existence += `o${delim}${path} != null`\n    else existence += ` && o${delim}${path} != null`\n\n    const circularDetection = `\n      switch (true) {\n        ${hops.reverse().map((p) => `\n          case o${delim}${p} === censor:\n            secret[${escPath}].circle = ${JSON.stringify(p)}\n            break\n        `).join('\\n')}\n      }\n    `\n\n    const censorArgs = censorFctTakesPath\n      ? `val, ${JSON.stringify(arrPath)}`\n      : `val`\n\n    return `\n      if (${existence}) {\n        const val = o${delim}${path}\n        if (val === censor) {\n          secret[${escPath}].precensored = true\n        } else {\n          secret[${escPath}].val = val\n          o${delim}${path} = ${isCensorFct ? `censor(${censorArgs})` : 'censor'}\n          ${circularDetection}\n        }\n      }\n    `\n  }).join('\\n')\n}\n\nfunction dynamicRedactTmpl (hasWildcards, isCensorFct, censorFctTakesPath) {\n  return hasWildcards === true ? `\n    {\n      const { wildcards, wcLen, groupRedact, nestedRedact } = this\n      for (var i = 0; i < wcLen; i++) {\n        const { before, beforeStr, after, nested } = wildcards[i]\n        if (nested === true) {\n          secret[beforeStr] = secret[beforeStr] || []\n          nestedRedact(secret[beforeStr], o, before, after, censor, ${isCensorFct}, ${censorFctTakesPath})\n        } else secret[beforeStr] = groupRedact(o, before, censor, ${isCensorFct}, ${censorFctTakesPath})\n      }\n    }\n  ` : ''\n}\n\nfunction resultTmpl (serialize) {\n  return serialize === false ? `return o` : `\n    var s = this.serialize(o)\n    this.restore(o)\n    return s\n  `\n}\n\nfunction strictImpl (strict, serialize) {\n  return strict === true\n    ? `throw Error('fast-redact: primitives cannot be redacted')`\n    : serialize === false ? `return o` : `return this.serialize(o)`\n}\n","'use strict'\n\nmodule.exports = {\n  groupRedact,\n  groupRestore,\n  nestedRedact,\n  nestedRestore\n}\n\nfunction groupRestore ({ keys, values, target }) {\n  if (target == null || typeof target === 'string') return\n  const length = keys.length\n  for (var i = 0; i < length; i++) {\n    const k = keys[i]\n    target[k] = values[i]\n  }\n}\n\nfunction groupRedact (o, path, censor, isCensorFct, censorFctTakesPath) {\n  const target = get(o, path)\n  if (target == null || typeof target === 'string') return { keys: null, values: null, target, flat: true }\n  const keys = Object.keys(target)\n  const keysLength = keys.length\n  const pathLength = path.length\n  const pathWithKey = censorFctTakesPath ? [...path] : undefined\n  const values = new Array(keysLength)\n\n  for (var i = 0; i < keysLength; i++) {\n    const key = keys[i]\n    values[i] = target[key]\n\n    if (censorFctTakesPath) {\n      pathWithKey[pathLength] = key\n      target[key] = censor(target[key], pathWithKey)\n    } else if (isCensorFct) {\n      target[key] = censor(target[key])\n    } else {\n      target[key] = censor\n    }\n  }\n  return { keys, values, target, flat: true }\n}\n\n/**\n * @param {RestoreInstruction[]} instructions a set of instructions for restoring values to objects\n */\nfunction nestedRestore (instructions) {\n  for (let i = 0; i < instructions.length; i++) {\n    const { target, path, value } = instructions[i]\n    let current = target\n    for (let i = path.length - 1; i > 0; i--) {\n      current = current[path[i]]\n    }\n    current[path[0]] = value\n  }\n}\n\nfunction nestedRedact (store, o, path, ns, censor, isCensorFct, censorFctTakesPath) {\n  const target = get(o, path)\n  if (target == null) return\n  const keys = Object.keys(target)\n  const keysLength = keys.length\n  for (var i = 0; i < keysLength; i++) {\n    const key = keys[i]\n    specialSet(store, target, key, path, ns, censor, isCensorFct, censorFctTakesPath)\n  }\n  return store\n}\n\nfunction has (obj, prop) {\n  return obj !== undefined && obj !== null\n    ? ('hasOwn' in Object ? Object.hasOwn(obj, prop) : Object.prototype.hasOwnProperty.call(obj, prop))\n    : false\n}\n\nfunction specialSet (store, o, k, path, afterPath, censor, isCensorFct, censorFctTakesPath) {\n  const afterPathLen = afterPath.length\n  const lastPathIndex = afterPathLen - 1\n  const originalKey = k\n  var i = -1\n  var n\n  var nv\n  var ov\n  var oov = null\n  var wc = null\n  var kIsWc\n  var wcov\n  var consecutive = false\n  var level = 0\n  // need to track depth of the `redactPath` tree\n  var depth = 0\n  var redactPathCurrent = tree()\n  ov = n = o[k]\n  if (typeof n !== 'object') return\n  while (n != null && ++i < afterPathLen) {\n    depth += 1\n    k = afterPath[i]\n    oov = ov\n    if (k !== '*' && !wc && !(typeof n === 'object' && k in n)) {\n      break\n    }\n    if (k === '*') {\n      if (wc === '*') {\n        consecutive = true\n      }\n      wc = k\n      if (i !== lastPathIndex) {\n        continue\n      }\n    }\n    if (wc) {\n      const wcKeys = Object.keys(n)\n      for (var j = 0; j < wcKeys.length; j++) {\n        const wck = wcKeys[j]\n        wcov = n[wck]\n        kIsWc = k === '*'\n        if (consecutive) {\n          redactPathCurrent = node(redactPathCurrent, wck, depth)\n          level = i\n          ov = iterateNthLevel(wcov, level - 1, k, path, afterPath, censor, isCensorFct, censorFctTakesPath, originalKey, n, nv, ov, kIsWc, wck, i, lastPathIndex, redactPathCurrent, store, o[originalKey], depth + 1)\n        } else {\n          if (kIsWc || (typeof wcov === 'object' && wcov !== null && k in wcov)) {\n            if (kIsWc) {\n              ov = wcov\n            } else {\n              ov = wcov[k]\n            }\n            nv = (i !== lastPathIndex)\n              ? ov\n              : (isCensorFct\n                ? (censorFctTakesPath ? censor(ov, [...path, originalKey, ...afterPath]) : censor(ov))\n                : censor)\n            if (kIsWc) {\n              const rv = restoreInstr(node(redactPathCurrent, wck, depth), ov, o[originalKey])\n              store.push(rv)\n              n[wck] = nv\n            } else {\n              if (wcov[k] === nv) {\n                // pass\n              } else if ((nv === undefined && censor !== undefined) || (has(wcov, k) && nv === ov)) {\n                redactPathCurrent = node(redactPathCurrent, wck, depth)\n              } else {\n                redactPathCurrent = node(redactPathCurrent, wck, depth)\n                const rv = restoreInstr(node(redactPathCurrent, k, depth + 1), ov, o[originalKey])\n                store.push(rv)\n                wcov[k] = nv\n              }\n            }\n          }\n        }\n      }\n      wc = null\n    } else {\n      ov = n[k]\n      redactPathCurrent = node(redactPathCurrent, k, depth)\n      nv = (i !== lastPathIndex)\n        ? ov\n        : (isCensorFct\n          ? (censorFctTakesPath ? censor(ov, [...path, originalKey, ...afterPath]) : censor(ov))\n          : censor)\n      if ((has(n, k) && nv === ov) || (nv === undefined && censor !== undefined)) {\n        // pass\n      } else {\n        const rv = restoreInstr(redactPathCurrent, ov, o[originalKey])\n        store.push(rv)\n        n[k] = nv\n      }\n      n = n[k]\n    }\n    if (typeof n !== 'object') break\n    // prevent circular structure, see https://github.com/pinojs/pino/issues/1513\n    if (ov === oov || typeof ov === 'undefined') {\n      // pass\n    }\n  }\n}\n\nfunction get (o, p) {\n  var i = -1\n  var l = p.length\n  var n = o\n  while (n != null && ++i < l) {\n    n = n[p[i]]\n  }\n  return n\n}\n\nfunction iterateNthLevel (wcov, level, k, path, afterPath, censor, isCensorFct, censorFctTakesPath, originalKey, n, nv, ov, kIsWc, wck, i, lastPathIndex, redactPathCurrent, store, parent, depth) {\n  if (level === 0) {\n    if (kIsWc || (typeof wcov === 'object' && wcov !== null && k in wcov)) {\n      if (kIsWc) {\n        ov = wcov\n      } else {\n        ov = wcov[k]\n      }\n      nv = (i !== lastPathIndex)\n        ? ov\n        : (isCensorFct\n          ? (censorFctTakesPath ? censor(ov, [...path, originalKey, ...afterPath]) : censor(ov))\n          : censor)\n      if (kIsWc) {\n        const rv = restoreInstr(redactPathCurrent, ov, parent)\n        store.push(rv)\n        n[wck] = nv\n      } else {\n        if (wcov[k] === nv) {\n          // pass\n        } else if ((nv === undefined && censor !== undefined) || (has(wcov, k) && nv === ov)) {\n          // pass\n        } else {\n          const rv = restoreInstr(node(redactPathCurrent, k, depth + 1), ov, parent)\n          store.push(rv)\n          wcov[k] = nv\n        }\n      }\n    }\n  }\n  for (const key in wcov) {\n    if (typeof wcov[key] === 'object') {\n      redactPathCurrent = node(redactPathCurrent, key, depth)\n      iterateNthLevel(wcov[key], level - 1, k, path, afterPath, censor, isCensorFct, censorFctTakesPath, originalKey, n, nv, ov, kIsWc, wck, i, lastPathIndex, redactPathCurrent, store, parent, depth + 1)\n    }\n  }\n}\n\n/**\n * @typedef {object} TreeNode\n * @prop {TreeNode} [parent] reference to the parent of this node in the tree, or `null` if there is no parent\n * @prop {string} key the key that this node represents (key here being part of the path being redacted\n * @prop {TreeNode[]} children the child nodes of this node\n * @prop {number} depth the depth of this node in the tree\n */\n\n/**\n * instantiate a new, empty tree\n * @returns {TreeNode}\n */\nfunction tree () {\n  return { parent: null, key: null, children: [], depth: 0 }\n}\n\n/**\n * creates a new node in the tree, attaching it as a child of the provided parent node\n * if the specified depth matches the parent depth, adds the new node as a _sibling_ of the parent instead\n  * @param {TreeNode} parent the parent node to add a new node to (if the parent depth matches the provided `depth` value, will instead add as a sibling of this\n  * @param {string} key the key that the new node represents (key here being part of the path being redacted)\n  * @param {number} depth the depth of the new node in the tree - used to determing whether to add the new node as a child or sibling of the provided `parent` node\n  * @returns {TreeNode} a reference to the newly created node in the tree\n */\nfunction node (parent, key, depth) {\n  if (parent.depth === depth) {\n    return node(parent.parent, key, depth)\n  }\n\n  var child = {\n    parent,\n    key,\n    depth,\n    children: []\n  }\n\n  parent.children.push(child)\n\n  return child\n}\n\n/**\n * @typedef {object} RestoreInstruction\n * @prop {string[]} path a reverse-order path that can be used to find the correct insertion point to restore a `value` for the given `parent` object\n * @prop {*} value the value to restore\n * @prop {object} target the object to restore the `value` in\n */\n\n/**\n * create a restore instruction for the given redactPath node\n * generates a path in reverse order by walking up the redactPath tree\n * @param {TreeNode} node a tree node that should be at the bottom of the redact path (i.e. have no children) - this will be used to walk up the redact path tree to construct the path needed to restore\n * @param {*} value the value to restore\n * @param {object} target a reference to the parent object to apply the restore instruction to\n * @returns {RestoreInstruction} an instruction used to restore a nested value for a specific object\n */\nfunction restoreInstr (node, value, target) {\n  let current = node\n  const path = []\n  do {\n    path.push(current.key)\n    current = current.parent\n  } while (current.parent != null)\n\n  return { path, value, target }\n}\n","'use strict'\n\nconst { groupRestore, nestedRestore } = require('./modifiers')\n\nmodule.exports = restorer\n\nfunction restorer () {\n  return function compileRestore () {\n    if (this.restore) {\n      this.restore.state.secret = this.secret\n      return\n    }\n    const { secret, wcLen } = this\n    const paths = Object.keys(secret)\n    const resetters = resetTmpl(secret, paths)\n    const hasWildcards = wcLen > 0\n    const state = hasWildcards ? { secret, groupRestore, nestedRestore } : { secret }\n    /* eslint-disable-next-line */\n    this.restore = Function(\n      'o',\n      restoreTmpl(resetters, paths, hasWildcards)\n    ).bind(state)\n    this.restore.state = state\n  }\n}\n\n/**\n * Mutates the original object to be censored by restoring its original values\n * prior to censoring.\n *\n * @param {object} secret Compiled object describing which target fields should\n * be censored and the field states.\n * @param {string[]} paths The list of paths to censor as provided at\n * initialization time.\n *\n * @returns {string} String of JavaScript to be used by `Function()`. The\n * string compiles to the function that does the work in the description.\n */\nfunction resetTmpl (secret, paths) {\n  return paths.map((path) => {\n    const { circle, escPath, leadingBracket } = secret[path]\n    const delim = leadingBracket ? '' : '.'\n    const reset = circle\n      ? `o.${circle} = secret[${escPath}].val`\n      : `o${delim}${path} = secret[${escPath}].val`\n    const clear = `secret[${escPath}].val = undefined`\n    return `\n      if (secret[${escPath}].val !== undefined) {\n        try { ${reset} } catch (e) {}\n        ${clear}\n      }\n    `\n  }).join('')\n}\n\n/**\n * Creates the body of the restore function\n *\n * Restoration of the redacted object happens\n * backwards, in reverse order of redactions,\n * so that repeated redactions on the same object\n * property can be eventually rolled back to the\n * original value.\n *\n * This way dynamic redactions are restored first,\n * starting from the last one working backwards and\n * followed by the static ones.\n *\n * @returns {string} the body of the restore function\n */\nfunction restoreTmpl (resetters, paths, hasWildcards) {\n  const dynamicReset = hasWildcards === true ? `\n    const keys = Object.keys(secret)\n    const len = keys.length\n    for (var i = len - 1; i >= ${paths.length}; i--) {\n      const k = keys[i]\n      const o = secret[k]\n      if (o) {\n        if (o.flat === true) this.groupRestore(o)\n        else this.nestedRestore(o)\n        secret[k] = null\n      }\n    }\n  ` : ''\n\n  return `\n    const secret = this.secret\n    ${dynamicReset}\n    ${resetters}\n    return o\n  `\n}\n","'use strict'\n\nmodule.exports = state\n\nfunction state (o) {\n  const {\n    secret,\n    censor,\n    compileRestore,\n    serialize,\n    groupRedact,\n    nestedRedact,\n    wildcards,\n    wcLen\n  } = o\n  const builder = [{ secret, censor, compileRestore }]\n  if (serialize !== false) builder.push({ serialize })\n  if (wcLen > 0) builder.push({ groupRedact, nestedRedact, wildcards, wcLen })\n  return Object.assign(...builder)\n}\n","'use strict'\n\nconst validator = require('./lib/validator')\nconst parse = require('./lib/parse')\nconst redactor = require('./lib/redactor')\nconst restorer = require('./lib/restorer')\nconst { groupRedact, nestedRedact } = require('./lib/modifiers')\nconst state = require('./lib/state')\nconst rx = require('./lib/rx')\nconst validate = validator()\nconst noop = (o) => o\nnoop.restore = noop\n\nconst DEFAULT_CENSOR = '[REDACTED]'\nfastRedact.rx = rx\nfastRedact.validator = validator\n\nmodule.exports = fastRedact\n\nfunction fastRedact (opts = {}) {\n  const paths = Array.from(new Set(opts.paths || []))\n  const serialize = 'serialize' in opts ? (\n    opts.serialize === false ? opts.serialize\n      : (typeof opts.serialize === 'function' ? opts.serialize : JSON.stringify)\n  ) : JSON.stringify\n  const remove = opts.remove\n  if (remove === true && serialize !== JSON.stringify) {\n    throw Error('fast-redact  remove option may only be set when serializer is JSON.stringify')\n  }\n  const censor = remove === true\n    ? undefined\n    : 'censor' in opts ? opts.censor : DEFAULT_CENSOR\n\n  const isCensorFct = typeof censor === 'function'\n  const censorFctTakesPath = isCensorFct && censor.length > 1\n\n  if (paths.length === 0) return serialize || noop\n\n  validate({ paths, serialize, censor })\n\n  const { wildcards, wcLen, secret } = parse({ paths, censor })\n\n  const compileRestore = restorer()\n  const strict = 'strict' in opts ? opts.strict : true\n\n  return redactor({ secret, wcLen, serialize, strict, isCensorFct, censorFctTakesPath }, state({\n    secret,\n    censor,\n    compileRestore,\n    serialize,\n    groupRedact,\n    nestedRedact,\n    wildcards,\n    wcLen\n  }))\n}\n","'use strict'\n\nconst setLevelSym = Symbol('pino.setLevel')\nconst getLevelSym = Symbol('pino.getLevel')\nconst levelValSym = Symbol('pino.levelVal')\nconst levelCompSym = Symbol('pino.levelComp')\nconst useLevelLabelsSym = Symbol('pino.useLevelLabels')\nconst useOnlyCustomLevelsSym = Symbol('pino.useOnlyCustomLevels')\nconst mixinSym = Symbol('pino.mixin')\n\nconst lsCacheSym = Symbol('pino.lsCache')\nconst chindingsSym = Symbol('pino.chindings')\n\nconst asJsonSym = Symbol('pino.asJson')\nconst writeSym = Symbol('pino.write')\nconst redactFmtSym = Symbol('pino.redactFmt')\n\nconst timeSym = Symbol('pino.time')\nconst timeSliceIndexSym = Symbol('pino.timeSliceIndex')\nconst streamSym = Symbol('pino.stream')\nconst stringifySym = Symbol('pino.stringify')\nconst stringifySafeSym = Symbol('pino.stringifySafe')\nconst stringifiersSym = Symbol('pino.stringifiers')\nconst endSym = Symbol('pino.end')\nconst formatOptsSym = Symbol('pino.formatOpts')\nconst messageKeySym = Symbol('pino.messageKey')\nconst errorKeySym = Symbol('pino.errorKey')\nconst nestedKeySym = Symbol('pino.nestedKey')\nconst nestedKeyStrSym = Symbol('pino.nestedKeyStr')\nconst mixinMergeStrategySym = Symbol('pino.mixinMergeStrategy')\nconst msgPrefixSym = Symbol('pino.msgPrefix')\n\nconst wildcardFirstSym = Symbol('pino.wildcardFirst')\n\n// public symbols, no need to use the same pino\n// version for these\nconst serializersSym = Symbol.for('pino.serializers')\nconst formattersSym = Symbol.for('pino.formatters')\nconst hooksSym = Symbol.for('pino.hooks')\nconst needsMetadataGsym = Symbol.for('pino.metadata')\n\nmodule.exports = {\n  setLevelSym,\n  getLevelSym,\n  levelValSym,\n  levelCompSym,\n  useLevelLabelsSym,\n  mixinSym,\n  lsCacheSym,\n  chindingsSym,\n  asJsonSym,\n  writeSym,\n  serializersSym,\n  redactFmtSym,\n  timeSym,\n  timeSliceIndexSym,\n  streamSym,\n  stringifySym,\n  stringifySafeSym,\n  stringifiersSym,\n  endSym,\n  formatOptsSym,\n  messageKeySym,\n  errorKeySym,\n  nestedKeySym,\n  wildcardFirstSym,\n  needsMetadataGsym,\n  useOnlyCustomLevelsSym,\n  formattersSym,\n  hooksSym,\n  nestedKeyStrSym,\n  mixinMergeStrategySym,\n  msgPrefixSym\n}\n","'use strict'\n\nconst fastRedact = require('fast-redact')\nconst { redactFmtSym, wildcardFirstSym } = require('./symbols')\nconst { rx, validator } = fastRedact\n\nconst validate = validator({\n  ERR_PATHS_MUST_BE_STRINGS: () => 'pino  redacted paths must be strings',\n  ERR_INVALID_PATH: (s) => `pino  redact paths array contains an invalid path (${s})`\n})\n\nconst CENSOR = '[Redacted]'\nconst strict = false // TODO should this be configurable?\n\nfunction redaction (opts, serialize) {\n  const { paths, censor } = handle(opts)\n\n  const shape = paths.reduce((o, str) => {\n    rx.lastIndex = 0\n    const first = rx.exec(str)\n    const next = rx.exec(str)\n\n    // ns is the top-level path segment, brackets + quoting removed.\n    let ns = first[1] !== undefined\n      ? first[1].replace(/^(?:\"|'|`)(.*)(?:\"|'|`)$/, '$1')\n      : first[0]\n\n    if (ns === '*') {\n      ns = wildcardFirstSym\n    }\n\n    // top level key:\n    if (next === null) {\n      o[ns] = null\n      return o\n    }\n\n    // path with at least two segments:\n    // if ns is already redacted at the top level, ignore lower level redactions\n    if (o[ns] === null) {\n      return o\n    }\n\n    const { index } = next\n    const nextPath = `${str.substr(index, str.length - 1)}`\n\n    o[ns] = o[ns] || []\n\n    // shape is a mix of paths beginning with literal values and wildcard\n    // paths [ \"a.b.c\", \"*.b.z\" ] should reduce to a shape of\n    // { \"a\": [ \"b.c\", \"b.z\" ], *: [ \"b.z\" ] }\n    // note: \"b.z\" is in both \"a\" and * arrays because \"a\" matches the wildcard.\n    // (* entry has wildcardFirstSym as key)\n    if (ns !== wildcardFirstSym && o[ns].length === 0) {\n      // first time ns's get all '*' redactions so far\n      o[ns].push(...(o[wildcardFirstSym] || []))\n    }\n\n    if (ns === wildcardFirstSym) {\n      // new * path gets added to all previously registered literal ns's.\n      Object.keys(o).forEach(function (k) {\n        if (o[k]) {\n          o[k].push(nextPath)\n        }\n      })\n    }\n\n    o[ns].push(nextPath)\n    return o\n  }, {})\n\n  // the redactor assigned to the format symbol key\n  // provides top level redaction for instances where\n  // an object is interpolated into the msg string\n  const result = {\n    [redactFmtSym]: fastRedact({ paths, censor, serialize, strict })\n  }\n\n  const topCensor = (...args) => {\n    return typeof censor === 'function' ? serialize(censor(...args)) : serialize(censor)\n  }\n\n  return [...Object.keys(shape), ...Object.getOwnPropertySymbols(shape)].reduce((o, k) => {\n    // top level key:\n    if (shape[k] === null) {\n      o[k] = (value) => topCensor(value, [k])\n    } else {\n      const wrappedCensor = typeof censor === 'function'\n        ? (value, path) => {\n            return censor(value, [k, ...path])\n          }\n        : censor\n      o[k] = fastRedact({\n        paths: shape[k],\n        censor: wrappedCensor,\n        serialize,\n        strict\n      })\n    }\n    return o\n  }, result)\n}\n\nfunction handle (opts) {\n  if (Array.isArray(opts)) {\n    opts = { paths: opts, censor: CENSOR }\n    validate(opts)\n    return opts\n  }\n  let { paths, censor = CENSOR, remove } = opts\n  if (Array.isArray(paths) === false) { throw Error('pino  redact must contain an array of strings') }\n  if (remove === true) censor = undefined\n  validate({ paths, censor })\n\n  return { paths, censor }\n}\n\nmodule.exports = redaction\n","'use strict'\n\nconst nullTime = () => ''\n\nconst epochTime = () => `,\"time\":${Date.now()}`\n\nconst unixTime = () => `,\"time\":${Math.round(Date.now() / 1000.0)}`\n\nconst isoTime = () => `,\"time\":\"${new Date(Date.now()).toISOString()}\"` // using Date.now() for testability\n\nmodule.exports = { nullTime, epochTime, unixTime, isoTime }\n","'use strict'\nfunction tryStringify (o) {\n  try { return JSON.stringify(o) } catch(e) { return '\"[Circular]\"' }\n}\n\nmodule.exports = format\n\nfunction format(f, args, opts) {\n  var ss = (opts && opts.stringify) || tryStringify\n  var offset = 1\n  if (typeof f === 'object' && f !== null) {\n    var len = args.length + offset\n    if (len === 1) return f\n    var objects = new Array(len)\n    objects[0] = ss(f)\n    for (var index = 1; index < len; index++) {\n      objects[index] = ss(args[index])\n    }\n    return objects.join(' ')\n  }\n  if (typeof f !== 'string') {\n    return f\n  }\n  var argLen = args.length\n  if (argLen === 0) return f\n  var str = ''\n  var a = 1 - offset\n  var lastPos = -1\n  var flen = (f && f.length) || 0\n  for (var i = 0; i < flen;) {\n    if (f.charCodeAt(i) === 37 && i + 1 < flen) {\n      lastPos = lastPos > -1 ? lastPos : 0\n      switch (f.charCodeAt(i + 1)) {\n        case 100: // 'd'\n        case 102: // 'f'\n          if (a >= argLen)\n            break\n          if (args[a] == null)  break\n          if (lastPos < i)\n            str += f.slice(lastPos, i)\n          str += Number(args[a])\n          lastPos = i + 2\n          i++\n          break\n        case 105: // 'i'\n          if (a >= argLen)\n            break\n          if (args[a] == null)  break\n          if (lastPos < i)\n            str += f.slice(lastPos, i)\n          str += Math.floor(Number(args[a]))\n          lastPos = i + 2\n          i++\n          break\n        case 79: // 'O'\n        case 111: // 'o'\n        case 106: // 'j'\n          if (a >= argLen)\n            break\n          if (args[a] === undefined) break\n          if (lastPos < i)\n            str += f.slice(lastPos, i)\n          var type = typeof args[a]\n          if (type === 'string') {\n            str += '\\'' + args[a] + '\\''\n            lastPos = i + 2\n            i++\n            break\n          }\n          if (type === 'function') {\n            str += args[a].name || '<anonymous>'\n            lastPos = i + 2\n            i++\n            break\n          }\n          str += ss(args[a])\n          lastPos = i + 2\n          i++\n          break\n        case 115: // 's'\n          if (a >= argLen)\n            break\n          if (lastPos < i)\n            str += f.slice(lastPos, i)\n          str += String(args[a])\n          lastPos = i + 2\n          i++\n          break\n        case 37: // '%'\n          if (lastPos < i)\n            str += f.slice(lastPos, i)\n          str += '%'\n          lastPos = i + 2\n          i++\n          a--\n          break\n      }\n      ++a\n    }\n    ++i\n  }\n  if (lastPos === -1)\n    return f\n  else if (lastPos < flen) {\n    str += f.slice(lastPos)\n  }\n\n  return str\n}\n","'use strict'\n\n/* global SharedArrayBuffer, Atomics */\n\nif (typeof SharedArrayBuffer !== 'undefined' && typeof Atomics !== 'undefined') {\n  const nil = new Int32Array(new SharedArrayBuffer(4))\n\n  function sleep (ms) {\n    // also filters out NaN, non-number types, including empty strings, but allows bigints\n    const valid = ms > 0 && ms < Infinity \n    if (valid === false) {\n      if (typeof ms !== 'number' && typeof ms !== 'bigint') {\n        throw TypeError('sleep: ms must be a number')\n      }\n      throw RangeError('sleep: ms must be a number that is greater than 0 but less than Infinity')\n    }\n\n    Atomics.wait(nil, 0, 0, Number(ms))\n  }\n  module.exports = sleep\n} else {\n\n  function sleep (ms) {\n    // also filters out NaN, non-number types, including empty strings, but allows bigints\n    const valid = ms > 0 && ms < Infinity \n    if (valid === false) {\n      if (typeof ms !== 'number' && typeof ms !== 'bigint') {\n        throw TypeError('sleep: ms must be a number')\n      }\n      throw RangeError('sleep: ms must be a number that is greater than 0 but less than Infinity')\n    }\n    const target = Date.now() + Number(ms)\n    while (target > Date.now()){}\n  }\n\n  module.exports = sleep\n\n}\n","'use strict'\n\nconst fs = require('fs')\nconst EventEmitter = require('events')\nconst inherits = require('util').inherits\nconst path = require('path')\nconst sleep = require('atomic-sleep')\nconst assert = require('assert')\n\nconst BUSY_WRITE_TIMEOUT = 100\nconst kEmptyBuffer = Buffer.allocUnsafe(0)\n\n// 16 KB. Don't write more than docker buffer size.\n// https://github.com/moby/moby/blob/513ec73831269947d38a644c278ce3cac36783b2/daemon/logger/copier.go#L13\nconst MAX_WRITE = 16 * 1024\n\nconst kContentModeBuffer = 'buffer'\nconst kContentModeUtf8 = 'utf8'\n\nconst [major, minor] = (process.versions.node || '0.0').split('.').map(Number)\nconst kCopyBuffer = major >= 22 && minor >= 7\n\nfunction openFile (file, sonic) {\n  sonic._opening = true\n  sonic._writing = true\n  sonic._asyncDrainScheduled = false\n\n  // NOTE: 'error' and 'ready' events emitted below only relevant when sonic.sync===false\n  // for sync mode, there is no way to add a listener that will receive these\n\n  function fileOpened (err, fd) {\n    if (err) {\n      sonic._reopening = false\n      sonic._writing = false\n      sonic._opening = false\n\n      if (sonic.sync) {\n        process.nextTick(() => {\n          if (sonic.listenerCount('error') > 0) {\n            sonic.emit('error', err)\n          }\n        })\n      } else {\n        sonic.emit('error', err)\n      }\n      return\n    }\n\n    const reopening = sonic._reopening\n\n    sonic.fd = fd\n    sonic.file = file\n    sonic._reopening = false\n    sonic._opening = false\n    sonic._writing = false\n\n    if (sonic.sync) {\n      process.nextTick(() => sonic.emit('ready'))\n    } else {\n      sonic.emit('ready')\n    }\n\n    if (sonic.destroyed) {\n      return\n    }\n\n    // start\n    if ((!sonic._writing && sonic._len > sonic.minLength) || sonic._flushPending) {\n      sonic._actualWrite()\n    } else if (reopening) {\n      process.nextTick(() => sonic.emit('drain'))\n    }\n  }\n\n  const flags = sonic.append ? 'a' : 'w'\n  const mode = sonic.mode\n\n  if (sonic.sync) {\n    try {\n      if (sonic.mkdir) fs.mkdirSync(path.dirname(file), { recursive: true })\n      const fd = fs.openSync(file, flags, mode)\n      fileOpened(null, fd)\n    } catch (err) {\n      fileOpened(err)\n      throw err\n    }\n  } else if (sonic.mkdir) {\n    fs.mkdir(path.dirname(file), { recursive: true }, (err) => {\n      if (err) return fileOpened(err)\n      fs.open(file, flags, mode, fileOpened)\n    })\n  } else {\n    fs.open(file, flags, mode, fileOpened)\n  }\n}\n\nfunction SonicBoom (opts) {\n  if (!(this instanceof SonicBoom)) {\n    return new SonicBoom(opts)\n  }\n\n  let { fd, dest, minLength, maxLength, maxWrite, periodicFlush, sync, append = true, mkdir, retryEAGAIN, fsync, contentMode, mode } = opts || {}\n\n  fd = fd || dest\n\n  this._len = 0\n  this.fd = -1\n  this._bufs = []\n  this._lens = []\n  this._writing = false\n  this._ending = false\n  this._reopening = false\n  this._asyncDrainScheduled = false\n  this._flushPending = false\n  this._hwm = Math.max(minLength || 0, 16387)\n  this.file = null\n  this.destroyed = false\n  this.minLength = minLength || 0\n  this.maxLength = maxLength || 0\n  this.maxWrite = maxWrite || MAX_WRITE\n  this._periodicFlush = periodicFlush || 0\n  this._periodicFlushTimer = undefined\n  this.sync = sync || false\n  this.writable = true\n  this._fsync = fsync || false\n  this.append = append || false\n  this.mode = mode\n  this.retryEAGAIN = retryEAGAIN || (() => true)\n  this.mkdir = mkdir || false\n\n  let fsWriteSync\n  let fsWrite\n  if (contentMode === kContentModeBuffer) {\n    this._writingBuf = kEmptyBuffer\n    this.write = writeBuffer\n    this.flush = flushBuffer\n    this.flushSync = flushBufferSync\n    this._actualWrite = actualWriteBuffer\n    fsWriteSync = () => fs.writeSync(this.fd, this._writingBuf)\n    fsWrite = () => fs.write(this.fd, this._writingBuf, this.release)\n  } else if (contentMode === undefined || contentMode === kContentModeUtf8) {\n    this._writingBuf = ''\n    this.write = write\n    this.flush = flush\n    this.flushSync = flushSync\n    this._actualWrite = actualWrite\n    fsWriteSync = () => fs.writeSync(this.fd, this._writingBuf, 'utf8')\n    fsWrite = () => fs.write(this.fd, this._writingBuf, 'utf8', this.release)\n  } else {\n    throw new Error(`SonicBoom supports \"${kContentModeUtf8}\" and \"${kContentModeBuffer}\", but passed ${contentMode}`)\n  }\n\n  if (typeof fd === 'number') {\n    this.fd = fd\n    process.nextTick(() => this.emit('ready'))\n  } else if (typeof fd === 'string') {\n    openFile(fd, this)\n  } else {\n    throw new Error('SonicBoom supports only file descriptors and files')\n  }\n  if (this.minLength >= this.maxWrite) {\n    throw new Error(`minLength should be smaller than maxWrite (${this.maxWrite})`)\n  }\n\n  this.release = (err, n) => {\n    if (err) {\n      if ((err.code === 'EAGAIN' || err.code === 'EBUSY') && this.retryEAGAIN(err, this._writingBuf.length, this._len - this._writingBuf.length)) {\n        if (this.sync) {\n          // This error code should not happen in sync mode, because it is\n          // not using the underlining operating system asynchronous functions.\n          // However it happens, and so we handle it.\n          // Ref: https://github.com/pinojs/pino/issues/783\n          try {\n            sleep(BUSY_WRITE_TIMEOUT)\n            this.release(undefined, 0)\n          } catch (err) {\n            this.release(err)\n          }\n        } else {\n          // Let's give the destination some time to process the chunk.\n          setTimeout(fsWrite, BUSY_WRITE_TIMEOUT)\n        }\n      } else {\n        this._writing = false\n\n        this.emit('error', err)\n      }\n      return\n    }\n\n    this.emit('write', n)\n    const releasedBufObj = releaseWritingBuf(this._writingBuf, this._len, n)\n    this._len = releasedBufObj.len\n    this._writingBuf = releasedBufObj.writingBuf\n\n    if (this._writingBuf.length) {\n      if (!this.sync) {\n        fsWrite()\n        return\n      }\n\n      try {\n        do {\n          const n = fsWriteSync()\n          const releasedBufObj = releaseWritingBuf(this._writingBuf, this._len, n)\n          this._len = releasedBufObj.len\n          this._writingBuf = releasedBufObj.writingBuf\n        } while (this._writingBuf.length)\n      } catch (err) {\n        this.release(err)\n        return\n      }\n    }\n\n    if (this._fsync) {\n      fs.fsyncSync(this.fd)\n    }\n\n    const len = this._len\n    if (this._reopening) {\n      this._writing = false\n      this._reopening = false\n      this.reopen()\n    } else if (len > this.minLength) {\n      this._actualWrite()\n    } else if (this._ending) {\n      if (len > 0) {\n        this._actualWrite()\n      } else {\n        this._writing = false\n        actualClose(this)\n      }\n    } else {\n      this._writing = false\n      if (this.sync) {\n        if (!this._asyncDrainScheduled) {\n          this._asyncDrainScheduled = true\n          process.nextTick(emitDrain, this)\n        }\n      } else {\n        this.emit('drain')\n      }\n    }\n  }\n\n  this.on('newListener', function (name) {\n    if (name === 'drain') {\n      this._asyncDrainScheduled = false\n    }\n  })\n\n  if (this._periodicFlush !== 0) {\n    this._periodicFlushTimer = setInterval(() => this.flush(null), this._periodicFlush)\n    this._periodicFlushTimer.unref()\n  }\n}\n\n/**\n * Release the writingBuf after fs.write n bytes data\n * @param {string | Buffer} writingBuf - currently writing buffer, usually be instance._writingBuf.\n * @param {number} len - currently buffer length, usually be instance._len.\n * @param {number} n - number of bytes fs already written\n * @returns {{writingBuf: string | Buffer, len: number}} released writingBuf and length\n */\nfunction releaseWritingBuf (writingBuf, len, n) {\n  // if Buffer.byteLength is equal to n, that means writingBuf contains no multi-byte character\n  if (typeof writingBuf === 'string' && Buffer.byteLength(writingBuf) !== n) {\n    // Since the fs.write callback parameter `n` means how many bytes the passed of string\n    // We calculate the original string length for avoiding the multi-byte character issue\n    n = Buffer.from(writingBuf).subarray(0, n).toString().length\n  }\n  len = Math.max(len - n, 0)\n  writingBuf = writingBuf.slice(n)\n  return { writingBuf, len }\n}\n\nfunction emitDrain (sonic) {\n  const hasListeners = sonic.listenerCount('drain') > 0\n  if (!hasListeners) return\n  sonic._asyncDrainScheduled = false\n  sonic.emit('drain')\n}\n\ninherits(SonicBoom, EventEmitter)\n\nfunction mergeBuf (bufs, len) {\n  if (bufs.length === 0) {\n    return kEmptyBuffer\n  }\n\n  if (bufs.length === 1) {\n    return bufs[0]\n  }\n\n  return Buffer.concat(bufs, len)\n}\n\nfunction write (data) {\n  if (this.destroyed) {\n    throw new Error('SonicBoom destroyed')\n  }\n\n  const len = this._len + data.length\n  const bufs = this._bufs\n\n  if (this.maxLength && len > this.maxLength) {\n    this.emit('drop', data)\n    return this._len < this._hwm\n  }\n\n  if (\n    bufs.length === 0 ||\n    bufs[bufs.length - 1].length + data.length > this.maxWrite\n  ) {\n    bufs.push('' + data)\n  } else {\n    bufs[bufs.length - 1] += data\n  }\n\n  this._len = len\n\n  if (!this._writing && this._len >= this.minLength) {\n    this._actualWrite()\n  }\n\n  return this._len < this._hwm\n}\n\nfunction writeBuffer (data) {\n  if (this.destroyed) {\n    throw new Error('SonicBoom destroyed')\n  }\n\n  const len = this._len + data.length\n  const bufs = this._bufs\n  const lens = this._lens\n\n  if (this.maxLength && len > this.maxLength) {\n    this.emit('drop', data)\n    return this._len < this._hwm\n  }\n\n  if (\n    bufs.length === 0 ||\n    lens[lens.length - 1] + data.length > this.maxWrite\n  ) {\n    bufs.push([data])\n    lens.push(data.length)\n  } else {\n    bufs[bufs.length - 1].push(data)\n    lens[lens.length - 1] += data.length\n  }\n\n  this._len = len\n\n  if (!this._writing && this._len >= this.minLength) {\n    this._actualWrite()\n  }\n\n  return this._len < this._hwm\n}\n\nfunction callFlushCallbackOnDrain (cb) {\n  this._flushPending = true\n  const onDrain = () => {\n    // only if _fsync is false to avoid double fsync\n    if (!this._fsync) {\n      try {\n        fs.fsync(this.fd, (err) => {\n          this._flushPending = false\n          cb(err)\n        })\n      } catch (err) {\n        cb(err)\n      }\n    } else {\n      this._flushPending = false\n      cb()\n    }\n    this.off('error', onError)\n  }\n  const onError = (err) => {\n    this._flushPending = false\n    cb(err)\n    this.off('drain', onDrain)\n  }\n\n  this.once('drain', onDrain)\n  this.once('error', onError)\n}\n\nfunction flush (cb) {\n  if (cb != null && typeof cb !== 'function') {\n    throw new Error('flush cb must be a function')\n  }\n\n  if (this.destroyed) {\n    const error = new Error('SonicBoom destroyed')\n    if (cb) {\n      cb(error)\n      return\n    }\n\n    throw error\n  }\n\n  if (this.minLength <= 0) {\n    cb?.()\n    return\n  }\n\n  if (cb) {\n    callFlushCallbackOnDrain.call(this, cb)\n  }\n\n  if (this._writing) {\n    return\n  }\n\n  if (this._bufs.length === 0) {\n    this._bufs.push('')\n  }\n\n  this._actualWrite()\n}\n\nfunction flushBuffer (cb) {\n  if (cb != null && typeof cb !== 'function') {\n    throw new Error('flush cb must be a function')\n  }\n\n  if (this.destroyed) {\n    const error = new Error('SonicBoom destroyed')\n    if (cb) {\n      cb(error)\n      return\n    }\n\n    throw error\n  }\n\n  if (this.minLength <= 0) {\n    cb?.()\n    return\n  }\n\n  if (cb) {\n    callFlushCallbackOnDrain.call(this, cb)\n  }\n\n  if (this._writing) {\n    return\n  }\n\n  if (this._bufs.length === 0) {\n    this._bufs.push([])\n    this._lens.push(0)\n  }\n\n  this._actualWrite()\n}\n\nSonicBoom.prototype.reopen = function (file) {\n  if (this.destroyed) {\n    throw new Error('SonicBoom destroyed')\n  }\n\n  if (this._opening) {\n    this.once('ready', () => {\n      this.reopen(file)\n    })\n    return\n  }\n\n  if (this._ending) {\n    return\n  }\n\n  if (!this.file) {\n    throw new Error('Unable to reopen a file descriptor, you must pass a file to SonicBoom')\n  }\n\n  if (file) {\n    this.file = file\n  }\n  this._reopening = true\n\n  if (this._writing) {\n    return\n  }\n\n  const fd = this.fd\n  this.once('ready', () => {\n    if (fd !== this.fd) {\n      fs.close(fd, (err) => {\n        if (err) {\n          return this.emit('error', err)\n        }\n      })\n    }\n  })\n\n  openFile(this.file, this)\n}\n\nSonicBoom.prototype.end = function () {\n  if (this.destroyed) {\n    throw new Error('SonicBoom destroyed')\n  }\n\n  if (this._opening) {\n    this.once('ready', () => {\n      this.end()\n    })\n    return\n  }\n\n  if (this._ending) {\n    return\n  }\n\n  this._ending = true\n\n  if (this._writing) {\n    return\n  }\n\n  if (this._len > 0 && this.fd >= 0) {\n    this._actualWrite()\n  } else {\n    actualClose(this)\n  }\n}\n\nfunction flushSync () {\n  if (this.destroyed) {\n    throw new Error('SonicBoom destroyed')\n  }\n\n  if (this.fd < 0) {\n    throw new Error('sonic boom is not ready yet')\n  }\n\n  if (!this._writing && this._writingBuf.length > 0) {\n    this._bufs.unshift(this._writingBuf)\n    this._writingBuf = ''\n  }\n\n  let buf = ''\n  while (this._bufs.length || buf) {\n    if (buf.length <= 0) {\n      buf = this._bufs[0]\n    }\n    try {\n      const n = fs.writeSync(this.fd, buf, 'utf8')\n      const releasedBufObj = releaseWritingBuf(buf, this._len, n)\n      buf = releasedBufObj.writingBuf\n      this._len = releasedBufObj.len\n      if (buf.length <= 0) {\n        this._bufs.shift()\n      }\n    } catch (err) {\n      const shouldRetry = err.code === 'EAGAIN' || err.code === 'EBUSY'\n      if (shouldRetry && !this.retryEAGAIN(err, buf.length, this._len - buf.length)) {\n        throw err\n      }\n\n      sleep(BUSY_WRITE_TIMEOUT)\n    }\n  }\n\n  try {\n    fs.fsyncSync(this.fd)\n  } catch {\n    // Skip the error. The fd might not support fsync.\n  }\n}\n\nfunction flushBufferSync () {\n  if (this.destroyed) {\n    throw new Error('SonicBoom destroyed')\n  }\n\n  if (this.fd < 0) {\n    throw new Error('sonic boom is not ready yet')\n  }\n\n  if (!this._writing && this._writingBuf.length > 0) {\n    this._bufs.unshift([this._writingBuf])\n    this._writingBuf = kEmptyBuffer\n  }\n\n  let buf = kEmptyBuffer\n  while (this._bufs.length || buf.length) {\n    if (buf.length <= 0) {\n      buf = mergeBuf(this._bufs[0], this._lens[0])\n    }\n    try {\n      const n = fs.writeSync(this.fd, buf)\n      buf = buf.subarray(n)\n      this._len = Math.max(this._len - n, 0)\n      if (buf.length <= 0) {\n        this._bufs.shift()\n        this._lens.shift()\n      }\n    } catch (err) {\n      const shouldRetry = err.code === 'EAGAIN' || err.code === 'EBUSY'\n      if (shouldRetry && !this.retryEAGAIN(err, buf.length, this._len - buf.length)) {\n        throw err\n      }\n\n      sleep(BUSY_WRITE_TIMEOUT)\n    }\n  }\n}\n\nSonicBoom.prototype.destroy = function () {\n  if (this.destroyed) {\n    return\n  }\n  actualClose(this)\n}\n\nfunction actualWrite () {\n  const release = this.release\n  this._writing = true\n  this._writingBuf = this._writingBuf || this._bufs.shift() || ''\n\n  if (this.sync) {\n    try {\n      const written = fs.writeSync(this.fd, this._writingBuf, 'utf8')\n      release(null, written)\n    } catch (err) {\n      release(err)\n    }\n  } else {\n    fs.write(this.fd, this._writingBuf, 'utf8', release)\n  }\n}\n\nfunction actualWriteBuffer () {\n  const release = this.release\n  this._writing = true\n  this._writingBuf = this._writingBuf.length ? this._writingBuf : mergeBuf(this._bufs.shift(), this._lens.shift())\n\n  if (this.sync) {\n    try {\n      const written = fs.writeSync(this.fd, this._writingBuf)\n      release(null, written)\n    } catch (err) {\n      release(err)\n    }\n  } else {\n    // fs.write will need to copy string to buffer anyway so\n    // we do it here to avoid the overhead of calculating the buffer size\n    // in releaseWritingBuf.\n    if (kCopyBuffer) {\n      this._writingBuf = Buffer.from(this._writingBuf)\n    }\n    fs.write(this.fd, this._writingBuf, release)\n  }\n}\n\nfunction actualClose (sonic) {\n  if (sonic.fd === -1) {\n    sonic.once('ready', actualClose.bind(null, sonic))\n    return\n  }\n\n  if (sonic._periodicFlushTimer !== undefined) {\n    clearInterval(sonic._periodicFlushTimer)\n  }\n\n  sonic.destroyed = true\n  sonic._bufs = []\n  sonic._lens = []\n\n  assert(typeof sonic.fd === 'number', `sonic.fd must be a number, got ${typeof sonic.fd}`)\n  try {\n    fs.fsync(sonic.fd, closeWrapped)\n  } catch {\n  }\n\n  function closeWrapped () {\n    // We skip errors in fsync\n\n    if (sonic.fd !== 1 && sonic.fd !== 2) {\n      fs.close(sonic.fd, done)\n    } else {\n      done()\n    }\n  }\n\n  function done (err) {\n    if (err) {\n      sonic.emit('error', err)\n      return\n    }\n\n    if (sonic._ending && !sonic._writing) {\n      sonic.emit('finish')\n    }\n    sonic.emit('close')\n  }\n}\n\n/**\n * These export configurations enable JS and TS developers\n * to consumer SonicBoom in whatever way best suits their needs.\n * Some examples of supported import syntax includes:\n * - `const SonicBoom = require('SonicBoom')`\n * - `const { SonicBoom } = require('SonicBoom')`\n * - `import * as SonicBoom from 'SonicBoom'`\n * - `import { SonicBoom } from 'SonicBoom'`\n * - `import SonicBoom from 'SonicBoom'`\n */\nSonicBoom.SonicBoom = SonicBoom\nSonicBoom.default = SonicBoom\nmodule.exports = SonicBoom\n","'use strict'\n\nconst refs = {\n  exit: [],\n  beforeExit: []\n}\nconst functions = {\n  exit: onExit,\n  beforeExit: onBeforeExit\n}\n\nlet registry\n\nfunction ensureRegistry () {\n  if (registry === undefined) {\n    registry = new FinalizationRegistry(clear)\n  }\n}\n\nfunction install (event) {\n  if (refs[event].length > 0) {\n    return\n  }\n\n  process.on(event, functions[event])\n}\n\nfunction uninstall (event) {\n  if (refs[event].length > 0) {\n    return\n  }\n  process.removeListener(event, functions[event])\n  if (refs.exit.length === 0 && refs.beforeExit.length === 0) {\n    registry = undefined\n  }\n}\n\nfunction onExit () {\n  callRefs('exit')\n}\n\nfunction onBeforeExit () {\n  callRefs('beforeExit')\n}\n\nfunction callRefs (event) {\n  for (const ref of refs[event]) {\n    const obj = ref.deref()\n    const fn = ref.fn\n\n    // This should always happen, however GC is\n    // undeterministic so it might not happen.\n    /* istanbul ignore else */\n    if (obj !== undefined) {\n      fn(obj, event)\n    }\n  }\n  refs[event] = []\n}\n\nfunction clear (ref) {\n  for (const event of ['exit', 'beforeExit']) {\n    const index = refs[event].indexOf(ref)\n    refs[event].splice(index, index + 1)\n    uninstall(event)\n  }\n}\n\nfunction _register (event, obj, fn) {\n  if (obj === undefined) {\n    throw new Error('the object can\\'t be undefined')\n  }\n  install(event)\n  const ref = new WeakRef(obj)\n  ref.fn = fn\n\n  ensureRegistry()\n  registry.register(obj, ref)\n  refs[event].push(ref)\n}\n\nfunction register (obj, fn) {\n  _register('exit', obj, fn)\n}\n\nfunction registerBeforeExit (obj, fn) {\n  _register('beforeExit', obj, fn)\n}\n\nfunction unregister (obj) {\n  if (registry === undefined) {\n    return\n  }\n  registry.unregister(obj)\n  for (const event of ['exit', 'beforeExit']) {\n    refs[event] = refs[event].filter((ref) => {\n      const _obj = ref.deref()\n      return _obj && _obj !== obj\n    })\n    uninstall(event)\n  }\n}\n\nmodule.exports = {\n  register,\n  registerBeforeExit,\n  unregister\n}\n","{\n  \"name\": \"thread-stream\",\n  \"version\": \"3.1.0\",\n  \"description\": \"A streaming way to send data to a Node.js Worker Thread\",\n  \"main\": \"index.js\",\n  \"types\": \"index.d.ts\",\n  \"dependencies\": {\n    \"real-require\": \"^0.2.0\"\n  },\n  \"devDependencies\": {\n    \"@types/node\": \"^20.1.0\",\n    \"@types/tap\": \"^15.0.0\",\n    \"@yao-pkg/pkg\": \"^5.11.5\",\n    \"desm\": \"^1.3.0\",\n    \"fastbench\": \"^1.0.1\",\n    \"husky\": \"^9.0.6\",\n    \"pino-elasticsearch\": \"^8.0.0\",\n    \"sonic-boom\": \"^4.0.1\",\n    \"standard\": \"^17.0.0\",\n    \"tap\": \"^16.2.0\",\n    \"ts-node\": \"^10.8.0\",\n    \"typescript\": \"^5.3.2\",\n    \"why-is-node-running\": \"^2.2.2\"\n  },\n  \"scripts\": {\n    \"build\": \"tsc --noEmit\",\n    \"test\": \"standard && npm run build && npm run transpile && tap \\\"test/**/*.test.*js\\\" && tap --ts test/*.test.*ts\",\n    \"test:ci\": \"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts\",\n    \"test:ci:js\": \"tap --no-check-coverage --timeout=120 --coverage-report=lcovonly \\\"test/**/*.test.*js\\\"\",\n    \"test:ci:ts\": \"tap --ts --no-check-coverage --coverage-report=lcovonly \\\"test/**/*.test.*ts\\\"\",\n    \"test:yarn\": \"npm run transpile && tap \\\"test/**/*.test.js\\\" --no-check-coverage\",\n    \"transpile\": \"sh ./test/ts/transpile.sh\",\n    \"prepare\": \"husky install\"\n  },\n  \"standard\": {\n    \"ignore\": [\n      \"test/ts/**/*\",\n      \"test/syntax-error.mjs\"\n    ]\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/mcollina/thread-stream.git\"\n  },\n  \"keywords\": [\n    \"worker\",\n    \"thread\",\n    \"threads\",\n    \"stream\"\n  ],\n  \"author\": \"Matteo Collina <hello@matteocollina.com>\",\n  \"license\": \"MIT\",\n  \"bugs\": {\n    \"url\": \"https://github.com/mcollina/thread-stream/issues\"\n  },\n  \"homepage\": \"https://github.com/mcollina/thread-stream#readme\"\n}\n","'use strict'\n\nconst MAX_TIMEOUT = 1000\n\nfunction wait (state, index, expected, timeout, done) {\n  const max = Date.now() + timeout\n  let current = Atomics.load(state, index)\n  if (current === expected) {\n    done(null, 'ok')\n    return\n  }\n  let prior = current\n  const check = (backoff) => {\n    if (Date.now() > max) {\n      done(null, 'timed-out')\n    } else {\n      setTimeout(() => {\n        prior = current\n        current = Atomics.load(state, index)\n        if (current === prior) {\n          check(backoff >= MAX_TIMEOUT ? MAX_TIMEOUT : backoff * 2)\n        } else {\n          if (current === expected) done(null, 'ok')\n          else done(null, 'not-equal')\n        }\n      }, backoff)\n    }\n  }\n  check(1)\n}\n\n// let waitDiffCount = 0\nfunction waitDiff (state, index, expected, timeout, done) {\n  // const id = waitDiffCount++\n  // process._rawDebug(`>>> waitDiff ${id}`)\n  const max = Date.now() + timeout\n  let current = Atomics.load(state, index)\n  if (current !== expected) {\n    done(null, 'ok')\n    return\n  }\n  const check = (backoff) => {\n    // process._rawDebug(`${id} ${index} current ${current} expected ${expected}`)\n    // process._rawDebug('' + backoff)\n    if (Date.now() > max) {\n      done(null, 'timed-out')\n    } else {\n      setTimeout(() => {\n        current = Atomics.load(state, index)\n        if (current !== expected) {\n          done(null, 'ok')\n        } else {\n          check(backoff >= MAX_TIMEOUT ? MAX_TIMEOUT : backoff * 2)\n        }\n      }, backoff)\n    }\n  }\n  check(1)\n}\n\nmodule.exports = { wait, waitDiff }\n","'use strict'\n\nconst WRITE_INDEX = 4\nconst READ_INDEX = 8\n\nmodule.exports = {\n  WRITE_INDEX,\n  READ_INDEX\n}\n","'use strict'\n\nconst { version } = require('./package.json')\nconst { EventEmitter } = require('events')\nconst { Worker } = require('worker_threads')\nconst { join } = require('path')\nconst { pathToFileURL } = require('url')\nconst { wait } = require('./lib/wait')\nconst {\n  WRITE_INDEX,\n  READ_INDEX\n} = require('./lib/indexes')\nconst buffer = require('buffer')\nconst assert = require('assert')\n\nconst kImpl = Symbol('kImpl')\n\n// V8 limit for string size\nconst MAX_STRING = buffer.constants.MAX_STRING_LENGTH\n\nclass FakeWeakRef {\n  constructor (value) {\n    this._value = value\n  }\n\n  deref () {\n    return this._value\n  }\n}\n\nclass FakeFinalizationRegistry {\n  register () {}\n\n  unregister () {}\n}\n\n// Currently using FinalizationRegistry with code coverage breaks the world\n// Ref: https://github.com/nodejs/node/issues/49344\nconst FinalizationRegistry = process.env.NODE_V8_COVERAGE ? FakeFinalizationRegistry : global.FinalizationRegistry || FakeFinalizationRegistry\nconst WeakRef = process.env.NODE_V8_COVERAGE ? FakeWeakRef : global.WeakRef || FakeWeakRef\n\nconst registry = new FinalizationRegistry((worker) => {\n  if (worker.exited) {\n    return\n  }\n  worker.terminate()\n})\n\nfunction createWorker (stream, opts) {\n  const { filename, workerData } = opts\n\n  const bundlerOverrides = '__bundlerPathsOverrides' in globalThis ? globalThis.__bundlerPathsOverrides : {}\n  const toExecute = bundlerOverrides['thread-stream-worker'] || join(__dirname, 'lib', 'worker.js')\n\n  const worker = new Worker(toExecute, {\n    ...opts.workerOpts,\n    trackUnmanagedFds: false,\n    workerData: {\n      filename: filename.indexOf('file://') === 0\n        ? filename\n        : pathToFileURL(filename).href,\n      dataBuf: stream[kImpl].dataBuf,\n      stateBuf: stream[kImpl].stateBuf,\n      workerData: {\n        $context: {\n          threadStreamVersion: version\n        },\n        ...workerData\n      }\n    }\n  })\n\n  // We keep a strong reference for now,\n  // we need to start writing first\n  worker.stream = new FakeWeakRef(stream)\n\n  worker.on('message', onWorkerMessage)\n  worker.on('exit', onWorkerExit)\n  registry.register(stream, worker)\n\n  return worker\n}\n\nfunction drain (stream) {\n  assert(!stream[kImpl].sync)\n  if (stream[kImpl].needDrain) {\n    stream[kImpl].needDrain = false\n    stream.emit('drain')\n  }\n}\n\nfunction nextFlush (stream) {\n  const writeIndex = Atomics.load(stream[kImpl].state, WRITE_INDEX)\n  let leftover = stream[kImpl].data.length - writeIndex\n\n  if (leftover > 0) {\n    if (stream[kImpl].buf.length === 0) {\n      stream[kImpl].flushing = false\n\n      if (stream[kImpl].ending) {\n        end(stream)\n      } else if (stream[kImpl].needDrain) {\n        process.nextTick(drain, stream)\n      }\n\n      return\n    }\n\n    let toWrite = stream[kImpl].buf.slice(0, leftover)\n    let toWriteBytes = Buffer.byteLength(toWrite)\n    if (toWriteBytes <= leftover) {\n      stream[kImpl].buf = stream[kImpl].buf.slice(leftover)\n      // process._rawDebug('writing ' + toWrite.length)\n      write(stream, toWrite, nextFlush.bind(null, stream))\n    } else {\n      // multi-byte utf-8\n      stream.flush(() => {\n        // err is already handled in flush()\n        if (stream.destroyed) {\n          return\n        }\n\n        Atomics.store(stream[kImpl].state, READ_INDEX, 0)\n        Atomics.store(stream[kImpl].state, WRITE_INDEX, 0)\n\n        // Find a toWrite length that fits the buffer\n        // it must exists as the buffer is at least 4 bytes length\n        // and the max utf-8 length for a char is 4 bytes.\n        while (toWriteBytes > stream[kImpl].data.length) {\n          leftover = leftover / 2\n          toWrite = stream[kImpl].buf.slice(0, leftover)\n          toWriteBytes = Buffer.byteLength(toWrite)\n        }\n        stream[kImpl].buf = stream[kImpl].buf.slice(leftover)\n        write(stream, toWrite, nextFlush.bind(null, stream))\n      })\n    }\n  } else if (leftover === 0) {\n    if (writeIndex === 0 && stream[kImpl].buf.length === 0) {\n      // we had a flushSync in the meanwhile\n      return\n    }\n    stream.flush(() => {\n      Atomics.store(stream[kImpl].state, READ_INDEX, 0)\n      Atomics.store(stream[kImpl].state, WRITE_INDEX, 0)\n      nextFlush(stream)\n    })\n  } else {\n    // This should never happen\n    destroy(stream, new Error('overwritten'))\n  }\n}\n\nfunction onWorkerMessage (msg) {\n  const stream = this.stream.deref()\n  if (stream === undefined) {\n    this.exited = true\n    // Terminate the worker.\n    this.terminate()\n    return\n  }\n\n  switch (msg.code) {\n    case 'READY':\n      // Replace the FakeWeakRef with a\n      // proper one.\n      this.stream = new WeakRef(stream)\n\n      stream.flush(() => {\n        stream[kImpl].ready = true\n        stream.emit('ready')\n      })\n      break\n    case 'ERROR':\n      destroy(stream, msg.err)\n      break\n    case 'EVENT':\n      if (Array.isArray(msg.args)) {\n        stream.emit(msg.name, ...msg.args)\n      } else {\n        stream.emit(msg.name, msg.args)\n      }\n      break\n    case 'WARNING':\n      process.emitWarning(msg.err)\n      break\n    default:\n      destroy(stream, new Error('this should not happen: ' + msg.code))\n  }\n}\n\nfunction onWorkerExit (code) {\n  const stream = this.stream.deref()\n  if (stream === undefined) {\n    // Nothing to do, the worker already exit\n    return\n  }\n  registry.unregister(stream)\n  stream.worker.exited = true\n  stream.worker.off('exit', onWorkerExit)\n  destroy(stream, code !== 0 ? new Error('the worker thread exited') : null)\n}\n\nclass ThreadStream extends EventEmitter {\n  constructor (opts = {}) {\n    super()\n\n    if (opts.bufferSize < 4) {\n      throw new Error('bufferSize must at least fit a 4-byte utf-8 char')\n    }\n\n    this[kImpl] = {}\n    this[kImpl].stateBuf = new SharedArrayBuffer(128)\n    this[kImpl].state = new Int32Array(this[kImpl].stateBuf)\n    this[kImpl].dataBuf = new SharedArrayBuffer(opts.bufferSize || 4 * 1024 * 1024)\n    this[kImpl].data = Buffer.from(this[kImpl].dataBuf)\n    this[kImpl].sync = opts.sync || false\n    this[kImpl].ending = false\n    this[kImpl].ended = false\n    this[kImpl].needDrain = false\n    this[kImpl].destroyed = false\n    this[kImpl].flushing = false\n    this[kImpl].ready = false\n    this[kImpl].finished = false\n    this[kImpl].errored = null\n    this[kImpl].closed = false\n    this[kImpl].buf = ''\n\n    // TODO (fix): Make private?\n    this.worker = createWorker(this, opts) // TODO (fix): make private\n    this.on('message', (message, transferList) => {\n      this.worker.postMessage(message, transferList)\n    })\n  }\n\n  write (data) {\n    if (this[kImpl].destroyed) {\n      error(this, new Error('the worker has exited'))\n      return false\n    }\n\n    if (this[kImpl].ending) {\n      error(this, new Error('the worker is ending'))\n      return false\n    }\n\n    if (this[kImpl].flushing && this[kImpl].buf.length + data.length >= MAX_STRING) {\n      try {\n        writeSync(this)\n        this[kImpl].flushing = true\n      } catch (err) {\n        destroy(this, err)\n        return false\n      }\n    }\n\n    this[kImpl].buf += data\n\n    if (this[kImpl].sync) {\n      try {\n        writeSync(this)\n        return true\n      } catch (err) {\n        destroy(this, err)\n        return false\n      }\n    }\n\n    if (!this[kImpl].flushing) {\n      this[kImpl].flushing = true\n      setImmediate(nextFlush, this)\n    }\n\n    this[kImpl].needDrain = this[kImpl].data.length - this[kImpl].buf.length - Atomics.load(this[kImpl].state, WRITE_INDEX) <= 0\n    return !this[kImpl].needDrain\n  }\n\n  end () {\n    if (this[kImpl].destroyed) {\n      return\n    }\n\n    this[kImpl].ending = true\n    end(this)\n  }\n\n  flush (cb) {\n    if (this[kImpl].destroyed) {\n      if (typeof cb === 'function') {\n        process.nextTick(cb, new Error('the worker has exited'))\n      }\n      return\n    }\n\n    // TODO write all .buf\n    const writeIndex = Atomics.load(this[kImpl].state, WRITE_INDEX)\n    // process._rawDebug(`(flush) readIndex (${Atomics.load(this.state, READ_INDEX)}) writeIndex (${Atomics.load(this.state, WRITE_INDEX)})`)\n    wait(this[kImpl].state, READ_INDEX, writeIndex, Infinity, (err, res) => {\n      if (err) {\n        destroy(this, err)\n        process.nextTick(cb, err)\n        return\n      }\n      if (res === 'not-equal') {\n        // TODO handle deadlock\n        this.flush(cb)\n        return\n      }\n      process.nextTick(cb)\n    })\n  }\n\n  flushSync () {\n    if (this[kImpl].destroyed) {\n      return\n    }\n\n    writeSync(this)\n    flushSync(this)\n  }\n\n  unref () {\n    this.worker.unref()\n  }\n\n  ref () {\n    this.worker.ref()\n  }\n\n  get ready () {\n    return this[kImpl].ready\n  }\n\n  get destroyed () {\n    return this[kImpl].destroyed\n  }\n\n  get closed () {\n    return this[kImpl].closed\n  }\n\n  get writable () {\n    return !this[kImpl].destroyed && !this[kImpl].ending\n  }\n\n  get writableEnded () {\n    return this[kImpl].ending\n  }\n\n  get writableFinished () {\n    return this[kImpl].finished\n  }\n\n  get writableNeedDrain () {\n    return this[kImpl].needDrain\n  }\n\n  get writableObjectMode () {\n    return false\n  }\n\n  get writableErrored () {\n    return this[kImpl].errored\n  }\n}\n\nfunction error (stream, err) {\n  setImmediate(() => {\n    stream.emit('error', err)\n  })\n}\n\nfunction destroy (stream, err) {\n  if (stream[kImpl].destroyed) {\n    return\n  }\n  stream[kImpl].destroyed = true\n\n  if (err) {\n    stream[kImpl].errored = err\n    error(stream, err)\n  }\n\n  if (!stream.worker.exited) {\n    stream.worker.terminate()\n      .catch(() => {})\n      .then(() => {\n        stream[kImpl].closed = true\n        stream.emit('close')\n      })\n  } else {\n    setImmediate(() => {\n      stream[kImpl].closed = true\n      stream.emit('close')\n    })\n  }\n}\n\nfunction write (stream, data, cb) {\n  // data is smaller than the shared buffer length\n  const current = Atomics.load(stream[kImpl].state, WRITE_INDEX)\n  const length = Buffer.byteLength(data)\n  stream[kImpl].data.write(data, current)\n  Atomics.store(stream[kImpl].state, WRITE_INDEX, current + length)\n  Atomics.notify(stream[kImpl].state, WRITE_INDEX)\n  cb()\n  return true\n}\n\nfunction end (stream) {\n  if (stream[kImpl].ended || !stream[kImpl].ending || stream[kImpl].flushing) {\n    return\n  }\n  stream[kImpl].ended = true\n\n  try {\n    stream.flushSync()\n\n    let readIndex = Atomics.load(stream[kImpl].state, READ_INDEX)\n\n    // process._rawDebug('writing index')\n    Atomics.store(stream[kImpl].state, WRITE_INDEX, -1)\n    // process._rawDebug(`(end) readIndex (${Atomics.load(stream.state, READ_INDEX)}) writeIndex (${Atomics.load(stream.state, WRITE_INDEX)})`)\n    Atomics.notify(stream[kImpl].state, WRITE_INDEX)\n\n    // Wait for the process to complete\n    let spins = 0\n    while (readIndex !== -1) {\n      // process._rawDebug(`read = ${read}`)\n      Atomics.wait(stream[kImpl].state, READ_INDEX, readIndex, 1000)\n      readIndex = Atomics.load(stream[kImpl].state, READ_INDEX)\n\n      if (readIndex === -2) {\n        destroy(stream, new Error('end() failed'))\n        return\n      }\n\n      if (++spins === 10) {\n        destroy(stream, new Error('end() took too long (10s)'))\n        return\n      }\n    }\n\n    process.nextTick(() => {\n      stream[kImpl].finished = true\n      stream.emit('finish')\n    })\n  } catch (err) {\n    destroy(stream, err)\n  }\n  // process._rawDebug('end finished...')\n}\n\nfunction writeSync (stream) {\n  const cb = () => {\n    if (stream[kImpl].ending) {\n      end(stream)\n    } else if (stream[kImpl].needDrain) {\n      process.nextTick(drain, stream)\n    }\n  }\n  stream[kImpl].flushing = false\n\n  while (stream[kImpl].buf.length !== 0) {\n    const writeIndex = Atomics.load(stream[kImpl].state, WRITE_INDEX)\n    let leftover = stream[kImpl].data.length - writeIndex\n    if (leftover === 0) {\n      flushSync(stream)\n      Atomics.store(stream[kImpl].state, READ_INDEX, 0)\n      Atomics.store(stream[kImpl].state, WRITE_INDEX, 0)\n      continue\n    } else if (leftover < 0) {\n      // stream should never happen\n      throw new Error('overwritten')\n    }\n\n    let toWrite = stream[kImpl].buf.slice(0, leftover)\n    let toWriteBytes = Buffer.byteLength(toWrite)\n    if (toWriteBytes <= leftover) {\n      stream[kImpl].buf = stream[kImpl].buf.slice(leftover)\n      // process._rawDebug('writing ' + toWrite.length)\n      write(stream, toWrite, cb)\n    } else {\n      // multi-byte utf-8\n      flushSync(stream)\n      Atomics.store(stream[kImpl].state, READ_INDEX, 0)\n      Atomics.store(stream[kImpl].state, WRITE_INDEX, 0)\n\n      // Find a toWrite length that fits the buffer\n      // it must exists as the buffer is at least 4 bytes length\n      // and the max utf-8 length for a char is 4 bytes.\n      while (toWriteBytes > stream[kImpl].buf.length) {\n        leftover = leftover / 2\n        toWrite = stream[kImpl].buf.slice(0, leftover)\n        toWriteBytes = Buffer.byteLength(toWrite)\n      }\n      stream[kImpl].buf = stream[kImpl].buf.slice(leftover)\n      write(stream, toWrite, cb)\n    }\n  }\n}\n\nfunction flushSync (stream) {\n  if (stream[kImpl].flushing) {\n    throw new Error('unable to flush while flushing')\n  }\n\n  // process._rawDebug('flushSync started')\n\n  const writeIndex = Atomics.load(stream[kImpl].state, WRITE_INDEX)\n\n  let spins = 0\n\n  // TODO handle deadlock\n  while (true) {\n    const readIndex = Atomics.load(stream[kImpl].state, READ_INDEX)\n\n    if (readIndex === -2) {\n      throw Error('_flushSync failed')\n    }\n\n    // process._rawDebug(`(flushSync) readIndex (${readIndex}) writeIndex (${writeIndex})`)\n    if (readIndex !== writeIndex) {\n      // TODO stream timeouts for some reason.\n      Atomics.wait(stream[kImpl].state, READ_INDEX, readIndex, 1000)\n    } else {\n      break\n    }\n\n    if (++spins === 10) {\n      throw new Error('_flushSync took too long (10s)')\n    }\n  }\n  // process._rawDebug('flushSync finished')\n}\n\nmodule.exports = ThreadStream\n","'use strict'\n\nconst { createRequire } = require('module')\nconst getCallers = require('./caller')\nconst { join, isAbsolute, sep } = require('node:path')\nconst sleep = require('atomic-sleep')\nconst onExit = require('on-exit-leak-free')\nconst ThreadStream = require('thread-stream')\n\nfunction setupOnExit (stream) {\n  // This is leak free, it does not leave event handlers\n  onExit.register(stream, autoEnd)\n  onExit.registerBeforeExit(stream, flush)\n\n  stream.on('close', function () {\n    onExit.unregister(stream)\n  })\n}\n\nfunction buildStream (filename, workerData, workerOpts, sync) {\n  const stream = new ThreadStream({\n    filename,\n    workerData,\n    workerOpts,\n    sync\n  })\n\n  stream.on('ready', onReady)\n  stream.on('close', function () {\n    process.removeListener('exit', onExit)\n  })\n\n  process.on('exit', onExit)\n\n  function onReady () {\n    process.removeListener('exit', onExit)\n    stream.unref()\n\n    if (workerOpts.autoEnd !== false) {\n      setupOnExit(stream)\n    }\n  }\n\n  function onExit () {\n    /* istanbul ignore next */\n    if (stream.closed) {\n      return\n    }\n    stream.flushSync()\n    // Apparently there is a very sporadic race condition\n    // that in certain OS would prevent the messages to be flushed\n    // because the thread might not have been created still.\n    // Unfortunately we need to sleep(100) in this case.\n    sleep(100)\n    stream.end()\n  }\n\n  return stream\n}\n\nfunction autoEnd (stream) {\n  stream.ref()\n  stream.flushSync()\n  stream.end()\n  stream.once('close', function () {\n    stream.unref()\n  })\n}\n\nfunction flush (stream) {\n  stream.flushSync()\n}\n\nfunction transport (fullOptions) {\n  const { pipeline, targets, levels, dedupe, worker = {}, caller = getCallers(), sync = false } = fullOptions\n\n  const options = {\n    ...fullOptions.options\n  }\n\n  // Backwards compatibility\n  const callers = typeof caller === 'string' ? [caller] : caller\n\n  // This will be eventually modified by bundlers\n  const bundlerOverrides = '__bundlerPathsOverrides' in globalThis ? globalThis.__bundlerPathsOverrides : {}\n\n  let target = fullOptions.target\n\n  if (target && targets) {\n    throw new Error('only one of target or targets can be specified')\n  }\n\n  if (targets) {\n    target = bundlerOverrides['pino-worker'] || join(__dirname, 'worker.js')\n    options.targets = targets.filter(dest => dest.target).map((dest) => {\n      return {\n        ...dest,\n        target: fixTarget(dest.target)\n      }\n    })\n    options.pipelines = targets.filter(dest => dest.pipeline).map((dest) => {\n      return dest.pipeline.map((t) => {\n        return {\n          ...t,\n          level: dest.level, // duplicate the pipeline `level` property defined in the upper level\n          target: fixTarget(t.target)\n        }\n      })\n    })\n  } else if (pipeline) {\n    target = bundlerOverrides['pino-worker'] || join(__dirname, 'worker.js')\n    options.pipelines = [pipeline.map((dest) => {\n      return {\n        ...dest,\n        target: fixTarget(dest.target)\n      }\n    })]\n  }\n\n  if (levels) {\n    options.levels = levels\n  }\n\n  if (dedupe) {\n    options.dedupe = dedupe\n  }\n\n  options.pinoWillSendConfig = true\n\n  return buildStream(fixTarget(target), options, worker, sync)\n\n  function fixTarget (origin) {\n    origin = bundlerOverrides[origin] || origin\n\n    if (isAbsolute(origin) || origin.indexOf('file://') === 0) {\n      return origin\n    }\n\n    if (origin === 'pino/file') {\n      return join(__dirname, '..', 'file.js')\n    }\n\n    let fixTarget\n\n    for (const filePath of callers) {\n      try {\n        const context = filePath === 'node:repl'\n          ? process.cwd() + sep\n          : filePath\n\n        fixTarget = createRequire(context).resolve(origin)\n        break\n      } catch (err) {\n        // Silent catch\n        continue\n      }\n    }\n\n    if (!fixTarget) {\n      throw new Error(`unable to determine transport target for \"${origin}\"`)\n    }\n\n    return fixTarget\n  }\n}\n\nmodule.exports = transport\n","'use strict'\n\n/* eslint no-prototype-builtins: 0 */\n\nconst format = require('quick-format-unescaped')\nconst { mapHttpRequest, mapHttpResponse } = require('pino-std-serializers')\nconst SonicBoom = require('sonic-boom')\nconst onExit = require('on-exit-leak-free')\nconst {\n  lsCacheSym,\n  chindingsSym,\n  writeSym,\n  serializersSym,\n  formatOptsSym,\n  endSym,\n  stringifiersSym,\n  stringifySym,\n  stringifySafeSym,\n  wildcardFirstSym,\n  nestedKeySym,\n  formattersSym,\n  messageKeySym,\n  errorKeySym,\n  nestedKeyStrSym,\n  msgPrefixSym\n} = require('./symbols')\nconst { isMainThread } = require('worker_threads')\nconst transport = require('./transport')\n\nfunction noop () {\n}\n\nfunction genLog (level, hook) {\n  if (!hook) return LOG\n\n  return function hookWrappedLog (...args) {\n    hook.call(this, args, LOG, level)\n  }\n\n  function LOG (o, ...n) {\n    if (typeof o === 'object') {\n      let msg = o\n      if (o !== null) {\n        if (o.method && o.headers && o.socket) {\n          o = mapHttpRequest(o)\n        } else if (typeof o.setHeader === 'function') {\n          o = mapHttpResponse(o)\n        }\n      }\n      let formatParams\n      if (msg === null && n.length === 0) {\n        formatParams = [null]\n      } else {\n        msg = n.shift()\n        formatParams = n\n      }\n      // We do not use a coercive check for `msg` as it is\n      // measurably slower than the explicit checks.\n      if (typeof this[msgPrefixSym] === 'string' && msg !== undefined && msg !== null) {\n        msg = this[msgPrefixSym] + msg\n      }\n      this[writeSym](o, format(msg, formatParams, this[formatOptsSym]), level)\n    } else {\n      let msg = o === undefined ? n.shift() : o\n\n      // We do not use a coercive check for `msg` as it is\n      // measurably slower than the explicit checks.\n      if (typeof this[msgPrefixSym] === 'string' && msg !== undefined && msg !== null) {\n        msg = this[msgPrefixSym] + msg\n      }\n      this[writeSym](null, format(msg, n, this[formatOptsSym]), level)\n    }\n  }\n}\n\n// magically escape strings for json\n// relying on their charCodeAt\n// everything below 32 needs JSON.stringify()\n// 34 and 92 happens all the time, so we\n// have a fast case for them\nfunction asString (str) {\n  let result = ''\n  let last = 0\n  let found = false\n  let point = 255\n  const l = str.length\n  if (l > 100) {\n    return JSON.stringify(str)\n  }\n  for (var i = 0; i < l && point >= 32; i++) {\n    point = str.charCodeAt(i)\n    if (point === 34 || point === 92) {\n      result += str.slice(last, i) + '\\\\'\n      last = i\n      found = true\n    }\n  }\n  if (!found) {\n    result = str\n  } else {\n    result += str.slice(last)\n  }\n  return point < 32 ? JSON.stringify(str) : '\"' + result + '\"'\n}\n\nfunction asJson (obj, msg, num, time) {\n  const stringify = this[stringifySym]\n  const stringifySafe = this[stringifySafeSym]\n  const stringifiers = this[stringifiersSym]\n  const end = this[endSym]\n  const chindings = this[chindingsSym]\n  const serializers = this[serializersSym]\n  const formatters = this[formattersSym]\n  const messageKey = this[messageKeySym]\n  const errorKey = this[errorKeySym]\n  let data = this[lsCacheSym][num] + time\n\n  // we need the child bindings added to the output first so instance logged\n  // objects can take precedence when JSON.parse-ing the resulting log line\n  data = data + chindings\n\n  let value\n  if (formatters.log) {\n    obj = formatters.log(obj)\n  }\n  const wildcardStringifier = stringifiers[wildcardFirstSym]\n  let propStr = ''\n  for (const key in obj) {\n    value = obj[key]\n    if (Object.prototype.hasOwnProperty.call(obj, key) && value !== undefined) {\n      if (serializers[key]) {\n        value = serializers[key](value)\n      } else if (key === errorKey && serializers.err) {\n        value = serializers.err(value)\n      }\n\n      const stringifier = stringifiers[key] || wildcardStringifier\n\n      switch (typeof value) {\n        case 'undefined':\n        case 'function':\n          continue\n        case 'number':\n          /* eslint no-fallthrough: \"off\" */\n          if (Number.isFinite(value) === false) {\n            value = null\n          }\n        // this case explicitly falls through to the next one\n        case 'boolean':\n          if (stringifier) value = stringifier(value)\n          break\n        case 'string':\n          value = (stringifier || asString)(value)\n          break\n        default:\n          value = (stringifier || stringify)(value, stringifySafe)\n      }\n      if (value === undefined) continue\n      const strKey = asString(key)\n      propStr += ',' + strKey + ':' + value\n    }\n  }\n\n  let msgStr = ''\n  if (msg !== undefined) {\n    value = serializers[messageKey] ? serializers[messageKey](msg) : msg\n    const stringifier = stringifiers[messageKey] || wildcardStringifier\n\n    switch (typeof value) {\n      case 'function':\n        break\n      case 'number':\n        /* eslint no-fallthrough: \"off\" */\n        if (Number.isFinite(value) === false) {\n          value = null\n        }\n      // this case explicitly falls through to the next one\n      case 'boolean':\n        if (stringifier) value = stringifier(value)\n        msgStr = ',\"' + messageKey + '\":' + value\n        break\n      case 'string':\n        value = (stringifier || asString)(value)\n        msgStr = ',\"' + messageKey + '\":' + value\n        break\n      default:\n        value = (stringifier || stringify)(value, stringifySafe)\n        msgStr = ',\"' + messageKey + '\":' + value\n    }\n  }\n\n  if (this[nestedKeySym] && propStr) {\n    // place all the obj properties under the specified key\n    // the nested key is already formatted from the constructor\n    return data + this[nestedKeyStrSym] + propStr.slice(1) + '}' + msgStr + end\n  } else {\n    return data + propStr + msgStr + end\n  }\n}\n\nfunction asChindings (instance, bindings) {\n  let value\n  let data = instance[chindingsSym]\n  const stringify = instance[stringifySym]\n  const stringifySafe = instance[stringifySafeSym]\n  const stringifiers = instance[stringifiersSym]\n  const wildcardStringifier = stringifiers[wildcardFirstSym]\n  const serializers = instance[serializersSym]\n  const formatter = instance[formattersSym].bindings\n  bindings = formatter(bindings)\n\n  for (const key in bindings) {\n    value = bindings[key]\n    const valid = key !== 'level' &&\n      key !== 'serializers' &&\n      key !== 'formatters' &&\n      key !== 'customLevels' &&\n      bindings.hasOwnProperty(key) &&\n      value !== undefined\n    if (valid === true) {\n      value = serializers[key] ? serializers[key](value) : value\n      value = (stringifiers[key] || wildcardStringifier || stringify)(value, stringifySafe)\n      if (value === undefined) continue\n      data += ',\"' + key + '\":' + value\n    }\n  }\n  return data\n}\n\nfunction hasBeenTampered (stream) {\n  return stream.write !== stream.constructor.prototype.write\n}\n\nfunction buildSafeSonicBoom (opts) {\n  const stream = new SonicBoom(opts)\n  stream.on('error', filterBrokenPipe)\n  // If we are sync: false, we must flush on exit\n  if (!opts.sync && isMainThread) {\n    onExit.register(stream, autoEnd)\n\n    stream.on('close', function () {\n      onExit.unregister(stream)\n    })\n  }\n  return stream\n\n  function filterBrokenPipe (err) {\n    // Impossible to replicate across all operating systems\n    /* istanbul ignore next */\n    if (err.code === 'EPIPE') {\n      // If we get EPIPE, we should stop logging here\n      // however we have no control to the consumer of\n      // SonicBoom, so we just overwrite the write method\n      stream.write = noop\n      stream.end = noop\n      stream.flushSync = noop\n      stream.destroy = noop\n      return\n    }\n    stream.removeListener('error', filterBrokenPipe)\n    stream.emit('error', err)\n  }\n}\n\nfunction autoEnd (stream, eventName) {\n  // This check is needed only on some platforms\n  /* istanbul ignore next */\n  if (stream.destroyed) {\n    return\n  }\n\n  if (eventName === 'beforeExit') {\n    // We still have an event loop, let's use it\n    stream.flush()\n    stream.on('drain', function () {\n      stream.end()\n    })\n  } else {\n    // For some reason istanbul is not detecting this, but it's there\n    /* istanbul ignore next */\n    // We do not have an event loop, so flush synchronously\n    stream.flushSync()\n  }\n}\n\nfunction createArgsNormalizer (defaultOptions) {\n  return function normalizeArgs (instance, caller, opts = {}, stream) {\n    // support stream as a string\n    if (typeof opts === 'string') {\n      stream = buildSafeSonicBoom({ dest: opts })\n      opts = {}\n    } else if (typeof stream === 'string') {\n      if (opts && opts.transport) {\n        throw Error('only one of option.transport or stream can be specified')\n      }\n      stream = buildSafeSonicBoom({ dest: stream })\n    } else if (opts instanceof SonicBoom || opts.writable || opts._writableState) {\n      stream = opts\n      opts = {}\n    } else if (opts.transport) {\n      if (opts.transport instanceof SonicBoom || opts.transport.writable || opts.transport._writableState) {\n        throw Error('option.transport do not allow stream, please pass to option directly. e.g. pino(transport)')\n      }\n      if (opts.transport.targets && opts.transport.targets.length && opts.formatters && typeof opts.formatters.level === 'function') {\n        throw Error('option.transport.targets do not allow custom level formatters')\n      }\n\n      let customLevels\n      if (opts.customLevels) {\n        customLevels = opts.useOnlyCustomLevels ? opts.customLevels : Object.assign({}, opts.levels, opts.customLevels)\n      }\n      stream = transport({ caller, ...opts.transport, levels: customLevels })\n    }\n    opts = Object.assign({}, defaultOptions, opts)\n    opts.serializers = Object.assign({}, defaultOptions.serializers, opts.serializers)\n    opts.formatters = Object.assign({}, defaultOptions.formatters, opts.formatters)\n\n    if (opts.prettyPrint) {\n      throw new Error('prettyPrint option is no longer supported, see the pino-pretty package (https://github.com/pinojs/pino-pretty)')\n    }\n\n    const { enabled, onChild } = opts\n    if (enabled === false) opts.level = 'silent'\n    if (!onChild) opts.onChild = noop\n    if (!stream) {\n      if (!hasBeenTampered(process.stdout)) {\n        // If process.stdout.fd is undefined, it means that we are running\n        // in a worker thread. Let's assume we are logging to file descriptor 1.\n        stream = buildSafeSonicBoom({ fd: process.stdout.fd || 1 })\n      } else {\n        stream = process.stdout\n      }\n    }\n    return { opts, stream }\n  }\n}\n\nfunction stringify (obj, stringifySafeFn) {\n  try {\n    return JSON.stringify(obj)\n  } catch (_) {\n    try {\n      const stringify = stringifySafeFn || this[stringifySafeSym]\n      return stringify(obj)\n    } catch (_) {\n      return '\"[unable to serialize, circular reference is too complex to analyze]\"'\n    }\n  }\n}\n\nfunction buildFormatters (level, bindings, log) {\n  return {\n    level,\n    bindings,\n    log\n  }\n}\n\n/**\n * Convert a string integer file descriptor to a proper native integer\n * file descriptor.\n *\n * @param {string} destination The file descriptor string to attempt to convert.\n *\n * @returns {Number}\n */\nfunction normalizeDestFileDescriptor (destination) {\n  const fd = Number(destination)\n  if (typeof destination === 'string' && Number.isFinite(fd)) {\n    return fd\n  }\n  // destination could be undefined if we are in a worker\n  if (destination === undefined) {\n    // This is stdout in UNIX systems\n    return 1\n  }\n  return destination\n}\n\nmodule.exports = {\n  noop,\n  buildSafeSonicBoom,\n  asChindings,\n  asJson,\n  genLog,\n  createArgsNormalizer,\n  stringify,\n  buildFormatters,\n  normalizeDestFileDescriptor\n}\n","/**\n * Represents default log level values\n *\n * @enum {number}\n */\nconst DEFAULT_LEVELS = {\n  trace: 10,\n  debug: 20,\n  info: 30,\n  warn: 40,\n  error: 50,\n  fatal: 60\n}\n\n/**\n * Represents sort order direction: `ascending` or `descending`\n *\n * @enum {string}\n */\nconst SORTING_ORDER = {\n  ASC: 'ASC',\n  DESC: 'DESC'\n}\n\nmodule.exports = {\n  DEFAULT_LEVELS,\n  SORTING_ORDER\n}\n","'use strict'\n/* eslint no-prototype-builtins: 0 */\nconst {\n  lsCacheSym,\n  levelValSym,\n  useOnlyCustomLevelsSym,\n  streamSym,\n  formattersSym,\n  hooksSym,\n  levelCompSym\n} = require('./symbols')\nconst { noop, genLog } = require('./tools')\nconst { DEFAULT_LEVELS, SORTING_ORDER } = require('./constants')\n\nconst levelMethods = {\n  fatal: (hook) => {\n    const logFatal = genLog(DEFAULT_LEVELS.fatal, hook)\n    return function (...args) {\n      const stream = this[streamSym]\n      logFatal.call(this, ...args)\n      if (typeof stream.flushSync === 'function') {\n        try {\n          stream.flushSync()\n        } catch (e) {\n          // https://github.com/pinojs/pino/pull/740#discussion_r346788313\n        }\n      }\n    }\n  },\n  error: (hook) => genLog(DEFAULT_LEVELS.error, hook),\n  warn: (hook) => genLog(DEFAULT_LEVELS.warn, hook),\n  info: (hook) => genLog(DEFAULT_LEVELS.info, hook),\n  debug: (hook) => genLog(DEFAULT_LEVELS.debug, hook),\n  trace: (hook) => genLog(DEFAULT_LEVELS.trace, hook)\n}\n\nconst nums = Object.keys(DEFAULT_LEVELS).reduce((o, k) => {\n  o[DEFAULT_LEVELS[k]] = k\n  return o\n}, {})\n\nconst initialLsCache = Object.keys(nums).reduce((o, k) => {\n  o[k] = '{\"level\":' + Number(k)\n  return o\n}, {})\n\nfunction genLsCache (instance) {\n  const formatter = instance[formattersSym].level\n  const { labels } = instance.levels\n  const cache = {}\n  for (const label in labels) {\n    const level = formatter(labels[label], Number(label))\n    cache[label] = JSON.stringify(level).slice(0, -1)\n  }\n  instance[lsCacheSym] = cache\n  return instance\n}\n\nfunction isStandardLevel (level, useOnlyCustomLevels) {\n  if (useOnlyCustomLevels) {\n    return false\n  }\n\n  switch (level) {\n    case 'fatal':\n    case 'error':\n    case 'warn':\n    case 'info':\n    case 'debug':\n    case 'trace':\n      return true\n    default:\n      return false\n  }\n}\n\nfunction setLevel (level) {\n  const { labels, values } = this.levels\n  if (typeof level === 'number') {\n    if (labels[level] === undefined) throw Error('unknown level value' + level)\n    level = labels[level]\n  }\n  if (values[level] === undefined) throw Error('unknown level ' + level)\n  const preLevelVal = this[levelValSym]\n  const levelVal = this[levelValSym] = values[level]\n  const useOnlyCustomLevelsVal = this[useOnlyCustomLevelsSym]\n  const levelComparison = this[levelCompSym]\n  const hook = this[hooksSym].logMethod\n\n  for (const key in values) {\n    if (levelComparison(values[key], levelVal) === false) {\n      this[key] = noop\n      continue\n    }\n    this[key] = isStandardLevel(key, useOnlyCustomLevelsVal) ? levelMethods[key](hook) : genLog(values[key], hook)\n  }\n\n  this.emit(\n    'level-change',\n    level,\n    levelVal,\n    labels[preLevelVal],\n    preLevelVal,\n    this\n  )\n}\n\nfunction getLevel (level) {\n  const { levels, levelVal } = this\n  // protection against potential loss of Pino scope from serializers (edge case with circular refs - https://github.com/pinojs/pino/issues/833)\n  return (levels && levels.labels) ? levels.labels[levelVal] : ''\n}\n\nfunction isLevelEnabled (logLevel) {\n  const { values } = this.levels\n  const logLevelVal = values[logLevel]\n  return logLevelVal !== undefined && this[levelCompSym](logLevelVal, this[levelValSym])\n}\n\n/**\n * Determine if the given `current` level is enabled by comparing it\n * against the current threshold (`expected`).\n *\n * @param {SORTING_ORDER} direction comparison direction \"ASC\" or \"DESC\"\n * @param {number} current current log level number representation\n * @param {number} expected threshold value to compare with\n * @returns {boolean}\n */\nfunction compareLevel (direction, current, expected) {\n  if (direction === SORTING_ORDER.DESC) {\n    return current <= expected\n  }\n\n  return current >= expected\n}\n\n/**\n * Create a level comparison function based on `levelComparison`\n * it could a default function which compares levels either in \"ascending\" or \"descending\" order or custom comparison function\n *\n * @param {SORTING_ORDER | Function} levelComparison sort levels order direction or custom comparison function\n * @returns Function\n */\nfunction genLevelComparison (levelComparison) {\n  if (typeof levelComparison === 'string') {\n    return compareLevel.bind(null, levelComparison)\n  }\n\n  return levelComparison\n}\n\nfunction mappings (customLevels = null, useOnlyCustomLevels = false) {\n  const customNums = customLevels\n    /* eslint-disable */\n    ? Object.keys(customLevels).reduce((o, k) => {\n        o[customLevels[k]] = k\n        return o\n      }, {})\n    : null\n    /* eslint-enable */\n\n  const labels = Object.assign(\n    Object.create(Object.prototype, { Infinity: { value: 'silent' } }),\n    useOnlyCustomLevels ? null : nums,\n    customNums\n  )\n  const values = Object.assign(\n    Object.create(Object.prototype, { silent: { value: Infinity } }),\n    useOnlyCustomLevels ? null : DEFAULT_LEVELS,\n    customLevels\n  )\n  return { labels, values }\n}\n\nfunction assertDefaultLevelFound (defaultLevel, customLevels, useOnlyCustomLevels) {\n  if (typeof defaultLevel === 'number') {\n    const values = [].concat(\n      Object.keys(customLevels || {}).map(key => customLevels[key]),\n      useOnlyCustomLevels ? [] : Object.keys(nums).map(level => +level),\n      Infinity\n    )\n    if (!values.includes(defaultLevel)) {\n      throw Error(`default level:${defaultLevel} must be included in custom levels`)\n    }\n    return\n  }\n\n  const labels = Object.assign(\n    Object.create(Object.prototype, { silent: { value: Infinity } }),\n    useOnlyCustomLevels ? null : DEFAULT_LEVELS,\n    customLevels\n  )\n  if (!(defaultLevel in labels)) {\n    throw Error(`default level:${defaultLevel} must be included in custom levels`)\n  }\n}\n\nfunction assertNoLevelCollisions (levels, customLevels) {\n  const { labels, values } = levels\n  for (const k in customLevels) {\n    if (k in values) {\n      throw Error('levels cannot be overridden')\n    }\n    if (customLevels[k] in labels) {\n      throw Error('pre-existing level values cannot be used for new levels')\n    }\n  }\n}\n\n/**\n * Validates whether `levelComparison` is correct\n *\n * @throws Error\n * @param {SORTING_ORDER | Function} levelComparison - value to validate\n * @returns\n */\nfunction assertLevelComparison (levelComparison) {\n  if (typeof levelComparison === 'function') {\n    return\n  }\n\n  if (typeof levelComparison === 'string' && Object.values(SORTING_ORDER).includes(levelComparison)) {\n    return\n  }\n\n  throw new Error('Levels comparison should be one of \"ASC\", \"DESC\" or \"function\" type')\n}\n\nmodule.exports = {\n  initialLsCache,\n  genLsCache,\n  levelMethods,\n  getLevel,\n  setLevel,\n  isLevelEnabled,\n  mappings,\n  assertNoLevelCollisions,\n  assertDefaultLevelFound,\n  genLevelComparison,\n  assertLevelComparison\n}\n","'use strict'\n\nmodule.exports = { version: '9.9.4' }\n","'use strict'\n\n/* eslint no-prototype-builtins: 0 */\n\nconst { EventEmitter } = require('node:events')\nconst {\n  lsCacheSym,\n  levelValSym,\n  setLevelSym,\n  getLevelSym,\n  chindingsSym,\n  parsedChindingsSym,\n  mixinSym,\n  asJsonSym,\n  writeSym,\n  mixinMergeStrategySym,\n  timeSym,\n  timeSliceIndexSym,\n  streamSym,\n  serializersSym,\n  formattersSym,\n  errorKeySym,\n  messageKeySym,\n  useOnlyCustomLevelsSym,\n  needsMetadataGsym,\n  redactFmtSym,\n  stringifySym,\n  formatOptsSym,\n  stringifiersSym,\n  msgPrefixSym,\n  hooksSym\n} = require('./symbols')\nconst {\n  getLevel,\n  setLevel,\n  isLevelEnabled,\n  mappings,\n  initialLsCache,\n  genLsCache,\n  assertNoLevelCollisions\n} = require('./levels')\nconst {\n  asChindings,\n  asJson,\n  buildFormatters,\n  stringify\n} = require('./tools')\nconst {\n  version\n} = require('./meta')\nconst redaction = require('./redaction')\n\n// note: use of class is satirical\n// https://github.com/pinojs/pino/pull/433#pullrequestreview-127703127\nconst constructor = class Pino {}\nconst prototype = {\n  constructor,\n  child,\n  bindings,\n  setBindings,\n  flush,\n  isLevelEnabled,\n  version,\n  get level () { return this[getLevelSym]() },\n  set level (lvl) { this[setLevelSym](lvl) },\n  get levelVal () { return this[levelValSym] },\n  set levelVal (n) { throw Error('levelVal is read-only') },\n  get msgPrefix () { return this[msgPrefixSym] },\n  [lsCacheSym]: initialLsCache,\n  [writeSym]: write,\n  [asJsonSym]: asJson,\n  [getLevelSym]: getLevel,\n  [setLevelSym]: setLevel\n}\n\nObject.setPrototypeOf(prototype, EventEmitter.prototype)\n\n// exporting and consuming the prototype object using factory pattern fixes scoping issues with getters when serializing\nmodule.exports = function () {\n  return Object.create(prototype)\n}\n\nconst resetChildingsFormatter = bindings => bindings\nfunction child (bindings, options) {\n  if (!bindings) {\n    throw Error('missing bindings for child Pino')\n  }\n  options = options || {} // default options to empty object\n  const serializers = this[serializersSym]\n  const formatters = this[formattersSym]\n  const instance = Object.create(this)\n\n  if (options.hasOwnProperty('serializers') === true) {\n    instance[serializersSym] = Object.create(null)\n\n    for (const k in serializers) {\n      instance[serializersSym][k] = serializers[k]\n    }\n    const parentSymbols = Object.getOwnPropertySymbols(serializers)\n    /* eslint no-var: off */\n    for (var i = 0; i < parentSymbols.length; i++) {\n      const ks = parentSymbols[i]\n      instance[serializersSym][ks] = serializers[ks]\n    }\n\n    for (const bk in options.serializers) {\n      instance[serializersSym][bk] = options.serializers[bk]\n    }\n    const bindingsSymbols = Object.getOwnPropertySymbols(options.serializers)\n    for (var bi = 0; bi < bindingsSymbols.length; bi++) {\n      const bks = bindingsSymbols[bi]\n      instance[serializersSym][bks] = options.serializers[bks]\n    }\n  } else instance[serializersSym] = serializers\n  if (options.hasOwnProperty('formatters')) {\n    const { level, bindings: chindings, log } = options.formatters\n    instance[formattersSym] = buildFormatters(\n      level || formatters.level,\n      chindings || resetChildingsFormatter,\n      log || formatters.log\n    )\n  } else {\n    instance[formattersSym] = buildFormatters(\n      formatters.level,\n      resetChildingsFormatter,\n      formatters.log\n    )\n  }\n  if (options.hasOwnProperty('customLevels') === true) {\n    assertNoLevelCollisions(this.levels, options.customLevels)\n    instance.levels = mappings(options.customLevels, instance[useOnlyCustomLevelsSym])\n    genLsCache(instance)\n  }\n\n  // redact must place before asChindings and only replace if exist\n  if ((typeof options.redact === 'object' && options.redact !== null) || Array.isArray(options.redact)) {\n    instance.redact = options.redact // replace redact directly\n    const stringifiers = redaction(instance.redact, stringify)\n    const formatOpts = { stringify: stringifiers[redactFmtSym] }\n    instance[stringifySym] = stringify\n    instance[stringifiersSym] = stringifiers\n    instance[formatOptsSym] = formatOpts\n  }\n\n  if (typeof options.msgPrefix === 'string') {\n    instance[msgPrefixSym] = (this[msgPrefixSym] || '') + options.msgPrefix\n  }\n\n  instance[chindingsSym] = asChindings(instance, bindings)\n  if ((options.level !== undefined && options.level !== this.level) || options.hasOwnProperty('customLevels')) {\n    const childLevel = options.level || this.level\n    instance[setLevelSym](childLevel)\n  }\n  this.onChild(instance)\n  return instance\n}\n\nfunction bindings () {\n  const chindings = this[chindingsSym]\n  const chindingsJson = `{${chindings.substr(1)}}` // at least contains ,\"pid\":7068,\"hostname\":\"myMac\"\n  const bindingsFromJson = JSON.parse(chindingsJson)\n  delete bindingsFromJson.pid\n  delete bindingsFromJson.hostname\n  return bindingsFromJson\n}\n\nfunction setBindings (newBindings) {\n  const chindings = asChindings(this, newBindings)\n  this[chindingsSym] = chindings\n  delete this[parsedChindingsSym]\n}\n\n/**\n * Default strategy for creating `mergeObject` from arguments and the result from `mixin()`.\n * Fields from `mergeObject` have higher priority in this strategy.\n *\n * @param {Object} mergeObject The object a user has supplied to the logging function.\n * @param {Object} mixinObject The result of the `mixin` method.\n * @return {Object}\n */\nfunction defaultMixinMergeStrategy (mergeObject, mixinObject) {\n  return Object.assign(mixinObject, mergeObject)\n}\n\nfunction write (_obj, msg, num) {\n  const t = this[timeSym]()\n  const mixin = this[mixinSym]\n  const errorKey = this[errorKeySym]\n  const messageKey = this[messageKeySym]\n  const mixinMergeStrategy = this[mixinMergeStrategySym] || defaultMixinMergeStrategy\n  let obj\n  const streamWriteHook = this[hooksSym].streamWrite\n\n  if (_obj === undefined || _obj === null) {\n    obj = {}\n  } else if (_obj instanceof Error) {\n    obj = { [errorKey]: _obj }\n    if (msg === undefined) {\n      msg = _obj.message\n    }\n  } else {\n    obj = _obj\n    if (msg === undefined && _obj[messageKey] === undefined && _obj[errorKey]) {\n      msg = _obj[errorKey].message\n    }\n  }\n\n  if (mixin) {\n    obj = mixinMergeStrategy(obj, mixin(obj, num, this))\n  }\n\n  const s = this[asJsonSym](obj, msg, num, t)\n\n  const stream = this[streamSym]\n  if (stream[needsMetadataGsym] === true) {\n    stream.lastLevel = num\n    stream.lastObj = obj\n    stream.lastMsg = msg\n    stream.lastTime = t.slice(this[timeSliceIndexSym])\n    stream.lastLogger = this // for child loggers\n  }\n  stream.write(streamWriteHook ? streamWriteHook(s) : s)\n}\n\nfunction noop () {}\n\nfunction flush (cb) {\n  if (cb != null && typeof cb !== 'function') {\n    throw Error('callback must be a function')\n  }\n\n  const stream = this[streamSym]\n\n  if (typeof stream.flush === 'function') {\n    stream.flush(cb || noop)\n  } else if (cb) cb()\n}\n","'use strict'\n\nconst { hasOwnProperty } = Object.prototype\n\nconst stringify = configure()\n\n// @ts-expect-error\nstringify.configure = configure\n// @ts-expect-error\nstringify.stringify = stringify\n\n// @ts-expect-error\nstringify.default = stringify\n\n// @ts-expect-error used for named export\nexports.stringify = stringify\n// @ts-expect-error used for named export\nexports.configure = configure\n\nmodule.exports = stringify\n\n// eslint-disable-next-line no-control-regex\nconst strEscapeSequencesRegExp = /[\\u0000-\\u001f\\u0022\\u005c\\ud800-\\udfff]/\n\n// Escape C0 control characters, double quotes, the backslash and every code\n// unit with a numeric value in the inclusive range 0xD800 to 0xDFFF.\nfunction strEscape (str) {\n  // Some magic numbers that worked out fine while benchmarking with v8 8.0\n  if (str.length < 5000 && !strEscapeSequencesRegExp.test(str)) {\n    return `\"${str}\"`\n  }\n  return JSON.stringify(str)\n}\n\nfunction sort (array, comparator) {\n  // Insertion sort is very efficient for small input sizes, but it has a bad\n  // worst case complexity. Thus, use native array sort for bigger values.\n  if (array.length > 2e2 || comparator) {\n    return array.sort(comparator)\n  }\n  for (let i = 1; i < array.length; i++) {\n    const currentValue = array[i]\n    let position = i\n    while (position !== 0 && array[position - 1] > currentValue) {\n      array[position] = array[position - 1]\n      position--\n    }\n    array[position] = currentValue\n  }\n  return array\n}\n\nconst typedArrayPrototypeGetSymbolToStringTag =\n  Object.getOwnPropertyDescriptor(\n    Object.getPrototypeOf(\n      Object.getPrototypeOf(\n        new Int8Array()\n      )\n    ),\n    Symbol.toStringTag\n  ).get\n\nfunction isTypedArrayWithEntries (value) {\n  return typedArrayPrototypeGetSymbolToStringTag.call(value) !== undefined && value.length !== 0\n}\n\nfunction stringifyTypedArray (array, separator, maximumBreadth) {\n  if (array.length < maximumBreadth) {\n    maximumBreadth = array.length\n  }\n  const whitespace = separator === ',' ? '' : ' '\n  let res = `\"0\":${whitespace}${array[0]}`\n  for (let i = 1; i < maximumBreadth; i++) {\n    res += `${separator}\"${i}\":${whitespace}${array[i]}`\n  }\n  return res\n}\n\nfunction getCircularValueOption (options) {\n  if (hasOwnProperty.call(options, 'circularValue')) {\n    const circularValue = options.circularValue\n    if (typeof circularValue === 'string') {\n      return `\"${circularValue}\"`\n    }\n    if (circularValue == null) {\n      return circularValue\n    }\n    if (circularValue === Error || circularValue === TypeError) {\n      return {\n        toString () {\n          throw new TypeError('Converting circular structure to JSON')\n        }\n      }\n    }\n    throw new TypeError('The \"circularValue\" argument must be of type string or the value null or undefined')\n  }\n  return '\"[Circular]\"'\n}\n\nfunction getDeterministicOption (options) {\n  let value\n  if (hasOwnProperty.call(options, 'deterministic')) {\n    value = options.deterministic\n    if (typeof value !== 'boolean' && typeof value !== 'function') {\n      throw new TypeError('The \"deterministic\" argument must be of type boolean or comparator function')\n    }\n  }\n  return value === undefined ? true : value\n}\n\nfunction getBooleanOption (options, key) {\n  let value\n  if (hasOwnProperty.call(options, key)) {\n    value = options[key]\n    if (typeof value !== 'boolean') {\n      throw new TypeError(`The \"${key}\" argument must be of type boolean`)\n    }\n  }\n  return value === undefined ? true : value\n}\n\nfunction getPositiveIntegerOption (options, key) {\n  let value\n  if (hasOwnProperty.call(options, key)) {\n    value = options[key]\n    if (typeof value !== 'number') {\n      throw new TypeError(`The \"${key}\" argument must be of type number`)\n    }\n    if (!Number.isInteger(value)) {\n      throw new TypeError(`The \"${key}\" argument must be an integer`)\n    }\n    if (value < 1) {\n      throw new RangeError(`The \"${key}\" argument must be >= 1`)\n    }\n  }\n  return value === undefined ? Infinity : value\n}\n\nfunction getItemCount (number) {\n  if (number === 1) {\n    return '1 item'\n  }\n  return `${number} items`\n}\n\nfunction getUniqueReplacerSet (replacerArray) {\n  const replacerSet = new Set()\n  for (const value of replacerArray) {\n    if (typeof value === 'string' || typeof value === 'number') {\n      replacerSet.add(String(value))\n    }\n  }\n  return replacerSet\n}\n\nfunction getStrictOption (options) {\n  if (hasOwnProperty.call(options, 'strict')) {\n    const value = options.strict\n    if (typeof value !== 'boolean') {\n      throw new TypeError('The \"strict\" argument must be of type boolean')\n    }\n    if (value) {\n      return (value) => {\n        let message = `Object can not safely be stringified. Received type ${typeof value}`\n        if (typeof value !== 'function') message += ` (${value.toString()})`\n        throw new Error(message)\n      }\n    }\n  }\n}\n\nfunction configure (options) {\n  options = { ...options }\n  const fail = getStrictOption(options)\n  if (fail) {\n    if (options.bigint === undefined) {\n      options.bigint = false\n    }\n    if (!('circularValue' in options)) {\n      options.circularValue = Error\n    }\n  }\n  const circularValue = getCircularValueOption(options)\n  const bigint = getBooleanOption(options, 'bigint')\n  const deterministic = getDeterministicOption(options)\n  const comparator = typeof deterministic === 'function' ? deterministic : undefined\n  const maximumDepth = getPositiveIntegerOption(options, 'maximumDepth')\n  const maximumBreadth = getPositiveIntegerOption(options, 'maximumBreadth')\n\n  function stringifyFnReplacer (key, parent, stack, replacer, spacer, indentation) {\n    let value = parent[key]\n\n    if (typeof value === 'object' && value !== null && typeof value.toJSON === 'function') {\n      value = value.toJSON(key)\n    }\n    value = replacer.call(parent, key, value)\n\n    switch (typeof value) {\n      case 'string':\n        return strEscape(value)\n      case 'object': {\n        if (value === null) {\n          return 'null'\n        }\n        if (stack.indexOf(value) !== -1) {\n          return circularValue\n        }\n\n        let res = ''\n        let join = ','\n        const originalIndentation = indentation\n\n        if (Array.isArray(value)) {\n          if (value.length === 0) {\n            return '[]'\n          }\n          if (maximumDepth < stack.length + 1) {\n            return '\"[Array]\"'\n          }\n          stack.push(value)\n          if (spacer !== '') {\n            indentation += spacer\n            res += `\\n${indentation}`\n            join = `,\\n${indentation}`\n          }\n          const maximumValuesToStringify = Math.min(value.length, maximumBreadth)\n          let i = 0\n          for (; i < maximumValuesToStringify - 1; i++) {\n            const tmp = stringifyFnReplacer(String(i), value, stack, replacer, spacer, indentation)\n            res += tmp !== undefined ? tmp : 'null'\n            res += join\n          }\n          const tmp = stringifyFnReplacer(String(i), value, stack, replacer, spacer, indentation)\n          res += tmp !== undefined ? tmp : 'null'\n          if (value.length - 1 > maximumBreadth) {\n            const removedKeys = value.length - maximumBreadth - 1\n            res += `${join}\"... ${getItemCount(removedKeys)} not stringified\"`\n          }\n          if (spacer !== '') {\n            res += `\\n${originalIndentation}`\n          }\n          stack.pop()\n          return `[${res}]`\n        }\n\n        let keys = Object.keys(value)\n        const keyLength = keys.length\n        if (keyLength === 0) {\n          return '{}'\n        }\n        if (maximumDepth < stack.length + 1) {\n          return '\"[Object]\"'\n        }\n        let whitespace = ''\n        let separator = ''\n        if (spacer !== '') {\n          indentation += spacer\n          join = `,\\n${indentation}`\n          whitespace = ' '\n        }\n        const maximumPropertiesToStringify = Math.min(keyLength, maximumBreadth)\n        if (deterministic && !isTypedArrayWithEntries(value)) {\n          keys = sort(keys, comparator)\n        }\n        stack.push(value)\n        for (let i = 0; i < maximumPropertiesToStringify; i++) {\n          const key = keys[i]\n          const tmp = stringifyFnReplacer(key, value, stack, replacer, spacer, indentation)\n          if (tmp !== undefined) {\n            res += `${separator}${strEscape(key)}:${whitespace}${tmp}`\n            separator = join\n          }\n        }\n        if (keyLength > maximumBreadth) {\n          const removedKeys = keyLength - maximumBreadth\n          res += `${separator}\"...\":${whitespace}\"${getItemCount(removedKeys)} not stringified\"`\n          separator = join\n        }\n        if (spacer !== '' && separator.length > 1) {\n          res = `\\n${indentation}${res}\\n${originalIndentation}`\n        }\n        stack.pop()\n        return `{${res}}`\n      }\n      case 'number':\n        return isFinite(value) ? String(value) : fail ? fail(value) : 'null'\n      case 'boolean':\n        return value === true ? 'true' : 'false'\n      case 'undefined':\n        return undefined\n      case 'bigint':\n        if (bigint) {\n          return String(value)\n        }\n        // fallthrough\n      default:\n        return fail ? fail(value) : undefined\n    }\n  }\n\n  function stringifyArrayReplacer (key, value, stack, replacer, spacer, indentation) {\n    if (typeof value === 'object' && value !== null && typeof value.toJSON === 'function') {\n      value = value.toJSON(key)\n    }\n\n    switch (typeof value) {\n      case 'string':\n        return strEscape(value)\n      case 'object': {\n        if (value === null) {\n          return 'null'\n        }\n        if (stack.indexOf(value) !== -1) {\n          return circularValue\n        }\n\n        const originalIndentation = indentation\n        let res = ''\n        let join = ','\n\n        if (Array.isArray(value)) {\n          if (value.length === 0) {\n            return '[]'\n          }\n          if (maximumDepth < stack.length + 1) {\n            return '\"[Array]\"'\n          }\n          stack.push(value)\n          if (spacer !== '') {\n            indentation += spacer\n            res += `\\n${indentation}`\n            join = `,\\n${indentation}`\n          }\n          const maximumValuesToStringify = Math.min(value.length, maximumBreadth)\n          let i = 0\n          for (; i < maximumValuesToStringify - 1; i++) {\n            const tmp = stringifyArrayReplacer(String(i), value[i], stack, replacer, spacer, indentation)\n            res += tmp !== undefined ? tmp : 'null'\n            res += join\n          }\n          const tmp = stringifyArrayReplacer(String(i), value[i], stack, replacer, spacer, indentation)\n          res += tmp !== undefined ? tmp : 'null'\n          if (value.length - 1 > maximumBreadth) {\n            const removedKeys = value.length - maximumBreadth - 1\n            res += `${join}\"... ${getItemCount(removedKeys)} not stringified\"`\n          }\n          if (spacer !== '') {\n            res += `\\n${originalIndentation}`\n          }\n          stack.pop()\n          return `[${res}]`\n        }\n        stack.push(value)\n        let whitespace = ''\n        if (spacer !== '') {\n          indentation += spacer\n          join = `,\\n${indentation}`\n          whitespace = ' '\n        }\n        let separator = ''\n        for (const key of replacer) {\n          const tmp = stringifyArrayReplacer(key, value[key], stack, replacer, spacer, indentation)\n          if (tmp !== undefined) {\n            res += `${separator}${strEscape(key)}:${whitespace}${tmp}`\n            separator = join\n          }\n        }\n        if (spacer !== '' && separator.length > 1) {\n          res = `\\n${indentation}${res}\\n${originalIndentation}`\n        }\n        stack.pop()\n        return `{${res}}`\n      }\n      case 'number':\n        return isFinite(value) ? String(value) : fail ? fail(value) : 'null'\n      case 'boolean':\n        return value === true ? 'true' : 'false'\n      case 'undefined':\n        return undefined\n      case 'bigint':\n        if (bigint) {\n          return String(value)\n        }\n        // fallthrough\n      default:\n        return fail ? fail(value) : undefined\n    }\n  }\n\n  function stringifyIndent (key, value, stack, spacer, indentation) {\n    switch (typeof value) {\n      case 'string':\n        return strEscape(value)\n      case 'object': {\n        if (value === null) {\n          return 'null'\n        }\n        if (typeof value.toJSON === 'function') {\n          value = value.toJSON(key)\n          // Prevent calling `toJSON` again.\n          if (typeof value !== 'object') {\n            return stringifyIndent(key, value, stack, spacer, indentation)\n          }\n          if (value === null) {\n            return 'null'\n          }\n        }\n        if (stack.indexOf(value) !== -1) {\n          return circularValue\n        }\n        const originalIndentation = indentation\n\n        if (Array.isArray(value)) {\n          if (value.length === 0) {\n            return '[]'\n          }\n          if (maximumDepth < stack.length + 1) {\n            return '\"[Array]\"'\n          }\n          stack.push(value)\n          indentation += spacer\n          let res = `\\n${indentation}`\n          const join = `,\\n${indentation}`\n          const maximumValuesToStringify = Math.min(value.length, maximumBreadth)\n          let i = 0\n          for (; i < maximumValuesToStringify - 1; i++) {\n            const tmp = stringifyIndent(String(i), value[i], stack, spacer, indentation)\n            res += tmp !== undefined ? tmp : 'null'\n            res += join\n          }\n          const tmp = stringifyIndent(String(i), value[i], stack, spacer, indentation)\n          res += tmp !== undefined ? tmp : 'null'\n          if (value.length - 1 > maximumBreadth) {\n            const removedKeys = value.length - maximumBreadth - 1\n            res += `${join}\"... ${getItemCount(removedKeys)} not stringified\"`\n          }\n          res += `\\n${originalIndentation}`\n          stack.pop()\n          return `[${res}]`\n        }\n\n        let keys = Object.keys(value)\n        const keyLength = keys.length\n        if (keyLength === 0) {\n          return '{}'\n        }\n        if (maximumDepth < stack.length + 1) {\n          return '\"[Object]\"'\n        }\n        indentation += spacer\n        const join = `,\\n${indentation}`\n        let res = ''\n        let separator = ''\n        let maximumPropertiesToStringify = Math.min(keyLength, maximumBreadth)\n        if (isTypedArrayWithEntries(value)) {\n          res += stringifyTypedArray(value, join, maximumBreadth)\n          keys = keys.slice(value.length)\n          maximumPropertiesToStringify -= value.length\n          separator = join\n        }\n        if (deterministic) {\n          keys = sort(keys, comparator)\n        }\n        stack.push(value)\n        for (let i = 0; i < maximumPropertiesToStringify; i++) {\n          const key = keys[i]\n          const tmp = stringifyIndent(key, value[key], stack, spacer, indentation)\n          if (tmp !== undefined) {\n            res += `${separator}${strEscape(key)}: ${tmp}`\n            separator = join\n          }\n        }\n        if (keyLength > maximumBreadth) {\n          const removedKeys = keyLength - maximumBreadth\n          res += `${separator}\"...\": \"${getItemCount(removedKeys)} not stringified\"`\n          separator = join\n        }\n        if (separator !== '') {\n          res = `\\n${indentation}${res}\\n${originalIndentation}`\n        }\n        stack.pop()\n        return `{${res}}`\n      }\n      case 'number':\n        return isFinite(value) ? String(value) : fail ? fail(value) : 'null'\n      case 'boolean':\n        return value === true ? 'true' : 'false'\n      case 'undefined':\n        return undefined\n      case 'bigint':\n        if (bigint) {\n          return String(value)\n        }\n        // fallthrough\n      default:\n        return fail ? fail(value) : undefined\n    }\n  }\n\n  function stringifySimple (key, value, stack) {\n    switch (typeof value) {\n      case 'string':\n        return strEscape(value)\n      case 'object': {\n        if (value === null) {\n          return 'null'\n        }\n        if (typeof value.toJSON === 'function') {\n          value = value.toJSON(key)\n          // Prevent calling `toJSON` again\n          if (typeof value !== 'object') {\n            return stringifySimple(key, value, stack)\n          }\n          if (value === null) {\n            return 'null'\n          }\n        }\n        if (stack.indexOf(value) !== -1) {\n          return circularValue\n        }\n\n        let res = ''\n\n        const hasLength = value.length !== undefined\n        if (hasLength && Array.isArray(value)) {\n          if (value.length === 0) {\n            return '[]'\n          }\n          if (maximumDepth < stack.length + 1) {\n            return '\"[Array]\"'\n          }\n          stack.push(value)\n          const maximumValuesToStringify = Math.min(value.length, maximumBreadth)\n          let i = 0\n          for (; i < maximumValuesToStringify - 1; i++) {\n            const tmp = stringifySimple(String(i), value[i], stack)\n            res += tmp !== undefined ? tmp : 'null'\n            res += ','\n          }\n          const tmp = stringifySimple(String(i), value[i], stack)\n          res += tmp !== undefined ? tmp : 'null'\n          if (value.length - 1 > maximumBreadth) {\n            const removedKeys = value.length - maximumBreadth - 1\n            res += `,\"... ${getItemCount(removedKeys)} not stringified\"`\n          }\n          stack.pop()\n          return `[${res}]`\n        }\n\n        let keys = Object.keys(value)\n        const keyLength = keys.length\n        if (keyLength === 0) {\n          return '{}'\n        }\n        if (maximumDepth < stack.length + 1) {\n          return '\"[Object]\"'\n        }\n        let separator = ''\n        let maximumPropertiesToStringify = Math.min(keyLength, maximumBreadth)\n        if (hasLength && isTypedArrayWithEntries(value)) {\n          res += stringifyTypedArray(value, ',', maximumBreadth)\n          keys = keys.slice(value.length)\n          maximumPropertiesToStringify -= value.length\n          separator = ','\n        }\n        if (deterministic) {\n          keys = sort(keys, comparator)\n        }\n        stack.push(value)\n        for (let i = 0; i < maximumPropertiesToStringify; i++) {\n          const key = keys[i]\n          const tmp = stringifySimple(key, value[key], stack)\n          if (tmp !== undefined) {\n            res += `${separator}${strEscape(key)}:${tmp}`\n            separator = ','\n          }\n        }\n        if (keyLength > maximumBreadth) {\n          const removedKeys = keyLength - maximumBreadth\n          res += `${separator}\"...\":\"${getItemCount(removedKeys)} not stringified\"`\n        }\n        stack.pop()\n        return `{${res}}`\n      }\n      case 'number':\n        return isFinite(value) ? String(value) : fail ? fail(value) : 'null'\n      case 'boolean':\n        return value === true ? 'true' : 'false'\n      case 'undefined':\n        return undefined\n      case 'bigint':\n        if (bigint) {\n          return String(value)\n        }\n        // fallthrough\n      default:\n        return fail ? fail(value) : undefined\n    }\n  }\n\n  function stringify (value, replacer, space) {\n    if (arguments.length > 1) {\n      let spacer = ''\n      if (typeof space === 'number') {\n        spacer = ' '.repeat(Math.min(space, 10))\n      } else if (typeof space === 'string') {\n        spacer = space.slice(0, 10)\n      }\n      if (replacer != null) {\n        if (typeof replacer === 'function') {\n          return stringifyFnReplacer('', { '': value }, [], replacer, spacer, '')\n        }\n        if (Array.isArray(replacer)) {\n          return stringifyArrayReplacer('', value, [], getUniqueReplacerSet(replacer), spacer, '')\n        }\n      }\n      if (spacer.length !== 0) {\n        return stringifyIndent('', value, [], spacer, '')\n      }\n    }\n    return stringifySimple('', value, [])\n  }\n\n  return stringify\n}\n","'use strict'\n\nconst metadata = Symbol.for('pino.metadata')\nconst { DEFAULT_LEVELS } = require('./constants')\n\nconst DEFAULT_INFO_LEVEL = DEFAULT_LEVELS.info\n\nfunction multistream (streamsArray, opts) {\n  streamsArray = streamsArray || []\n  opts = opts || { dedupe: false }\n\n  const streamLevels = Object.create(DEFAULT_LEVELS)\n  streamLevels.silent = Infinity\n  if (opts.levels && typeof opts.levels === 'object') {\n    Object.keys(opts.levels).forEach(i => {\n      streamLevels[i] = opts.levels[i]\n    })\n  }\n\n  const res = {\n    write,\n    add,\n    remove,\n    emit,\n    flushSync,\n    end,\n    minLevel: 0,\n    lastId: 0,\n    streams: [],\n    clone,\n    [metadata]: true,\n    streamLevels\n  }\n\n  if (Array.isArray(streamsArray)) {\n    streamsArray.forEach(add, res)\n  } else {\n    add.call(res, streamsArray)\n  }\n\n  // clean this object up\n  // or it will stay allocated forever\n  // as it is closed on the following closures\n  streamsArray = null\n\n  return res\n\n  // we can exit early because the streams are ordered by level\n  function write (data) {\n    let dest\n    const level = this.lastLevel\n    const { streams } = this\n    // for handling situation when several streams has the same level\n    let recordedLevel = 0\n    let stream\n\n    // if dedupe set to true we send logs to the stream with the highest level\n    // therefore, we have to change sorting order\n    for (let i = initLoopVar(streams.length, opts.dedupe); checkLoopVar(i, streams.length, opts.dedupe); i = adjustLoopVar(i, opts.dedupe)) {\n      dest = streams[i]\n      if (dest.level <= level) {\n        if (recordedLevel !== 0 && recordedLevel !== dest.level) {\n          break\n        }\n        stream = dest.stream\n        if (stream[metadata]) {\n          const { lastTime, lastMsg, lastObj, lastLogger } = this\n          stream.lastLevel = level\n          stream.lastTime = lastTime\n          stream.lastMsg = lastMsg\n          stream.lastObj = lastObj\n          stream.lastLogger = lastLogger\n        }\n        stream.write(data)\n        if (opts.dedupe) {\n          recordedLevel = dest.level\n        }\n      } else if (!opts.dedupe) {\n        break\n      }\n    }\n  }\n\n  function emit (...args) {\n    for (const { stream } of this.streams) {\n      if (typeof stream.emit === 'function') {\n        stream.emit(...args)\n      }\n    }\n  }\n\n  function flushSync () {\n    for (const { stream } of this.streams) {\n      if (typeof stream.flushSync === 'function') {\n        stream.flushSync()\n      }\n    }\n  }\n\n  function add (dest) {\n    if (!dest) {\n      return res\n    }\n\n    // Check that dest implements either StreamEntry or DestinationStream\n    const isStream = typeof dest.write === 'function' || dest.stream\n    const stream_ = dest.write ? dest : dest.stream\n    // This is necessary to provide a meaningful error message, otherwise it throws somewhere inside write()\n    if (!isStream) {\n      throw Error('stream object needs to implement either StreamEntry or DestinationStream interface')\n    }\n\n    const { streams, streamLevels } = this\n\n    let level\n    if (typeof dest.levelVal === 'number') {\n      level = dest.levelVal\n    } else if (typeof dest.level === 'string') {\n      level = streamLevels[dest.level]\n    } else if (typeof dest.level === 'number') {\n      level = dest.level\n    } else {\n      level = DEFAULT_INFO_LEVEL\n    }\n\n    const dest_ = {\n      stream: stream_,\n      level,\n      levelVal: undefined,\n      id: ++res.lastId\n    }\n\n    streams.unshift(dest_)\n    streams.sort(compareByLevel)\n\n    this.minLevel = streams[0].level\n\n    return res\n  }\n\n  function remove (id) {\n    const { streams } = this\n    const index = streams.findIndex(s => s.id === id)\n\n    if (index >= 0) {\n      streams.splice(index, 1)\n      streams.sort(compareByLevel)\n      this.minLevel = streams.length > 0 ? streams[0].level : -1\n    }\n\n    return res\n  }\n\n  function end () {\n    for (const { stream } of this.streams) {\n      if (typeof stream.flushSync === 'function') {\n        stream.flushSync()\n      }\n      stream.end()\n    }\n  }\n\n  function clone (level) {\n    const streams = new Array(this.streams.length)\n\n    for (let i = 0; i < streams.length; i++) {\n      streams[i] = {\n        level,\n        stream: this.streams[i].stream\n      }\n    }\n\n    return {\n      write,\n      add,\n      remove,\n      minLevel: level,\n      streams,\n      clone,\n      emit,\n      flushSync,\n      [metadata]: true\n    }\n  }\n}\n\nfunction compareByLevel (a, b) {\n  return a.level - b.level\n}\n\nfunction initLoopVar (length, dedupe) {\n  return dedupe ? length - 1 : 0\n}\n\nfunction adjustLoopVar (i, dedupe) {\n  return dedupe ? i - 1 : i + 1\n}\n\nfunction checkLoopVar (i, length, dedupe) {\n  return dedupe ? i >= 0 : i < length\n}\n\nmodule.exports = multistream\n","'use strict'\n\nconst os = require('node:os')\nconst stdSerializers = require('pino-std-serializers')\nconst caller = require('./lib/caller')\nconst redaction = require('./lib/redaction')\nconst time = require('./lib/time')\nconst proto = require('./lib/proto')\nconst symbols = require('./lib/symbols')\nconst { configure } = require('safe-stable-stringify')\nconst { assertDefaultLevelFound, mappings, genLsCache, genLevelComparison, assertLevelComparison } = require('./lib/levels')\nconst { DEFAULT_LEVELS, SORTING_ORDER } = require('./lib/constants')\nconst {\n  createArgsNormalizer,\n  asChindings,\n  buildSafeSonicBoom,\n  buildFormatters,\n  stringify,\n  normalizeDestFileDescriptor,\n  noop\n} = require('./lib/tools')\nconst { version } = require('./lib/meta')\nconst {\n  chindingsSym,\n  redactFmtSym,\n  serializersSym,\n  timeSym,\n  timeSliceIndexSym,\n  streamSym,\n  stringifySym,\n  stringifySafeSym,\n  stringifiersSym,\n  setLevelSym,\n  endSym,\n  formatOptsSym,\n  messageKeySym,\n  errorKeySym,\n  nestedKeySym,\n  mixinSym,\n  levelCompSym,\n  useOnlyCustomLevelsSym,\n  formattersSym,\n  hooksSym,\n  nestedKeyStrSym,\n  mixinMergeStrategySym,\n  msgPrefixSym\n} = symbols\nconst { epochTime, nullTime } = time\nconst { pid } = process\nconst hostname = os.hostname()\nconst defaultErrorSerializer = stdSerializers.err\nconst defaultOptions = {\n  level: 'info',\n  levelComparison: SORTING_ORDER.ASC,\n  levels: DEFAULT_LEVELS,\n  messageKey: 'msg',\n  errorKey: 'err',\n  nestedKey: null,\n  enabled: true,\n  base: { pid, hostname },\n  serializers: Object.assign(Object.create(null), {\n    err: defaultErrorSerializer\n  }),\n  formatters: Object.assign(Object.create(null), {\n    bindings (bindings) {\n      return bindings\n    },\n    level (label, number) {\n      return { level: number }\n    }\n  }),\n  hooks: {\n    logMethod: undefined,\n    streamWrite: undefined\n  },\n  timestamp: epochTime,\n  name: undefined,\n  redact: null,\n  customLevels: null,\n  useOnlyCustomLevels: false,\n  depthLimit: 5,\n  edgeLimit: 100\n}\n\nconst normalize = createArgsNormalizer(defaultOptions)\n\nconst serializers = Object.assign(Object.create(null), stdSerializers)\n\nfunction pino (...args) {\n  const instance = {}\n  const { opts, stream } = normalize(instance, caller(), ...args)\n\n  if (opts.level && typeof opts.level === 'string' && DEFAULT_LEVELS[opts.level.toLowerCase()] !== undefined) opts.level = opts.level.toLowerCase()\n\n  const {\n    redact,\n    crlf,\n    serializers,\n    timestamp,\n    messageKey,\n    errorKey,\n    nestedKey,\n    base,\n    name,\n    level,\n    customLevels,\n    levelComparison,\n    mixin,\n    mixinMergeStrategy,\n    useOnlyCustomLevels,\n    formatters,\n    hooks,\n    depthLimit,\n    edgeLimit,\n    onChild,\n    msgPrefix\n  } = opts\n\n  const stringifySafe = configure({\n    maximumDepth: depthLimit,\n    maximumBreadth: edgeLimit\n  })\n\n  const allFormatters = buildFormatters(\n    formatters.level,\n    formatters.bindings,\n    formatters.log\n  )\n\n  const stringifyFn = stringify.bind({\n    [stringifySafeSym]: stringifySafe\n  })\n  const stringifiers = redact ? redaction(redact, stringifyFn) : {}\n  const formatOpts = redact\n    ? { stringify: stringifiers[redactFmtSym] }\n    : { stringify: stringifyFn }\n  const end = '}' + (crlf ? '\\r\\n' : '\\n')\n  const coreChindings = asChindings.bind(null, {\n    [chindingsSym]: '',\n    [serializersSym]: serializers,\n    [stringifiersSym]: stringifiers,\n    [stringifySym]: stringify,\n    [stringifySafeSym]: stringifySafe,\n    [formattersSym]: allFormatters\n  })\n\n  let chindings = ''\n  if (base !== null) {\n    if (name === undefined) {\n      chindings = coreChindings(base)\n    } else {\n      chindings = coreChindings(Object.assign({}, base, { name }))\n    }\n  }\n\n  const time = (timestamp instanceof Function)\n    ? timestamp\n    : (timestamp ? epochTime : nullTime)\n  const timeSliceIndex = time().indexOf(':') + 1\n\n  if (useOnlyCustomLevels && !customLevels) throw Error('customLevels is required if useOnlyCustomLevels is set true')\n  if (mixin && typeof mixin !== 'function') throw Error(`Unknown mixin type \"${typeof mixin}\" - expected \"function\"`)\n  if (msgPrefix && typeof msgPrefix !== 'string') throw Error(`Unknown msgPrefix type \"${typeof msgPrefix}\" - expected \"string\"`)\n\n  assertDefaultLevelFound(level, customLevels, useOnlyCustomLevels)\n  const levels = mappings(customLevels, useOnlyCustomLevels)\n\n  if (typeof stream.emit === 'function') {\n    stream.emit('message', { code: 'PINO_CONFIG', config: { levels, messageKey, errorKey } })\n  }\n\n  assertLevelComparison(levelComparison)\n  const levelCompFunc = genLevelComparison(levelComparison)\n\n  Object.assign(instance, {\n    levels,\n    [levelCompSym]: levelCompFunc,\n    [useOnlyCustomLevelsSym]: useOnlyCustomLevels,\n    [streamSym]: stream,\n    [timeSym]: time,\n    [timeSliceIndexSym]: timeSliceIndex,\n    [stringifySym]: stringify,\n    [stringifySafeSym]: stringifySafe,\n    [stringifiersSym]: stringifiers,\n    [endSym]: end,\n    [formatOptsSym]: formatOpts,\n    [messageKeySym]: messageKey,\n    [errorKeySym]: errorKey,\n    [nestedKeySym]: nestedKey,\n    // protect against injection\n    [nestedKeyStrSym]: nestedKey ? `,${JSON.stringify(nestedKey)}:{` : '',\n    [serializersSym]: serializers,\n    [mixinSym]: mixin,\n    [mixinMergeStrategySym]: mixinMergeStrategy,\n    [chindingsSym]: chindings,\n    [formattersSym]: allFormatters,\n    [hooksSym]: hooks,\n    silent: noop,\n    onChild,\n    [msgPrefixSym]: msgPrefix\n  })\n\n  Object.setPrototypeOf(instance, proto())\n\n  genLsCache(instance)\n\n  instance[setLevelSym](level)\n\n  return instance\n}\n\nmodule.exports = pino\n\nmodule.exports.destination = (dest = process.stdout.fd) => {\n  if (typeof dest === 'object') {\n    dest.dest = normalizeDestFileDescriptor(dest.dest || process.stdout.fd)\n    return buildSafeSonicBoom(dest)\n  } else {\n    return buildSafeSonicBoom({ dest: normalizeDestFileDescriptor(dest), minLength: 0 })\n  }\n}\n\nmodule.exports.transport = require('./lib/transport')\nmodule.exports.multistream = require('./lib/multistream')\n\nmodule.exports.levels = mappings()\nmodule.exports.stdSerializers = serializers\nmodule.exports.stdTimeFunctions = Object.assign({}, time)\nmodule.exports.symbols = symbols\nmodule.exports.version = version\n\n// Enables default and name export with TypeScript and Babel\nmodule.exports.default = pino\nmodule.exports.pino = pino\n","/**\n * Modern Performance Monitoring System\n *\n * Comprehensive performance tracking with metrics collection,\n * error reporting, and real-time monitoring capabilities.\n */\n\nexport interface PerformanceMetric {\n  name: string;\n  value: number;\n  unit: string;\n  timestamp: number;\n  tags?: Record<string, string>;\n}\n\nexport interface ErrorReport {\n  id: string;\n  message: string;\n  stack?: string;\n  timestamp: number;\n  severity: 'low' | 'medium' | 'high' | 'critical';\n  context?: Record<string, unknown>;\n  userId?: string;\n  sessionId?: string;\n}\n\nexport interface MonitoringConfig {\n  enabled: boolean;\n  endpoint?: string;\n  apiKey?: string;\n  batchSize?: number;\n  flushInterval?: number;\n  enableRealtime?: boolean;\n}\n\nexport class PerformanceMonitor {\n  private metrics: PerformanceMetric[] = [];\n  private errors: ErrorReport[] = [];\n  private config: MonitoringConfig;\n  private batchTimer?: NodeJS.Timeout | undefined;\n\n  constructor(config: MonitoringConfig) {\n    this.config = config;\n    if (config.enabled && config.flushInterval) {\n      this.startBatchReporting();\n    }\n  }\n\n  /**\n   * Record a performance metric\n   */\n  recordMetric(\n    name: string,\n    value: number,\n    unit: string = 'ms',\n    tags?: Record<string, string>,\n  ): void {\n    if (!this.config.enabled) return;\n\n    const metric: PerformanceMetric = {\n      name,\n      value,\n      unit,\n      timestamp: Date.now(),\n      ...(tags && { tags }),\n    };\n\n    this.metrics.push(metric);\n\n    if (this.config.batchSize && this.metrics.length >= this.config.batchSize) {\n      this.flush();\n    }\n  }\n\n  /**\n   * Record an error\n   */\n  recordError(\n    error: Error | string,\n    severity: ErrorReport['severity'] = 'medium',\n    context?: Record<string, unknown>,\n  ): void {\n    if (!this.config.enabled) return;\n\n    const errorReport: ErrorReport = {\n      id: this.generateId(),\n      message: typeof error === 'string' ? error : error.message,\n      timestamp: Date.now(),\n      severity,\n      sessionId: this.getSessionId(),\n      ...(typeof error === 'object' && error.stack && { stack: error.stack }),\n      ...(context && { context }),\n    };\n\n    this.errors.push(errorReport);\n\n    if (\n      severity === 'critical' ||\n      (this.config.batchSize && this.errors.length >= this.config.batchSize)\n    ) {\n      this.flush();\n    }\n  }\n\n  /**\n   * Measure execution time of a function\n   */\n  async measureAsync<T>(\n    name: string,\n    fn: () => Promise<T>,\n    tags?: Record<string, string>,\n  ): Promise<T> {\n    const start = performance.now();\n    try {\n      const result = await fn();\n      const duration = performance.now() - start;\n      this.recordMetric(name, duration, 'ms', tags);\n      return result;\n    } catch (error) {\n      const duration = performance.now() - start;\n      this.recordMetric(`${name}_error`, duration, 'ms', tags);\n      this.recordError(error as Error, 'high', { operation: name, ...tags });\n      throw error;\n    }\n  }\n\n  /**\n   * Measure execution time of a synchronous function\n   */\n  measure<T>(name: string, fn: () => T, tags?: Record<string, string>): T {\n    const start = performance.now();\n    try {\n      const result = fn();\n      const duration = performance.now() - start;\n      this.recordMetric(name, duration, 'ms', tags);\n      return result;\n    } catch (error) {\n      const duration = performance.now() - start;\n      this.recordMetric(`${name}_error`, duration, 'ms', tags);\n      this.recordError(error as Error, 'high', { operation: name, ...tags });\n      throw error;\n    }\n  }\n\n  /**\n   * Get current metrics\n   */\n  getMetrics(): PerformanceMetric[] {\n    return [...this.metrics];\n  }\n\n  /**\n   * Get current errors\n   */\n  getErrors(): ErrorReport[] {\n    return [...this.errors];\n  }\n\n  /**\n   * Flush metrics and errors to endpoint\n   */\n  async flush(): Promise<void> {\n    if (!this.config.endpoint || (!this.metrics.length && !this.errors.length)) {\n      return;\n    }\n\n    const payload = {\n      metrics: this.metrics,\n      errors: this.errors,\n      timestamp: Date.now(),\n    };\n\n    try {\n      await fetch(this.config.endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(this.config.apiKey && { Authorization: `Bearer ${this.config.apiKey}` }),\n        },\n        body: JSON.stringify(payload),\n      });\n\n      // Clear sent data\n      this.metrics = [];\n      this.errors = [];\n    } catch (error) {\n      console.warn('Failed to send monitoring data:', error);\n    }\n  }\n\n  /**\n   * Start automatic batch reporting\n   */\n  private startBatchReporting(): void {\n    if (this.batchTimer) {\n      clearInterval(this.batchTimer);\n    }\n\n    this.batchTimer = setInterval(() => {\n      this.flush();\n    }, this.config.flushInterval);\n  }\n\n  /**\n   * Stop monitoring and cleanup\n   */\n  stop(): void {\n    if (this.batchTimer) {\n      clearInterval(this.batchTimer);\n      this.batchTimer = undefined;\n    }\n\n    // Final flush\n    this.flush();\n  }\n\n  private generateId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  private getSessionId(): string {\n    // Simple session ID generation - can be enhanced\n    if (typeof window !== 'undefined' && window.sessionStorage) {\n      let sessionId = window.sessionStorage.getItem('monitoring_session_id');\n      if (!sessionId) {\n        sessionId = this.generateId();\n        window.sessionStorage.setItem('monitoring_session_id', sessionId);\n      }\n      return sessionId;\n    }\n    return 'server-session';\n  }\n}\n\n// Default instance\nexport const monitor = new PerformanceMonitor({\n  enabled: process.env.NODE_ENV === 'production',\n  batchSize: 100,\n  flushInterval: 30000, // 30 seconds\n  enableRealtime: false,\n});\n\n// Convenient wrapper functions\nexport const recordMetric = (\n  name: string,\n  value: number,\n  unit?: string,\n  tags?: Record<string, string>,\n) => monitor.recordMetric(name, value, unit, tags);\n\nexport const recordError = (\n  error: Error | string,\n  severity?: ErrorReport['severity'],\n  context?: Record<string, unknown>,\n) => monitor.recordError(error, severity, context);\n\nexport const measureAsync = <T>(\n  name: string,\n  fn: () => Promise<T>,\n  tags?: Record<string, string>,\n) => monitor.measureAsync(name, fn, tags);\n\nexport const measure = <T>(name: string, fn: () => T, tags?: Record<string, string>) =>\n  monitor.measure(name, fn, tags);\n","/**\n * Real-time Monitoring Dashboard\n *\n * Provides real-time monitoring capabilities with WebSocket support,\n * live metrics visualization, and alert management.\n */\n\nexport interface AlertRule {\n  id: string;\n  name: string;\n  metric: string;\n  operator: 'gt' | 'lt' | 'eq' | 'gte' | 'lte';\n  threshold: number;\n  duration?: number; // seconds\n  enabled: boolean;\n}\n\nexport interface Alert {\n  id: string;\n  ruleId: string;\n  message: string;\n  severity: 'info' | 'warning' | 'error' | 'critical';\n  timestamp: number;\n  acknowledged: boolean;\n  resolvedAt?: number;\n}\n\nexport interface LiveMetric {\n  name: string;\n  current: number;\n  previous: number;\n  trend: 'up' | 'down' | 'stable';\n  unit: string;\n  timestamp: number;\n}\n\nexport class RealtimeMonitor {\n  private ws?: WebSocket | undefined;\n  private alerts: Alert[] = [];\n  private alertRules: AlertRule[] = [];\n  private liveMetrics: Map<string, LiveMetric> = new Map();\n  private subscribers: Map<string, Set<(data: any) => void>> = new Map();\n\n  constructor(private websocketUrl?: string) {\n    if (websocketUrl) {\n      this.connect();\n    }\n  }\n\n  /**\n   * Connect to WebSocket for real-time updates\n   */\n  connect(): void {\n    // Skip WebSocket connection in test environment\n    if (typeof globalThis !== 'undefined' && globalThis.process?.env?.NODE_ENV === 'test') {\n      return;\n    }\n\n    if (!this.websocketUrl || (this.ws && this.ws.readyState === 1)) {\n      // 1 = OPEN\n      return;\n    }\n\n    try {\n      // Check if WebSocket is available\n      if (typeof WebSocket === 'undefined') {\n        console.warn('WebSocket not available in this environment');\n        return;\n      }\n\n      this.ws = new WebSocket(this.websocketUrl);\n\n      this.ws.onopen = () => {\n        console.log('Real-time monitoring connected');\n        this.emit('connection', { status: 'connected' });\n      };\n\n      this.ws.onmessage = (event) => {\n        try {\n          const data = JSON.parse(event.data);\n          this.handleMessage(data);\n        } catch (error) {\n          console.error('Failed to parse WebSocket message:', error);\n        }\n      };\n\n      this.ws.onclose = () => {\n        console.log('Real-time monitoring disconnected');\n        this.emit('connection', { status: 'disconnected' });\n\n        // Attempt to reconnect after 5 seconds\n        setTimeout(() => this.connect(), 5000);\n      };\n\n      this.ws.onerror = (error) => {\n        console.error('WebSocket error:', error);\n        this.emit('error', { error });\n      };\n    } catch (error) {\n      console.error('Failed to connect to WebSocket:', error);\n    }\n  }\n\n  /**\n   * Disconnect from WebSocket\n   */\n  disconnect(): void {\n    if (this.ws) {\n      this.ws.close();\n      this.ws = undefined;\n    }\n  }\n\n  /**\n   * Subscribe to events\n   */\n  subscribe(event: string, callback: (data: any) => void): () => void {\n    if (!this.subscribers.has(event)) {\n      this.subscribers.set(event, new Set());\n    }\n\n    this.subscribers.get(event)!.add(callback);\n\n    // Return unsubscribe function\n    return () => {\n      this.subscribers.get(event)?.delete(callback);\n    };\n  }\n\n  /**\n   * Add alert rule\n   */\n  addAlertRule(rule: Omit<AlertRule, 'id'>): string {\n    const alertRule: AlertRule = {\n      id: this.generateId(),\n      ...rule,\n    };\n\n    this.alertRules.push(alertRule);\n    this.emit('alert_rule_added', alertRule);\n\n    return alertRule.id;\n  }\n\n  /**\n   * Remove alert rule\n   */\n  removeAlertRule(id: string): boolean {\n    const index = this.alertRules.findIndex((rule) => rule.id === id);\n    if (index >= 0) {\n      const rule = this.alertRules.splice(index, 1)[0];\n      this.emit('alert_rule_removed', rule);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Update live metric and check alerts\n   */\n  updateMetric(name: string, value: number, unit: string = 'ms'): void {\n    const previous = this.liveMetrics.get(name);\n    const current: LiveMetric = {\n      name,\n      current: value,\n      previous: previous?.current ?? value,\n      trend: this.calculateTrend(value, previous?.current),\n      unit,\n      timestamp: Date.now(),\n    };\n\n    this.liveMetrics.set(name, current);\n    this.emit('metric_updated', current);\n\n    // Check alerts\n    this.checkAlerts(name, value);\n  }\n\n  /**\n   * Get all live metrics\n   */\n  getLiveMetrics(): LiveMetric[] {\n    return Array.from(this.liveMetrics.values());\n  }\n\n  /**\n   * Get active alerts\n   */\n  getActiveAlerts(): Alert[] {\n    return this.alerts.filter((alert) => !alert.acknowledged && !alert.resolvedAt);\n  }\n\n  /**\n   * Acknowledge alert\n   */\n  acknowledgeAlert(id: string): boolean {\n    const alert = this.alerts.find((a) => a.id === id);\n    if (alert && !alert.acknowledged) {\n      alert.acknowledged = true;\n      this.emit('alert_acknowledged', alert);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Resolve alert\n   */\n  resolveAlert(id: string): boolean {\n    const alert = this.alerts.find((a) => a.id === id);\n    if (alert && !alert.resolvedAt) {\n      alert.resolvedAt = Date.now();\n      this.emit('alert_resolved', alert);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Send data through WebSocket\n   */\n  send(data: any): void {\n    if (this.ws?.readyState === WebSocket.OPEN) {\n      this.ws.send(JSON.stringify(data));\n    }\n  }\n\n  private handleMessage(data: any): void {\n    switch (data.type) {\n      case 'metric':\n        this.updateMetric(data.name, data.value, data.unit);\n        break;\n      case 'alert':\n        this.handleIncomingAlert(data);\n        break;\n      case 'system_status':\n        this.emit('system_status', data);\n        break;\n      default:\n        this.emit('message', data);\n    }\n  }\n\n  private handleIncomingAlert(data: any): void {\n    const alert: Alert = {\n      id: data.id || this.generateId(),\n      ruleId: data.ruleId,\n      message: data.message,\n      severity: data.severity,\n      timestamp: data.timestamp || Date.now(),\n      acknowledged: false,\n    };\n\n    this.alerts.push(alert);\n    this.emit('alert_triggered', alert);\n  }\n\n  private checkAlerts(metricName: string, value: number): void {\n    const applicableRules = this.alertRules.filter(\n      (rule) => rule.enabled && rule.metric === metricName,\n    );\n\n    for (const rule of applicableRules) {\n      if (this.evaluateRule(rule, value)) {\n        this.triggerAlert(rule, value);\n      }\n    }\n  }\n\n  private evaluateRule(rule: AlertRule, value: number): boolean {\n    switch (rule.operator) {\n      case 'gt':\n        return value > rule.threshold;\n      case 'gte':\n        return value >= rule.threshold;\n      case 'lt':\n        return value < rule.threshold;\n      case 'lte':\n        return value <= rule.threshold;\n      case 'eq':\n        return value === rule.threshold;\n      default:\n        return false;\n    }\n  }\n\n  private triggerAlert(rule: AlertRule, value: number): void {\n    // Avoid duplicate alerts for the same rule within a short timeframe\n    const recentAlert = this.alerts.find(\n      (alert) =>\n        alert.ruleId === rule.id &&\n        Date.now() - alert.timestamp < (rule.duration || 60) * 1000 &&\n        !alert.resolvedAt,\n    );\n\n    if (recentAlert) return;\n\n    const alert: Alert = {\n      id: this.generateId(),\n      ruleId: rule.id,\n      message: `${rule.name}: ${rule.metric} is ${value} (threshold: ${rule.threshold})`,\n      severity: value > rule.threshold * 2 ? 'critical' : 'warning',\n      timestamp: Date.now(),\n      acknowledged: false,\n    };\n\n    this.alerts.push(alert);\n    this.emit('alert_triggered', alert);\n  }\n\n  private calculateTrend(current: number, previous?: number): 'up' | 'down' | 'stable' {\n    if (!previous || previous === current) return 'stable';\n    return current > previous ? 'up' : 'down';\n  }\n\n  private emit(event: string, data: any): void {\n    const subscribers = this.subscribers.get(event);\n    if (subscribers) {\n      subscribers.forEach((callback) => {\n        try {\n          callback(data);\n        } catch (error) {\n          console.error(`Error in subscriber for event ${event}:`, error);\n        }\n      });\n    }\n  }\n\n  private generateId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n}\n\n// Default instance for real-time monitoring\nexport const realtimeMonitor = new RealtimeMonitor(\n  process.env.MONITORING_WS_URL ||\n    (typeof window !== 'undefined' ? 'ws://localhost:8080/monitoring' : undefined),\n);\n\n// Convenient helper functions\nexport const addAlert = (rule: Omit<AlertRule, 'id'>) => realtimeMonitor.addAlertRule(rule);\nexport const removeAlert = (id: string) => realtimeMonitor.removeAlertRule(id);\nexport const updateLiveMetric = (name: string, value: number, unit?: string) =>\n  realtimeMonitor.updateMetric(name, value, unit);\nexport const getLiveMetrics = () => realtimeMonitor.getLiveMetrics();\nexport const getActiveAlerts = () => realtimeMonitor.getActiveAlerts();\n","/**\n * Monitoring Index\n *\n * Central export point for all monitoring functionality\n */\n\n// Performance monitoring\nexport {\n  measure,\n  measureAsync,\n  monitor,\n  PerformanceMonitor,\n  recordError,\n  recordMetric,\n  type ErrorReport,\n  type MonitoringConfig,\n  type PerformanceMetric,\n} from './performance';\n\n// Real-time monitoring\nexport {\n  addAlert,\n  getActiveAlerts,\n  getLiveMetrics,\n  RealtimeMonitor,\n  realtimeMonitor,\n  removeAlert,\n  updateLiveMetric,\n  type Alert,\n  type AlertRule,\n  type LiveMetric,\n} from './realtime';\n\n// Import for internal use\nimport type { MonitoringConfig } from './performance';\nimport { measure, measureAsync, monitor, recordError, recordMetric } from './performance';\n\n// Monitoring utilities\nexport const createMonitoringConfig = (\n  config: Partial<MonitoringConfig> = {},\n): MonitoringConfig => ({\n  enabled: process.env.NODE_ENV === 'production',\n  batchSize: 100,\n  flushInterval: 30000,\n  enableRealtime: false,\n  ...config,\n});\n\n// Global monitoring setup\nexport const setupMonitoring = (config?: Partial<MonitoringConfig>) => {\n  const monitoringConfig = createMonitoringConfig(config);\n\n  // Setup error boundary for unhandled errors\n  if (typeof window !== 'undefined') {\n    window.addEventListener('error', (event) => {\n      monitor.recordError(event.error || event.message, 'high', {\n        filename: event.filename,\n        lineno: event.lineno,\n        colno: event.colno,\n      });\n    });\n\n    window.addEventListener('unhandledrejection', (event) => {\n      monitor.recordError(event.reason, 'high', {\n        type: 'unhandled_promise_rejection',\n      });\n    });\n  }\n\n  // Setup performance observer for Core Web Vitals\n  if (typeof window !== 'undefined' && 'PerformanceObserver' in window) {\n    try {\n      // Largest Contentful Paint\n      const lcpObserver = new PerformanceObserver((list) => {\n        for (const entry of list.getEntries()) {\n          monitor.recordMetric('lcp', entry.startTime, 'ms', { type: 'core_web_vital' });\n        }\n      });\n      lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] });\n\n      // First Input Delay\n      const fidObserver = new PerformanceObserver((list) => {\n        for (const entry of list.getEntries()) {\n          monitor.recordMetric('fid', (entry as any).processingStart - entry.startTime, 'ms', {\n            type: 'core_web_vital',\n          });\n        }\n      });\n      fidObserver.observe({ entryTypes: ['first-input'] });\n\n      // Cumulative Layout Shift\n      const clsObserver = new PerformanceObserver((list) => {\n        for (const entry of list.getEntries()) {\n          if (!(entry as any).hadRecentInput) {\n            monitor.recordMetric('cls', (entry as any).value, 'score', { type: 'core_web_vital' });\n          }\n        }\n      });\n      clsObserver.observe({ entryTypes: ['layout-shift'] });\n    } catch (error) {\n      console.warn('Failed to setup Core Web Vitals monitoring:', error);\n    }\n  }\n\n  return {\n    config: monitoringConfig,\n    monitor,\n    recordMetric,\n    recordError,\n    measureAsync,\n    measure,\n  };\n};\n","/**\n * HEYS Security Headers Manager v1.4\n * Modern security headers and CSP management\n *\n * @author HEYS Team\n * @version 1.4.0\n * @created 2025-01-31\n */\n\n/**\n * Content Security Policy builder\n */\nexport interface CSPDirectives {\n  'default-src'?: string[];\n  'script-src'?: string[];\n  'style-src'?: string[];\n  'img-src'?: string[];\n  'font-src'?: string[];\n  'connect-src'?: string[];\n  'media-src'?: string[];\n  'object-src'?: string[];\n  'frame-src'?: string[];\n  'worker-src'?: string[];\n  'manifest-src'?: string[];\n  'base-uri'?: string[];\n  'form-action'?: string[];\n  'frame-ancestors'?: string[];\n  'upgrade-insecure-requests'?: boolean;\n  'block-all-mixed-content'?: boolean;\n}\n\nexport class CSPBuilder {\n  public directives: CSPDirectives = {};\n\n  constructor(initialDirectives: CSPDirectives = {}) {\n    this.directives = { ...initialDirectives };\n  }\n\n  /**\n   * Set directive values\n   */\n  setDirective(directive: keyof CSPDirectives, values: string[] | boolean): this {\n    if (typeof values === 'boolean') {\n      (this.directives as any)[directive] = values;\n    } else {\n      (this.directives as any)[directive] = [...values];\n    }\n    return this;\n  }\n\n  /**\n   * Add values to existing directive\n   */\n  addToDirective(directive: keyof CSPDirectives, values: string[]): this {\n    if (!this.directives[directive] || typeof this.directives[directive] === 'boolean') {\n      (this.directives as any)[directive] = [];\n    }\n    const existing = this.directives[directive] as string[];\n    (this.directives as any)[directive] = [...existing, ...values];\n    return this;\n  }\n\n  /**\n   * Build CSP header value\n   */\n  build(): string {\n    const policies: string[] = [];\n\n    Object.entries(this.directives).forEach(([directive, values]) => {\n      if (typeof values === 'boolean' && values) {\n        policies.push(directive);\n      } else if (Array.isArray(values) && values.length > 0) {\n        policies.push(`${directive} ${values.join(' ')}`);\n      }\n    });\n\n    return policies.join('; ');\n  }\n\n  /**\n   * Create strict CSP for production\n   */\n  static strict(): CSPBuilder {\n    return new CSPBuilder({\n      'default-src': [\"'none'\"],\n      'script-src': [\"'self'\"],\n      'style-src': [\"'self'\", \"'unsafe-inline'\"],\n      'img-src': [\"'self'\", 'data:', 'https:'],\n      'font-src': [\"'self'\"],\n      'connect-src': [\"'self'\"],\n      'media-src': [\"'self'\"],\n      'object-src': [\"'none'\"],\n      'frame-src': [\"'none'\"],\n      'base-uri': [\"'self'\"],\n      'form-action': [\"'self'\"],\n      'frame-ancestors': [\"'none'\"],\n      'upgrade-insecure-requests': true,\n      'block-all-mixed-content': true,\n    });\n  }\n\n  /**\n   * Create development-friendly CSP\n   */\n  static development(): CSPBuilder {\n    return new CSPBuilder({\n      'default-src': [\"'self'\"],\n      'script-src': [\"'self'\", \"'unsafe-eval'\", \"'unsafe-inline'\", 'localhost:*'],\n      'style-src': [\"'self'\", \"'unsafe-inline'\", 'localhost:*'],\n      'img-src': [\"'self'\", 'data:', 'https:', 'localhost:*'],\n      'font-src': [\"'self'\", 'localhost:*'],\n      'connect-src': [\"'self'\", 'localhost:*', 'ws:', 'wss:'],\n      'media-src': [\"'self'\", 'localhost:*'],\n      'object-src': [\"'none'\"],\n      'frame-src': [\"'self'\", 'localhost:*'],\n      'base-uri': [\"'self'\"],\n      'form-action': [\"'self'\"],\n    });\n  }\n}\n\n/**\n * Security headers configuration\n */\nexport interface SecurityHeadersConfig {\n  // Content Security Policy\n  csp?: CSPDirectives;\n\n  // HTTP Strict Transport Security\n  hsts?:\n    | {\n        maxAge?: number;\n        includeSubDomains?: boolean;\n        preload?: boolean;\n      }\n    | false;\n\n  // X-Frame-Options\n  frameOptions?: 'DENY' | 'SAMEORIGIN' | string;\n\n  // X-Content-Type-Options\n  contentTypeOptions?: boolean;\n\n  // X-XSS-Protection (legacy)\n  xssProtection?: boolean;\n\n  // Referrer Policy\n  referrerPolicy?:\n    | 'no-referrer'\n    | 'no-referrer-when-downgrade'\n    | 'origin'\n    | 'origin-when-cross-origin'\n    | 'same-origin'\n    | 'strict-origin'\n    | 'strict-origin-when-cross-origin'\n    | 'unsafe-url';\n\n  // Permissions Policy\n  permissionsPolicy?: Record<string, string[]>;\n\n  // Cross-Origin policies\n  crossOriginEmbedderPolicy?: 'unsafe-none' | 'require-corp';\n  crossOriginOpenerPolicy?: 'unsafe-none' | 'same-origin-allow-popups' | 'same-origin';\n  crossOriginResourcePolicy?: 'same-site' | 'same-origin' | 'cross-origin';\n}\n\n/**\n * Security Headers Manager\n */\nexport class SecurityHeadersManager {\n  private config: SecurityHeadersConfig;\n  private isDevelopment: boolean;\n\n  constructor(config: SecurityHeadersConfig = {}, isDevelopment = false) {\n    this.config = config;\n    this.isDevelopment = isDevelopment;\n  }\n\n  /**\n   * Generate all security headers\n   */\n  generateHeaders(): Record<string, string> {\n    const headers: Record<string, string> = {};\n\n    // Content Security Policy\n    if (this.config.csp) {\n      const csp = new CSPBuilder(this.config.csp);\n      headers['Content-Security-Policy'] = csp.build();\n    } else {\n      // Default CSP based on environment\n      const defaultCSP = this.isDevelopment ? CSPBuilder.development() : CSPBuilder.strict();\n      headers['Content-Security-Policy'] = defaultCSP.build();\n    }\n\n    // HTTP Strict Transport Security\n    if (this.config.hsts !== false && !this.isDevelopment) {\n      const hsts = this.config.hsts || {};\n      const maxAge = hsts.maxAge || 31536000; // 1 year\n      let hstsValue = `max-age=${maxAge}`;\n\n      if (hsts.includeSubDomains !== false) {\n        hstsValue += '; includeSubDomains';\n      }\n\n      if (hsts.preload) {\n        hstsValue += '; preload';\n      }\n\n      headers['Strict-Transport-Security'] = hstsValue;\n    }\n\n    // X-Frame-Options\n    headers['X-Frame-Options'] = this.config.frameOptions || 'DENY';\n\n    // X-Content-Type-Options\n    if (this.config.contentTypeOptions !== false) {\n      headers['X-Content-Type-Options'] = 'nosniff';\n    }\n\n    // X-XSS-Protection (legacy, but still useful for older browsers)\n    if (this.config.xssProtection !== false) {\n      headers['X-XSS-Protection'] = '1; mode=block';\n    }\n\n    // Referrer Policy\n    headers['Referrer-Policy'] = this.config.referrerPolicy || 'strict-origin-when-cross-origin';\n\n    // Permissions Policy\n    if (this.config.permissionsPolicy) {\n      const policies = Object.entries(this.config.permissionsPolicy)\n        .map(([feature, allowlist]) => `${feature}=(${allowlist.join(' ')})`)\n        .join(', ');\n      headers['Permissions-Policy'] = policies;\n    } else {\n      // Default restrictive permissions\n      headers['Permissions-Policy'] = [\n        'camera=()',\n        'microphone=()',\n        'geolocation=()',\n        'payment=()',\n        'usb=()',\n        'magnetometer=()',\n        'accelerometer=()',\n        'gyroscope=()',\n      ].join(', ');\n    }\n\n    // Cross-Origin policies\n    headers['Cross-Origin-Embedder-Policy'] =\n      this.config.crossOriginEmbedderPolicy || 'unsafe-none';\n    headers['Cross-Origin-Opener-Policy'] =\n      this.config.crossOriginOpenerPolicy || 'same-origin-allow-popups';\n    headers['Cross-Origin-Resource-Policy'] =\n      this.config.crossOriginResourcePolicy || 'same-origin';\n\n    return headers;\n  }\n\n  /**\n   * Apply headers to Express response\n   */\n  applyToResponse(res: any): void {\n    const headers = this.generateHeaders();\n    Object.entries(headers).forEach(([name, value]) => {\n      res.setHeader(name, value);\n    });\n  }\n\n  /**\n   * Get headers for Fetch API\n   */\n  getFetchHeaders(): Headers {\n    const headers = new Headers();\n    const securityHeaders = this.generateHeaders();\n\n    Object.entries(securityHeaders).forEach(([name, value]) => {\n      headers.set(name, value);\n    });\n\n    return headers;\n  }\n\n  /**\n   * Validate CSP against common mistakes\n   */\n  validateCSP(): { isValid: boolean; warnings: string[]; errors: string[] } {\n    const warnings: string[] = [];\n    const errors: string[] = [];\n    const csp = this.config.csp || {};\n\n    // Check for unsafe directives\n    Object.entries(csp).forEach(([directive, values]) => {\n      if (Array.isArray(values)) {\n        if (values.includes(\"'unsafe-inline'\")) {\n          warnings.push(`${directive} allows 'unsafe-inline' which can enable XSS attacks`);\n        }\n\n        if (values.includes(\"'unsafe-eval'\")) {\n          warnings.push(`${directive} allows 'unsafe-eval' which can enable code injection`);\n        }\n\n        if (values.includes('*')) {\n          warnings.push(`${directive} allows wildcard (*) which is overly permissive`);\n        }\n      }\n    });\n\n    // Check for missing important directives\n    if (!csp['default-src'] && !csp['script-src']) {\n      errors.push('Missing script-src directive - scripts can be loaded from anywhere');\n    }\n\n    if (!csp['object-src']) {\n      warnings.push('Consider setting object-src to prevent plugin injection');\n    }\n\n    if (!csp['base-uri']) {\n      warnings.push('Consider setting base-uri to prevent base tag injection');\n    }\n\n    return {\n      isValid: errors.length === 0,\n      warnings,\n      errors,\n    };\n  }\n\n  /**\n   * Create security headers for different environments\n   */\n  static forEnvironment(\n    env: 'development' | 'staging' | 'production',\n    customConfig: SecurityHeadersConfig = {},\n  ): SecurityHeadersManager {\n    const baseConfigs: Record<string, SecurityHeadersConfig> = {\n      development: {\n        csp: CSPBuilder.development().directives,\n        hsts: false,\n        frameOptions: 'SAMEORIGIN',\n      },\n      staging: {\n        csp: CSPBuilder.strict().addToDirective('script-src', ['staging.example.com']).directives,\n        frameOptions: 'DENY',\n      },\n      production: {\n        csp: CSPBuilder.strict().directives,\n        hsts: {\n          maxAge: 31536000,\n          includeSubDomains: true,\n          preload: true,\n        },\n        frameOptions: 'DENY',\n      },\n    };\n\n    const config = { ...baseConfigs[env], ...customConfig };\n    return new SecurityHeadersManager(config, env === 'development');\n  }\n}\n\n/**\n * CORS configuration\n */\nexport interface CORSConfig {\n  origin?: string | string[] | boolean | ((origin: string | undefined) => boolean);\n  methods?: string[];\n  allowedHeaders?: string[];\n  exposedHeaders?: string[];\n  credentials?: boolean;\n  maxAge?: number;\n  preflightContinue?: boolean;\n  optionsSuccessStatus?: number;\n}\n\n/**\n * CORS manager for secure cross-origin requests\n */\nexport class CORSManager {\n  private config: CORSConfig;\n\n  constructor(config: CORSConfig = {}) {\n    this.config = {\n      origin: false,\n      methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\n      allowedHeaders: ['Content-Type', 'Authorization'],\n      exposedHeaders: [],\n      credentials: false,\n      maxAge: 86400, // 24 hours\n      optionsSuccessStatus: 204,\n      ...config,\n    };\n  }\n\n  /**\n   * Check if origin is allowed\n   */\n  isOriginAllowed(origin: string | undefined): boolean {\n    if (!origin) return true; // Same-origin requests\n\n    if (typeof this.config.origin === 'boolean') {\n      return this.config.origin;\n    }\n\n    if (typeof this.config.origin === 'string') {\n      return this.config.origin === origin;\n    }\n\n    if (Array.isArray(this.config.origin)) {\n      return this.config.origin.includes(origin);\n    }\n\n    if (typeof this.config.origin === 'function') {\n      return this.config.origin(origin);\n    }\n\n    return false;\n  }\n\n  /**\n   * Generate CORS headers\n   */\n  generateHeaders(origin?: string): Record<string, string> {\n    const headers: Record<string, string> = {};\n\n    // Access-Control-Allow-Origin\n    if (this.isOriginAllowed(origin)) {\n      if (this.config.credentials) {\n        headers['Access-Control-Allow-Origin'] = origin || '*';\n      } else {\n        headers['Access-Control-Allow-Origin'] = '*';\n      }\n    }\n\n    // Access-Control-Allow-Methods\n    if (this.config.methods && this.config.methods.length > 0) {\n      headers['Access-Control-Allow-Methods'] = this.config.methods.join(', ');\n    }\n\n    // Access-Control-Allow-Headers\n    if (this.config.allowedHeaders && this.config.allowedHeaders.length > 0) {\n      headers['Access-Control-Allow-Headers'] = this.config.allowedHeaders.join(', ');\n    }\n\n    // Access-Control-Expose-Headers\n    if (this.config.exposedHeaders && this.config.exposedHeaders.length > 0) {\n      headers['Access-Control-Expose-Headers'] = this.config.exposedHeaders.join(', ');\n    }\n\n    // Access-Control-Allow-Credentials\n    if (this.config.credentials) {\n      headers['Access-Control-Allow-Credentials'] = 'true';\n    }\n\n    // Access-Control-Max-Age\n    if (this.config.maxAge !== undefined) {\n      headers['Access-Control-Max-Age'] = this.config.maxAge.toString();\n    }\n\n    return headers;\n  }\n\n  /**\n   * Create secure CORS configuration\n   */\n  static secure(allowedOrigins: string[]): CORSManager {\n    return new CORSManager({\n      origin: allowedOrigins,\n      methods: ['GET', 'POST', 'PUT', 'DELETE'],\n      allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],\n      credentials: true,\n      maxAge: 86400,\n    });\n  }\n\n  /**\n   * Create development CORS configuration\n   */\n  static development(): CORSManager {\n    return new CORSManager({\n      origin: true,\n      methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS', 'PATCH'],\n      allowedHeaders: ['*'],\n      credentials: true,\n    });\n  }\n}\n\n/**\n * Default security headers manager instance\n */\nexport const defaultSecurityHeaders = SecurityHeadersManager.forEnvironment(\n  process.env.NODE_ENV === 'production' ? 'production' : 'development',\n);\n\n/**\n * Default CORS manager instance\n */\nexport const defaultCORS =\n  process.env.NODE_ENV === 'production' ? CORSManager.secure([]) : CORSManager.development();\n","/**\n * HEYS Penetration Testing Framework\n * Automated security testing and vulnerability assessment\n *\n * @author HEYS Team\n * @version 1.4.0\n * @created 2025-01-31\n */\n\nimport { defaultValidator } from '../security';\n\n/**\n * Vulnerability scanner interface\n */\nexport interface VulnerabilityScanner {\n  name: string;\n  description: string;\n  severity: 'low' | 'medium' | 'high' | 'critical';\n  scan(target: any): Promise<VulnerabilityResult[]>;\n}\n\n/**\n * Vulnerability result\n */\nexport interface VulnerabilityResult {\n  id: string;\n  scanner: string;\n  severity: 'low' | 'medium' | 'high' | 'critical';\n  title: string;\n  description: string;\n  location?: string;\n  evidence?: any;\n  remediation?: string;\n  cve?: string;\n  timestamp: Date;\n}\n\n/**\n * Penetration test report\n */\nexport interface PenetrationTestReport {\n  id: string;\n  targetName: string;\n  startTime: Date;\n  endTime: Date;\n  vulnerabilities: VulnerabilityResult[];\n  summary: {\n    totalVulnerabilities: number;\n    criticalCount: number;\n    highCount: number;\n    mediumCount: number;\n    lowCount: number;\n  };\n  recommendations: string[];\n}\n\n/**\n * XSS vulnerability scanner\n */\nexport class XSSScanner implements VulnerabilityScanner {\n  name = 'XSS Scanner';\n  description = 'Cross-Site Scripting vulnerability detection';\n  severity = 'high' as const;\n\n  private readonly xssPayloads = [\n    '<script>alert(\"XSS\")</script>',\n    '\"><script>alert(\"XSS\")</script>',\n    '<img src=x onerror=alert(\"XSS\")>',\n    'javascript:alert(\"XSS\")',\n    '<svg onload=alert(\"XSS\")>',\n    '\\\"><script>alert(\"XSS\")</script>',\n    '<script>console.log(\"XSS\")</script>',\n    '<iframe src=\"javascript:alert(\\'XSS\\')\"></iframe>',\n  ];\n\n  async scan(target: { [key: string]: any }): Promise<VulnerabilityResult[]> {\n    const vulnerabilities: VulnerabilityResult[] = [];\n\n    for (const [key, value] of Object.entries(target)) {\n      if (typeof value === 'string') {\n        for (const payload of this.xssPayloads) {\n          // Static analysis - NO EXECUTION of dangerous code\n          const testValue = value + payload;\n          \n          // Use safe static analysis instead of DOM manipulation\n          const containsDangerousPatterns = this.detectXSSPatterns(testValue);\n          \n          if (containsDangerousPatterns.length > 0) {\n            vulnerabilities.push({\n              id: this.generateId(),\n              scanner: this.name,\n              severity: this.severity,\n              title: 'Cross-Site Scripting (XSS) Vulnerability',\n              description: `Field \"${key}\" contains potentially dangerous XSS patterns: ${containsDangerousPatterns.join(', ')}`,\n              location: key,\n              evidence: { \n                payload, \n                original: value, \n                detectedPatterns: containsDangerousPatterns,\n                testValue: testValue.substring(0, 100) // Limited preview for safety\n              },\n              remediation: 'Implement proper input validation and output encoding with Content Security Policy',\n              timestamp: new Date(),\n            });\n          }\n        }\n      }\n    }\n\n    return vulnerabilities;\n  }\n\n  /**\n   * Safe static analysis for XSS patterns - NO CODE EXECUTION\n   */\n  private detectXSSPatterns(input: string): string[] {\n    const patterns = [\n      { name: 'script_tag', regex: /<script[\\s\\S]*?>[\\s\\S]*?<\\/script>/gi },\n      { name: 'javascript_protocol', regex: /javascript:/gi },\n      { name: 'event_handlers', regex: /on\\w+\\s*=\\s*[\"'][^\"']*[\"']/gi },\n      { name: 'svg_onload', regex: /<svg[^>]*onload/gi },\n      { name: 'img_onerror', regex: /<img[^>]*onerror/gi },\n      { name: 'iframe_javascript', regex: /<iframe[^>]*src\\s*=\\s*[\"']javascript:/gi },\n      { name: 'data_protocol', regex: /data:text\\/html/gi },\n      { name: 'vbscript', regex: /vbscript:/gi },\n    ];\n\n    const detectedPatterns: string[] = [];\n    \n    for (const pattern of patterns) {\n      if (pattern.regex.test(input)) {\n        detectedPatterns.push(pattern.name);\n      }\n    }\n\n    return detectedPatterns;\n  }\n\n  private generateId(): string {\n    return `xss-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n}\n\n/**\n * SQL Injection scanner\n */\nexport class SQLInjectionScanner implements VulnerabilityScanner {\n  name = 'SQL Injection Scanner';\n  description = 'SQL Injection vulnerability detection';\n  severity = 'critical' as const;\n\n  private readonly sqlPayloads = [\n    \"' OR '1'='1\",\n    \"'; DROP TABLE users; --\",\n    \"1' OR '1'='1\",\n    \"admin'--\",\n    \"admin'/*\",\n    \"' OR 1=1--\",\n    \"' UNION SELECT * FROM users--\",\n    \"1; UPDATE users SET password='hacked'--\",\n  ];\n\n  async scan(target: { [key: string]: any }): Promise<VulnerabilityResult[]> {\n    const vulnerabilities: VulnerabilityResult[] = [];\n\n    for (const [key, value] of Object.entries(target)) {\n      if (typeof value === 'string') {\n        for (const payload of this.sqlPayloads) {\n          // Check if SQL injection patterns are detected\n          if (this.detectSQLInjection(value + payload)) {\n            vulnerabilities.push({\n              id: this.generateId(),\n              scanner: this.name,\n              severity: this.severity,\n              title: 'SQL Injection Vulnerability',\n              description: `Field \"${key}\" may be vulnerable to SQL injection`,\n              location: key,\n              evidence: { payload, original: value },\n              remediation: 'Use parameterized queries and input validation',\n              cve: 'CWE-89',\n              timestamp: new Date(),\n            });\n          }\n        }\n      }\n    }\n\n    return vulnerabilities;\n  }\n\n  private detectSQLInjection(input: string): boolean {\n    const sqlPatterns = [\n      /(\\bOR\\b|\\bAND\\b).*?=.*?(\\b1\\b|\\b'1'\\b)/i,\n      /(\\bUNION\\b|\\bSELECT\\b|\\bINSERT\\b|\\bUPDATE\\b|\\bDELETE\\b|\\bDROP\\b)/i,\n      /('|\\\").*?(\\bOR\\b|\\bAND\\b).*?('|\\\")/i,\n      /--|\\#|\\/\\*/,\n    ];\n\n    return sqlPatterns.some((pattern) => pattern.test(input));\n  }\n\n  private generateId(): string {\n    return `sqli-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n}\n\n/**\n * Input validation scanner\n */\nexport class InputValidationScanner implements VulnerabilityScanner {\n  name = 'Input Validation Scanner';\n  description = 'Input validation and sanitization testing';\n  severity = 'medium' as const;\n\n  async scan(target: { [key: string]: any }): Promise<VulnerabilityResult[]> {\n    const vulnerabilities: VulnerabilityResult[] = [];\n\n    for (const [key, _value] of Object.entries(target)) {\n      // Test various validation scenarios\n      const testCases = [\n        { name: 'Long input', value: 'A'.repeat(10000) },\n        { name: 'Special characters', value: '!@#$%^&*()_+{}|:\"<>?[]\\\\;\\',./' },\n        { name: 'Unicode characters', value: '' },\n        { name: 'Null bytes', value: 'test\\x00test' },\n        { name: 'HTML entities', value: '&lt;script&gt;alert(&quot;test&quot;)&lt;/script&gt;' },\n      ];\n\n      for (const testCase of testCases) {\n        try {\n          // Try to validate the test input\n          const validation = defaultValidator.validateInput(testCase.value, 'text', {\n            sanitize: true,\n            required: false,\n          });\n\n          // Check if validation is properly handling edge cases\n          if (!validation.isValid && !validation.errors?.length) {\n            vulnerabilities.push({\n              id: this.generateId(),\n              scanner: this.name,\n              severity: this.severity,\n              title: 'Insufficient Input Validation',\n              description: `Field \"${key}\" may not properly validate ${testCase.name}`,\n              location: key,\n              evidence: { testCase: testCase.name, input: testCase.value },\n              remediation: 'Implement comprehensive input validation',\n              timestamp: new Date(),\n            });\n          }\n        } catch (error) {\n          vulnerabilities.push({\n            id: this.generateId(),\n            scanner: this.name,\n            severity: 'high',\n            title: 'Input Validation Error',\n            description: `Field \"${key}\" causes validation errors with ${testCase.name}`,\n            location: key,\n            evidence: { testCase: testCase.name, error: (error as Error).message },\n            remediation: 'Fix input validation error handling',\n            timestamp: new Date(),\n          });\n        }\n      }\n    }\n\n    return vulnerabilities;\n  }\n\n  private generateId(): string {\n    return `input-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n}\n\n/**\n * Authentication bypass scanner\n */\nexport class AuthBypassScanner implements VulnerabilityScanner {\n  name = 'Authentication Bypass Scanner';\n  description = 'Authentication and authorization vulnerability testing';\n  severity = 'critical' as const;\n\n  async scan(target: { [key: string]: any }): Promise<VulnerabilityResult[]> {\n    const vulnerabilities: VulnerabilityResult[] = [];\n\n    // Check for common authentication bypass patterns\n    const authFields = ['password', 'token', 'auth', 'authorization', 'session'];\n    const bypassAttempts = [\n      '',\n      null,\n      undefined,\n      'admin',\n      'password',\n      '123456',\n      'null',\n      'false',\n      '0',\n      '[]',\n      '{}',\n    ];\n\n    for (const field of authFields) {\n      if (target.hasOwnProperty(field)) {\n        for (const attempt of bypassAttempts) {\n          // Simulate bypass attempt (removed unused variable)\n\n          vulnerabilities.push({\n            id: this.generateId(),\n            scanner: this.name,\n            severity: this.severity,\n            title: 'Potential Authentication Bypass',\n            description: `Authentication field \"${field}\" should be tested against bypass attempts`,\n            location: field,\n            evidence: { field, bypassAttempt: attempt },\n            remediation: 'Implement secure authentication validation and proper session management',\n            cve: 'CWE-287',\n            timestamp: new Date(),\n          });\n        }\n      }\n    }\n\n    return vulnerabilities;\n  }\n\n  private generateId(): string {\n    return `auth-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n}\n\n/**\n * Main penetration testing framework\n */\nexport class PenetrationTestFramework {\n  private scanners: VulnerabilityScanner[] = [];\n\n  constructor() {\n    // Register default scanners\n    this.registerScanner(new XSSScanner());\n    this.registerScanner(new SQLInjectionScanner());\n    this.registerScanner(new InputValidationScanner());\n    this.registerScanner(new AuthBypassScanner());\n  }\n\n  /**\n   * Register a new vulnerability scanner\n   */\n  registerScanner(scanner: VulnerabilityScanner): void {\n    this.scanners.push(scanner);\n  }\n\n  /**\n   * Run comprehensive penetration test\n   */\n  async runPenetrationTest(\n    targetName: string,\n    target: any,\n    options: {\n      includeScanners?: string[];\n      excludeScanners?: string[];\n      severity?: ('low' | 'medium' | 'high' | 'critical')[];\n    } = {},\n  ): Promise<PenetrationTestReport> {\n    const startTime = new Date();\n    let allVulnerabilities: VulnerabilityResult[] = [];\n\n    // Filter scanners based on options\n    let scannersToRun = this.scanners;\n\n    if (options.includeScanners) {\n      scannersToRun = scannersToRun.filter((s) => options.includeScanners!.includes(s.name));\n    }\n\n    if (options.excludeScanners) {\n      scannersToRun = scannersToRun.filter((s) => !options.excludeScanners!.includes(s.name));\n    }\n\n    if (options.severity) {\n      scannersToRun = scannersToRun.filter((s) => options.severity!.includes(s.severity));\n    }\n\n    // Run all scanners\n    for (const scanner of scannersToRun) {\n      try {\n        console.log(`Running ${scanner.name}...`);\n        const vulnerabilities = await scanner.scan(target);\n        allVulnerabilities = allVulnerabilities.concat(vulnerabilities);\n      } catch (error) {\n        console.error(`Scanner ${scanner.name} failed:`, error);\n      }\n    }\n\n    const endTime = new Date();\n\n    // Generate summary\n    const summary = {\n      totalVulnerabilities: allVulnerabilities.length,\n      criticalCount: allVulnerabilities.filter((v) => v.severity === 'critical').length,\n      highCount: allVulnerabilities.filter((v) => v.severity === 'high').length,\n      mediumCount: allVulnerabilities.filter((v) => v.severity === 'medium').length,\n      lowCount: allVulnerabilities.filter((v) => v.severity === 'low').length,\n    };\n\n    // Generate recommendations\n    const recommendations = this.generateRecommendations(allVulnerabilities);\n\n    return {\n      id: `pentest-${Date.now()}`,\n      targetName,\n      startTime,\n      endTime,\n      vulnerabilities: allVulnerabilities,\n      summary,\n      recommendations,\n    };\n  }\n\n  /**\n   * Generate security recommendations based on vulnerabilities\n   */\n  private generateRecommendations(vulnerabilities: VulnerabilityResult[]): string[] {\n    const recommendations = new Set<string>();\n\n    vulnerabilities.forEach((vuln) => {\n      if (vuln.remediation) {\n        recommendations.add(vuln.remediation);\n      }\n\n      // Add general recommendations based on vulnerability type\n      if (vuln.scanner.includes('XSS')) {\n        recommendations.add('Implement Content Security Policy (CSP) headers');\n        recommendations.add('Use secure templating engines with auto-escaping');\n      }\n\n      if (vuln.scanner.includes('SQL')) {\n        recommendations.add('Use parameterized queries or ORM');\n        recommendations.add('Implement principle of least privilege for database access');\n      }\n\n      if (vuln.scanner.includes('Auth')) {\n        recommendations.add('Implement multi-factor authentication');\n        recommendations.add('Use secure session management');\n        recommendations.add('Implement account lockout mechanisms');\n      }\n    });\n\n    // Add general security recommendations\n    if (vulnerabilities.length > 0) {\n      recommendations.add('Conduct regular security audits');\n      recommendations.add('Implement security monitoring and logging');\n      recommendations.add('Keep all dependencies updated');\n      recommendations.add('Provide security training for development team');\n    }\n\n    return Array.from(recommendations);\n  }\n\n  /**\n   * Export test report to JSON\n   */\n  exportReport(report: PenetrationTestReport): string {\n    return JSON.stringify(report, null, 2);\n  }\n\n  /**\n   * Generate HTML report\n   */\n  generateHtmlReport(report: PenetrationTestReport): string {\n    const severityColors = {\n      critical: '#dc3545',\n      high: '#fd7e14',\n      medium: '#ffc107',\n      low: '#198754',\n    };\n\n    return `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Penetration Test Report - ${report.targetName}</title>\n    <style>\n        body { font-family: Arial, sans-serif; margin: 40px; }\n        .header { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }\n        .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }\n        .summary-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }\n        .vulnerability { background: white; padding: 20px; margin-bottom: 20px; border-left: 4px solid #ddd; border-radius: 4px; }\n        .critical { border-left-color: ${severityColors.critical}; }\n        .high { border-left-color: ${severityColors.high}; }\n        .medium { border-left-color: ${severityColors.medium}; }\n        .low { border-left-color: ${severityColors.low}; }\n        .recommendations { background: #e7f3ff; padding: 20px; border-radius: 8px; margin-top: 30px; }\n        .severity-badge { padding: 4px 8px; color: white; border-radius: 4px; font-size: 12px; }\n        code { background: #f1f3f4; padding: 2px 4px; border-radius: 3px; }\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <h1>Penetration Test Report</h1>\n        <p><strong>Target:</strong> ${report.targetName}</p>\n        <p><strong>Test Period:</strong> ${report.startTime.toISOString()} - ${report.endTime.toISOString()}</p>\n        <p><strong>Duration:</strong> ${Math.round((report.endTime.getTime() - report.startTime.getTime()) / 1000)} seconds</p>\n    </div>\n\n    <div class=\"summary\">\n        <div class=\"summary-card\">\n            <h3>Total Vulnerabilities</h3>\n            <h2>${report.summary.totalVulnerabilities}</h2>\n        </div>\n        <div class=\"summary-card\">\n            <h3>Critical</h3>\n            <h2 style=\"color: ${severityColors.critical}\">${report.summary.criticalCount}</h2>\n        </div>\n        <div class=\"summary-card\">\n            <h3>High</h3>\n            <h2 style=\"color: ${severityColors.high}\">${report.summary.highCount}</h2>\n        </div>\n        <div class=\"summary-card\">\n            <h3>Medium</h3>\n            <h2 style=\"color: ${severityColors.medium}\">${report.summary.mediumCount}</h2>\n        </div>\n        <div class=\"summary-card\">\n            <h3>Low</h3>\n            <h2 style=\"color: ${severityColors.low}\">${report.summary.lowCount}</h2>\n        </div>\n    </div>\n\n    <h2>Vulnerabilities</h2>\n    ${report.vulnerabilities\n      .map(\n        (vuln) => `\n        <div class=\"vulnerability ${vuln.severity}\">\n            <h3>${vuln.title}</h3>\n            <span class=\"severity-badge\" style=\"background-color: ${severityColors[vuln.severity]}\">${vuln.severity.toUpperCase()}</span>\n            <p><strong>Scanner:</strong> ${vuln.scanner}</p>\n            <p><strong>Location:</strong> ${vuln.location || 'N/A'}</p>\n            <p><strong>Description:</strong> ${vuln.description}</p>\n            ${vuln.remediation ? `<p><strong>Remediation:</strong> ${vuln.remediation}</p>` : ''}\n            ${vuln.evidence ? `<p><strong>Evidence:</strong> <code>${JSON.stringify(vuln.evidence, null, 2)}</code></p>` : ''}\n            ${vuln.cve ? `<p><strong>CVE:</strong> ${vuln.cve}</p>` : ''}\n            <p><strong>Timestamp:</strong> ${vuln.timestamp.toISOString()}</p>\n        </div>\n    `,\n      )\n      .join('')}\n\n    <div class=\"recommendations\">\n        <h2>Recommendations</h2>\n        <ul>\n            ${report.recommendations.map((rec) => `<li>${rec}</li>`).join('')}\n        </ul>\n    </div>\n</body>\n</html>\n    `;\n  }\n}\n\n/**\n * Default penetration testing framework instance\n */\nexport const defaultPentestFramework = new PenetrationTestFramework();\n","/**\n * HEYS Security Layer v1.4\n * Modern validation and security system\n *\n * @author HEYS Team\n * @version 1.4.0\n * @created 2025-01-31\n */\n\nimport DOMPurify, { type Config as DOMPurifyConfig } from 'dompurify';\nimport { z } from 'zod';\n\n/**\n * Base validation schema definitions\n */\nexport const ValidationSchemas = {\n  // User data validation\n  user: z.object({\n    id: z.string().uuid(),\n    email: z.string().email(),\n    username: z\n      .string()\n      .min(3)\n      .max(50)\n      .regex(/^[a-zA-Z0-9_-]+$/),\n    password: z.string().min(8).max(128),\n    role: z.enum(['admin', 'user', 'moderator', 'guest']),\n    isActive: z.boolean().default(true),\n    createdAt: z.date().optional(),\n    updatedAt: z.date().optional(),\n  }),\n\n  // Content validation\n  content: z.object({\n    id: z.string().uuid(),\n    title: z.string().min(1).max(200),\n    content: z.string().max(10000),\n    authorId: z.string().uuid(),\n    tags: z.array(z.string()).max(10).optional(),\n    isPublic: z.boolean().default(false),\n    metadata: z.record(z.unknown()).optional(),\n  }),\n\n  // File upload validation\n  file: z.object({\n    name: z.string().min(1).max(255),\n    type: z.string().regex(/^[a-zA-Z0-9/.\\-]+$/),\n    size: z\n      .number()\n      .min(1)\n      .max(10 * 1024 * 1024), // 10MB max\n    content: z.string().or(z.instanceof(ArrayBuffer)),\n  }),\n\n  // API request validation\n  apiRequest: z.object({\n    method: z.enum(['GET', 'POST', 'PUT', 'DELETE', 'PATCH']),\n    path: z.string().regex(/^\\/[a-zA-Z0-9/_-]*$/),\n    headers: z.record(z.string()).optional(),\n    body: z.unknown().optional(),\n    query: z.record(z.string()).optional(),\n  }),\n};\n\n/**\n * Advanced input sanitization\n */\nexport class InputSanitizer {\n  private readonly dompurify: typeof DOMPurify;\n  private readonly config: DOMPurifyConfig;\n\n  constructor(purifier: typeof DOMPurify = DOMPurify) {\n    this.dompurify = purifier;\n    this.config = {\n      ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'a', 'p', 'br'],\n      ALLOWED_ATTR: ['href', 'title'],\n      ALLOW_DATA_ATTR: false,\n      ALLOW_UNKNOWN_PROTOCOLS: false,\n      SANITIZE_DOM: true,\n      KEEP_CONTENT: true,\n    };\n  }\n\n  /**\n   * Sanitize HTML content\n   */\n  sanitizeHTML(input: string): string {\n    if (typeof input !== 'string') {\n      throw new Error('Input must be a string');\n    }\n    return this.sanitizeToString(input, this.config);\n  }\n\n  /**\n   * Sanitize plain text (remove all HTML)\n   */\n  sanitizeText(input: string): string {\n    if (typeof input !== 'string') {\n      throw new Error('Input must be a string');\n    }\n    return this.sanitizeToString(input, { ALLOWED_TAGS: [] });\n  }\n\n  /**\n   * Sanitize SQL input (basic protection)\n   */\n  sanitizeSQL(input: string): string {\n    if (typeof input !== 'string') {\n      throw new Error('Input must be a string');\n    }\n\n    // Remove dangerous SQL patterns\n    const dangerous = [\n      /('|(\\\\'))/gi,\n      /(;|--|\\||\\|\\||&&)/gi,\n      /(union|select|insert|update|delete|drop|create|alter|exec|execute)/gi,\n      /(\\*|%|_)/gi,\n    ];\n\n    let sanitized = input;\n    dangerous.forEach((pattern) => {\n      sanitized = sanitized.replace(pattern, '');\n    });\n\n    return sanitized.trim();\n  }\n\n  /**\n   * Sanitize file name\n   */\n  sanitizeFileName(input: string): string {\n    if (typeof input !== 'string') {\n      throw new Error('Input must be a string');\n    }\n\n    return input\n      .replace(/[^a-zA-Z0-9._-]/g, '')\n      .replace(/\\.{2,}/g, '.')\n      .substring(0, 255);\n  }\n\n  private sanitizeToString(input: string, config?: DOMPurifyConfig): string {\n    const result = this.dompurify.sanitize(input, config);\n    if (typeof result === 'string') {\n      return result;\n    }\n\n    if (result && typeof (result as { toString?: () => string }).toString === 'function') {\n      return (result as { toString: () => string }).toString();\n    }\n\n    return String(result ?? '');\n  }\n}\n\n/**\n * Security rule definitions\n */\nexport interface SecurityRule {\n  name: string;\n  validator: (value: unknown, context?: unknown) => boolean;\n  message: string;\n  severity: 'low' | 'medium' | 'high' | 'critical';\n}\n\nexport const SecurityRules: Record<string, SecurityRule> = {\n  noXSS: {\n    name: 'XSS Protection',\n    validator: (value: unknown) => {\n      if (typeof value !== 'string') return true;\n      const xssPatterns = [\n        /<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi,\n        /javascript:/gi,\n        /on\\w+\\s*=/gi,\n        /<iframe/gi,\n        /<object/gi,\n        /<embed/gi,\n      ];\n      return !xssPatterns.some((pattern) => pattern.test(value));\n    },\n    message: 'Potential XSS attack detected',\n    severity: 'critical',\n  },\n\n  noSQLInjection: {\n    name: 'SQL Injection Protection',\n    validator: (value: unknown) => {\n      if (typeof value !== 'string') return true;\n      const sqlPatterns = [\n        /('|(\\\\'))/gi,\n        /(;|--|\\||\\|\\||&&)/gi,\n        /\\b(union|select|insert|update|delete|drop|create|alter|exec|execute)\\b/gi,\n      ];\n      return !sqlPatterns.some((pattern) => pattern.test(value));\n    },\n    message: 'Potential SQL injection detected',\n    severity: 'critical',\n  },\n\n  validEmail: {\n    name: 'Email Validation',\n    validator: (value: unknown) => {\n      if (typeof value !== 'string') return false;\n      return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(value);\n    },\n    message: 'Invalid email format',\n    severity: 'medium',\n  },\n\n  strongPassword: {\n    name: 'Strong Password',\n    validator: (value: unknown) => {\n      if (typeof value !== 'string') return false;\n      return (\n        value.length >= 8 &&\n        /[A-Z]/.test(value) &&\n        /[a-z]/.test(value) &&\n        /[0-9]/.test(value) &&\n        /[^A-Za-z0-9]/.test(value)\n      );\n    },\n    message:\n      'Password must be at least 8 characters with uppercase, lowercase, number, and special character',\n    severity: 'high',\n  },\n\n  noPathTraversal: {\n    name: 'Path Traversal Protection',\n    validator: (value: unknown) => {\n      if (typeof value !== 'string') return true;\n      return !/(\\.\\.\\/|\\.\\.\\\\)/g.test(value);\n    },\n    message: 'Path traversal attempt detected',\n    severity: 'high',\n  },\n};\n\n/**\n * Validation result interface\n */\nexport interface ValidationResult {\n  isValid: boolean;\n  errors: ValidationError[];\n  warnings: ValidationWarning[];\n  sanitized?: unknown;\n}\n\nexport interface ValidationError {\n  field: string;\n  rule: string;\n  message: string;\n  severity: 'low' | 'medium' | 'high' | 'critical';\n  value?: unknown;\n}\n\nexport interface ValidationWarning {\n  field: string;\n  message: string;\n  suggestion?: string;\n}\n\n/**\n * Main Security Validator\n */\nexport class SecurityValidator {\n  private readonly sanitizer: InputSanitizer;\n  private readonly customRules: Map<string, SecurityRule>;\n\n  constructor() {\n    this.sanitizer = new InputSanitizer();\n    this.customRules = new Map();\n  }\n\n  /**\n   * Add custom validation rule\n   */\n  addRule(name: string, rule: SecurityRule): void {\n    this.customRules.set(name, rule);\n  }\n\n  /**\n   * Remove custom rule\n   */\n  removeRule(name: string): void {\n    this.customRules.delete(name);\n  }\n\n  /**\n   * Validate data against schema\n   */\n  async validateSchema<T>(\n    data: unknown,\n    schema: z.ZodSchema<T>,\n    options: {\n      sanitize?: boolean;\n      strictMode?: boolean;\n      customRules?: string[];\n    } = {},\n  ): Promise<ValidationResult> {\n    const result: ValidationResult = {\n      isValid: true,\n      errors: [],\n      warnings: [],\n    };\n\n    try {\n      // Apply sanitization if requested\n      let processedData = data;\n      if (options.sanitize && typeof data === 'object' && data !== null) {\n        processedData = this.sanitizeObject(data);\n        result.sanitized = processedData;\n      }\n\n      // Validate against Zod schema\n      const parseResult = schema.safeParse(processedData);\n      if (!parseResult.success) {\n        parseResult.error.errors.forEach((error: any) => {\n          result.errors.push({\n            field: error.path.join('.'),\n            rule: 'schema',\n            message: error.message,\n            severity: 'medium',\n            value: error.code,\n          });\n        });\n        result.isValid = false;\n      }\n\n      // Apply security rules\n      if (options.customRules) {\n        const securityErrors = this.applySecurityRules(processedData, options.customRules);\n        result.errors.push(...securityErrors);\n        if (securityErrors.length > 0) {\n          result.isValid = false;\n        }\n      }\n\n      // Apply default security rules in strict mode\n      if (options.strictMode) {\n        const defaultRules = Object.keys(SecurityRules);\n        const strictErrors = this.applySecurityRules(processedData, defaultRules);\n        result.errors.push(...strictErrors);\n        if (strictErrors.length > 0) {\n          result.isValid = false;\n        }\n      }\n    } catch (error) {\n      result.isValid = false;\n      result.errors.push({\n        field: 'root',\n        rule: 'validation',\n        message: error instanceof Error ? error.message : 'Validation failed',\n        severity: 'critical',\n      });\n    }\n\n    return result;\n  }\n\n  /**\n   * Quick validation for common use cases\n   */\n  validateInput(\n    value: unknown,\n    type: 'email' | 'password' | 'text' | 'html' | 'filename',\n    options: { required?: boolean; sanitize?: boolean } = {},\n  ): ValidationResult {\n    const result: ValidationResult = {\n      isValid: true,\n      errors: [],\n      warnings: [],\n    };\n\n    // Check required\n    if (options.required && (value === null || value === undefined || value === '')) {\n      result.isValid = false;\n      result.errors.push({\n        field: 'value',\n        rule: 'required',\n        message: 'Value is required',\n        severity: 'medium',\n      });\n      return result;\n    }\n\n    if (value === null || value === undefined) {\n      return result;\n    }\n\n    // Type-specific validation\n    switch (type) {\n      case 'email':\n        if (SecurityRules.validEmail && !SecurityRules.validEmail.validator(value)) {\n          result.isValid = false;\n          result.errors.push({\n            field: 'value',\n            rule: 'validEmail',\n            message: SecurityRules.validEmail.message,\n            severity: SecurityRules.validEmail.severity,\n          });\n        }\n        break;\n\n      case 'password':\n        if (SecurityRules.strongPassword && !SecurityRules.strongPassword.validator(value)) {\n          result.isValid = false;\n          result.errors.push({\n            field: 'value',\n            rule: 'strongPassword',\n            message: SecurityRules.strongPassword.message,\n            severity: SecurityRules.strongPassword.severity,\n          });\n        }\n        break;\n\n      case 'text':\n        if (typeof value === 'string') {\n          if (options.sanitize) {\n            result.sanitized = this.sanitizer.sanitizeText(value);\n          }\n          // Check for XSS\n          if (SecurityRules.noXSS && !SecurityRules.noXSS.validator(value)) {\n            result.isValid = false;\n            result.errors.push({\n              field: 'value',\n              rule: 'noXSS',\n              message: SecurityRules.noXSS.message,\n              severity: SecurityRules.noXSS.severity,\n            });\n          }\n        }\n        break;\n\n      case 'html':\n        if (typeof value === 'string') {\n          if (options.sanitize) {\n            result.sanitized = this.sanitizer.sanitizeHTML(value);\n          }\n        }\n        break;\n\n      case 'filename':\n        if (typeof value === 'string') {\n          if (options.sanitize) {\n            result.sanitized = this.sanitizer.sanitizeFileName(value);\n          }\n          // Check for path traversal\n          if (SecurityRules.noPathTraversal && !SecurityRules.noPathTraversal.validator(value)) {\n            result.isValid = false;\n            result.errors.push({\n              field: 'value',\n              rule: 'noPathTraversal',\n              message: SecurityRules.noPathTraversal.message,\n              severity: SecurityRules.noPathTraversal.severity,\n            });\n          }\n        }\n        break;\n    }\n\n    return result;\n  }\n\n  /**\n   * Sanitize object recursively\n   */\n  private sanitizeObject(obj: unknown): unknown {\n    if (typeof obj === 'string') {\n      return this.sanitizer.sanitizeText(obj);\n    }\n\n    if (obj instanceof Date) {\n      return obj; // Don't sanitize Date objects\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map((item) => this.sanitizeObject(item));\n    }\n\n    if (obj && typeof obj === 'object') {\n      const sanitized: Record<string, unknown> = {};\n      for (const [key, value] of Object.entries(obj)) {\n        sanitized[key] = this.sanitizeObject(value);\n      }\n      return sanitized;\n    }\n\n    return obj;\n  }\n\n  /**\n   * Apply security rules to data\n   */\n  private applySecurityRules(data: unknown, ruleNames: string[]): ValidationError[] {\n    const errors: ValidationError[] = [];\n\n    ruleNames.forEach((ruleName) => {\n      const rule = SecurityRules[ruleName] || this.customRules.get(ruleName);\n      if (rule && !rule.validator(data)) {\n        errors.push({\n          field: 'data',\n          rule: ruleName,\n          message: rule.message,\n          severity: rule.severity,\n          value: data,\n        });\n      }\n    });\n\n    return errors;\n  }\n}\n\n/**\n * Security boundary decorator\n */\nexport function SecurityBoundary(rules: string[] = []) {\n  return function (_target: any, _propertyName: string, descriptor: PropertyDescriptor) {\n    const method = descriptor.value;\n    const validator = new SecurityValidator();\n\n    descriptor.value = async function (...args: any[]) {\n      // Validate all arguments\n      for (let i = 0; i < args.length; i++) {\n        const validation = await validator.validateSchema(args[i], z.unknown(), {\n          strictMode: true,\n          customRules: rules,\n        });\n\n        if (!validation.isValid) {\n          throw new SecurityError(\n            `Security validation failed for argument ${i}`,\n            validation.errors,\n          );\n        }\n      }\n\n      return method.apply(this, args);\n    };\n  };\n}\n\n/**\n * Custom security error\n */\nexport class SecurityError extends Error {\n  public readonly errors: ValidationError[];\n\n  constructor(message: string, errors: ValidationError[] = []) {\n    super(message);\n    this.name = 'SecurityError';\n    this.errors = errors;\n  }\n}\n\n/**\n * Default security validator instance\n */\nexport const defaultValidator = new SecurityValidator();\n\n/**\n * Quick validation functions\n */\nexport const validate = {\n  email: (value: unknown) => defaultValidator.validateInput(value, 'email', { required: true }),\n  password: (value: unknown) =>\n    defaultValidator.validateInput(value, 'password', { required: true }),\n  text: (value: unknown, sanitize = true) =>\n    defaultValidator.validateInput(value, 'text', { sanitize }),\n  html: (value: unknown, sanitize = true) =>\n    defaultValidator.validateInput(value, 'html', { sanitize }),\n  filename: (value: unknown, sanitize = true) =>\n    defaultValidator.validateInput(value, 'filename', { sanitize }),\n};\n","import { createClient, SupabaseClient } from '@supabase/supabase-js';\n\n// Database Types\nexport interface SecurityEvent {\n  id: string;\n  user_id?: string;\n  client_id?: string;\n  event_type: string;\n  source_ip?: string;\n  user_agent?: string;\n  session_id?: string;\n  request_frequency?: number;\n  session_duration?: string;\n  error_rate?: number;\n  response_time?: string;\n  data_volume?: number;\n  geo_location?: {\n    lat: number;\n    lng: number;\n    country?: string;\n    city?: string;\n  };\n  device_fingerprint?: string;\n  privilege_level?: 'user' | 'admin' | 'system';\n  failed_attempts?: number;\n  metadata?: Record<string, any>;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface SecurityIncident {\n  id: string;\n  title: string;\n  description?: string;\n  severity: 'low' | 'medium' | 'high' | 'critical';\n  status: 'open' | 'investigating' | 'resolved' | 'false_positive';\n  user_id?: string;\n  client_id?: string;\n  event_ids?: string[];\n  ioc_matches?: Record<string, any>;\n  ml_confidence?: number;\n  response_actions?: Record<string, any>;\n  timeline?: Record<string, any>;\n  impact_assessment?: Record<string, any>;\n  assigned_to?: string;\n  escalated_to?: string;\n  resolved_at?: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface AnalyticsMetric {\n  id: string;\n  user_id?: string;\n  client_id?: string;\n  metric_name: string;\n  metric_value: number;\n  metric_unit?: string;\n  dimensions?: Record<string, any>;\n  aggregation_period: 'minute' | 'hour' | 'day' | 'week' | 'month';\n  period_start: string;\n  period_end: string;\n  created_at: string;\n}\n\nexport interface ThreatIntelligence {\n  id: string;\n  ioc_type: 'ip' | 'domain' | 'hash' | 'user_agent';\n  ioc_value: string;\n  threat_actor?: string;\n  threat_type?: string;\n  confidence_score?: number;\n  first_seen?: string;\n  last_seen?: string;\n  source?: string;\n  tags?: string[];\n  metadata?: Record<string, any>;\n  is_active: boolean;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface GuestSession {\n  id: string;\n  session_token: string;\n  ip_address?: string;\n  user_agent?: string;\n  geo_location?: Record<string, any>;\n  device_fingerprint?: string;\n  activity_log?: Record<string, any>;\n  security_score?: number;\n  is_suspicious?: boolean;\n  expires_at: string;\n  created_at: string;\n  updated_at: string;\n}\n\n// Security Metrics Response\nexport interface SecurityMetrics {\n  total_events: number;\n  unique_ips: number;\n  error_rate: number;\n  avg_response_time: number;\n  failed_attempts: number;\n  event_types: string[];\n}\n\n// Top Threats Response  \nexport interface TopThreat {\n  ioc_value: string;\n  ioc_type: string;\n  threat_actor: string;\n  matches_count: number;\n  last_seen: string;\n}\n\n/**\n * Database integration service for security and analytics\n */\nexport class DatabaseService {\n  private supabase: SupabaseClient;\n\n  constructor(supabaseUrl: string, supabaseKey: string) {\n    this.supabase = createClient(supabaseUrl, supabaseKey);\n  }\n\n  // Security Events\n  async createSecurityEvent(event: Omit<SecurityEvent, 'id' | 'created_at' | 'updated_at'>): Promise<SecurityEvent> {\n    const { data, error } = await this.supabase\n      .from('security_events')\n      .insert(event)\n      .select()\n      .single();\n\n    if (error) throw new Error(`Failed to create security event: ${error.message}`);\n    return data;\n  }\n\n  async getSecurityEvents(\n    userId: string,\n    clientId?: string,\n    limit = 100,\n    offset = 0\n  ): Promise<SecurityEvent[]> {\n    let query = this.supabase\n      .from('security_events')\n      .select('*')\n      .order('created_at', { ascending: false })\n      .range(offset, offset + limit - 1);\n\n    if (clientId) {\n      query = query.eq('client_id', clientId);\n    } else {\n      query = query.eq('user_id', userId);\n    }\n\n    const { data, error } = await query;\n    if (error) throw new Error(`Failed to fetch security events: ${error.message}`);\n    return data || [];\n  }\n\n  // Security Incidents\n  async createSecurityIncident(incident: Omit<SecurityIncident, 'id' | 'created_at' | 'updated_at'>): Promise<SecurityIncident> {\n    const { data, error } = await this.supabase\n      .from('security_incidents')\n      .insert(incident)\n      .select()\n      .single();\n\n    if (error) throw new Error(`Failed to create security incident: ${error.message}`);\n    return data;\n  }\n\n  async getSecurityIncidents(\n    userId: string,\n    clientId?: string,\n    status?: SecurityIncident['status']\n  ): Promise<SecurityIncident[]> {\n    let query = this.supabase\n      .from('security_incidents')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (clientId) {\n      query = query.eq('client_id', clientId);\n    } else {\n      query = query.eq('user_id', userId);\n    }\n\n    if (status) {\n      query = query.eq('status', status);\n    }\n\n    const { data, error } = await query;\n    if (error) throw new Error(`Failed to fetch security incidents: ${error.message}`);\n    return data || [];\n  }\n\n  async updateSecurityIncident(\n    id: string, \n    updates: Partial<Omit<SecurityIncident, 'id' | 'created_at'>>\n  ): Promise<SecurityIncident> {\n    const { data, error } = await this.supabase\n      .from('security_incidents')\n      .update(updates)\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) throw new Error(`Failed to update security incident: ${error.message}`);\n    return data;\n  }\n\n  // Analytics Metrics\n  async createAnalyticsMetric(metric: Omit<AnalyticsMetric, 'id' | 'created_at'>): Promise<AnalyticsMetric> {\n    const { data, error } = await this.supabase\n      .from('analytics_metrics')\n      .insert(metric)\n      .select()\n      .single();\n\n    if (error) throw new Error(`Failed to create analytics metric: ${error.message}`);\n    return data;\n  }\n\n  async getAnalyticsMetrics(\n    userId: string,\n    clientId?: string,\n    metricName?: string,\n    period?: AnalyticsMetric['aggregation_period'],\n    startDate?: string,\n    endDate?: string\n  ): Promise<AnalyticsMetric[]> {\n    let query = this.supabase\n      .from('analytics_metrics')\n      .select('*')\n      .order('period_start', { ascending: false });\n\n    if (clientId) {\n      query = query.eq('client_id', clientId);\n    } else {\n      query = query.eq('user_id', userId);\n    }\n\n    if (metricName) {\n      query = query.eq('metric_name', metricName);\n    }\n\n    if (period) {\n      query = query.eq('aggregation_period', period);\n    }\n\n    if (startDate) {\n      query = query.gte('period_start', startDate);\n    }\n\n    if (endDate) {\n      query = query.lte('period_end', endDate);\n    }\n\n    const { data, error } = await query;\n    if (error) throw new Error(`Failed to fetch analytics metrics: ${error.message}`);\n    return data || [];\n  }\n\n  // Threat Intelligence\n  async getThreatIntelligence(): Promise<ThreatIntelligence[]> {\n    const { data, error } = await this.supabase\n      .from('threat_intelligence')\n      .select('*')\n      .eq('is_active', true)\n      .order('updated_at', { ascending: false });\n\n    if (error) throw new Error(`Failed to fetch threat intelligence: ${error.message}`);\n    return data || [];\n  }\n\n  async checkIOCMatch(iocType: string, iocValue: string): Promise<ThreatIntelligence | null> {\n    const { data, error } = await this.supabase\n      .from('threat_intelligence')\n      .select('*')\n      .eq('ioc_type', iocType)\n      .eq('ioc_value', iocValue)\n      .eq('is_active', true)\n      .single();\n\n    if (error && error.code !== 'PGRST116') { // PGRST116 = no rows returned\n      throw new Error(`Failed to check IOC match: ${error.message}`);\n    }\n    return data;\n  }\n\n  // Guest Sessions\n  async createGuestSession(session: Omit<GuestSession, 'id' | 'created_at' | 'updated_at'>): Promise<GuestSession> {\n    const { data, error } = await this.supabase\n      .from('guest_sessions')\n      .insert(session)\n      .select()\n      .single();\n\n    if (error) throw new Error(`Failed to create guest session: ${error.message}`);\n    return data;\n  }\n\n  async getGuestSession(sessionToken: string): Promise<GuestSession | null> {\n    const { data, error } = await this.supabase\n      .from('guest_sessions')\n      .select('*')\n      .eq('session_token', sessionToken)\n      .single();\n\n    if (error && error.code !== 'PGRST116') {\n      throw new Error(`Failed to fetch guest session: ${error.message}`);\n    }\n    return data;\n  }\n\n  // Analytics Functions\n  async getSecurityMetrics(\n    userId: string,\n    clientId?: string,\n    startDate?: string,\n    endDate?: string\n  ): Promise<SecurityMetrics> {\n    const { data, error } = await this.supabase\n      .rpc('get_security_metrics', {\n        p_user_id: userId,\n        p_client_id: clientId || null,\n        p_start_date: startDate || new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),\n        p_end_date: endDate || new Date().toISOString()\n      });\n\n    if (error) throw new Error(`Failed to get security metrics: ${error.message}`);\n    return data || {\n      total_events: 0,\n      unique_ips: 0,\n      error_rate: 0,\n      avg_response_time: 0,\n      failed_attempts: 0,\n      event_types: []\n    };\n  }\n\n  async getTopThreats(limit = 10): Promise<TopThreat[]> {\n    const { data, error } = await this.supabase\n      .rpc('get_top_threats', { p_limit: limit });\n\n    if (error) throw new Error(`Failed to get top threats: ${error.message}`);\n    return data || [];\n  }\n\n  // Real-time subscriptions\n  subscribeToSecurityEvents(\n    userId: string,\n    callback: (event: SecurityEvent) => void\n  ) {\n    return this.supabase\n      .channel('security_events')\n      .on('postgres_changes', {\n        event: 'INSERT',\n        schema: 'public',\n        table: 'security_events',\n        filter: `user_id=eq.${userId}`\n      }, (payload) => {\n        callback(payload.new as SecurityEvent);\n      })\n      .subscribe();\n  }\n\n  subscribeToSecurityIncidents(\n    userId: string,\n    callback: (incident: SecurityIncident) => void\n  ) {\n    return this.supabase\n      .channel('security_incidents')\n      .on('postgres_changes', {\n        event: '*',\n        schema: 'public',\n        table: 'security_incidents',\n        filter: `user_id=eq.${userId}`\n      }, (payload) => {\n        callback(payload.new as SecurityIncident);\n      })\n      .subscribe();\n  }\n}\n","import { EventEmitter } from 'events';\n\nimport { DatabaseService, SecurityEvent, SecurityIncident } from '../database/DatabaseService';\nimport { getGlobalLogger } from '../monitoring/structured-logger';\n\nimport { ThreatDetectionService } from './threat-detection-bridge';\n\nexport interface IntegratedSecurityEvent extends SecurityEvent {\n  //    \n  anomaly_score?: number;\n  threat_level?: 'low' | 'medium' | 'high' | 'critical';\n  automated_response?: string[];\n}\n\ninterface ThreatIncidentDetails {\n  title: string;\n  description?: string;\n  severity: SecurityIncident['severity'];\n  responseActions?: unknown;\n  timeline?: unknown;\n  impactAssessment?: unknown;\n}\n\ninterface ThreatAnalysisResult {\n  anomalyScore: number;\n  incidentCreated?: boolean;\n  incident?: ThreatIncidentDetails;\n  iocMatches?: unknown;\n}\n\nexport interface SecurityAnalyticsConfig {\n  supabaseUrl: string;\n  supabaseKey: string;\n  enableRealTimeProcessing: boolean;\n  enableAutomatedResponse: boolean;\n  mlModelPath?: string;\n}\n\n/**\n * Integrated Security Analytics Service\n *  threat detection, database storage  real-time analytics\n */\nexport class SecurityAnalyticsService extends EventEmitter {\n  private threatDetection: InstanceType<typeof ThreatDetectionService>;\n  private database: DatabaseService;\n  private processingQueue: SecurityEvent[] = [];\n  private isProcessing = false;\n  private readonly logger = getGlobalLogger().child({ component: 'SecurityAnalyticsService' });\n\n  constructor(config: SecurityAnalyticsConfig) {\n    super();\n    this.database = new DatabaseService(config.supabaseUrl, config.supabaseKey);\n    this.threatDetection = new ThreatDetectionService();\n\n    if (config.enableRealTimeProcessing) {\n      this.startRealTimeProcessing();\n    }\n  }\n\n  /**\n   *  \n   */\n  async initialize(): Promise<void> {\n    try {\n      //  threat detection\n      await this.threatDetection.initialize();\n\n      //  threat intelligence  \n      const threatIntel = await this.database.getThreatIntelligence();\n      this.logger.info('Loaded threat intelligence indicators', {\n        metadata: { indicatorCount: threatIntel.length },\n      });\n\n      //  ML    \n      await this.trainMLModel();\n\n      this.emit('initialized');\n      this.logger.info('SecurityAnalyticsService initialized successfully');\n    } catch (error) {\n      const normalizedError = error instanceof Error ? error : new Error(String(error));\n      this.logger.error('Failed to initialize SecurityAnalyticsService', {\n        metadata: { error: normalizedError },\n      });\n      throw error;\n    }\n  }\n\n  /**\n   *  security    \n   */\n  async processSecurityEvent(event: Omit<SecurityEvent, 'id' | 'created_at' | 'updated_at'>): Promise<IntegratedSecurityEvent> {\n    try {\n      // 1.    \n      const savedEvent = await this.database.createSecurityEvent(event);\n\n      // 2. Threat detection \n      const analysisResult = (await this.threatDetection.analyzeSecurityEvent({\n        id: savedEvent.id,\n        timestamp: savedEvent.created_at,\n        userId: savedEvent.user_id || 'unknown',\n        sessionId: savedEvent.session_id || '',\n        ipAddress: savedEvent.source_ip || '',\n        userAgent: savedEvent.user_agent || '',\n        endpoint: event.event_type,\n        method: 'POST', // default\n        statusCode: savedEvent.error_rate && savedEvent.error_rate > 0 ? 500 : 200,\n        responseTime: this.parseResponseTime(savedEvent.response_time),\n        requestSize: savedEvent.data_volume || 0,\n        responseSize: savedEvent.data_volume || 0,\n        geoLocation: savedEvent.geo_location,\n        deviceFingerprint: savedEvent.device_fingerprint,\n        // :   metadata   \n        customAttributes: event.metadata || savedEvent.metadata || {}\n      })) as ThreatAnalysisResult;\n\n      // 3.   \n      const integratedEvent: IntegratedSecurityEvent = {\n        ...savedEvent,\n        anomaly_score: analysisResult.anomalyScore,\n        threat_level: this.calculateThreatLevel(analysisResult),\n        automated_response: []\n      };\n\n      // 4.     \n      if (analysisResult.incidentCreated && analysisResult.incident) {\n        const { incident } = analysisResult;\n        const incidentPayload: Omit<SecurityIncident, 'id' | 'created_at' | 'updated_at'> = {\n          title: incident.title,\n          severity: incident.severity,\n          status: 'open'\n        };\n\n        if (incident.description) {\n          incidentPayload.description = incident.description;\n        }\n\n        if (savedEvent.user_id) {\n          incidentPayload.user_id = savedEvent.user_id;\n        }\n\n        if (savedEvent.client_id) {\n          incidentPayload.client_id = savedEvent.client_id;\n        }\n\n        incidentPayload.event_ids = [savedEvent.id];\n        incidentPayload.ml_confidence = analysisResult.anomalyScore;\n\n        const normalizedMatches = this.normalizeToRecord(analysisResult.iocMatches);\n        if (normalizedMatches) {\n          incidentPayload.ioc_matches = normalizedMatches;\n        }\n\n        const normalizedResponses = this.normalizeToRecord(incident.responseActions);\n        if (normalizedResponses) {\n          incidentPayload.response_actions = normalizedResponses;\n        }\n\n        const normalizedTimeline = this.normalizeToRecord(incident.timeline);\n        if (normalizedTimeline) {\n          incidentPayload.timeline = normalizedTimeline;\n        }\n\n        const normalizedImpact = this.normalizeToRecord(incident.impactAssessment);\n        if (normalizedImpact) {\n          incidentPayload.impact_assessment = normalizedImpact;\n        }\n\n        const incidentRecord = await this.database.createSecurityIncident(incidentPayload);\n\n        integratedEvent.automated_response = this.getAutomatedResponseActions(incidentRecord);\n        this.emit('incidentCreated', incidentRecord);\n      }\n\n      // 5. Real-time \n      this.emit('eventProcessed', integratedEvent);\n\n      return integratedEvent;\n    } catch (error) {\n      const normalizedError = error instanceof Error ? error : new Error(String(error));\n      this.logger.error('Failed to process security event', {\n        metadata: { error: normalizedError },\n      });\n      throw error;\n    }\n  }\n\n  /**\n   *   \n   */\n  async getSecurityAnalytics(\n    userId: string,\n    clientId?: string,\n    timeRange: 'hour' | 'day' | 'week' | 'month' = 'day'\n  ) {\n    const endDate = new Date();\n    const startDate = new Date();\n\n    switch (timeRange) {\n      case 'hour':\n        startDate.setHours(startDate.getHours() - 1);\n        break;\n      case 'day':\n        startDate.setDate(startDate.getDate() - 1);\n        break;\n      case 'week':\n        startDate.setDate(startDate.getDate() - 7);\n        break;\n      case 'month':\n        startDate.setMonth(startDate.getMonth() - 1);\n        break;\n    }\n\n    const [\n      securityMetrics,\n      topThreats,\n      recentIncidents,\n      recentEvents\n    ] = await Promise.all([\n      this.database.getSecurityMetrics(userId, clientId, startDate.toISOString(), endDate.toISOString()),\n      this.database.getTopThreats(10),\n      this.database.getSecurityIncidents(userId, clientId),\n      this.database.getSecurityEvents(userId, clientId, 100)\n    ]);\n\n    //   \n    const threatDistribution = this.calculateThreatDistribution(recentEvents);\n    const riskScore = this.calculateRiskScore(securityMetrics, recentIncidents);\n    const trends = await this.calculateTrends(userId, timeRange, clientId);\n\n    return {\n      overview: {\n        ...securityMetrics,\n        risk_score: riskScore,\n        active_incidents: recentIncidents.filter((i: SecurityIncident) => i.status === 'open' || i.status === 'investigating').length,\n        total_incidents: recentIncidents.length\n      },\n      threats: {\n        top_threats: topThreats,\n        threat_distribution: threatDistribution\n      },\n      incidents: recentIncidents.slice(0, 10), //  10 \n      trends,\n      ml_stats: await this.threatDetection.getStatistics()\n    };\n  }\n\n  /**\n   * Batch  \n   */\n  async batchProcessEvents(events: Omit<SecurityEvent, 'id' | 'created_at' | 'updated_at'>[]): Promise<void> {\n    const batchSize = 100;\n    const results: IntegratedSecurityEvent[] = [];\n\n    for (let i = 0; i < events.length; i += batchSize) {\n      const batch = events.slice(i, i + batchSize);\n      const batchResults = await Promise.all(\n        batch.map(event => this.processSecurityEvent(event))\n      );\n      results.push(...batchResults);\n\n      // Emit progress\n      this.emit('batchProgress', {\n        processed: Math.min(i + batchSize, events.length),\n        total: events.length,\n        results: batchResults\n      });\n    }\n\n    this.emit('batchCompleted', results);\n  }\n\n  /**\n   *   real-time \n   */\n  subscribeToRealTimeEvents(userId: string) {\n    return this.database.subscribeToSecurityEvents(userId, (event: SecurityEvent) => {\n      //     \n      this.processingQueue.push(event);\n      this.emit('realTimeEvent', event);\n    });\n  }\n\n  /**\n   *   real-time \n   */\n  subscribeToRealTimeIncidents(userId: string) {\n    return this.database.subscribeToSecurityIncidents(userId, (incident: SecurityIncident) => {\n      this.emit('realTimeIncident', incident);\n    });\n  }\n\n  //  \n\n  private async startRealTimeProcessing(): Promise<void> {\n    setInterval(async () => {\n      if (!this.isProcessing && this.processingQueue.length > 0) {\n        this.isProcessing = true;\n        const eventsToProcess = this.processingQueue.splice(0, 10); //   10 \n\n        try {\n          await Promise.all(\n            eventsToProcess.map(event => this.processSecurityEvent(event))\n          );\n        } catch (error) {\n          const normalizedError = error instanceof Error ? error : new Error(String(error));\n          this.logger.error('Error in real-time processing', {\n            metadata: { error: normalizedError },\n          });\n        } finally {\n          this.isProcessing = false;\n        }\n      }\n    }, 1000); //   \n  }\n\n  private async trainMLModel(): Promise<void> {\n    try {\n      //     \n      const historicalEvents = await this.database.getSecurityEvents('system', undefined, 1000);\n      \n      if (historicalEvents.length >= 100) {\n        const trainingData = historicalEvents.map((event: SecurityEvent) => ({\n          id: event.id,\n          timestamp: event.created_at,\n          userId: event.user_id || 'unknown',\n          sessionId: event.session_id || '',\n          ipAddress: event.source_ip || '',\n          userAgent: event.user_agent || '',\n          endpoint: event.event_type,\n          method: 'POST',\n          statusCode: event.error_rate && event.error_rate > 0 ? 500 : 200,\n          responseTime: this.parseResponseTime(event.response_time),\n          requestSize: event.data_volume || 0,\n          responseSize: event.data_volume || 0,\n          geoLocation: event.geo_location,\n          deviceFingerprint: event.device_fingerprint,\n          customAttributes: event.metadata || {}\n        }));\n\n        // TODO: Implement training when threat detection is fully integrated\n        // await this.threatDetection.trainAnomalyModel(trainingData);\n        this.logger.info('ML model trained on historical events', {\n          metadata: { trainingSamples: trainingData.length },\n        });\n      }\n    } catch (error) {\n      const normalizedError = error instanceof Error ? error : new Error(String(error));\n      this.logger.warn('Failed to train ML model', {\n        metadata: { error: normalizedError },\n      });\n    }\n  }\n\n  private parseResponseTime(responseTime?: string): number {\n    if (!responseTime) return 0;\n    //  PostgreSQL interval  \n    const match = responseTime.match(/(\\d+(?:\\.\\d+)?)\\s*ms/);\n    return match ? parseFloat(match[1] ?? '0') : 0;\n  }\n\n  private calculateThreatLevel(analysisResult: ThreatAnalysisResult): 'low' | 'medium' | 'high' | 'critical' {\n    if (analysisResult.anomalyScore > 0.8) return 'critical';\n    if (analysisResult.anomalyScore > 0.6) return 'high';\n    if (analysisResult.anomalyScore > 0.4) return 'medium';\n    return 'low';\n  }\n\n  private getAutomatedResponseActions(incident: SecurityIncident): string[] {\n    const actions: string[] = [];\n    \n    if (incident.severity === 'high' || incident.severity === 'critical') {\n      actions.push('ip_block', 'session_terminate');\n    }\n    \n    if (incident.ioc_matches) {\n      actions.push('threat_intelligence_update');\n    }\n    \n    return actions;\n  }\n\n  private calculateThreatDistribution(events: SecurityEvent[]) {\n    const distribution: Record<string, number> = {};\n    \n    events.forEach(event => {\n      const type = event.event_type;\n      distribution[type] = (distribution[type] || 0) + 1;\n    });\n    \n    return Object.entries(distribution)\n      .sort(([, a], [, b]) => b - a)\n      .slice(0, 10)\n      .map(([type, count]) => ({ type, count }));\n  }\n\n  private calculateRiskScore(\n    metrics: Awaited<ReturnType<DatabaseService['getSecurityMetrics']>>,\n    incidents: SecurityIncident[]\n  ): number {\n    let score = 0;\n    \n    //     \n    if (metrics.error_rate > 0.1) score += 20;\n    if (metrics.failed_attempts > 10) score += 30;\n    if (metrics.unique_ips > 100) score += 10;\n    \n    //    \n    const openIncidents = incidents.filter(i => i.status === 'open' || i.status === 'investigating');\n    score += openIncidents.length * 15;\n    \n    const criticalIncidents = incidents.filter(i => i.severity === 'critical');\n    score += criticalIncidents.length * 25;\n    \n    return Math.min(100, score);\n  }\n\n  private async calculateTrends(userId: string, timeRange: string, clientId?: string) {\n    //    -    \n    await this.database.getSecurityMetrics(userId, clientId);\n\n    //    mock \n    return {\n      period: timeRange,\n      events_trend: '+15%',\n      incidents_trend: '+3%',\n      risk_trend: '-5%',\n      response_time_trend: '-10%'\n    };\n  }\n\n  private normalizeToRecord(value: unknown): Record<string, unknown> | undefined {\n    if (value === null || value === undefined) {\n      return undefined;\n    }\n\n    if (Array.isArray(value)) {\n      return { items: value };\n    }\n\n    if (typeof value === 'object') {\n      return value as Record<string, unknown>;\n    }\n\n    return { value };\n  }\n}\n","/**\n * Structured Logging Service with Pino\n * Provides centralized, structured logging with multiple outputs\n */\n\nimport pino from 'pino';\nimport type { LogDescriptor } from 'pino';\nimport { z } from 'zod';\n\n// Log level configuration\nconst LogLevelSchema = z.enum(['trace', 'debug', 'info', 'warn', 'error', 'fatal']);\nexport type LogLevel = z.infer<typeof LogLevelSchema>;\n\n// Logger configuration schema\nconst LoggerConfigSchema = z.object({\n  level: LogLevelSchema.default('info'),\n  name: z.string().default('heys-app'),\n  version: z.string().optional(),\n  environment: z.enum(['development', 'staging', 'production']).default('development'),\n  enableConsole: z.boolean().default(true),\n  enableFile: z.boolean().default(false),\n  enableRemote: z.boolean().default(false),\n  fileOptions: z\n    .object({\n      filename: z.string(),\n      maxFiles: z.number().default(5),\n      maxSize: z.string().default('10MB'),\n    })\n    .optional(),\n  remoteOptions: z\n    .object({\n      url: z.string().url(),\n      headers: z.record(z.string()).optional(),\n      interval: z.number().default(5000),\n    })\n    .optional(),\n  redactPaths: z.array(z.string()).default(['password', 'token', 'secret', 'apiKey']),\n  prettyPrint: z.boolean().default(false),\n});\n\nexport type LoggerConfig = z.infer<typeof LoggerConfigSchema>;\n\n// Log context interface\ninterface LogContext {\n  userId?: string;\n  sessionId?: string;\n  traceId?: string;\n  component?: string;\n  operation?: string;\n  duration?: number;\n  metadata?: Record<string, unknown>;\n  tags?: string[];\n}\n\n// Performance metrics interface\ninterface PerformanceLog {\n  operation: string;\n  duration: number;\n  success: boolean;\n  component?: string;\n  metadata?: Record<string, unknown>;\n}\n\n// Error log interface\ninterface ErrorLog {\n  error: Error;\n  component?: string;\n  operation?: string;\n  userId?: string;\n  context?: Record<string, unknown>;\n}\n\nexport class StructuredLogger {\n  private logger: pino.Logger;\n  private config: LoggerConfig;\n  private startTimes: Map<string, number> = new Map();\n  private defaultContext: Partial<LogContext>;\n\n  constructor(config: Partial<LoggerConfig> = {}, defaultContext: Partial<LogContext> = {}) {\n    this.config = LoggerConfigSchema.parse(config);\n    this.defaultContext = defaultContext;\n    this.logger = this.createLogger();\n  }\n\n  private createLogger(): pino.Logger {\n    const baseConfig: pino.LoggerOptions = {\n      name: this.config.name,\n      level: this.config.level,\n      redact: {\n        paths: this.config.redactPaths,\n        censor: '[REDACTED]',\n      },\n      base: {\n        pid: process.pid,\n        hostname: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\n        environment: this.config.environment,\n        version: this.config.version,\n      },\n      timestamp: pino.stdTimeFunctions.isoTime,\n      formatters: {\n        level: (label) => {\n          return { level: label };\n        },\n      },\n    };\n\n    // Browser environment\n    if (typeof window !== 'undefined') {\n      const consoleApi = typeof globalThis.console !== 'undefined' ? globalThis.console : undefined;\n      const levelToConsoleMethod: Record<string, keyof Console> = {\n        trace: 'debug',\n        debug: 'debug',\n        info: 'info',\n        warn: 'warn',\n        error: 'error',\n        fatal: 'error',\n      };\n\n      return pino({\n        ...baseConfig,\n        browser: {\n          asObject: true,\n          write: (log: LogDescriptor) => {\n            if (!consoleApi) {\n              return;\n            }\n\n            const levelValue = log.level as number | string | undefined;\n            const levelLabel =\n              typeof levelValue === 'string'\n                ? levelValue\n                : pino.levels.labels[levelValue ?? 30] ?? 'info';\n\n            const consoleMethodName = levelToConsoleMethod[levelLabel] ?? 'log';\n            const consoleMethod = consoleApi[consoleMethodName];\n\n            if (typeof consoleMethod === 'function') {\n              (consoleMethod as (descriptor: LogDescriptor) => void).call(consoleApi, log);\n            }\n          },\n        },\n      });\n    }\n\n    // Node.js environment with pretty printing for development\n    if (this.config.prettyPrint && this.config.environment === 'development') {\n      const transport = pino.transport({\n        target: 'pino-pretty',\n        options: {\n          colorize: true,\n          translateTime: 'HH:MM:ss Z',\n          ignore: 'pid,hostname',\n        },\n      });\n      return pino(baseConfig, transport);\n    }\n\n    return pino(baseConfig);\n  }\n\n  /**\n   * Log with trace level\n   */\n  public trace(message: string, context?: LogContext): void {\n    this.log('trace', message, context);\n  }\n\n  /**\n   * Log with debug level\n   */\n  public debug(message: string, context?: LogContext): void {\n    this.log('debug', message, context);\n  }\n\n  /**\n   * Log with info level\n   */\n  public info(message: string, context?: LogContext): void {\n    this.log('info', message, context);\n  }\n\n  /**\n   * Log with warn level\n   */\n  public warn(message: string, context?: LogContext): void {\n    this.log('warn', message, context);\n  }\n\n  /**\n   * Log with error level\n   */\n  public error(message: string, context?: LogContext): void {\n    this.log('error', message, context);\n  }\n\n  /**\n   * Log with fatal level\n   */\n  public fatal(message: string, context?: LogContext): void {\n    this.log('fatal', message, context);\n  }\n\n  /**\n   * Core logging method\n   */\n  private log(level: LogLevel, message: string, context?: LogContext): void {\n    const mergedContext = this.mergeContexts(this.defaultContext, context);\n\n    const logData: Record<string, unknown> = {\n      msg: message,\n      timestamp: new Date().toISOString(),\n    };\n\n    if (mergedContext.userId) {\n      logData.userId = mergedContext.userId;\n    }\n\n    if (mergedContext.sessionId) {\n      logData.sessionId = mergedContext.sessionId;\n    }\n\n    if (mergedContext.traceId) {\n      logData.traceId = mergedContext.traceId;\n    }\n\n    if (mergedContext.component) {\n      logData.component = mergedContext.component;\n    }\n\n    if (mergedContext.operation) {\n      logData.operation = mergedContext.operation;\n    }\n\n    if (typeof mergedContext.duration === 'number') {\n      logData.duration = mergedContext.duration;\n    }\n\n    if (mergedContext.metadata && Object.keys(mergedContext.metadata).length > 0) {\n      logData.metadata = mergedContext.metadata;\n    }\n\n    if (mergedContext.tags && mergedContext.tags.length > 0) {\n      logData.tags = mergedContext.tags;\n    }\n\n    this.logger[level](logData);\n  }\n\n  /**\n   * Log an error with full context\n   */\n  public logError(errorLog: ErrorLog): void {\n    const metadata: Record<string, unknown> = {\n      errorName: errorLog.error.name,\n      errorMessage: errorLog.error.message,\n      errorStack: errorLog.error.stack,\n      ...(errorLog.context ?? {}),\n    };\n\n    const context: LogContext = {\n      ...(errorLog.component ? { component: errorLog.component } : {}),\n      ...(errorLog.operation ? { operation: errorLog.operation } : {}),\n      ...(errorLog.userId ? { userId: errorLog.userId } : {}),\n      metadata,\n      tags: ['error'],\n    };\n\n    const componentLabel = errorLog.component ?? 'unknown';\n    this.error(`Error in ${componentLabel}: ${errorLog.error.message}`, context);\n  }\n\n  /**\n   * Log performance metrics\n   */\n  public logPerformance(perfLog: PerformanceLog): void {\n    const metadata: Record<string, unknown> = {\n      success: perfLog.success,\n      ...(perfLog.metadata ?? {}),\n    };\n\n    const context: LogContext = {\n      ...(perfLog.component ? { component: perfLog.component } : {}),\n      operation: perfLog.operation,\n      duration: perfLog.duration,\n      metadata,\n      tags: ['performance'],\n    };\n\n    const status = perfLog.success ? 'success' : 'failed';\n    const message = `${perfLog.operation} completed in ${perfLog.duration}ms (${status})`;\n    this.info(message, context);\n  }\n\n  /**\n   * Start performance timing\n   */\n  public startTiming(operationId: string): void {\n    this.startTimes.set(operationId, performance.now());\n  }\n\n  /**\n   * End performance timing and log\n   */\n  public endTiming(\n    operationId: string,\n    operation: string,\n    success: boolean = true,\n    component?: string,\n    metadata?: Record<string, unknown>,\n  ): number {\n    const startTime = this.startTimes.get(operationId);\n    if (!startTime) {\n      this.warn(`No start time found for operation: ${operationId}`);\n      return 0;\n    }\n\n    const duration = performance.now() - startTime;\n    this.startTimes.delete(operationId);\n\n    this.logPerformance({\n      operation,\n      duration,\n      success,\n      ...(component ? { component } : {}),\n      ...(metadata ? { metadata } : {}),\n    });\n\n    return duration;\n  }\n\n  /**\n   * Log user action\n   */\n  public logUserAction(action: string, userId: string, metadata?: Record<string, unknown>): void {\n    const context: LogContext = {\n      userId,\n      operation: action,\n      ...(metadata ? { metadata } : {}),\n      tags: ['user-action'],\n    };\n\n    this.info(`User action: ${action}`, context);\n  }\n\n  /**\n   * Log API request\n   */\n  public logApiRequest(\n    method: string,\n    url: string,\n    statusCode?: number,\n    duration?: number,\n    userId?: string,\n    metadata?: Record<string, unknown>,\n  ): void {\n    const context: LogContext = {\n      ...(userId ? { userId } : {}),\n      operation: `${method} ${url}`,\n      ...(typeof duration === 'number' ? { duration } : {}),\n      metadata: {\n        method,\n        url,\n        ...(statusCode !== undefined ? { statusCode } : {}),\n        ...(metadata ?? {}),\n      },\n      tags: ['api-request'],\n    };\n\n    const level = statusCode && statusCode >= 400 ? 'warn' : 'info';\n    const message = `API ${method} ${url} - ${statusCode || 'pending'}`;\n\n    this.log(level, message, context);\n  }\n\n  /**\n   * Log security event\n   */\n  public logSecurityEvent(\n    event: string,\n    severity: 'low' | 'medium' | 'high' | 'critical',\n    userId?: string,\n    metadata?: Record<string, unknown>,\n  ): void {\n    const context: LogContext = {\n      ...(userId ? { userId } : {}),\n      operation: event,\n      metadata: {\n        severity,\n        ...(metadata ?? {}),\n      },\n      tags: ['security', severity],\n    };\n\n    const level = severity === 'critical' || severity === 'high' ? 'error' : 'warn';\n    this.log(level, `Security event: ${event}`, context);\n  }\n\n  /**\n   * Create child logger with default context\n   */\n  public child(defaultContext: Partial<LogContext>): StructuredLogger {\n    return new StructuredLogger(this.config, {\n      ...this.defaultContext,\n      ...defaultContext,\n      metadata: {\n        ...(this.defaultContext.metadata ?? {}),\n        ...(defaultContext.metadata ?? {}),\n      },\n      tags: this.mergeTags(this.defaultContext.tags, defaultContext.tags),\n    });\n  }\n\n  /**\n   * Flush logs (useful for graceful shutdown)\n   */\n  public async flush(): Promise<void> {\n    // In browser environment, this is a no-op\n    if (typeof window !== 'undefined') {\n      return Promise.resolve();\n    }\n\n    // For Node.js with streams\n    return new Promise((resolve) => {\n      const loggerCandidate = this.logger as unknown as { flush?: () => void };\n      if (typeof loggerCandidate.flush === 'function') {\n        loggerCandidate.flush();\n      }\n      resolve();\n    });\n  }\n\n  /**\n   * Get current log level\n   */\n  public getLevel(): LogLevel {\n    return this.config.level;\n  }\n\n  /**\n   * Set log level\n   */\n  public setLevel(level: LogLevel): void {\n    this.config.level = level;\n    this.logger.level = level;\n  }\n\n  /**\n   * Check if level is enabled\n   */\n  public isLevelEnabled(level: LogLevel): boolean {\n    return this.logger.isLevelEnabled(level);\n  }\n  private mergeContexts(\n    base: Partial<LogContext>,\n    context?: LogContext,\n  ): LogContext {\n    const combinedMetadata: Record<string, unknown> = {\n      ...(base.metadata ?? {}),\n      ...(context?.metadata ?? {}),\n    };\n\n    const combinedTags = this.mergeTags(base.tags, context?.tags);\n\n    const result: LogContext = {\n      ...(base.userId ? { userId: base.userId } : {}),\n      ...(base.sessionId ? { sessionId: base.sessionId } : {}),\n      ...(base.traceId ? { traceId: base.traceId } : {}),\n      ...(base.component ? { component: base.component } : {}),\n      ...(base.operation ? { operation: base.operation } : {}),\n      ...(typeof base.duration === 'number' ? { duration: base.duration } : {}),\n    };\n\n    if (context) {\n      if (context.userId) {\n        result.userId = context.userId;\n      }\n      if (context.sessionId) {\n        result.sessionId = context.sessionId;\n      }\n      if (context.traceId) {\n        result.traceId = context.traceId;\n      }\n      if (context.component) {\n        result.component = context.component;\n      }\n      if (context.operation) {\n        result.operation = context.operation;\n      }\n      if (typeof context.duration === 'number') {\n        result.duration = context.duration;\n      }\n    }\n\n    if (Object.keys(combinedMetadata).length > 0) {\n      result.metadata = combinedMetadata;\n    }\n\n    if (combinedTags.length > 0) {\n      result.tags = combinedTags;\n    }\n\n    return result;\n  }\n\n  private mergeTags(\n    baseTags?: string[],\n    additionalTags?: string[],\n  ): string[] {\n    const combined = [...(baseTags ?? []), ...(additionalTags ?? [])];\n    return Array.from(new Set(combined));\n  }\n}\n\n// Performance logging decorator\nexport function LogPerformance(operation?: string) {\n  return function <T extends (...args: unknown[]) => unknown>(\n    target: object,\n    propertyKey: string | symbol,\n    descriptor: TypedPropertyDescriptor<T>,\n  ): TypedPropertyDescriptor<T> {\n    const originalMethod = descriptor.value;\n    if (!originalMethod) {\n      return descriptor;\n    }\n\n    const targetName =\n      typeof target === 'function' ? target.name : target.constructor?.name ?? 'Anonymous';\n    const operationName = operation ?? `${targetName}.${String(propertyKey)}`;\n\n    descriptor.value = (async function (\n      this: unknown,\n      ...args: Parameters<T>\n    ): Promise<Awaited<ReturnType<T>>> {\n      const loggerInstance = globalLogger ?? new StructuredLogger();\n      const operationId = `${operationName}-${Date.now()}-${Math.random().toString(36).slice(2)}`;\n\n      loggerInstance.startTiming(operationId);\n\n      try {\n        const result = await Promise.resolve(originalMethod.apply(this, args));\n        loggerInstance.endTiming(operationId, operationName, true, targetName);\n        return result as Awaited<ReturnType<T>>;\n      } catch (error) {\n        const normalizedError = error instanceof Error ? error : new Error(String(error));\n        loggerInstance.endTiming(operationId, operationName, false, targetName, {\n          error: normalizedError.message,\n        });\n        throw error;\n      }\n    }) as unknown as T;\n\n    return descriptor;\n  };\n}\n\n// Error logging decorator\nexport function LogErrors(component?: string) {\n  return function <T extends (...args: unknown[]) => unknown>(\n    target: object,\n    propertyKey: string | symbol,\n    descriptor: TypedPropertyDescriptor<T>,\n  ): TypedPropertyDescriptor<T> {\n    const originalMethod = descriptor.value;\n    if (!originalMethod) {\n      return descriptor;\n    }\n\n    const targetName =\n      typeof target === 'function' ? target.name : target.constructor?.name ?? 'Anonymous';\n    const componentName = component ?? targetName;\n\n    descriptor.value = (async function (\n      this: unknown,\n      ...args: Parameters<T>\n    ): Promise<Awaited<ReturnType<T>>> {\n      try {\n        const result = await Promise.resolve(originalMethod.apply(this, args));\n        return result as Awaited<ReturnType<T>>;\n      } catch (error) {\n        const loggerInstance = globalLogger ?? new StructuredLogger();\n        const normalizedError = error instanceof Error ? error : new Error(String(error));\n\n        loggerInstance.logError({\n          error: normalizedError,\n          component: componentName,\n          operation: String(propertyKey),\n        });\n\n        throw error;\n      }\n    }) as unknown as T;\n\n    return descriptor;\n  };\n}\n\n// Global logger instance\nexport let globalLogger: StructuredLogger | null = null;\n\n/**\n * Initialize global logger instance\n */\nexport function initializeGlobalLogger(config: Partial<LoggerConfig>): StructuredLogger {\n  globalLogger = new StructuredLogger(config);\n  return globalLogger;\n}\n\n/**\n * Get global logger instance\n */\nexport function getGlobalLogger(): StructuredLogger {\n  if (!globalLogger) {\n    globalLogger = new StructuredLogger();\n  }\n  return globalLogger;\n}\n\nexport default StructuredLogger;\n","// Temporary export bridge for threat detection service\n// This resolves import issues between packages\n\n// Define interface for consistent typing\ninterface IThreatDetectionService {\n  initialize(): Promise<void>;\n  analyzeSecurityEvent(event: any): Promise<any>;\n  getStatistics(): Promise<any>;\n}\n\n// Import using try-catch to handle missing package gracefully\nlet ThreatDetectionService: new() => IThreatDetectionService;\n\ntry {\n  const threatDetection = require('@heys/threat-detection');\n  ThreatDetectionService = threatDetection.ThreatDetectionService;\n} catch (error) {\n  // Fallback mock for development\n  ThreatDetectionService = class MockThreatDetectionService implements IThreatDetectionService {\n    async initialize() {\n      console.warn('Using mock ThreatDetectionService - install @heys/threat-detection for full functionality');\n    }\n    \n    async analyzeSecurityEvent(_event: any) {\n      return { threat_level: 'low', matches: [] };\n    }\n    \n    async getStatistics() {\n      return { totalEvents: 0, threats: 0, incidents: 0 };\n    }\n  };\n}\n\nexport { ThreatDetectionService };\nexport type { IThreatDetectionService };\n","// Export all shared utilities, types, and components\nexport * from './monitoring';\nexport * from './security';\nexport * from './database/DatabaseService';\nexport * from './security/SecurityAnalyticsService';\n\n// Shared utilities\nexport const formatDate = (date: Date) => date.toISOString().split('T')[0];\nexport const generateId = () => crypto.randomUUID();\n"]}