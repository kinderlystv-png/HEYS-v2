'use strict';

var v=class{config;cache=new Map;metrics={totalSearches:0,averageSearchTime:0,cacheHitRate:0,typoCorrections:0};commonWords=new Set(["\u0445\u043B\u0435\u0431","\u043C\u043E\u043B\u043E\u043A\u043E","\u043C\u044F\u0441\u043E","\u0440\u044B\u0431\u0430","\u043E\u0432\u043E\u0449\u0438","\u0444\u0440\u0443\u043A\u0442\u044B","\u043A\u0440\u0443\u043F\u0430","\u043C\u0430\u043A\u0430\u0440\u043E\u043D\u044B","\u0441\u044B\u0440","\u043C\u0430\u0441\u043B\u043E","\u044F\u0439\u0446\u0430","\u043A\u0443\u0440\u0438\u0446\u0430","\u0433\u043E\u0432\u044F\u0434\u0438\u043D\u0430","\u0441\u0432\u0438\u043D\u0438\u043D\u0430","\u043A\u0430\u0440\u0442\u043E\u0444\u0435\u043B\u044C","\u043C\u043E\u0440\u043A\u043E\u0432\u044C","\u043B\u0443\u043A","\u043F\u043E\u043C\u0438\u0434\u043E\u0440","\u043E\u0433\u0443\u0440\u0435\u0446","\u044F\u0431\u043B\u043E\u043A\u043E","\u0431\u0430\u043D\u0430\u043D","\u0430\u043F\u0435\u043B\u044C\u0441\u0438\u043D"]);synonyms=new Map([["\u0445\u043B\u0435\u0431",["\u0431\u0430\u0442\u043E\u043D","\u0431\u0443\u0445\u0430\u043D\u043A\u0430","\u0431\u0443\u043B\u043A\u0430","\u0431\u0430\u0433\u0435\u0442"]],["\u043C\u043E\u043B\u043E\u043A\u043E",["\u043C\u043E\u043B\u043E\u0447\u043A\u043E","\u043C\u043E\u043B\u043E\u0447\u043D\u044B\u0439"]],["\u043C\u044F\u0441\u043E",["\u043C\u044F\u0441\u043D\u043E\u0439","\u043C\u044F\u0441\u043D\u044B\u0435"]],["\u043A\u0443\u0440\u0438\u0446\u0430",["\u043A\u0443\u0440\u0438\u043D\u044B\u0439","\u0446\u044B\u043F\u043B\u0435\u043D\u043E\u043A","\u043F\u0442\u0438\u0446\u0430"]],["\u0433\u043E\u0432\u044F\u0434\u0438\u043D\u0430",["\u0433\u043E\u0432\u044F\u0436\u0438\u0439","\u0442\u0435\u043B\u044F\u0442\u0438\u043D\u0430"]],["\u0441\u0432\u0438\u043D\u0438\u043D\u0430",["\u0441\u0432\u0438\u043D\u043E\u0439","\u043F\u043E\u0440\u043E\u0441\u0435\u043D\u043E\u043A"]],["\u043A\u0430\u0440\u0442\u043E\u0444\u0435\u043B\u044C",["\u043A\u0430\u0440\u0442\u043E\u0448\u043A\u0430","\u043A\u0430\u0440\u0442\u043E\u0444\u0435\u043B\u044C\u043D\u044B\u0439"]],["\u043F\u043E\u043C\u0438\u0434\u043E\u0440",["\u0442\u043E\u043C\u0430\u0442","\u0442\u043E\u043C\u0430\u0442\u043D\u044B\u0439"]],["\u043C\u0430\u0441\u043B\u043E",["\u043C\u0430\u0441\u043B\u0438\u0446\u0435","\u0441\u043B\u0438\u0432\u043E\u0447\u043D\u043E\u0435"]]]);phoneticRules=[{from:/[её]/g,to:"\u0435"},{from:/[ии]/g,to:"\u0438"},{from:/[оё]/g,to:"\u043E"},{from:/[ъь]/g,to:""},{from:/тс/g,to:"\u0446"},{from:/дс/g,to:"\u0446"}];constructor(e={}){this.config={maxTypoDistance:2,minQueryLength:2,maxSuggestions:5,cacheEnabled:true,cacheTimeout:3e5,enablePhonetic:true,enableSynonyms:true,debugMode:false,...e};}levenshteinDistance(e,n){let s=Array(n.length+1).fill(null).map(()=>Array(e.length+1).fill(null));for(let t=0;t<=e.length;t++)s[0][t]=t;for(let t=0;t<=n.length;t++)s[t][0]=t;for(let t=1;t<=n.length;t++)for(let i=1;i<=e.length;i++){let o=e[i-1]===n[t-1]?0:1;s[t][i]=Math.min(s[t][i-1]+1,s[t-1][i]+1,s[t-1][i-1]+o);}return s[n.length][e.length]}normalizeQuery(e){return e.toLowerCase().trim().replace(/\s+/g," ")}phoneticTransform(e){if(!this.config.enablePhonetic)return e;let n=e;for(let s of this.phoneticRules)n=n.replace(s.from,s.to);return n}findSynonyms(e){if(!this.config.enableSynonyms)return [];let n=this.synonyms.get(e)||[];for(let[s,t]of this.synonyms)t.includes(e)&&n.push(s,...t.filter(i=>i!==e));return [...new Set(n)]}calculateRelevance(e,n,s){let t=Math.max(e.length,n.length),i=1-s/t;return s===0?1:this.commonWords.has(n.toLowerCase())?i*1.2:i}search(e,n,s){let t=Date.now(),i=this.normalizeQuery(n);if(this.config.cacheEnabled){let r=this.getCachedResult(i);if(r)return this.metrics.cacheHitRate=(this.metrics.cacheHitRate*this.metrics.totalSearches+1)/(this.metrics.totalSearches+1),this.updateMetrics(Date.now()-t),r}if(i.length<this.config.minQueryLength)return {items:e.slice(0,this.config.maxSuggestions),query:i,suggestions:[],searchTime:Date.now()-t,total:e.length,typosCorrected:false};let o=this.phoneticTransform(i),R=this.findSynonyms(i),x=this.getMaxTypoDistance(i.length),g=[];for(let r of e)for(let l of s){let c=String(r[l]).toLowerCase(),p=this.phoneticTransform(c),m=this.levenshteinDistance(i,c),a=this.calculateRelevance(i,c,m),y=this.levenshteinDistance(o,p),d=this.calculateRelevance(o,p,y);d>a&&(m=y,a=d);for(let S of R){let b=this.levenshteinDistance(S,c),T=this.calculateRelevance(S,c,b);T>a&&(m=b,a=T);}c.includes(i)&&(a=Math.max(a,.8)),(m<=x||a>.3)&&g.push({item:r,score:a,field:String(l)});}let u=Array.from(new Map(g.map(r=>[r.item,r])).values()).sort((r,l)=>l.score-r.score),C=u.slice(0,this.config.maxSuggestions).map(r=>r.item),f=this.generateSuggestions(i,u),h={items:C,query:i,suggestions:f,searchTime:Date.now()-t,total:u.length,typosCorrected:f.length>0};return this.config.cacheEnabled&&this.cacheResult(i,h),this.updateMetrics(h.searchTime),h.typosCorrected&&this.metrics.typoCorrections++,h}getMaxTypoDistance(e){return e<=4?1:e<=6?2:3}generateSuggestions(e,n){let s=new Set;for(let t of n.slice(0,this.config.maxSuggestions))if(t.score<1){let i=String(t.item[t.field]);i.toLowerCase()!==e&&s.add(i);}return Array.from(s).slice(0,this.config.maxSuggestions)}getCachedResult(e){let n=this.cache.get(e);return n?Date.now()-n.timestamp>this.config.cacheTimeout?(this.cache.delete(e),null):n.result:null}cacheResult(e,n){if(this.cache.set(e,{result:n,timestamp:Date.now()}),this.cache.size>1e3){let s=Array.from(this.cache.entries());s.sort((t,i)=>t[1].timestamp-i[1].timestamp),s.slice(0,500).forEach(([t])=>this.cache.delete(t));}}updateMetrics(e){this.metrics.totalSearches++,this.metrics.averageSearchTime=(this.metrics.averageSearchTime*(this.metrics.totalSearches-1)+e)/this.metrics.totalSearches;}getMetrics(){return {...this.metrics}}clearCache(){this.cache.clear();}updateConfig(e){this.config={...this.config,...e};}};

exports.SmartSearchEngine = v;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.cjs.map