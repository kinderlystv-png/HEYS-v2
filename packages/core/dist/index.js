'use strict';

var zod = require('zod');
var shared = require('@heys/shared');
var ai = require('fs');
var li = require('path');

function _interopDefault (e) { return e && e.__esModule ? e : { default: e }; }

var ai__default = /*#__PURE__*/_interopDefault(ai);
var li__default = /*#__PURE__*/_interopDefault(li);

var gi=Object.create;var Ft=Object.defineProperty;var yi=Object.getOwnPropertyDescriptor;var bi=Object.getOwnPropertyNames;var wi=Object.getPrototypeOf,Si=Object.prototype.hasOwnProperty;var $=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var O=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var vi=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of bi(t))!Si.call(e,i)&&i!==r&&Ft(e,i,{get:()=>t[i],enumerable:!(n=yi(t,i))||n.enumerable});return e};var Ut=(e,t,r)=>(r=e!=null?gi(wi(e)):{},vi(Ft(r,"default",{value:e,enumerable:true}),e));var Ne=O((Gu,Gt)=>{var le=e=>e&&typeof e.message=="string",ze=e=>{if(!e)return;let t=e.cause;if(typeof t=="function"){let r=e.cause();return le(r)?r:void 0}else return le(t)?t:void 0},Vt=(e,t)=>{if(!le(e))return "";let r=e.stack||"";if(t.has(e))return r+`
causes have become circular...`;let n=ze(e);return n?(t.add(e),r+`
caused by: `+Vt(n,t)):r},_i=e=>Vt(e,new Set),Wt=(e,t,r)=>{if(!le(e))return "";let n=r?"":e.message||"";if(t.has(e))return n+": ...";let i=ze(e);if(i){t.add(e);let o=typeof e.cause=="function";return n+(o?"":": ")+Wt(i,t,o)}else return n},Oi=e=>Wt(e,new Set);Gt.exports={isErrorLike:le,getErrorCause:ze,stackWithCauses:_i,messageWithCauses:Oi};});var Me=O((Ku,Ht)=>{var Li=Symbol("circular-ref-tag"),me=Symbol("pino-raw-err-ref"),Kt=Object.create({},{type:{enumerable:true,writable:true,value:void 0},message:{enumerable:true,writable:true,value:void 0},stack:{enumerable:true,writable:true,value:void 0},aggregateErrors:{enumerable:true,writable:true,value:void 0},raw:{enumerable:false,get:function(){return this[me]},set:function(e){this[me]=e;}}});Object.defineProperty(Kt,me,{writable:true,value:{}});Ht.exports={pinoErrProto:Kt,pinoErrorSymbols:{seen:Li,rawSymbol:me}};});var Yt=O((Hu,Xt)=>{Xt.exports=Be;var{messageWithCauses:Ai,stackWithCauses:Ri,isErrorLike:Jt}=Ne(),{pinoErrProto:Ti,pinoErrorSymbols:ki}=Me(),{seen:qe}=ki,{toString:Ii}=Object.prototype;function Be(e){if(!Jt(e))return e;e[qe]=void 0;let t=Object.create(Ti);t.type=Ii.call(e.constructor)==="[object Function]"?e.constructor.name:e.name,t.message=Ai(e),t.stack=Ri(e),Array.isArray(e.errors)&&(t.aggregateErrors=e.errors.map(r=>Be(r)));for(let r in e)if(t[r]===void 0){let n=e[r];Jt(n)?r!=="cause"&&!Object.prototype.hasOwnProperty.call(n,qe)&&(t[r]=Be(n)):t[r]=n;}return delete e[qe],t.raw=e,t}});var Zt=O((Ju,Qt)=>{Qt.exports=ye;var{isErrorLike:Fe}=Ne(),{pinoErrProto:Ci,pinoErrorSymbols:$i}=Me(),{seen:ge}=$i,{toString:Pi}=Object.prototype;function ye(e){if(!Fe(e))return e;e[ge]=void 0;let t=Object.create(Ci);t.type=Pi.call(e.constructor)==="[object Function]"?e.constructor.name:e.name,t.message=e.message,t.stack=e.stack,Array.isArray(e.errors)&&(t.aggregateErrors=e.errors.map(r=>ye(r))),Fe(e.cause)&&!Object.prototype.hasOwnProperty.call(e.cause,ge)&&(t.cause=ye(e.cause));for(let r in e)if(t[r]===void 0){let n=e[r];Fe(n)?Object.prototype.hasOwnProperty.call(n,ge)||(t[r]=ye(n)):t[r]=n;}return delete e[ge],t.raw=e,t}});var nr=O((Xu,rr)=>{rr.exports={mapHttpRequest:Di,reqSerializer:tr};var Ue=Symbol("pino-raw-req-ref"),er=Object.create({},{id:{enumerable:true,writable:true,value:""},method:{enumerable:true,writable:true,value:""},url:{enumerable:true,writable:true,value:""},query:{enumerable:true,writable:true,value:""},params:{enumerable:true,writable:true,value:""},headers:{enumerable:true,writable:true,value:{}},remoteAddress:{enumerable:true,writable:true,value:""},remotePort:{enumerable:true,writable:true,value:""},raw:{enumerable:false,get:function(){return this[Ue]},set:function(e){this[Ue]=e;}}});Object.defineProperty(er,Ue,{writable:true,value:{}});function tr(e){let t=e.info||e.socket,r=Object.create(er);if(r.id=typeof e.id=="function"?e.id():e.id||(e.info?e.info.id:void 0),r.method=e.method,e.originalUrl)r.url=e.originalUrl;else {let n=e.path;r.url=typeof n=="string"?n:e.url?e.url.path||e.url:void 0;}return e.query&&(r.query=e.query),e.params&&(r.params=e.params),r.headers=e.headers,r.remoteAddress=t&&t.remoteAddress,r.remotePort=t&&t.remotePort,r.raw=e.raw||e,r}function Di(e){return {req:tr(e)}}});var ar=O((Yu,or)=>{or.exports={mapHttpResponse:ji,resSerializer:sr};var Ve=Symbol("pino-raw-res-ref"),ir=Object.create({},{statusCode:{enumerable:true,writable:true,value:0},headers:{enumerable:true,writable:true,value:""},raw:{enumerable:false,get:function(){return this[Ve]},set:function(e){this[Ve]=e;}}});Object.defineProperty(ir,Ve,{writable:true,value:{}});function sr(e){let t=Object.create(ir);return t.statusCode=e.headersSent?e.statusCode:null,t.headers=e.getHeaders?e.getHeaders():e._headers,t.raw=e,t}function ji(e){return {res:sr(e)}}});var Ge=O((Qu,lr)=>{var We=Yt(),zi=Zt(),be=nr(),we=ar();lr.exports={err:We,errWithCause:zi,mapHttpRequest:be.mapHttpRequest,mapHttpResponse:we.mapHttpResponse,req:be.reqSerializer,res:we.resSerializer,wrapErrorSerializer:function(t){return t===We?t:function(n){return t(We(n))}},wrapRequestSerializer:function(t){return t===be.reqSerializer?t:function(n){return t(be.reqSerializer(n))}},wrapResponseSerializer:function(t){return t===we.resSerializer?t:function(n){return t(we.resSerializer(n))}}};});var Ke=O((Zu,ur)=>{function Ni(e,t){return t}ur.exports=function(){let t=Error.prepareStackTrace;Error.prepareStackTrace=Ni;let r=new Error().stack;if(Error.prepareStackTrace=t,!Array.isArray(r))return;let n=r.slice(2),i=[];for(let o of n)o&&i.push(o.getFileName());return i};});var fr=O((ec,cr)=>{cr.exports=Mi;function Mi(e={}){let{ERR_PATHS_MUST_BE_STRINGS:t=()=>"fast-redact - Paths must be (non-empty) strings",ERR_INVALID_PATH:r=n=>`fast-redact \u2013 Invalid path (${n})`}=e;return function({paths:i}){i.forEach(o=>{if(typeof o!="string")throw Error(t());try{if(/ã€‡/.test(o))throw Error();let u=(o[0]==="["?"":".")+o.replace(/^\*/,"\u3007").replace(/\.\*/g,".\u3007").replace(/\[\*\]/g,"[\u3007]");if(/\n|\r|;/.test(u)||/\/\*/.test(u))throw Error();Function(`
            'use strict'
            const o = new Proxy({}, { get: () => o, set: () => { throw Error() } });
            const \u3007 = null;
            o${u}
            if ([o${u}].length !== 1) throw Error()`)();}catch{throw Error(r(o))}});}}});var Se=O((tc,dr)=>{dr.exports=/[^.[\]]+|\[((?:.)*?)\]/g;});var pr=O((rc,hr)=>{var qi=Se();hr.exports=Bi;function Bi({paths:e}){let t=[];var r=0;let n=e.reduce(function(i,o,u){var l=o.match(qi).map(h=>h.replace(/'|"|`/g,""));let c=o[0]==="[";l=l.map(h=>h[0]==="["?h.substr(1,h.length-2):h);let p=l.indexOf("*");if(p>-1){let h=l.slice(0,p),a=h.join("."),y=l.slice(p+1,l.length),f=y.length>0;r++,t.push({before:h,beforeStr:a,after:y,nested:f});}else i[o]={path:l,val:void 0,precensored:false,circle:"",escPath:JSON.stringify(o),leadingBracket:c};return i},{});return {wildcards:t,wcLen:r,secret:n}}});var gr=O((nc,mr)=>{var Fi=Se();mr.exports=Ui;function Ui({secret:e,serialize:t,wcLen:r,strict:n,isCensorFct:i,censorFctTakesPath:o},u){let l=Function("o",`
    if (typeof o !== 'object' || o == null) {
      ${Ki(n,t)}
    }
    const { censor, secret } = this
    const originalSecret = {}
    const secretKeys = Object.keys(secret)
    for (var i = 0; i < secretKeys.length; i++) {
      originalSecret[secretKeys[i]] = secret[secretKeys[i]]
    }

    ${Vi(e,i,o)}
    this.compileRestore()
    ${Wi(r>0,i,o)}
    this.secret = originalSecret
    ${Gi(t)}
  `).bind(u);return l.state=u,t===false&&(l.restore=c=>u.restore(c)),l}function Vi(e,t,r){return Object.keys(e).map(n=>{let{escPath:i,leadingBracket:o,path:u}=e[n],l=o?1:0,c=o?"":".",p=[];for(var h;(h=Fi.exec(n))!==null;){let[,s]=h,{index:g,input:m}=h;g>l&&p.push(m.substring(0,g-(s?0:1)));}var a=p.map(s=>`o${c}${s}`).join(" && ");a.length===0?a+=`o${c}${n} != null`:a+=` && o${c}${n} != null`;let y=`
      switch (true) {
        ${p.reverse().map(s=>`
          case o${c}${s} === censor:
            secret[${i}].circle = ${JSON.stringify(s)}
            break
        `).join(`
`)}
      }
    `,f=r?`val, ${JSON.stringify(u)}`:"val";return `
      if (${a}) {
        const val = o${c}${n}
        if (val === censor) {
          secret[${i}].precensored = true
        } else {
          secret[${i}].val = val
          o${c}${n} = ${t?`censor(${f})`:"censor"}
          ${y}
        }
      }
    `}).join(`
`)}function Wi(e,t,r){return e===true?`
    {
      const { wildcards, wcLen, groupRedact, nestedRedact } = this
      for (var i = 0; i < wcLen; i++) {
        const { before, beforeStr, after, nested } = wildcards[i]
        if (nested === true) {
          secret[beforeStr] = secret[beforeStr] || []
          nestedRedact(secret[beforeStr], o, before, after, censor, ${t}, ${r})
        } else secret[beforeStr] = groupRedact(o, before, censor, ${t}, ${r})
      }
    }
  `:""}function Gi(e){return e===false?"return o":`
    var s = this.serialize(o)
    this.restore(o)
    return s
  `}function Ki(e,t){return e===true?"throw Error('fast-redact: primitives cannot be redacted')":t===false?"return o":"return this.serialize(o)"}});var Je=O((ic,wr)=>{wr.exports={groupRedact:Ji,groupRestore:Hi,nestedRedact:Yi,nestedRestore:Xi};function Hi({keys:e,values:t,target:r}){if(r==null||typeof r=="string")return;let n=e.length;for(var i=0;i<n;i++){let o=e[i];r[o]=t[i];}}function Ji(e,t,r,n,i){let o=yr(e,t);if(o==null||typeof o=="string")return {keys:null,values:null,target:o,flat:true};let u=Object.keys(o),l=u.length,c=t.length,p=i?[...t]:void 0,h=new Array(l);for(var a=0;a<l;a++){let y=u[a];h[a]=o[y],i?(p[c]=y,o[y]=r(o[y],p)):n?o[y]=r(o[y]):o[y]=r;}return {keys:u,values:h,target:o,flat:true}}function Xi(e){for(let t=0;t<e.length;t++){let{target:r,path:n,value:i}=e[t],o=r;for(let u=n.length-1;u>0;u--)o=o[n[u]];o[n[0]]=i;}}function Yi(e,t,r,n,i,o,u){let l=yr(t,r);if(l==null)return;let c=Object.keys(l),p=c.length;for(var h=0;h<p;h++){let a=c[h];Qi(e,l,a,r,n,i,o,u);}return e}function He(e,t){return e!=null?"hasOwn"in Object?Object.hasOwn(e,t):Object.prototype.hasOwnProperty.call(e,t):false}function Qi(e,t,r,n,i,o,u,l){let c=i.length,p=c-1,h=r;var a=-1,y,f,s,m=null,S,b,w=false,v=0,_=0,L=Zi();if(s=y=t[r],typeof y=="object"){for(;y!=null&&++a<c&&(_+=1,r=i[a],!(r!=="*"&&!m&&!(typeof y=="object"&&r in y)));)if(!(r==="*"&&(m==="*"&&(w=true),m=r,a!==p))){if(m){let R=Object.keys(y);for(var A=0;A<R.length;A++){let E=R[A];if(b=y[E],S=r==="*",w)L=H(L,E,_),v=a,s=br(b,v-1,r,n,i,o,u,l,h,y,f,s,S,E,a,p,L,e,t[h],_+1);else if(S||typeof b=="object"&&b!==null&&r in b){if(S?s=b:s=b[r],f=a!==p?s:u?l?o(s,[...n,h,...i]):o(s):o,S){let k=ue(H(L,E,_),s,t[h]);e.push(k),y[E]=f;}else if(b[r]!==f)if(f===void 0&&o!==void 0||He(b,r)&&f===s)L=H(L,E,_);else {L=H(L,E,_);let k=ue(H(L,r,_+1),s,t[h]);e.push(k),b[r]=f;}}}m=null;}else {if(s=y[r],L=H(L,r,_),f=a!==p?s:u?l?o(s,[...n,h,...i]):o(s):o,!(He(y,r)&&f===s||f===void 0&&o!==void 0)){let R=ue(L,s,t[h]);e.push(R),y[r]=f;}y=y[r];}if(typeof y!="object")break}}}function yr(e,t){for(var r=-1,n=t.length,i=e;i!=null&&++r<n;)i=i[t[r]];return i}function br(e,t,r,n,i,o,u,l,c,p,h,a,y,f,s,g,m,S,b,w){if(t===0&&(y||typeof e=="object"&&e!==null&&r in e)){if(y?a=e:a=e[r],h=s!==g?a:u?l?o(a,[...n,c,...i]):o(a):o,y){let v=ue(m,a,b);S.push(v),p[f]=h;}else if(e[r]!==h){if(!(h===void 0&&o!==void 0||He(e,r)&&h===a)){let v=ue(H(m,r,w+1),a,b);S.push(v),e[r]=h;}}}for(let v in e)typeof e[v]=="object"&&(m=H(m,v,w),br(e[v],t-1,r,n,i,o,u,l,c,p,h,a,y,f,s,g,m,S,b,w+1));}function Zi(){return {parent:null,key:null,children:[],depth:0}}function H(e,t,r){if(e.depth===r)return H(e.parent,t,r);var n={parent:e,key:t,depth:r,children:[]};return e.children.push(n),n}function ue(e,t,r){let n=e,i=[];do i.push(n.key),n=n.parent;while(n.parent!=null);return {path:i,value:t,target:r}}});var vr=O((sc,Sr)=>{var{groupRestore:es,nestedRestore:ts}=Je();Sr.exports=rs;function rs(){return function(){if(this.restore){this.restore.state.secret=this.secret;return}let{secret:t,wcLen:r}=this,n=Object.keys(t),i=ns(t,n),o=r>0,u=o?{secret:t,groupRestore:es,nestedRestore:ts}:{secret:t};this.restore=Function("o",is(i,n,o)).bind(u),this.restore.state=u;}}function ns(e,t){return t.map(r=>{let{circle:n,escPath:i,leadingBracket:o}=e[r],l=n?`o.${n} = secret[${i}].val`:`o${o?"":"."}${r} = secret[${i}].val`,c=`secret[${i}].val = undefined`;return `
      if (secret[${i}].val !== undefined) {
        try { ${l} } catch (e) {}
        ${c}
      }
    `}).join("")}function is(e,t,r){return `
    const secret = this.secret
    ${r===true?`
    const keys = Object.keys(secret)
    const len = keys.length
    for (var i = len - 1; i >= ${t.length}; i--) {
      const k = keys[i]
      const o = secret[k]
      if (o) {
        if (o.flat === true) this.groupRestore(o)
        else this.nestedRestore(o)
        secret[k] = null
      }
    }
  `:""}
    ${e}
    return o
  `}});var xr=O((oc,Er)=>{Er.exports=ss;function ss(e){let{secret:t,censor:r,compileRestore:n,serialize:i,groupRedact:o,nestedRedact:u,wildcards:l,wcLen:c}=e,p=[{secret:t,censor:r,compileRestore:n}];return i!==false&&p.push({serialize:i}),c>0&&p.push({groupRedact:o,nestedRedact:u,wildcards:l,wcLen:c}),Object.assign(...p)}});var Lr=O((ac,Or)=>{var _r=fr(),os=pr(),as=gr(),ls=vr(),{groupRedact:us,nestedRedact:cs}=Je(),fs=xr(),ds=Se(),hs=_r(),Xe=e=>e;Xe.restore=Xe;var ps="[REDACTED]";Ye.rx=ds;Ye.validator=_r;Or.exports=Ye;function Ye(e={}){let t=Array.from(new Set(e.paths||[])),r="serialize"in e&&(e.serialize===false||typeof e.serialize=="function")?e.serialize:JSON.stringify,n=e.remove;if(n===true&&r!==JSON.stringify)throw Error("fast-redact \u2013 remove option may only be set when serializer is JSON.stringify");let i=n===true?void 0:"censor"in e?e.censor:ps,o=typeof i=="function",u=o&&i.length>1;if(t.length===0)return r||Xe;hs({paths:t,serialize:r,censor:i});let{wildcards:l,wcLen:c,secret:p}=os({paths:t,censor:i}),h=ls(),a="strict"in e?e.strict:true;return as({secret:p,wcLen:c,serialize:r,strict:a,isCensorFct:o,censorFctTakesPath:u},fs({secret:p,censor:i,compileRestore:h,serialize:r,groupRedact:us,nestedRedact:cs,wildcards:l,wcLen:c}))}});var te=O((lc,Ar)=>{var ms=Symbol("pino.setLevel"),gs=Symbol("pino.getLevel"),ys=Symbol("pino.levelVal"),bs=Symbol("pino.levelComp"),ws=Symbol("pino.useLevelLabels"),Ss=Symbol("pino.useOnlyCustomLevels"),vs=Symbol("pino.mixin"),Es=Symbol("pino.lsCache"),xs=Symbol("pino.chindings"),_s=Symbol("pino.asJson"),Os=Symbol("pino.write"),Ls=Symbol("pino.redactFmt"),As=Symbol("pino.time"),Rs=Symbol("pino.timeSliceIndex"),Ts=Symbol("pino.stream"),ks=Symbol("pino.stringify"),Is=Symbol("pino.stringifySafe"),Cs=Symbol("pino.stringifiers"),$s=Symbol("pino.end"),Ps=Symbol("pino.formatOpts"),Ds=Symbol("pino.messageKey"),js=Symbol("pino.errorKey"),zs=Symbol("pino.nestedKey"),Ns=Symbol("pino.nestedKeyStr"),Ms=Symbol("pino.mixinMergeStrategy"),qs=Symbol("pino.msgPrefix"),Bs=Symbol("pino.wildcardFirst"),Fs=Symbol.for("pino.serializers"),Us=Symbol.for("pino.formatters"),Vs=Symbol.for("pino.hooks"),Ws=Symbol.for("pino.metadata");Ar.exports={setLevelSym:ms,getLevelSym:gs,levelValSym:ys,levelCompSym:bs,useLevelLabelsSym:ws,mixinSym:vs,lsCacheSym:Es,chindingsSym:xs,asJsonSym:_s,writeSym:Os,serializersSym:Fs,redactFmtSym:Ls,timeSym:As,timeSliceIndexSym:Rs,streamSym:Ts,stringifySym:ks,stringifySafeSym:Is,stringifiersSym:Cs,endSym:$s,formatOptsSym:Ps,messageKeySym:Ds,errorKeySym:js,nestedKeySym:zs,wildcardFirstSym:Bs,needsMetadataGsym:Ws,useOnlyCustomLevelsSym:Ss,formattersSym:Us,hooksSym:Vs,nestedKeyStrSym:Ns,mixinMergeStrategySym:Ms,msgPrefixSym:qs};});var et=O((uc,Ir)=>{var Ze=Lr(),{redactFmtSym:Gs,wildcardFirstSym:ve}=te(),{rx:Qe,validator:Ks}=Ze,Rr=Ks({ERR_PATHS_MUST_BE_STRINGS:()=>"pino \u2013 redacted paths must be strings",ERR_INVALID_PATH:e=>`pino \u2013 redact paths array contains an invalid path (${e})`}),Tr="[Redacted]",kr=false;function Hs(e,t){let{paths:r,censor:n}=Js(e),i=r.reduce((l,c)=>{Qe.lastIndex=0;let p=Qe.exec(c),h=Qe.exec(c),a=p[1]!==void 0?p[1].replace(/^(?:"|'|`)(.*)(?:"|'|`)$/,"$1"):p[0];if(a==="*"&&(a=ve),h===null)return l[a]=null,l;if(l[a]===null)return l;let{index:y}=h,f=`${c.substr(y,c.length-1)}`;return l[a]=l[a]||[],a!==ve&&l[a].length===0&&l[a].push(...l[ve]||[]),a===ve&&Object.keys(l).forEach(function(s){l[s]&&l[s].push(f);}),l[a].push(f),l},{}),o={[Gs]:Ze({paths:r,censor:n,serialize:t,strict:kr})},u=(...l)=>t(typeof n=="function"?n(...l):n);return [...Object.keys(i),...Object.getOwnPropertySymbols(i)].reduce((l,c)=>{if(i[c]===null)l[c]=p=>u(p,[c]);else {let p=typeof n=="function"?(h,a)=>n(h,[c,...a]):n;l[c]=Ze({paths:i[c],censor:p,serialize:t,strict:kr});}return l},o)}function Js(e){if(Array.isArray(e))return e={paths:e,censor:Tr},Rr(e),e;let{paths:t,censor:r=Tr,remove:n}=e;if(Array.isArray(t)===false)throw Error("pino \u2013 redact must contain an array of strings");return n===true&&(r=void 0),Rr({paths:t,censor:r}),{paths:t,censor:r}}Ir.exports=Hs;});var $r=O((cc,Cr)=>{var Xs=()=>"",Ys=()=>`,"time":${Date.now()}`,Qs=()=>`,"time":${Math.round(Date.now()/1e3)}`,Zs=()=>`,"time":"${new Date(Date.now()).toISOString()}"`;Cr.exports={nullTime:Xs,epochTime:Ys,unixTime:Qs,isoTime:Zs};});var Dr=O((fc,Pr)=>{function eo(e){try{return JSON.stringify(e)}catch{return '"[Circular]"'}}Pr.exports=to;function to(e,t,r){var n=r&&r.stringify||eo,i=1;if(typeof e=="object"&&e!==null){var o=t.length+i;if(o===1)return e;var u=new Array(o);u[0]=n(e);for(var l=1;l<o;l++)u[l]=n(t[l]);return u.join(" ")}if(typeof e!="string")return e;var c=t.length;if(c===0)return e;for(var p="",h=1-i,a=-1,y=e&&e.length||0,f=0;f<y;){if(e.charCodeAt(f)===37&&f+1<y){switch(a=a>-1?a:0,e.charCodeAt(f+1)){case 100:case 102:if(h>=c||t[h]==null)break;a<f&&(p+=e.slice(a,f)),p+=Number(t[h]),a=f+2,f++;break;case 105:if(h>=c||t[h]==null)break;a<f&&(p+=e.slice(a,f)),p+=Math.floor(Number(t[h])),a=f+2,f++;break;case 79:case 111:case 106:if(h>=c||t[h]===void 0)break;a<f&&(p+=e.slice(a,f));var s=typeof t[h];if(s==="string"){p+="'"+t[h]+"'",a=f+2,f++;break}if(s==="function"){p+=t[h].name||"<anonymous>",a=f+2,f++;break}p+=n(t[h]),a=f+2,f++;break;case 115:if(h>=c)break;a<f&&(p+=e.slice(a,f)),p+=String(t[h]),a=f+2,f++;break;case 37:a<f&&(p+=e.slice(a,f)),p+="%",a=f+2,f++,h--;break}++h;}++f;}return a===-1?e:(a<y&&(p+=e.slice(a)),p)}});var rt=O((dc,tt)=>{if(typeof SharedArrayBuffer<"u"&&typeof Atomics<"u"){let t=function(r){if((r>0&&r<1/0)===false)throw typeof r!="number"&&typeof r!="bigint"?TypeError("sleep: ms must be a number"):RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity");Atomics.wait(e,0,0,Number(r));},e=new Int32Array(new SharedArrayBuffer(4));tt.exports=t;}else {let e=function(t){if((t>0&&t<1/0)===false)throw typeof t!="number"&&typeof t!="bigint"?TypeError("sleep: ms must be a number"):RangeError("sleep: ms must be a number that is greater than 0 but less than Infinity");};tt.exports=e;}});var Ur=O((hc,Fr)=>{var I=$("fs"),ro=$("events"),no=$("util").inherits,jr=$("path"),it=rt(),io=$("assert"),Ee=100,xe=Buffer.allocUnsafe(0),so=16*1024,zr="buffer",Nr="utf8",[oo,ao]=(process.versions.node||"0.0").split(".").map(Number),lo=oo>=22&&ao>=7;function Mr(e,t){t._opening=true,t._writing=true,t._asyncDrainScheduled=false;function r(o,u){if(o){t._reopening=false,t._writing=false,t._opening=false,t.sync?process.nextTick(()=>{t.listenerCount("error")>0&&t.emit("error",o);}):t.emit("error",o);return}let l=t._reopening;t.fd=u,t.file=e,t._reopening=false,t._opening=false,t._writing=false,t.sync?process.nextTick(()=>t.emit("ready")):t.emit("ready"),!t.destroyed&&(!t._writing&&t._len>t.minLength||t._flushPending?t._actualWrite():l&&process.nextTick(()=>t.emit("drain")));}let n=t.append?"a":"w",i=t.mode;if(t.sync)try{t.mkdir&&I.mkdirSync(jr.dirname(e),{recursive:!0});let o=I.openSync(e,n,i);r(null,o);}catch(o){throw r(o),o}else t.mkdir?I.mkdir(jr.dirname(e),{recursive:true},o=>{if(o)return r(o);I.open(e,n,i,r);}):I.open(e,n,i,r);}function U(e){if(!(this instanceof U))return new U(e);let{fd:t,dest:r,minLength:n,maxLength:i,maxWrite:o,periodicFlush:u,sync:l,append:c=true,mkdir:p,retryEAGAIN:h,fsync:a,contentMode:y,mode:f}=e||{};t=t||r,this._len=0,this.fd=-1,this._bufs=[],this._lens=[],this._writing=false,this._ending=false,this._reopening=false,this._asyncDrainScheduled=false,this._flushPending=false,this._hwm=Math.max(n||0,16387),this.file=null,this.destroyed=false,this.minLength=n||0,this.maxLength=i||0,this.maxWrite=o||so,this._periodicFlush=u||0,this._periodicFlushTimer=void 0,this.sync=l||false,this.writable=true,this._fsync=a||false,this.append=c||false,this.mode=f,this.retryEAGAIN=h||(()=>true),this.mkdir=p||false;let s,g;if(y===zr)this._writingBuf=xe,this.write=fo,this.flush=po,this.flushSync=go,this._actualWrite=bo,s=()=>I.writeSync(this.fd,this._writingBuf),g=()=>I.write(this.fd,this._writingBuf,this.release);else if(y===void 0||y===Nr)this._writingBuf="",this.write=co,this.flush=ho,this.flushSync=mo,this._actualWrite=yo,s=()=>I.writeSync(this.fd,this._writingBuf,"utf8"),g=()=>I.write(this.fd,this._writingBuf,"utf8",this.release);else throw new Error(`SonicBoom supports "${Nr}" and "${zr}", but passed ${y}`);if(typeof t=="number")this.fd=t,process.nextTick(()=>this.emit("ready"));else if(typeof t=="string")Mr(t,this);else throw new Error("SonicBoom supports only file descriptors and files");if(this.minLength>=this.maxWrite)throw new Error(`minLength should be smaller than maxWrite (${this.maxWrite})`);this.release=(m,S)=>{if(m){if((m.code==="EAGAIN"||m.code==="EBUSY")&&this.retryEAGAIN(m,this._writingBuf.length,this._len-this._writingBuf.length))if(this.sync)try{it(Ee),this.release(void 0,0);}catch(v){this.release(v);}else setTimeout(g,Ee);else this._writing=false,this.emit("error",m);return}this.emit("write",S);let b=nt(this._writingBuf,this._len,S);if(this._len=b.len,this._writingBuf=b.writingBuf,this._writingBuf.length){if(!this.sync){g();return}try{do{let v=s(),_=nt(this._writingBuf,this._len,v);this._len=_.len,this._writingBuf=_.writingBuf;}while(this._writingBuf.length)}catch(v){this.release(v);return}}this._fsync&&I.fsyncSync(this.fd);let w=this._len;this._reopening?(this._writing=false,this._reopening=false,this.reopen()):w>this.minLength?this._actualWrite():this._ending?w>0?this._actualWrite():(this._writing=false,_e(this)):(this._writing=false,this.sync?this._asyncDrainScheduled||(this._asyncDrainScheduled=true,process.nextTick(uo,this)):this.emit("drain"));},this.on("newListener",function(m){m==="drain"&&(this._asyncDrainScheduled=false);}),this._periodicFlush!==0&&(this._periodicFlushTimer=setInterval(()=>this.flush(null),this._periodicFlush),this._periodicFlushTimer.unref());}function nt(e,t,r){return typeof e=="string"&&Buffer.byteLength(e)!==r&&(r=Buffer.from(e).subarray(0,r).toString().length),t=Math.max(t-r,0),e=e.slice(r),{writingBuf:e,len:t}}function uo(e){e.listenerCount("drain")>0&&(e._asyncDrainScheduled=false,e.emit("drain"));}no(U,ro);function qr(e,t){return e.length===0?xe:e.length===1?e[0]:Buffer.concat(e,t)}function co(e){if(this.destroyed)throw new Error("SonicBoom destroyed");let t=this._len+e.length,r=this._bufs;return this.maxLength&&t>this.maxLength?(this.emit("drop",e),this._len<this._hwm):(r.length===0||r[r.length-1].length+e.length>this.maxWrite?r.push(""+e):r[r.length-1]+=e,this._len=t,!this._writing&&this._len>=this.minLength&&this._actualWrite(),this._len<this._hwm)}function fo(e){if(this.destroyed)throw new Error("SonicBoom destroyed");let t=this._len+e.length,r=this._bufs,n=this._lens;return this.maxLength&&t>this.maxLength?(this.emit("drop",e),this._len<this._hwm):(r.length===0||n[n.length-1]+e.length>this.maxWrite?(r.push([e]),n.push(e.length)):(r[r.length-1].push(e),n[n.length-1]+=e.length),this._len=t,!this._writing&&this._len>=this.minLength&&this._actualWrite(),this._len<this._hwm)}function Br(e){this._flushPending=true;let t=()=>{if(this._fsync)this._flushPending=false,e();else try{I.fsync(this.fd,n=>{this._flushPending=!1,e(n);});}catch(n){e(n);}this.off("error",r);},r=n=>{this._flushPending=false,e(n),this.off("drain",t);};this.once("drain",t),this.once("error",r);}function ho(e){if(e!=null&&typeof e!="function")throw new Error("flush cb must be a function");if(this.destroyed){let t=new Error("SonicBoom destroyed");if(e){e(t);return}throw t}if(this.minLength<=0){e?.();return}e&&Br.call(this,e),!this._writing&&(this._bufs.length===0&&this._bufs.push(""),this._actualWrite());}function po(e){if(e!=null&&typeof e!="function")throw new Error("flush cb must be a function");if(this.destroyed){let t=new Error("SonicBoom destroyed");if(e){e(t);return}throw t}if(this.minLength<=0){e?.();return}e&&Br.call(this,e),!this._writing&&(this._bufs.length===0&&(this._bufs.push([]),this._lens.push(0)),this._actualWrite());}U.prototype.reopen=function(e){if(this.destroyed)throw new Error("SonicBoom destroyed");if(this._opening){this.once("ready",()=>{this.reopen(e);});return}if(this._ending)return;if(!this.file)throw new Error("Unable to reopen a file descriptor, you must pass a file to SonicBoom");if(e&&(this.file=e),this._reopening=true,this._writing)return;let t=this.fd;this.once("ready",()=>{t!==this.fd&&I.close(t,r=>{if(r)return this.emit("error",r)});}),Mr(this.file,this);};U.prototype.end=function(){if(this.destroyed)throw new Error("SonicBoom destroyed");if(this._opening){this.once("ready",()=>{this.end();});return}this._ending||(this._ending=true,!this._writing&&(this._len>0&&this.fd>=0?this._actualWrite():_e(this)));};function mo(){if(this.destroyed)throw new Error("SonicBoom destroyed");if(this.fd<0)throw new Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift(this._writingBuf),this._writingBuf="");let e="";for(;this._bufs.length||e;){e.length<=0&&(e=this._bufs[0]);try{let t=I.writeSync(this.fd,e,"utf8"),r=nt(e,this._len,t);e=r.writingBuf,this._len=r.len,e.length<=0&&this._bufs.shift();}catch(t){if((t.code==="EAGAIN"||t.code==="EBUSY")&&!this.retryEAGAIN(t,e.length,this._len-e.length))throw t;it(Ee);}}try{I.fsyncSync(this.fd);}catch{}}function go(){if(this.destroyed)throw new Error("SonicBoom destroyed");if(this.fd<0)throw new Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift([this._writingBuf]),this._writingBuf=xe);let e=xe;for(;this._bufs.length||e.length;){e.length<=0&&(e=qr(this._bufs[0],this._lens[0]));try{let t=I.writeSync(this.fd,e);e=e.subarray(t),this._len=Math.max(this._len-t,0),e.length<=0&&(this._bufs.shift(),this._lens.shift());}catch(t){if((t.code==="EAGAIN"||t.code==="EBUSY")&&!this.retryEAGAIN(t,e.length,this._len-e.length))throw t;it(Ee);}}}U.prototype.destroy=function(){this.destroyed||_e(this);};function yo(){let e=this.release;if(this._writing=true,this._writingBuf=this._writingBuf||this._bufs.shift()||"",this.sync)try{let t=I.writeSync(this.fd,this._writingBuf,"utf8");e(null,t);}catch(t){e(t);}else I.write(this.fd,this._writingBuf,"utf8",e);}function bo(){let e=this.release;if(this._writing=true,this._writingBuf=this._writingBuf.length?this._writingBuf:qr(this._bufs.shift(),this._lens.shift()),this.sync)try{let t=I.writeSync(this.fd,this._writingBuf);e(null,t);}catch(t){e(t);}else lo&&(this._writingBuf=Buffer.from(this._writingBuf)),I.write(this.fd,this._writingBuf,e);}function _e(e){if(e.fd===-1){e.once("ready",_e.bind(null,e));return}e._periodicFlushTimer!==void 0&&clearInterval(e._periodicFlushTimer),e.destroyed=true,e._bufs=[],e._lens=[],io(typeof e.fd=="number",`sonic.fd must be a number, got ${typeof e.fd}`);try{I.fsync(e.fd,t);}catch{}function t(){e.fd!==1&&e.fd!==2?I.close(e.fd,r):r();}function r(n){if(n){e.emit("error",n);return}e._ending&&!e._writing&&e.emit("finish"),e.emit("close");}}U.SonicBoom=U;U.default=U;Fr.exports=U;});var st=O((pc,Hr)=>{var V={exit:[],beforeExit:[]},Vr={exit:vo,beforeExit:Eo},re;function wo(){re===void 0&&(re=new FinalizationRegistry(xo));}function So(e){V[e].length>0||process.on(e,Vr[e]);}function Wr(e){V[e].length>0||(process.removeListener(e,Vr[e]),V.exit.length===0&&V.beforeExit.length===0&&(re=void 0));}function vo(){Gr("exit");}function Eo(){Gr("beforeExit");}function Gr(e){for(let t of V[e]){let r=t.deref(),n=t.fn;r!==void 0&&n(r,e);}V[e]=[];}function xo(e){for(let t of ["exit","beforeExit"]){let r=V[t].indexOf(e);V[t].splice(r,r+1),Wr(t);}}function Kr(e,t,r){if(t===void 0)throw new Error("the object can't be undefined");So(e);let n=new WeakRef(t);n.fn=r,wo(),re.register(t,n),V[e].push(n);}function _o(e,t){Kr("exit",e,t);}function Oo(e,t){Kr("beforeExit",e,t);}function Lo(e){if(re!==void 0){re.unregister(e);for(let t of ["exit","beforeExit"])V[t]=V[t].filter(r=>{let n=r.deref();return n&&n!==e}),Wr(t);}}Hr.exports={register:_o,registerBeforeExit:Oo,unregister:Lo};});var Jr=O((mc,Ao)=>{Ao.exports={name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"};});var Yr=O((gc,Xr)=>{function Ro(e,t,r,n,i){let o=Date.now()+n,u=Atomics.load(e,t);if(u===r){i(null,"ok");return}let l=u,c=p=>{Date.now()>o?i(null,"timed-out"):setTimeout(()=>{l=u,u=Atomics.load(e,t),u===l?c(p>=1e3?1e3:p*2):u===r?i(null,"ok"):i(null,"not-equal");},p);};c(1);}function To(e,t,r,n,i){let o=Date.now()+n,u=Atomics.load(e,t);if(u!==r){i(null,"ok");return}let l=c=>{Date.now()>o?i(null,"timed-out"):setTimeout(()=>{u=Atomics.load(e,t),u!==r?i(null,"ok"):l(c>=1e3?1e3:c*2);},c);};l(1);}Xr.exports={wait:Ro,waitDiff:To};});var Zr=O((yc,Qr)=>{Qr.exports={WRITE_INDEX:4,READ_INDEX:8};});var sn=O((bc,nn)=>{var{version:ko}=Jr(),{EventEmitter:Io}=$("events"),{Worker:Co}=$("worker_threads"),{join:$o}=$("path"),{pathToFileURL:Po}=$("url"),{wait:Do}=Yr(),{WRITE_INDEX:z,READ_INDEX:W}=Zr(),jo=$("buffer"),zo=$("assert"),d=Symbol("kImpl"),No=jo.constants.MAX_STRING_LENGTH,ce=class{constructor(t){this._value=t;}deref(){return this._value}},Le=class{register(){}unregister(){}},Mo=process.env.NODE_V8_COVERAGE?Le:global.FinalizationRegistry||Le,qo=process.env.NODE_V8_COVERAGE?ce:global.WeakRef||ce,en=new Mo(e=>{e.exited||e.terminate();});function Bo(e,t){let{filename:r,workerData:n}=t,o=("__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{})["thread-stream-worker"]||$o(__dirname,"lib","worker.js"),u=new Co(o,{...t.workerOpts,trackUnmanagedFds:false,workerData:{filename:r.indexOf("file://")===0?r:Po(r).href,dataBuf:e[d].dataBuf,stateBuf:e[d].stateBuf,workerData:{$context:{threadStreamVersion:ko},...n}}});return u.stream=new ce(e),u.on("message",Fo),u.on("exit",rn),en.register(e,u),u}function tn(e){zo(!e[d].sync),e[d].needDrain&&(e[d].needDrain=false,e.emit("drain"));}function Oe(e){let t=Atomics.load(e[d].state,z),r=e[d].data.length-t;if(r>0){if(e[d].buf.length===0){e[d].flushing=false,e[d].ending?ct(e):e[d].needDrain&&process.nextTick(tn,e);return}let n=e[d].buf.slice(0,r),i=Buffer.byteLength(n);i<=r?(e[d].buf=e[d].buf.slice(r),Ae(e,n,Oe.bind(null,e))):e.flush(()=>{if(!e.destroyed){for(Atomics.store(e[d].state,W,0),Atomics.store(e[d].state,z,0);i>e[d].data.length;)r=r/2,n=e[d].buf.slice(0,r),i=Buffer.byteLength(n);e[d].buf=e[d].buf.slice(r),Ae(e,n,Oe.bind(null,e));}});}else if(r===0){if(t===0&&e[d].buf.length===0)return;e.flush(()=>{Atomics.store(e[d].state,W,0),Atomics.store(e[d].state,z,0),Oe(e);});}else G(e,new Error("overwritten"));}function Fo(e){let t=this.stream.deref();if(t===void 0){this.exited=true,this.terminate();return}switch(e.code){case "READY":this.stream=new qo(t),t.flush(()=>{t[d].ready=true,t.emit("ready");});break;case "ERROR":G(t,e.err);break;case "EVENT":Array.isArray(e.args)?t.emit(e.name,...e.args):t.emit(e.name,e.args);break;case "WARNING":process.emitWarning(e.err);break;default:G(t,new Error("this should not happen: "+e.code));}}function rn(e){let t=this.stream.deref();t!==void 0&&(en.unregister(t),t.worker.exited=true,t.worker.off("exit",rn),G(t,e!==0?new Error("the worker thread exited"):null));}var at=class extends Io{constructor(t={}){if(super(),t.bufferSize<4)throw new Error("bufferSize must at least fit a 4-byte utf-8 char");this[d]={},this[d].stateBuf=new SharedArrayBuffer(128),this[d].state=new Int32Array(this[d].stateBuf),this[d].dataBuf=new SharedArrayBuffer(t.bufferSize||4*1024*1024),this[d].data=Buffer.from(this[d].dataBuf),this[d].sync=t.sync||false,this[d].ending=false,this[d].ended=false,this[d].needDrain=false,this[d].destroyed=false,this[d].flushing=false,this[d].ready=false,this[d].finished=false,this[d].errored=null,this[d].closed=false,this[d].buf="",this.worker=Bo(this,t),this.on("message",(r,n)=>{this.worker.postMessage(r,n);});}write(t){if(this[d].destroyed)return lt(this,new Error("the worker has exited")),false;if(this[d].ending)return lt(this,new Error("the worker is ending")),false;if(this[d].flushing&&this[d].buf.length+t.length>=No)try{ot(this),this[d].flushing=!0;}catch(r){return G(this,r),false}if(this[d].buf+=t,this[d].sync)try{return ot(this),!0}catch(r){return G(this,r),false}return this[d].flushing||(this[d].flushing=true,setImmediate(Oe,this)),this[d].needDrain=this[d].data.length-this[d].buf.length-Atomics.load(this[d].state,z)<=0,!this[d].needDrain}end(){this[d].destroyed||(this[d].ending=true,ct(this));}flush(t){if(this[d].destroyed){typeof t=="function"&&process.nextTick(t,new Error("the worker has exited"));return}let r=Atomics.load(this[d].state,z);Do(this[d].state,W,r,1/0,(n,i)=>{if(n){G(this,n),process.nextTick(t,n);return}if(i==="not-equal"){this.flush(t);return}process.nextTick(t);});}flushSync(){this[d].destroyed||(ot(this),ut(this));}unref(){this.worker.unref();}ref(){this.worker.ref();}get ready(){return this[d].ready}get destroyed(){return this[d].destroyed}get closed(){return this[d].closed}get writable(){return !this[d].destroyed&&!this[d].ending}get writableEnded(){return this[d].ending}get writableFinished(){return this[d].finished}get writableNeedDrain(){return this[d].needDrain}get writableObjectMode(){return  false}get writableErrored(){return this[d].errored}};function lt(e,t){setImmediate(()=>{e.emit("error",t);});}function G(e,t){e[d].destroyed||(e[d].destroyed=true,t&&(e[d].errored=t,lt(e,t)),e.worker.exited?setImmediate(()=>{e[d].closed=true,e.emit("close");}):e.worker.terminate().catch(()=>{}).then(()=>{e[d].closed=true,e.emit("close");}));}function Ae(e,t,r){let n=Atomics.load(e[d].state,z),i=Buffer.byteLength(t);return e[d].data.write(t,n),Atomics.store(e[d].state,z,n+i),Atomics.notify(e[d].state,z),r(),true}function ct(e){if(!(e[d].ended||!e[d].ending||e[d].flushing)){e[d].ended=true;try{e.flushSync();let t=Atomics.load(e[d].state,W);Atomics.store(e[d].state,z,-1),Atomics.notify(e[d].state,z);let r=0;for(;t!==-1;){if(Atomics.wait(e[d].state,W,t,1e3),t=Atomics.load(e[d].state,W),t===-2){G(e,new Error("end() failed"));return}if(++r===10){G(e,new Error("end() took too long (10s)"));return}}process.nextTick(()=>{e[d].finished=!0,e.emit("finish");});}catch(t){G(e,t);}}}function ot(e){let t=()=>{e[d].ending?ct(e):e[d].needDrain&&process.nextTick(tn,e);};for(e[d].flushing=false;e[d].buf.length!==0;){let r=Atomics.load(e[d].state,z),n=e[d].data.length-r;if(n===0){ut(e),Atomics.store(e[d].state,W,0),Atomics.store(e[d].state,z,0);continue}else if(n<0)throw new Error("overwritten");let i=e[d].buf.slice(0,n),o=Buffer.byteLength(i);if(o<=n)e[d].buf=e[d].buf.slice(n),Ae(e,i,t);else {for(ut(e),Atomics.store(e[d].state,W,0),Atomics.store(e[d].state,z,0);o>e[d].buf.length;)n=n/2,i=e[d].buf.slice(0,n),o=Buffer.byteLength(i);e[d].buf=e[d].buf.slice(n),Ae(e,i,t);}}}function ut(e){if(e[d].flushing)throw new Error("unable to flush while flushing");let t=Atomics.load(e[d].state,z),r=0;for(;;){let n=Atomics.load(e[d].state,W);if(n===-2)throw Error("_flushSync failed");if(n!==t)Atomics.wait(e[d].state,W,n,1e3);else break;if(++r===10)throw new Error("_flushSync took too long (10s)")}}nn.exports=at;});var ht=O((wc,on)=>{var{createRequire:Uo}=$("module"),Vo=Ke(),{join:ft,isAbsolute:Wo,sep:Go}=$("path"),Ko=rt(),dt=st(),Ho=sn();function Jo(e){dt.register(e,Yo),dt.registerBeforeExit(e,Qo),e.on("close",function(){dt.unregister(e);});}function Xo(e,t,r,n){let i=new Ho({filename:e,workerData:t,workerOpts:r,sync:n});i.on("ready",o),i.on("close",function(){process.removeListener("exit",u);}),process.on("exit",u);function o(){process.removeListener("exit",u),i.unref(),r.autoEnd!==false&&Jo(i);}function u(){i.closed||(i.flushSync(),Ko(100),i.end());}return i}function Yo(e){e.ref(),e.flushSync(),e.end(),e.once("close",function(){e.unref();});}function Qo(e){e.flushSync();}function Zo(e){let{pipeline:t,targets:r,levels:n,dedupe:i,worker:o={},caller:u=Vo(),sync:l=false}=e,c={...e.options},p=typeof u=="string"?[u]:u,h="__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{},a=e.target;if(a&&r)throw new Error("only one of target or targets can be specified");return r?(a=h["pino-worker"]||ft(__dirname,"worker.js"),c.targets=r.filter(f=>f.target).map(f=>({...f,target:y(f.target)})),c.pipelines=r.filter(f=>f.pipeline).map(f=>f.pipeline.map(s=>({...s,level:f.level,target:y(s.target)})))):t&&(a=h["pino-worker"]||ft(__dirname,"worker.js"),c.pipelines=[t.map(f=>({...f,target:y(f.target)}))]),n&&(c.levels=n),i&&(c.dedupe=i),c.pinoWillSendConfig=true,Xo(y(a),c,o,l);function y(f){if(f=h[f]||f,Wo(f)||f.indexOf("file://")===0)return f;if(f==="pino/file")return ft(__dirname,"..","file.js");let s;for(let g of p)try{let m=g==="node:repl"?process.cwd()+Go:g;s=Uo(m).resolve(f);break}catch{continue}if(!s)throw new Error(`unable to determine transport target for "${f}"`);return s}}on.exports=Zo;});var ke=O((Sc,yn)=>{var an=Dr(),{mapHttpRequest:ea,mapHttpResponse:ta}=Ge(),mt=Ur(),ln=st(),{lsCacheSym:ra,chindingsSym:fn,writeSym:un,serializersSym:dn,formatOptsSym:cn,endSym:na,stringifiersSym:hn,stringifySym:pn,stringifySafeSym:gt,wildcardFirstSym:mn,nestedKeySym:ia,formattersSym:gn,messageKeySym:sa,errorKeySym:oa,nestedKeyStrSym:aa,msgPrefixSym:Re}=te(),{isMainThread:la}=$("worker_threads"),ua=ht();function ne(){}function ca(e,t){if(!t)return r;return function(...i){t.call(this,i,r,e);};function r(n,...i){if(typeof n=="object"){let o=n;n!==null&&(n.method&&n.headers&&n.socket?n=ea(n):typeof n.setHeader=="function"&&(n=ta(n)));let u;o===null&&i.length===0?u=[null]:(o=i.shift(),u=i),typeof this[Re]=="string"&&o!==void 0&&o!==null&&(o=this[Re]+o),this[un](n,an(o,u,this[cn]),e);}else {let o=n===void 0?i.shift():n;typeof this[Re]=="string"&&o!==void 0&&o!==null&&(o=this[Re]+o),this[un](null,an(o,i,this[cn]),e);}}}function pt(e){let t="",r=0,n=false,i=255,o=e.length;if(o>100)return JSON.stringify(e);for(var u=0;u<o&&i>=32;u++)i=e.charCodeAt(u),(i===34||i===92)&&(t+=e.slice(r,u)+"\\",r=u,n=true);return n?t+=e.slice(r):t=e,i<32?JSON.stringify(e):'"'+t+'"'}function fa(e,t,r,n){let i=this[pn],o=this[gt],u=this[hn],l=this[na],c=this[fn],p=this[dn],h=this[gn],a=this[sa],y=this[oa],f=this[ra][r]+n;f=f+c;let s;h.log&&(e=h.log(e));let g=u[mn],m="";for(let b in e)if(s=e[b],Object.prototype.hasOwnProperty.call(e,b)&&s!==void 0){p[b]?s=p[b](s):b===y&&p.err&&(s=p.err(s));let w=u[b]||g;switch(typeof s){case "undefined":case "function":continue;case "number":Number.isFinite(s)===false&&(s=null);case "boolean":w&&(s=w(s));break;case "string":s=(w||pt)(s);break;default:s=(w||i)(s,o);}if(s===void 0)continue;let v=pt(b);m+=","+v+":"+s;}let S="";if(t!==void 0){s=p[a]?p[a](t):t;let b=u[a]||g;switch(typeof s){case "function":break;case "number":Number.isFinite(s)===false&&(s=null);case "boolean":b&&(s=b(s)),S=',"'+a+'":'+s;break;case "string":s=(b||pt)(s),S=',"'+a+'":'+s;break;default:s=(b||i)(s,o),S=',"'+a+'":'+s;}}return this[ia]&&m?f+this[aa]+m.slice(1)+"}"+S+l:f+m+S+l}function da(e,t){let r,n=e[fn],i=e[pn],o=e[gt],u=e[hn],l=u[mn],c=e[dn],p=e[gn].bindings;t=p(t);for(let h in t)if(r=t[h],(h!=="level"&&h!=="serializers"&&h!=="formatters"&&h!=="customLevels"&&t.hasOwnProperty(h)&&r!==void 0)===true){if(r=c[h]?c[h](r):r,r=(u[h]||l||i)(r,o),r===void 0)continue;n+=',"'+h+'":'+r;}return n}function ha(e){return e.write!==e.constructor.prototype.write}function Te(e){let t=new mt(e);return t.on("error",r),!e.sync&&la&&(ln.register(t,pa),t.on("close",function(){ln.unregister(t);})),t;function r(n){if(n.code==="EPIPE"){t.write=ne,t.end=ne,t.flushSync=ne,t.destroy=ne;return}t.removeListener("error",r),t.emit("error",n);}}function pa(e,t){e.destroyed||(t==="beforeExit"?(e.flush(),e.on("drain",function(){e.end();})):e.flushSync());}function ma(e){return function(r,n,i={},o){if(typeof i=="string")o=Te({dest:i}),i={};else if(typeof o=="string"){if(i&&i.transport)throw Error("only one of option.transport or stream can be specified");o=Te({dest:o});}else if(i instanceof mt||i.writable||i._writableState)o=i,i={};else if(i.transport){if(i.transport instanceof mt||i.transport.writable||i.transport._writableState)throw Error("option.transport do not allow stream, please pass to option directly. e.g. pino(transport)");if(i.transport.targets&&i.transport.targets.length&&i.formatters&&typeof i.formatters.level=="function")throw Error("option.transport.targets do not allow custom level formatters");let c;i.customLevels&&(c=i.useOnlyCustomLevels?i.customLevels:Object.assign({},i.levels,i.customLevels)),o=ua({caller:n,...i.transport,levels:c});}if(i=Object.assign({},e,i),i.serializers=Object.assign({},e.serializers,i.serializers),i.formatters=Object.assign({},e.formatters,i.formatters),i.prettyPrint)throw new Error("prettyPrint option is no longer supported, see the pino-pretty package (https://github.com/pinojs/pino-pretty)");let{enabled:u,onChild:l}=i;return u===false&&(i.level="silent"),l||(i.onChild=ne),o||(ha(process.stdout)?o=process.stdout:o=Te({fd:process.stdout.fd||1})),{opts:i,stream:o}}}function ga(e,t){try{return JSON.stringify(e)}catch{try{return (t||this[gt])(e)}catch{return '"[unable to serialize, circular reference is too complex to analyze]"'}}}function ya(e,t,r){return {level:e,bindings:t,log:r}}function ba(e){let t=Number(e);return typeof e=="string"&&Number.isFinite(t)?t:e===void 0?1:e}yn.exports={noop:ne,buildSafeSonicBoom:Te,asChindings:da,asJson:fa,genLog:ca,createArgsNormalizer:ma,stringify:ga,buildFormatters:ya,normalizeDestFileDescriptor:ba};});var Ie=O((vc,bn)=>{var wa={trace:10,debug:20,info:30,warn:40,error:50,fatal:60},Sa={ASC:"ASC",DESC:"DESC"};bn.exports={DEFAULT_LEVELS:wa,SORTING_ORDER:Sa};});var wt=O((Ec,En)=>{var{lsCacheSym:va,levelValSym:yt,useOnlyCustomLevelsSym:Ea,streamSym:xa,formattersSym:_a,hooksSym:Oa,levelCompSym:wn}=te(),{noop:La,genLog:Y}=ke(),{DEFAULT_LEVELS:K,SORTING_ORDER:Sn}=Ie(),vn={fatal:e=>{let t=Y(K.fatal,e);return function(...r){let n=this[xa];if(t.call(this,...r),typeof n.flushSync=="function")try{n.flushSync();}catch{}}},error:e=>Y(K.error,e),warn:e=>Y(K.warn,e),info:e=>Y(K.info,e),debug:e=>Y(K.debug,e),trace:e=>Y(K.trace,e)},bt=Object.keys(K).reduce((e,t)=>(e[K[t]]=t,e),{}),Aa=Object.keys(bt).reduce((e,t)=>(e[t]='{"level":'+Number(t),e),{});function Ra(e){let t=e[_a].level,{labels:r}=e.levels,n={};for(let i in r){let o=t(r[i],Number(i));n[i]=JSON.stringify(o).slice(0,-1);}return e[va]=n,e}function Ta(e,t){if(t)return  false;switch(e){case "fatal":case "error":case "warn":case "info":case "debug":case "trace":return  true;default:return  false}}function ka(e){let{labels:t,values:r}=this.levels;if(typeof e=="number"){if(t[e]===void 0)throw Error("unknown level value"+e);e=t[e];}if(r[e]===void 0)throw Error("unknown level "+e);let n=this[yt],i=this[yt]=r[e],o=this[Ea],u=this[wn],l=this[Oa].logMethod;for(let c in r){if(u(r[c],i)===false){this[c]=La;continue}this[c]=Ta(c,o)?vn[c](l):Y(r[c],l);}this.emit("level-change",e,i,t[n],n,this);}function Ia(e){let{levels:t,levelVal:r}=this;return t&&t.labels?t.labels[r]:""}function Ca(e){let{values:t}=this.levels,r=t[e];return r!==void 0&&this[wn](r,this[yt])}function $a(e,t,r){return e===Sn.DESC?t<=r:t>=r}function Pa(e){return typeof e=="string"?$a.bind(null,e):e}function Da(e=null,t=false){let r=e?Object.keys(e).reduce((o,u)=>(o[e[u]]=u,o),{}):null,n=Object.assign(Object.create(Object.prototype,{Infinity:{value:"silent"}}),t?null:bt,r),i=Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),t?null:K,e);return {labels:n,values:i}}function ja(e,t,r){if(typeof e=="number"){if(![].concat(Object.keys(t||{}).map(o=>t[o]),r?[]:Object.keys(bt).map(o=>+o),1/0).includes(e))throw Error(`default level:${e} must be included in custom levels`);return}let n=Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),r?null:K,t);if(!(e in n))throw Error(`default level:${e} must be included in custom levels`)}function za(e,t){let{labels:r,values:n}=e;for(let i in t){if(i in n)throw Error("levels cannot be overridden");if(t[i]in r)throw Error("pre-existing level values cannot be used for new levels")}}function Na(e){if(typeof e!="function"&&!(typeof e=="string"&&Object.values(Sn).includes(e)))throw new Error('Levels comparison should be one of "ASC", "DESC" or "function" type')}En.exports={initialLsCache:Aa,genLsCache:Ra,levelMethods:vn,getLevel:Ia,setLevel:ka,isLevelEnabled:Ca,mappings:Da,assertNoLevelCollisions:za,assertDefaultLevelFound:ja,genLevelComparison:Pa,assertLevelComparison:Na};});var St=O((xc,xn)=>{xn.exports={version:"9.9.4"};});var $n=O((Oc,Cn)=>{var{EventEmitter:Ma}=$("events"),{lsCacheSym:qa,levelValSym:Ba,setLevelSym:Et,getLevelSym:_n,chindingsSym:_t,parsedChindingsSym:Fa,mixinSym:Ua,asJsonSym:Rn,writeSym:Va,mixinMergeStrategySym:Wa,timeSym:Ga,timeSliceIndexSym:Ka,streamSym:Tn,serializersSym:Q,formattersSym:vt,errorKeySym:Ha,messageKeySym:Ja,useOnlyCustomLevelsSym:Xa,needsMetadataGsym:Ya,redactFmtSym:Qa,stringifySym:Za,formatOptsSym:el,stringifiersSym:tl,msgPrefixSym:xt,hooksSym:rl}=te(),{getLevel:nl,setLevel:il,isLevelEnabled:sl,mappings:ol,initialLsCache:al,genLsCache:ll,assertNoLevelCollisions:ul}=wt(),{asChindings:kn,asJson:cl,buildFormatters:On,stringify:Ln}=ke(),{version:fl}=St(),dl=et(),hl=class{},In={constructor:hl,child:pl,bindings:ml,setBindings:gl,flush:Sl,isLevelEnabled:sl,version:fl,get level(){return this[_n]()},set level(e){this[Et](e);},get levelVal(){return this[Ba]},set levelVal(e){throw Error("levelVal is read-only")},get msgPrefix(){return this[xt]},[qa]:al,[Va]:bl,[Rn]:cl,[_n]:nl,[Et]:il};Object.setPrototypeOf(In,Ma.prototype);Cn.exports=function(){return Object.create(In)};var An=e=>e;function pl(e,t){if(!e)throw Error("missing bindings for child Pino");t=t||{};let r=this[Q],n=this[vt],i=Object.create(this);if(t.hasOwnProperty("serializers")===true){i[Q]=Object.create(null);for(let p in r)i[Q][p]=r[p];let l=Object.getOwnPropertySymbols(r);for(var o=0;o<l.length;o++){let p=l[o];i[Q][p]=r[p];}for(let p in t.serializers)i[Q][p]=t.serializers[p];let c=Object.getOwnPropertySymbols(t.serializers);for(var u=0;u<c.length;u++){let p=c[u];i[Q][p]=t.serializers[p];}}else i[Q]=r;if(t.hasOwnProperty("formatters")){let{level:l,bindings:c,log:p}=t.formatters;i[vt]=On(l||n.level,c||An,p||n.log);}else i[vt]=On(n.level,An,n.log);if(t.hasOwnProperty("customLevels")===true&&(ul(this.levels,t.customLevels),i.levels=ol(t.customLevels,i[Xa]),ll(i)),typeof t.redact=="object"&&t.redact!==null||Array.isArray(t.redact)){i.redact=t.redact;let l=dl(i.redact,Ln),c={stringify:l[Qa]};i[Za]=Ln,i[tl]=l,i[el]=c;}if(typeof t.msgPrefix=="string"&&(i[xt]=(this[xt]||"")+t.msgPrefix),i[_t]=kn(i,e),t.level!==void 0&&t.level!==this.level||t.hasOwnProperty("customLevels")){let l=t.level||this.level;i[Et](l);}return this.onChild(i),i}function ml(){let t=`{${this[_t].substr(1)}}`,r=JSON.parse(t);return delete r.pid,delete r.hostname,r}function gl(e){let t=kn(this,e);this[_t]=t,delete this[Fa];}function yl(e,t){return Object.assign(t,e)}function bl(e,t,r){let n=this[Ga](),i=this[Ua],o=this[Ha],u=this[Ja],l=this[Wa]||yl,c,p=this[rl].streamWrite;e==null?c={}:e instanceof Error?(c={[o]:e},t===void 0&&(t=e.message)):(c=e,t===void 0&&e[u]===void 0&&e[o]&&(t=e[o].message)),i&&(c=l(c,i(c,r,this)));let h=this[Rn](c,t,r,n),a=this[Tn];a[Ya]===true&&(a.lastLevel=r,a.lastObj=c,a.lastMsg=t,a.lastTime=n.slice(this[Ka]),a.lastLogger=this),a.write(p?p(h):h);}function wl(){}function Sl(e){if(e!=null&&typeof e!="function")throw Error("callback must be a function");let t=this[Tn];typeof t.flush=="function"?t.flush(e||wl):e&&e();}});var zn=O((Rt,jn)=>{var{hasOwnProperty:fe}=Object.prototype,ee=At();ee.configure=At;ee.stringify=ee;ee.default=ee;Rt.stringify=ee;Rt.configure=At;jn.exports=ee;var vl=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]/;function J(e){return e.length<5e3&&!vl.test(e)?`"${e}"`:JSON.stringify(e)}function Ot(e,t){if(e.length>200||t)return e.sort(t);for(let r=1;r<e.length;r++){let n=e[r],i=r;for(;i!==0&&e[i-1]>n;)e[i]=e[i-1],i--;e[i]=n;}return e}var El=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function Lt(e){return El.call(e)!==void 0&&e.length!==0}function Pn(e,t,r){e.length<r&&(r=e.length);let n=t===","?"":" ",i=`"0":${n}${e[0]}`;for(let o=1;o<r;o++)i+=`${t}"${o}":${n}${e[o]}`;return i}function xl(e){if(fe.call(e,"circularValue")){let t=e.circularValue;if(typeof t=="string")return `"${t}"`;if(t==null)return t;if(t===Error||t===TypeError)return {toString(){throw new TypeError("Converting circular structure to JSON")}};throw new TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return '"[Circular]"'}function _l(e){let t;if(fe.call(e,"deterministic")&&(t=e.deterministic,typeof t!="boolean"&&typeof t!="function"))throw new TypeError('The "deterministic" argument must be of type boolean or comparator function');return t===void 0?true:t}function Ol(e,t){let r;if(fe.call(e,t)&&(r=e[t],typeof r!="boolean"))throw new TypeError(`The "${t}" argument must be of type boolean`);return r===void 0?true:r}function Dn(e,t){let r;if(fe.call(e,t)){if(r=e[t],typeof r!="number")throw new TypeError(`The "${t}" argument must be of type number`);if(!Number.isInteger(r))throw new TypeError(`The "${t}" argument must be an integer`);if(r<1)throw new RangeError(`The "${t}" argument must be >= 1`)}return r===void 0?1/0:r}function Z(e){return e===1?"1 item":`${e} items`}function Ll(e){let t=new Set;for(let r of e)(typeof r=="string"||typeof r=="number")&&t.add(String(r));return t}function Al(e){if(fe.call(e,"strict")){let t=e.strict;if(typeof t!="boolean")throw new TypeError('The "strict" argument must be of type boolean');if(t)return r=>{let n=`Object can not safely be stringified. Received type ${typeof r}`;throw typeof r!="function"&&(n+=` (${r.toString()})`),new Error(n)}}}function At(e){e={...e};let t=Al(e);t&&(e.bigint===void 0&&(e.bigint=false),"circularValue"in e||(e.circularValue=Error));let r=xl(e),n=Ol(e,"bigint"),i=_l(e),o=typeof i=="function"?i:void 0,u=Dn(e,"maximumDepth"),l=Dn(e,"maximumBreadth");function c(f,s,g,m,S,b){let w=s[f];switch(typeof w=="object"&&w!==null&&typeof w.toJSON=="function"&&(w=w.toJSON(f)),w=m.call(s,f,w),typeof w){case "string":return J(w);case "object":{if(w===null)return "null";if(g.indexOf(w)!==-1)return r;let v="",_=",",L=b;if(Array.isArray(w)){if(w.length===0)return "[]";if(u<g.length+1)return '"[Array]"';g.push(w),S!==""&&(b+=S,v+=`
${b}`,_=`,
${b}`);let C=Math.min(w.length,l),M=0;for(;M<C-1;M++){let X=c(String(M),w,g,m,S,b);v+=X!==void 0?X:"null",v+=_;}let q=c(String(M),w,g,m,S,b);if(v+=q!==void 0?q:"null",w.length-1>l){let X=w.length-l-1;v+=`${_}"... ${Z(X)} not stringified"`;}return S!==""&&(v+=`
${L}`),g.pop(),`[${v}]`}let A=Object.keys(w),R=A.length;if(R===0)return "{}";if(u<g.length+1)return '"[Object]"';let E="",k="";S!==""&&(b+=S,_=`,
${b}`,E=" ");let j=Math.min(R,l);i&&!Lt(w)&&(A=Ot(A,o)),g.push(w);for(let C=0;C<j;C++){let M=A[C],q=c(M,w,g,m,S,b);q!==void 0&&(v+=`${k}${J(M)}:${E}${q}`,k=_);}if(R>l){let C=R-l;v+=`${k}"...":${E}"${Z(C)} not stringified"`,k=_;}return S!==""&&k.length>1&&(v=`
${b}${v}
${L}`),g.pop(),`{${v}}`}case "number":return isFinite(w)?String(w):t?t(w):"null";case "boolean":return w===true?"true":"false";case "undefined":return;case "bigint":if(n)return String(w);default:return t?t(w):void 0}}function p(f,s,g,m,S,b){switch(typeof s=="object"&&s!==null&&typeof s.toJSON=="function"&&(s=s.toJSON(f)),typeof s){case "string":return J(s);case "object":{if(s===null)return "null";if(g.indexOf(s)!==-1)return r;let w=b,v="",_=",";if(Array.isArray(s)){if(s.length===0)return "[]";if(u<g.length+1)return '"[Array]"';g.push(s),S!==""&&(b+=S,v+=`
${b}`,_=`,
${b}`);let R=Math.min(s.length,l),E=0;for(;E<R-1;E++){let j=p(String(E),s[E],g,m,S,b);v+=j!==void 0?j:"null",v+=_;}let k=p(String(E),s[E],g,m,S,b);if(v+=k!==void 0?k:"null",s.length-1>l){let j=s.length-l-1;v+=`${_}"... ${Z(j)} not stringified"`;}return S!==""&&(v+=`
${w}`),g.pop(),`[${v}]`}g.push(s);let L="";S!==""&&(b+=S,_=`,
${b}`,L=" ");let A="";for(let R of m){let E=p(R,s[R],g,m,S,b);E!==void 0&&(v+=`${A}${J(R)}:${L}${E}`,A=_);}return S!==""&&A.length>1&&(v=`
${b}${v}
${w}`),g.pop(),`{${v}}`}case "number":return isFinite(s)?String(s):t?t(s):"null";case "boolean":return s===true?"true":"false";case "undefined":return;case "bigint":if(n)return String(s);default:return t?t(s):void 0}}function h(f,s,g,m,S){switch(typeof s){case "string":return J(s);case "object":{if(s===null)return "null";if(typeof s.toJSON=="function"){if(s=s.toJSON(f),typeof s!="object")return h(f,s,g,m,S);if(s===null)return "null"}if(g.indexOf(s)!==-1)return r;let b=S;if(Array.isArray(s)){if(s.length===0)return "[]";if(u<g.length+1)return '"[Array]"';g.push(s),S+=m;let E=`
${S}`,k=`,
${S}`,j=Math.min(s.length,l),C=0;for(;C<j-1;C++){let q=h(String(C),s[C],g,m,S);E+=q!==void 0?q:"null",E+=k;}let M=h(String(C),s[C],g,m,S);if(E+=M!==void 0?M:"null",s.length-1>l){let q=s.length-l-1;E+=`${k}"... ${Z(q)} not stringified"`;}return E+=`
${b}`,g.pop(),`[${E}]`}let w=Object.keys(s),v=w.length;if(v===0)return "{}";if(u<g.length+1)return '"[Object]"';S+=m;let _=`,
${S}`,L="",A="",R=Math.min(v,l);Lt(s)&&(L+=Pn(s,_,l),w=w.slice(s.length),R-=s.length,A=_),i&&(w=Ot(w,o)),g.push(s);for(let E=0;E<R;E++){let k=w[E],j=h(k,s[k],g,m,S);j!==void 0&&(L+=`${A}${J(k)}: ${j}`,A=_);}if(v>l){let E=v-l;L+=`${A}"...": "${Z(E)} not stringified"`,A=_;}return A!==""&&(L=`
${S}${L}
${b}`),g.pop(),`{${L}}`}case "number":return isFinite(s)?String(s):t?t(s):"null";case "boolean":return s===true?"true":"false";case "undefined":return;case "bigint":if(n)return String(s);default:return t?t(s):void 0}}function a(f,s,g){switch(typeof s){case "string":return J(s);case "object":{if(s===null)return "null";if(typeof s.toJSON=="function"){if(s=s.toJSON(f),typeof s!="object")return a(f,s,g);if(s===null)return "null"}if(g.indexOf(s)!==-1)return r;let m="",S=s.length!==void 0;if(S&&Array.isArray(s)){if(s.length===0)return "[]";if(u<g.length+1)return '"[Array]"';g.push(s);let L=Math.min(s.length,l),A=0;for(;A<L-1;A++){let E=a(String(A),s[A],g);m+=E!==void 0?E:"null",m+=",";}let R=a(String(A),s[A],g);if(m+=R!==void 0?R:"null",s.length-1>l){let E=s.length-l-1;m+=`,"... ${Z(E)} not stringified"`;}return g.pop(),`[${m}]`}let b=Object.keys(s),w=b.length;if(w===0)return "{}";if(u<g.length+1)return '"[Object]"';let v="",_=Math.min(w,l);S&&Lt(s)&&(m+=Pn(s,",",l),b=b.slice(s.length),_-=s.length,v=","),i&&(b=Ot(b,o)),g.push(s);for(let L=0;L<_;L++){let A=b[L],R=a(A,s[A],g);R!==void 0&&(m+=`${v}${J(A)}:${R}`,v=",");}if(w>l){let L=w-l;m+=`${v}"...":"${Z(L)} not stringified"`;}return g.pop(),`{${m}}`}case "number":return isFinite(s)?String(s):t?t(s):"null";case "boolean":return s===true?"true":"false";case "undefined":return;case "bigint":if(n)return String(s);default:return t?t(s):void 0}}function y(f,s,g){if(arguments.length>1){let m="";if(typeof g=="number"?m=" ".repeat(Math.min(g,10)):typeof g=="string"&&(m=g.slice(0,10)),s!=null){if(typeof s=="function")return c("",{"":f},[],s,m,"");if(Array.isArray(s))return p("",f,[],Ll(s),m,"")}if(m.length!==0)return h("",f,[],m,"")}return a("",f,[])}return y}});var Bn=O((Lc,qn)=>{var Tt=Symbol.for("pino.metadata"),{DEFAULT_LEVELS:Mn}=Ie(),Rl=Mn.info;function Tl(e,t){e=e||[],t=t||{dedupe:false};let r=Object.create(Mn);r.silent=1/0,t.levels&&typeof t.levels=="object"&&Object.keys(t.levels).forEach(a=>{r[a]=t.levels[a];});let n={write:i,add:l,remove:c,emit:o,flushSync:u,end:p,minLevel:0,lastId:0,streams:[],clone:h,[Tt]:true,streamLevels:r};return Array.isArray(e)?e.forEach(l,n):l.call(n,e),e=null,n;function i(a){let y,f=this.lastLevel,{streams:s}=this,g=0,m;for(let S=kl(s.length,t.dedupe);Cl(S,s.length,t.dedupe);S=Il(S,t.dedupe))if(y=s[S],y.level<=f){if(g!==0&&g!==y.level)break;if(m=y.stream,m[Tt]){let{lastTime:b,lastMsg:w,lastObj:v,lastLogger:_}=this;m.lastLevel=f,m.lastTime=b,m.lastMsg=w,m.lastObj=v,m.lastLogger=_;}m.write(a),t.dedupe&&(g=y.level);}else if(!t.dedupe)break}function o(...a){for(let{stream:y}of this.streams)typeof y.emit=="function"&&y.emit(...a);}function u(){for(let{stream:a}of this.streams)typeof a.flushSync=="function"&&a.flushSync();}function l(a){if(!a)return n;let y=typeof a.write=="function"||a.stream,f=a.write?a:a.stream;if(!y)throw Error("stream object needs to implement either StreamEntry or DestinationStream interface");let{streams:s,streamLevels:g}=this,m;typeof a.levelVal=="number"?m=a.levelVal:typeof a.level=="string"?m=g[a.level]:typeof a.level=="number"?m=a.level:m=Rl;let S={stream:f,level:m,levelVal:void 0,id:++n.lastId};return s.unshift(S),s.sort(Nn),this.minLevel=s[0].level,n}function c(a){let{streams:y}=this,f=y.findIndex(s=>s.id===a);return f>=0&&(y.splice(f,1),y.sort(Nn),this.minLevel=y.length>0?y[0].level:-1),n}function p(){for(let{stream:a}of this.streams)typeof a.flushSync=="function"&&a.flushSync(),a.end();}function h(a){let y=new Array(this.streams.length);for(let f=0;f<y.length;f++)y[f]={level:a,stream:this.streams[f].stream};return {write:i,add:l,remove:c,minLevel:a,streams:y,clone:h,emit:o,flushSync:u,[Tt]:true}}}function Nn(e,t){return e.level-t.level}function kl(e,t){return t?e-1:0}function Il(e,t){return t?e-1:e+1}function Cl(e,t,r){return r?e>=0:e<t}qn.exports=Tl;});var $t=O((Ac,B)=>{var $l=$("os"),Jn=Ge(),Pl=Ke(),Dl=et(),Xn=$r(),jl=$n(),Yn=te(),{configure:zl}=zn(),{assertDefaultLevelFound:Nl,mappings:Qn,genLsCache:Ml,genLevelComparison:ql,assertLevelComparison:Bl}=wt(),{DEFAULT_LEVELS:Zn,SORTING_ORDER:Fl}=Ie(),{createArgsNormalizer:Ul,asChindings:Vl,buildSafeSonicBoom:Fn,buildFormatters:Wl,stringify:kt,normalizeDestFileDescriptor:Un,noop:Gl}=ke(),{version:Kl}=St(),{chindingsSym:Vn,redactFmtSym:Hl,serializersSym:Wn,timeSym:Jl,timeSliceIndexSym:Xl,streamSym:Yl,stringifySym:Gn,stringifySafeSym:It,stringifiersSym:Kn,setLevelSym:Ql,endSym:Zl,formatOptsSym:eu,messageKeySym:tu,errorKeySym:ru,nestedKeySym:nu,mixinSym:iu,levelCompSym:su,useOnlyCustomLevelsSym:ou,formattersSym:Hn,hooksSym:au,nestedKeyStrSym:lu,mixinMergeStrategySym:uu,msgPrefixSym:cu}=Yn,{epochTime:ei,nullTime:fu}=Xn,{pid:du}=process,hu=$l.hostname(),pu=Jn.err,mu={level:"info",levelComparison:Fl.ASC,levels:Zn,messageKey:"msg",errorKey:"err",nestedKey:null,enabled:true,base:{pid:du,hostname:hu},serializers:Object.assign(Object.create(null),{err:pu}),formatters:Object.assign(Object.create(null),{bindings(e){return e},level(e,t){return {level:t}}}),hooks:{logMethod:void 0,streamWrite:void 0},timestamp:ei,name:void 0,redact:null,customLevels:null,useOnlyCustomLevels:false,depthLimit:5,edgeLimit:100},gu=Ul(mu),yu=Object.assign(Object.create(null),Jn);function Ct(...e){let t={},{opts:r,stream:n}=gu(t,Pl(),...e);r.level&&typeof r.level=="string"&&Zn[r.level.toLowerCase()]!==void 0&&(r.level=r.level.toLowerCase());let{redact:i,crlf:o,serializers:u,timestamp:l,messageKey:c,errorKey:p,nestedKey:h,base:a,name:y,level:f,customLevels:s,levelComparison:g,mixin:m,mixinMergeStrategy:S,useOnlyCustomLevels:b,formatters:w,hooks:v,depthLimit:_,edgeLimit:L,onChild:A,msgPrefix:R}=r,E=zl({maximumDepth:_,maximumBreadth:L}),k=Wl(w.level,w.bindings,w.log),j=kt.bind({[It]:E}),C=i?Dl(i,j):{},M=i?{stringify:C[Hl]}:{stringify:j},q="}"+(o?`\r
`:`
`),X=Vl.bind(null,{[Vn]:"",[Wn]:u,[Kn]:C,[Gn]:kt,[It]:E,[Hn]:k}),Ce="";a!==null&&(y===void 0?Ce=X(a):Ce=X(Object.assign({},a,{name:y})));let qt=l instanceof Function?l:l?ei:fu,pi=qt().indexOf(":")+1;if(b&&!s)throw Error("customLevels is required if useOnlyCustomLevels is set true");if(m&&typeof m!="function")throw Error(`Unknown mixin type "${typeof m}" - expected "function"`);if(R&&typeof R!="string")throw Error(`Unknown msgPrefix type "${typeof R}" - expected "string"`);Nl(f,s,b);let Bt=Qn(s,b);typeof n.emit=="function"&&n.emit("message",{code:"PINO_CONFIG",config:{levels:Bt,messageKey:c,errorKey:p}}),Bl(g);let mi=ql(g);return Object.assign(t,{levels:Bt,[su]:mi,[ou]:b,[Yl]:n,[Jl]:qt,[Xl]:pi,[Gn]:kt,[It]:E,[Kn]:C,[Zl]:q,[eu]:M,[tu]:c,[ru]:p,[nu]:h,[lu]:h?`,${JSON.stringify(h)}:{`:"",[Wn]:u,[iu]:m,[uu]:S,[Vn]:Ce,[Hn]:k,[au]:v,silent:Gl,onChild:A,[cu]:R}),Object.setPrototypeOf(t,jl()),Ml(t),t[Ql](f),t}B.exports=Ct;B.exports.destination=(e=process.stdout.fd)=>typeof e=="object"?(e.dest=Un(e.dest||process.stdout.fd),Fn(e)):Fn({dest:Un(e),minLength:0});B.exports.transport=ht();B.exports.multistream=Bn();B.exports.levels=Qn();B.exports.stdSerializers=yu;B.exports.stdTimeFunctions=Object.assign({},Xn);B.exports.symbols=Yn;B.exports.version=Kl;B.exports.default=Ct;B.exports.pino=Ct;});var _u=zod.z.object({id:zod.z.string(),name:zod.z.string(),brand:zod.z.string().optional(),category:zod.z.string(),nutrition:zod.z.object({calories:zod.z.number(),protein:zod.z.number(),carbs:zod.z.number(),fat:zod.z.number(),fiber:zod.z.number().optional(),sugar:zod.z.number().optional(),sodium:zod.z.number().optional()}),perUnit:zod.z.object({amount:zod.z.number(),unit:zod.z.enum(["g","ml","piece","cup","tbsp","tsp"])}),createdAt:zod.z.date(),updatedAt:zod.z.date()}),Ou=zod.z.object({id:zod.z.string(),userId:zod.z.string(),productId:zod.z.string(),amount:zod.z.number(),unit:zod.z.string(),date:zod.z.date(),meal:zod.z.enum(["breakfast","lunch","dinner","snack"]),createdAt:zod.z.date()}),Lu=(e,t)=>{let r=t/e.perUnit.amount;return {calories:Math.round(e.nutrition.calories*r*10)/10,protein:Math.round(e.nutrition.protein*r*10)/10,carbs:Math.round(e.nutrition.carbs*r*10)/10,fat:Math.round(e.nutrition.fat*r*10)/10,fiber:e.nutrition.fiber?Math.round(e.nutrition.fiber*r*10)/10:void 0,sugar:e.nutrition.sugar?Math.round(e.nutrition.sugar*r*10)/10:void 0,sodium:e.nutrition.sodium?Math.round(e.nutrition.sodium*r*10)/10:void 0}};var Tu=zod.z.object({id:zod.z.string(),name:zod.z.string(),category:zod.z.enum(["strength","cardio","flexibility","balance","sport"]),muscleGroups:zod.z.array(zod.z.string()),equipment:zod.z.string().optional(),instructions:zod.z.string().optional(),difficulty:zod.z.enum(["beginner","intermediate","advanced"])}),Ei=zod.z.object({exerciseId:zod.z.string(),reps:zod.z.number().optional(),weight:zod.z.number().optional(),duration:zod.z.number().optional(),distance:zod.z.number().optional(),rest:zod.z.number().optional()}),ku=zod.z.object({id:zod.z.string(),userId:zod.z.string(),name:zod.z.string(),date:zod.z.date(),sets:zod.z.array(Ei),notes:zod.z.string().optional(),duration:zod.z.number(),createdAt:zod.z.date()}),Iu=zod.z.object({id:zod.z.string(),name:zod.z.string(),description:zod.z.string(),duration:zod.z.number(),sessions:zod.z.array(zod.z.object({name:zod.z.string(),exercises:zod.z.array(zod.z.object({exerciseId:zod.z.string(),sets:zod.z.number(),reps:zod.z.string(),weight:zod.z.string().optional()}))})),level:zod.z.enum(["beginner","intermediate","advanced"]),createdAt:zod.z.date()});var xi=zod.z.object({id:zod.z.string(),email:zod.z.string().email(),name:zod.z.string(),profile:zod.z.object({age:zod.z.number().optional(),gender:zod.z.enum(["male","female","other"]).optional(),weight:zod.z.number().optional(),height:zod.z.number().optional(),activityLevel:zod.z.enum(["sedentary","light","moderate","active","very-active"]).optional()}).optional(),preferences:zod.z.object({units:zod.z.enum(["metric","imperial"]).default("metric"),language:zod.z.enum(["en","ru"]).default("en"),theme:zod.z.enum(["light","dark","auto"]).default("auto")}).default({}),createdAt:zod.z.date(),updatedAt:zod.z.date()}),Pu=xi.partial().omit({id:true,createdAt:true,updatedAt:true}),Du=e=>{let t=new Date;return {id:crypto.randomUUID(),email:e.email,name:e.name,profile:e.profile,preferences:e.preferences||{units:"metric",language:"en",theme:"auto"},createdAt:t,updatedAt:t}};var de=class{async createUser(t){return {id:this.generateId(),...t}}async updateUser(t,r){return {id:t,...r}}async searchUsers(t){return []}generateId(){return Math.random().toString(36).substr(2,9)}},he=class{async createDay(t){return {id:this.generateId(),...t}}async updateDay(t,r){return {id:t,...r}}async getDayContent(t){return {id:t,content:"sample content"}}generateId(){return Math.random().toString(36).substr(2,9)}},pe=class{async createSession(t){return {id:this.generateId(),token:this.generateToken(),...t}}async validateSessionToken(t){return !!(t&&t.length>10)}generateId(){return Math.random().toString(36).substr(2,9)}generateToken(){return Math.random().toString(36).substr(2,32)}};var $e=class extends de{async createUser(t){let r=await shared.defaultValidator.validateSchema(t,shared.ValidationSchemas.user,{sanitize:true,strictMode:false});if(!r.isValid)throw new shared.SecurityError("User validation failed",r.errors);return await super.createUser(r.sanitized||t)}async updateUser(t,r){let n=await shared.defaultValidator.validateSchema(t,shared.ValidationSchemas.user.shape.id);if(!n.isValid)throw new shared.SecurityError("Invalid user ID",n.errors);let i=await shared.defaultValidator.validateSchema(r,shared.ValidationSchemas.user.partial(),{sanitize:true,strictMode:false});if(!i.isValid)throw new shared.SecurityError("Update data validation failed",i.errors);return await super.updateUser(t,i.sanitized||r)}async searchUsers(t){let r=shared.defaultValidator.validateInput(t,"text",{sanitize:true,required:true});if(!r.isValid)throw new shared.SecurityError("Search query validation failed",r.errors);return await super.searchUsers(r.sanitized||t)}},Pe=class extends he{async createDay(t){let r=shared.ValidationSchemas.content.extend({date:shared.ValidationSchemas.user.shape.createdAt,userId:shared.ValidationSchemas.user.shape.id}),n=await shared.defaultValidator.validateSchema(t,r,{sanitize:true,strictMode:false});if(!n.isValid)throw new shared.SecurityError("Day data validation failed",n.errors);return await super.createDay(n.sanitized||t)}async updateDay(t,r){let n=await shared.defaultValidator.validateSchema(r,shared.ValidationSchemas.content.partial(),{sanitize:true,strictMode:false});if(!n.isValid)throw new shared.SecurityError("Day update validation failed",n.errors);return await super.updateDay(t,n.sanitized||r)}async getDayContent(t){let r=await super.getDayContent(t);return r&&typeof r=="object"&&(await shared.defaultValidator.validateSchema(r,shared.ValidationSchemas.content,{sanitize:true})).sanitized||r}},De=class extends pe{async createSession(t){let r=shared.ValidationSchemas.user.pick({id:true,email:true}).extend({token:shared.ValidationSchemas.apiRequest.shape.headers,expiresAt:shared.ValidationSchemas.user.shape.createdAt}),n=await shared.defaultValidator.validateSchema(t,r,{sanitize:true,strictMode:false});if(!n.isValid)throw new shared.SecurityError("Session validation failed",n.errors);return await super.createSession(n.sanitized||t)}async validateSessionToken(t){let r=shared.defaultValidator.validateInput(t,"text",{required:true,sanitize:true});return r.isValid?super.validateSessionToken(r.sanitized||t):false}},je=class{users;days;sessions;constructor(){this.users=new $e,this.days=new Pe,this.sessions=new De;}async initialize(t={}){let r=await shared.defaultValidator.validateSchema(t,shared.ValidationSchemas.apiRequest.shape.body||{},{sanitize:true});if(!r.isValid)throw new shared.SecurityError("Configuration validation failed",r.errors);await Promise.all([]);}async handleApiRequest(t){let r=await shared.defaultValidator.validateSchema(t,shared.ValidationSchemas.apiRequest,{sanitize:true,strictMode:false});if(!r.isValid)throw new shared.SecurityError("API request validation failed",r.errors);let n=r.sanitized;switch(n.method){case "GET":return this.handleGetRequest(n);case "POST":return this.handlePostRequest(n);case "PUT":return this.handlePutRequest(n);case "DELETE":return this.handleDeleteRequest(n);default:throw new shared.SecurityError("Unsupported HTTP method",[])}}async handleGetRequest(t){if(t.path.startsWith("/users")){let r=typeof t.query?.q=="string"?t.query.q:"";return this.users.searchUsers(r)}if(t.path.startsWith("/days")){let r=typeof t.query?.id=="string"?t.query.id:"";return this.days.getDayContent(r)}throw new shared.SecurityError("Unknown GET endpoint",[])}async handlePostRequest(t){if(t.path==="/users")return this.users.createUser(t.body);if(t.path==="/days")return this.days.createDay(t.body);if(t.path==="/sessions")return this.sessions.createSession(t.body);throw new shared.SecurityError("Unknown POST endpoint",[])}async handlePutRequest(t){let r=t.path.split("/");if(r[1]==="users"&&r[2])return this.users.updateUser(r[2],t.body);if(r[1]==="days"&&r[2])return this.days.updateDay(r[2],t.body);throw new shared.SecurityError("Unknown PUT endpoint",[])}async handleDeleteRequest(t){let r=t.headers?.authorization;throw typeof r!="string"||r.length===0?new shared.SecurityError("Authorization required for DELETE operations",[]):new shared.SecurityError("DELETE operations not implemented",[])}},Vu=new je;var ae=Ut($t());var ie={fatal:{value:60,name:"fatal",color:"magenta",symbol:"\u{1F480}",description:"\u041A\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043A\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430, \u043F\u0440\u0438\u0432\u043E\u0434\u044F\u0449\u0430\u044F \u043A \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u044E \u043F\u0440\u0438\u043B\u043E\u0436\u0435\u043D\u0438\u044F"},error:{value:50,name:"error",color:"red",symbol:"\u274C",description:"\u041E\u0448\u0438\u0431\u043A\u0430, \u0442\u0440\u0435\u0431\u0443\u044E\u0449\u0430\u044F \u043D\u0435\u043C\u0435\u0434\u043B\u0435\u043D\u043D\u043E\u0433\u043E \u0432\u043D\u0438\u043C\u0430\u043D\u0438\u044F"},warn:{value:40,name:"warn",color:"yellow",symbol:"\u26A0\uFE0F",description:"\u041F\u0440\u0435\u0434\u0443\u043F\u0440\u0435\u0436\u0434\u0435\u043D\u0438\u0435 \u043E \u043F\u043E\u0442\u0435\u043D\u0446\u0438\u0430\u043B\u044C\u043D\u043E\u0439 \u043F\u0440\u043E\u0431\u043B\u0435\u043C\u0435"},info:{value:30,name:"info",color:"green",symbol:"\u2139\uFE0F",description:"\u041E\u0431\u0449\u0430\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u043E \u0440\u0430\u0431\u043E\u0442\u0435 \u043F\u0440\u0438\u043B\u043E\u0436\u0435\u043D\u0438\u044F"},http:{value:29,name:"http",color:"cyan",symbol:"\u{1F310}",description:"HTTP \u0437\u0430\u043F\u0440\u043E\u0441\u044B \u0438 \u043E\u0442\u0432\u0435\u0442\u044B"},debug:{value:20,name:"debug",color:"blue",symbol:"\u{1F50D}",description:"\u041E\u0442\u043B\u0430\u0434\u043E\u0447\u043D\u0430\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F \u0434\u043B\u044F \u0440\u0430\u0437\u0440\u0430\u0431\u043E\u0442\u043A\u0438"},trace:{value:10,name:"trace",color:"gray",symbol:"\u{1F52C}",description:"\u0414\u0435\u0442\u0430\u043B\u044C\u043D\u0430\u044F \u0442\u0440\u0430\u0441\u0441\u0438\u0440\u043E\u0432\u043A\u0430 \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F"},silent:{value:1/0,name:"silent",color:"white",symbol:"\u{1F507}",description:"\u041E\u0442\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435 \u0432\u0441\u0435\u0445 \u043B\u043E\u0433\u043E\u0432"}},ri={err:"error",warning:"warn",information:"info",verbose:"debug",silly:"trace",off:"silent"},ni=Object.fromEntries(Object.entries(ie).map(([e,t])=>[e,t.color])),jt=Object.fromEntries(Object.entries(ie).map(([e,t])=>[e,t.value])),ii=Object.keys(ie),Pt={development:{defaultLevel:"debug",console:{enabled:true,level:"debug",colorize:true,timestamp:true,prettyPrint:true},file:{enabled:true,level:"info",rotation:false},performance:{logSlowOperations:true,threshold:100}},test:{defaultLevel:"error",console:{enabled:false,level:"silent"},file:{enabled:true,level:"error",path:"./logs/test"},performance:{logSlowOperations:false}},staging:{defaultLevel:"info",console:{enabled:true,level:"warn",colorize:false,format:"json"},file:{enabled:true,level:"info",rotation:true,maxSize:"50m",maxFiles:"7d"},performance:{logSlowOperations:true,threshold:500}},production:{defaultLevel:"warn",console:{enabled:true,level:"error",colorize:false,format:"json"},file:{enabled:true,level:"info",rotation:true,maxSize:"100m",maxFiles:"30d",compress:true},performance:{logSlowOperations:true,threshold:1e3},security:{sanitizeHeaders:true,maskPasswords:true,auditLevel:"warn"}}},Dt={fatal:(e,t)=>`\u{1F480} FATAL: ${e} ${JSON.stringify(t)}`,error:(e,t)=>`\u274C ERROR: ${e} ${t?JSON.stringify(t):""}`,warn:(e,t)=>`\u26A0\uFE0F  WARN: ${e} ${t?JSON.stringify(t):""}`,info:(e,t)=>`\u2139\uFE0F  INFO: ${e}`,http:(e,t)=>`\u{1F310} HTTP: ${e}`,debug:(e,t)=>`\u{1F50D} DEBUG: ${e} ${t?JSON.stringify(t):""}`,trace:(e,t)=>`\u{1F52C} TRACE: ${e} ${t?JSON.stringify(t):""}`},bu={isError:e=>["fatal","error"].includes(e),isWarning:e=>e==="warn",isInfo:e=>["info","http"].includes(e),isDebug:e=>["debug","trace"].includes(e),isCritical:e=>["fatal","error","warn"].includes(e),isProduction:e=>["fatal","error","warn","info"].includes(e)},wu={fatal:{maxSize:"10m",maxFiles:"90d",compress:true},error:{maxSize:"50m",maxFiles:"30d",compress:true},warn:{maxSize:"100m",maxFiles:"14d",compress:true},info:{maxSize:"200m",maxFiles:"7d",compress:false},http:{maxSize:"500m",maxFiles:"3d",compress:false},debug:{maxSize:"100m",maxFiles:"1d",compress:false},trace:{maxSize:"50m",maxFiles:"6h",compress:false}},ti={level:"info",levels:jt,colors:ni,environment:process.env.NODE_ENV||"development",getEnvironmentConfig(){return Pt[this.environment]||Pt.development},isLevelEnabled(e,t=this.level){let r=ie[e]?.value||0,n=ie[t]?.value||30;return r>=n},getFormatter(e){return Dt[e]||Dt.info},normalizeLevel(e){let t=e.toLowerCase();return ri[t]||t}};typeof module<"u"&&module.exports&&(module.exports={LOG_LEVELS:ie,LEVEL_ALIASES:ri,LEVEL_COLORS:ni,LEVEL_VALUES:jt,LEVEL_METHODS:ii,ENVIRONMENT_CONFIGS:Pt,LEVEL_FORMATTERS:Dt,LEVEL_PREDICATES:bu,ROTATION_CONFIG:wu,DEFAULT_CONFIG:ti,default:ti});var si={level:process.env.LOG_LEVEL||"info",service:process.env.SERVICE_NAME||"heys-app",environment:process.env.NODE_ENV||"development",transports:{console:{enabled:process.env.LOG_CONSOLE!=="false",pretty:process.env.NODE_ENV!=="production",colorize:process.env.NODE_ENV!=="production"},file:{enabled:process.env.LOG_FILE==="true"||process.env.NODE_ENV==="production",path:process.env.LOG_PATH||"./logs",maxSize:process.env.LOG_MAX_SIZE||"10MB",maxFiles:parseInt(process.env.LOG_MAX_FILES||"5"),compress:process.env.LOG_COMPRESS==="true"},network:{enabled:process.env.LOG_NETWORK==="true",url:process.env.LOG_NETWORK_URL?process.env.LOG_NETWORK_URL:void 0,apiKey:process.env.LOG_API_KEY?process.env.LOG_API_KEY:void 0}},redact:["password","token","secret","authorization","cookie","session","apiKey","accessToken","refreshToken"],sampling:{enabled:process.env.LOG_SAMPLING==="true",rate:parseFloat(process.env.LOG_SAMPLING_RATE||"0.1")},performance:{enabled:process.env.LOG_PERFORMANCE==="true",threshold:parseInt(process.env.LOG_PERFORMANCE_THRESHOLD||"1000")}};function oi(e){let t={...si,...e};return Object.values(zt).includes(t.level)||(t.level="info"),t.transports.file.enabled&&!t.transports.file.path&&(t.transports.file.path="./logs"),t.transports.network.enabled&&!t.transports.network.url&&(t.transports.network.enabled=false),t}var se=Ut($t());var Nt=e=>e==="silent"?null:e==="http"?"info":e;function ui(e){let t=[];if(e.transports.console.enabled){let r=Nt(e.level);r!==null&&(e.transports.console.pretty?t.push({level:r,stream:se.default.transport({target:"pino-pretty",options:{colorize:e.transports.console.colorize,ignore:"pid,hostname",translateTime:"SYS:yyyy-mm-dd HH:MM:ss.l",messageFormat:`[${e.service}] {msg}`,sync:false}})}):t.push({level:r,stream:process.stdout}));}if(e.transports.file.enabled){Su(e.transports.file.path);let r=Nt(e.level);r!==null&&t.push({level:r,stream:se.default.destination({dest:li__default.default.join(e.transports.file.path,`${e.service}.log`),sync:false,mkdir:true})}),t.push({level:"error",stream:se.default.destination({dest:li__default.default.join(e.transports.file.path,`${e.service}.error.log`),sync:false,mkdir:true})});}if(e.transports.network.enabled&&e.transports.network.url){let r=Nt(e.level);r!==null&&t.push({level:r,stream:se.default.transport({target:"@axiomhq/pino",options:{url:e.transports.network.url,apiKey:e.transports.network.apiKey,dataset:e.service}})});}return t}function Su(e){try{ai__default.default.existsSync(e)||ai__default.default.mkdirSync(e,{recursive:!0});}catch{}}function ci(e){return {level:t=>({level:t}),bindings:t=>({service:e.service,environment:e.environment,version:process.env.npm_package_version||"1.0.0",...t}),log:t=>({...t,"@timestamp":new Date().toISOString(),"@version":"1"})}}function fi(){return {...se.default.stdSerializers}}var zt=(c=>(c.TRACE="trace",c.DEBUG="debug",c.INFO="info",c.HTTP="http",c.WARN="warn",c.ERROR="error",c.FATAL="fatal",c.SILENT="silent",c))(zt||{});function vu(e={}){let t=oi(e),r=ui(t),n=ci(t),i=fi(),o={level:t.level,base:{service:t.service,environment:t.environment,version:process.env.npm_package_version||"1.0.0"},timestamp:ae.default.stdTimeFunctions.isoTime,formatters:n,serializers:i,redact:{paths:t.redact,censor:"[REDACTED]"}};return r.length>1?(0, ae.default)(o,ae.default.multistream(r)):r.length===1&&r[0]?(0, ae.default)(o,r[0].stream):(0, ae.default)(o)}var oe=vu({service:"heys-system",level:process.env.LOG_LEVEL||"info"});var Mt={trace:(e,t)=>oe.trace(t,e),debug:(e,t)=>oe.debug(t,e),info:(e,t)=>oe.info(t,e),warn:(e,t)=>oe.warn(t,e),error:(e,t)=>oe.error(t,e),fatal:(e,t)=>oe.fatal(t,e)};var di=class{providers=[];eventQueue=[];userId;sessionId;constructor(){this.sessionId=this.generateSessionId();}addProvider(t){this.providers.push(t);}async track(t,r){let n={name:t,timestamp:Date.now(),sessionId:this.sessionId};r&&(n.properties=r),this.userId&&(n.userId=this.userId),this.eventQueue.push(n);let i=this.providers.map(o=>o.track(n).catch(u=>{Mt.error("Analytics provider error",{error:u,provider:o.constructor.name});}));await Promise.allSettled(i);}async identify(t,r){this.userId=t;let n=this.providers.map(i=>i.identify(t,r).catch(o=>{Mt.error("Analytics identify error",{error:o,provider:i.constructor.name});}));await Promise.allSettled(n);}getEventQueue(){return [...this.eventQueue]}clearEventQueue(){this.eventQueue=[];}generateSessionId(){return `session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}};var hi=class{static DEFAULT_MULTIPLIERS={proteins:4,carbs:4,fats:9};static calculateCalories(t,r={}){let{proteinMultiplier:n=this.DEFAULT_MULTIPLIERS.proteins,carbMultiplier:i=this.DEFAULT_MULTIPLIERS.carbs,fatMultiplier:o=this.DEFAULT_MULTIPLIERS.fats}=r;return t.proteins*n+t.carbs*i+t.fats*o}static calculateMacroRatio(t){let r=this.calculateCalories(t);return r===0?{proteinsPercent:0,carbsPercent:0,fatsPercent:0}:{proteinsPercent:Math.round(t.proteins*4/r*100),carbsPercent:Math.round(t.carbs*4/r*100),fatsPercent:Math.round(t.fats*9/r*100)}}static validateNutritionData(t){return typeof t.proteins=="number"&&t.proteins>=0&&typeof t.carbs=="number"&&t.carbs>=0&&typeof t.fats=="number"&&t.fats>=0&&(t.weight===void 0||typeof t.weight=="number"&&t.weight>0)}};var Bc={save:()=>Promise.resolve(),load:()=>Promise.resolve(null)};

exports.AnalyticsService = di;
exports.ExerciseSchema = Tu;
exports.FoodEntrySchema = Ou;
exports.FoodProductSchema = _u;
exports.NutritionService = hi;
exports.SecureDayManager = Pe;
exports.SecureHeysCore = je;
exports.SecureSessionManager = De;
exports.SecureUserManager = $e;
exports.StorageService = Bc;
exports.TrainingProgramSchema = Iu;
exports.UserDraftSchema = Pu;
exports.UserSchema = xi;
exports.WorkoutSessionSchema = ku;
exports.WorkoutSetSchema = Ei;
exports.calculateNutrition = Lu;
exports.createUser = Du;
exports.secureCore = Vu;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map