'use strict';

var zod = require('zod');
var shared = require('@heys/shared');

var I=zod.z.object({id:zod.z.string(),name:zod.z.string(),brand:zod.z.string().optional(),category:zod.z.string(),nutrition:zod.z.object({calories:zod.z.number(),protein:zod.z.number(),carbs:zod.z.number(),fat:zod.z.number(),fiber:zod.z.number().optional(),sugar:zod.z.number().optional(),sodium:zod.z.number().optional()}),perUnit:zod.z.object({amount:zod.z.number(),unit:zod.z.enum(["g","ml","piece","cup","tbsp","tsp"])}),createdAt:zod.z.date(),updatedAt:zod.z.date()}),z=zod.z.object({id:zod.z.string(),userId:zod.z.string(),productId:zod.z.string(),amount:zod.z.number(),unit:zod.z.string(),date:zod.z.date(),meal:zod.z.enum(["breakfast","lunch","dinner","snack"]),createdAt:zod.z.date()}),E=(a,e)=>{let t=e/a.perUnit.amount;return {calories:Math.round(a.nutrition.calories*t*10)/10,protein:Math.round(a.nutrition.protein*t*10)/10,carbs:Math.round(a.nutrition.carbs*t*10)/10,fat:Math.round(a.nutrition.fat*t*10)/10,fiber:a.nutrition.fiber?Math.round(a.nutrition.fiber*t*10)/10:void 0,sugar:a.nutrition.sugar?Math.round(a.nutrition.sugar*t*10)/10:void 0,sodium:a.nutrition.sodium?Math.round(a.nutrition.sodium*t*10)/10:void 0}};var k=zod.z.object({id:zod.z.string(),name:zod.z.string(),category:zod.z.enum(["strength","cardio","flexibility","balance","sport"]),muscleGroups:zod.z.array(zod.z.string()),equipment:zod.z.string().optional(),instructions:zod.z.string().optional(),difficulty:zod.z.enum(["beginner","intermediate","advanced"])}),P=zod.z.object({exerciseId:zod.z.string(),reps:zod.z.number().optional(),weight:zod.z.number().optional(),duration:zod.z.number().optional(),distance:zod.z.number().optional(),rest:zod.z.number().optional()}),A=zod.z.object({id:zod.z.string(),userId:zod.z.string(),name:zod.z.string(),date:zod.z.date(),sets:zod.z.array(P),notes:zod.z.string().optional(),duration:zod.z.number(),createdAt:zod.z.date()}),T=zod.z.object({id:zod.z.string(),name:zod.z.string(),description:zod.z.string(),duration:zod.z.number(),sessions:zod.z.array(zod.z.object({name:zod.z.string(),exercises:zod.z.array(zod.z.object({exerciseId:zod.z.string(),sets:zod.z.number(),reps:zod.z.string(),weight:zod.z.string().optional()}))})),level:zod.z.enum(["beginner","intermediate","advanced"]),createdAt:zod.z.date()});var S=zod.z.object({id:zod.z.string(),email:zod.z.string().email(),name:zod.z.string(),profile:zod.z.object({age:zod.z.number().optional(),gender:zod.z.enum(["male","female","other"]).optional(),weight:zod.z.number().optional(),height:zod.z.number().optional(),activityLevel:zod.z.enum(["sedentary","light","moderate","active","very-active"]).optional()}).optional(),preferences:zod.z.object({units:zod.z.enum(["metric","imperial"]).default("metric"),language:zod.z.enum(["en","ru"]).default("en"),theme:zod.z.enum(["light","dark","auto"]).default("auto")}).default({}),createdAt:zod.z.date(),updatedAt:zod.z.date()}),V=S.partial().omit({id:true,createdAt:true,updatedAt:true}),j=a=>{let e=new Date;return {id:crypto.randomUUID(),email:a.email,name:a.name,profile:a.profile,preferences:a.preferences||{units:"metric",language:"en",theme:"auto"},createdAt:e,updatedAt:e}};var l=class{async createUser(e){return {id:this.generateId(),...e}}async updateUser(e,t){return {id:e,...t}}async searchUsers(e){return []}generateId(){return Math.random().toString(36).substr(2,9)}},m=class{async createDay(e){return {id:this.generateId(),...e}}async updateDay(e,t){return {id:e,...t}}async getDayContent(e){return {id:e,content:"sample content"}}generateId(){return Math.random().toString(36).substr(2,9)}},h=class{async createSession(e){return {id:this.generateId(),token:this.generateToken(),...e}}async validateSessionToken(e){return !!(e&&e.length>10)}generateId(){return Math.random().toString(36).substr(2,9)}generateToken(){return Math.random().toString(36).substr(2,32)}};var y=class extends l{async createUser(e){let t=await shared.defaultValidator.validateSchema(e,shared.ValidationSchemas.user,{sanitize:true,strictMode:true});if(!t.isValid)throw new shared.SecurityError("User validation failed",t.errors);return super.createUser(t.sanitized||e)}async updateUser(e,t){let n=await shared.defaultValidator.validateSchema(e,shared.ValidationSchemas.user.shape.id);if(!n.isValid)throw new shared.SecurityError("Invalid user ID",n.errors);let c=await shared.defaultValidator.validateSchema(t,shared.ValidationSchemas.user.partial(),{sanitize:true,strictMode:true});if(!c.isValid)throw new shared.SecurityError("Update data validation failed",c.errors);return super.updateUser(e,c.sanitized||t)}async searchUsers(e){let t=shared.defaultValidator.validateInput(e,"text",{sanitize:true,required:true});if(!t.isValid)throw new shared.SecurityError("Search query validation failed",t.errors);return super.searchUsers(t.sanitized||e)}},f=class extends m{async createDay(e){let t=shared.ValidationSchemas.content.extend({date:shared.ValidationSchemas.user.shape.createdAt,userId:shared.ValidationSchemas.user.shape.id}),n=await shared.defaultValidator.validateSchema(e,t,{sanitize:true,strictMode:true});if(!n.isValid)throw new shared.SecurityError("Day data validation failed",n.errors);return super.createDay(n.sanitized||e)}async updateDay(e,t){let n=await shared.defaultValidator.validateSchema(t,shared.ValidationSchemas.content.partial(),{sanitize:true,strictMode:true});if(!n.isValid)throw new shared.SecurityError("Day update validation failed",n.errors);return super.updateDay(e,n.sanitized||t)}async getDayContent(e){let t=await super.getDayContent(e);return t&&typeof t=="object"&&(await shared.defaultValidator.validateSchema(t,shared.ValidationSchemas.content,{sanitize:true})).sanitized||t}},g=class extends h{async createSession(e){let t=shared.ValidationSchemas.user.pick({id:true,email:true}).extend({token:shared.ValidationSchemas.apiRequest.shape.headers,expiresAt:shared.ValidationSchemas.user.shape.createdAt}),n=await shared.defaultValidator.validateSchema(e,t,{sanitize:true,strictMode:true});if(!n.isValid)throw new shared.SecurityError("Session validation failed",n.errors);return super.createSession(n.sanitized||e)}async validateSessionToken(e){let t=shared.defaultValidator.validateInput(e,"text",{required:true,sanitize:true});return t.isValid?super.validateSessionToken(t.sanitized||e):false}},b=class{users;days;sessions;constructor(){this.users=new y,this.days=new f,this.sessions=new g;}async initialize(e={}){let t=await shared.defaultValidator.validateSchema(e,shared.ValidationSchemas.apiRequest.shape.body||{},{sanitize:true});if(!t.isValid)throw new shared.SecurityError("Configuration validation failed",t.errors);await Promise.all([]);}async handleApiRequest(e){let t=await shared.defaultValidator.validateSchema(e,shared.ValidationSchemas.apiRequest,{sanitize:true,strictMode:true});if(!t.isValid)throw new shared.SecurityError("API request validation failed",t.errors);let n=t.sanitized;switch(n.method){case "GET":return this.handleGetRequest(n);case "POST":return this.handlePostRequest(n);case "PUT":return this.handlePutRequest(n);case "DELETE":return this.handleDeleteRequest(n);default:throw new shared.SecurityError("Unsupported HTTP method",[])}}async handleGetRequest(e){if(e.path.startsWith("/users"))return this.users.searchUsers(e.query?.q||"");if(e.path.startsWith("/days"))return this.days.getDayContent(e.query?.id);throw new shared.SecurityError("Unknown GET endpoint",[])}async handlePostRequest(e){if(e.path==="/users")return this.users.createUser(e.body);if(e.path==="/days")return this.days.createDay(e.body);if(e.path==="/sessions")return this.sessions.createSession(e.body);throw new shared.SecurityError("Unknown POST endpoint",[])}async handlePutRequest(e){let t=e.path.split("/");if(t[1]==="users"&&t[2])return this.users.updateUser(t[2],e.body);if(t[1]==="days"&&t[2])return this.days.updateDay(t[2],e.body);throw new shared.SecurityError("Unknown PUT endpoint",[])}async handleDeleteRequest(e){throw e.headers?.authorization?new shared.SecurityError("DELETE operations not implemented",[]):new shared.SecurityError("Authorization required for DELETE operations",[])}},O=new b;var v=class{providers=[];eventQueue=[];userId;sessionId;constructor(){this.sessionId=this.generateSessionId();}addProvider(e){this.providers.push(e);}async track(e,t){let n={name:e,timestamp:Date.now(),sessionId:this.sessionId};t&&(n.properties=t),this.userId&&(n.userId=this.userId),this.eventQueue.push(n);let c=this.providers.map(p=>p.track(n).catch(x=>{}));await Promise.allSettled(c);}async identify(e,t){this.userId=e;let n=this.providers.map(c=>c.identify(e,t).catch(p=>{}));await Promise.allSettled(n);}getEventQueue(){return [...this.eventQueue]}clearEventQueue(){this.eventQueue=[];}generateSessionId(){return `session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}};var w=class{static DEFAULT_MULTIPLIERS={proteins:4,carbs:4,fats:9};static calculateCalories(e,t={}){let{proteinMultiplier:n=this.DEFAULT_MULTIPLIERS.proteins,carbMultiplier:c=this.DEFAULT_MULTIPLIERS.carbs,fatMultiplier:p=this.DEFAULT_MULTIPLIERS.fats}=t;return e.proteins*n+e.carbs*c+e.fats*p}static calculateMacroRatio(e){let t=this.calculateCalories(e);return t===0?{proteinsPercent:0,carbsPercent:0,fatsPercent:0}:{proteinsPercent:Math.round(e.proteins*4/t*100),carbsPercent:Math.round(e.carbs*4/t*100),fatsPercent:Math.round(e.fats*9/t*100)}}static validateNutritionData(e){return typeof e.proteins=="number"&&e.proteins>=0&&typeof e.carbs=="number"&&e.carbs>=0&&typeof e.fats=="number"&&e.fats>=0&&(e.weight===void 0||typeof e.weight=="number"&&e.weight>0)}};var J={save:()=>Promise.resolve(),load:()=>Promise.resolve(null)};

exports.AnalyticsService = v;
exports.ExerciseSchema = k;
exports.FoodEntrySchema = z;
exports.FoodProductSchema = I;
exports.NutritionService = w;
exports.SecureDayManager = f;
exports.SecureHeysCore = b;
exports.SecureSessionManager = g;
exports.SecureUserManager = y;
exports.StorageService = J;
exports.TrainingProgramSchema = T;
exports.UserDraftSchema = V;
exports.UserSchema = S;
exports.WorkoutSessionSchema = A;
exports.WorkoutSetSchema = P;
exports.calculateNutrition = E;
exports.createUser = j;
exports.secureCore = O;
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.cjs.map