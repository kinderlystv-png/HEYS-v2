{"version":3,"sources":["../src/models/food.ts","../src/models/training.ts","../src/models/user.ts","../src/secure.ts","../src/legacy/index.ts","../src/services/analytics.ts","../src/services/nutrition.ts","../src/services/storage.ts"],"names":["z","FoodProductSchema","FoodEntrySchema","calculateNutrition","product","amount","ratio","ExerciseSchema","WorkoutSetSchema","WorkoutSessionSchema","TrainingProgramSchema","UserSchema","UserDraftSchema","createUser","draft","now","defaultValidator","SecurityError","ValidationSchemas","HeysUser","userData","userId","updateData","_query","HeysDay","dayData","dayId","HeysSession","sessionData","token","SecureUserManager","validation","idValidation","dataValidation","query","SecureDayManager","daySchema","content","SecureSessionManager","sessionSchema","SecureHeysCore","config","configValidation","request","sanitizedRequest","pathParts","secureCore","AnalyticsService","provider","name","properties","event","promises","error","traits","NutritionService","data","options","proteinMultiplier","carbMultiplier","fatMultiplier","totalCalories","StorageService"],"mappings":"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","sourcesContent":["// Food and Nutrition Models - Migrated from legacy core\nimport { z } from 'zod';\n\n// Food Product Schema\nexport const FoodProductSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  brand: z.string().optional(),\n  category: z.string(),\n  nutrition: z.object({\n    calories: z.number(),\n    protein: z.number(),\n    carbs: z.number(),\n    fat: z.number(),\n    fiber: z.number().optional(),\n    sugar: z.number().optional(),\n    sodium: z.number().optional(),\n  }),\n  perUnit: z.object({\n    amount: z.number(),\n    unit: z.enum(['g', 'ml', 'piece', 'cup', 'tbsp', 'tsp']),\n  }),\n  createdAt: z.date(),\n  updatedAt: z.date(),\n});\n\nexport type FoodProduct = z.infer<typeof FoodProductSchema>;\n\n// Food Entry Schema (diary entry)\nexport const FoodEntrySchema = z.object({\n  id: z.string(),\n  userId: z.string(),\n  productId: z.string(),\n  amount: z.number(),\n  unit: z.string(),\n  date: z.date(),\n  meal: z.enum(['breakfast', 'lunch', 'dinner', 'snack']),\n  createdAt: z.date(),\n});\n\nexport type FoodEntry = z.infer<typeof FoodEntrySchema>;\n\n// Nutrition calculations\nexport const calculateNutrition = (\n  product: FoodProduct,\n  amount: number,\n): FoodProduct['nutrition'] => {\n  const ratio = amount / product.perUnit.amount;\n  return {\n    calories: Math.round(product.nutrition.calories * ratio * 10) / 10,\n    protein: Math.round(product.nutrition.protein * ratio * 10) / 10,\n    carbs: Math.round(product.nutrition.carbs * ratio * 10) / 10,\n    fat: Math.round(product.nutrition.fat * ratio * 10) / 10,\n    fiber: product.nutrition.fiber\n      ? Math.round(product.nutrition.fiber * ratio * 10) / 10\n      : undefined,\n    sugar: product.nutrition.sugar\n      ? Math.round(product.nutrition.sugar * ratio * 10) / 10\n      : undefined,\n    sodium: product.nutrition.sodium\n      ? Math.round(product.nutrition.sodium * ratio * 10) / 10\n      : undefined,\n  };\n};\n","// Training Models - New structure for workout management\nimport { z } from 'zod';\n\n// Exercise Schema\nexport const ExerciseSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  category: z.enum(['strength', 'cardio', 'flexibility', 'balance', 'sport']),\n  muscleGroups: z.array(z.string()),\n  equipment: z.string().optional(),\n  instructions: z.string().optional(),\n  difficulty: z.enum(['beginner', 'intermediate', 'advanced']),\n});\n\nexport type Exercise = z.infer<typeof ExerciseSchema>;\n\n// Workout Set Schema\nexport const WorkoutSetSchema = z.object({\n  exerciseId: z.string(),\n  reps: z.number().optional(),\n  weight: z.number().optional(),\n  duration: z.number().optional(), // in seconds\n  distance: z.number().optional(), // in meters\n  rest: z.number().optional(), // rest time in seconds\n});\n\nexport type WorkoutSet = z.infer<typeof WorkoutSetSchema>;\n\n// Workout Session Schema\nexport const WorkoutSessionSchema = z.object({\n  id: z.string(),\n  userId: z.string(),\n  name: z.string(),\n  date: z.date(),\n  sets: z.array(WorkoutSetSchema),\n  notes: z.string().optional(),\n  duration: z.number(), // total workout duration in seconds\n  createdAt: z.date(),\n});\n\nexport type WorkoutSession = z.infer<typeof WorkoutSessionSchema>;\n\n// Training Program Schema\nexport const TrainingProgramSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  description: z.string(),\n  duration: z.number(), // program duration in weeks\n  sessions: z.array(\n    z.object({\n      name: z.string(),\n      exercises: z.array(\n        z.object({\n          exerciseId: z.string(),\n          sets: z.number(),\n          reps: z.string(), // e.g., \"8-12\", \"30 sec\"\n          weight: z.string().optional(), // e.g., \"bodyweight\", \"60% 1RM\"\n        }),\n      ),\n    }),\n  ),\n  level: z.enum(['beginner', 'intermediate', 'advanced']),\n  createdAt: z.date(),\n});\n\nexport type TrainingProgram = z.infer<typeof TrainingProgramSchema>;\n","// User Model - Migrated from legacy heys_user_v12.ts\nimport { z } from 'zod';\n\n// User Schema\nexport const UserSchema = z.object({\n  id: z.string(),\n  email: z.string().email(),\n  name: z.string(),\n  profile: z\n    .object({\n      age: z.number().optional(),\n      gender: z.enum(['male', 'female', 'other']).optional(),\n      weight: z.number().optional(),\n      height: z.number().optional(),\n      activityLevel: z.enum(['sedentary', 'light', 'moderate', 'active', 'very-active']).optional(),\n    })\n    .optional(),\n  preferences: z\n    .object({\n      units: z.enum(['metric', 'imperial']).default('metric'),\n      language: z.enum(['en', 'ru']).default('en'),\n      theme: z.enum(['light', 'dark', 'auto']).default('auto'),\n    })\n    .default({}),\n  createdAt: z.date(),\n  updatedAt: z.date(),\n});\n\nexport type User = z.infer<typeof UserSchema>;\n\n// User Draft for forms\nexport const UserDraftSchema = UserSchema.partial().omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\nexport type UserDraft = z.infer<typeof UserDraftSchema>;\n\n// User utilities\nexport const createUser = (draft: UserDraft): User => {\n  const now = new Date();\n  return {\n    id: crypto.randomUUID(),\n    email: draft.email!,\n    name: draft.name!,\n    profile: draft.profile,\n    preferences: draft.preferences || {\n      units: 'metric',\n      language: 'en',\n      theme: 'auto',\n    },\n    createdAt: now,\n    updatedAt: now,\n  };\n};\n","/**\n * HEYS Security-Enhanced Core Module v1.4\n * Core functionality with built-in security validation\n *\n * @author HEYS Team\n * @version 1.4.0\n * @created 2025-01-31\n */\n\nimport { defaultValidator, SecurityError, ValidationSchemas } from '@heys/shared';\n\nimport { HeysDay, HeysSession, HeysUser } from './legacy/index';\n\n/**\n * Security-enhanced user manager\n */\nexport class SecureUserManager extends HeysUser {\n  /**\n   * Create user with security validation\n   */\n  override async createUser(userData: unknown): Promise<any> {\n    const validation = await defaultValidator.validateSchema(userData, ValidationSchemas.user, {\n      sanitize: true,\n      strictMode: false, // Changed from true to false\n    });\n\n    if (!validation.isValid) {\n      throw new SecurityError('User validation failed', validation.errors);\n    }\n\n    return super.createUser(validation.sanitized || userData);\n  }\n\n  /**\n   * Update user with security validation\n   */\n  override async updateUser(userId: string, updateData: unknown): Promise<any> {\n    // Validate user ID\n    const idValidation = await defaultValidator.validateSchema(\n      userId,\n      ValidationSchemas.user.shape.id,\n    );\n\n    if (!idValidation.isValid) {\n      throw new SecurityError('Invalid user ID', idValidation.errors);\n    }\n\n    // Validate update data\n    const dataValidation = await defaultValidator.validateSchema(\n      updateData,\n      ValidationSchemas.user.partial(),\n      { sanitize: true, strictMode: false }, // Changed from true to false\n    );\n\n    if (!dataValidation.isValid) {\n      throw new SecurityError('Update data validation failed', dataValidation.errors);\n    }\n\n    return super.updateUser(userId, dataValidation.sanitized || updateData);\n  }\n\n  /**\n   * Search users with input sanitization\n   */\n  override async searchUsers(query: unknown): Promise<any[]> {\n    const validation = defaultValidator.validateInput(query, 'text', {\n      sanitize: true,\n      required: true,\n    });\n\n    if (!validation.isValid) {\n      throw new SecurityError('Search query validation failed', validation.errors);\n    }\n\n    return super.searchUsers((validation.sanitized as string) || (query as string));\n  }\n}\n\n/**\n * Security-enhanced day manager\n */\nexport class SecureDayManager extends HeysDay {\n  /**\n   * Create day entry with validation\n   */\n  override async createDay(dayData: unknown): Promise<any> {\n    // Create dynamic schema for day data\n    const daySchema = ValidationSchemas.content.extend({\n      date: ValidationSchemas.user.shape.createdAt,\n      userId: ValidationSchemas.user.shape.id,\n    });\n\n    const validation = await defaultValidator.validateSchema(dayData, daySchema, {\n      sanitize: true,\n      strictMode: false, // Changed from true to false\n    });\n\n    if (!validation.isValid) {\n      throw new SecurityError('Day data validation failed', validation.errors);\n    }\n\n    return super.createDay(validation.sanitized || dayData);\n  }\n\n  /**\n   * Update day with security validation\n   */\n  override async updateDay(dayId: string, updateData: unknown): Promise<any> {\n    const validation = await defaultValidator.validateSchema(\n      updateData,\n      ValidationSchemas.content.partial(),\n      { sanitize: true, strictMode: false }, // Changed from true to false\n    );\n\n    if (!validation.isValid) {\n      throw new SecurityError('Day update validation failed', validation.errors);\n    }\n\n    return super.updateDay(dayId, validation.sanitized || updateData);\n  }\n\n  /**\n   * Get day content with XSS protection\n   */\n  override async getDayContent(dayId: string): Promise<any> {\n    const content = await super.getDayContent(dayId);\n\n    if (content && typeof content === 'object') {\n      // Sanitize content before returning\n      const validation = await defaultValidator.validateSchema(content, ValidationSchemas.content, {\n        sanitize: true,\n      });\n\n      return validation.sanitized || content;\n    }\n\n    return content;\n  }\n}\n\n/**\n * Security-enhanced session manager\n */\nexport class SecureSessionManager extends HeysSession {\n  /**\n   * Create session with security validation\n   */\n  override async createSession(sessionData: unknown): Promise<any> {\n    const sessionSchema = ValidationSchemas.user\n      .pick({\n        id: true,\n        email: true,\n      })\n      .extend({\n        token: ValidationSchemas.apiRequest.shape.headers,\n        expiresAt: ValidationSchemas.user.shape.createdAt,\n      });\n\n    const validation = await defaultValidator.validateSchema(sessionData, sessionSchema, {\n      sanitize: true,\n      strictMode: false, // Changed from true to false\n    });\n\n    if (!validation.isValid) {\n      throw new SecurityError('Session validation failed', validation.errors);\n    }\n\n    return super.createSession(validation.sanitized || sessionData);\n  }\n\n  /**\n   * Validate session token\n   */\n  override async validateSessionToken(token: unknown): Promise<boolean> {\n    const validation = defaultValidator.validateInput(token, 'text', {\n      required: true,\n      sanitize: true,\n    });\n\n    if (!validation.isValid) {\n      return false;\n    }\n\n    return super.validateSessionToken((validation.sanitized as string) || (token as string));\n  }\n}\n\n/**\n * Main secure core manager\n */\nexport class SecureHeysCore {\n  public readonly users: SecureUserManager;\n  public readonly days: SecureDayManager;\n  public readonly sessions: SecureSessionManager;\n\n  constructor() {\n    this.users = new SecureUserManager();\n    this.days = new SecureDayManager();\n    this.sessions = new SecureSessionManager();\n  }\n\n  /**\n   * Initialize with security checks\n   */\n  async initialize(config: unknown = {}): Promise<void> {\n    const configValidation = await defaultValidator.validateSchema(\n      config,\n      ValidationSchemas.apiRequest.shape.body || {},\n      { sanitize: true },\n    );\n\n    if (!configValidation.isValid) {\n      throw new SecurityError('Configuration validation failed', configValidation.errors);\n    }\n\n    // Initialize core modules with validated config\n    await Promise.all([\n      // Legacy classes don't have initialize methods, so we skip them\n    ]);\n  }\n\n  /**\n   * Secure API endpoint handler\n   */\n  async handleApiRequest(request: unknown): Promise<any> {\n    const validation = await defaultValidator.validateSchema(\n      request,\n      ValidationSchemas.apiRequest,\n      { sanitize: true, strictMode: false }, // Change to false to avoid applying all security rules\n    );\n\n    if (!validation.isValid) {\n      throw new SecurityError('API request validation failed', validation.errors);\n    }\n\n    const sanitizedRequest = validation.sanitized as any;\n\n    // Route request based on method and path\n    switch (sanitizedRequest.method) {\n      case 'GET':\n        return this.handleGetRequest(sanitizedRequest);\n      case 'POST':\n        return this.handlePostRequest(sanitizedRequest);\n      case 'PUT':\n        return this.handlePutRequest(sanitizedRequest);\n      case 'DELETE':\n        return this.handleDeleteRequest(sanitizedRequest);\n      default:\n        throw new SecurityError('Unsupported HTTP method', []);\n    }\n  }\n\n  private async handleGetRequest(request: any): Promise<any> {\n    // Handle GET requests with path routing\n    if (request.path.startsWith('/users')) {\n      return this.users.searchUsers(request.query?.q || '');\n    }\n    if (request.path.startsWith('/days')) {\n      return this.days.getDayContent(request.query?.id);\n    }\n    throw new SecurityError('Unknown GET endpoint', []);\n  }\n\n  private async handlePostRequest(request: any): Promise<any> {\n    // Handle POST requests\n    if (request.path === '/users') {\n      return this.users.createUser(request.body);\n    }\n    if (request.path === '/days') {\n      return this.days.createDay(request.body);\n    }\n    if (request.path === '/sessions') {\n      return this.sessions.createSession(request.body);\n    }\n    throw new SecurityError('Unknown POST endpoint', []);\n  }\n\n  private async handlePutRequest(request: any): Promise<any> {\n    // Handle PUT requests\n    const pathParts = request.path.split('/');\n    if (pathParts[1] === 'users' && pathParts[2]) {\n      return this.users.updateUser(pathParts[2], request.body);\n    }\n    if (pathParts[1] === 'days' && pathParts[2]) {\n      return this.days.updateDay(pathParts[2], request.body);\n    }\n    throw new SecurityError('Unknown PUT endpoint', []);\n  }\n\n  private async handleDeleteRequest(request: any): Promise<any> {\n    // Handle DELETE requests with security checks\n\n    // Validate that user has permission to delete\n    if (!request.headers?.authorization) {\n      throw new SecurityError('Authorization required for DELETE operations', []);\n    }\n\n    // Additional DELETE logic would go here\n    throw new SecurityError('DELETE operations not implemented', []);\n  }\n}\n\n/**\n * Default secure core instance\n */\nexport const secureCore = new SecureHeysCore();\n","/**\n * HEYS Legacy Exports for Core Package\n * Provides compatibility layer for v1.2 components\n */\n\n// Note: Legacy core will be exported separately\n// export { default as HeysCore } from './heys_core_v12';\n\n// Temporary compatibility classes for security integration\nexport class HeysUser {\n  async createUser(userData: any): Promise<any> {\n    // Legacy user creation logic\n    return { id: this.generateId(), ...userData };\n  }\n\n  async updateUser(userId: string, updateData: any): Promise<any> {\n    // Legacy user update logic\n    return { id: userId, ...updateData };\n  }\n\n  async searchUsers(_query: string): Promise<any[]> {\n    // Legacy user search logic\n    return [];\n  }\n\n  private generateId(): string {\n    return Math.random().toString(36).substr(2, 9);\n  }\n}\n\nexport class HeysDay {\n  async createDay(dayData: any): Promise<any> {\n    // Legacy day creation logic\n    return { id: this.generateId(), ...dayData };\n  }\n\n  async updateDay(dayId: string, updateData: any): Promise<any> {\n    // Legacy day update logic\n    return { id: dayId, ...updateData };\n  }\n\n  async getDayContent(dayId: string): Promise<any> {\n    // Legacy day content retrieval\n    return { id: dayId, content: 'sample content' };\n  }\n\n  private generateId(): string {\n    return Math.random().toString(36).substr(2, 9);\n  }\n}\n\nexport class HeysSession {\n  async createSession(sessionData: any): Promise<any> {\n    // Legacy session creation logic\n    return {\n      id: this.generateId(),\n      token: this.generateToken(),\n      ...sessionData,\n    };\n  }\n\n  async validateSessionToken(token: string): Promise<boolean> {\n    // Legacy token validation\n    return Boolean(token && token.length > 10);\n  }\n\n  private generateId(): string {\n    return Math.random().toString(36).substr(2, 9);\n  }\n\n  private generateToken(): string {\n    return Math.random().toString(36).substr(2, 32);\n  }\n}\n","// Analytics service\nexport interface AnalyticsEvent {\n  name: string;\n  properties?: Record<string, any>;\n  timestamp?: number;\n  userId?: string;\n  sessionId?: string;\n}\n\nexport interface AnalyticsProvider {\n  track(event: AnalyticsEvent): Promise<void>;\n  identify(userId: string, traits?: Record<string, any>): Promise<void>;\n}\n\nexport class AnalyticsService {\n  private providers: AnalyticsProvider[] = [];\n  private eventQueue: AnalyticsEvent[] = [];\n  private userId?: string;\n  private sessionId: string;\n\n  constructor() {\n    this.sessionId = this.generateSessionId();\n  }\n\n  addProvider(provider: AnalyticsProvider): void {\n    this.providers.push(provider);\n  }\n\n  async track(name: string, properties?: Record<string, any>): Promise<void> {\n    const event: AnalyticsEvent = {\n      name,\n      timestamp: Date.now(),\n      sessionId: this.sessionId,\n    };\n\n    if (properties) {\n      event.properties = properties;\n    }\n\n    if (this.userId) {\n      event.userId = this.userId;\n    }\n\n    this.eventQueue.push(event);\n\n    // Send to all providers\n    const promises = this.providers.map((provider) =>\n      provider.track(event).catch((error) => console.error('Analytics provider error:', error)),\n    );\n\n    await Promise.allSettled(promises);\n  }\n\n  async identify(userId: string, traits?: Record<string, any>): Promise<void> {\n    this.userId = userId;\n\n    const promises = this.providers.map((provider) =>\n      provider\n        .identify(userId, traits)\n        .catch((error) => console.error('Analytics identify error:', error)),\n    );\n\n    await Promise.allSettled(promises);\n  }\n\n  getEventQueue(): AnalyticsEvent[] {\n    return [...this.eventQueue];\n  }\n\n  clearEventQueue(): void {\n    this.eventQueue = [];\n  }\n\n  private generateSessionId(): string {\n    return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n}\n","// Nutrition service\nexport interface NutritionData {\n  proteins: number; // g\n  carbs: number; // g\n  fats: number; // g\n  weight?: number; // g\n}\n\nexport interface CalorieCalculationOptions {\n  proteinMultiplier?: number; // kcal/g (default: 4)\n  carbMultiplier?: number; // kcal/g (default: 4)\n  fatMultiplier?: number; // kcal/g (default: 9)\n}\n\nexport class NutritionService {\n  private static readonly DEFAULT_MULTIPLIERS = {\n    proteins: 4,\n    carbs: 4,\n    fats: 9,\n  };\n\n  static calculateCalories(data: NutritionData, options: CalorieCalculationOptions = {}): number {\n    const {\n      proteinMultiplier = this.DEFAULT_MULTIPLIERS.proteins,\n      carbMultiplier = this.DEFAULT_MULTIPLIERS.carbs,\n      fatMultiplier = this.DEFAULT_MULTIPLIERS.fats,\n    } = options;\n\n    return (\n      data.proteins * proteinMultiplier + data.carbs * carbMultiplier + data.fats * fatMultiplier\n    );\n  }\n\n  static calculateMacroRatio(data: NutritionData): {\n    proteinsPercent: number;\n    carbsPercent: number;\n    fatsPercent: number;\n  } {\n    const totalCalories = this.calculateCalories(data);\n\n    if (totalCalories === 0) {\n      return { proteinsPercent: 0, carbsPercent: 0, fatsPercent: 0 };\n    }\n\n    return {\n      proteinsPercent: Math.round(((data.proteins * 4) / totalCalories) * 100),\n      carbsPercent: Math.round(((data.carbs * 4) / totalCalories) * 100),\n      fatsPercent: Math.round(((data.fats * 9) / totalCalories) * 100),\n    };\n  }\n\n  static validateNutritionData(data: NutritionData): boolean {\n    return (\n      typeof data.proteins === 'number' &&\n      data.proteins >= 0 &&\n      typeof data.carbs === 'number' &&\n      data.carbs >= 0 &&\n      typeof data.fats === 'number' &&\n      data.fats >= 0 &&\n      (data.weight === undefined || (typeof data.weight === 'number' && data.weight > 0))\n    );\n  }\n}\n","// Storage service placeholder\nexport const StorageService = {\n  save: () => Promise.resolve(),\n  load: () => Promise.resolve(null),\n};\n"]}