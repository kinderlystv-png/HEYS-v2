
> @heys/core@13.0.0 test C:\! HEYS 2\packages\core
> vitest run

‚ñ≤ [WARNING] The condition "types" here will never be used as it comes after both "import" and "require" [package.json]

    package.json:13:6:
      13 ‚îÇ       "types": "./dist/index.d.ts"
         ‚ïµ       ~~~~~~~

  The "import" condition comes earlier and will be used for all "import" statements:

    package.json:11:6:
      11 ‚îÇ       "import": "./dist/index.js",
         ‚ïµ       ~~~~~~~~

  The "require" condition comes earlier and will be used for all "require" calls:

    package.json:12:6:
      12 ‚îÇ       "require": "./dist/index.cjs",
         ‚ïµ       ~~~~~~~~~

‚ñ≤ [WARNING] The condition "types" here will never be used as it comes after both "import" and "require" [package.json]

    package.json:18:6:
      18 ‚îÇ       "types": "./dist/models/index.d.ts"
         ‚ïµ       ~~~~~~~

  The "import" condition comes earlier and will be used for all "import" statements:

    package.json:16:6:
      16 ‚îÇ       "import": "./dist/models/index.js",
         ‚ïµ       ~~~~~~~~

  The "require" condition comes earlier and will be used for all "require" calls:

    package.json:17:6:
      17 ‚îÇ       "require": "./dist/models/index.cjs",
         ‚ïµ       ~~~~~~~~~

‚ñ≤ [WARNING] The condition "types" here will never be used as it comes after both "import" and "require" [package.json]

    package.json:23:6:
      23 ‚îÇ       "types": "./dist/services/index.d.ts"
         ‚ïµ       ~~~~~~~

  The "import" condition comes earlier and will be used for all "import" statements:

    package.json:21:6:
      21 ‚îÇ       "import": "./dist/services/index.js",
         ‚ïµ       ~~~~~~~~

  The "require" condition comes earlier and will be used for all "require" calls:

    package.json:22:6:
      22 ‚îÇ       "require": "./dist/services/index.cjs",
         ‚ïµ       ~~~~~~~~~


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/! HEYS 2/packages/core[39m

 [32m‚úì[39m src/__tests__/legacy.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 4[2mms[22m[39m
 [32m‚úì[39m src/__tests__/my-first.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 6[2mms[22m[39m
 [32m‚úì[39m src/__tests__/food.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32m‚úì[39m src/__tests__/training.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32m‚úì[39m src/__tests__/user.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32m‚úì[39m src/__tests__/basic.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 5[2mms[22m[39m
 [31m‚ùØ[39m src/__tests__/secure.test.ts [2m([22m[2m12 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[32m 32[2mms[22m[39m
[31m   [31m√ó[31m SecureUserManager[2m > [22mshould validate user data before creation[39m[32m 11[2mms[22m[39m
[31m     ‚Üí User validation failed[39m
   [32m‚úì[39m SecureUserManager[2m > [22mshould reject invalid user data[32m 5[2mms[22m[39m
[31m   [31m√ó[31m SecureUserManager[2m > [22mshould sanitize search queries[39m[32m 2[2mms[22m[39m
[31m     ‚Üí alert is not a function[39m
[31m   [31m√ó[31m SecureDayManager[2m > [22mshould validate day data before creation[39m[32m 1[2mms[22m[39m
[31m     ‚Üí Day data validation failed[39m
   [32m‚úì[39m SecureDayManager[2m > [22mshould sanitize content when retrieving days[32m 1[2mms[22m[39m
[31m   [31m√ó[31m SecureSessionManager[2m > [22mshould validate session data before creation[39m[32m 1[2mms[22m[39m
[31m     ‚Üí Session validation failed[39m
   [32m‚úì[39m SecureSessionManager[2m > [22mshould validate session tokens[32m 1[2mms[22m[39m
   [32m‚úì[39m SecureHeysCore[2m > [22mshould initialize with validated configuration[32m 1[2mms[22m[39m
[31m   [31m√ó[31m SecureHeysCore[2m > [22mshould handle secure API requests[39m[32m 1[2mms[22m[39m
[31m     ‚Üí API request validation failed[39m
   [32m‚úì[39m SecureHeysCore[2m > [22mshould reject malformed API requests[32m 0[2mms[22m[39m
[31m   [31m√ó[31m SecureHeysCore[2m > [22mshould handle POST requests with validation[39m[32m 1[2mms[22m[39m
[31m     ‚Üí API request validation failed[39m
[31m   [31m√ó[31m SecureHeysCore[2m > [22mshould require authorization for DELETE requests[39m[32m 5[2mms[22m[39m
[31m     ‚Üí expected [Function] to throw error including 'Authorization required for DELETE ope‚Ä¶' but got 'API request validation failed'[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 7 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m src/__tests__/secure.test.ts[2m > [22mSecureUserManager[2m > [22mshould validate user data before creation
[31m[1mSecurityError[22m: User validation failed[39m
[36m [2m‚ùØ[22m SecureUserManager.createUser src/secure.ts:[2m28:13[22m[39m
    [90m 26| [39m
    [90m 27| [39m    [35mif[39m ([33m![39mvalidation[33m.[39misValid) {
    [90m 28| [39m      throw new SecurityError('User validation failed', validation.err‚Ä¶
    [90m   | [39m            [31m^[39m
    [90m 29| [39m    }
    [90m 30| [39m
[90m [2m‚ùØ[22m src/__tests__/secure.test.ts:[2m29:20[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/7]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/secure.test.ts[2m > [22mSecureUserManager[2m > [22mshould sanitize search queries
[31m[1mTypeError[22m: alert is not a function[39m
[90m [2m‚ùØ[22m eval ../../../../:[2m2:1[22m[39m
[90m [2m‚ùØ[22m HTMLScriptElement.#evaluateScript ../../../!%20HEYS%202/node_modules/.pnpm/happy-dom@18.0.1/node_modules/happy-dom/lib/nodes/html-script-element/HTMLScriptElement.js:[2m456:20[22m[39m
[90m [2m‚ùØ[22m HTMLScriptElement.[connectedToDocument] ../../../!%20HEYS%202/node_modules/.pnpm/happy-dom@18.0.1/node_modules/happy-dom/lib/nodes/html-script-element/HTMLScriptElement.js:[2m329:45[22m[39m
[90m [2m‚ùØ[22m HTMLScriptElement.[connectedToNode] ../../../!%20HEYS%202/node_modules/.pnpm/happy-dom@18.0.1/node_modules/happy-dom/lib/nodes/node/Node.js:[2m785:53[22m[39m
[90m [2m‚ùØ[22m HTMLScriptElement.[connectedToNode] ../../../!%20HEYS%202/node_modules/.pnpm/happy-dom@18.0.1/node_modules/happy-dom/lib/nodes/html-element/HTMLElement.js:[2m812:46[22m[39m
[90m [2m‚ùØ[22m HTMLHtmlElement.[appendChild] ../../../!%20HEYS%202/node_modules/.pnpm/happy-dom@18.0.1/node_modules/happy-dom/lib/nodes/node/Node.js:[2m404:45[22m[39m
[90m [2m‚ùØ[22m HTMLHtmlElement.[appendChild] ../../../!%20HEYS%202/node_modules/.pnpm/happy-dom@18.0.1/node_modules/happy-dom/lib/nodes/element/Element.js:[2m999:62[22m[39m
[90m [2m‚ùØ[22m HTMLHtmlElement.[insertBefore] ../../../!%20HEYS%202/node_modules/.pnpm/happy-dom@18.0.1/node_modules/happy-dom/lib/nodes/node/Node.js:[2m505:45[22m[39m
[90m [2m‚ùØ[22m HTMLHtmlElement.[insertBefore] ../../../!%20HEYS%202/node_modules/.pnpm/happy-dom@18.0.1/node_modules/happy-dom/lib/nodes/element/Element.js:[2m1015:63[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/7]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/secure.test.ts[2m > [22mSecureDayManager[2m > [22mshould validate day data before creation
[31m[1mSecurityError[22m: Day data validation failed[39m
[36m [2m‚ùØ[22m SecureDayManager.createDay src/secure.ts:[2m100:13[22m[39m
    [90m 98| [39m
    [90m 99| [39m    [35mif[39m ([33m![39mvalidation[33m.[39misValid) {
    [90m100| [39m      throw new SecurityError('Day data validation failed', validation‚Ä¶
    [90m   | [39m            [31m^[39m
    [90m101| [39m    }
    [90m102| [39m
[90m [2m‚ùØ[22m src/__tests__/secure.test.ts:[2m67:20[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/7]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/secure.test.ts[2m > [22mSecureSessionManager[2m > [22mshould validate session data before creation
[31m[1mSecurityError[22m: Session validation failed[39m
[36m [2m‚ùØ[22m SecureSessionManager.createSession src/secure.ts:[2m167:13[22m[39m
    [90m165| [39m
    [90m166| [39m    [35mif[39m ([33m![39mvalidation[33m.[39misValid) {
    [90m167| [39m      throw new SecurityError('Session validation failed', validation.‚Ä¶
    [90m   | [39m            [31m^[39m
    [90m168| [39m    }
    [90m169| [39m
[90m [2m‚ùØ[22m src/__tests__/secure.test.ts:[2m95:20[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/7]‚éØ[22m[39m


[41m[1m FAIL [22m[49m src/__tests__/secure.test.ts[2m > [22mSecureHeysCore[2m > [22mshould handle secure API requests
[31m[1mSecurityError[22m: API request validation failed[39m
[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (7)[39m
[36m [2m‚ùØ[22m SecureHeysCore.handleApiRequest src/secure.ts:[2m235:13[22m[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m37 passed[39m[22m[90m (44)[39m
[2m   Start at [22m 20:40:15
[2m   Duration [22m 1.89s[2m (transform 439ms, setup 178ms, collect 909ms, tests 86ms, environment 5.78s, prepare 1.79s)[22m

    [90m233| [39m
    [90m234| [39m    [35mif[39m ([33m![39mvalidation[33m.[39misValid) {
    [90m235| [39m      throw new SecurityError('API request validation failed', validat‚Ä¶
    [90m   | [39m            [31m^[39m
    [90m236| [39m    }
    [90m237| [39m
[90m [2m‚ùØ[22m src/__tests__/secure.test.ts:[2m136:20[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/7]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/secure.test.ts[2m > [22mSecureHeysCore[2m > [22mshould handle POST requests with validation
[31m[1mSecurityError[22m: API request validation failed[39m
[36m [2m‚ùØ[22m SecureHeysCore.handleApiRequest src/secure.ts:[2m235:13[22m[39m
    [90m233| [39m
    [90m234| [39m    [35mif[39m ([33m![39mvalidation[33m.[39misValid) {
    [90m235| [39m      throw new SecurityError('API request validation failed', validat‚Ä¶
    [90m   | [39m            [31m^[39m
    [90m236| [39m    }
    [90m237| [39m
[90m [2m‚ùØ[22m src/__tests__/secure.test.ts:[2m162:20[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/7]‚éØ[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/secure.test.ts[2m > [22mSecureHeysCore[2m > [22mshould require authorization for DELETE requests
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Authorization required for DELETE ope‚Ä¶' but got 'API request validation failed'[39m

Expected: [32m"A[7muthorization required for DELETE operations[27m"[39m
Received: [31m"A[7mPI request validation failed[27m"[39m

[36m [2m‚ùØ[22m src/__tests__/secure.test.ts:[2m173:5[22m[39m
    [90m171| [39m    }[33m;[39m
    [90m172| [39m
    [90m173| [39m    await expect(secureCore.handleApiRequest(deleteRequest)).rejects.t‚Ä¶
    [90m   | [39m    [31m^[39m
    [90m174| [39m  })[33m;[39m
    [90m175| [39m})[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/7]‚éØ[22m[39m

‚ÄâELIFECYCLE‚Äâ Test failed. See above for more details.
