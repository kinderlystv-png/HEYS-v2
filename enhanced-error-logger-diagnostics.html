<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üîç Enhanced Error Logger Diagnostics</title>
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .button-group {
        margin: 10px 0;
      }
      .btn {
        padding: 8px 16px;
        margin: 5px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        background: #007acc;
        color: white;
      }
      .btn:hover {
        background: #005a9e;
      }
      .btn.success {
        background: #28a745;
      }
      .btn.warning {
        background: #ffc107;
        color: black;
      }
      .btn.danger {
        background: #dc3545;
      }
      .output {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        white-space: pre-wrap;
        max-height: 300px;
        overflow-y: auto;
      }
      .status {
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .status.warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      .stat-box {
        background: #e9ecef;
        padding: 15px;
        border-radius: 5px;
        text-align: center;
      }
      .stat-number {
        font-size: 2em;
        font-weight: bold;
        color: #007acc;
      }
      .stat-label {
        font-size: 0.9em;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîç Enhanced Error Logger Diagnostics</h1>

      <div class="section">
        <h2>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
        <div id="system-status"></div>
        <div class="button-group">
          <button class="btn" onclick="checkSystemStatus()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
          <button class="btn success" onclick="initializeLogger()">
            üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–≥–µ—Ä
          </button>
          <button class="btn warning" onclick="resetLogger()">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–≥–≥–µ—Ä</button>
        </div>
      </div>

      <div class="section">
        <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <div class="grid">
          <div class="stat-box">
            <div class="stat-number" id="total-logs">0</div>
            <div class="stat-label">–í—Å–µ–≥–æ –ª–æ–≥–æ–≤</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="error-count">0</div>
            <div class="stat-label">–û—à–∏–±–∫–∏</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="warning-count">0</div>
            <div class="stat-label">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="session-duration">0s</div>
            <div class="stat-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏</div>
          </div>
        </div>
        <div class="button-group">
          <button class="btn" onclick="updateStats()">üìä –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
          <button class="btn" onclick="showDetailedStats()">üìã –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </div>
      </div>

      <div class="section">
        <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <div class="button-group">
          <button class="btn danger" onclick="generateTestError()">üî• –°–æ–∑–¥–∞—Ç—å –æ—à–∏–±–∫—É</button>
          <button class="btn warning" onclick="generateTestWarning()">
            ‚ö†Ô∏è –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
          </button>
          <button class="btn" onclick="generateTestInfo()">‚ÑπÔ∏è –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
          <button class="btn" onclick="generateMultipleErrors()">üí• –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–∏—é –æ—à–∏–±–æ–∫</button>
        </div>
      </div>

      <div class="section">
        <h2>üì§ –≠–∫—Å–ø–æ—Ä—Ç –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
        <div class="button-group">
          <button class="btn" onclick="exportCurrentLogs()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤</button>
          <button class="btn" onclick="showAllLogs()">üìã –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ª–æ–≥–∏</button>
          <button class="btn danger" onclick="clearAllLogs()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
        </div>
      </div>

      <div class="section">
        <h2>üìã –í—ã–≤–æ–¥ –∫–æ–Ω—Å–æ–ª–∏</h2>
        <div id="console-output" class="output"></div>
        <div class="button-group">
          <button class="btn" onclick="clearConsole()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å</button>
        </div>
      </div>
    </div>

    <!-- Enhanced Error Logging System -->
    <script src="TOOLS/enhanced-error-logger.js"></script>
    <script src="TOOLS/stack-trace-analyzer.js"></script>
    <script src="TOOLS/error-classification-engine.js"></script>
    <script src="TOOLS/real-time-error-dashboard.js"></script>
    <script src="TOOLS/enhanced-error-logging-tests.js"></script>

    <script>
      let logger = null;
      let consoleOutput = [];

      function log(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString();
        const logMessage = `[${timestamp}] ${message}`;
        consoleOutput.push(logMessage);

        const consoleElement = document.getElementById('console-output');
        consoleElement.textContent = consoleOutput.slice(-50).join('\n');
        consoleElement.scrollTop = consoleElement.scrollHeight;

        console.log(logMessage);
      }

      function showStatus(message, type = 'info') {
        const statusDiv = document.getElementById('system-status');
        statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
      }

      function checkSystemStatus() {
        log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã...');

        const checks = {
          EnhancedErrorLogger: typeof window.EnhancedErrorLogger !== 'undefined',
          StackTraceAnalyzer: typeof window.StackTraceAnalyzer !== 'undefined',
          ErrorClassificationEngine: typeof window.ErrorClassificationEngine !== 'undefined',
          RealTimeErrorDashboard: typeof window.RealTimeErrorDashboard !== 'undefined',
          EnhancedErrorLoggingTests: typeof window.EnhancedErrorLoggingTests !== 'undefined',
        };

        let status = '‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:\n';
        let allOk = true;

        for (const [component, available] of Object.entries(checks)) {
          const icon = available ? '‚úÖ' : '‚ùå';
          status += `${icon} ${component}: ${available ? '–î–æ—Å—Ç—É–ø–µ–Ω' : '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}\n`;
          if (!available) allOk = false;
        }

        status += `\nüìã –°–æ—Å—Ç–æ—è–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞: ${logger ? (logger.isActive ? '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' : '‚ö†Ô∏è –ù–µ–∞–∫—Ç–∏–≤–µ–Ω') : '‚ùå –ù–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω'}`;

        if (logger) {
          status += `\nüìç Session ID: ${logger.sessionId}`;
          status += `\n‚è±Ô∏è –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: ${Math.round((Date.now() - logger.startTime) / 1000)}s`;
        }

        showStatus(status, allOk ? 'success' : 'error');
        log('‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
      }

      function initializeLogger() {
        try {
          if (typeof window.EnhancedErrorLogger === 'undefined') {
            showStatus(
              '‚ùå EnhancedErrorLogger –Ω–µ –Ω–∞–π–¥–µ–Ω! –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã.',
              'error',
            );
            return;
          }

          logger = new EnhancedErrorLogger({
            logLevels: ['error', 'warning', 'info', 'debug'],
            autoClassify: true,
            detailedStackTrace: true,
            performanceTracking: true,
            realTimeUpdates: true,
            maxLogs: 1000,
          });

          // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ª–æ–≥–æ–≤
          logger.addListener((logEntry) => {
            log(`üì• –ù–æ–≤—ã–π –ª–æ–≥: [${logEntry.level.toUpperCase()}] ${logEntry.title}`);
            updateStats();
          });

          showStatus('‚úÖ Enhanced Error Logger —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
          log(`üöÄ Logger –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. Session ID: ${logger.sessionId}`);
          updateStats();
        } catch (error) {
          showStatus(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
          log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
        }
      }

      function resetLogger() {
        if (logger) {
          logger.restart();
          showStatus('üîÑ Logger –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω', 'success');
          log('üîÑ Logger –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω');
          updateStats();
        } else {
          initializeLogger();
        }
      }

      function updateStats() {
        if (!logger) {
          document.getElementById('total-logs').textContent = '0';
          document.getElementById('error-count').textContent = '0';
          document.getElementById('warning-count').textContent = '0';
          document.getElementById('session-duration').textContent = '0s';
          return;
        }

        const stats = logger.getStats();

        document.getElementById('total-logs').textContent = stats.total;
        document.getElementById('error-count').textContent = stats.byLevel.error || 0;
        document.getElementById('warning-count').textContent = stats.byLevel.warning || 0;
        document.getElementById('session-duration').textContent =
          Math.round(stats.sessionDuration / 1000) + 's';
      }

      function showDetailedStats() {
        if (!logger) {
          log('‚ùå Logger –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
          return;
        }

        const stats = logger.getStats();
        const logs = logger.getLogs();

        log('üìä –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:');
        log(`   üìç Session ID: ${stats.sessionId}`);
        log(`   üìà –í—Å–µ–≥–æ –ª–æ–≥–æ–≤: ${stats.total}`);
        log(`   üî• –û—à–∏–±–∫–∏: ${stats.byLevel.error || 0}`);
        log(`   ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: ${stats.byLevel.warning || 0}`);
        log(`   ‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: ${stats.byLevel.info || 0}`);
        log(`   üêõ –û—Ç–ª–∞–¥–∫–∞: ${stats.byLevel.debug || 0}`);
        log(`   ‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏: ${Math.round(stats.sessionDuration / 1000)}s`);
        log(`   üóÇÔ∏è –õ–æ–≥–æ–≤ –≤ –º–∞—Å—Å–∏–≤–µ: ${logs.length}`);
        log(`   ‚öôÔ∏è –°—Ç–∞—Ç—É—Å: ${logger.isActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}`);
      }

      function generateTestError() {
        if (!logger) {
          log('‚ùå Logger –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
          return;
        }

        // –°–æ–∑–¥–∞–µ–º –æ—à–∏–±–∫—É —á–µ—Ä–µ–∑ console.error
        console.error('üß™ –¢–µ—Å—Ç–æ–≤–∞—è –æ—à–∏–±–∫–∞ –∏–∑ console.error');

        // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º–Ω—É—é –æ—à–∏–±–∫—É
        try {
          throw new Error('üß™ –ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –æ—à–∏–±–∫–∞');
        } catch (e) {
          logger.logError('Test Programmatic Error', {
            message: e.message,
            source: 'diagnostic_test',
            stackTrace: e.stack,
          });
        }

        log('üî• –¢–µ—Å—Ç–æ–≤—ã–µ –æ—à–∏–±–∫–∏ —Å–æ–∑–¥–∞–Ω—ã');
      }

      function generateTestWarning() {
        if (!logger) {
          log('‚ùå Logger –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
          return;
        }

        console.warn('üß™ –¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏–∑ console.warn');
        logger.logWarning('Test Warning', {
          message: '–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ',
          source: 'diagnostic_test',
        });

        log('‚ö†Ô∏è –¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã');
      }

      function generateTestInfo() {
        if (!logger) {
          log('‚ùå Logger –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
          return;
        }

        logger.logInfo('Test Info Message', {
          message: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
          source: 'diagnostic_test',
        });

        log('‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ');
      }

      function generateMultipleErrors() {
        if (!logger) {
          log('‚ùå Logger –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
          return;
        }

        log('üí• –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–∏–∏ –æ—à–∏–±–æ–∫...');

        setTimeout(() => generateTestError(), 100);
        setTimeout(() => generateTestWarning(), 200);
        setTimeout(() => generateTestInfo(), 300);
        setTimeout(() => generateTestError(), 400);
        setTimeout(() => generateTestWarning(), 500);

        setTimeout(() => {
          log('‚úÖ –°–µ—Ä–∏—è –æ—à–∏–±–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
          updateStats();
        }, 600);
      }

      function exportCurrentLogs() {
        if (!logger) {
          log('‚ùå Logger –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
          return;
        }

        const exportData = logger.exportLogs('json');

        const blob = new Blob([exportData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `enhanced-error-logs-${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);

        log('üì§ –õ–æ–≥–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª');
      }

      function showAllLogs() {
        if (!logger) {
          log('‚ùå Logger –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
          return;
        }

        const logs = logger.getLogs();
        log(`üìã –í—Å–µ –ª–æ–≥–∏ (${logs.length} –∑–∞–ø–∏—Å–µ–π):`);

        logs.forEach((logEntry, index) => {
          const time = new Date(logEntry.timestamp).toLocaleTimeString();
          log(`  ${index + 1}. [${time}] [${logEntry.level.toUpperCase()}] ${logEntry.title}`);
        });
      }

      function clearAllLogs() {
        if (!logger) {
          log('‚ùå Logger –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
          return;
        }

        logger.clearLogs();
        updateStats();
        log('üßπ –í—Å–µ –ª–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã');
      }

      function clearConsole() {
        consoleOutput = [];
        document.getElementById('console-output').textContent = '';
        log('üßπ –ö–æ–Ω—Å–æ–ª—å –æ—á–∏—â–µ–Ω–∞');
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      window.addEventListener('load', () => {
        log('üöÄ –°–∏—Å—Ç–µ–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ Enhanced Error Logger –∑–∞–ø—É—â–µ–Ω–∞');
        setTimeout(() => {
          checkSystemStatus();
          if (typeof window.EnhancedErrorLogger !== 'undefined') {
            initializeLogger();
          }
        }, 500);
      });

      // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
      setInterval(() => {
        if (logger) {
          updateStats();
        }
      }, 5000);
    </script>
  </body>
</html>
