# üö® –≠–ö–°–¢–†–ï–ù–ù–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ü–†–û–î–£–ö–¢–û–í

## –ü—Ä–æ–±–ª–µ–º–∞
–í Supabase –∑–∞–ø–∏—Å–∞–Ω **–ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤** `[]` –¥–ª—è `heys_products`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ç–∏—Ä–∞–µ—Ç –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º hard reload.

## ‚úÖ –ß—Ç–æ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–∫–æ–¥)

1. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏ –ø—É—Å—Ç—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤** –≤ Supabase (—Å—Ç—Ä–æ–∫–∞ 607 –≤ `heys_storage_supabase_v1.js`)
2. **–ê–≤—Ç–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup** –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∞ 424)
3. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏** –Ω–µ–ø—É—Å—Ç—ã—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å—Ç—Ä–æ–∫–∞ 419)

## üõ†Ô∏è –°–†–û–ß–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å backup –≤ browser console

```javascript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º backup
const backupKey = 'heys_73a55ec7-2b48-47de-8308-06d7bec4259a_products_backup';
const backup = JSON.parse(localStorage.getItem(backupKey));
console.log('Backup products:', backup ? backup.length : 'NOT FOUND');

// –ï—Å–ª–∏ backup –µ—Å—Ç—å - –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
if (backup && backup.length > 0) {
  localStorage.setItem('heys_73a55ec7-2b48-47de-8308-06d7bec4259a_products', JSON.stringify(backup));
  console.log('‚úÖ Restored', backup.length, 'products from backup');
  location.reload();
}
```

### –®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç –∏–∑ JSON —Ñ–∞–π–ª–∞ (–µ—Å–ª–∏ –Ω–µ—Ç backup)

1. –ù–∞–∂–º–∏ F12 ‚Üí Console
2. –ü—Ä–æ–≤–µ—Ä—å –≤—Å–µ –∫–ª—é—á–∏ —Å backup:
```javascript
Object.keys(localStorage).filter(k => k.includes('backup') && k.includes('products'))
```

3. –ï—Å–ª–∏ –Ω–∞—à—ë–ª —Å—Ç–∞—Ä—ã–π backup - –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ:
```javascript
const oldBackup = 'heys_73a55ec7-2b48-47de-8308-06d7bec4259a_products_backup_backup'; // –ò—Å–ø–æ–ª—å–∑—É–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π –∫–ª—é—á
const data = JSON.parse(localStorage.getItem(oldBackup));
if (data && data.length > 0) {
  localStorage.setItem('heys_73a55ec7-2b48-47de-8308-06d7bec4259a_products', JSON.stringify(data));
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Supabase —á–µ—Ä–µ–∑ cloud API
  HEYS.cloud.saveClientKey('73a55ec7-2b48-47de-8308-06d7bec4259a', 'heys_products', data);
  console.log('‚úÖ Recovered', data.length, 'products and saved to Supabase');
}
```

### –®–∞–≥ 3: –†—É—á–Ω–æ–π –∏–º–ø–æ—Ä—Ç JSON (–ø–æ—Å–ª–µ–¥–Ω—è—è –Ω–∞–¥–µ–∂–¥–∞)

–ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON —Ñ–∞–π–ª:

1. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞–∂–º–∏ "–ò–º–ø–æ—Ä—Ç .json"
2. –í—ã–±–µ—Ä–∏ —Ñ–∞–π–ª
3. –ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ —Å—Ä–∞–∑—É —Å–¥–µ–ª–∞–π "–°–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø"

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```javascript
// –í browser console –≤—ã–ø–æ–ª–Ω–∏:
const clientId = '73a55ec7-2b48-47de-8308-06d7bec4259a';
const productsKey = `heys_${clientId}_products`;
const backupKey = `${productsKey}_backup`;

console.log('=== –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï ===');
console.log('Products:', JSON.parse(localStorage.getItem(productsKey) || '[]').length);
console.log('Backup:', JSON.parse(localStorage.getItem(backupKey) || '[]').length);

// –ò—â–µ–º –≤—Å–µ backup'—ã
const allBackups = Object.keys(localStorage)
  .filter(k => k.includes(clientId) && k.includes('products'))
  .map(k => ({
    key: k,
    length: JSON.parse(localStorage.getItem(k) || '[]').length
  }));
console.table(allBackups);
```

## ‚öôÔ∏è –ü–æ—á–µ–º—É —ç—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å

1. **Race condition**: –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `products` —Å—Ç–µ–π—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `[]`
2. **useEffect —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç** –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `bootstrapClientSync`
3. **–ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è** –≤ Supabase, –∑–∞—Ç–∏—Ä–∞—è —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
4. **–ü—Ä–∏ –∫–∞–∂–¥–æ–º reload** –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∏–∑ Supabase –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## üõ°Ô∏è –ß—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç —Ç–µ–ø–µ—Ä—å

1. ‚ùå **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞** –∑–∞–ø–∏—Å–∏ `[]` –≤ Supabase –¥–ª—è `heys_products`
2. ‚úÖ **–ê–≤—Ç–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –∏–∑ backup –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—É—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
3. üõ°Ô∏è **–ó–∞—â–∏—Ç–∞** –æ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –Ω–µ–ø—É—Å—Ç—ã—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç—ã–º cloud –º–∞—Å—Å–∏–≤–æ–º

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ products –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ UI
2. üîÑ –°–¥–µ–ª–∞—Ç—å manual backup —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–°–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø"
3. üíæ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å JSON —á–µ—Ä–µ–∑ "–≠–∫—Å–ø–æ—Ä—Ç .json" –¥–ª—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏
4. üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å hard reload (Cmd+Shift+R)
5. üîÄ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤

## üöÄ –ö–æ–º–º–∏—Ç –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
git add apps/web/heys_storage_supabase_v1.js EMERGENCY_RECOVERY_GUIDE.md
git commit -m "fix: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞—Ç–∏—Ä–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º

- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏ –ø—É—Å—Ç—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤ –≤ Supabase
- –ê–≤—Ç–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—É—Å—Ç–æ—Ç—ã
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –Ω–µ–ø—É—Å—Ç—ã—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é"
```
