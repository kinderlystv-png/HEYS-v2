<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HEYS System Comprehensive Test Suite</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #333;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        padding: 30px;
      }
      h1 {
        color: #4a5568;
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.5em;
      }
      .test-section {
        margin: 30px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #3182ce;
      }
      .test-item {
        margin: 15px 0;
        padding: 15px;
        background: white;
        border-radius: 6px;
        border: 1px solid #e2e8f0;
      }
      .status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-weight: bold;
        font-size: 12px;
      }
      .status.success {
        background: #c6f6d5;
        color: #22543d;
      }
      .status.error {
        background: #fed7d7;
        color: #742a2a;
      }
      .status.warning {
        background: #fefcbf;
        color: #744210;
      }
      .status.loading {
        background: #bee3f8;
        color: #2a4365;
      }
      .test-name {
        font-weight: bold;
        color: #2d3748;
        margin-bottom: 8px;
      }
      .test-result {
        margin: 8px 0;
        font-family: 'Courier New', monospace;
        font-size: 14px;
      }
      .button {
        background: #3182ce;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
        transition: background 0.3s;
      }
      .button:hover {
        background: #2c5282;
      }
      .button.success {
        background: #38a169;
      }
      .button.error {
        background: #e53e3e;
      }
      .metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }
      .metric-card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .metric-value {
        font-size: 2em;
        font-weight: bold;
        color: #3182ce;
      }
      .metric-label {
        color: #718096;
        font-size: 14px;
      }
      .log-output {
        background: #1a202c;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 6px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
        margin: 15px 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ HEYS System Comprehensive Test Suite</h1>

      <div class="metrics" id="metricsPanel">
        <div class="metric-card">
          <div class="metric-value" id="totalTests">0</div>
          <div class="metric-label">Total Tests</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="passedTests">0</div>
          <div class="metric-label">Passed</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="failedTests">0</div>
          <div class="metric-label">Failed</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="testProgress">0%</div>
          <div class="metric-label">Progress</div>
        </div>
      </div>

      <div style="text-align: center; margin: 20px 0">
        <button class="button" onclick="runAllTests()">üöÄ Run All Tests</button>
        <button class="button" onclick="runDiagnostics()">üîç Run Diagnostics</button>
        <button class="button" onclick="clearLogs()">üßπ Clear Logs</button>
      </div>

      <div class="test-section">
        <h2>üìä Smart Search Engine Tests</h2>
        <div class="test-item" id="smartSearchTest">
          <div class="test-name">HEYS.SmartSearchEngine</div>
          <div class="status loading">WAITING</div>
          <div class="test-result" id="smartSearchResult"></div>
        </div>
      </div>

      <div class="test-section">
        <h2>üîó Integration Layer Tests</h2>
        <div class="test-item" id="integrationTest">
          <div class="test-name">HEYS.IntegrationLayer</div>
          <div class="status loading">WAITING</div>
          <div class="test-result" id="integrationResult"></div>
        </div>
      </div>

      <div class="test-section">
        <h2>üìà Reports Manager Tests</h2>
        <div class="test-item" id="reportsTest">
          <div class="test-name">HEYS.ReportsManager</div>
          <div class="status loading">WAITING</div>
          <div class="test-result" id="reportsResult"></div>
        </div>
      </div>

      <div class="test-section">
        <h2>üõ°Ô∏è Security & Validation Tests</h2>
        <div class="test-item" id="securityTest">
          <div class="test-name">HEYS.SecurityValidationManager</div>
          <div class="status loading">WAITING</div>
          <div class="test-result" id="securityResult"></div>
        </div>
      </div>

      <div class="test-section">
        <h2>üß™ Input Validation Logic Tests</h2>
        <div class="test-item" id="validationLogicTest">
          <div class="test-name">Input Validation Logic</div>
          <div class="status loading">WAITING</div>
          <div class="test-result" id="validationLogicResult"></div>
        </div>
      </div>

      <div class="test-section">
        <h2>üîí Security Headers Tests</h2>
        <div class="test-item" id="securityHeadersTest">
          <div class="test-name">Security Headers Logic</div>
          <div class="status loading">WAITING</div>
          <div class="test-result" id="securityHeadersResult"></div>
        </div>
      </div>

      <div class="log-output" id="logOutput">
        <div>üìã Test logs will appear here...</div>
      </div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –º–æ–¥—É–ª–∏ HEYS -->
    <script src="heys_core_v12.js"></script>
    <script src="heys_smart_search.js"></script>
    <script src="heys_integration_layer.js"></script>
    <script src="heys_reports_v12.js"></script>
    <script src="heys_security_validation.js"></script>

    <script>
      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      let testResults = {
        total: 0,
        passed: 0,
        failed: 0,
      };

      let testStartTime = 0;

      /**
       * –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å —Ç–µ—Å—Ç–æ–≤
       */
      function logTest(message, type = 'info') {
        const logOutput = document.getElementById('logOutput');
        const timestamp = new Date().toLocaleTimeString();
        const emoji = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : 'üìù';

        const logEntry = document.createElement('div');
        logEntry.innerHTML = `[${timestamp}] ${emoji} ${message}`;
        logOutput.appendChild(logEntry);
        logOutput.scrollTop = logOutput.scrollHeight;

        console.log(`[HEYS-TEST] ${message}`);
      }

      /**
       * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ —Ç–µ—Å—Ç–æ–≤
       */
      function updateMetrics() {
        document.getElementById('totalTests').textContent = testResults.total;
        document.getElementById('passedTests').textContent = testResults.passed;
        document.getElementById('failedTests').textContent = testResults.failed;

        const progress =
          testResults.total > 0
            ? Math.round(((testResults.passed + testResults.failed) / testResults.total) * 100)
            : 0;
        document.getElementById('testProgress').textContent = progress + '%';
      }

      /**
       * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç–µ—Å—Ç–∞
       */
      function updateTestStatus(testId, status, result) {
        const testElement = document.getElementById(testId);
        const statusElement = testElement.querySelector('.status');
        const resultElement = testElement.querySelector('.test-result');

        statusElement.className = `status ${status}`;
        statusElement.textContent = status.toUpperCase();

        if (result) {
          resultElement.innerHTML = result;
        }
      }

      /**
       * –¢–µ—Å—Ç Smart Search Engine
       */
      async function testSmartSearchEngine() {
        logTest('Testing Smart Search Engine...');
        testResults.total++;

        try {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª–∞—Å—Å–∞
          if (typeof window.HEYS === 'undefined' || !window.HEYS.SmartSearchEngine) {
            throw new Error('HEYS.SmartSearchEngine –Ω–µ –Ω–∞–π–¥–µ–Ω');
          }

          // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä
          const searchEngine = new window.HEYS.SmartSearchEngine({
            language: 'ru',
            fuzzySearch: true,
          });

          // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é
          const testData = [
            { id: 1, title: '–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å', content: '–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è –ø–æ–∏—Å–∫–∞' },
            { id: 2, title: '–î—Ä—É–≥–∞—è –∑–∞–ø–∏—Å—å', content: '–ï—â—ë –æ–¥–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ' },
          ];

          await searchEngine.indexData(testData);

          // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫
          const searchResults = searchEngine.search('—Ç–µ—Å—Ç');

          if (searchResults.length === 0) {
            throw new Error('–ü–æ–∏—Å–∫ –Ω–µ –≤–µ—Ä–Ω—É–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤');
          }

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç—Ä–∏–∫–∏
          const metrics = searchEngine.getMetrics();
          if (!metrics.totalDocuments || metrics.totalDocuments !== 2) {
            throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏');
          }

          updateTestStatus(
            'smartSearchTest',
            'success',
            `‚úÖ –ü—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–æ: ${metrics.totalDocuments} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤<br>` +
              `üîç –ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${searchResults.length}<br>` +
              `üìä –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤: ${metrics.uniqueTerms}`,
          );

          testResults.passed++;
          logTest('Smart Search Engine test PASSED', 'success');
        } catch (error) {
          updateTestStatus('smartSearchTest', 'error', `‚ùå ${error.message}`);
          testResults.failed++;
          logTest(`Smart Search Engine test FAILED: ${error.message}`, 'error');
        }
      }

      /**
       * –¢–µ—Å—Ç Integration Layer
       */
      async function testIntegrationLayer() {
        logTest('Testing Integration Layer...');
        testResults.total++;

        try {
          if (typeof window.HEYS === 'undefined' || !window.HEYS.IntegrationLayer) {
            throw new Error('HEYS.IntegrationLayer –Ω–µ –Ω–∞–π–¥–µ–Ω');
          }

          const integrationLayer = new window.HEYS.IntegrationLayer({
            enableLogging: true,
            enableMetrics: true,
          });

          // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É —Å–µ—Ä–≤–∏—Å—É
          const connectionResult = await integrationLayer.connectAPI('rest', {
            baseURL: 'https://jsonplaceholder.typicode.com',
            headers: { 'Content-Type': 'application/json' },
          });

          if (!connectionResult.connectionId) {
            throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ');
          }

          // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
          const connections = integrationLayer.getConnections();
          if (connections.total === 0) {
            throw new Error('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
          }

          // –¢–µ—Å—Ç–∏—Ä—É–µ–º –º–µ—Ç—Ä–∏–∫–∏
          const metrics = integrationLayer.getMetrics();

          updateTestStatus(
            'integrationTest',
            'success',
            `‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π: ${connections.active}<br>` +
              `üîó ID –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${connectionResult.connectionId}<br>` +
              `üìä –°–µ—Ä–≤–∏—Å: ${connectionResult.service}`,
          );

          testResults.passed++;
          logTest('Integration Layer test PASSED', 'success');
        } catch (error) {
          updateTestStatus('integrationTest', 'error', `‚ùå ${error.message}`);
          testResults.failed++;
          logTest(`Integration Layer test FAILED: ${error.message}`, 'error');
        }
      }

      /**
       * –¢–µ—Å—Ç Reports Manager
       */
      async function testReportsManager() {
        logTest('Testing Reports Manager...');
        testResults.total++;

        try {
          if (typeof window.HEYS === 'undefined' || !window.HEYS.ReportsManager) {
            throw new Error('HEYS.ReportsManager –Ω–µ –Ω–∞–π–¥–µ–Ω');
          }

          const reportsManager = window.HEYS.ReportsManager;

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
          const requiredMethods = ['invalidateCache', 'getDayData', 'getWeekData', 'clearAllCache'];
          const missingMethods = requiredMethods.filter(
            (method) => typeof reportsManager[method] !== 'function',
          );

          if (missingMethods.length > 0) {
            throw new Error(`–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –º–µ—Ç–æ–¥—ã: ${missingMethods.join(', ')}`);
          }

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ReportsTab
          if (!reportsManager.ReportsTab) {
            throw new Error('ReportsTab –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
          }

          updateTestStatus(
            'reportsTest',
            'success',
            `‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã: ${requiredMethods.length}<br>` +
              `üìä ReportsTab –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: –ù–∞–π–¥–µ–Ω<br>` +
              `üîß –≠–∫—Å–ø–æ—Ä—Ç –≤ namespace: –ö–æ—Ä—Ä–µ–∫—Ç–µ–Ω`,
          );

          testResults.passed++;
          logTest('Reports Manager test PASSED', 'success');
        } catch (error) {
          updateTestStatus('reportsTest', 'error', `‚ùå ${error.message}`);
          testResults.failed++;
          logTest(`Reports Manager test FAILED: ${error.message}`, 'error');
        }
      }

      /**
       * –¢–µ—Å—Ç Security & Validation Manager
       */
      async function testSecurityValidationManager() {
        logTest('Testing Security & Validation Manager...');
        testResults.total++;

        try {
          if (typeof window.HEYS === 'undefined' || !window.HEYS.SecurityValidationManager) {
            throw new Error('HEYS.SecurityValidationManager –Ω–µ –Ω–∞–π–¥–µ–Ω');
          }

          const securityManager = new window.HEYS.SecurityValidationManager({
            enableStrictMode: true,
            enableLogging: true,
          });

          // –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é email
          const emailTest = securityManager.validateInput('test@example.com', 'email');
          if (!emailTest.valid) {
            throw new Error('Email –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç');
          }

          // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é HTML
          const htmlTest = securityManager.sanitizeHtml(
            '&lt;script&gt;alert("xss")&lt;/script&gt;',
          );
          if (htmlTest.includes('&lt;script&gt;')) {
            throw new Error('HTML —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç');
          }

          // –¢–µ—Å—Ç–∏—Ä—É–µ–º XSS –¥–µ—Ç–µ–∫—Ü–∏—é
          const xssTest = securityManager.checkXSS('&lt;script&gt;alert("test")&lt;/script&gt;');
          if (xssTest.safe) {
            throw new Error('XSS –¥–µ—Ç–µ–∫—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç');
          }

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
          const integrityCheck = securityManager.runIntegrityCheck();
          if (!integrityCheck.passed) {
            throw new Error('Integrity check –Ω–µ –ø—Ä–æ—à–µ–ª');
          }

          updateTestStatus(
            'securityTest',
            'success',
            `‚úÖ Email –≤–∞–ª–∏–¥–∞—Ü–∏—è: –†–∞–±–æ—Ç–∞–µ—Ç<br>` +
              `üßº HTML —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è: –†–∞–±–æ—Ç–∞–µ—Ç<br>` +
              `üõ°Ô∏è XSS –¥–µ—Ç–µ–∫—Ü–∏—è: –†–∞–±–æ—Ç–∞–µ—Ç<br>` +
              `üîç Integrity check: –ü—Ä–æ–π–¥–µ–Ω`,
          );

          testResults.passed++;
          logTest('Security & Validation Manager test PASSED', 'success');
        } catch (error) {
          updateTestStatus('securityTest', 'error', `‚ùå ${error.message}`);
          testResults.failed++;
          logTest(`Security & Validation Manager test FAILED: ${error.message}`, 'error');
        }
      }

      /**
       * –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
       */
      async function testValidationLogic() {
        logTest('Testing Input Validation Logic...');
        testResults.total++;

        try {
          const securityManager = new window.HEYS.SecurityValidationManager();

          const testCases = [
            // Email –≤–∞–ª–∏–¥–∞—Ü–∏—è
            { value: 'valid@email.com', type: 'email', shouldPass: true },
            { value: 'invalid-email', type: 'email', shouldPass: false },
            { value: null, type: 'email', shouldPass: false },

            // URL –≤–∞–ª–∏–¥–∞—Ü–∏—è
            { value: 'https://example.com', type: 'url', shouldPass: true },
            { value: 'invalid-url', type: 'url', shouldPass: false },
            { value: 'javascript:alert(1)', type: 'url', shouldPass: false },

            // Number –≤–∞–ª–∏–¥–∞—Ü–∏—è
            { value: '123.45', type: 'number', args: [0, 1000], shouldPass: true },
            { value: 'not-a-number', type: 'number', shouldPass: false },
            { value: '2000', type: 'number', args: [0, 1000], shouldPass: false },

            // Password –≤–∞–ª–∏–¥–∞—Ü–∏—è
            { value: 'ValidPass123', type: 'password', shouldPass: true },
            { value: '123', type: 'password', shouldPass: false },
            { value: 'onlyletters', type: 'password', shouldPass: false },
          ];

          let passedCases = 0;
          let totalCases = testCases.length;

          for (const testCase of testCases) {
            const result = securityManager.validateInput(
              testCase.value,
              testCase.type,
              ...(testCase.args || []),
            );

            if (result.valid === testCase.shouldPass) {
              passedCases++;
            } else {
              logTest(`Validation logic failed for ${testCase.type}: ${testCase.value}`, 'error');
            }
          }

          if (passedCases !== totalCases) {
            throw new Error(`–ü—Ä–æ–≤–∞–ª–µ–Ω–æ ${totalCases - passedCases} –∏–∑ ${totalCases} —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤`);
          }

          updateTestStatus(
            'validationLogicTest',
            'success',
            `‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: ${passedCases}/${totalCases}<br>` +
              `üìß Email –≤–∞–ª–∏–¥–∞—Ü–∏—è: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞<br>` +
              `üîó URL –≤–∞–ª–∏–¥–∞—Ü–∏—è: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞<br>` +
              `üî¢ Number –≤–∞–ª–∏–¥–∞—Ü–∏—è: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞<br>` +
              `üîë Password –≤–∞–ª–∏–¥–∞—Ü–∏—è: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞`,
          );

          testResults.passed++;
          logTest('Input Validation Logic test PASSED', 'success');
        } catch (error) {
          updateTestStatus('validationLogicTest', 'error', `‚ùå ${error.message}`);
          testResults.failed++;
          logTest(`Input Validation Logic test FAILED: ${error.message}`, 'error');
        }
      }

      /**
       * –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
       */
      async function testSecurityHeaders() {
        logTest('Testing Security Headers Logic...');
        testResults.total++;

        try {
          const securityManager = new window.HEYS.SecurityValidationManager();

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
          const headers = securityManager.applySecurityHeaders();

          const requiredHeaders = [
            'Content-Security-Policy',
            'X-Content-Type-Options',
            'X-Frame-Options',
            'X-XSS-Protection',
            'Referrer-Policy',
          ];

          const missingHeaders = requiredHeaders.filter((header) => !headers.has(header));

          if (missingHeaders.length > 0) {
            throw new Error(`–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏: ${missingHeaders.join(', ')}`);
          }

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å CSP
          const csp = headers.get('Content-Security-Policy');
          if (!csp.includes("default-src 'self'")) {
            throw new Error('CSP –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω');
          }

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º X-Frame-Options
          const frameOptions = headers.get('X-Frame-Options');
          if (frameOptions !== 'DENY') {
            throw new Error('X-Frame-Options –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω');
          }

          updateTestStatus(
            'securityHeadersTest',
            'success',
            `‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ: ${headers.size}<br>` +
              `üîí CSP: –ö–æ—Ä—Ä–µ–∫—Ç–µ–Ω<br>` +
              `üö´ X-Frame-Options: DENY<br>` +
              `üõ°Ô∏è XSS Protection: –í–∫–ª—é—á–µ–Ω–∞<br>` +
              `üìã –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏: –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç`,
          );

          testResults.passed++;
          logTest('Security Headers Logic test PASSED', 'success');
        } catch (error) {
          updateTestStatus('securityHeadersTest', 'error', `‚ùå ${error.message}`);
          testResults.failed++;
          logTest(`Security Headers Logic test FAILED: ${error.message}`, 'error');
        }
      }

      /**
       * –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
       */
      async function runAllTests() {
        logTest('üöÄ Starting comprehensive test suite...');
        testStartTime = Date.now();

        // –°–±—Ä–æ—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        testResults = { total: 0, passed: 0, failed: 0 };
        updateMetrics();

        // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
        await testSmartSearchEngine();
        updateMetrics();

        await testIntegrationLayer();
        updateMetrics();

        await testReportsManager();
        updateMetrics();

        await testSecurityValidationManager();
        updateMetrics();

        await testValidationLogic();
        updateMetrics();

        await testSecurityHeaders();
        updateMetrics();

        const testDuration = Date.now() - testStartTime;
        const successRate = Math.round((testResults.passed / testResults.total) * 100);

        logTest(`üèÅ Test suite completed in ${testDuration}ms`);
        logTest(`üìä Results: ${testResults.passed}/${testResults.total} passed (${successRate}%)`);

        if (testResults.failed === 0) {
          logTest('üéâ All tests PASSED! HEYS system is healthy.', 'success');
        } else {
          logTest(`‚ö†Ô∏è ${testResults.failed} tests FAILED. Review errors above.`, 'error');
        }
      }

      /**
       * –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
       */
      async function runDiagnostics() {
        logTest('üîç Running system diagnostics...');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º HEYS namespace
        if (typeof window.HEYS === 'undefined') {
          logTest('‚ùå HEYS namespace –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
          return;
        }

        logTest('‚úÖ HEYS namespace –Ω–∞–π–¥–µ–Ω', 'success');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –º–æ–¥—É–ª–∏
        const modules = [
          'SmartSearchEngine',
          'IntegrationLayer',
          'ReportsManager',
          'SecurityValidationManager',
        ];

        modules.forEach((module) => {
          if (window.HEYS[module]) {
            logTest(`‚úÖ ${module}: –ó–∞–≥—Ä—É–∂–µ–Ω`, 'success');
          } else {
            logTest(`‚ùå ${module}: –ù–µ –Ω–∞–π–¥–µ–Ω`, 'error');
          }
        });

        logTest('üîç Diagnostics completed');
      }

      /**
       * –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
       */
      function clearLogs() {
        document.getElementById('logOutput').innerHTML = '<div>üìã Test logs cleared...</div>';
      }

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      window.addEventListener('load', () => {
        setTimeout(runDiagnostics, 1000);
      });
    </script>
  </body>
</html>
