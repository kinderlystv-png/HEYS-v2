# HEYS MVP ‚Äî –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏

> –û–±–Ω–æ–≤–ª–µ–Ω–æ: 2025-12-22

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å (–±–ª–æ–∫–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞)

### 1. ‚è∏Ô∏è –ü–ª–∞—Ç–µ–∂–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∏ ‚Äî –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û
**–§–∞–π–ª**: [2025-12-20-payments-yukassa.md](./docs/tasks/2025-12-20-payments-yukassa.md)  
**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –ö–æ–¥ –≥–æ—Ç–æ–≤, –Ω–æ –ÆKassa —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–±–æ—á–∏–π —Å–∞–π—Ç –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–¶–µ–ø–æ—á–∫–∞ –±–ª–æ–∫–µ—Ä–æ–≤:**
```
DNS TXT –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –õ–µ–Ω–¥–∏–Ω–≥ heyslab.ru ‚Üí –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ÆKassa ‚Üí –î–µ–ø–ª–æ–π –ø–ª–∞—Ç–µ–∂–µ–π
        ‚è≥ –∂–¥—ë–º              ‚è∏Ô∏è                    ‚è∏Ô∏è                  ‚è∏Ô∏è
```

**–ë–ª–æ–∫–µ—Ä:** –ÆKassa —Ç—Ä–µ–±—É–µ—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
- –†–∞–±–æ—á–∏–π —Å–∞–π—Ç —Å —Ç–æ–≤–∞—Ä–∞–º–∏/—É—Å–ª—É–≥–∞–º–∏ –∏ —Ü–µ–Ω–∞–º–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ/–æ—Ñ–µ—Ä—Ç—É
- –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã (–ò–ù–ù/–û–ì–†–ù–ò–ü)
- ‚Üí –ù—É–∂–µ–Ω –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –ª–µ–Ω–¥–∏–Ω–≥ heyslab.ru —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏!

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ (–∫–æ–¥):**
- [x] Cloud Function `heys-api-payments` (index.js + package.json)
- [x] YandexAPI –º–µ—Ç–æ–¥—ã: `createPayment()`, `getPaymentStatus()`
- [x] handlePayment() ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ÆKassa
- [x] checkPendingPayment(), waitForPayment() ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
- [x] API Gateway —Ä–æ—É—Ç—ã: /payments, /payments/create, /payments/webhook, /payments/status
- [x] DEPLOY.md –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

**–ü–æ—Å–ª–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –ÆKassa (–Ω—É–∂–µ–Ω shopId + secretKey)
- [ ] –î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–∏: `yc serverless function version create`
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `${PAYMENTS_FUNCTION_ID}` –≤ api-gateway-spec-v2.yaml
- [ ] –û–±–Ω–æ–≤–∏—Ç—å API Gateway
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –≤ –ÆKassa
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ sandbox

### 2. –¢—Ä–∏–∞–ª-–º–∞—à–∏–Ω–∞ (–ø–æ—Å–ª–µ –ø–ª–∞—Ç–µ–∂–µ–π)
**–û–ø–∏—Å–∞–Ω–∏–µ**: 7 –¥–Ω–µ–π —Ç—Ä–∏–∞–ª–∞ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ ‚úÖ, —Å–æ—Å—Ç–æ—è–Ω–∏—è trial ‚Üí active/read_only  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –ü–ª–∞—Ç–µ–∂–∏  
**–í—Ä–µ–º—è**: ~2-3 —á–∞—Å–∞

### 3. Read-only —Ä–µ–∂–∏–º (–ø–æ—Å–ª–µ —Ç—Ä–∏–∞–ª–∞)
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ì–µ–π—Ç–∏–Ω–≥ –ø–æ—Å–ª–µ –Ω–µ–æ–ø–ª–∞—Ç—ã, –±–∞–Ω–Ω–µ—Ä, –∑–∞–ø—Ä–µ—Ç POST  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –ü–ª–∞—Ç–µ–∂–∏, –¢—Ä–∏–∞–ª  
**–í—Ä–µ–º—è**: ~2 —á–∞—Å–∞

---

## üü° –í–∞–∂–Ω–æ–µ (–ø–æ—Å–ª–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—É—Ç–∏)

### 4. ‚úÖ RU –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (152-–§–ó) ‚Äî –í–´–ü–û–õ–ù–ï–ù–û
**–û–ø–∏—Å–∞–Ω–∏–µ**: PostgreSQL –Ω–∞ Yandex.Cloud, Cloud Functions

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

- [x] SMS.ru –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å "HEYS" —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] SMS –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ API server (CORS bypass)
- [x] –Æ—Ä–∏–¥–∏–∫–∞ ‚Äî —Å–æ–≥–ª–∞—Å–∏—è, –ü–≠–ü, SMS –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- [x] Landing page ‚Äî —Ñ–æ—Ä–º–∞, Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [x] Yandex Cloud PostgreSQL ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- [x] Cloud Functions ‚Äî RPC, REST, SMS, Leads, Health, Auth
- [x] **–ü–ª–∞—Ç–µ–∂–∏ –∫–æ–¥** ‚Äî Cloud Function + Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [x] **Consents RPC** ‚Äî 4 —Ñ—É–Ω–∫—Ü–∏–∏ (log, check, revoke, get) —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] **–ü–ª–∞—Ç–µ–∂–∏ –¥–µ–ø–ª–æ–π** ‚Äî ‚è∏Ô∏è –∂–¥—ë–º —Ä–∞–±–æ—á–∏–π —Å–∞–π—Ç –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ÆKassa

---

## üìã –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–±–æ—Ç—ã

```
1. ‚úÖ –ü–ª–∞—Ç–µ–∂–∏ (–ÆKassa) ‚Äî –ö–û–î –ì–û–¢–û–í
   ‚Üì
2. üîÑ –î–µ–ø–ª–æ–π heys-api-payments ‚Üê –°–ï–ô–ß–ê–°
   ‚Üì
3. –¢—Ä–∏–∞–ª-–º–∞—à–∏–Ω–∞
   ‚Üì
4. Read-only —Ä–µ–∂–∏–º
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –ø–ª–∞—Ç–µ–∂–µ–π

```bash
cd yandex-cloud-functions/heys-api-payments
npm install && zip -r ../heys-api-payments.zip .

yc serverless function create --name=heys-api-payments

yc serverless function version create \
  --function-name=heys-api-payments \
  --runtime=nodejs18 \
  --entrypoint=index.handler \
  --memory=128m \
  --execution-timeout=10s \
  --source-path=../heys-api-payments.zip \
  --environment "PG_HOST=...,YUKASSA_SHOP_ID=...,YUKASSA_SECRET_KEY=..."

# –ü–æ–ª—É—á–∏—Ç—å ID
yc serverless function get --name=heys-api-payments --format=json | jq -r '.id'
```
