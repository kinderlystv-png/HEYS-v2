<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –º–æ–¥—É–ª–µ–π HEYS</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-section { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; }
        .status { padding: 10px; margin: 5px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        input { padding: 10px; width: 300px; margin: 10px 0; border: 2px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        #search-results { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 4px; min-height: 100px; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è */
        .console-log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        
        .log-controls {
            margin: 10px 0;
            text-align: center;
        }
        
        .copy-button {
            background: #28a745;
            margin-right: 10px;
        }
        
        .copy-button:hover {
            background: #1e7e34;
        }
        
        .clear-button {
            background: #dc3545;
        }
        
        .clear-button:hover {
            background: #bd2130;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º —Å–ø–∏—Å–∫–æ–º */
        .search-container {
            position: relative;
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .search-container input {
            flex: 1;
        }
        
        .dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .dropdown.show {
            display: block;
        }
        
        .dropdown-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }
        
        .dropdown-item:hover,
        .dropdown-item.selected {
            background-color: #f8f9fa;
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
        
        .match-type {
            font-size: 0.8em;
            color: #666;
            margin-left: 5px;
        }
        
        .match-type.exact {
            color: #28a745;
        }
        
        .match-type.typo {
            color: #fd7e14;
        }
        
        .match-type.synonym {
            color: #007bff;
        }
        
        .match-type.phonetic {
            color: #6f42c1;
        }
        
        .relevance-score {
            float: right;
            font-size: 0.7em;
            color: #999;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –º–æ–¥—É–ª–µ–π HEYS</h1>
    
    <div class="test-section">
        <h3>üìã –°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π</h3>
        <div id="module-status"></div>
    </div>
    
    <div class="test-section">
        <h3>üîç –¢–µ—Å—Ç —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞</h3>
        <div class="search-container">
            <input type="text" id="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä: –º–æ–ª–∞, —Ö–ª–µ–ø, –∫—É—Ä—è—Ç–∏–Ω–∞)" autocomplete="off">
            <div class="dropdown" id="search-dropdown"></div>
            <button onclick="testSearch()">–ü–æ–∏—Å–∫</button>
            <button onclick="clearSearch()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
        <div id="search-results">–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞...</div>
    </div>
    
    <div class="test-section">
        <h3>üõ°Ô∏è –¢–µ—Å—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫</h3>
        <button onclick="testError()">–í—ã–∑–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –æ—à–∏–±–∫—É</button>
        <div id="error-results"></div>
    </div>
    
    <div class="test-section">
        <h3>üìã –õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤</h3>
        <div class="log-controls">
            <button class="copy-button" onclick="copyLog()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥</button>
            <button class="clear-button" onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
        <div id="console-log" class="console-log">–õ–æ–≥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è...</div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π -->
    <script src="../heys_advanced_error_tracker_v1.js?v=4"></script>
    <script src="../heys_smart_search_with_typos_v1.js?v=4"></script>
    
    <script>
        // –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        let logMessages = [];
        const logDiv = document.getElementById('console-log');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#e2e8f0',
                success: '#68d391',
                warning: '#fbd38d',
                error: '#fc8181'
            };
            
            const logEntry = {
                timestamp: timestamp,
                message: message,
                type: type,
                raw: `[${timestamp}] ${message}`
            };
            
            logMessages.push(logEntry);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ DOM
            const div = document.createElement('div');
            div.style.color = colors[type] || colors.info;
            div.style.marginBottom = '2px';
            div.textContent = logEntry.raw;
            
            if (logDiv) {
                logDiv.appendChild(div);
                logDiv.scrollTop = logDiv.scrollHeight;
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ DOM
                while (logDiv.children.length > 100) {
                    logDiv.removeChild(logDiv.firstChild);
                }
            }
            
            // –¢–∞–∫–∂–µ –¥—É–±–ª–∏—Ä—É–µ–º –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞
            const consoleMethod = type === 'error' ? 'error' : type === 'warning' ? 'warn' : 'log';
            console[consoleMethod](`[–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê] ${message}`);
        }
        
        function copyLog() {
            const logText = logMessages.map(entry => entry.raw).join('\n');
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(logText).then(() => {
                    addLog('üìã –õ–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
                }).catch(err => {
                    addLog('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err.message, 'error');
                });
            } else {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const textArea = document.createElement('textarea');
                textArea.value = logText;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    addLog('üìã –õ–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ (fallback)', 'success');
                } catch (err) {
                    addLog('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err.message, 'error');
                }
                document.body.removeChild(textArea);
            }
        }
        
        function clearLog() {
            logMessages = [];
            if (logDiv) {
                logDiv.innerHTML = '';
            }
            addLog('üßπ –õ–æ–≥ –æ—á–∏—â–µ–Ω', 'info');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∫–æ–Ω—Å–æ–ª–∏
        function setupConsoleInterception() {
            // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
            const originalConsoleLog = console.log;
            const originalConsoleError = console.error;
            const originalConsoleWarn = console.warn;
            
            console.log = function(...args) {
                originalConsoleLog.apply(console, args);
                const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg)).join(' ');
                if (message.includes('[–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê]')) return; // –ò–∑–±–µ–≥–∞–µ–º —Ä–µ–∫—É—Ä—Å–∏–∏
                addLog(message, 'info');
            };
            
            console.error = function(...args) {
                originalConsoleError.apply(console, args);
                const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg)).join(' ');
                if (message.includes('[–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê]')) return;
                addLog(message, 'error');
            };
            
            console.warn = function(...args) {
                originalConsoleWarn.apply(console, args);
                const message = args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : String(arg)).join(' ');
                if (message.includes('[–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê]')) return;
                addLog(message, 'warning');
            };
        }

        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        const testProducts = [
            { id: 1, name: '–•–ª–µ–± –±–µ–ª—ã–π', category: '–•–ª–µ–±–æ–±—É–ª–æ—á–Ω—ã–µ' },
            { id: 2, name: '–ú–æ–ª–æ–∫–æ 3.2%', category: '–ú–æ–ª–æ—á–Ω—ã–µ' },
            { id: 3, name: '–ö—É—Ä–∏—Ü–∞ —Ñ–∏–ª–µ', category: '–ú—è—Å–Ω—ã–µ' },
            { id: 4, name: '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å', category: '–û–≤–æ—â–∏' },
            { id: 5, name: '–Ø–±–ª–æ–∫–∏', category: '–§—Ä—É–∫—Ç—ã' },
            { id: 6, name: '–ú–æ–ª–æ–∫–æ –æ–±–µ–∑–∂–∏—Ä–µ–Ω–Ω–æ–µ', category: '–ú–æ–ª–æ—á–Ω—ã–µ' },
            { id: 7, name: '–ú–æ–ª–∞ (–ø—Ä–∏–ø—Ä–∞–≤–∞)', category: '–°–ø–µ—Ü–∏–∏' },
            { id: 8, name: '–ú–æ—Ä–∫–æ–≤—å', category: '–û–≤–æ—â–∏' },
            { id: 9, name: '–ú—É–∫–∞ –ø—à–µ–Ω–∏—á–Ω–∞—è', category: '–ë–∞–∫–∞–ª–µ—è' },
            { id: 10, name: '–ú–∞–∫–∞—Ä–æ–Ω—ã', category: '–ë–∞–∫–∞–ª–µ—è' }
        ];

        function checkModules() {
            addLog('üîç –ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥—É–ª–µ–π...', 'info');
            
            const statusDiv = document.getElementById('module-status');
            let html = '';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ namespace
            if (typeof window.HEYS === 'object') {
                html += '<div class="status success">‚úÖ HEYS namespace: OK</div>';
                addLog('‚úÖ HEYS namespace: OK', 'success');
            } else {
                html += '<div class="status error">‚ùå HEYS namespace: –ù–ï –ù–ê–ô–î–ï–ù</div>';
                addLog('‚ùå HEYS namespace: –ù–ï –ù–ê–ô–î–ï–ù', 'error');
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
            if (window.HEYS && typeof window.HEYS.SmartSearchWithTypos === 'object') {
                html += '<div class="status success">‚úÖ SmartSearchWithTypos: OK</div>';
                addLog('‚úÖ SmartSearchWithTypos: –∑–∞–≥—Ä—É–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç–æ–¥—ã
                const methods = ['search', 'addCommonWords', 'addSynonyms', 'configure'];
                methods.forEach(method => {
                    if (typeof window.HEYS.SmartSearchWithTypos[method] === 'function') {
                        addLog(`  ‚úÖ –ú–µ—Ç–æ–¥ ${method}: –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    } else {
                        addLog(`  ‚ùå –ú–µ—Ç–æ–¥ ${method}: –ù–ï –ù–ê–ô–î–ï–ù`, 'error');
                    }
                });
            } else {
                html += '<div class="status error">‚ùå SmartSearchWithTypos: –ù–ï –ù–ê–ô–î–ï–ù</div>';
                addLog('‚ùå SmartSearchWithTypos: –ù–ï –ù–ê–ô–î–ï–ù', 'error');
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
            if (window.HEYS && typeof window.HEYS.AdvancedErrorTracker === 'object') {
                html += '<div class="status success">‚úÖ AdvancedErrorTracker: OK</div>';
                addLog('‚úÖ AdvancedErrorTracker: –∑–∞–≥—Ä—É–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç–æ–¥—ã
                const methods = ['logError', 'getErrorStats', 'exportErrors', 'clearErrors'];
                methods.forEach(method => {
                    if (typeof window.HEYS.AdvancedErrorTracker[method] === 'function') {
                        addLog(`  ‚úÖ –ú–µ—Ç–æ–¥ ${method}: –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    } else {
                        addLog(`  ‚ùå –ú–µ—Ç–æ–¥ ${method}: –ù–ï –ù–ê–ô–î–ï–ù`, 'error');
                    }
                });
            } else {
                html += '<div class="status error">‚ùå AdvancedErrorTracker: –ù–ï –ù–ê–ô–î–ï–ù</div>';
                addLog('‚ùå AdvancedErrorTracker: –ù–ï –ù–ê–ô–î–ï–ù', 'error');
            }
            
            // –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            const heysInfo = {
                type: typeof window.HEYS,
                exists: !!window.HEYS,
                properties: window.HEYS ? Object.keys(window.HEYS).length : 0,
                propertyNames: window.HEYS ? Object.keys(window.HEYS).join(', ') : '–Ω–µ—Ç'
            };
            
            addLog(`üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ HEYS:`, 'info');
            addLog(`  ‚Ä¢ typeof HEYS: ${heysInfo.type}`, 'info');
            addLog(`  ‚Ä¢ window.HEYS —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: ${heysInfo.exists}`, 'info');
            addLog(`  ‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–æ–π—Å—Ç–≤: ${heysInfo.properties}`, 'info');
            addLog(`  ‚Ä¢ –°–≤–æ–π—Å—Ç–≤–∞: ${heysInfo.propertyNames}`, 'info');
            
            html += `<div class="status warning">üìä –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
                <br>‚Ä¢ typeof HEYS: ${heysInfo.type}
                <br>‚Ä¢ window.HEYS: ${heysInfo.exists ? '—Å—É—â–µ—Å—Ç–≤—É–µ—Ç' : '–Ω–µ –Ω–∞–π–¥–µ–Ω'}
                <br>‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–æ–π—Å—Ç–≤: ${heysInfo.properties}
                <br>‚Ä¢ –°–≤–æ–π—Å—Ç–≤–∞: ${heysInfo.propertyNames}
            </div>`;
            
            statusDiv.innerHTML = html;
            addLog('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'info');
        }

        function testSearch() {
            const query = document.getElementById('search-input').value;
            const resultsDiv = document.getElementById('search-results');
            
            addLog(`üîç –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–∏—Å–∫–∞ —Å –∑–∞–ø—Ä–æ—Å–æ–º: "${query}"`, 'info');
            
            if (!query.trim()) {
                resultsDiv.innerHTML = '–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞...';
                addLog('‚ö†Ô∏è –ü—É—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å, —Ç–µ—Å—Ç –æ—Ç–º–µ–Ω–µ–Ω', 'warning');
                return;
            }
            
            try {
                if (!window.HEYS || !window.HEYS.SmartSearchWithTypos) {
                    resultsDiv.innerHTML = '<div class="status error">‚ùå –ú–æ–¥—É–ª—å SmartSearchWithTypos –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
                    addLog('‚ùå –ú–æ–¥—É–ª—å SmartSearchWithTypos –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                    return;
                }
                
                addLog('üì° –í—ã–∑–æ–≤ HEYS.SmartSearchWithTypos.search...', 'info');
                const startTime = performance.now();
                
                const result = window.HEYS.SmartSearchWithTypos.search(query, testProducts, {
                    debugMode: true,
                    limit: 5
                });
                
                const searchTime = performance.now() - startTime;
                addLog(`‚è±Ô∏è –ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω –∑–∞ ${searchTime.toFixed(2)}–º—Å`, 'info');
                addLog(`üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞: –Ω–∞–π–¥–µ–Ω–æ ${result.totalFound} –∏–∑ ${testProducts.length} –ø—Ä–æ–¥—É–∫—Ç–æ–≤`, 'success');
                
                if (result.corrections && result.corrections.length > 0) {
                    addLog(`üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—á–∞—Ç–æ–∫: ${result.corrections.length}`, 'info');
                    result.corrections.forEach(correction => {
                        addLog(`  ‚Ä¢ "${correction.original}" ‚Üí "${correction.corrected}" (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${(correction.confidence * 100).toFixed(1)}%)`, 'info');
                    });
                }
                
                if (result.suggestions && result.suggestions.length > 0) {
                    addLog(`üí° –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: ${result.suggestions.join(', ')}`, 'info');
                }
                
                addLog(`üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π:`, 'info');
                addLog(`  ‚Ä¢ –¢–æ—á–Ω—ã–µ: ${result.searchStats.exactMatches}`, 'info');
                addLog(`  ‚Ä¢ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ–ø–µ—á–∞—Ç–∫–∏: ${result.searchStats.typoMatches}`, 'info');
                addLog(`  ‚Ä¢ –°–∏–Ω–æ–Ω–∏–º—ã: ${result.searchStats.synonymMatches}`, 'info');
                addLog(`  ‚Ä¢ –§–æ–Ω–µ—Ç–∏—á–µ—Å–∫–∏–µ: ${result.searchStats.phoneticMatches}`, 'info');
                
                let html = `<strong>–ù–∞–π–¥–µ–Ω–æ: ${result.totalFound} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞ ${result.searchTime}–º—Å</strong><br><br>`;
                
                if (result.results.length === 0) {
                    html += '<div class="status warning">‚ö†Ô∏è –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    addLog('‚ö†Ô∏è –ü–æ–∏—Å–∫ –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤', 'warning');
                } else {
                    result.results.forEach((item, index) => {
                        html += `<div style="margin: 5px 0; padding: 8px; background: white; border-radius: 4px;">
                            <strong>${item.name}</strong> (${item.category})
                            <br><small>–¢–∏–ø: ${item.matchType}, –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: ${item.relevance}</small>
                        </div>`;
                        addLog(`  ${index + 1}. ${item.name} (${item.matchType}, —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: ${item.relevance})`, 'success');
                    });
                }
                
                if (result.corrections && result.corrections.length > 0) {
                    html += '<br><strong>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</strong><br>';
                    result.corrections.forEach(correction => {
                        html += `<span style="background: #ffeaa7; padding: 2px 6px; margin: 2px; border-radius: 3px;">
                            ${correction.original} ‚Üí ${correction.corrected}
                        </span> `;
                    });
                }
                
                if (result.suggestions && result.suggestions.length > 0) {
                    html += '<br><br><strong>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:</strong><br>';
                    result.suggestions.forEach(suggestion => {
                        html += `<span style="background: #d1ecf1; padding: 2px 6px; margin: 2px; border-radius: 3px;">
                            ${suggestion}
                        </span> `;
                    });
                }
                
                resultsDiv.innerHTML = html;
                addLog('‚úÖ –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–æ–∏—Å–∫–∞: ${error.message}`, 'error');
                addLog(`‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏: ${error.stack}`, 'error');
                resultsDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–∏—Å–∫–∞
        function clearSearch() {
            const searchInput = document.getElementById('search-input');
            const searchResults = document.getElementById('search-results');
            const dropdown = document.getElementById('search-dropdown');
            
            searchInput.value = '';
            searchResults.innerHTML = '–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞...';
            dropdown.classList.remove('show');
            dropdown.innerHTML = '';
            
            addLog('üßπ –ü–æ–∏—Å–∫ –æ—á–∏—â–µ–Ω', 'info');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
        function showDropdown(results, corrections, query) {
            const dropdown = document.getElementById('search-dropdown');
            
            if (results.length === 0 && corrections.length === 0) {
                dropdown.classList.remove('show');
                return;
            }
            
            let html = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—á–∞—Ç–æ–∫ –≤ –Ω–∞—á–∞–ª–æ
            corrections.forEach(correction => {
                html += `
                    <div class="dropdown-item" onclick="selectDropdownItem('${correction.corrected}', 'correction')">
                        <strong>${correction.corrected}</strong>
                        <span class="match-type typo">–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: "${correction.original}"</span>
                        <span class="relevance-score">${Math.round(correction.confidence * 100)}%</span>
                    </div>
                `;
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            results.forEach(item => {
                const matchTypeText = {
                    'exact': '—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ',
                    'typo': '–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–ø–µ—á–∞—Ç–∫–∞',
                    'synonym': '—Å–∏–Ω–æ–Ω–∏–º',
                    'phonetic': '—Ñ–æ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–µ'
                };
                
                html += `
                    <div class="dropdown-item" onclick="selectDropdownItem('${item.name}', 'result')">
                        <strong>${item.name}</strong>
                        <span class="match-type ${item.matchType}">${matchTypeText[item.matchType] || item.matchType}</span>
                        <span class="relevance-score">${Math.round(item.relevance)}</span>
                    </div>
                `;
            });
            
            dropdown.innerHTML = html;
            dropdown.classList.add('show');
            
            addLog(`üìã –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ–∫–∞–∑–∞–Ω: ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, ${corrections.length} –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π`, 'info');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
        function selectDropdownItem(text, type) {
            const searchInput = document.getElementById('search-input');
            const dropdown = document.getElementById('search-dropdown');
            
            searchInput.value = text;
            dropdown.classList.remove('show');
            
            addLog(`‚úÖ –í—ã–±—Ä–∞–Ω —ç–ª–µ–º–µ–Ω—Ç: "${text}" (—Ç–∏–ø: ${type})`, 'success');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫
            testSearch();
        }
        
        // –ñ–∏–≤–æ–π –ø–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
        function setupLiveSearch() {
            const searchInput = document.getElementById('search-input');
            let searchTimeout;
            let selectedIndex = -1;
            
            searchInput.addEventListener('input', function() {
                const query = this.value.trim();
                selectedIndex = -1; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –ø—Ä–∏ –Ω–æ–≤–æ–º –≤–≤–æ–¥–µ
                
                clearTimeout(searchTimeout);
                
                if (query.length < 2) {
                    document.getElementById('search-dropdown').classList.remove('show');
                    return;
                }
                
                // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
                searchTimeout = setTimeout(() => {
                    performLiveSearch(query);
                }, 300);
            });
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
            searchInput.addEventListener('keydown', function(e) {
                const dropdown = document.getElementById('search-dropdown');
                const items = dropdown.querySelectorAll('.dropdown-item');
                
                if (items.length === 0) return;
                
                switch(e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
                        updateSelection(items, selectedIndex);
                        break;
                        
                    case 'ArrowUp':
                        e.preventDefault();
                        selectedIndex = Math.max(selectedIndex - 1, -1);
                        updateSelection(items, selectedIndex);
                        break;
                        
                    case 'Enter':
                        e.preventDefault();
                        if (selectedIndex >= 0 && items[selectedIndex]) {
                            items[selectedIndex].click();
                        } else {
                            testSearch();
                        }
                        break;
                        
                    case 'Escape':
                        dropdown.classList.remove('show');
                        selectedIndex = -1;
                        break;
                }
            });
            
            // –°–∫—Ä—ã–≤–∞–µ–º dropdown –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.addEventListener('click', function(e) {
                const dropdown = document.getElementById('search-dropdown');
                const searchContainer = document.querySelector('.search-container');
                
                if (!searchContainer.contains(e.target)) {
                    dropdown.classList.remove('show');
                    selectedIndex = -1;
                }
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ
        function updateSelection(items, index) {
            items.forEach((item, i) => {
                item.classList.toggle('selected', i === index);
            });
        }
        
        // –ñ–∏–≤–æ–π –ø–æ–∏—Å–∫
        function performLiveSearch(query) {
            addLog(`üîÑ –ñ–∏–≤–æ–π –ø–æ–∏—Å–∫: "${query}"`, 'info');
            
            try {
                if (!window.HEYS || !window.HEYS.SmartSearchWithTypos) {
                    addLog('‚ùå –ú–æ–¥—É–ª—å SmartSearchWithTypos –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∂–∏–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞', 'error');
                    return;
                }
                
                const searchResult = window.HEYS.SmartSearchWithTypos.search(query, testProducts, {
                    enablePhonetic: true,
                    enableSynonyms: true,
                    maxSuggestions: 5
                });
                
                showDropdown(searchResult.results, searchResult.corrections, query);
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –∂–∏–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞: ${error.message}`, 'error');
            }
        }

        function testError() {
            const resultsDiv = document.getElementById('error-results');
            
            addLog('üõ°Ô∏è –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫...', 'info');
            
            try {
                if (!window.HEYS || !window.HEYS.AdvancedErrorTracker) {
                    resultsDiv.innerHTML = '<div class="status error">‚ùå –ú–æ–¥—É–ª—å AdvancedErrorTracker –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
                    addLog('‚ùå –ú–æ–¥—É–ª—å AdvancedErrorTracker –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –æ—à–∏–±–∫—É
                const testError = new Error('–¢–µ—Å—Ç–æ–≤–∞—è –æ—à–∏–±–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏');
                addLog('üìù –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –æ—à–∏–±–∫–∏...', 'info');
                
                window.HEYS.AdvancedErrorTracker.logError(testError, {
                    type: 'test',
                    additionalData: { 
                        demo: true, 
                        timestamp: Date.now(),
                        testId: 'module-test-' + Math.random().toString(36).substr(2, 9)
                    }
                });
                
                addLog('‚úÖ –û—à–∏–±–∫–∞ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º—É –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è', 'success');
                
                // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const stats = window.HEYS.AdvancedErrorTracker.getErrorStats();
                addLog('üìä –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—à–∏–±–æ–∫...', 'info');
                addLog(`  ‚Ä¢ –í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: ${stats.total}`, 'info');
                addLog(`  ‚Ä¢ –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å: ${stats.recentCount}`, 'info');
                
                if (stats.bySeverity && Object.keys(stats.bySeverity).length > 0) {
                    addLog('  ‚Ä¢ –ü–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏:', 'info');
                    Object.entries(stats.bySeverity).forEach(([severity, count]) => {
                        addLog(`    - ${severity}: ${count}`, 'info');
                    });
                }
                
                if (stats.byType && Object.keys(stats.byType).length > 0) {
                    addLog('  ‚Ä¢ –ü–æ —Ç–∏–ø–∞–º:', 'info');
                    Object.entries(stats.byType).forEach(([type, count]) => {
                        addLog(`    - ${type}: ${count}`, 'info');
                    });
                }
                
                resultsDiv.innerHTML = `
                    <div class="status success">‚úÖ –û—à–∏–±–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∞</div>
                    <div class="status warning">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫:
                        <br>‚Ä¢ –í—Å–µ–≥–æ: ${stats.total}
                        <br>‚Ä¢ –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å: ${stats.recentCount}
                        <br>‚Ä¢ –ü–æ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏: ${JSON.stringify(stats.bySeverity)}
                        <br>‚Ä¢ –ü–æ —Ç–∏–ø–∞–º: ${JSON.stringify(stats.byType)}
                    </div>
                `;
                
                addLog('‚úÖ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è: ${error.message}`, 'error');
                addLog(`‚ùå –°—Ç–µ–∫ –æ—à–∏–±–∫–∏: ${error.stack}`, 'error');
                resultsDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            addLog('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã...', 'info');
            addLog('üìã –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞', 'success');
            
            try {
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–µ—Ä–µ—Ö–≤–∞—Ç –∫–æ–Ω—Å–æ–ª–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
                setupConsoleInterception();
                addLog('üîß –ü–µ—Ä–µ—Ö–≤–∞—Ç –∫–æ–Ω—Å–æ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω', 'info');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å HEYS
                if (window.HEYS) {
                    addLog('‚úÖ –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω HEYS –¥–æ—Å—Ç—É–ø–Ω–æ', 'success');
                } else {
                    addLog('‚ö†Ô∏è –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏–º–µ–Ω HEYS –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ', 'warning');
                }
                
                addLog('üìä –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –º–æ–¥—É–ª–µ–π', 'success');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∂–∏–≤–æ–π –ø–æ–∏—Å–∫
                setupLiveSearch();
                addLog('üîÑ –ñ–∏–≤–æ–π –ø–æ–∏—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–¥—É–ª–∏ —Å—Ä–∞–∑—É –∏ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
            checkModules();
            setTimeout(checkModules, 1000);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ Enter
            document.getElementById('search-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    testSearch();
                }
            });
        });
    </script>
</body>
</html>
