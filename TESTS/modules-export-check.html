<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEYS Modules Export Check</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: #e0e0e0; }
        .check-section { margin: 20px 0; padding: 15px; border: 1px solid #444; border-radius: 8px; }
        .success { background: #1a4c96; border-color: #2d5aa0; }
        .error { background: #c62d42; border-color: #d73754; }
        .info { background: #2d4a22; border-color: #3d5a32; }
        .log { background: #333; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; font-size: 12px; }
        button { background: #2d5aa0; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #3d6ab0; }
        .module-status { display: flex; align-items: center; margin: 5px 0; }
        .status-icon { margin-right: 10px; font-size: 20px; }
        .module-details { font-size: 12px; color: #bbb; margin-left: 30px; }
    </style>
</head>
<body>
    <h1>üîç HEYS Modules Export Check</h1>
    
    <div class="check-section info">
        <h3>üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π HEYS</h3>
        <p>–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ HEYS namespace.</p>
    </div>

    <div class="check-section">
        <h3>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–º</h3>
        <button onclick="checkAllModules()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏</button>
        <button onclick="testSpecificMethods()">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã</button>
        <button onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>

    <div class="check-section">
        <h3>üìä –°—Ç–∞—Ç—É—Å –º–æ–¥—É–ª–µ–π</h3>
        <div id="modules-status"></div>
    </div>

    <div class="check-section">
        <h3>üìù –õ–æ–≥ –ø—Ä–æ–≤–µ—Ä–∫–∏</h3>
        <div id="check-log" class="log"></div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –º–æ–¥—É–ª–∏ HEYS -->
    <script src="../heys_core_v12.js"></script>
    <script src="../heys_models_v1.js"></script>
    <script src="../heys_storage_supabase_v1.js"></script>
    <script src="../heys_reports_v12.js"></script>
    <script src="../heys_smart_search.js"></script>
    <script src="../heys_integration_layer.js"></script>
    <script src="../heys_security_validation.js"></script>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('check-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            logDiv.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function updateModuleStatus(moduleName, status, details = '') {
            const statusDiv = document.getElementById('modules-status');
            const icon = status === 'success' ? '‚úÖ' : status === 'error' ? '‚ùå' : '‚ö†Ô∏è';
            const moduleDiv = document.createElement('div');
            moduleDiv.innerHTML = `
                <div class="module-status">
                    <span class="status-icon">${icon}</span>
                    <strong>${moduleName}</strong>
                </div>
                ${details ? `<div class="module-details">${details}</div>` : ''}
            `;
            statusDiv.appendChild(moduleDiv);
        }

        function checkAllModules() {
            log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π HEYS...');
            document.getElementById('modules-status').innerHTML = '';

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π HEYS namespace
            if (typeof window.HEYS === 'undefined') {
                log('‚ùå HEYS namespace –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
                updateModuleStatus('HEYS Namespace', 'error', 'window.HEYS –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                return;
            } else {
                log('‚úÖ HEYS namespace –Ω–∞–π–¥–µ–Ω', 'success');
                updateModuleStatus('HEYS Namespace', 'success', 'window.HEYS —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
            }

            // –°–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞–µ–º—ã—Ö –º–æ–¥—É–ª–µ–π
            const expectedModules = [
                { name: 'ReportsManager', path: 'HEYS.ReportsManager' },
                { name: 'SmartSearchEngine', path: 'HEYS.SmartSearchEngine' },
                { name: 'IntegrationLayer', path: 'HEYS.IntegrationLayer' },
                { name: 'SecurityValidationManager', path: 'HEYS.SecurityValidationManager' },
                { name: 'Core', path: 'HEYS.Core' },
                { name: 'Models', path: 'HEYS.Models' },
                { name: 'Storage', path: 'HEYS.Storage' }
            ];

            expectedModules.forEach(module => {
                const parts = module.path.split('.');
                let current = window;
                let exists = true;
                let currentPath = '';

                for (const part of parts) {
                    currentPath += (currentPath ? '.' : '') + part;
                    if (current && typeof current[part] !== 'undefined') {
                        current = current[part];
                    } else {
                        exists = false;
                        break;
                    }
                }

                if (exists) {
                    log(`‚úÖ ${module.name} –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏ ${module.path}`, 'success');
                    updateModuleStatus(module.name, 'success', `–î–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ ${module.path}, —Ç–∏–ø: ${typeof current}`);
                } else {
                    log(`‚ùå ${module.name} –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏ ${module.path}`, 'error');
                    updateModuleStatus(module.name, 'error', `–ù–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏ ${module.path}`);
                }
            });

            log('üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        }

        function testSpecificMethods() {
            log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã...');

            // –¢–µ—Å—Ç–∏—Ä—É–µ–º SecurityValidationManager
            if (window.HEYS && window.HEYS.SecurityValidationManager) {
                try {
                    const securityManager = new window.HEYS.SecurityValidationManager();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º applySecurityHeaders
                    if (typeof securityManager.applySecurityHeaders === 'function') {
                        const headers = securityManager.applySecurityHeaders();
                        log(`‚úÖ SecurityValidationManager.applySecurityHeaders() —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤: ${headers.size}`, 'success');
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
                        const requiredHeaders = ['Content-Security-Policy', 'X-Frame-Options'];
                        const missingHeaders = requiredHeaders.filter(h => !headers.has(h));
                        if (missingHeaders.length === 0) {
                            log(`‚úÖ –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç`, 'success');
                        } else {
                            log(`‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏: ${missingHeaders.join(', ')}`, 'error');
                        }
                    } else {
                        log(`‚ùå SecurityValidationManager.applySecurityHeaders –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π`, 'error');
                    }

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º validateInput
                    if (typeof securityManager.validateInput === 'function') {
                        const testResult = securityManager.validateInput('test@email.com', 'email');
                        log(`‚úÖ SecurityValidationManager.validateInput() —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${JSON.stringify(testResult)}`, 'success');
                    } else {
                        log(`‚ùå SecurityValidationManager.validateInput –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π`, 'error');
                    }

                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ SecurityValidationManager: ${error.message}`, 'error');
                }
            }

            // –¢–µ—Å—Ç–∏—Ä—É–µ–º SmartSearchEngine
            if (window.HEYS && window.HEYS.SmartSearchEngine) {
                try {
                    const searchEngine = new window.HEYS.SmartSearchEngine();
                    
                    if (typeof searchEngine.search === 'function') {
                        log(`‚úÖ SmartSearchEngine.search() –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    }
                    
                    if (typeof searchEngine.indexData === 'function') {
                        log(`‚úÖ SmartSearchEngine.indexData() –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    }
                    
                    if (typeof searchEngine.buildSearchIndex === 'function') {
                        log(`‚úÖ SmartSearchEngine.buildSearchIndex() –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    }
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ SmartSearchEngine: ${error.message}`, 'error');
                }
            }

            // –¢–µ—Å—Ç–∏—Ä—É–µ–º IntegrationLayer
            if (window.HEYS && window.HEYS.IntegrationLayer) {
                try {
                    const integrationLayer = new window.HEYS.IntegrationLayer();
                    
                    if (typeof integrationLayer.connectAPI === 'function') {
                        log(`‚úÖ IntegrationLayer.connectAPI() –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    }
                    
                    if (typeof integrationLayer.syncData === 'function') {
                        log(`‚úÖ IntegrationLayer.syncData() –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    }
                    
                    if (typeof integrationLayer.getConnections === 'function') {
                        log(`‚úÖ IntegrationLayer.getConnections() –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                    }
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ IntegrationLayer: ${error.message}`, 'error');
                }
            }

            log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
        }

        function clearLog() {
            document.getElementById('check-log').innerHTML = '';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π...');
                checkAllModules();
                setTimeout(testSpecificMethods, 1000);
            }, 500);
        });
    </script>
</body>
</html>
