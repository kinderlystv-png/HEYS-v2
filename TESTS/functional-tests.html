<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEYS - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.95); 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            background: #f8f9fa;
        }
        .test-item { 
            margin: 10px 0; 
            padding: 15px; 
            border-radius: 8px; 
            border-left: 4px solid #ddd; 
        }
        .test-item.success { 
            background: #d4edda; 
            border-left-color: #28a745; 
        }
        .test-item.failure { 
            background: #f8d7da; 
            border-left-color: #dc3545; 
        }
        .test-item.warning { 
            background: #fff3cd; 
            border-left-color: #ffc107; 
        }
        .summary { 
            font-size: 20px; 
            text-align: center; 
            margin: 20px 0; 
            padding: 20px; 
            border-radius: 10px; 
            font-weight: bold;
        }
        .summary.excellent { background: #d4edda; color: #155724; }
        .summary.good { background: #cce7ff; color: #004085; }
        .summary.warning { background: #fff3cd; color: #856404; }
        .summary.danger { background: #f8d7da; color: #721c24; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        
        .log { 
            background: #212529; 
            color: #fff;
            padding: 15px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace; 
            white-space: pre-wrap; 
            max-height: 400px; 
            overflow-y: auto; 
            margin: 20px 0;
            font-size: 12px;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
            text-align: center;
            line-height: 20px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ HEYS - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã</h1>
        <p><strong>–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –º–æ–¥—É–ª–µ–π, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –∏—Ö –Ω–∞–ª–∏—á–∏–µ</strong></p>

        <div class="test-section">
            <h3>üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
            <button onclick="runAllTests()" id="runAllBtn">üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã</button>
            <button onclick="runCoreTests()" id="runCoreBtn">‚ö° –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</button>
            <button onclick="runAdvancedTests()" id="runAdvBtn">üî¨ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Å—Ç—ã</button>
            <button onclick="clearResults()" id="clearBtn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
        </div>

        <div id="progress-section" style="display: none;">
            <h4>üìä –ü—Ä–æ–≥—Ä–µ—Å—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
            <div class="progress">
                <div class="progress-bar" id="progressBar" style="width: 0%">0%</div>
            </div>
            <p id="currentTest">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é...</p>
        </div>

        <div id="summary" class="summary" style="display: none;"></div>
        
        <div id="results"></div>
        
        <div id="log-section" style="display: none;">
            <h4>üìù –î–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥</h4>
            <div id="log" class="log"></div>
        </div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –º–æ–¥—É–ª–∏ HEYS -->
    <script src="../heys_core_v12.js"></script>
    <script src="../heys_day_v12.js"></script>
    <script src="../heys_user_v12.js"></script>
    <script src="../heys_storage_supabase_v1.js"></script>
    <script src="../heys_storage_indexeddb_v1.js"></script>
    <script src="../heys_performance_monitor.js"></script>
    <script src="../heys_analytics_ui.js"></script>
    <script src="../heys_models_v1.js"></script>
    <script src="../heys_stats_v1.js"></script>
    <script src="../heys_smart_search_with_typos_v1.js"></script>
    <script src="../heys_advanced_error_tracker_v1.js"></script>
    <script src="../heys_worker_manager_v1.js"></script>
    <script src="../heys_integration_layer_v1.js"></script>
    <script src="../heys_service_worker_v1.js"></script>
    <script src="../modern-search-integration.js"></script>

    <script>
        let testResults = [];
        let currentTestIndex = 0;
        let totalTests = 0;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logDiv.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[FunctionalTest] ${message}`);
        }

        function updateProgress(current, total, testName) {
            const percentage = Math.round((current / total) * 100);
            const progressBar = document.getElementById('progressBar');
            const currentTestSpan = document.getElementById('currentTest');
            
            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${percentage}%`;
            currentTestSpan.textContent = `–¢–µ—Å—Ç ${current}/${total}: ${testName}`;
        }

        function addTestResult(name, success, message = '', details = '') {
            testResults.push({ name, success, message, details });
            
            const resultsDiv = document.getElementById('results');
            const testDiv = document.createElement('div');
            testDiv.className = `test-item ${success ? 'success' : 'failure'}`;
            testDiv.innerHTML = `
                <strong>${success ? '‚úÖ' : '‚ùå'} ${name}</strong>
                ${message ? `<br><em>${message}</em>` : ''}
                ${details ? `<br><small style="color: #666;">${details}</small>` : ''}
            `;
            resultsDiv.appendChild(testDiv);
        }

        function updateSummary() {
            const passed = testResults.filter(t => t.success).length;
            const total = testResults.length;
            const percentage = Math.round((passed / total) * 100);
            
            const summaryDiv = document.getElementById('summary');
            summaryDiv.style.display = 'block';
            summaryDiv.textContent = `–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã: ${passed}/${total} (${percentage}%)`;
            
            if (percentage === 100) {
                summaryDiv.className = 'summary excellent';
                summaryDiv.textContent += ' - –ü–†–ï–í–û–°–•–û–î–ù–û! üèÜ';
            } else if (percentage >= 90) {
                summaryDiv.className = 'summary good';
                summaryDiv.textContent += ' - –û–¢–õ–ò–ß–ù–û! üéâ';
            } else if (percentage >= 70) {
                summaryDiv.className = 'summary warning';
                summaryDiv.textContent += ' - –•–û–†–û–®–û, –ù–û –ï–°–¢–¨ –ü–†–û–ë–õ–ï–ú–´ ‚ö†Ô∏è';
            } else {
                summaryDiv.className = 'summary danger';
                summaryDiv.textContent += ' - –¢–†–ï–ë–£–ï–¢–°–Ø –í–ù–ò–ú–ê–ù–ò–ï! üö®';
            }
        }

        function clearResults() {
            testResults = [];
            document.getElementById('results').innerHTML = '';
            document.getElementById('log').textContent = '';
            document.getElementById('summary').style.display = 'none';
            document.getElementById('progress-section').style.display = 'none';
            document.getElementById('log-section').style.display = 'none';
        }

        // === –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–ï–°–¢–´ ===

        async function testCoreSystemFunctionality() {
            try {
                log('–¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ HEYS...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
                if (!window.HEYS) {
                    throw new Error('HEYS –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }

                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
                const testProduct = {
                    name: '–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç',
                    kcal100: 200,
                    proteins: 10,
                    fats: 5,
                    carbs: 25
                };

                if (typeof HEYS.addProduct === 'function') {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
                    const result = await HEYS.addProduct(testProduct);
                    log('–ü—Ä–æ–¥—É–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                } else {
                    throw new Error('–§—É–Ω–∫—Ü–∏—è addProduct –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }

                return { success: true, message: '–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç' };
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö: ${error.message}`, 'error');
                return { success: false, message: error.message };
            }
        }

        async function testSearchFunctionality() {
            try {
                log('–¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞...');
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫
                if (typeof HEYS.searchProducts === 'function') {
                    const results = await HEYS.searchProducts('—Ç–µ—Å—Ç', { limit: 5 });
                    log(`–ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω, –Ω–∞–π–¥–µ–Ω–æ ${results?.length || 0} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`, 'success');
                } else {
                    throw new Error('–§—É–Ω–∫—Ü–∏—è searchProducts –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }

                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —É–º–Ω—ã–π –ø–æ–∏—Å–∫
                if (HEYS.SmartSearch && typeof HEYS.SmartSearch.search === 'function') {
                    const smartResults = await HEYS.SmartSearch.search('—Ç–µ—Å—Ç–æ–≤—ã–π');
                    log('–£–º–Ω—ã–π –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                } else {
                    log('–£–º–Ω—ã–π –ø–æ–∏—Å–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'warning');
                }

                return { success: true, message: '–ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ' };
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –≤ –ø–æ–∏—Å–∫–µ: ${error.message}`, 'error');
                return { success: false, message: error.message };
            }
        }

        async function testDataPersistence() {
            try {
                log('–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º localStorage
                const testKey = 'heys_functional_test';
                const testData = { test: true, timestamp: Date.now() };
                
                if (typeof HEYS.lsSet === 'function') {
                    HEYS.lsSet(testKey, testData);
                    const retrieved = HEYS.lsGet(testKey);
                    
                    if (retrieved && retrieved.test === true) {
                        log('localStorage —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                        // –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                        localStorage.removeItem(testKey);
                    } else {
                        throw new Error('–î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –≤ localStorage');
                    }
                } else {
                    throw new Error('–§—É–Ω–∫—Ü–∏–∏ lsSet/lsGet –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                }

                return { success: true, message: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç' };
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${error.message}`, 'error');
                return { success: false, message: error.message };
            }
        }

        async function testPerformanceMonitoring() {
            try {
                log('–¢–µ—Å—Ç–∏—Ä—É–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏...');
                
                if (HEYS.performance && typeof HEYS.performance.trackUserInteraction === 'function') {
                    // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ç—Ä–µ–∫–∏–Ω–≥
                    HEYS.performance.trackUserInteraction('functional_test', { 
                        test: true, 
                        timestamp: Date.now() 
                    });
                    log('–¢—Ä–µ–∫–∏–Ω–≥ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');

                    // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–∑–º–µ—Ä–µ–Ω–∏—è
                    if (typeof HEYS.performance.measure === 'function') {
                        const result = await HEYS.performance.measure('test_operation', async () => {
                            await new Promise(resolve => setTimeout(resolve, 10));
                            return 'test_result';
                        });
                        log(`–ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${result}`, 'success');
                    }
                } else {
                    throw new Error('Performance Monitor –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }

                return { success: true, message: '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–µ–Ω' };
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: ${error.message}`, 'error');
                return { success: false, message: error.message };
            }
        }

        async function testErrorTracking() {
            try {
                log('–¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫...');
                
                if (HEYS.errorTracker && typeof HEYS.errorTracker.captureException === 'function') {
                    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –æ—à–∏–±–∫—É
                    const testError = new Error('–¢–µ—Å—Ç–æ–≤–∞—è –æ—à–∏–±–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–µ–∫–∏–Ω–≥–∞');
                    HEYS.errorTracker.captureException(testError, { 
                        test: true, 
                        source: 'functional_test' 
                    });
                    log('–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                } else {
                    throw new Error('Error Tracker –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }

                return { success: true, message: '–¢—Ä–µ–∫–∏–Ω–≥ –æ—à–∏–±–æ–∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç' };
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ —Ç—Ä–µ–∫–∏–Ω–≥–∞: ${error.message}`, 'error');
                return { success: false, message: error.message };
            }
        }

        async function testIndexedDBFunctionality() {
            try {
                log('–¢–µ—Å—Ç–∏—Ä—É–µ–º IndexedDB...');
                
                if (HEYS.indexedDB && typeof HEYS.indexedDB.init === 'function') {
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º IndexedDB
                    await HEYS.indexedDB.init();
                    log('IndexedDB –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                    
                    // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
                    if (typeof HEYS.indexedDB.saveProducts === 'function') {
                        const testProducts = [{
                            id: 'test_product_' + Date.now(),
                            name: '–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç IndexedDB',
                            kcal100: 150
                        }];
                        
                        await HEYS.indexedDB.saveProducts(testProducts);
                        log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ IndexedDB —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    }
                } else {
                    throw new Error('IndexedDB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }

                return { success: true, message: 'IndexedDB –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω' };
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ IndexedDB: ${error.message}`, 'error');
                return { success: false, message: error.message };
            }
        }

        async function testWorkerManagerFunctionality() {
            try {
                log('–¢–µ—Å—Ç–∏—Ä—É–µ–º Worker Manager...');
                
                if (HEYS.WorkerManager && typeof HEYS.WorkerManager.createWorker === 'function') {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É Web Workers
                    if (typeof Worker !== 'undefined') {
                        log('Web Workers –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è', 'success');
                        
                        // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ worker'–∞
                        const stats = HEYS.WorkerManager.getStats();
                        log(`Worker Manager –∞–∫—Ç–∏–≤–µ–Ω: ${JSON.stringify(stats)}`, 'success');
                    } else {
                        throw new Error('Web Workers –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º');
                    }
                } else {
                    throw new Error('Worker Manager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }

                return { success: true, message: 'Worker Manager –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ' };
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ Worker Manager: ${error.message}`, 'error');
                return { success: false, message: error.message };
            }
        }

        async function testModernSearchIntegration() {
            try {
                log('–¢–µ—Å—Ç–∏—Ä—É–µ–º Modern Search Integration...');
                
                if (HEYS.ModernSearch && typeof HEYS.ModernSearch.smartSearch === 'function') {
                    // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
                    const result = await HEYS.ModernSearch.smartSearch('—Ç–µ—Å—Ç', { limit: 3 });
                    log('Modern Search Integration —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                } else {
                    throw new Error('Modern Search Integration –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }

                return { success: true, message: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞' };
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ Modern Search: ${error.message}`, 'error');
                return { success: false, message: error.message };
            }
        }

        // === –ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í ===

        async function runTest(testFunction, testName) {
            currentTestIndex++;
            updateProgress(currentTestIndex, totalTests, testName);
            
            try {
                const result = await testFunction();
                addTestResult(testName, result.success, result.message, result.details);
                log(`${testName}: ${result.success ? '–£–°–ü–ï–•' : '–ü–†–û–í–ê–õ'} - ${result.message}`, 
                    result.success ? 'success' : 'error');
                return result.success;
            } catch (error) {
                addTestResult(testName, false, `–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: ${error.message}`);
                log(`${testName}: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê - ${error.message}`, 'error');
                return false;
            }
        }

        async function runCoreTests() {
            clearResults();
            document.getElementById('progress-section').style.display = 'block';
            document.getElementById('log-section').style.display = 'block';
            
            const coreTests = [
                [testCoreSystemFunctionality, '–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ HEYS'],
                [testSearchFunctionality, '–§—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞'],
                [testDataPersistence, '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö'],
                [testPerformanceMonitoring, '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏']
            ];
            
            totalTests = coreTests.length;
            currentTestIndex = 0;
            
            log('=== –ó–ê–ü–£–°–ö –ë–ê–ó–û–í–´–• –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–• –¢–ï–°–¢–û–í ===');
            
            for (const [testFunc, testName] of coreTests) {
                await runTest(testFunc, testName);
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            updateSummary();
            log('=== –ë–ê–ó–û–í–´–ï –¢–ï–°–¢–´ –ó–ê–í–ï–†–®–ï–ù–´ ===');
        }

        async function runAdvancedTests() {
            clearResults();
            document.getElementById('progress-section').style.display = 'block';
            document.getElementById('log-section').style.display = 'block';
            
            const advancedTests = [
                [testErrorTracking, '–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫'],
                [testIndexedDBFunctionality, 'IndexedDB —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å'],
                [testWorkerManagerFunctionality, 'Worker Manager'],
                [testModernSearchIntegration, 'Modern Search Integration']
            ];
            
            totalTests = advancedTests.length;
            currentTestIndex = 0;
            
            log('=== –ó–ê–ü–£–°–ö –ü–†–û–î–í–ò–ù–£–¢–´–• –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–• –¢–ï–°–¢–û–í ===');
            
            for (const [testFunc, testName] of advancedTests) {
                await runTest(testFunc, testName);
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            updateSummary();
            log('=== –ü–†–û–î–í–ò–ù–£–¢–´–ï –¢–ï–°–¢–´ –ó–ê–í–ï–†–®–ï–ù–´ ===');
        }

        async function runAllTests() {
            clearResults();
            document.getElementById('progress-section').style.display = 'block';
            document.getElementById('log-section').style.display = 'block';
            
            const allTests = [
                [testCoreSystemFunctionality, '–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ HEYS'],
                [testSearchFunctionality, '–§—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞'],
                [testDataPersistence, '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö'],
                [testPerformanceMonitoring, '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏'],
                [testErrorTracking, '–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫'],
                [testIndexedDBFunctionality, 'IndexedDB —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å'],
                [testWorkerManagerFunctionality, 'Worker Manager'],
                [testModernSearchIntegration, 'Modern Search Integration']
            ];
            
            totalTests = allTests.length;
            currentTestIndex = 0;
            
            log('=== –ó–ê–ü–£–°–ö –ü–û–õ–ù–´–• –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–• –¢–ï–°–¢–û–í ===');
            
            for (const [testFunc, testName] of allTests) {
                await runTest(testFunc, testName);
                await new Promise(resolve => setTimeout(resolve, 150));
            }
            
            updateSummary();
            log('=== –í–°–ï –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–ï–°–¢–´ –ó–ê–í–ï–†–®–ï–ù–´ ===');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            log('–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–ø—É—Å–∫—É');
            log('–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏ HEYS: ' + Object.keys(window.HEYS || {}).join(', '));
        });
    </script>
</body>
</html>
