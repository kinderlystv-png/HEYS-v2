<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEYS - –î–µ–º–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/common.css">
    <style>
        .modern-demo {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .tech-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e1e5e9;
        }
        
        .tech-card h3 {
            margin: 0 0 15px 0;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-ready { background: #48bb78; }
        .status-loading { background: #ed8936; }
        .status-error { background: #f56565; }
        
        .demo-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .demo-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: #4299e1;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        
        .demo-btn:hover { background: #3182ce; }
        .demo-btn:disabled { 
            background: #a0aec0; 
            cursor: not-allowed; 
        }
        
        .demo-output {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .performance-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .stat-label {
            font-size: 12px;
            color: #718096;
        }
        
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .feature-highlight {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="modern-demo">
        <div class="hero-section">
            <h1>üöÄ HEYS: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–µ–±-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</h1>
            <p>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è IndexedDB, Web Workers, Service Workers –∏ Integration Layer</p>
        </div>

        <div class="tech-grid">
            <!-- IndexedDB -->
            <div class="tech-card">
                <h3>
                    üóÑÔ∏è IndexedDB Storage
                    <span id="indexeddb-status" class="status-indicator status-loading"></span>
                </h3>
                <p>–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö —Å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –æ–±—ä–µ–º–æ–º</p>
                
                <div class="demo-controls">
                    <button class="demo-btn" onclick="testIndexedDB()">–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</button>
                    <button class="demo-btn" onclick="loadFromIndexedDB()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                    <button class="demo-btn" onclick="clearIndexedDB()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                
                <div id="indexeddb-output" class="demo-output">–û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞...</div>
                
                <div class="performance-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="indexeddb-objects">0</div>
                        <div class="stat-label">–û–±—ä–µ–∫—Ç–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="indexeddb-size">0KB</div>
                        <div class="stat-label">–†–∞–∑–º–µ—Ä</div>
                    </div>
                </div>
            </div>

            <!-- Web Workers -->
            <div class="tech-card">
                <h3>
                    üîÑ Web Workers
                    <span id="workers-status" class="status-indicator status-loading"></span>
                </h3>
                <p>–§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</p>
                
                <div class="demo-controls">
                    <button class="demo-btn" onclick="testWorkerSearch()">–ü–æ–∏—Å–∫ –≤ Worker</button>
                    <button class="demo-btn" onclick="testWorkerCalculation()">–¢—è–∂–µ–ª—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è</button>
                    <button class="demo-btn" onclick="testWorkerSync()">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
                </div>
                
                <div id="workers-output" class="demo-output">–û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞...</div>
                
                <div class="performance-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="workers-active">0</div>
                        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="workers-tasks">0</div>
                        <div class="stat-label">–ó–∞–¥–∞—á</div>
                    </div>
                </div>
            </div>

            <!-- Service Worker -->
            <div class="tech-card">
                <h3>
                    üõ°Ô∏è Service Worker
                    <span id="sw-status" class="status-indicator status-loading"></span>
                </h3>
                <p>–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º</p>
                
                <div class="demo-controls">
                    <button class="demo-btn" onclick="testServiceWorker()">–¢–µ—Å—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è</button>
                    <button class="demo-btn" onclick="testOfflineMode()">–û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º</button>
                    <button class="demo-btn" onclick="clearCache()">–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à</button>
                </div>
                
                <div id="sw-output" class="demo-output">–û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞...</div>
                
                <div class="performance-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="sw-cached">0</div>
                        <div class="stat-label">–í –∫–µ—à–µ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="sw-hits">0</div>
                        <div class="stat-label">–•–∏—Ç—ã</div>
                    </div>
                </div>
            </div>

            <!-- Integration Layer -->
            <div class="tech-card">
                <h3>
                    üß† Integration Layer
                    <span id="integration-status" class="status-indicator status-loading"></span>
                </h3>
                <p>–£–º–Ω–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –≤—Å–µ—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π</p>
                
                <div class="demo-controls">
                    <button class="demo-btn" onclick="testSmartSearch()">–£–º–Ω—ã–π –ø–æ–∏—Å–∫</button>
                    <button class="demo-btn" onclick="testAutoSync()">–ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
                    <button class="demo-btn" onclick="getIntegrationStats()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                </div>
                
                <div id="integration-output" class="demo-output">–û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞...</div>
                
                <div class="performance-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="integration-searches">0</div>
                        <div class="stat-label">–ü–æ–∏—Å–∫–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="integration-speed">0ms</div>
                        <div class="stat-label">–°–∫–æ—Ä–æ—Å—Ç—å</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="feature-highlight">
            <h3>üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å—Ç–µ–∫–∞</h3>
            <ul>
                <li><strong>IndexedDB:</strong> –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–±–æ—Ç–∞ –æ—Ñ–ª–∞–π–Ω</li>
                <li><strong>Web Workers:</strong> –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å, –æ—Ç–∑—ã–≤—á–∏–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</li>
                <li><strong>Service Worker:</strong> –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</li>
                <li><strong>Integration Layer:</strong> –£–º–Ω–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è, –∞–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</li>
            </ul>
        </div>

        <div class="demo-controls" style="text-align: center; margin: 30px 0;">
            <button class="demo-btn" onclick="runFullDemo()" style="font-size: 16px; padding: 12px 24px;">
                üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é
            </button>
            <button class="demo-btn" onclick="window.open('../index.html', '_blank')" style="font-size: 16px; padding: 12px 24px;">
                üì± –û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            </button>
        </div>

        <!-- Console Log Section -->
        <div class="tech-card" style="margin-top: 20px;">
            <h3>üìù –õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
            <div style="margin: 10px 0;">
                <button class="demo-btn" onclick="copyConsoleLog()" style="background: #4299e1; margin-right: 10px;">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥</button>
                <button class="demo-btn" onclick="clearConsoleLog()" style="background: #a0aec0;">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
            </div>
            <div id="console-log" style="background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; min-height: 100px;">
                –õ–æ–≥ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å...
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π -->
    <script src="../heys_storage_indexeddb_v1.js"></script>
    <script src="../heys_worker_manager_v1.js?v=2"></script>
    <script src="../heys_integration_layer_v1.js"></script>

    <script>
        let demoStats = {
            indexeddb: { objects: 0, size: 0 },
            workers: { active: 0, tasks: 0 },
            sw: { cached: 0, hits: 0 },
            integration: { searches: 0, avgSpeed: 0 }
        };

        // Console logging functions
        function setupConsoleLogging() {
            const logDiv = document.getElementById('console-log');
            const originalLog = console.log;
            const originalError = console.error;
            const originalWarn = console.warn;
            
            console.log = (...args) => {
                originalLog.apply(console, args);
                addToConsoleLog('LOG', args.join(' '), '#10b981');
            };
            
            console.error = (...args) => {
                originalError.apply(console, args);
                addToConsoleLog('ERROR', args.join(' '), '#ef4444');
            };
            
            console.warn = (...args) => {
                originalWarn.apply(console, args);
                addToConsoleLog('WARN', args.join(' '), '#f59e0b');
            };
        }
        
        function addToConsoleLog(level, message, color) {
            const logDiv = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: ${color}">[${timestamp}] [${level}]</span> ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function copyConsoleLog() {
            const logDiv = document.getElementById('console-log');
            const logText = logDiv.innerText || logDiv.textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(logText).then(() => {
                    addToConsoleLog('LOG', 'üìã –õ–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', '#10b981');
                }).catch(err => {
                    addToConsoleLog('ERROR', '–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err, '#ef4444');
                });
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = logText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                addToConsoleLog('LOG', 'üìã –õ–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ (fallback)', '#10b981');
            }
        }
        
        function clearConsoleLog() {
            document.getElementById('console-log').innerHTML = '–õ–æ–≥ –æ—á–∏—â–µ–Ω...';
        }

        // Initialization
        document.addEventListener('DOMContentLoaded', async () => {
            setupConsoleLogging();
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–º–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π...');
            await initializeModernTech();
        });

        async function initializeModernTech() {
            // Check IndexedDB
            try {
                if (window.HEYS?.indexedDB) {
                    updateStatus('indexeddb-status', 'ready');
                    updateOutput('indexeddb-output', '‚úÖ IndexedDB ready');
                } else {
                    updateStatus('indexeddb-status', 'error');
                    updateOutput('indexeddb-output', '‚ùå IndexedDB not available');
                }
            } catch (e) {
                updateStatus('indexeddb-status', 'error');
                updateOutput('indexeddb-output', '‚ùå IndexedDB error: ' + e.message);
            }

            // Check Workers
            try {
                if (window.HEYS?.workers) {
                    updateStatus('workers-status', 'ready');
                    updateOutput('workers-output', '‚úÖ Web Workers ready');
                } else {
                    updateStatus('workers-status', 'error');
                    updateOutput('workers-output', '‚ùå Web Workers not available');
                }
            } catch (e) {
                updateStatus('workers-status', 'error');
                updateOutput('workers-output', '‚ùå Workers error: ' + e.message);
            }

            // Check Service Worker
            try {
                if ('serviceWorker' in navigator) {
                    updateStatus('sw-status', 'ready');
                    updateOutput('sw-output', '‚úÖ Service Worker supported');
                } else {
                    updateStatus('sw-status', 'error');
                    updateOutput('sw-output', '‚ùå Service Worker not supported');
                }
            } catch (e) {
                updateStatus('sw-status', 'error');
                updateOutput('sw-output', '‚ùå Service Worker error: ' + e.message);
            }

            // Check Integration Layer
            try {
                if (window.HEYS?.integration) {
                    await HEYS.integration.init();
                    updateStatus('integration-status', 'ready');
                    updateOutput('integration-output', '‚úÖ Integration Layer ready');
                } else {
                    updateStatus('integration-status', 'error');
                    updateOutput('integration-output', '‚ùå Integration Layer not available');
                }
            } catch (e) {
                updateStatus('integration-status', 'error');
                updateOutput('integration-output', '‚ùå Integration error: ' + e.message);
            }
        }

        // IndexedDB Tests
        async function testIndexedDB() {
            updateOutput('indexeddb-output', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ IndexedDB...');
            
            try {
                const testData = {
                    products: Array.from({length: 100}, (_, i) => ({
                        id: `prod_${i}`,
                        name: `–ü—Ä–æ–¥—É–∫—Ç ${i}`,
                        protein: Math.random() * 30,
                        created: new Date().toISOString()
                    }))
                };

                if (window.HEYS?.indexedDB) {
                    await HEYS.indexedDB.saveProducts(testData.products);
                    demoStats.indexeddb.objects = testData.products.length;
                    demoStats.indexeddb.size = Math.round(JSON.stringify(testData).length / 1024);
                    
                    updateOutput('indexeddb-output', `‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${testData.products.length} –ø—Ä–æ–¥—É–∫—Ç–æ–≤\nüì¶ –†–∞–∑–º–µ—Ä: ${demoStats.indexeddb.size}KB`);
                    updateStats();
                } else {
                    updateOutput('indexeddb-output', '‚ùå IndexedDB –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                }
            } catch (error) {
                updateOutput('indexeddb-output', '‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        async function loadFromIndexedDB() {
            try {
                if (window.HEYS?.indexedDB) {
                    const products = await HEYS.indexedDB.searchProducts('', 10);
                    updateOutput('indexeddb-output', `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${products.length} –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ IndexedDB`);
                } else {
                    updateOutput('indexeddb-output', '‚ùå IndexedDB –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                }
            } catch (error) {
                updateOutput('indexeddb-output', '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message);
            }
        }

        // Worker Tests
        async function testWorkerSearch() {
            updateOutput('workers-output', '–ó–∞–ø—É—Å–∫ –ø–æ–∏—Å–∫–∞ –≤ Web Worker...');
            
            try {
                if (window.HEYS?.workers) {
                    const startTime = performance.now();
                    const results = await HEYS.workers.searchProducts('—Ö–ª–µ–±', { limit: 20 });
                    const duration = performance.now() - startTime;
                    
                    demoStats.workers.tasks++;
                    updateOutput('workers-output', `‚úÖ –ü–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à–µ–Ω –∑–∞ ${Math.round(duration)}ms\nüîç –ù–∞–π–¥–µ–Ω–æ: ${results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤\n‚ö° UI –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!`);
                    updateStats();
                } else {
                    updateOutput('workers-output', '‚ùå Web Workers –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã');
                }
            } catch (error) {
                updateOutput('workers-output', '‚ùå –û—à–∏–±–∫–∞ Worker: ' + error.message);
            }
        }

        async function testWorkerCalculation() {
            updateOutput('workers-output', '–¢—è–∂–µ–ª—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ Worker...');
            
            try {
                if (window.HEYS?.workers) {
                    const startTime = performance.now();
                    // –ò–º–∏—Ç–∞—Ü–∏—è —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
                    const result = await new Promise(resolve => {
                        setTimeout(() => {
                            let sum = 0;
                            for (let i = 0; i < 1000000; i++) {
                                sum += Math.sqrt(i);
                            }
                            resolve(sum);
                        }, 100);
                    });
                    
                    const duration = performance.now() - startTime;
                    demoStats.workers.tasks++;
                    updateOutput('workers-output', `‚úÖ –í—ã—á–∏—Å–ª–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω—ã –∑–∞ ${Math.round(duration)}ms\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç: ${Math.round(result)}\nüöÄ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Å—Ç–∞–ª—Å—è –æ—Ç–∑—ã–≤—á–∏–≤—ã–º!`);
                    updateStats();
                } else {
                    updateOutput('workers-output', '‚ùå Web Workers –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã');
                }
            } catch (error) {
                updateOutput('workers-output', '‚ùå –û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π: ' + error.message);
            }
        }

        // Integration Layer Tests
        async function testSmartSearch() {
            updateOutput('integration-output', '–ó–∞–ø—É—Å–∫ —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞...');
            
            try {
                if (window.HEYS?.integration) {
                    const startTime = performance.now();
                    const result = await HEYS.integration.smartSearch('–º–æ–ª–æ–∫–æ', { limit: 15 });
                    const duration = performance.now() - startTime;
                    
                    demoStats.integration.searches++;
                    demoStats.integration.avgSpeed = duration;
                    
                    updateOutput('integration-output', `‚úÖ –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à–µ–Ω!\n‚ö° –í—Ä–µ–º—è: ${Math.round(duration)}ms\nüéØ –ò—Å—Ç–æ—á–Ω–∏–∫: ${result.source || 'auto'}\nüìä –ù–∞–π–¥–µ–Ω–æ: ${result.results?.length || 0} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
                    updateStats();
                } else {
                    updateOutput('integration-output', '‚ùå Integration Layer –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                }
            } catch (error) {
                updateOutput('integration-output', '‚ùå –û—à–∏–±–∫–∞ —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞: ' + error.message);
            }
        }

        async function getIntegrationStats() {
            try {
                if (window.HEYS?.integration) {
                    const stats = await HEYS.integration.getStats();
                    updateOutput('integration-output', `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Integration Layer:\n${JSON.stringify(stats, null, 2)}`);
                } else {
                    updateOutput('integration-output', '‚ùå Integration Layer –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                }
            } catch (error) {
                updateOutput('integration-output', '‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ' + error.message);
            }
        }

        // Service Worker Tests
        async function testServiceWorker() {
            updateOutput('sw-output', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Service Worker...');
            
            try {
                if ('serviceWorker' in navigator) {
                    const registration = await navigator.serviceWorker.register('../heys-sw.js');
                    demoStats.sw.cached = 5; // –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                    updateOutput('sw-output', '‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω\nüì¶ –†–µ—Å—É—Ä—Å—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è\nüîÑ –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω');
                    updateStats();
                } else {
                    updateOutput('sw-output', '‚ùå Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                }
            } catch (error) {
                updateOutput('sw-output', '‚ùå –û—à–∏–±–∫–∞ Service Worker: ' + error.message);
            }
        }

        // Full Demo
        async function runFullDemo() {
            const tests = [
                { name: 'IndexedDB', fn: testIndexedDB },
                { name: 'Web Workers', fn: testWorkerSearch },
                { name: 'Service Worker', fn: testServiceWorker },
                { name: 'Smart Search', fn: testSmartSearch }
            ];

            for (const test of tests) {
                console.log(`Running ${test.name}...`);
                await test.fn();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }

            alert('üéâ –ü–æ–ª–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n\n–í—Å–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç!');
        }

        // Utility functions
        function updateStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `status-indicator status-${status}`;
            }
        }

        function updateOutput(elementId, text) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = text;
            }
        }

        function updateStats() {
            document.getElementById('indexeddb-objects').textContent = demoStats.indexeddb.objects;
            document.getElementById('indexeddb-size').textContent = demoStats.indexeddb.size + 'KB';
            
            document.getElementById('workers-active').textContent = demoStats.workers.active;
            document.getElementById('workers-tasks').textContent = demoStats.workers.tasks;
            
            document.getElementById('sw-cached').textContent = demoStats.sw.cached;
            document.getElementById('sw-hits').textContent = demoStats.sw.hits;
            
            document.getElementById('integration-searches').textContent = demoStats.integration.searches;
            document.getElementById('integration-speed').textContent = Math.round(demoStats.integration.avgSpeed) + 'ms';
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏-–∑–∞–≥–ª—É—à–∫–∏
        function clearIndexedDB() {
            updateOutput('indexeddb-output', 'IndexedDB –æ—á–∏—â–µ–Ω');
            demoStats.indexeddb = { objects: 0, size: 0 };
            updateStats();
        }

        function testWorkerSync() {
            updateOutput('workers-output', '–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ Worker...\n‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
        }

        function testOfflineMode() {
            updateOutput('sw-output', '–¢–µ—Å—Ç –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞...\n‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω');
        }

        function clearCache() {
            updateOutput('sw-output', '–ö–µ—à –æ—á–∏—â–µ–Ω');
            demoStats.sw = { cached: 0, hits: 0 };
            updateStats();
        }

        function testAutoSync() {
            updateOutput('integration-output', '–ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...\n‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏');
        }
    </script>
</body>
</html>
