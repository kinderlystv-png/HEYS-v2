<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .test-input { margin: 10px 0; }
        .test-input input { padding: 8px; width: 300px; }
        .results { margin: 10px 0; max-height: 300px; overflow-y: auto; }
        .result-item { padding: 5px; margin: 2px 0; background: #f8f9fa; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ HEYS</h1>
    
    <div id="status"></div>
    
    <div class="test-input">
        <input type="text" id="search-query" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: –º–æ–ª–∞–∫, —Ö–ª–µ–ø)" />
        <button onclick="testSearch()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫</button>
    </div>
    
    <div id="results"></div>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª–∏ -->
    <script src="heys_advanced_error_tracker_v1.js"></script>
    <script src="heys_smart_search_with_typos_v1.js"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è HEYS
        window.HEYS = window.HEYS || {};
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
        const testProducts = [
            { id: 1, name: '–•–ª–µ–± –±–µ–ª—ã–π', category: '–•–ª–µ–±–æ–±—É–ª–æ—á–Ω—ã–µ', kcal100: 265 },
            { id: 2, name: '–ú–æ–ª–æ–∫–æ 3.2%', category: '–ú–æ–ª–æ—á–Ω—ã–µ', kcal100: 60 },
            { id: 3, name: '–ö—É—Ä–∏—Ü–∞ —Ñ–∏–ª–µ', category: '–ú—è—Å–Ω—ã–µ', kcal100: 165 },
            { id: 4, name: '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å', category: '–û–≤–æ—â–∏', kcal100: 80 },
            { id: 5, name: '–Ø–±–ª–æ–∫–∏', category: '–§—Ä—É–∫—Ç—ã', kcal100: 52 },
            { id: 6, name: '–ú–æ–ª–æ–∫–æ –æ–±–µ–∑–∂–∏—Ä–µ–Ω–Ω–æ–µ', category: '–ú–æ–ª–æ—á–Ω—ã–µ', kcal100: 35 },
            { id: 7, name: '–ú–æ–ª–∞ (–ø—Ä–∏–ø—Ä–∞–≤–∞)', category: '–°–ø–µ—Ü–∏–∏', kcal100: 15 },
            { id: 8, name: '–ú–æ—Ä–∫–æ–≤—å', category: '–û–≤–æ—â–∏', kcal100: 35 },
            { id: 9, name: '–ú—É–∫–∞ –ø—à–µ–Ω–∏—á–Ω–∞—è', category: '–ë–∞–∫–∞–ª–µ—è', kcal100: 334 },
            { id: 10, name: '–ú–∞–∫–∞—Ä–æ–Ω—ã', category: '–ë–∞–∫–∞–ª–µ—è', kcal100: 371 }
        ];
        
        function updateStatus(message, type = 'success') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function checkIntegration() {
            const checks = [];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º HEYS namespace
            if (window.HEYS) {
                checks.push('‚úÖ HEYS namespace –¥–æ—Å—Ç—É–ø–µ–Ω');
            } else {
                checks.push('‚ùå HEYS namespace –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º SmartSearchWithTypos
            if (window.HEYS.SmartSearchWithTypos) {
                checks.push('‚úÖ SmartSearchWithTypos –∑–∞–≥—Ä—É–∂–µ–Ω');
                
                if (typeof window.HEYS.SmartSearchWithTypos.search === 'function') {
                    checks.push('‚úÖ –ú–µ—Ç–æ–¥ search –¥–æ—Å—Ç—É–ø–µ–Ω');
                } else {
                    checks.push('‚ùå –ú–µ—Ç–æ–¥ search –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
            } else {
                checks.push('‚ùå SmartSearchWithTypos –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º AdvancedErrorTracker
            if (window.HEYS.AdvancedErrorTracker) {
                checks.push('‚úÖ AdvancedErrorTracker –∑–∞–≥—Ä—É–∂–µ–Ω');
            } else {
                checks.push('‚ùå AdvancedErrorTracker –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
            
            const allOk = checks.every(check => check.startsWith('‚úÖ'));
            const status = allOk ? 'success' : 'error';
            
            updateStatus(checks.join('<br>'), status);
            
            return allOk;
        }
        
        function testSearch() {
            const query = document.getElementById('search-query').value.trim();
            const resultsDiv = document.getElementById('results');
            
            if (!query) {
                resultsDiv.innerHTML = '<div class="status warning">‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞</div>';
                return;
            }
            
            if (!checkIntegration()) {
                resultsDiv.innerHTML = '<div class="status error">‚ùå –°–∏—Å—Ç–µ–º–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</div>';
                return;
            }
            
            try {
                const startTime = performance.now();
                
                const result = window.HEYS.SmartSearchWithTypos.search(query, testProducts, {
                    enablePhonetic: true,
                    enableSynonyms: true,
                    maxSuggestions: 10
                });
                
                const searchTime = performance.now() - startTime;
                
                let html = `<h3>üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –¥–ª—è "${query}"</h3>`;
                html += `<p><strong>–í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞:</strong> ${searchTime.toFixed(2)} –º—Å</p>`;
                html += `<p><strong>–ù–∞–π–¥–µ–Ω–æ:</strong> ${result.results.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>`;
                
                if (result.corrections && result.corrections.length > 0) {
                    html += '<h4>üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—á–∞—Ç–æ–∫:</h4>';
                    result.corrections.forEach(correction => {
                        html += `<div class="result-item">
                            "${correction.original}" ‚Üí "${correction.corrected}" 
                            (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${Math.round(correction.confidence * 100)}%)
                        </div>`;
                    });
                }
                
                if (result.results.length > 0) {
                    html += '<h4>üìä –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã:</h4>';
                    result.results.forEach((product, index) => {
                        const matchTypeText = {
                            'exact': '—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ',
                            'typo': '–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–ø–µ—á–∞—Ç–∫–∞',
                            'synonym': '—Å–∏–Ω–æ–Ω–∏–º',
                            'phonetic': '—Ñ–æ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–µ'
                        };
                        
                        html += `<div class="result-item">
                            <strong>${index + 1}. ${product.name}</strong> (${product.category})
                            <br><small>–¢–∏–ø: ${matchTypeText[product.matchType] || product.matchType}, 
                            –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: ${Math.round(product.relevance)}, 
                            –ö–∞–ª–æ—Ä–∏–∏: ${product.kcal100}/100–≥</small>
                        </div>`;
                    });
                } else {
                    html += '<div class="status warning">‚ö†Ô∏è –ü—Ä–æ–¥—É–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                }
                
                if (result.searchStats) {
                    html += '<h4>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h4>';
                    html += `<div class="result-item">
                        –¢–æ—á–Ω—ã–µ: ${result.searchStats.exactMatches}, 
                        –û–ø–µ—á–∞—Ç–∫–∏: ${result.searchStats.typoMatches}, 
                        –°–∏–Ω–æ–Ω–∏–º—ã: ${result.searchStats.synonymMatches}, 
                        –§–æ–Ω–µ—Ç–∏—á–µ—Å–∫–∏–µ: ${result.searchStats.phoneticMatches}
                    </div>`;
                }
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
                console.error('Search error:', error);
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkIntegration, 100);
            
            // –¢–µ—Å—Ç –ø–æ Enter
            document.getElementById('search-query').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    testSearch();
                }
            });
        });
    </script>
</body>
</html>
