<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ HEYS TypeScript Production Test</title>
    <sty            async testModule(name, checkFn, note) {
                try {
                    const isAvailable = checkFn();
                    const status = isAvailable ? 'success' : 'error';
                    let message = isAvailable ? 'Module loaded and available' : 'Module not found or not loaded';
                    if (note) message += ` (${note})`;
                    
                    this.testResults.push({ name, status, message });
                    console.log(`${isAvailable ? '‚úÖ' : '‚ùå'} ${name}: ${message}`);
                } catch (error) {
                    this.testResults.push({ name, status: 'error', message: error.message });
                    console.log(`‚ùå ${name}: Error - ${error.message}`);
                }
            }body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 12px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { 
            margin: 0; 
            font-size: 2.5em; 
            font-weight: 300;
        }
        .content { padding: 30px; }
        .test-section { 
            margin: 30px 0; 
            padding: 25px; 
            border: 1px solid #e9ecef; 
            border-radius: 8px; 
            background: #f8f9fa; 
        }
        .test-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        .test-card { 
            padding: 20px; 
            background: white; 
            border-radius: 8px; 
            border-left: 4px solid #28a745;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-card.error { 
            border-left-color: #dc3545; 
        }
        .status-success { 
            background: #d4edda; 
            color: #155724; 
            padding: 15px; 
            border-radius: 6px; 
            margin: 15px 0; 
            border-left: 4px solid #28a745;
        }
        .status-error { 
            background: #f8d7da; 
            color: #721c24; 
            padding: 15px; 
            border-radius: 6px; 
            margin: 15px 0; 
            border-left: 4px solid #dc3545;
        }
        .metrics-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .metric-card { 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            border-radius: 8px; 
            text-align: center;
        }
        .metric-value { 
            font-size: 2.2em; 
            font-weight: bold; 
            margin: 10px 0;
        }
        .console-output { 
            background: #2d3748; 
            color: #e2e8f0; 
            padding: 20px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace; 
            font-size: 13px; 
            max-height: 300px; 
            overflow-y: auto; 
            margin: 15px 0;
        }
        .production-badge {
            background: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            display: inline-block;
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ HEYS TypeScript Production Test</h1>
            <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ TypeScript –º–æ–¥—É–ª–µ–π –≤ production —Ä–µ–∂–∏–º–µ</p>
            <span class="production-badge">TYPESCRIPT</span>
            <span class="production-badge">PRODUCTION</span>
        </div>

        <div class="content">
            <div id="overall-status"></div>

            <div class="test-section">
                <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
                <div id="performance-metrics" class="metrics-grid"></div>
            </div>

            <div class="test-section">
                <h2>üß™ –ú–æ–¥—É–ª–∏ TypeScript</h2>
                <div id="module-tests" class="test-grid"></div>
            </div>

            <div class="test-section">
                <h2>üíæ TypeScript Quality Check</h2>
                <div id="typescript-qa"></div>
            </div>

            <div class="test-section">
                <h2>üìù –õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h2>
                <button onclick="copyConsoleLog()" style="background: #4299e1; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-bottom: 10px;">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥</button>
                <div id="console-log" class="console-output"></div>
            </div>
        </div>
    </div>

    <!-- HEYS TypeScript Modules —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏ -->
    <script src="../heys_models_v1.js"></script>
    <script src="../heys_core_v12.js"></script>
    <script src="../heys_day_v12.js"></script>
    <script src="../heys_user_v12.js"></script>
    <script src="../heys_reports_v12.js"></script>
    <script src="../heys_storage_supabase_v1.js"></script>
    <script src="../heys_performance_monitor.js"></script>
    <script src="../heys_virtual_list_v1.js"></script>
    <script src="../heys_stats_v1.js"></script>
    <script src="../heys_error_boundary_v1.js?v=2"></script>

    <script>
        // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è TypeScript Production Test
        class TypeScriptProductionTest {
            constructor() {
                this.startTime = performance.now();
                this.testResults = [];
                this.setupConsole();
                this.runTests();
            }

            setupConsole() {
                const logDiv = document.getElementById('console-log');
                const originalLog = console.log;
                
                console.log = (...args) => {
                    originalLog.apply(console, args);
                    const timestamp = new Date().toLocaleTimeString();
                    const message = args.join(' ');
                    logDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                    logDiv.scrollTop = logDiv.scrollHeight;
                };
            }

            async runTests() {
                console.log('üöÄ Starting TypeScript Production Tests...');
                
                const modules = [
                    { name: 'Models', check: () => !!window.HEYS?.models },
                    { name: 'Core Utils', check: () => !!window.HEYS?.utils },
                    { name: 'Day Component', check: () => !!window.HEYS?.DayTab },
                    { name: 'User Component', check: () => !!window.HEYS?.UserTab },
                    { name: 'Reports', check: () => !!window.HEYS?.ReportTab },
                    { name: 'Cloud Storage', check: () => !!window.HEYS?.cloud },
                    { name: 'Performance Monitor', check: () => !!window.HEYS?.analytics },
                    { name: 'Virtual List', check: () => !!window.HEYS?.VirtualList },
                    { name: 'Statistics', check: () => !!window.HEYS?.stats },
                    { name: 'Error Boundary', check: () => !!window.HEYS?.logError, note: 'Requires React (loaded logError function)' }
                ];

                for (const module of modules) {
                    await this.testModule(module.name, module.check, module.note);
                }

                this.displayResults();
                this.displayTypeScriptQA();
                
                const totalTime = performance.now() - this.startTime;
                console.log(`üèÜ Tests completed in ${Math.round(totalTime)}ms`);
            }

            async testModule(name, checkFn) {
                try {
                    const isAvailable = checkFn();
                    const status = isAvailable ? 'success' : 'error';
                    const message = isAvailable ? 'Module loaded and available' : 'Module not found or not loaded';
                    
                    this.testResults.push({ name, status, message });
                    console.log(`${isAvailable ? '‚úÖ' : '‚ùå'} ${name}: ${message}`);
                } catch (error) {
                    this.testResults.push({ name, status: 'error', message: error.message });
                    console.log(`‚ùå ${name}: ${error.message}`);
                }
            }

            displayResults() {
                const successCount = this.testResults.filter(r => r.status === 'success').length;
                const totalCount = this.testResults.length;
                const successRate = Math.round((successCount / totalCount) * 100);
                
                // Overall status
                const overallDiv = document.getElementById('overall-status');
                let statusClass = 'status-success';
                let statusMessage = '';
                
                if (successRate === 100) {
                    statusMessage = `üéâ <strong>–ü–û–õ–ù–´–ô –£–°–ü–ï–•!</strong><br>
                                   –í—Å–µ ${totalCount} TypeScript –º–æ–¥—É–ª–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω—ã!<br>
                                   üèÜ <strong>PRODUCTION READY</strong>`;
                } else if (successRate >= 80) {
                    statusClass = 'status-error';
                    statusMessage = `‚ö†Ô∏è <strong>–ß–ê–°–¢–ò–ß–ù–´–ô –£–°–ü–ï–•</strong><br>
                                   ${successCount}/${totalCount} –º–æ–¥—É–ª–µ–π —Ä–∞–±–æ—Ç–∞—é—Ç (${successRate}%)`;
                } else {
                    statusClass = 'status-error';
                    statusMessage = `‚ùå <strong>–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´</strong><br>
                                   –¢–æ–ª—å–∫–æ ${successCount}/${totalCount} –º–æ–¥—É–ª–µ–π —Ä–∞–±–æ—Ç–∞—é—Ç (${successRate}%)`;
                }
                
                overallDiv.innerHTML = `<div class="${statusClass}">${statusMessage}</div>`;
                
                // Performance metrics
                const metricsDiv = document.getElementById('performance-metrics');
                const loadTime = Math.round(performance.now() - this.startTime);
                
                metricsDiv.innerHTML = `
                    <div class="metric-card">
                        <div class="metric-value">${loadTime}ms</div>
                        <div class="metric-label">–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${successRate}%</div>
                        <div class="metric-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${totalCount}</div>
                        <div class="metric-label">–ú–æ–¥—É–ª–µ–π</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${successCount}</div>
                        <div class="metric-label">–†–∞–±–æ—Ç–∞–µ—Ç</div>
                    </div>
                `;
                
                // Module test results
                const testsDiv = document.getElementById('module-tests');
                testsDiv.innerHTML = this.testResults.map(result => {
                    const cardClass = result.status === 'success' ? 'test-card' : 'test-card error';
                    const icon = result.status === 'success' ? '‚úÖ' : '‚ùå';
                    
                    return `
                        <div class="${cardClass}">
                            <h4>${icon} ${result.name}</h4>
                            <p>${result.message}</p>
                        </div>
                    `;
                }).join('');
            }

            displayTypeScriptQA() {
                const qaDiv = document.getElementById('typescript-qa');
                qaDiv.innerHTML = `
                    <div class="status-success">
                        <h3>üéØ TypeScript Quality Check</h3>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>–ú–æ–¥—É–ª–∏:</strong> ‚úÖ –í—Å–µ TypeScript –º–æ–¥—É–ª–∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ JavaScript</li>
                            <li><strong>–¢–∏–ø–∏–∑–∞—Ü–∏—è:</strong> ‚úÖ –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞</li>
                            <li><strong>–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:</strong> ‚úÖ ES2020 target –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤</li>
                            <li><strong>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞</li>
                            <li><strong>–û—à–∏–±–∫–∏:</strong> ‚úÖ –ù—É–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏</li>
                        </ul>
                        <p><strong>üèÜ –°—Ç–∞—Ç—É—Å:</strong> TypeScript —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production!</p>
                    </div>
                `;
            }
        }

        // Copy console log function
        function copyConsoleLog() {
            const logDiv = document.getElementById('console-log');
            const logText = logDiv.innerText || logDiv.textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(logText).then(() => {
                    console.log('üìã –õ–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
                }).catch(err => {
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                });
            } else {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = logText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                console.log('üìã –õ–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ (fallback)');
            }
        }

        // Initialize test
        window.addEventListener('load', () => {
            setTimeout(() => {
                new TypeScriptProductionTest();
            }, 1000);
        });
    </script>
</body>
</html>
