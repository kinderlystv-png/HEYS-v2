<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ—Ä–æ–∂–Ω—ã—Ö –∫–∞—Ä—Ç</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: #e0e0e0; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #444; border-radius: 8px; }
        .success { background: #1a4c96; border-color: #2d5aa0; }
        .error { background: #c62d42; border-color: #d73754; }
        .info { background: #2d4a22; border-color: #3d5a32; }
        .log { background: #333; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; font-size: 12px; }
        button { background: #2d5aa0; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #3d6ab0; }
        .roadmap-item { background: #2a2a2a; margin: 5px 0; padding: 10px; border-radius: 4px; border-left: 3px solid #2d5aa0; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –ª–æ–≥–∏–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –¥–æ—Ä–æ–∂–Ω—ã—Ö –∫–∞—Ä—Ç</h1>
    
    <div class="test-section info">
        <h3>üìã –°—Ü–µ–Ω–∞—Ä–∏–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
        <p>1. –°–æ–∑–¥–∞–µ–º —Å–∏—Å—Ç–µ–º—É —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</p>
        <p>2. –£–¥–∞–ª—è–µ–º –æ–¥–Ω—É –∫–∞—Ä—Ç—É</p>
        <p>3. –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ (refreshData)</p>
        <p>4. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É–¥–∞–ª–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞ –ù–ï –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ</p>
    </div>

    <div class="test-section">
        <h3>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–º</h3>
        <button onclick="initTest()">üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç</button>
        <button onclick="deleteTestRoadmap()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É</button>
        <button onclick="refreshData()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <button onclick="clearStorage()">üßπ –û—á–∏—Å—Ç–∏—Ç—å localStorage</button>
    </div>

    <div class="test-section">
        <h3>üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</h3>
        <div id="system-state"></div>
    </div>

    <div class="test-section">
        <h3>üìù –õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
        <div id="test-log" class="log"></div>
    </div>

    <div class="test-section">
        <h3>üóÇÔ∏è –î–æ—Ä–æ–∂–Ω—ã–µ –∫–∞—Ä—Ç—ã</h3>
        <div id="roadmaps-list"></div>
    </div>

    <script>
        // –ü—Ä–æ—Å—Ç–∞—è —ç–º—É–ª—è—Ü–∏—è –ª–æ–≥–∏–∫–∏ –¥–æ—Ä–æ–∂–Ω—ã—Ö –∫–∞—Ä—Ç
        class TestRoadmapSystem {
            constructor() {
                this.roadmaps = [];
                this.deletedRoadmapIds = [];
            }

            async init() {
                this.log('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã...');
                await this.loadRoadmaps();
                this.loadFromLocalStorage();
                this.updateDisplay();
                this.log('‚úÖ –°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            }

            async loadRoadmaps() {
                // –≠–º—É–ª—è—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                const baseRoadmaps = [
                    { id: 'test-roadmap-1', title: '–¢–µ—Å—Ç–æ–≤–∞—è –¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ 1', status: 'ready' },
                    { id: 'test-roadmap-2', title: '–¢–µ—Å—Ç–æ–≤–∞—è –¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ 2', status: 'progress' },
                    { id: 'demo-roadmap-1', title: '–î–µ–º–æ –∫–∞—Ä—Ç–∞ 1 (—É–¥–∞–ª—è–µ–º–∞—è)', status: 'ready' },
                    { id: 'demo-roadmap-2', title: '–î–µ–º–æ –∫–∞—Ä—Ç–∞ 2', status: 'completed' }
                ];
                
                // –§–∏–ª—å—Ç—Ä—É–µ–º –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –∏—Å–∫–ª—é—á–∞—è —É–¥–∞–ª–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã
                this.roadmaps = baseRoadmaps.filter(roadmap => !this.deletedRoadmapIds.includes(roadmap.id));
                this.log(`üìÇ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${this.roadmaps.length} –¥–æ—Ä–æ–∂–Ω—ã—Ö –∫–∞—Ä—Ç (–∏—Å–∫–ª—é—á–µ–Ω–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö: ${this.deletedRoadmapIds.length})`);
            }

            deleteRoadmap(id) {
                const roadmapIndex = this.roadmaps.findIndex(r => r.id === id);
                if (roadmapIndex !== -1) {
                    const deletedRoadmap = this.roadmaps[roadmapIndex];
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º ID –≤ —Å–ø–∏—Å–æ–∫ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö
                    if (!this.deletedRoadmapIds.includes(id)) {
                        this.deletedRoadmapIds.push(id);
                    }
                    
                    // –£–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞
                    this.roadmaps.splice(roadmapIndex, 1);
                    
                    this.saveToLocalStorage();
                    this.updateDisplay();
                    
                    this.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∞ –¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞: "${deletedRoadmap.title}" (ID: ${id})`);
                    this.log(`üìã –°–ø–∏—Å–æ–∫ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö ID: [${this.deletedRoadmapIds.join(', ')}]`);
                } else {
                    this.log(`‚ùå –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å ID "${id}" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
                }
            }

            async refreshData() {
                this.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
                await this.loadRoadmaps(); // –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Ç–µ–ø–µ—Ä—å —É—á–∏—Ç—ã–≤–∞–µ—Ç —É–¥–∞–ª–µ–Ω–Ω—ã–µ ID
                this.updateDisplay();
                this.log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
            }

            saveToLocalStorage() {
                try {
                    const saveData = {
                        roadmaps: this.roadmaps,
                        deletedRoadmapIds: this.deletedRoadmapIds
                    };
                    localStorage.setItem('test-roadmaps-status', JSON.stringify(saveData));
                    this.log('üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage');
                } catch (error) {
                    this.log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${error.message}`);
                }
            }

            loadFromLocalStorage() {
                try {
                    const saved = localStorage.getItem('test-roadmaps-status');
                    if (saved) {
                        const saveData = JSON.parse(saved);
                        this.deletedRoadmapIds = saveData.deletedRoadmapIds || [];
                        this.log(`üì• –ó–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage. –£–¥–∞–ª–µ–Ω–Ω—ã—Ö ID: ${this.deletedRoadmapIds.length}`);
                    } else {
                        this.log('üì• localStorage –ø—É—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
                    }
                } catch (error) {
                    this.log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`);
                }
            }

            clearStorage() {
                localStorage.removeItem('test-roadmaps-status');
                this.deletedRoadmapIds = [];
                this.log('üßπ localStorage –æ—á–∏—â–µ–Ω');
                this.updateDisplay();
            }

            updateDisplay() {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
                const stateDiv = document.getElementById('system-state');
                stateDiv.innerHTML = `
                    <p><strong>–ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–æ—Ä–æ–∂–Ω—ã—Ö –∫–∞—Ä—Ç:</strong> ${this.roadmaps.length}</p>
                    <p><strong>–£–¥–∞–ª–µ–Ω–Ω—ã—Ö ID:</strong> [${this.deletedRoadmapIds.join(', ') || '–Ω–µ—Ç'}]</p>
                `;

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ—Ä–æ–∂–Ω—ã—Ö –∫–∞—Ä—Ç
                const listDiv = document.getElementById('roadmaps-list');
                listDiv.innerHTML = this.roadmaps.map(roadmap => `
                    <div class="roadmap-item">
                        <strong>${roadmap.title}</strong> (ID: ${roadmap.id}) - Status: ${roadmap.status}
                    </div>
                `).join('');
            }

            log(message) {
                const logDiv = document.getElementById('test-log');
                const timestamp = new Date().toLocaleTimeString();
                logDiv.innerHTML += `[${timestamp}] ${message}\n`;
                logDiv.scrollTop = logDiv.scrollHeight;
                console.log(message);
            }
        }

        let testSystem = new TestRoadmapSystem();

        async function initTest() {
            testSystem = new TestRoadmapSystem();
            await testSystem.init();
        }

        function deleteTestRoadmap() {
            testSystem.deleteRoadmap('demo-roadmap-1');
        }

        async function refreshData() {
            await testSystem.refreshData();
        }

        function clearStorage() {
            testSystem.clearStorage();
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            initTest();
        });
    </script>
</body>
</html>
