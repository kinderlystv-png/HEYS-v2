/*
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ—ºï¸ ĞĞĞ’Ğ˜Ğ“ĞĞ¦Ğ˜ĞĞĞĞĞ¯ ĞšĞĞ Ğ¢Ğ Ğ¤ĞĞ™Ğ›Ğ heys_gaming_system_v1.js (871 ÑÑ‚Ñ€Ğ¾ĞºĞ°)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ Ğ¤ĞĞ™Ğ›Ğ:                                                                       â”‚
â”‚                                                                                           â”‚
â”‚ ğŸ“„ Ğ—ĞĞ“ĞĞ›ĞĞ’ĞĞš Ğ˜ Ğ˜ĞœĞŸĞĞ Ğ¢Ğ« (ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 1-50):                                                    â”‚
â”‚    â”œâ”€â”€ ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ (1-15)                                                           â”‚
â”‚    â”œâ”€â”€ Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ (17-20)                                                     â”‚
â”‚    â”œâ”€â”€ GAME_CONFIG ĞºĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ (22-33)                                                    â”‚
â”‚    â””â”€â”€ ACHIEVEMENT_TYPES (35-45)                                                        â”‚
â”‚                                                                                           â”‚
â”‚ ğŸ® ĞĞ¡ĞĞĞ’ĞĞĞ™ ĞšĞ›ĞĞ¡Ğ¡ HEYSGamingSystem (ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 51-180):                                      â”‚
â”‚    â”œâ”€â”€ constructor() - Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (51-80)                                            â”‚
â”‚    â”œâ”€â”€ Ğ˜Ğ³Ñ€Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ (81-100)                                              â”‚
â”‚    â”œâ”€â”€ initialize() - Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ (101-130)                                       â”‚
â”‚    â”œâ”€â”€ loadPlayerData() - Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ (131-150)                                    â”‚
â”‚    â””â”€â”€ savePlayerData() - ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ (151-180)                                          â”‚
â”‚                                                                                           â”‚
â”‚ ğŸ† Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ Ğ”ĞĞ¡Ğ¢Ğ˜Ğ–Ğ•ĞĞ˜Ğ™ (ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 181-350):                                                  â”‚
â”‚    â”œâ”€â”€ Achievement class (181-220)                                                      â”‚
â”‚    â”œâ”€â”€ createAchievement() - ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ (221-250)                                         â”‚
â”‚    â”œâ”€â”€ checkAchievements() - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° (251-290)                                         â”‚
â”‚    â”œâ”€â”€ unlockAchievement() - Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° (291-320)                                    â”‚
â”‚    â””â”€â”€ getPlayerAchievements() - Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ (321-350)                                    â”‚
â”‚                                                                                           â”‚
â”‚ ğŸ“ˆ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ Ğ£Ğ ĞĞ’ĞĞ•Ğ™ Ğ˜ ĞĞŸĞ«Ğ¢Ğ (ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 351-500):                                             â”‚
â”‚    â”œâ”€â”€ addExperience() - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ¿Ñ‹Ñ‚Ğ° (351-380)                                     â”‚
â”‚    â”œâ”€â”€ calculateLevel() - Ñ€Ğ°ÑÑ‡ĞµÑ‚ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ (381-410)                                       â”‚
â”‚    â”œâ”€â”€ getXPForLevel() - XP Ğ´Ğ»Ñ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ (411-430)                                        â”‚
â”‚    â”œâ”€â”€ levelUp() - Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ (431-460)                                           â”‚
â”‚    â””â”€â”€ getPlayerLevel() - Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ (461-500)                                     â”‚
â”‚                                                                                           â”‚
â”‚ ğŸ¯ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ Ğ§Ğ•Ğ›Ğ›Ğ•ĞĞ”Ğ–Ğ•Ğ™ (ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 501-650):                                                  â”‚
â”‚    â”œâ”€â”€ DailyChallenge class (501-540)                                                   â”‚
â”‚    â”œâ”€â”€ generateDailyChallenges() - Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ (541-580)                                  â”‚
â”‚    â”œâ”€â”€ completeDailyChallenge() - Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ (581-610)                                  â”‚
â”‚    â””â”€â”€ getActiveChallenges() - Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ (611-650)                                       â”‚
â”‚                                                                                           â”‚
â”‚ ğŸ’° Ğ­ĞšĞĞĞĞœĞ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ (ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 651-750):                                               â”‚
â”‚    â”œâ”€â”€ addCurrency() - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²Ğ°Ğ»ÑÑ‚Ñ‹ (651-680)                                      â”‚
â”‚    â”œâ”€â”€ spendCurrency() - Ñ‚Ñ€Ğ°Ñ‚Ğ° Ğ²Ğ°Ğ»ÑÑ‚Ñ‹ (681-710)                                         â”‚
â”‚    â”œâ”€â”€ getCurrencyBalance() - Ğ±Ğ°Ğ»Ğ°Ğ½Ñ (711-730)                                          â”‚
â”‚    â””â”€â”€ Shop class - Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½ (731-750)                                                   â”‚
â”‚                                                                                           â”‚
â”‚ ğŸ“Š ĞĞĞĞ›Ğ˜Ğ¢Ğ˜ĞšĞ Ğ˜ Ğ­ĞšĞ¡ĞŸĞĞ Ğ¢ (ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 751-812):                                                 â”‚
â”‚    â”œâ”€â”€ getGameStats() - Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° (751-780)                                    â”‚
â”‚    â”œâ”€â”€ generateLeaderboard() - Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ² (781-800)                                â”‚
â”‚    â””â”€â”€ HEYS.GamingSystem ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚ (801-812)                                              â”‚
â”‚                                                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¯ Ğ‘Ğ«Ğ¡Ğ¢Ğ Ğ«Ğ™ ĞŸĞĞ˜Ğ¡Ğš:                                                                        â”‚
â”‚    â€¢ ĞšĞ»Ğ°ÑÑ: HEYSGamingSystem (51), initialize() (101)                                  â”‚
â”‚    â€¢ Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ: Achievement (181), unlockAchievement() (291)                          â”‚
â”‚    â€¢ Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸: addExperience() (351), levelUp() (431)                                    â”‚
â”‚    â€¢ Ğ§ĞµĞ»Ğ»ĞµĞ½Ğ´Ğ¶Ğ¸: DailyChallenge (501), completeDailyChallenge() (581)                   â”‚
â”‚    â€¢ Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸ĞºĞ°: addCurrency() (651), Shop (731)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
*/

/**
 * ===============================================================================
 * ğŸ® HEYS GAMING MODULE - Ğ˜Ğ³Ñ€Ğ¾Ğ²Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ»Ñ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
 * ===============================================================================
 * 
 * Ğ­Ñ‚Ğ¾Ñ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ñ‹Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ² ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ HEYS:
 * - Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹
 * - Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğµ Ñ‡ĞµĞ»Ğ»ĞµĞ½Ğ´Ğ¶Ğ¸
 * - Ğ¡Ğ¾Ñ€ĞµĞ²Ğ½Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸
 * - Ğ’Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ²Ğ°Ğ»ÑÑ‚Ğ° Ğ¸ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹
 * 
 * Ğ’ĞµÑ€ÑĞ¸Ñ: 1.0.0
 * ĞĞ²Ñ‚Ğ¾Ñ€: HEYS Development Team
 * Ğ”Ğ°Ñ‚Ğ°: 26.08.2025
 */

// Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ Ğ¸ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
import { HEYSCore } from './heys_core_v12.js';
import { HEYSStorage } from './heys_storage_supabase_v1.js';
import { HEYSAnalytics } from './heys_analytics_ui.js';

// ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
const GAME_CONFIG = {
    MAX_LEVEL: 100,
    XP_MULTIPLIER: 1.2,
    DAILY_BONUS: 50,
    STREAK_MULTIPLIER: 1.5,
    ACHIEVEMENT_CATEGORIES: ['productivity', 'consistency', 'social', 'innovation'],
    CURRENCIES: {
        HEYS_COINS: 'heys_coins',
        ENERGY_POINTS: 'energy_points',
        REPUTATION: 'reputation'
    }
};

// Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹
const ACHIEVEMENT_TYPES = {
    DAILY_STREAK: 'daily_streak',
    TASKS_COMPLETED: 'tasks_completed',
    TIME_FOCUSED: 'time_focused',
    SOCIAL_INTERACTION: 'social_interaction',
    INNOVATION_POINTS: 'innovation_points',
    PERFECTIONIST: 'perfectionist',
    EARLY_BIRD: 'early_bird',
    NIGHT_OWL: 'night_owl'
};

// ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ»Ğ°ÑÑ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
class HEYSGamingSystem {
    constructor(core, storage, analytics) {
        this.core = core;
        this.storage = storage;
        this.analytics = analytics;
        this.playerProfile = null;
        this.achievements = new Map();
        this.challenges = new Map();
        this.leaderboards = new Map();
        this.eventListeners = new Map();
        
        // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ´ÑĞ¸ÑÑ‚ĞµĞ¼
        this.initializeGameSystems();
    }

    // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ²ÑĞµÑ… Ğ¸Ğ³Ñ€Ğ¾Ğ²Ñ‹Ñ… ÑĞ¸ÑÑ‚ĞµĞ¼
    async initializeGameSystems() {
        try {
            console.log('ğŸ® Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ HEYS...');
            
            await this.loadPlayerProfile();
            await this.initializeAchievements();
            await this.loadDailyChallenges();
            await this.setupEventHandlers();
            await this.startBackgroundProcesses();
            
            console.log('âœ… Ğ˜Ğ³Ñ€Ğ¾Ğ²Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°');
            this.triggerEvent('gaming_system_ready');
        } catch (error) {
            console.error('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹:', error);
            throw error;
        }
    }

    // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°
    async loadPlayerProfile() {
        console.log('ğŸ‘¤ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°...');
        
        try {
            const savedProfile = await this.storage.get('player_profile');
            
            if (savedProfile) {
                this.playerProfile = {
                    ...this.getDefaultProfile(),
                    ...savedProfile,
                    lastActive: new Date().toISOString()
                };
            } else {
                this.playerProfile = this.createNewPlayerProfile();
                await this.savePlayerProfile();
            }
            
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½ÑƒÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ
            await this.checkDailyActivity();
            
            console.log(`ğŸ¯ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½: Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ ${this.playerProfile.level}, XP: ${this.playerProfile.experience}`);
        } catch (error) {
            console.error('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ:', error);
            this.playerProfile = this.getDefaultProfile();
        }
    }

    // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°
    createNewPlayerProfile() {
        const profile = {
            id: this.generatePlayerId(),
            username: 'HEYSPlayer',
            level: 1,
            experience: 0,
            currencies: {
                [GAME_CONFIG.CURRENCIES.HEYS_COINS]: 100,
                [GAME_CONFIG.CURRENCIES.ENERGY_POINTS]: 50,
                [GAME_CONFIG.CURRENCIES.REPUTATION]: 0
            },
            statistics: {
                totalTasksCompleted: 0,
                totalTimeSpent: 0,
                currentStreak: 0,
                maxStreak: 0,
                achievementsUnlocked: 0,
                challengesCompleted: 0
            },
            achievements: [],
            badges: [],
            preferences: {
                notifications: true,
                soundEffects: true,
                animations: true,
                difficulty: 'normal'
            },
            createdAt: new Date().toISOString(),
            lastActive: new Date().toISOString()
        };
        
        console.log('ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°');
        this.triggerEvent('new_player_created', profile);
        
        return profile;
    }

    // ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
    getDefaultProfile() {
        return {
            id: 'default_player',
            username: 'HEYSPlayer',
            level: 1,
            experience: 0,
            currencies: {
                [GAME_CONFIG.CURRENCIES.HEYS_COINS]: 0,
                [GAME_CONFIG.CURRENCIES.ENERGY_POINTS]: 0,
                [GAME_CONFIG.CURRENCIES.REPUTATION]: 0
            },
            statistics: {
                totalTasksCompleted: 0,
                totalTimeSpent: 0,
                currentStreak: 0,
                maxStreak: 0,
                achievementsUnlocked: 0,
                challengesCompleted: 0
            },
            achievements: [],
            badges: [],
            preferences: {
                notifications: true,
                soundEffects: true,
                animations: true,
                difficulty: 'normal'
            }
        };
    }

    // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°
    async savePlayerProfile() {
        try {
            await this.storage.set('player_profile', this.playerProfile);
            console.log('ğŸ’¾ ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½');
        } catch (error) {
            console.error('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ:', error);
        }
    }

    // Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¾Ğ¿Ñ‹Ñ‚Ğ° Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹
    static ExperienceSystem = class {
        static calculateRequiredXP(level) {
            return Math.floor(100 * Math.pow(GAME_CONFIG.XP_MULTIPLIER, level - 1));
        }

        static calculateLevel(totalXP) {
            let level = 1;
            let requiredXP = 0;
            
            while (requiredXP <= totalXP && level < GAME_CONFIG.MAX_LEVEL) {
                level++;
                requiredXP += this.calculateRequiredXP(level);
            }
            
            return Math.max(1, level - 1);
        }

        static getXPProgress(currentXP, level) {
            const currentLevelXP = this.calculateRequiredXP(level);
            const nextLevelXP = this.calculateRequiredXP(level + 1);
            const progress = (currentXP - currentLevelXP) / (nextLevelXP - currentLevelXP);
            
            return Math.max(0, Math.min(1, progress));
        }
    }

    // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ¿Ñ‹Ñ‚Ğ° Ğ¸Ğ³Ñ€Ğ¾ĞºÑƒ
    async addExperience(amount, reason = 'general') {
        if (!this.playerProfile || amount <= 0) return;
        
        const oldLevel = this.playerProfile.level;
        const oldXP = this.playerProfile.experience;
        
        // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ğ¿Ñ‹Ñ‚
        this.playerProfile.experience += amount;
        
        // ĞŸĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ
        const newLevel = HEYSGamingSystem.ExperienceSystem.calculateLevel(this.playerProfile.experience);
        
        if (newLevel > oldLevel) {
            await this.handleLevelUp(oldLevel, newLevel);
        }
        
        this.playerProfile.level = newLevel;
        
        // Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼
        console.log(`â­ +${amount} XP Ğ·Ğ° "${reason}". Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: ${newLevel} (${this.playerProfile.experience} XP)`);
        
        this.triggerEvent('experience_gained', {
            amount,
            reason,
            oldXP,
            newXP: this.playerProfile.experience,
            oldLevel,
            newLevel
        });
        
        await this.savePlayerProfile();
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ
        this.analytics.trackEvent('experience_gained', {
            amount,
            reason,
            newLevel: newLevel,
            totalXP: this.playerProfile.experience
        });
    }

    // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ñ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ
    async handleLevelUp(oldLevel, newLevel) {
        console.log(`ğŸ‰ ĞŸĞĞ’Ğ«Ğ¨Ğ•ĞĞ˜Ğ• Ğ£Ğ ĞĞ’ĞĞ¯! ${oldLevel} â†’ ${newLevel}`);
        
        // ĞĞ°Ğ³Ñ€Ğ°Ğ´Ñ‹ Ğ·Ğ° ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ
        const coinReward = newLevel * 10;
        const energyReward = newLevel * 5;
        
        await this.addCurrency(GAME_CONFIG.CURRENCIES.HEYS_COINS, coinReward);
        await this.addCurrency(GAME_CONFIG.CURRENCIES.ENERGY_POINTS, energyReward);
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ·Ğ° ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ
        await this.checkLevelAchievements(newLevel);
        
        // Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ¸Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ
        this.showLevelUpNotification(oldLevel, newLevel, {
            coins: coinReward,
            energy: energyReward
        });
        
        this.triggerEvent('level_up', {
            oldLevel,
            newLevel,
            rewards: { coins: coinReward, energy: energyReward }
        });
    }

    // Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ²Ğ°Ğ»ÑÑ‚
    async addCurrency(type, amount) {
        if (!this.playerProfile || amount <= 0) return;
        
        if (!this.playerProfile.currencies[type]) {
            this.playerProfile.currencies[type] = 0;
        }
        
        this.playerProfile.currencies[type] += amount;
        
        console.log(`ğŸ’° +${amount} ${type}. Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: ${this.playerProfile.currencies[type]}`);
        
        this.triggerEvent('currency_added', { type, amount, total: this.playerProfile.currencies[type] });
        await this.savePlayerProfile();
    }

    async spendCurrency(type, amount) {
        if (!this.playerProfile || amount <= 0) return false;
        
        const currentAmount = this.playerProfile.currencies[type] || 0;
        
        if (currentAmount < amount) {
            console.warn(`âŒ ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ${type}. ĞÑƒĞ¶Ğ½Ğ¾: ${amount}, ĞµÑÑ‚ÑŒ: ${currentAmount}`);
            return false;
        }
        
        this.playerProfile.currencies[type] -= amount;
        
        console.log(`ğŸ’¸ -${amount} ${type}. ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ: ${this.playerProfile.currencies[type]}`);
        
        this.triggerEvent('currency_spent', { type, amount, remaining: this.playerProfile.currencies[type] });
        await this.savePlayerProfile();
        
        return true;
    }

    // Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹
    async initializeAchievements() {
        console.log('ğŸ† Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹...');
        
        // Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹
        const achievementDefinitions = this.getAchievementDefinitions();
        
        for (const [id, definition] of Object.entries(achievementDefinitions)) {
            this.achievements.set(id, {
                ...definition,
                unlocked: this.playerProfile.achievements.includes(id),
                progress: 0
            });
        }
        
        // Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹
        await this.loadAchievementProgress();
        
        console.log(`ğŸ¯ Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ ${this.achievements.size} Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹`);
    }

    getAchievementDefinitions() {
        return {
            'first_task': {
                name: 'ĞŸĞµÑ€Ğ²Ñ‹Ğµ ÑˆĞ°Ğ³Ğ¸',
                description: 'Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ ÑĞ²Ğ¾Ñ Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ',
                icon: 'ğŸ¯',
                category: 'productivity',
                requirement: { type: 'tasks_completed', value: 1 },
                rewards: { xp: 50, coins: 25 }
            },
            'streak_master': {
                name: 'ĞœĞ°ÑÑ‚ĞµÑ€ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸',
                description: 'ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ğ¹Ñ‚Ğµ streak 7 Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´',
                icon: 'ğŸ”¥',
                category: 'consistency',
                requirement: { type: 'daily_streak', value: 7 },
                rewards: { xp: 200, coins: 100, energy: 50 }
            },
            'time_warrior': {
                name: 'Ğ’Ğ¾Ğ¸Ğ½ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸',
                description: 'ĞŸÑ€Ğ¾Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ 100 Ñ‡Ğ°ÑĞ¾Ğ² Ğ² Ñ„Ğ¾ĞºÑƒÑĞµ',
                icon: 'â°',
                category: 'productivity',
                requirement: { type: 'time_focused', value: 360000 }, // 100 Ñ‡Ğ°ÑĞ¾Ğ² Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…
                rewards: { xp: 500, coins: 250, reputation: 10 }
            },
            'early_riser': {
                name: 'Ğ Ğ°Ğ½Ğ½ÑÑ Ğ¿Ñ‚Ğ°ÑˆĞºĞ°',
                description: 'ĞĞ°Ñ‡Ğ½Ğ¸Ñ‚Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ Ğ´Ğ¾ 7:00 ÑƒÑ‚Ñ€Ğ° 10 Ñ€Ğ°Ğ·',
                icon: 'ğŸŒ…',
                category: 'consistency',
                requirement: { type: 'early_starts', value: 10 },
                rewards: { xp: 150, energy: 75 }
            },
            'perfectionist': {
                name: 'ĞŸĞµÑ€Ñ„ĞµĞºÑ†Ğ¸Ğ¾Ğ½Ğ¸ÑÑ‚',
                description: 'Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ 50 Ğ·Ğ°Ğ´Ğ°Ñ‡ Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ¾Ğ¹ 5 Ğ·Ğ²ĞµĞ·Ğ´',
                icon: 'â­',
                category: 'productivity',
                requirement: { type: 'perfect_tasks', value: 50 },
                rewards: { xp: 300, coins: 200, reputation: 15 }
            },
            'social_butterfly': {
                name: 'Ğ¡Ğ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ±Ğ°Ğ±Ğ¾Ñ‡ĞºĞ°',
                description: 'ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ĞµÑÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°Ğ¼Ğ¸ 25 Ñ€Ğ°Ğ·',
                icon: 'ğŸ¦‹',
                category: 'social',
                requirement: { type: 'shares', value: 25 },
                rewards: { xp: 100, reputation: 20 }
            }
        };
    }

    async checkAchievements(eventType, data) {
        for (const [id, achievement] of this.achievements) {
            if (achievement.unlocked) continue;
            
            let progress = this.calculateAchievementProgress(achievement, eventType, data);
            
            if (progress >= achievement.requirement.value) {
                await this.unlockAchievement(id);
            } else {
                // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ
                achievement.progress = progress;
                this.triggerEvent('achievement_progress', { id, progress, total: achievement.requirement.value });
            }
        }
    }

    calculateAchievementProgress(achievement, eventType, data) {
        const reqType = achievement.requirement.type;
        
        switch (reqType) {
            case 'tasks_completed':
                return this.playerProfile.statistics.totalTasksCompleted;
            case 'daily_streak':
                return this.playerProfile.statistics.currentStreak;
            case 'time_focused':
                return this.playerProfile.statistics.totalTimeSpent;
            case 'early_starts':
                return this.playerProfile.statistics.earlyStarts || 0;
            case 'perfect_tasks':
                return this.playerProfile.statistics.perfectTasks || 0;
            case 'shares':
                return this.playerProfile.statistics.sharesCount || 0;
            default:
                return 0;
        }
    }

    async unlockAchievement(achievementId) {
        const achievement = this.achievements.get(achievementId);
        if (!achievement || achievement.unlocked) return;
        
        // ĞÑ‚Ğ¼ĞµÑ‡Ğ°ĞµĞ¼ ĞºĞ°Ğº Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ
        achievement.unlocked = true;
        this.playerProfile.achievements.push(achievementId);
        this.playerProfile.statistics.achievementsUnlocked++;
        
        // Ğ’Ñ‹Ğ´Ğ°ĞµĞ¼ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹
        if (achievement.rewards.xp) {
            await this.addExperience(achievement.rewards.xp, `achievement: ${achievement.name}`);
        }
        
        if (achievement.rewards.coins) {
            await this.addCurrency(GAME_CONFIG.CURRENCIES.HEYS_COINS, achievement.rewards.coins);
        }
        
        if (achievement.rewards.energy) {
            await this.addCurrency(GAME_CONFIG.CURRENCIES.ENERGY_POINTS, achievement.rewards.energy);
        }
        
        if (achievement.rewards.reputation) {
            await this.addCurrency(GAME_CONFIG.CURRENCIES.REPUTATION, achievement.rewards.reputation);
        }
        
        // Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ
        this.showAchievementNotification(achievement);
        
        console.log(`ğŸ† Ğ”ĞĞ¡Ğ¢Ğ˜Ğ–Ğ•ĞĞ˜Ğ• Ğ ĞĞ—Ğ‘Ğ›ĞĞšĞ˜Ğ ĞĞ’ĞĞĞ: ${achievement.name}`);
        
        this.triggerEvent('achievement_unlocked', { id: achievementId, achievement });
        await this.savePlayerProfile();
    }

    // Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²
    async loadDailyChallenges() {
        console.log('ğŸ“… Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²...');
        
        const today = new Date().toDateString();
        const savedChallenges = await this.storage.get('daily_challenges');
        
        if (savedChallenges && savedChallenges.date === today) {
            this.challenges = new Map(Object.entries(savedChallenges.challenges));
        } else {
            await this.generateDailyChallenges();
        }
        
        console.log(`ğŸ¯ Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ ${this.challenges.size} ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²`);
    }

    async generateDailyChallenges() {
        const challengeTemplates = [
            {
                id: 'complete_tasks',
                name: 'ĞŸÑ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ',
                description: 'Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ {target} Ğ·Ğ°Ğ´Ğ°Ñ‡',
                target: () => Math.floor(Math.random() * 5) + 3,
                reward: { xp: 100, coins: 50 },
                type: 'tasks_completed'
            },
            {
                id: 'focus_time',
                name: 'ĞœĞ°ÑÑ‚ĞµÑ€ ĞºĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸',
                description: 'ĞŸÑ€Ğ¾Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ {target} Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ² Ñ„Ğ¾ĞºÑƒÑĞµ',
                target: () => (Math.floor(Math.random() * 4) + 2) * 30,
                reward: { xp: 150, energy: 25 },
                type: 'time_focused'
            },
            {
                id: 'early_start',
                name: 'Ğ Ğ°Ğ½Ğ½ÑÑ Ğ¿Ñ‚Ğ°ÑˆĞºĞ°',
                description: 'ĞĞ°Ñ‡Ğ½Ğ¸Ñ‚Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ Ğ´Ğ¾ 8:00',
                target: () => 1,
                reward: { xp: 75, coins: 30 },
                type: 'early_start'
            }
        ];
        
        this.challenges.clear();
        
        // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ 3 ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ°
        const selectedTemplates = this.shuffleArray(challengeTemplates).slice(0, 3);
        
        selectedTemplates.forEach((template, index) => {
            const target = template.target();
            const challenge = {
                id: `daily_${index}`,
                name: template.name,
                description: template.description.replace('{target}', target),
                target: target,
                progress: 0,
                completed: false,
                reward: template.reward,
                type: template.type
            };
            
            this.challenges.set(challenge.id, challenge);
        });
        
        await this.saveDailyChallenges();
        console.log('ğŸ†• Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ñ‹ Ğ½Ğ¾Ğ²Ñ‹Ğµ ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğµ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹');
    }

    async saveDailyChallenges() {
        const today = new Date().toDateString();
        const challengesData = {
            date: today,
            challenges: Object.fromEntries(this.challenges)
        };
        
        await this.storage.set('daily_challenges', challengesData);
    }

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ° Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²
    async updateChallengeProgress(eventType, data) {
        for (const [id, challenge] of this.challenges) {
            if (challenge.completed) continue;
            
            let progress = this.calculateChallengeProgress(challenge, eventType, data);
            challenge.progress = Math.min(progress, challenge.target);
            
            if (challenge.progress >= challenge.target && !challenge.completed) {
                await this.completeChallenge(id);
            }
        }
        
        await this.saveDailyChallenges();
    }

    calculateChallengeProgress(challenge, eventType, data) {
        switch (challenge.type) {
            case 'tasks_completed':
                return this.playerProfile.statistics.totalTasksCompleted;
            case 'time_focused':
                return Math.floor(this.playerProfile.statistics.totalTimeSpent / 60); // Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°Ñ…
            case 'early_start':
                return (this.playerProfile.statistics.earlyStarts || 0) > 0 ? 1 : 0;
            default:
                return challenge.progress;
        }
    }

    async completeChallenge(challengeId) {
        const challenge = this.challenges.get(challengeId);
        if (!challenge || challenge.completed) return;
        
        challenge.completed = true;
        this.playerProfile.statistics.challengesCompleted++;
        
        // Ğ’Ñ‹Ğ´Ğ°ĞµĞ¼ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹
        if (challenge.reward.xp) {
            await this.addExperience(challenge.reward.xp, `challenge: ${challenge.name}`);
        }
        
        if (challenge.reward.coins) {
            await this.addCurrency(GAME_CONFIG.CURRENCIES.HEYS_COINS, challenge.reward.coins);
        }
        
        if (challenge.reward.energy) {
            await this.addCurrency(GAME_CONFIG.CURRENCIES.ENERGY_POINTS, challenge.reward.energy);
        }
        
        console.log(`âœ… Ğ’Ğ«Ğ—ĞĞ’ Ğ’Ğ«ĞŸĞĞ›ĞĞ•Ğ: ${challenge.name}`);
        
        this.triggerEvent('challenge_completed', { id: challengeId, challenge });
        await this.savePlayerProfile();
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹ Ğ»Ğ¸ Ğ²ÑĞµ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ Ğ´Ğ½Ñ
        const allCompleted = Array.from(this.challenges.values()).every(c => c.completed);
        if (allCompleted) {
            await this.handleAllChallengesCompleted();
        }
    }

    async handleAllChallengesCompleted() {
        console.log('ğŸ‰ Ğ’Ğ¡Ğ• Ğ•Ğ–Ğ•Ğ”ĞĞ•Ğ’ĞĞ«Ğ• Ğ’Ğ«Ğ—ĞĞ’Ğ« Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ«!');
        
        // Ğ‘Ğ¾Ğ½ÑƒÑĞ½Ğ°Ñ Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ğ°
        await this.addExperience(100, 'all daily challenges completed');
        await this.addCurrency(GAME_CONFIG.CURRENCIES.HEYS_COINS, 100);
        
        this.triggerEvent('all_challenges_completed');
    }

    // Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹
    shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }

    generatePlayerId() {
        return 'player_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    async checkDailyActivity() {
        const lastActive = new Date(this.playerProfile.lastActive);
        const today = new Date();
        const daysDiff = Math.floor((today - lastActive) / (1000 * 60 * 60 * 24));
        
        if (daysDiff >= 1) {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ streak
            if (daysDiff === 1) {
                this.playerProfile.statistics.currentStreak++;
                if (this.playerProfile.statistics.currentStreak > this.playerProfile.statistics.maxStreak) {
                    this.playerProfile.statistics.maxStreak = this.playerProfile.statistics.currentStreak;
                }
            } else {
                this.playerProfile.statistics.currentStreak = 1;
            }
            
            // Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ Ğ±Ğ¾Ğ½ÑƒÑ
            await this.addCurrency(GAME_CONFIG.CURRENCIES.HEYS_COINS, GAME_CONFIG.DAILY_BONUS);
            
            this.playerProfile.lastActive = today.toISOString();
            await this.savePlayerProfile();
        }
    }

    // Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
    setupEventHandlers() {
        this.core.on('task_completed', (data) => {
            this.handleTaskCompleted(data);
        });
        
        this.core.on('focus_session_ended', (data) => {
            this.handleFocusSession(data);
        });
        
        this.core.on('app_started', (data) => {
            this.handleAppStart(data);
        });
    }

    async handleTaskCompleted(data) {
        this.playerProfile.statistics.totalTasksCompleted++;
        
        // Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ¾Ğ¿Ñ‹Ñ‚ Ğ·Ğ° Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ
        let xp = 25;
        
        // Ğ‘Ğ¾Ğ½ÑƒÑ Ğ·Ğ° ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾
        if (data.rating === 5) {
            xp += 15;
            this.playerProfile.statistics.perfectTasks = (this.playerProfile.statistics.perfectTasks || 0) + 1;
        }
        
        // Ğ‘Ğ¾Ğ½ÑƒÑ Ğ·Ğ° streak
        if (this.playerProfile.statistics.currentStreak > 1) {
            xp += Math.floor(xp * 0.1 * this.playerProfile.statistics.currentStreak);
        }
        
        await this.addExperience(xp, 'task completed');
        await this.checkAchievements('task_completed', data);
        await this.updateChallengeProgress('task_completed', data);
    }

    async handleFocusSession(data) {
        const timeSpent = data.duration; // Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…
        this.playerProfile.statistics.totalTimeSpent += timeSpent;
        
        // ĞĞ¿Ñ‹Ñ‚ Ğ·Ğ° Ğ²Ñ€ĞµĞ¼Ñ Ğ² Ñ„Ğ¾ĞºÑƒÑĞµ (1 XP Ğ·Ğ° Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ)
        const xp = Math.floor(timeSpent / 60);
        
        await this.addExperience(xp, 'focus session');
        await this.checkAchievements('focus_session', data);
        await this.updateChallengeProgress('focus_session', data);
    }

    async handleAppStart(data) {
        const hour = new Date().getHours();
        
        if (hour < 8) {
            this.playerProfile.statistics.earlyStarts = (this.playerProfile.statistics.earlyStarts || 0) + 1;
            await this.checkAchievements('early_start', data);
            await this.updateChallengeProgress('early_start', data);
        }
    }

    // UI Ğ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ
    showLevelUpNotification(oldLevel, newLevel, rewards) {
        // Ğ’ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğ·Ğ´ĞµÑÑŒ Ğ±Ñ‹Ğ» Ğ±Ñ‹ UI
        console.log(`
ğŸ‰ ĞŸĞĞ—Ğ”Ğ ĞĞ’Ğ›Ğ¯Ğ•Ğœ! ĞĞĞ’Ğ«Ğ™ Ğ£Ğ ĞĞ’Ğ•ĞĞ¬!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: ${oldLevel} â†’ ${newLevel}
ĞĞ°Ğ³Ñ€Ğ°Ğ´Ñ‹:
ğŸ’° +${rewards.coins} HEYS Coins
âš¡ +${rewards.energy} Energy Points
        `);
    }

    showAchievementNotification(achievement) {
        console.log(`
ğŸ† Ğ”ĞĞ¡Ğ¢Ğ˜Ğ–Ğ•ĞĞ˜Ğ• Ğ ĞĞ—Ğ‘Ğ›ĞĞšĞ˜Ğ ĞĞ’ĞĞĞ!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
${achievement.icon} ${achievement.name}
${achievement.description}
        `);
    }

    startBackgroundProcesses() {
        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
        setInterval(() => {
            this.savePlayerProfile();
        }, 5 * 60 * 1000);
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒĞ½Ğ¾Ñ‡Ğ¸ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²
        setInterval(() => {
            this.checkMidnight();
        }, 60 * 1000);
    }

    async checkMidnight() {
        const now = new Date();
        if (now.getHours() === 0 && now.getMinutes() === 0) {
            await this.generateDailyChallenges();
        }
    }

    triggerEvent(eventName, data = null) {
        if (this.eventListeners.has(eventName)) {
            this.eventListeners.get(eventName).forEach(callback => {
                try {
                    callback(data);
                } catch (error) {
                    console.error(`ĞÑˆĞ¸Ğ±ĞºĞ° Ğ² Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ ${eventName}:`, error);
                }
            });
        }
    }

    on(eventName, callback) {
        if (!this.eventListeners.has(eventName)) {
            this.eventListeners.set(eventName, []);
        }
        this.eventListeners.get(eventName).push(callback);
    }

    off(eventName, callback) {
        if (this.eventListeners.has(eventName)) {
            const listeners = this.eventListeners.get(eventName);
            const index = listeners.indexOf(callback);
            if (index > -1) {
                listeners.splice(index, 1);
            }
        }
    }

    // Ğ“ĞµÑ‚Ñ‚ĞµÑ€Ñ‹ Ğ´Ğ»Ñ UI
    getPlayerProfile() {
        return { ...this.playerProfile };
    }

    getAchievements() {
        return Array.from(this.achievements.entries()).map(([id, achievement]) => ({
            id,
            ...achievement
        }));
    }

    getDailyChallenges() {
        return Array.from(this.challenges.entries()).map(([id, challenge]) => ({
            id,
            ...challenge
        }));
    }

    getLeaderboard(type = 'level') {
        // Ğ’ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğ·Ğ´ĞµÑÑŒ Ğ±Ñ‹Ğ» Ğ±Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº ÑĞµÑ€Ğ²ĞµÑ€Ñƒ
        return [];
    }
}

// Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ
export default HEYSGamingSystem;
