# üé´ HEYS Trial Machine

> **v3.0** | 2026-02-09 | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç—Ä–∏–∞–ª-—Å–∏—Å—Ç–µ–º—ã (curator picks start date)

---

## üìä Quick Reference

### –°—Ç–∞—Ç—É—Å—ã –ø–æ–¥–ø–∏—Å–∫–∏ (`subscription_status`)

| –°—Ç–∞—Ç—É—Å          | –û–ø–∏—Å–∞–Ω–∏–µ                               | –ó–∞–ø–∏—Å—å | –ß—Ç–µ–Ω–∏–µ |
| --------------- | -------------------------------------- | ------ | ------ |
| `none`          | –ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏, –Ω–µ –æ–¥–æ–±—Ä–µ–Ω               | ‚ùå     | ‚ùå     |
| `trial_pending` | –ö—É—Ä–∞—Ç–æ—Ä –æ–¥–æ–±—Ä–∏–ª, –¥–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞ –≤ –±—É–¥—É—â–µ–º | ‚úÖ     | ‚úÖ     |
| `trial`         | –ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (7 –¥–Ω–µ–π –æ—Ç start_date)  | ‚úÖ     | ‚úÖ     |
| `active`        | –û–ø–ª–∞—á–µ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞                    | ‚úÖ     | ‚úÖ     |
| `read_only`     | –¢—Ä–∏–∞–ª/–ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞                 | ‚ùå     | ‚úÖ     |

### –¢–∞—Ä–∏—Ñ—ã (`PLANS`)

| –¢–∞—Ä–∏—Ñ    | –¶–µ–Ω–∞/–º–µ—Å | –û–ø–∏—Å–∞–Ω–∏–µ                             |
| -------- | -------- | ------------------------------------ |
| **Base** | 1 990 ‚ÇΩ  | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ + 1 —á–µ–∫-–∏–Ω/–Ω–µ–¥–µ–ª—é (async) |
| **Pro**  | 12 990 ‚ÇΩ | + –í–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞ + —á–∞—Ç + —Å–æ–∑–≤–æ–Ω    |
| **Pro+** | 19 990 ‚ÇΩ | + 7/7 —Ä–µ–∂–∏–º + mid-week —á–µ–∫-–∏–Ω        |

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã

```javascript
TRIAL_DAYS = 7; // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–∏–∞–ª–∞ (–¥–Ω–µ–π)
```

---

## üîÑ Lifecycle Flow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   TRIAL LIFECYCLE (v3.0)                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                      ‚îÇ
‚îÇ   [–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç]                                             ‚îÇ
‚îÇ          ‚îÇ                                                           ‚îÇ
‚îÇ          ‚ñº                                                           ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                   ‚îÇ
‚îÇ   ‚îÇ  Landing     ‚îÇ  –û—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞—è–≤–∫—É (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä)      ‚îÇ
‚îÇ   ‚îÇ  heyslab.ru  ‚îÇ  ‚Üí leads —Ç–∞–±–ª–∏—Ü–∞                                 ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                   ‚îÇ
‚îÇ          ‚îÇ  heys-api-leads ‚Üí INSERT INTO leads                       ‚îÇ
‚îÇ          ‚ñº                                                           ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                   ‚îÇ
‚îÇ   ‚îÇ    LEADS     ‚îÇ  –ö—É—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç –≤ –∞–¥–º–∏–Ω–∫–µ (—Å–µ–∫—Ü–∏—è ¬´–õ–∏–¥—ã —Å —Å–∞–π—Ç–∞¬ª)  ‚îÇ
‚îÇ   ‚îÇ   (–Ω–æ–≤—ã–π)    ‚îÇ  –°–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º, –æ–±—Å—É–∂–¥–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É      ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                   ‚îÇ
‚îÇ          ‚îÇ                                                           ‚îÇ
‚îÇ          ‚ñº  admin_convert_lead(lead_id, pin)                         ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                   ‚îÇ
‚îÇ   ‚îÇ   CLIENT     ‚îÇ  –°–æ–∑–¥–∞–Ω –∞–∫–∫–∞—É–Ω—Ç (phone + PIN)                     ‚îÇ
‚îÇ   ‚îÇ  + QUEUED    ‚îÇ  –î–æ–±–∞–≤–ª–µ–Ω –≤ trial_queue (status='queued')         ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                   ‚îÇ
‚îÇ          ‚îÇ                                                           ‚îÇ
‚îÇ          ‚îú‚îÄ‚îÄ –ö—É—Ä–∞—Ç–æ—Ä –æ—Ç–∫–ª–æ–Ω—è–µ—Ç ‚îÄ‚îÄ‚Üí status = 'rejected'               ‚îÇ
‚îÇ          ‚îÇ                                                           ‚îÇ
‚îÇ          ‚ñº  –ö—É—Ä–∞—Ç–æ—Ä: admin_activate_trial(client_id, start_date)     ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                   ‚îÇ
‚îÇ   ‚îÇ start_date = ‚îÇ  –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è ‚Üí —Å—Ä–∞–∑—É TRIAL (7 –¥–Ω–µ–π)             ‚îÇ
‚îÇ   ‚îÇ   —Å–µ–≥–æ–¥–Ω—è?   ‚îÇ  –ï—Å–ª–∏ –±—É–¥—É—â–∞—è –¥–∞—Ç–∞ ‚Üí TRIAL_PENDING               ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                   ‚îÇ
‚îÇ          ‚îÇ                                                           ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                     ‚îÇ
‚îÇ    ‚ñº           ‚ñº                                                     ‚îÇ
‚îÇ  TRIAL    trial_pending                                              ‚îÇ
‚îÇ (7 –¥–Ω–µ–π)  (–∂–¥—ë–º –¥–∞—Ç—É)                                                ‚îÇ
‚îÇ    ‚îÇ           ‚îÇ                                                     ‚îÇ
‚îÇ    ‚îÇ     –¥–∞—Ç–∞ –Ω–∞—Å—Ç—É–ø–∏–ª–∞                                              ‚îÇ
‚îÇ    ‚îÇ           ‚îÇ                                                     ‚îÇ
‚îÇ    ‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê                                                 ‚îÇ
‚îÇ    ‚îÇ      ‚îÇ TRIAL  ‚îÇ                                                 ‚îÇ
‚îÇ    ‚îÇ      ‚îÇ(7 –¥–Ω–µ–π)‚îÇ                                                 ‚îÇ
‚îÇ    ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò                                                 ‚îÇ
‚îÇ    ‚îÇ           ‚îÇ                                                     ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                                                     ‚îÇ
‚îÇ    ‚ñº           ‚ñº                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                               ‚îÇ
‚îÇ  ‚îÇ–û–ü–õ–ê–¢–ê‚îÇ  ‚îÇ  –ò–°–¢–Å–ö   ‚îÇ  ‚îÇ –û–¢–ú–ï–ù–Å–ù   ‚îÇ                               ‚îÇ
‚îÇ  ‚îÇactive‚îÇ  ‚îÇread_only ‚îÇ  ‚îÇ canceled  ‚îÇ                               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                               ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø

**–ö—É—Ä–∞—Ç–æ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ç—Ä–∏–∞–ª.** –û–Ω –≤—ã–±–∏—Ä–∞–µ—Ç –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞:

- –°–µ–≥–æ–¥–Ω—è ‚Üí —Ç—Ä–∏–∞–ª —Å—Ä–∞–∑—É (7 –¥–Ω–µ–π)
- –ë—É–¥—É—â–∞—è –¥–∞—Ç–∞ ‚Üí trial_pending, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ trial –∫–æ–≥–¥–∞ –Ω–∞—Å—Ç—É–ø–∏—Ç

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         FRONTEND                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  heys_subscription_v1.js     ‚îÇ  Core: STATUS, getStatus(),      ‚îÇ
‚îÇ                              ‚îÇ  activateTrialTimer(),            ‚îÇ
‚îÇ                              ‚îÇ  canWrite(), useSubscription()   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  heys_subscriptions_v1.js    ‚îÇ  UI: PLANS, PlanCard,            ‚îÇ
‚îÇ                              ‚îÇ  SubscriptionSection             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  heys_trial_queue_v1.js      ‚îÇ  Queue: requestTrial(),          ‚îÇ
‚îÇ                              ‚îÇ  getQueueStatus(),               ‚îÇ
‚îÇ                              ‚îÇ  useTrialQueue(), AdminUI        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  heys_paywall_v1.js          ‚îÇ  Paywall: PaywallModal           ‚îÇ
‚îÇ                              ‚îÇ  (read_only ‚Üí –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          BACKEND                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  heys-api-rpc (Yandex Cloud Function)                            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ request_trial                    (public)                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ get_trial_queue_status           (session)                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ cancel_trial_queue               (session)                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ get_public_trial_capacity        (public)                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ get_subscription_status_by_session (session)                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ activate_trial_timer_by_session  (session) ‚Üê DEPRECATED    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ admin_activate_trial             (admin)   ‚Üê v3.0 +date    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ admin_reject_request             (admin)                    ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ admin_get_leads                  (admin)   ‚Üê NEW v3.0      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ admin_convert_lead               (admin)   ‚Üê NEW v3.0      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         DATABASE                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  subscriptions (source of truth)                                 ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ trial_approved_at   ‚îÇ –ö–æ–≥–¥–∞ –∫—É—Ä–∞—Ç–æ—Ä –æ–¥–æ–±—Ä–∏–ª                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ trial_started_at    ‚îÇ –î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞ (–∫—É—Ä–∞—Ç–æ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç)       ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ trial_ends_at       ‚îÇ trial_started_at + 7 days            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ active_until        ‚îÇ –û–ø–ª–∞—á–µ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –¥–æ               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ canceled_at         ‚îÇ –û—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  trial_queue                                                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ status              ‚îÇ queued | assigned | canceled         ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ client_id           ‚îÇ FK ‚Üí clients                         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ assigned_at         ‚îÇ –ö–æ–≥–¥–∞ –∫—É—Ä–∞—Ç–æ—Ä –æ–¥–æ–±—Ä–∏–ª                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  clients (denormalized, –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)               ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ subscription_status ‚îÇ –ö–æ–ø–∏—è –∏–∑ get_effective_status        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ trial_started_at    ‚îÇ –ö–æ–ø–∏—è –∏–∑ subscriptions               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ trial_ends_at       ‚îÇ –ö–æ–ø–∏—è –∏–∑ subscriptions               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –í—ã—á–∏—Å–ª—è–µ–º—ã–π —Å—Ç–∞—Ç—É—Å (SQL)

```sql
-- get_effective_subscription_status(client_id) ‚Äî v3.0
CASE
  WHEN active_until > NOW()                                           THEN 'active'
  WHEN trial_started_at <= NOW() AND trial_ends_at > NOW()            THEN 'trial'
  WHEN trial_approved_at IS NOT NULL AND trial_started_at > NOW()     THEN 'trial_pending'
  WHEN trial_started_at IS NOT NULL OR active_until IS NOT NULL       THEN 'read_only'
  ELSE 'none'
END
```

---

## üîå API Reference

### JS API: `HEYS.Subscription`

```javascript
// –°—Ç–∞—Ç—É—Å—ã
HEYS.Subscription.STATUS = {
  NONE: 'none',
  TRIAL_PENDING: 'trial_pending',
  TRIAL: 'trial',
  ACTIVE: 'active',
  READ_ONLY: 'read_only',
};

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å (v3.0: no auto-trigger, curator controls start date)
const status = await HEYS.Subscription.getStatus();

// –•–µ–ª–ø–µ—Ä—ã
HEYS.Subscription.canWrite(status); // true for trial_pending, trial, active
HEYS.Subscription.shouldShowPaywall(status); // true for read_only
HEYS.Subscription.isActive(status); // true for trial_pending, trial, active

// React hook
const {
  status,
  isLoading,
  isTrialPending,
  isTrial,
  isActive,
  isReadOnly,
  canWrite,
  meta,
  refresh,
} = HEYS.Subscription.useSubscription();
```

### JS API: `HEYS.TrialQueue`

```javascript
// –ó–∞–ø—Ä–æ—Å –≤ –æ—á–µ—Ä–µ–¥—å (—Å –ª–µ–Ω–¥–∏–Ω–≥–∞ –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
await HEYS.TrialQueue.requestTrial('landing');

// –°—Ç–∞—Ç—É—Å –≤ –æ—á–µ—Ä–µ–¥–∏
await HEYS.TrialQueue.getQueueStatus();

// –û—Ç–º–µ–Ω–∞ –∑–∞—è–≤–∫–∏
await HEYS.TrialQueue.cancelQueue();

// React hook
const {
  capacity,
  queueStatus,
  isLoading,
  requestTrial,
  cancelQueue,
  isPending,
  isAssigned,
} = HEYS.TrialQueue.useTrialQueue();

// Admin API (–¥–ª—è –∫—É—Ä–∞—Ç–æ—Ä–æ–≤)
await HEYS.TrialQueue.admin.getQueueList();
await HEYS.TrialQueue.admin.activateTrial(clientId, '2026-02-15'); // v3.0: with start date
await HEYS.TrialQueue.admin.rejectApplication(clientId, reason);
await HEYS.TrialQueue.admin.getLeads('new'); // v3.0: leads from landing
await HEYS.TrialQueue.admin.convertLead(leadId, '1234'); // v3.0: create client from lead
```

### RPC API (Backend)

| –§—É–Ω–∫—Ü–∏—è                              | –î–æ—Å—Ç—É–ø  | –û–ø–∏—Å–∞–Ω–∏–µ                                  |
| ------------------------------------ | ------- | ----------------------------------------- |
| `request_trial`                      | Public  | –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –≤ –æ—á–µ—Ä–µ–¥—å                  |
| `get_trial_queue_status`             | Session | –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ (pending/assigned/rejected) |
| `cancel_trial_queue`                 | Session | –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É                           |
| `get_public_trial_capacity`          | Public  | –°–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ / –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª–∏ –æ—á–µ—Ä–µ–¥—å   |
| `get_subscription_status_by_session` | Session | –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ (–≤—ã—á–∏—Å–ª—è–µ–º—ã–π)             |
| `activate_trial_timer_by_session`    | Session | @deprecated v3.0 (–∫—É—Ä–∞—Ç–æ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç –¥–∞—Ç—É)  |
| `admin_activate_trial`               | Admin   | –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∏–∞–ª —Å –≤—ã–±–æ—Ä–æ–º –¥–∞—Ç—ã (v3.0)  |
| `admin_reject_request`               | Admin   | –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É                          |
| `admin_extend_trial`                 | Admin   | –ü—Ä–æ–¥–ª–∏—Ç—å —Ç—Ä–∏–∞–ª –Ω–∞ N –¥–Ω–µ–π                  |
| `admin_get_leads`                    | Admin   | –°–ø–∏—Å–æ–∫ –ª–∏–¥–æ–≤ —Å –ª–µ–Ω–¥–∏–Ω–≥–∞ (v3.0)            |
| `admin_convert_lead`                 | Admin   | –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ –ª–∏–¥–∞ (v3.0)            |

### –°–µ—Ä–≤–µ—Ä–Ω—ã–π write guard

```sql
-- subscription_can_write(client_id) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—É—é –∑–∞–ø–∏—Å—å –≤ KV:
-- save_client_kv, upsert_client_kv, batch_upsert_client_kv, delete_client_kv
-- –†–∞–∑—Ä–µ—à–∞–µ—Ç: active, trial, trial_pending
-- –ë–ª–æ–∫–∏—Ä—É–µ—Ç: read_only, none
```

---

## üìÅ File Structure

```
apps/web/
‚îú‚îÄ‚îÄ heys_subscription_v1.js       # Core: STATUS, getStatus(), activateTrialTimer()
‚îú‚îÄ‚îÄ heys_subscriptions_v1.js      # UI: PLANS, PlanCard, SubscriptionSection
‚îú‚îÄ‚îÄ heys_trial_queue_v1.js        # Queue: requestTrial(), AdminUI
‚îî‚îÄ‚îÄ heys_paywall_v1.js            # Paywall: PaywallModal

database/
‚îú‚îÄ‚îÄ 2025-01-09_simplified_trial_queue.sql     # Trial queue (pending ‚Üí assigned)
‚îú‚îÄ‚îÄ 2025-12-24_subscriptions_and_sessions_yc.sql  # Subscriptions + sessions (YC)
‚îú‚îÄ‚îÄ 2025-12-25_subscription_write_guard.sql   # Write guard (KV protection)
‚îú‚îÄ‚îÄ 2025-01-10_fix_subscription_sync.sql      # Fix clients‚Üîsubscriptions sync
‚îú‚îÄ‚îÄ 2026-02-04_extend_trials.sql              # admin_extend_trial
‚îú‚îÄ‚îÄ 2026-02-08_trial_machine_fix.sql          # v2.0: trial_approved_at + timer split
‚îî‚îÄ‚îÄ 2026-02-09_trial_machine_v3.sql           # v3.0: curator picks start date + leads
```

---

## üîß Troubleshooting

| –ü—Ä–æ–±–ª–µ–º–∞                       | –ü—Ä–∏—á–∏–Ω–∞                                | –†–µ—à–µ–Ω–∏–µ                                         |
| ------------------------------ | -------------------------------------- | ----------------------------------------------- |
| –ö–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ  | –°—Ç–∞—Ç—É—Å `none` –∏–ª–∏ `read_only`          | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `subscriptions` —Ç–∞–±–ª–∏—Ü—É               |
| –¢–∞–π–º–µ—Ä 7 –¥–Ω–µ–π –Ω–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª     | start_date –≤ –±—É–¥—É—â–µ–º (`trial_pending`) | –î–æ–∂–¥–∞—Ç—å—Å—è –¥–∞—Ç—ã –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ           |
| –°—Ç–∞—Ç—É—Å `trial_pending` –≤–∏—Å–∏—Ç   | –î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞ –µ—â—ë –Ω–µ –Ω–∞—Å—Ç—É–ø–∏–ª–∞           | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `subscriptions.trial_started_at`      |
| ¬´–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤¬ª         | `is_accepting = false`                 | –ö—É—Ä–∞—Ç–æ—Ä –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–∏—ë–º –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏           |
| clients.status ‚â† subscriptions | –î–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü                 | –ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑ `2025-01-10_fix_*` + `2026-02-08_*` |

---

## Changelog

| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞       | –ò–∑–º–µ–Ω–µ–Ω–∏—è                                                    |
| ------ | ---------- | ------------------------------------------------------------ |
| v3.0   | 2026-02-09 | Curator picks start date, leads management, date picker UI   |
| v2.0   | 2026-02-08 | Curator-gated flow, trial_approved_at, timer –Ω–∞ –ø–µ—Ä–≤—ã–π –ª–æ–≥–∏–Ω |
| v1.0   | 2025-01-10 | –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏                           |
