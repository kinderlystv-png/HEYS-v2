# üé´ HEYS Trial Machine

> **v2.0** | 2026-02-08 | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç—Ä–∏–∞–ª-—Å–∏—Å—Ç–µ–º—ã (curator-gated flow)

---

## üìä Quick Reference

### –°—Ç–∞—Ç—É—Å—ã –ø–æ–¥–ø–∏—Å–∫–∏ (`subscription_status`)

| –°—Ç–∞—Ç—É—Å          | –û–ø–∏—Å–∞–Ω–∏–µ                                  | –ó–∞–ø–∏—Å—å | –ß—Ç–µ–Ω–∏–µ |
| --------------- | ----------------------------------------- | ------ | ------ |
| `none`          | –ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏, –Ω–µ –æ–¥–æ–±—Ä–µ–Ω                  | ‚ùå     | ‚ùå     |
| `trial_pending` | –ö—É—Ä–∞—Ç–æ—Ä –æ–¥–æ–±—Ä–∏–ª, –∂–¥—ë–º –ø–µ—Ä–≤—ã–π –ª–æ–≥–∏–Ω        | ‚úÖ     | ‚úÖ     |
| `trial`         | –ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (7 –¥–Ω–µ–π –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–æ–≥–∏–Ω–∞) | ‚úÖ     | ‚úÖ     |
| `active`        | –û–ø–ª–∞—á–µ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞                       | ‚úÖ     | ‚úÖ     |
| `read_only`     | –¢—Ä–∏–∞–ª/–ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞                    | ‚ùå     | ‚úÖ     |

### –¢–∞—Ä–∏—Ñ—ã (`PLANS`)

| –¢–∞—Ä–∏—Ñ    | –¶–µ–Ω–∞/–º–µ—Å | –û–ø–∏—Å–∞–Ω–∏–µ                             |
| -------- | -------- | ------------------------------------ |
| **Base** | 1 990 ‚ÇΩ  | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ + 1 —á–µ–∫-–∏–Ω/–Ω–µ–¥–µ–ª—é (async) |
| **Pro**  | 12 990 ‚ÇΩ | + –í–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞ + —á–∞—Ç + —Å–æ–∑–≤–æ–Ω    |
| **Pro+** | 19 990 ‚ÇΩ | + 7/7 —Ä–µ–∂–∏–º + mid-week —á–µ–∫-–∏–Ω        |

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã

```javascript
TRIAL_DAYS = 7; // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–∏–∞–ª–∞ (–¥–Ω–µ–π)
```

---

## üîÑ Lifecycle Flow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   TRIAL LIFECYCLE (v2.0)                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                      ‚îÇ
‚îÇ   [–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç]                                             ‚îÇ
‚îÇ          ‚îÇ                                                           ‚îÇ
‚îÇ          ‚ñº                                                           ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                   ‚îÇ
‚îÇ   ‚îÇ  Landing     ‚îÇ  –û—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞—è–≤–∫—É (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä)      ‚îÇ
‚îÇ   ‚îÇ  heyslab.ru  ‚îÇ                                                   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                   ‚îÇ
‚îÇ          ‚îÇ  request_trial()                                          ‚îÇ
‚îÇ          ‚ñº                                                           ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                   ‚îÇ
‚îÇ   ‚îÇ  Trial Queue ‚îÇ  status = 'pending'                               ‚îÇ
‚îÇ   ‚îÇ   (pending)  ‚îÇ  –ö—É—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç –∑–∞—è–≤–∫—É –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏              ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                   ‚îÇ
‚îÇ          ‚îÇ                                                           ‚îÇ
‚îÇ          ‚îú‚îÄ‚îÄ –ö—É—Ä–∞—Ç–æ—Ä –æ—Ç–∫–ª–æ–Ω—è–µ—Ç ‚îÄ‚îÄ‚Üí status = 'rejected'               ‚îÇ
‚îÇ          ‚îÇ                                                           ‚îÇ
‚îÇ          ‚ñº  –ö—É—Ä–∞—Ç–æ—Ä –æ–¥–æ–±—Ä—è–µ—Ç: admin_activate_trial()                 ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                                   ‚îÇ
‚îÇ   ‚îÇ trial_pending ‚îÇ  –ö—É—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞—ë—Ç –∞–∫–∫–∞—É–Ω—Ç (phone + PIN)          ‚îÇ
‚îÇ   ‚îÇ              ‚îÇ  trial_approved_at = NOW()                        ‚îÇ
‚îÇ   ‚îÇ              ‚îÇ  trial_started_at = NULL (—Ç–∞–π–º–µ—Ä –ù–ï –∑–∞–ø—É—â–µ–Ω!)     ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                   ‚îÇ
‚îÇ          ‚îÇ                                                           ‚îÇ
‚îÇ          ‚ñº  –ö–ª–∏–µ–Ω—Ç –ª–æ–≥–∏–Ω–∏—Ç—Å—è –ø–æ PIN ‚Üí getStatus() ‚Üí trial_pending   ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  activate_trial_timer_by_session()                ‚îÇ
‚îÇ   ‚îÇ    TRIAL     ‚îÇ  trial_started_at = NOW()                         ‚îÇ
‚îÇ   ‚îÇ   (7 –¥–Ω–µ–π)   ‚îÇ  trial_ends_at = NOW() + 7 days                  ‚îÇ
‚îÇ   ‚îÇ              ‚îÇ  canWrite() = true                                ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                   ‚îÇ
‚îÇ          ‚îÇ                                                           ‚îÇ
‚îÇ          ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                          ‚îÇ
‚îÇ          ‚ñº               ‚ñº                ‚ñº                          ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                      ‚îÇ
‚îÇ   ‚îÇ  –û–ü–õ–ê–¢–ê  ‚îÇ    ‚îÇ  –ò–°–¢–Å–ö   ‚îÇ    ‚îÇ –û–¢–ú–ï–ù–Å–ù   ‚îÇ                      ‚îÇ
‚îÇ   ‚îÇ  active  ‚îÇ    ‚îÇread_only ‚îÇ    ‚îÇ canceled  ‚îÇ                      ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                      ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø

**–¢–∞–π–º–µ—Ä —Ç—Ä–∏–∞–ª–∞ (7 –¥–Ω–µ–π) —Å—Ç–∞—Ä—Ç—É–µ—Ç –ù–ï –ø—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –∫—É—Ä–∞—Ç–æ—Ä–æ–º, –∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º
–ª–æ–≥–∏–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞.** –≠—Ç–æ –¥–∞—ë—Ç –∫–ª–∏–µ–Ω—Ç—É –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ 7 –ø–æ–ª–Ω—ã—Ö –¥–Ω–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         FRONTEND                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  heys_subscription_v1.js     ‚îÇ  Core: STATUS, getStatus(),      ‚îÇ
‚îÇ                              ‚îÇ  activateTrialTimer(),            ‚îÇ
‚îÇ                              ‚îÇ  canWrite(), useSubscription()   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  heys_subscriptions_v1.js    ‚îÇ  UI: PLANS, PlanCard,            ‚îÇ
‚îÇ                              ‚îÇ  SubscriptionSection             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  heys_trial_queue_v1.js      ‚îÇ  Queue: requestTrial(),          ‚îÇ
‚îÇ                              ‚îÇ  getQueueStatus(),               ‚îÇ
‚îÇ                              ‚îÇ  useTrialQueue(), AdminUI        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  heys_paywall_v1.js          ‚îÇ  Paywall: PaywallModal           ‚îÇ
‚îÇ                              ‚îÇ  (read_only ‚Üí –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          BACKEND                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  heys-api-rpc (Yandex Cloud Function)                            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ request_trial                    (public)                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ get_trial_queue_status           (session)                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ cancel_trial_queue               (session)                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ get_public_trial_capacity        (public)                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ get_subscription_status_by_session (session)                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ activate_trial_timer_by_session  (session) ‚Üê NEW v2.0      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ admin_activate_trial             (admin)   ‚Üê UPDATED v2.0  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ admin_reject_request             (admin)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         DATABASE                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  subscriptions (source of truth)                                 ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ trial_approved_at   ‚îÇ –ö–æ–≥–¥–∞ –∫—É—Ä–∞—Ç–æ—Ä –æ–¥–æ–±—Ä–∏–ª                ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ trial_started_at    ‚îÇ –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∑–∞–ª–æ–≥–∏–Ω–∏–ª—Å—è  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ trial_ends_at       ‚îÇ trial_started_at + 7 days            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ active_until        ‚îÇ –û–ø–ª–∞—á–µ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –¥–æ               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ canceled_at         ‚îÇ –û—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  trial_queue                                                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ status              ‚îÇ pending | assigned | rejected        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ client_id           ‚îÇ FK ‚Üí clients                         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ assigned_at         ‚îÇ –ö–æ–≥–¥–∞ –∫—É—Ä–∞—Ç–æ—Ä –æ–¥–æ–±—Ä–∏–ª                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  clients (denormalized, –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)               ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ subscription_status ‚îÇ –ö–æ–ø–∏—è –∏–∑ get_effective_status        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ trial_started_at    ‚îÇ –ö–æ–ø–∏—è –∏–∑ subscriptions               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ trial_ends_at       ‚îÇ –ö–æ–ø–∏—è –∏–∑ subscriptions               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –í—ã—á–∏—Å–ª—è–µ–º—ã–π —Å—Ç–∞—Ç—É—Å (SQL)

```sql
-- get_effective_subscription_status(client_id)
CASE
  WHEN active_until > NOW()                                     THEN 'active'
  WHEN trial_ends_at > NOW()                                    THEN 'trial'
  WHEN trial_approved_at IS NOT NULL AND trial_started_at IS NULL THEN 'trial_pending'
  WHEN trial_started_at IS NOT NULL OR active_until IS NOT NULL   THEN 'read_only'
  ELSE 'none'
END
```

---

## üîå API Reference

### JS API: `HEYS.Subscription`

```javascript
// –°—Ç–∞—Ç—É—Å—ã
HEYS.Subscription.STATUS = {
  NONE: 'none',
  TRIAL_PENDING: 'trial_pending',
  TRIAL: 'trial',
  ACTIVE: 'active',
  READ_ONLY: 'read_only',
};

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å (auto-starts timer if trial_pending)
const status = await HEYS.Subscription.getStatus();

// –•–µ–ª–ø–µ—Ä—ã
HEYS.Subscription.canWrite(status); // true for trial_pending, trial, active
HEYS.Subscription.shouldShowPaywall(status); // true for read_only
HEYS.Subscription.isActive(status); // true for trial_pending, trial, active

// React hook
const {
  status,
  isLoading,
  isTrialPending,
  isTrial,
  isActive,
  isReadOnly,
  canWrite,
  meta,
  refresh,
} = HEYS.Subscription.useSubscription();
```

### JS API: `HEYS.TrialQueue`

```javascript
// –ó–∞–ø—Ä–æ—Å –≤ –æ—á–µ—Ä–µ–¥—å (—Å –ª–µ–Ω–¥–∏–Ω–≥–∞ –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
await HEYS.TrialQueue.requestTrial('landing');

// –°—Ç–∞—Ç—É—Å –≤ –æ—á–µ—Ä–µ–¥–∏
await HEYS.TrialQueue.getQueueStatus();

// –û—Ç–º–µ–Ω–∞ –∑–∞—è–≤–∫–∏
await HEYS.TrialQueue.cancelQueue();

// React hook
const {
  capacity,
  queueStatus,
  isLoading,
  requestTrial,
  cancelQueue,
  isPending,
  isAssigned,
} = HEYS.TrialQueue.useTrialQueue();

// Admin API (–¥–ª—è –∫—É—Ä–∞—Ç–æ—Ä–æ–≤)
await HEYS.TrialQueue.admin.getQueueList();
await HEYS.TrialQueue.admin.activateTrial(clientId);
await HEYS.TrialQueue.admin.rejectApplication(clientId, reason);
```

### RPC API (Backend)

| –§—É–Ω–∫—Ü–∏—è                              | –î–æ—Å—Ç—É–ø  | –û–ø–∏—Å–∞–Ω–∏–µ                                  |
| ------------------------------------ | ------- | ----------------------------------------- |
| `request_trial`                      | Public  | –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –≤ –æ—á–µ—Ä–µ–¥—å                  |
| `get_trial_queue_status`             | Session | –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ (pending/assigned/rejected) |
| `cancel_trial_queue`                 | Session | –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É                           |
| `get_public_trial_capacity`          | Public  | –°–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ / –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª–∏ –æ—á–µ—Ä–µ–¥—å   |
| `get_subscription_status_by_session` | Session | –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ (–≤—ã—á–∏—Å–ª—è–µ–º—ã–π)             |
| `activate_trial_timer_by_session`    | Session | –ó–∞–ø—É—Å—Ç–∏—Ç—å 7-–¥–Ω–µ–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä (–ø–µ—Ä–≤—ã–π –ª–æ–≥–∏–Ω) |
| `admin_activate_trial`               | Admin   | –û–¥–æ–±—Ä–∏—Ç—å —Ç—Ä–∏–∞–ª (–±–µ–∑ —Å—Ç–∞—Ä—Ç–∞ —Ç–∞–π–º–µ—Ä–∞)       |
| `admin_reject_request`               | Admin   | –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É                          |
| `admin_extend_trial`                 | Admin   | –ü—Ä–æ–¥–ª–∏—Ç—å —Ç—Ä–∏–∞–ª –Ω–∞ N –¥–Ω–µ–π                  |

### –°–µ—Ä–≤–µ—Ä–Ω—ã–π write guard

```sql
-- subscription_can_write(client_id) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—É—é –∑–∞–ø–∏—Å—å –≤ KV:
-- save_client_kv, upsert_client_kv, batch_upsert_client_kv, delete_client_kv
-- –†–∞–∑—Ä–µ—à–∞–µ—Ç: active, trial, trial_pending
-- –ë–ª–æ–∫–∏—Ä—É–µ—Ç: read_only, none
```

---

## üìÅ File Structure

```
apps/web/
‚îú‚îÄ‚îÄ heys_subscription_v1.js       # Core: STATUS, getStatus(), activateTrialTimer()
‚îú‚îÄ‚îÄ heys_subscriptions_v1.js      # UI: PLANS, PlanCard, SubscriptionSection
‚îú‚îÄ‚îÄ heys_trial_queue_v1.js        # Queue: requestTrial(), AdminUI
‚îî‚îÄ‚îÄ heys_paywall_v1.js            # Paywall: PaywallModal

database/
‚îú‚îÄ‚îÄ 2025-01-09_simplified_trial_queue.sql     # Trial queue (pending ‚Üí assigned)
‚îú‚îÄ‚îÄ 2025-12-24_subscriptions_and_sessions_yc.sql  # Subscriptions + sessions (YC)
‚îú‚îÄ‚îÄ 2025-12-25_subscription_write_guard.sql   # Write guard (KV protection)
‚îú‚îÄ‚îÄ 2025-01-10_fix_subscription_sync.sql      # Fix clients‚Üîsubscriptions sync
‚îú‚îÄ‚îÄ 2026-02-04_extend_trials.sql              # admin_extend_trial
‚îî‚îÄ‚îÄ 2026-02-08_trial_machine_fix.sql          # v2.0: trial_approved_at + timer split
```

---

## üîß Troubleshooting

| –ü—Ä–æ–±–ª–µ–º–∞                       | –ü—Ä–∏—á–∏–Ω–∞                               | –†–µ—à–µ–Ω–∏–µ                                         |
| ------------------------------ | ------------------------------------- | ----------------------------------------------- |
| –ö–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ  | –°—Ç–∞—Ç—É—Å `none` –∏–ª–∏ `read_only`         | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `subscriptions` —Ç–∞–±–ª–∏—Ü—É               |
| –¢–∞–π–º–µ—Ä 7 –¥–Ω–µ–π –Ω–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª     | –ö–ª–∏–µ–Ω—Ç –Ω–µ –ª–æ–≥–∏–Ω–∏–ª—Å—è (`trial_pending`) | –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –ø–æ PIN               |
| –°—Ç–∞—Ç—É—Å `trial_pending` –≤–∏—Å–∏—Ç   | `activate_trial_timer` –Ω–µ –≤—ã–∑–≤–∞–ª—Å—è    | –ü–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è ‚Äî getStatus() –∑–∞–ø—É—Å—Ç–∏—Ç           |
| ¬´–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤¬ª         | `is_accepting = false`                | –ö—É—Ä–∞—Ç–æ—Ä –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–∏—ë–º –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏           |
| clients.status ‚â† subscriptions | –î–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü                | –ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑ `2025-01-10_fix_*` + `2026-02-08_*` |

---

## Changelog

| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞       | –ò–∑–º–µ–Ω–µ–Ω–∏—è                                                    |
| ------ | ---------- | ------------------------------------------------------------ |
| v2.0   | 2026-02-08 | Curator-gated flow, trial_approved_at, timer –Ω–∞ –ø–µ—Ä–≤—ã–π –ª–æ–≥–∏–Ω |
| v1.0   | 2025-01-10 | –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏                           |
