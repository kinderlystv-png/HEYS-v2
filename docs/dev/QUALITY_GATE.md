# ✅ HEYS Quality Gate

> Единый стандарт качества, который **ловит проблемы сразу** и блокирует
> небезопасные отклонения ещё до коммита.

---

## Цель

- Ошибки должны быть видны **в IDE** сразу.
- Если отклонение не исправлено — **коммит блокируется**.
- Для legacy‑кода рост контролируется **индивидуальными лимитами**.

---

## Уровни контроля (в порядке приоритета)

### 1) IDE‑уровень (ранний сигнал)

**Что ловим:** архитектурные лимиты `heys_*.js` и общие ESLint правила.

**Как работает:**

- ESLint‑правило `@heys/module-architecture` читает
  `config/module-limits.json`.
- Нарушения видны сразу и требуют немедленной реакции.

### 2) Pre‑commit (жёсткий стоп)

**Что ловим:** превышения лимитов, `warnMissing`, критические ESLint ошибки.

**Что происходит:** коммит **блокируется** до исправления.

---

## Автолимиты legacy (обязательная часть)

- Файлы `apps/web/**/heys_*.js` имеют **индивидуальные лимиты**.
- Лимиты рассчитываются от текущих метрик с буфером $+10\%$.
- Превышение лимита **блокирует коммит**.

**Обновление раз в спринт:**

```bash
pnpm arch:limits:generate
```

Полный регламент: `docs/dev/AUTOLIMITS.md`.

---

## Правило поведения при нарушении

Если лимит превышен:

1. **Исправить сразу** (рефакторинг/вынос функций),
2. Либо **задать вопрос** о допустимом решении/допуске к росту.

Без этого коммит недопустим.

---

## Что считается “правильной архитектурой”

- Один домен ответственности на модуль
- Низкая связность (Dependency Injection вместо прямых `HEYS.*`)
- Нет `warnMissing()` fallbacks
- Чистые функции, где возможно

Документация:

- `docs/dev/MODULE_ARCHITECTURE.md`
- `docs/dev/CODE_STYLE.md`
- `docs/dev/ARCHITECTURE.md`

---

## Быстрые команды

```bash
pnpm arch:check            # Проверка архитектуры (staged)
pnpm arch:limits:generate  # Обновление лимитов (раз в спринт)
```
