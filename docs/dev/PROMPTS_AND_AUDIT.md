# üìù HEYS Prompts & Audit Guide

---

## –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

**–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ "—Å–¥–µ–ª–∞–π –ø—Ä–æ–º–ø—Ç" / "—Å–æ–∑–¥–∞–π –ø—Ä–æ–º–ø—Ç":**

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ

- **–®–∞–±–ª–æ–Ω**: `docs/TASK_PROMPT_TEMPLATE.md`
- **–§–∞–π–ª**: `docs/tasks/YYYY-MM-DD-slug.md`

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏

```markdown
## üìå TL;DR

- **–¶–µ–ª—å** ‚Äî 1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
- **–ß—Ç–æ –¥–µ–ª–∞–µ–º** ‚Äî –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
- **–ó–∞—á–µ–º** ‚Äî —Å–ø–∏—Å–æ–∫ –≤—ã–≥–æ–¥
- **–í—Ä–µ–º—è** ‚Äî –æ—Ü–µ–Ω–∫–∞ –≤ —á–∞—Å–∞—Ö
```

### –ü—Ä–∞–≤–∏–ª–∞

- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –ø—É—Ç–∏
- **–ù–ï –ø–∏—Å–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞** ‚Äî AI —Å–∞–º —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç
- –†—É—Å—Å–∫–∏–π —è–∑—ã–∫ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏–π

### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–º–ø—Ç–∞

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –≤ `docs/tasks/YYYY-MM-DD-slug.md`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å TL;DR —Å–µ–∫—Ü–∏—é
3. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –≤ `todo.md`

### –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–æ–º–ø—Ç–∞

- –û—Ç–º–µ—á–∞—Ç—å `[x]` –∑–∞–¥–∞—á–∏ –ø–æ –º–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ü–æ—Å–ª–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á ‚Üí `pnpm type-check && pnpm build`
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ `docs/tasks/archive/`
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∑–∞–¥–∞—á—É –≤ `done.md`

---

## –ì–ª—É–±–æ–∫–∏–π –∞—É–¥–∏—Ç –ø—Ä–æ–º–ø—Ç–∞

**–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ "—Å–¥–µ–ª–∞–π –∞—É–¥–∏—Ç –ø—Ä–æ–º–ø—Ç–∞" / "–ø—Ä–æ–≤–µ—Ä—å –ø—Ä–æ–º–ø—Ç":**

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç (–î–û –ø—Ä–∞–≤–æ–∫)

1. **–ü—Ä–æ—á–∏—Ç–∞—Ç—å –í–°–ï —Ñ–∞–π–ª—ã** –∏–∑ —Ç–∞–±–ª–∏—Ü—ã "–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã" (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!)
2. **–ù–∞–π—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã** ‚Äî `semantic_search`
3. **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —à–∏—Ä–µ** ‚Äî —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –æ–≤–µ—Ä–∫–∏–ª–ª** ‚Äî —É–±—Ä–∞—Ç—å –ª–∏—à–Ω–µ–µ

### –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞

- ‚ùì –≠—Ç–æ **production-ready** –∏–ª–∏ –∑–∞–≥–ª—É—à–∫–∞?
- ‚ùì –ï—Å—Ç—å –ª–∏ **–≥–æ—Ç–æ–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω** –≤ –ø—Ä–æ–µ–∫—Ç–µ?
- ‚ùì –ü—Ä–æ–¥—É–º–∞–Ω –ª–∏ **UX**: loading, errors, empty states?
- ‚ùì –ù–µ **–¥—É–±–ª–∏—Ä—É–µ—Ç** –ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª?

### –ü—Ä–∏–∑–Ω–∞–∫–∏ –Ω–µ–¥–æ–¥–µ–ª–∫–∏

- –ù–µ—Ç loading/error —Å–æ—Å—Ç–æ—è–Ω–∏–π
- –ñ—ë—Å—Ç–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö
- –ù–µ—Ç –∞–Ω–∏–º–∞—Ü–∏–∏ –≥–¥–µ –æ–Ω–∞ –æ–∂–∏–¥–∞–µ—Ç—Å—è
- –ù–µ—Ç feedback –ø—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –§–æ—Ä–º–∞—Ç –∞—É–¥–∏—Ç–∞

```markdown
## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–ª–æ–º–∞—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)

- [ ] –ü—Ä–æ–±–ª–µ–º–∞ 1 ‚Üí –†–µ—à–µ–Ω–∏–µ

## üü° –í–∞–∂–Ω—ã–µ (–º–æ–≥—É—Ç –≤—ã–∑–≤–∞—Ç—å –±–∞–≥–∏)

- [ ] –ü—Ä–æ–±–ª–µ–º–∞ 2 ‚Üí –†–µ—à–µ–Ω–∏–µ

## üü¢ –£–ª—É—á—à–µ–Ω–∏—è (nice to have)

- [ ] –ü—Ä–æ–±–ª–µ–º–∞ 3 ‚Üí –†–µ—à–µ–Ω–∏–µ

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏ –û–ö

- –ü—É–Ω–∫—Ç 1
```

---

## –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UI

### Mobile (Chrome DevTools ‚Üí iPhone SE)

- [ ] –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Touch targets ‚â•44px (`min-h-11`)
- [ ] –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç
- [ ] –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–ª–∞–≤–Ω—ã–µ

### Desktop (>768px)

- [ ] Hover-—ç—Ñ—Ñ–µ–∫—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Keyboard –Ω–∞–≤–∏–≥–∞—Ü–∏—è (Enter, Escape)

### –û–±—â–µ–µ

- [ ] `pnpm type-check` –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] `pnpm build` –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ console

---

## AI Workflow Rules

1. **HMR —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚Äî Vite –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
2. **–ö–æ–º–º–∏—Ç—ã —Ç–æ–ª—å–∫–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É** ‚Äî –∂–¥–∏ –∫–æ–º–∞–Ω–¥—ã "–∫–æ–º–º–∏—Ç" –∏–ª–∏ "–ø—É—à"
3. **–ú–∏–Ω–∏–º—É–º —à–∞–≥–æ–≤** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π HMR, –Ω–µ –¥–µ–ª–∞–π –ª–∏—à–Ω–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
4. **todo.md = —Ç–æ–ª—å–∫–æ –∑–∞–¥–∞—á–∏** ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ —Å—Ä–∞–∑—É –≤ `done.md`
5.  **–ù–ò–ö–û–ì–î–ê –ù–ï –û–¢–ö–ê–¢–´–í–ê–ô –§–ê–ô–õ–´** –±–µ–∑ —è–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è!

---

## üéØ –ö–æ–Ω—Ç–µ–∫—Å—Ç-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã

### –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å API/RPC:

- ‚úÖ –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π `*_by_session` —Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–µ UUID)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–π allowlist –≤ `SECURITY_RUNBOOK.md`
- ‚úÖ –î–æ–±–∞–≤–ª—è–π rate-limiting –¥–ª—è –Ω–æ–≤—ã—Ö endpoints
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π deprecated —Ñ—É–Ω–∫—Ü–∏–∏ (`verify_client_pin`, `get_client_data`)

### –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ë–î:

- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–π RLS –ø–æ–ª–∏—Ç–∏–∫–∏ **–ø–µ—Ä–µ–¥** –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –õ–æ–≥–∏—Ä—É–π –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (consents, payments)
- ‚úÖ PK –¥–ª—è `client_kv_store` = `(client_id, k)`, –Ω–µ `(user_id, client_id, k)`

### –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ñ–∏—á:

1. –ü—Ä–æ–≤–µ—Ä—å `HEYS_BRIEF.md` ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ —É–∂–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ
2. –ü—Ä–æ–≤–µ—Ä—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ (—Å–µ–∫—Ü–∏—è 5 –≤ BRIEF)
3. –£–±–µ–¥–∏—Å—å —á—Ç–æ –Ω–µ –Ω–∞—Ä—É—à–∞–µ—Ç **152-–§–ó compliance**
4. –ü—Ä–æ–≤–µ—Ä—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ **SLA –∫—É—Ä–∞—Ç–æ—Ä–∞** (‚â§30 –º–∏–Ω —Ä–µ–∞–∫—Ü–∏—è)

---

## ‚ö†Ô∏è –ß–µ–∫–ª–∏—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ü–µ—Ä–µ–¥ –õ–Æ–ë–´–ú –∫–æ–º–º–∏—Ç–æ–º:

- [ ] –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ credentials/tokens
- [ ] –ù–µ—Ç `console.log` —Å sensitive data
- [ ] –ù–µ—Ç –ø—Ä—è–º—ã—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–π RPC)
- [ ] –ù–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö CDN (152-–§–ó!)
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `YandexAPI`, –Ω–µ `Supabase SDK`

### –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã –ë–î:

- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è **–æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞**
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] Env vars –∏—Å–ø–æ–ª—å–∑—É—é—Ç `PG_*` (–Ω–µ `DB_*`)

### –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏:

- [ ] –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π (dedupe_key)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `yookassa_webhook_events`
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ `subscription_status` –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º

### –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å auth:

- [ ] –ò—Å–ø–æ–ª—å–∑—É–π `verify_client_pin_v3` (–Ω–µ v1/v2)
- [ ] –ü—Ä–æ–≤–µ—Ä—è–π `locked_until` –≤ `pin_login_attempts`
- [ ] Session token —Ö—ç—à–∏—Ä—É–µ—Ç—Å—è (`token_hash` BYTEA)

---

## üíº –ë–∏–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ä–µ—à–µ–Ω–∏–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (–æ—Ç –≤—ã—Å—à–µ–≥–æ –∫ –Ω–∏–∑—à–µ–º—É):

1. **152-–§–ó Compliance** ‚Äî non-negotiable
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –Ω–∏–∫–∞–∫–∏—Ö –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤
3. **SLA –∫—É—Ä–∞—Ç–æ—Ä–∞** ‚Äî ‚â§30 –º–∏–Ω —Ä–µ–∞–∫—Ü–∏—è
4. **–ö–æ–Ω–≤–µ—Ä—Å–∏—è —Ç—Ä–∏–∞–ª–∞** ‚Äî 7 –¥–Ω–µ–π –Ω–∞ "–≤–∞—É-—ç—Ñ—Ñ–µ–∫—Ç"
5. **UX –∫–ª–∏–µ–Ω—Ç–∞** ‚Äî < 30 —Å–µ–∫ –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –µ–¥—ã
6. **–ù–æ–≤—ã–µ —Ñ–∏—á–∏** ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

### Trade-offs:

| –í—ã–±–∏—Ä–∞–π              | –í–º–µ—Å—Ç–æ              | –ü–æ—á–µ–º—É                    |
| -------------------- | ------------------- | ------------------------- |
| –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å           | –°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ | –ü–ª–∞—Ç–µ–∂–∏/–¥–∞–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–Ω—ã   |
| –ü—Ä–æ—Å—Ç–æ—Ç–∞             | –≠–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç—å        | –ö—É—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ–Ω–∏–º–∞—Ç—å   |
| –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç   | –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π         | –°–æ–º–Ω–µ–≤–∞–µ—à—å—Å—è = –±–µ–∑–æ–ø–∞—Å–Ω—ã–π |
| –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω | –ù–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ       | –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∫–æ–¥–∞      |

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

- **–ö–æ–Ω–≤–µ—Ä—Å–∏—è**: `trial_start` ‚Üí `payment_success`
- **–ê–∫—Ç–∏–≤–∞—Ü–∏—è**: ‚â•4 –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω—è –∑–∞ —Ç—Ä–∏–∞–ª
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω < 1 —Å–µ–∫

---

## üìù –°—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–≤—Å–µ–≥–¥–∞):

1. **–°—É—Ç—å** ‚Äî –æ—Ç–≤–µ—Ç –≤ 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
2. **–ö–æ–¥/–¥–µ—Ç–∞–ª–∏** ‚Äî –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
3. **–†–∏—Å–∫–∏** ‚Äî —á—Ç–æ –º–æ–∂–µ—Ç –ø–æ–π—Ç–∏ –Ω–µ —Ç–∞–∫
4. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã** ‚Äî –¥—Ä—É–≥–∏–µ –ø–æ–¥—Ö–æ–¥—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)

### –•–æ—Ä–æ—à–∏–µ –æ—Ç–≤–µ—Ç—ã:

```
‚úÖ "–≠—Ç–æ –Ω–∞—Ä—É—à–∏—Ç 152-–§–ó. –ò—Å–ø–æ–ª—å–∑—É–π Yandex Metrica –≤–º–µ—Å—Ç–æ GA4"
‚úÖ "–§—É–Ω–∫—Ü–∏—è deprecated. –ó–∞–º–µ–Ω–∏ verify_client_pin –Ω–∞ verify_client_pin_v3"
‚úÖ "–î–æ–±–∞–≤—å –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ ‚Äî —Å–µ–π—á–∞—Å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –Ω—É–∂–Ω–æ –∫ v2"
‚úÖ "–£–∂–µ –µ—Å—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω –≤ heys_widgets_v1.js:245 ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ"
```

### –ü–ª–æ—Ö–∏–µ –æ—Ç–≤–µ—Ç—ã:

```
‚ùå –î–ª–∏–Ω–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –±–µ–∑ –∫–æ–¥–∞
‚ùå –ö–æ–¥ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–≥–Ω–æ—Ä–∏—Ä—É—é—â–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
‚ùå "–≠—Ç–æ —Å–ª–æ–∂–Ω–æ" –±–µ–∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤
```

---

## üîÑ –ü–∞—Ç—Ç–µ—Ä–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞/–º–∏–≥—Ä–∞—Ü–∏–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:

1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (SECURITY_RUNBOOK)
2. –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—É—Ç–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. Dead code removal
4. –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–∞—Ç—Ç–µ—Ä–Ω –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:

```
1. –°–æ–∑–¥–∞–π –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é (fn_v2, fn_v3)
2. –î–æ–±–∞–≤—å deprecation warning –≤ —Å—Ç–∞—Ä—É—é
3. –ú–∏–≥—Ä–∏—Ä—É–π –≤—ã–∑–æ–≤—ã –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
4. –£–¥–∞–ª–∏ —Å—Ç–∞—Ä—É—é —á–µ—Ä–µ–∑ 2 —Ä–µ–ª–∏–∑–∞
```

### –ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –í–°–ï–ì–î–ê:

- [ ] –°–æ—Ö—Ä–∞–Ω—è–π –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π breaking changes
- [ ] –¢–µ—Å—Ç–∏—Ä—É–π –æ–±–∞ –ø—É—Ç–∏ (—Å—Ç–∞—Ä—ã–π –∏ –Ω–æ–≤—ã–π)
- [ ] –î–æ–±–∞–≤–ª—è–π –≤ CHANGELOG

---

## üè† HEYS-specific –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### Curator flow:

```javascript
// –í–°–ï–ì–î–ê –ø—Ä–æ–≤–µ—Ä—è–π curator_id –≤ RLS
// –í–°–ï–ì–î–ê –ª–æ–≥–∏—Ä—É–π –¥–µ–π—Å—Ç–≤–∏—è –∫—É—Ä–∞—Ç–æ—Ä–∞
// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π bulk –æ–ø–µ—Ä–∞—Ü–∏–∏ (batch_upsert_client_kv_by_session)
```

### Trial –º–µ—Ö–∞–Ω–∏–∫–∞:

```javascript
// start_trial_by_session ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
// –ü—Ä–æ–≤–µ—Ä—è–π trial_ends_at –≤–æ –í–°–ï–• –ø–ª–∞—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
// Queue system: request_trial ‚Üí assign_trials_from_queue
```

### Widget —Å–∏—Å—Ç–µ–º–∞:

```javascript
// S/M/L —Ä–∞–∑–º–µ—Ä—ã = —É—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
// Popup –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ø–æ –∫–ª–∏–∫—É)
// –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤ client_kv_store
// –®–∞–±–ª–æ–Ω: —Å–º. heys_widgets_v1.js
```

### Insulin Wave —Ä–∞—Å—á—ë—Ç:

```javascript
// 37 —Ñ–∞–∫—Ç–æ—Ä–æ–≤ ‚Äî –ö–≠–®–ò–†–£–ô —Ä–µ–∑—É–ª—å—Ç–∞—Ç
// –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–π —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
// –ò—Å–ø–æ–ª—å–∑—É–π debounce –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö
```

### Storage –ø–∞—Ç—Ç–µ—Ä–Ω—ã:

```javascript
// U.lsSet/lsGet ‚Äî —Å clientId namespace
// HEYS.store ‚Äî —Å –∫—ç—à–µ–º –∏ watchers
// HEYS.YandexAPI.rpc() ‚Äî –¥–ª—è cloud sync
// –ù–ò–ö–û–ì–î–ê –Ω–∞–ø—Ä—è–º—É—é localStorage.setItem()
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞:

```javascript
// 1. –õ–æ–∫–∞–ª—å–Ω–æ: HEYS.products.setAll(newProducts)
// 2. Cloud: create_pending_product_by_session ‚Üí publish
// 3. Shared: publish_shared_product_by_session
// –í–†–ï–ú–Ø: < 30 —Å–µ–∫ –æ—Ç —Ñ–æ—Ç–æ –¥–æ –∑–∞–ø–∏—Å–∏ –≤ –¥–Ω–µ–≤–Ω–∏–∫
```

---

## üö® –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (Always Check)

**–ü—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–π:**

| –ï—Å–ª–∏ –≤–∏–¥–∏—à—å                        | ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–¥–∏                       |
| ---------------------------------- | ----------------------------------- |
| `supabase.from()` / `cloud.client` | –ò—Å–ø–æ–ª—å–∑—É–π `HEYS.YandexAPI.rpc()`    |
| `localStorage.setItem()`           | –ò—Å–ø–æ–ª—å–∑—É–π `U.lsSet()` —Å namespace   |
| `console.log()` —Å –¥–∞–Ω–Ω—ã–º–∏          | –ó–∞–º–µ–Ω–∏ –Ω–∞ `HEYS.analytics.track*()` |
| UUID –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö RPC              | –ò—Å–ø–æ–ª—å–∑—É–π `*_by_session` —Ñ—É–Ω–∫—Ü–∏–∏    |
| `fetch()` –∫ –≤–Ω–µ—à–Ω–∏–º API            | –ü—Ä–æ–≤–µ—Ä—å 152-–§–ó compliance           |
| `style={{}}` –≤ JSX                 | –ò—Å–ø–æ–ª—å–∑—É–π Tailwind –∫–ª–∞—Å—Å—ã           |
| –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞/–∫–æ–ª–æ–Ω–∫–∞              | –ù—É–∂–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∏                  |
| `verify_client_pin`                | –ò—Å–ø–æ–ª—å–∑—É–π `verify_client_pin_v3`    |

---

## üîó Quick Reference (—á–∞—Å—Ç—ã–µ —Ñ–∞–π–ª—ã)

| –ó–∞–¥–∞—á–∞            | –§–∞–π–ª      | –ü—É—Ç—å                                           |
| ----------------- | --------- | ---------------------------------------------- |
| –î–æ–±–∞–≤–∏—Ç—å RPC      | allowlist | `yandex-cloud-functions/heys-api-rpc/index.js` |
| –ù–æ–≤–∞—è SQL —Ñ—É–Ω–∫—Ü–∏—è | –º–∏–≥—Ä–∞—Ü–∏—è  | `database/YYYY-MM-DD_*.sql`                    |
| UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç      | DayTab    | `apps/web/public/js/heys_day_v12.js`           |
| –ê–Ω–∞–ª–∏—Ç–∏–∫–∞         | –º–æ–¥—É–ª–∏    | `apps/web/public/js/heys_*_v1.js`              |
| –ü—Ä–æ—Ñ–∏–ª—å/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | UserTab   | `apps/web/public/js/heys_user_v12.js`          |
| –ü—Ä–æ–¥—É–∫—Ç—ã/–ø–æ–∏—Å–∫    | Core      | `apps/web/public/js/heys_core_v12.js`          |
| –°–æ–≤–µ—Ç—ã            | Advice    | `apps/web/public/js/heys_advice_v1.js`         |
| –ò–Ω—Å—É–ª–∏–Ω–æ–≤–∞—è –≤–æ–ª–Ω–∞ | Wave      | `apps/web/public/js/heys_insulin_wave_v1.js`   |
| –ü–æ–¥–ø–∏—Å–∫–∏          | Subs      | `apps/web/public/js/heys_subscriptions_v1.js`  |
| –°—Ç–∏–ª–∏             | CSS       | `apps/web/styles/heys-components.css`          |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å      | runbook   | `docs/SECURITY_RUNBOOK.md`                     |
| –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö     | reference | `docs/DATA_MODEL_REFERENCE.md`                 |

---

## üêõ Debug Helpers

### –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:

```javascript
// –°—Ç–∞—Ç—É—Å —Å–µ—Å—Å–∏–∏
heysStats();

// Cloud —Å—Ç–∞—Ç—É—Å
HEYS.cloud.getStatus(); // 'online' | 'offline'

// –¢–µ–∫—É—â–∏–π –∫–ª–∏–µ–Ω—Ç
U.lsGet('heys_profile');

// –í—Å–µ –∫–ª—é—á–∏ localStorage
Object.keys(localStorage).filter((k) => k.startsWith('heys_'));

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å orphan –ø—Ä–æ–¥—É–∫—Ç—ã
HEYS.orphanProducts?.list();

// –†–µ–∂–∏–º auth
console.log('RPC only:', HEYS.cloud._rpcOnlyMode);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API:

```bash
# Health check
curl -s https://api.heyslab.ru/health

# RPC —Ç–µ—Å—Ç
curl -s -X POST 'https://api.heyslab.ru/rpc?fn=get_shared_products' \
  -H 'Content-Type: application/json' \
  -H 'Origin: https://app.heyslab.ru' \
  -d '{}' | head -c 200
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–∏—á–∏–Ω—ã –±–∞–≥–æ–≤:

| –°–∏–º–ø—Ç–æ–º               | –í–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞      | –ü—Ä–æ–≤–µ—Ä—å                         |
| --------------------- | ---------------------- | ------------------------------- |
| –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è | –ù–µ–≤–µ—Ä–Ω—ã–π clientId      | `U.lsSet()` vs `localStorage`   |
| 403 –Ω–∞ RPC            | –§—É–Ω–∫—Ü–∏—è –Ω–µ –≤ allowlist | `heys-api-rpc/index.js`         |
| UI –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è     | –ú—É—Ç–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–∞        | –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π `{...old}`         |
| –ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω     | Orphan –ø–æ—Å–ª–µ sync      | `HEYS.orphanProducts.restore()` |
| 400 refresh_token     | RTR –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π        | –û—á–∏—Å—Ç–∏—Ç—å localStorage           |

---

## ‚úÖ –ö–æ–¥-–ø–∞—Ç—Ç–µ—Ä–Ω—ã (–∫–æ–ø–∏—Ä—É–π –∫–∞–∫ —à–∞–±–ª–æ–Ω)

### RPC –≤—ã–∑–æ–≤ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî session-based
const result = await HEYS.YandexAPI.rpc('get_client_kv_by_session', {
  session_token: HEYS.cloud.getSessionToken(),
  k: 'heys_profile',
});

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚Äî UUID –Ω–∞–ø—Ä—è–º—É—é (IDOR!)
const result = await HEYS.YandexAPI.rpc('get_client_kv', {
  client_id: clientId, // –ù–ï –î–ï–õ–ê–ô –¢–ê–ö!
  k: 'heys_profile',
});
```

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage:

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî —Å namespace
U.lsSet('heys_products', products);
U.lsGet('heys_products', []);

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –±–µ–∑ namespace
localStorage.setItem('products', JSON.stringify(products));
```

### React state update:

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç
setDay((prev) => ({ ...prev, waterMl: prev.waterMl + 250 }));

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –º—É—Ç–∞—Ü–∏—è
day.waterMl += 250;
setDay(day); // React –Ω–µ —É–≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ!
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–≤–µ—Ç–∞:

```javascript
// –í heys_advice_v1.js, –º–∞—Å—Å–∏–≤ ADVICE_RULES
{
  id: 'my_new_advice',
  condition: (ctx) => ctx.proteinPct < 0.5 && ctx.hour >= 14,
  priority: 3,
  category: 'nutrition',
  triggers: ['tab_open', 'product_added'],
  message: (ctx) => `–ú–∞–ª–æ–≤–∞—Ç–æ –±–µ–ª–∫–∞: ${Math.round(ctx.proteinPct * 100)}%`,
  icon: 'ü•©'
}
```

---

## üéØ Impact Radius (—á—Ç–æ —Å–ª–æ–º–∞–µ—Ç—Å—è)

**–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ ‚Äî –í–°–ï–ì–î–ê –¥—É–º–∞–π –æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö:**

| –ò–∑–º–µ–Ω—è–µ–º—ã–π —Ñ–∞–π–ª            | –ü—Ä–æ–≤–µ—Ä—å —ç—Ç–∏ —Ñ–∞–π–ª—ã                        | –ü–æ—á–µ–º—É                     |
| -------------------------- | ---------------------------------------- | -------------------------- |
| `heys_models_v1.js`        | –í–°–ï `heys_*.js`                          | –ú–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–µ–∑–¥–µ  |
| `heys_core_v12.js`         | `heys_day_v12.js`, `heys_reports_v12.js` | –ü—Ä–æ–¥—É–∫—Ç—ã, –ø–æ–∏—Å–∫, —É—Ç–∏–ª–∏—Ç—ã   |
| `heys_storage_layer_v1.js` | `heys_cloud.sync()`, `U.lsSet/Get`       | Storage –≤–µ–∑–¥–µ              |
| `heys_yandex_api_v1.js`    | –í—Å–µ RPC –≤—ã–∑–æ–≤—ã                           | API –∫–ª–∏–µ–Ω—Ç –µ–¥–∏–Ω—ã–π          |
| `heys_subscriptions_v1.js` | Paywall, —Ç—Ä–∏–∞–ª, read-only –≥–µ–π—Ç–∏–Ω–≥        | –í–ª–∏—è–µ—Ç –Ω–∞ –¥–æ—Å—Ç—É–ø           |
| SQL —Ñ—É–Ω–∫—Ü–∏—è                | `heys-api-rpc/index.js` allowlist        | –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ allowlist |
| CSS –∫–ª–∞—Å—Å—ã                 | –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å —ç—Ç–∏–º –∫–ª–∞—Å—Å–æ–º            | Grep –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º!      |

### –ü–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏/–ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
grep -r "functionName" apps/web/public/js/

# –ù–∞–π—Ç–∏ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª—è
grep -r "HEYS.ModuleName" apps/web/
```

---

## ‚ùì –ö–æ–≥–¥–∞ —Å–ø—Ä–æ—Å–∏—Ç—å (–∞ –Ω–µ —É–≥–∞–¥—ã–≤–∞—Ç—å)

**–õ—É—á—à–µ —É—Ç–æ—á–Ω–∏—Ç—å, —á–µ–º –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å! –°–ø—Ä–∞—à–∏–≤–∞–π –µ—Å–ª–∏:**

| –°–∏—Ç—É–∞—Ü–∏—è                      | –ü—Ä–∏–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞                                          |
| ----------------------------- | ------------------------------------------------------- |
| –ù–µ—è—Å–µ–Ω scope –∏–∑–º–µ–Ω–µ–Ω–∏—è        | "–≠—Ç–æ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö?"         |
| –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ä–µ—à–µ–Ω–∏—è   | "–í–∞—Ä–∏–∞–Ω—Ç A –±—ã—Å—Ç—Ä–µ–µ, B –Ω–∞–¥—ë–∂–Ω–µ–µ ‚Äî —á—Ç–æ –≤–∞–∂–Ω–µ–µ?"           |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –ë–î      | "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é?"     |
| –ù–µ—è—Å–Ω—ã –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞         | "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫—É –∏–ª–∏ fallback –Ω–∞ –¥–µ—Ñ–æ–ª—Ç?"             |
| Breaking change               | "–≠—Ç–æ —Å–ª–æ–º–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî –¥–µ–ª–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é?"          |
| –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º | "–ù–∞—à—ë–ª –ø–æ—Ö–æ–∂—É—é –ª–æ–≥–∏–∫—É –≤ X ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –∏–ª–∏ –Ω–æ–≤—É—é?" |

### –ù–ï —Å–ø—Ä–∞—à–∏–≤–∞–π –µ—Å–ª–∏:

- ‚ùå –û—á–µ–≤–∏–¥–Ω–∞—è –æ–ø–µ—á–∞—Ç–∫–∞/–±–∞–≥ ‚Äî –ø—Ä–æ—Å—Ç–æ —Ñ–∏–∫—Å–∏
- ‚ùå –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ
- ‚ùå –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ–≤–æ—Ä–∏—Ç –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ ‚Äî —Å–ª–µ–¥—É–π –µ–π

---

## ‚ö° Performance Hints (–∫–æ–≥–¥–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å)

**HEYS-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞:**

| –ú–æ–¥—É–ª—å            | –ü—Ä–æ–±–ª–µ–º–∞                       | –†–µ—à–µ–Ω–∏–µ                                         |
| ----------------- | ------------------------------ | ----------------------------------------------- |
| –ò–Ω—Å—É–ª–∏–Ω–æ–≤–∞—è –≤–æ–ª–Ω–∞ | 37 —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –Ω–∞ –∫–∞–∂–¥—ã–π –ø—Ä–∏—ë–º    | `useMemo` + –ø–µ—Ä–µ—Å—á—ë—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ meals |
| –ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤   | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è 1000+ –ø—Ä–æ–¥—É–∫—Ç–æ–≤     | `debounce(300ms)` –Ω–∞ input                      |
| Week heatmap      | –ó–∞–≥—Ä—É–∑–∫–∞ 7 –¥–Ω–µ–π –¥–∞–Ω–Ω—ã—Ö         | `Promise.all` –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ                       |
| Sparkline –≥—Ä–∞—Ñ–∏–∫–∏ | –ú–Ω–æ–≥–æ —Ç–æ—á–µ–∫ = –º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä | –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ 30 —Ç–æ—á–µ–∫                          |
| Advice rules      | 182 –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è        | –†–∞–Ω–Ω–∏–π `return` –≤ —É—Å–ª–æ–≤–∏—è—Ö                      |

### –ö–æ–≥–¥–∞ –ù–ï –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å:

- ‚ùå –ö–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–µ–¥–∫–æ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø—Ä–æ—Ñ–∏–ª—å)
- ‚ùå –î–∞–Ω–Ω—ã—Ö –º–∞–ª–æ (<100 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
- ‚ùå –£–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Å—Ç—Ä–æ (<100ms)
- ‚ùå Premature optimization ‚Äî —Å–Ω–∞—á–∞–ª–∞ –∏–∑–º–µ—Ä—å!

### –®–∞–±–ª–æ–Ω –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π:

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –º–µ–º–æ–∏–∑–∞—Ü–∏—è —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
const heavyResult = useMemo(() => {
  return calculateSomethingHeavy(data);
}, [data.id, data.updatedAt]); // –ù–ï –≤–µ—Å—å –æ–±—ä–µ–∫—Ç!

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –ø–µ—Ä–µ—Å—á—ë—Ç –Ω–∞ –∫–∞–∂–¥—ã–π —Ä–µ–Ω–¥–µ—Ä
const heavyResult = calculateSomethingHeavy(data);
```

---

## üîÑ Offline/Fallback –ø–∞—Ç—Ç–µ—Ä–Ω—ã (PWA)

**HEYS —Ä–∞–±–æ—Ç–∞–µ—Ç offline! –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏:**

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è "Local First":

```javascript
// 1. –°–Ω–∞—á–∞–ª–∞ —á–∏—Ç–∞–π –ª–æ–∫–∞–ª—å–Ω–æ
const localData = U.lsGet('heys_products', []);

// 2. –ü–æ–∫–∞–∑—ã–≤–∞–π —Å—Ä–∞–∑—É (–Ω–µ –∂–¥–∏ —Å–µ—Ç—å)
setProducts(localData);

// 3. –ü–æ—Ç–æ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π –≤ —Ñ–æ–Ω–µ
HEYS.cloud
  .syncProducts()
  .then((updated) => {
    if (updated) setProducts(updated);
  })
  .catch(() => {
    // –û—Ñ–ª–∞–π–Ω ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –ø–æ–∫–∞–∑–∞–Ω—ã
  });
```

### Fallback –¥–ª—è RPC:

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî graceful degradation
try {
  const result = await HEYS.YandexAPI.rpc('get_shared_products', {});
  return result;
} catch (e) {
  console.warn('[HEYS] Offline, using cached products');
  return U.lsGet('heys_shared_products_cache', []);
}
```

### –ò–Ω–¥–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:

```javascript
// –ü–æ–∫–∞–∑—ã–≤–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
const status = HEYS.cloud.getStatus(); // 'online' | 'offline' | 'syncing'
// UI: –ø–æ–∫–∞–∑–∞—Ç—å –±–µ–π–¥–∂ –µ—Å–ª–∏ offline
```

### –ö–æ–≥–¥–∞ –ù–ï –¥–µ–ª–∞—Ç—å offline:

- ‚ùå –ü–ª–∞—Ç–µ–∂–∏ ‚Äî —Ç–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω
- ‚ùå SMS –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Äî —Ç—Ä–µ–±—É–µ—Ç —Å–µ—Ç—å
- ‚ùå –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî curator-only –æ–ø–µ—Ä–∞—Ü–∏—è
