# Prompt: MealRec UX ‚Äî –∫–Ω–æ–ø–∫–∞ "+" —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π flow –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞

> **–í–µ—Ä—Å–∏—è –ø—Ä–æ–º–ø—Ç–∞**: 3.0 (POST-IMPLEMENTATION AUDIT)  
> **–î–∞—Ç–∞**: 2026-02-16  
> **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (–ë–ª–æ–∫–µ—Ä—ã 1-6)  
> **–≠—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç**: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–ª–æ–∫–µ—Ä–æ–≤ + WOW-—Ñ–∏—á–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö
> –∏—Ç–µ—Ä–∞—Ü–∏–π

---

## üìä Executive Summary (Audit Results)

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (v15.0 ‚Äî Sprint 1 Complete)

- –ë–ª–æ–∫–µ—Ä 1-6: Meal picker flow —á–µ—Ä–µ–∑ ConfirmModal + AddProductStep
- R1: Smart meal auto-select –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–Ω—è
- R6: **Smart Grams Pre-fill** (suggestion.grams ‚Üí initialGrams –≤ –º–æ–¥–∞–ª–∫–µ) ‚úÖ
- R5: **Toast notifications** –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ ‚úÖ
- –ë–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ markFollowed
- Race condition script loading –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- **Verification logging** –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π ‚úÖ

**Expected Console Logs (Sprint 1):**

```javascript
[MEALREC][HEYS.mealRec.card] üìä Opening AddProductStep: {
  initialSearch: "–Ø–π—Ü–æ –≤–∞—Ä—ë–Ω–æ–µ",
  initialGrams: 158,
  suggestedGrams: 158,
  usingMLGrams: true,
  mealIndex: 0
}

[HEYS.addProduct] üì¶ Open modal {
  mealIndex: 0,
  productsCount: 296,
  initialSearch: "–Ø–π—Ü–æ –≤–∞—Ä—ë–Ω–æ–µ",
  initialGrams: 158,
  usingMLGrams: true
}

[MEALREC][HEYS.mealRec.card] üéâ Toast shown: {
  product: "–Ø–π—Ü–æ –≤–∞—Ä—ë–Ω–æ–µ",
  grams: 158,
  mealName: "–ó–∞–≤—Ç—Ä–∞–∫",
  toastAPI: "HEYS.Toast.success"
}
```

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã (MUST FIX –≤ Sprint 2)

- **–ë–ª–æ–∫–µ—Ä 11 / R8**: initialSearch –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
- **–ë–ª–æ–∫–µ—Ä 10**: Empty products array crash (–Ω–µ—Ç retry logic)
- **–ë–ª–æ–∫–µ—Ä 15**: HEYS.Toast API –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω (–º–æ–∂–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å)

### ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (Sprint 2)

- –ë–ª–æ–∫–µ—Ä 7: API —Å–æ–∑–¥–∞–Ω–∏—è meal –Ω–µ –Ω–∞–π–¥–µ–Ω (fallback —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ –æ–ø—Ç–∏–º–∞–ª–µ–Ω)
- –ë–ª–æ–∫–µ—Ä 9: Timing heysProductAdded vs followedRef (edge case)
- –ë–ª–æ–∫–µ—Ä 8: Race condition –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–ª–∏–∫–æ–≤ (debounce –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
- R7: Product Picker Shortcut (—É—Å–∫–æ—Ä–µ–Ω–∏–µ UX)

### üé® –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (Sprint 3+)

- R2-R4, R10-R11: Macro preview, transitions, undo, nutrition impact

### üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã (MUST FIX –≤ Sprint 2)

- **–ë–ª–æ–∫–µ—Ä 11 / R8**: initialSearch –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ (—ë‚Üí–µ,
  –ø—Ä–æ–±–µ–ª—ã)
- **–ë–ª–æ–∫–µ—Ä 10**: Empty products array crash (–Ω–µ—Ç retry logic)
- –ë–ª–æ–∫–µ—Ä 7: API —Å–æ–∑–¥–∞–Ω–∏—è meal –Ω–µ –Ω–∞–π–¥–µ–Ω (fallback —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ –æ–ø—Ç–∏–º–∞–ª–µ–Ω)
- –ë–ª–æ–∫–µ—Ä 9: Timing heysProductAdded vs followedRef (edge case)

### ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (Sprint 3)

- –ë–ª–æ–∫–µ—Ä 8: Race condition –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–ª–∏–∫–æ–≤ (debounce –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
- R7: Product Picker Shortcut (—É—Å–∫–æ—Ä–µ–Ω–∏–µ UX)
- –ë–ª–æ–∫–µ—Ä 13-14: React useState timing, mobile long meal lists (edge cases)

### üö´ –û–≤–µ—Ä–∫–∏–ª–ª (–Ω–µ –¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å)

- R12: Voice commands ‚Äî —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ, –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π R&D
- R11: Nutrition impact preview ‚Äî —Ç—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ ConfirmModal (~200 LOC)
- Fuzzy search algorithm ‚Äî –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π (R8)

### üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è Sprint 2

1. **–ë–ª–æ–∫–µ—Ä 11 ‚Üí R8**: –§—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏–π (`—ë‚Üí–µ`, trim), ~10 —Å—Ç—Ä–æ–∫
2. **–ë–ª–æ–∫–µ—Ä 10**: Retry logic –¥–ª—è empty products (~10 —Å—Ç—Ä–æ–∫ + timeout)
3. **–ë–ª–æ–∫–µ—Ä 7**: –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å `HEYS.Day.addMeal()` –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å fallback UI

**Estimated effort**: 1-2 —á–∞—Å–∞ –¥–ª—è –≤—Å–µ—Ö 3 –ø—É–Ω–∫—Ç–æ–≤. **Impact**: —Å—Ä–µ–¥–Ω–µ-–≤—ã—Å–æ–∫–∏–π.

---

## –ó–∞–¥–∞—á–∞

---

## –§–∞–∑–∞ 0 ‚Äî –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê –ø–µ—Ä–µ–¥ –∫–æ–¥–æ–º)

> –ë–ª–æ–∫–µ—Ä—ã, –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –∞—É–¥–∏—Ç–æ–º –∏ —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π. –ê–≥–µ–Ω—Ç **–æ–±—è–∑–∞–Ω** –∏–∑—É—á–∏—Ç—å
> –∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç –∏ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ –¥–æ –Ω–∞—á–∞–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

### üü¢ –ò–°–ü–†–ê–í–õ–ï–ù–û –≤ –±–∞–∑–æ–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ë–ª–æ–∫–µ—Ä 1: `AddProductStep.show()` –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ ‚úÖ

**–§–∞–∫—Ç**: –í `heys_add_product_step_v1.js` (—Å—Ç—Ä–æ–∫–∞ 5057) —Ñ—É–Ω–∫—Ü–∏—è
`showAddProductModal` –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª–∞ `initialSearch` /
`initialGrams`.

**‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –≤ v24/v25 (Sprint 1, Feb 16 2026):**

- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `initialSearch` –¥–ª—è –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `initialGrams` –¥–ª—è ML-—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –≥—Ä–∞–º–º–æ–≤
- Verification logging –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç:
  ```javascript
  [HEYS.addProduct] üì¶ Open modal {
    initialSearch: "–Ø–π—Ü–æ –≤–∞—Ä—ë–Ω–æ–µ",
    initialGrams: 158,
    usingMLGrams: true
  }
  ```

**Production status**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç. ML —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ—á–Ω—ã–µ
–≥—Ä–∞–º–º—ã.

### –ë–ª–æ–∫–µ—Ä 2: `AddProductStep.show()` –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä meal

**–§–∞–∫—Ç**: `mealIndex` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä –ø—Ä–∏ –≤—ã–∑–æ–≤–µ. –ú–æ–¥–∞–ª–∫–∞ **–Ω–µ –¥–∞—ë—Ç**
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –º–µ–Ω—è—Ç—å –ø—Ä–∏—ë–º.

–í—ã–±–æ—Ä meal –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–¥–æ** –≤—ã–∑–æ–≤–∞ `AddProductStep`, —á–µ—Ä–µ–∑
`HEYS.ConfirmModal.show()` (`day/_meals.js` —Å—Ç—Ä–æ–∫–∏ 2379‚Äì2476) ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è
–º–æ–¥–∞–ª–∫–∞.

**–†–µ—à–µ–Ω–∏—è:**

- **(A) –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π meal picker** ‚Äî –ø–µ—Ä–µ–¥ `AddProductStep.show()` –ø–æ–∫–∞–∑–∞—Ç—å
  `ConfirmModal` —Å–æ —Å–ø–∏—Å–∫–æ–º –ø—Ä–∏—ë–º–æ–≤ (–∫–∞–∫ –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ). Flow: –∫–ª–∏–∫ `+` ‚Üí –º–æ–¥–∞–ª–∫–∞
  ¬´–í –∫–∞–∫–æ–π –ø—Ä–∏—ë–º?¬ª ‚Üí –≤—ã–±–æ—Ä ‚Üí `AddProductStep` ‚Üí done.
- **(B) –ê–≤—Ç–æ–≤—ã–±–æ—Ä + fallback** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞—Ç—å –ø–µ—Ä–≤—ã–π –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π
  –ø—Ä–∏—ë–º, –Ω–æ –¥–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ UI meal picker (–µ—Å–ª–∏ –æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫
  –∫–æ–º–ø–æ–Ω–µ–Ω—Ç).
- **(C) –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π flow** ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å inline selector –ø—Ä—è–º–æ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ MealRec
  (dropdown ¬´–ü—Ä–∏—ë–º 1 / –ü—Ä–∏—ë–º 2 / + –ù–æ–≤—ã–π¬ª), –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –º–æ–¥–∞–ª–∫–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í–∞—Ä–∏–∞–Ω—Ç **(A)** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
`ConfirmModal.show()` —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ meal. –≠—Ç–æ 100% consistency —Å –¥–Ω–µ–≤–Ω–∏–∫–æ–º, zero
new UI code.

### –ë–ª–æ–∫–µ—Ä 3: –î–≤–æ–π–Ω–æ–π dispatch `heysProductAdded`

**–§–∞–∫—Ç**: –°–æ–±—ã—Ç–∏–µ `heysProductAdded` dispatch'–∏—Ç—Å—è:

1. –í–Ω—É—Ç—Ä–∏ `showAddProductModal` ‚Üí `onComplete` (—Å—Ç—Ä–æ–∫–∞ 5245
   heys_add_product_step_v1.js)
2. –í—Ä—É—á–Ω—É—é –≤ callsite'–∞—Ö (day/\_meals.js —Å—Ç—Ä–æ–∫–∞ 2340, heys_day_add_product.js
   —Å—Ç—Ä–æ–∫–∞ 515)

–í `pi_ui_meal_rec_card.js` –µ—Å—Ç—å `useEffect` listener –Ω–∞ `heysProductAdded` –¥–ª—è
–∞–≤—Ç–æ-—Ç—Ä–µ–∫–∏–Ω–≥–∞ `markFollowed()`.

**–†–∏—Å–∫**: –ï—Å–ª–∏ `markFollowed()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏ –≤ `onAdd` callback (–ø–æ—Å–ª–µ
–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è), –ò –≤ event listener ‚Äî –±—É–¥–µ—Ç –¥–≤–æ–π–Ω–æ–π –≤—ã–∑–æ–≤.

**–†–µ—à–µ–Ω–∏–µ**: –í `onAdd` callback –≤—ã–∑—ã–≤–∞—Ç—å `markFollowed()` **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏**
`followedRef.current === false`. Event listener —É–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —ç—Ç–æ, –Ω–æ –Ω—É–∂–µ–Ω
—á—ë—Ç–∫–∏–π guard.

### –ë–ª–æ–∫–µ—Ä 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ `HEYS.ConfirmModal` –≤ runtime

**–§–∞–∫—Ç**: `ConfirmModal` –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω. –ù—É–∂–µ–Ω
fallback.

**–î–µ–π—Å—Ç–≤–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `global.HEYS?.ConfirmModal?.show` –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º.
–ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî fallback –Ω–∞ –∞–≤—Ç–æ–≤—ã–±–æ—Ä meal (–ø–µ—Ä–≤—ã–π –ø—É—Å—Ç–æ–π) –±–µ–∑ –º–æ–¥–∞–ª–∫–∏.

### –ë–ª–æ–∫–µ—Ä 5: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ shared –ø—Ä–æ–¥—É–∫—Ç–æ–≤

**–§–∞–∫—Ç**: –í –¥–Ω–µ–≤–Ω–∏–∫–µ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ shared –ø—Ä–æ–¥—É–∫—Ç–∞ —á–µ—Ä–µ–∑ `_meals.js`
–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:

```javascript
if (product?._fromShared || product?._source === 'shared') {
  const cloned = HEYS.products?.addFromShared?.(product);
  if (cloned) finalProduct = cloned;
}
```

**–†–∏—Å–∫**: –ï—Å–ª–∏ –≤—ã–∑–≤–∞—Ç—å `AddProductStep.show()` –∏–∑ MealRec-–∫–∞—Ä—Ç–æ—á–∫–∏, `onAdd`
callback –ø–æ–ª—É—á–∏—Ç –ø—Ä–æ–¥—É–∫—Ç, –Ω–æ –±–µ–∑ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è shared ‚Äî –ø—Ä–æ–¥—É–∫—Ç –º–æ–∂–µ—Ç –Ω–µ
—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ localStorage –∫–ª–∏–µ–Ω—Ç–∞.

**–î–µ–π—Å—Ç–≤–∏–µ**: –í `onAdd` callback –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `_fromShared` /
`_source === 'shared'` –∏ –≤—ã–∑–≤–∞—Ç—å `HEYS.products.addFromShared()` –ø—Ä–∏
–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

### –ë–ª–æ–∫–µ—Ä 6: –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ ‚úÖ

**–§–∞–∫—Ç**: `pi_ui_meal_rec_card.js` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ `insights/`, –∞
`heys_add_product_step_v1.js` ‚Äî –∏–∑ –∫–æ—Ä–Ω—è `apps/web/`. –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ
`HEYS.AddProductStep` —É–∂–µ –¥–æ—Å—Ç—É–ø–µ–Ω –∫ –º–æ–º–µ–Ω—Ç—É –≤—ã–∑–æ–≤–∞ (–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –∫ –º–æ–º–µ–Ω—Ç—É
—Ä–µ–Ω–¥–µ—Ä–∞).

**–î–µ–π—Å—Ç–≤–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ `<script>` –≤ `index.html`.
`heys_add_product_step_v1.js` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –î–û `pi_ui_meal_rec_card.js`. –£–±–µ–¥–∏—Ç—å—Å—è
–≤ –∞—É–¥–∏—Ç–µ.

**‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û**: –ú–æ–¥–∞–ª–∫–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤—ã—à–µ insights-—Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ index.html
(—Å—Ç—Ä–æ–∫–∏ 2062-2067).

---

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ë–õ–û–ö–ï–†–´ (–æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

### –ë–ª–æ–∫–µ—Ä 7: API —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ meal

**–§–∞–∫—Ç**: –í –®–∞–≥–µ 3 —É–ø–æ–º—è–Ω—É—Ç–æ "–≤—ã–∑–≤–∞—Ç—å HEYS.Day.addMeal()", –Ω–æ —ç—Ç–æ—Ç API –Ω–µ
–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∏ –º–æ–∂–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å.

**–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ**:

```javascript
// –ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è meal
// –í–∞—Ä–∏–∞–Ω—Ç—ã:
// 1. HEYS.Day.addMeal() ?
// 2. HEYS.Day.createNewMeal() ?
// 3. –ü—Ä—è–º–∞—è –º—É—Ç–∞—Ü–∏—è day.meals.push({ name: '', time: '', items: [] }) ?
// 4. –í—ã–∑–æ–≤ –º–æ–¥–∞–ª–∫–∏ HEYS.MealStepModal.show() –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è?
```

**–†–∏—Å–∫**: –ö–Ω–æ–ø–∫–∞ "+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–∏—ë–º" –≤ ConfirmModal —Å–ª–æ–º–∞–µ—Ç—Å—è –µ—Å–ª–∏ API –Ω–µ
—Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

**–†–µ—à–µ–Ω–∏—è**:

- **(A) –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å** ‚Äî –Ω–∞–π—Ç–∏ –≤ day/\_meals.js, heys_day_v12.js –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
  —Å–æ–∑–¥–∞–Ω–∏—è meal
- **(B) –£–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É** ‚Äî –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å "+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π" –≤ ConfirmModal, —Ç–æ–ª—å–∫–æ
  —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ meals
- **(C) Fallback** ‚Äî –µ—Å–ª–∏ API –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑–∞—Ç—å alert "–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏—ë–º –≤—Ä—É—á–Ω—É—é
  –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ"

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í–∞—Ä–∏–∞–Ω—Ç **(A)** ‚Üí –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∑–∞ 5 –º–∏–Ω—É—Ç ‚Üí –≤–∞—Ä–∏–∞–Ω—Ç
**(B)**.

### –ë–ª–æ–∫–µ—Ä 8: Race condition –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–ª–∏–∫–∞—Ö

**–§–∞ –∫—Ç**: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã—Å—Ç—Ä–æ –∫–ª–∏–∫–∞–µ—Ç "+" –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥, –º–æ–≥—É—Ç
–æ—Ç–∫—Ä—ã—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ ConfirmModal –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

**–†–∏—Å–∫**: UI –∑–∞–≤–∏—Å–Ω–µ—Ç, –º–æ–¥–∞–ª–∫–∏ –Ω–∞–ª–æ–∂–∞—Ç—Å—è –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞, `markFollowed()`
–≤—ã–∑–æ–≤–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑.

**–†–µ—à–µ–Ω–∏–µ**:

```javascript
// –í handleAddSuggestion –¥–æ–±–∞–≤–∏—Ç—å debounce –∏–ª–∏ disabled state
const [isProcessing, setIsProcessing] = useState(false);

const handleAddSuggestion = (suggestion) => {
  if (isProcessing) return; // Guard
  setIsProcessing(true);

  // ... show ConfirmModal

  // Reset –≤ onClose ConfirmModal'–∞
};
```

### –ë–ª–æ–∫–µ—Ä 9: Timing heysProductAdded vs followedRef

**–§–∞–∫—Ç**: –°–æ–±—ã—Ç–∏–µ `heysProductAdded` dispatch'–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ AddProductStep
**–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞. –ù–æ `followedRef.current = true`
—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `onAdd` callback, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å—Å—è **–ø–æ–∑–∂–µ**
(–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ).

**–†–∏—Å–∫**: useEffect listener –Ω–∞ `heysProductAdded` —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –†–ê–ù–¨–®–ï —á–µ–º
`followedRef` —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤ true ‚Üí –¥–≤–æ–π–Ω–æ–π –≤—ã–∑–æ–≤ `markFollowed()`.

**–†–µ—à–µ–Ω–∏–µ**:

```javascript
// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å followedRef –î–û –æ—Ç–∫—Ä—ã—Ç–∏—è AddProductStep
const handleAddSuggestion = (suggestion) => {
  // ... meal picker logic

  // üî¥ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥ –ü–ï–†–ï–î –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –º–æ–¥–∞–ª–∫–∏
  followedRef.current = true;

  HEYS.AddProductStep.show({
    onAdd: ({ product, grams, mealIndex }) => {
      // üî¥ –¢–µ–ø–µ—Ä—å markFollowed –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å
      if (recIdRef.current && HEYS?.InsightsPI?.feedbackLoop?.markFollowed) {
        HEYS.InsightsPI.feedbackLoop.markFollowed(recIdRef.current, true, prof);
      }
    },
  });
};
```

### –ë–ª–æ–∫–µ—Ä 10: Empty products array –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ AddProductStep

**–§–∞–∫—Ç**: `HEYS.products.getAll()` –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å **–ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ []** –µ—Å–ª–∏:

- –ü—Ä–æ–¥—É–∫—Ç—ã –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ cloud (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏

**–†–∏—Å–∫**: AddProductStep –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å –ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º –ø—Ä–æ–¥—É–∫—Ç–æ–≤ ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ
—Å–º–æ–∂–µ—Ç –Ω–∏—á–µ–≥–æ –≤—ã–±—Ä–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ**:

```javascript
const handleAddSuggestion = (suggestion) => {
  const products = HEYS?.products?.getAll?.() || [];

  if (products.length === 0) {
    console.warn(`${LOG_PREFIX} ‚ö†Ô∏è Products not loaded yet, retrying...`);

    // –ü–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
    setTimeout(() => {
      const retryProducts = HEYS?.products?.getAll?.() || [];
      if (retryProducts.length === 0) {
        alert('–ü—Ä–æ–¥—É–∫—Ç—ã –µ—â—ë –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥.');
        return;
      }
      // ... –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É
    }, 1000);
    return;
  }

  // ... –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É
};
```

### –ë–ª–æ–∫–µ—Ä 11: initialSearch –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞

**–§–∞–∫—Ç**: –ï—Å–ª–∏ –∏–º—è –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ suggestion –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ –≤ –±–∞–∑–µ (–¥–∞–∂–µ –Ω–∞ 1
—Å–∏–º–≤–æ–ª), –ø–æ–∏—Å–∫ –Ω–µ –Ω–∞–π–¥—ë—Ç –ø—Ä–æ–¥—É–∫—Ç:

- Suggestion: "–Ø–π—Ü–æ –≤–∞—Ä—ë–Ω–æ–µ"
- –ë–∞–∑–∞: "–Ø–π—Ü–æ –≤–∞—Ä–µ–Ω–æ–µ" (—ë ‚Üí –µ)
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–∏—Å–∫ –ø—É—Å—Ç–æ–π, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏—Å–∫–∞—Ç—å –∑–∞–Ω–æ–≤–æ

**–†–∏—Å–∫**: UX –ª–æ–º–∞–µ—Ç—Å—è ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫—É —Å –ø—É—Å—Ç—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
–ø–æ–∏—Å–∫–∞.

**–†–µ—à–µ–Ω–∏–µ**:

- **(A) Fuzzy search** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–µ—á—ë—Ç–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
  –õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω–∞) –≤ AddProductStep
- **(B) productId fallback** ‚Äî –µ—Å–ª–∏ `suggestion.productId` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∏—Å–∫–∞—Ç—å
  –ø—Ä–æ–¥—É–∫—Ç –ø–æ ID, –∞ –Ω–µ –ø–æ –∏–º–µ–Ω–∏
- **(C) Smart normalize** ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–º—è (—ë‚Üí–µ, —É–¥–∞–ª–∏—Ç—å –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã)
  –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –≤ initialSearch

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í–∞—Ä–∏–∞–Ω—Ç **(C)** + **(B)**.

### –ë–ª–æ–∫–µ—Ä 12: –ü–æ—Ç–µ—Ä—è —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã—Ö –≥—Ä–∞–º–º–æ–≤ ‚úÖ

**–§–∞–∫—Ç**: `suggestion.grams` (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ) –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ **–Ω–µ
–ø–µ—Ä–µ–¥–∞–≤–∞–ª–æ—Å—å** –≤ AddProductStep. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ 100–≥ –∏ –¥–æ–ª–∂–µ–Ω –±—ã–ª
–≤—Ä—É—á–Ω—É—é –º–µ–Ω—è—Ç—å.

**–ü—Ä–∏–º–µ—Ä (–¥–æ Sprint 1)**:

- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: "–Ø–π—Ü–æ –≤–∞—Ä—ë–Ω–æ–µ 158–≥" (—Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ –¥–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –¥–µ—Ñ–∏—Ü–∏—Ç–∞)
- –ú–æ–¥–∞–ª–∫–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 100–≥ (–¥–µ—Ñ–æ–ª—Ç) ‚ùå
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç 100–≥ –≤–º–µ—Å—Ç–æ 158–≥ ‚Üí –¥–µ—Ñ–∏—Ü–∏—Ç –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –≤ v24/v25/v15 (Sprint 1, Feb 16 2026):**

```javascript
// pi_ui_meal_rec_card.js
HEYS.AddProductStep.show({
  initialSearch: '–Ø–π—Ü–æ –≤–∞—Ä—ë–Ω–æ–µ',
  initialGrams: suggestion.grams || 100, // ‚úÖ R6 (Sprint 1)
  // ...
});

// heys_add_product_step_v1.js
getInitialData: () => ({
  selectedProduct: null,
  grams: initialGrams, // ‚úÖ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  searchQuery: initialSearch,
});
```

**Production status**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç. Verification logs –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç:

```
[MEALREC] üìä Opening AddProductStep: {
  initialGrams: 158,
  suggestedGrams: 158,
  usingMLGrams: true
}
```

### –ë–ª–æ–∫–µ—Ä 13: React useState timing issue

**–§–∞–∫—Ç**: `ProductSearchStep` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `useState(data?.searchQuery || '')`.
–ï—Å–ª–∏ `data.searchQuery` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è **–ø–æ—Å–ª–µ** –ø–µ—Ä–≤–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑
context update), `useState` –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–∑–∞–∫–æ–Ω React ‚Äî useState
–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ mount).

**–†–∏—Å–∫**: initialSearch –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –º–æ–¥–∞–ª–∫–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å –ø—É—Å—Ç—ã–º –ø–æ–∏—Å–∫–æ–º.

**–†–µ—à–µ–Ω–∏–µ**:

```javascript
// –í ProductSearchStep –¥–æ–±–∞–≤–∏—Ç—å useEffect –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
useEffect(() => {
  if (data?.searchQuery && data.searchQuery !== searchInput) {
    setSearchInput(data.searchQuery);
    setSearch(data.searchQuery);
  }
}, [data?.searchQuery]);
```

### –ë–ª–æ–∫–µ—Ä 14: Mobile UX ‚Äî –¥–ª–∏–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ meals

**–§–∞–∫—Ç**: –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 5+ –ø—Ä–∏—ë–º–æ–≤ –ø–∏—â–∏,
ConfirmModal –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ ‚Üí –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω,
–Ω—É–∂–µ–Ω —Å–∫—Ä–æ–ª–ª.

**–†–∏—Å–∫**: UX –Ω–µ—É–¥–æ–±–Ω—ã–π –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö (–æ—Å–æ–±–µ–Ω–Ω–æ iPhone SE, —É –∫–æ—Ç–æ—Ä–æ–≥–æ
568px –≤—ã—Å–æ—Ç—ã).

**–†–µ—à–µ–Ω–∏–µ**:

- **(A) Scrollable modal** ‚Äî —Å–¥–µ–ª–∞—Ç—å content ConfirmModal scrollable
  (max-height: 60vh, overflow-y: auto)
- **(B) Compact view** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–∞–∫—Å–∏–º—É–º 4 meal, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤ dropdown "–ï—â—ë N
  –ø—Ä–∏—ë–º–æ–≤"
- **(C) Horizontal swipe** ‚Äî –≤–º–µ—Å—Ç–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞, horizontal carousel —Å
  meal cards

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í–∞—Ä–∏–∞–Ω—Ç **(A)** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ-–∏–Ω–≤–∞–∑–∏–≤–Ω—ã–π.

### –ë–ª–æ–∫–µ—Ä 15: HEYS.Toast API availability ‚úÖ

**–§–∞–∫—Ç**: –í —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ R5 —É–ø–æ–º—è–Ω—É—Ç–æ `HEYS.Toast`, –Ω–æ —ç—Ç–æ—Ç API —Ç—Ä–µ–±–æ–≤–∞–ª
–ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è.

**‚úÖ –ò–°–°–õ–ï–î–û–í–ê–ù–û –∏ –ò–°–ü–†–ê–í–õ–ï–ù–û –≤ v15 (Sprint 1, Feb 16 2026):**

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:**

- API —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: `HEYS.Toast = { success, warning, error, info }`
  (heys_toast_v1.js, line 282)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ 20+ –º–µ—Å—Ç–∞—Ö –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã (heys_core_v12.js, heys_app_tabs_v1.js)
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–µ—Ç–æ–¥: `HEYS.Toast.success()`, –ù–ï `.show()`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å graceful fallback:**

```javascript
// pi_ui_meal_rec_card.js v15
const mealName = day?.meals?.[mealIndex]?.name || `–ü—Ä–∏—ë–º ${mealIndex + 1}`;
if (HEYS?.Toast?.success) {
  HEYS.Toast.success(`‚úÖ ${addedProduct.name} (${grams}–≥) ‚Üí ${mealName}`);
  console.info(`${LOG_PREFIX} üéâ Toast shown: {...}`); // Verification log
} else {
  console.info(`${LOG_PREFIX} ‚ö†Ô∏è Toast not available, using console only`);
}
```

**Production status**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç. Toast –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
–∏–∑ MealRec recommendations.

---

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–°–µ–π—á–∞—Å –≤ `apps/web/insights/pi_ui_meal_rec_card.js` –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
`handleAddSuggestion()` (—Å—Ç—Ä–æ–∫–∏ 252‚Äì320) –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–æ–¥—É–∫—Ç –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑
`HEYS.Day.addProductToMeal(mi, product, grams)` –±–µ–∑ —à–∞–≥–æ–≤ –≤—ã–±–æ—Ä–∞ –ø—Ä–∏—ë–º–∞ –∏ –≤–µ—Å–∞.
–≠—Ç–æ –ª–æ–º–∞–µ—Ç UX.

### API –º–æ–¥–∞–ª–∫–∏ (–∏–∑ –∞—É–¥–∏—Ç–∞, —Å—Ç—Ä–æ–∫–∏ 5057‚Äì5344 heys_add_product_step_v1.js)

```javascript
// –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–∞–ª–∫–∞ ‚Äî –ü–û–ò–°–ö + –ì–†–ê–ú–ú–´
HEYS.AddProductStep.show({
  mealIndex: 0, // –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, meal selection –ù–ï –≤—Å—Ç—Ä–æ–µ–Ω
  multiProductMode: false, // false = –∑–∞–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ 1 –ø—Ä–æ–¥—É–∫—Ç–∞
  products: [], // –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ (fallback –Ω–∞ HEYS.products)
  day: dayObj,
  dateKey: 'YYYY-MM-DD',
  onAdd: ({ product, grams, mealIndex }) => {}, // callback –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  onClose: () => {},
  onAddPhoto: () => {},
  onNewProduct: () => {},
});

// –ï—Å—Ç—å —Ç–∞–∫–∂–µ showEditGrams ‚Äî –Ω–æ —ç—Ç–æ –¥–ª—è –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø, –Ω–µ –¥–ª—è –Ω–∞—à–µ–≥–æ —Å–ª—É—á–∞—è.
// HEYS.AddProductStep.showEditGrams({ product, currentGrams, mealIndex, onSave })
```

### ConfirmModal API (–∏–∑ day/\_meals.js —Å—Ç—Ä–æ–∫–∏ 2379‚Äì2476)

```javascript
HEYS.ConfirmModal.show({
    title: '–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç',
    message: '–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—ë–º –ø–∏—â–∏',
    buttons: [
        { text: '–ü—Ä–∏—ë–º 1', onClick: () => { ... } },
        { text: '–ü—Ä–∏—ë–º 2', onClick: () => { ... } },
        // ...
    ],
    cancelText: '–û—Ç–º–µ–Ω–∞'
});
```

### –¶–µ–ª–µ–≤–æ–π flow (–ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

```
–ö–ª–∏–∫ "+" –Ω–∞ suggestion
  ‚îÇ
  ‚îú‚îÄ [ConfirmModal] "–í –∫–∞–∫–æ–π –ø—Ä–∏—ë–º –¥–æ–±–∞–≤–∏—Ç—å ¬´{–ø—Ä–æ–¥—É–∫—Ç}¬ª?"
  ‚îÇ   ‚îú‚îÄ "üç≥ –ü—Ä–∏—ë–º 1 (–∑–∞–≤—Ç—Ä–∞–∫)"
  ‚îÇ   ‚îú‚îÄ "ü•ó –ü—Ä–∏—ë–º 2 (–æ–±–µ–¥)"
  ‚îÇ   ‚îú‚îÄ "üç≤ –ü—Ä–∏—ë–º 3 (—É–∂–∏–Ω)"
  ‚îÇ   ‚îú‚îÄ "+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–∏—ë–º"
  ‚îÇ   ‚îî‚îÄ "–û—Ç–º–µ–Ω–∞"  ‚Üí  –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, return
  ‚îÇ
  ‚ñº (–≤—ã–±—Ä–∞–Ω mealIndex)
  ‚îÇ
  ‚îú‚îÄ [AddProductStep.show] ‚Äî –º–æ–¥–∞–ª–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
  ‚îÇ   Step 0: –ü–æ–∏—Å–∫ (–ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–∞–∑–≤–∞–Ω–∏–µ–º suggestion, –µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ë–ª–æ–∫–µ—Ä 1)
  ‚îÇ   Step 4: –ì—Ä–∞–º–º—ã (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å)
  ‚îÇ   ¬´–î–æ–±–∞–≤–∏—Ç—å¬ª ‚Üí onAdd callback
  ‚îÇ
  ‚ñº (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ)
  ‚îÇ
  ‚îú‚îÄ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ shared –ø—Ä–æ–¥—É–∫—Ç–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ, –ë–ª–æ–∫–µ—Ä 5)
  ‚îú‚îÄ markFollowed(recId, true, prof)
  ‚îú‚îÄ Haptic feedback
  ‚îî‚îÄ [MEALREC] –ª–æ–≥–∏
```

---

## –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

### –®–∞–≥ 1. –ê—É–¥–∏—Ç –ø–æ—Ä—è–¥–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ (–ë–ª–æ–∫–µ—Ä 6)

–û—Ç–∫—Ä—ã—Ç—å `apps/web/index.html`, —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `heys_add_product_step_v1.js`
–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –î–û `pi_ui_meal_rec_card.js`. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å.

### –®–∞–≥ 2. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –ü–∞—Ç—á AddProductStep ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä `initialSearch` (–ë–ª–æ–∫–µ—Ä 1B)

–í `heys_add_product_step_v1.js`:

- –í —Å–∏–≥–Ω–∞—Ç—É—Ä—É `showAddProductModal` –¥–æ–±–∞–≤–∏—Ç—å `initialSearch = ''`
- –í `getInitialData()` —Ñ—É–Ω–∫—Ü–∏–∏ `ProductSearchStep` –ø–µ—Ä–µ–¥–∞—Ç—å `initialSearch` –∫–∞–∫
  –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `searchQuery`
- –ò—Ç–æ–≥–æ: ~5-10 —Å—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ï—Å–ª–∏ —Ä–µ—à–µ–Ω–æ –ù–ï –¥–µ–ª–∞—Ç—å (–≤–∞—Ä–∏–∞–Ω—Ç A)**: –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —à–∞–≥. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç
–∏—Å–∫–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç –≤—Ä—É—á–Ω—É—é –≤ –º–æ–¥–∞–ª–∫–µ.

### –®–∞–≥ 3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å meal picker —á–µ—Ä–µ–∑ ConfirmModal (–ë–ª–æ–∫–µ—Ä 2A)

–í `handleAddSuggestion()`:

- –°–æ–±—Ä–∞—Ç—å —Å–ø–∏—Å–æ–∫ meals –∏–∑ `day.meals` —Å –∏—Ö –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
- –ü–æ–∫–∞–∑–∞—Ç—å `HEYS.ConfirmModal.show()` —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ meal + ¬´–°–æ–∑–¥–∞—Ç—å
  –Ω–æ–≤—ã–π¬ª
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ ‚Äî –≤—ã–∑–≤–∞—Ç—å `AddProductStep.show()` —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º `mealIndex`
- –ü—Ä–∏ ¬´–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π¬ª ‚Äî –≤—ã–∑–≤–∞—Ç—å `HEYS.Day.addMeal()` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥), –∑–∞—Ç–µ–º
  `AddProductStep.show()` —Å –Ω–æ–≤—ã–º –∏–Ω–¥–µ–∫—Å–æ–º
- –ü—Ä–∏ ¬´–û—Ç–º–µ–Ω–∞¬ª ‚Äî return, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å

### –®–∞–≥ 4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `onAdd` callback

–í callback `onAdd`:

- –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å shared product (–ë–ª–æ–∫–µ—Ä 5)
- –í—ã–∑–≤–∞—Ç—å `markFollowed()` —Å guard `!followedRef.current` (–ë–ª–æ–∫–µ—Ä 3)
- Haptic feedback
- Verification log

### –®–∞–≥ 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ fallback (–ë–ª–æ–∫–µ—Ä 4)

- –ï—Å–ª–∏ `HEYS.ConfirmModal` –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ò `HEYS.AddProductStep` –¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí
  –∞–≤—Ç–æ–≤—ã–±–æ—Ä meal, —Å—Ä–∞–∑—É `AddProductStep.show()`
- –ï—Å–ª–∏ `HEYS.AddProductStep` –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí `console.warn`, early return, –Ω–∏–∫–∞–∫–æ–≥–æ
  silent fail
- –ï—Å–ª–∏ –ø—Ä–∏—ë–º–æ–≤ 0 ‚Üí —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –ø—Ä–∏—ë–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –®–∞–≥ 6. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥

–£–¥–∞–ª–∏—Ç—å –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ `HEYS.Day.addProductToMeal()` –∏ –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `mi` –∏–∑
—Ç–µ–∫—É—â–µ–≥–æ `handleAddSuggestion()`.

### –®–∞–≥ 7. Cache busting

–í `apps/web/index.html` –æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é `pi_ui_meal_rec_card.js?v=...` –Ω–∞
—Å–ª–µ–¥—É—é—â—É—é.

### –®–∞–≥ 8. –†–µ–≥—Ä–µ—Å—Å–∏–∏

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `heysProductAdded` event –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç –¥–≤–æ–π–Ω–æ–π `markFollowed()`
  (–ë–ª–æ–∫–µ—Ä 3)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `pi_feedback_loop.js` (–º–µ–Ω—è–ª—Å—è –Ω–µ–¥–∞–≤–Ω–æ) ‚Äî –ø—Ä–æ–≥–Ω–∞—Ç—å –µ–≥–æ —Ç–µ—Å—Ç—ã
  –æ—Ç–¥–µ–ª—å–Ω–æ
- –ü—Ä–æ–≥–Ω–∞—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã MealRec: `pnpm test:run`

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ë–µ–∑ inline styles (Tailwind first, BEM –≤ `heys-components.css`)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç–æ—á–µ—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Supabase SDK (—Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π HEYS flow/API)
- –ù–µ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å —á—É–∂–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–¥—Ä—É–≥–∏–µ –∞–≥–µ–Ω—Ç—ã –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
- –ù–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `AddProductStep` –±–æ–ª—å—à–µ —á–µ–º –Ω–∞ ~10 —Å—Ç—Ä–æ–∫ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω
  –≤–∞—Ä–∏–∞–Ω—Ç B)
- –ù–µ —Ç—Ä–æ–≥–∞—Ç—å CSS –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ no-touch zones

---

## Acceptance Criteria

- [ ] –ö–ª–∏–∫ –ø–æ `+` –Ω–∞ suggestion **–Ω–µ** –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–æ–¥—É–∫—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- [ ] –ü–æ—è–≤–ª—è–µ—Ç—Å—è ConfirmModal —Å –≤—ã–±–æ—Ä–æ–º meal (–∏–ª–∏ fallback-–∞–≤—Ç–æ–≤—ã–±–æ—Ä)
- [ ] –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ meal –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è `AddProductStep` –º–æ–¥–∞–ª–∫–∞
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –≥—Ä–∞–º–º—ã (—à–∞–≥ GramsStep)
- [ ] –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π meal
- [ ] Shared products –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∫–ª–æ–Ω–∏—Ä—É—é—Ç—Å—è (`addFromShared`)
- [ ] –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –Ω–∞ –ª—é–±–æ–º —à–∞–≥–µ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è, `markFollowed()` –Ω–µ
      –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- [ ] `markFollowed()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
- [ ] –ù–µ—Ç –¥–≤–æ–π–Ω–æ–≥–æ `markFollowed()` (guard + event listener)
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏ `[MEALREC]`-–ª–æ–≥–∏ –∫–ª—é—á–µ–≤—ã—Ö —ç—Ç–∞–ø–æ–≤
- [ ] –ù–µ—Ç –Ω–æ–≤—ã—Ö runtime-–æ—à–∏–±–æ–∫
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (`pnpm test:run`)

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (WOW-—Ñ–∞–∫—Ç–æ—Ä)

### R1. –£–º–Ω—ã–π –∞–≤—Ç–æ–≤—ã–±–æ—Ä meal –≤ ConfirmModal ‚úÖ

–ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å) –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏—ë–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫:

- —É—Ç—Ä–æ ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –ø–µ—Ä–≤—ã–π meal
- –æ–±–µ–¥ ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –≤—Ç–æ—Ä–æ–π
- –≤–µ—á–µ—Ä ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π –≠—Ç–æ –¥–µ–ª–∞–µ—Ç UX –Ω–µ –ø—Ä–æ—Å—Ç–æ ¬´–∫–∞–∫ –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ¬ª, –∞ **—É–º–Ω–µ–µ** ‚Äî
  —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è.

**‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û**: Smart meal picker –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–Ω—è –≤ ConfirmModal.

### R2. –ü—Ä–µ–≤—å—é –º–∞–∫—Ä–æ—Å–æ–≤ –≤ ConfirmModal

–†—è–¥–æ–º —Å –∫–∞–∂–¥—ã–º meal –ø–æ–∫–∞–∑–∞—Ç—å –º–∏–Ω–∏-—Å–≤–æ–¥–∫—É: ¬´–ë: 12–≥, –ñ: 5–≥, –£: 30–≥¬ª ‚Äî —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç
—Ä–µ—à–∏—Ç—å, –∫—É–¥–∞ –ª–æ–≥–∏—á–Ω–µ–µ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç. –î–∞–Ω–Ω—ã–µ –∏–∑ `day.meals[i].items`.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Medium. –¢—Ä–µ–±—É–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ ConfirmModal –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏
subtitle/description.

### R3. –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞

–ü—Ä–∏ –≤—ã–±–æ—Ä–µ meal –≤ ConfirmModal ‚Äî –ø–ª–∞–≤–Ω—ã–π transition –Ω–∞ AddProductStep (300ms
fade/slide), —á—Ç–æ–±—ã flow –æ—â—É—â–∞–ª—Å—è –∫–∞–∫ –µ–¥–∏–Ω—ã–π wizard, –∞ –Ω–µ –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥–∞–ª–∞.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Low. –ü–æ–ª–∏—Ä–æ–≤–∫–∞ UX –ø–æ—Å–ª–µ –±–∞–∑–æ–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

### R4. ¬´–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ¬ª (long press / swipe)

–í –±—É–¥—É—â–µ–º: long-press –Ω–∞ suggestion ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π
meal (—Ç–µ–∫—É—â–∏–π flow –±–µ–∑ –º–æ–¥–∞–ª–æ–∫) –¥–ª—è power-users. –≠—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞, –Ω–æ —Å—Ç–æ–∏—Ç
–æ—Å—Ç–∞–≤–∏—Ç—å TODO –≤ –∫–æ–¥–µ.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Low. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π flow –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### R5. Toast/snackbar –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –º–∏–Ω–∏-–Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é: ¬´‚úÖ –Ø–π—Ü–æ –≤–∞—Ä—ë–Ω–æ–µ (180–≥)
‚Üí –ü—Ä–∏—ë–º 2¬ª. 3 —Å–µ–∫—É–Ω–¥—ã, auto-dismiss. –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: **High**. –ù—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `HEYS.Toast.show()` API (–ë–ª–æ–∫–µ—Ä
15).

---

### üÜï –ù–æ–≤—ã–µ WOW-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (Audit Feb 16, 2026)

### R6. Smart Grams Pre-fill (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è ML –ø–µ—Ç–ª–∏)

–ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `suggestion.grams` –≤ AddProductStep –∫–∞–∫ –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:

```javascript
HEYS.AddProductStep.show({
  initialSearch: suggestion.name,
  initialGrams: suggestion.grams, // üÜï 158–≥ –≤–º–µ—Å—Ç–æ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö 100–≥
  // ...
});
```

**–ü–æ—á–µ–º—É WOW**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç **—Ç–æ—á–Ω–æ–µ** –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–µ ML –¥–ª—è
–∑–∞–∫—Ä—ã—Ç–∏—è –¥–µ—Ñ–∏—Ü–∏—Ç–∞. –°–µ–π—á–∞—Å recommendation –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "158–≥", –Ω–æ –º–æ–¥–∞–ª–∫–∞
—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –Ω–∞ 100–≥ ‚Üí UX —Ä–∞–∑—Ä—ã–≤.

**–¢—Ä–µ–±—É–µ—Ç**: –ü–∞—Ç—á AddProductStep `getInitialData()` (~3 —Å—Ç—Ä–æ–∫–∏). –°–º. –ë–ª–æ–∫–µ—Ä 12.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: **Critical**. –ë–µ–∑ —ç—Ç–æ–≥–æ ML recommendations —Ç–µ—Ä—è—é—Ç —Å–º—ã—Å–ª.

### R7. Product Picker Shortcut (—É—Å–∫–æ—Ä–µ–Ω–∏–µ flow –Ω–∞ 1 —à–∞–≥)

–ï—Å–ª–∏ `suggestion.productId` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø—Ä–æ–¥—É–∫—Ç –Ω–∞–π–¥–µ–Ω –≤ `pIndex`, –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
ProductSearchStep ‚Üí —Å—Ä–∞–∑—É –æ—Ç–∫—Ä—ã—Ç—å GramsStep —á–µ—Ä–µ–∑ `HEYS.Day.showEditGrams()`:

```javascript
const product = pIndex[suggestion.productId];
if (product) {
  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–∏—Å–∫, —Å—Ä–∞–∑—É –≥—Ä–∞–º–º—ã
  HEYS.Day.showEditGrams({
    product,
    grams: suggestion.grams,
    mealIndex: selectedMealIndex,
    onSave: (updatedGrams) => {
      /* add to meal */
    },
  });
}
```

**–ü–æ—á–µ–º—É WOW**: **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ** –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ (ConfirmModal ‚Üí GramsStep), –±–µ–∑
–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞. –≠–∫–æ–Ω–æ–º–∏—Ç 1 –∫–ª–∏–∫ + 2 —Å–µ–∫—É–Ω–¥—ã.

**–¢—Ä–µ–±—É–µ—Ç**: –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å API `HEYS.Day.showEditGrams()` –∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: **High**. –î–µ–ª–∞–µ—Ç recommendations **—Å–∞–º—ã–º –±—ã—Å—Ç—Ä—ã–º** —Å–ø–æ—Å–æ–±–æ–º
–¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤.

### R8. Fuzzy Search + Smart Normalization (—Ä–µ—à–∞–µ—Ç –ë–ª–æ–∫–µ—Ä 11)

–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–º—è –ø—Ä–æ–¥—É–∫—Ç–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –≤ initialSearch:

```javascript
const normalizeProductName = (name) => {
  return name
    .toLowerCase()
    .replace(/—ë/g, '–µ') // —ë ‚Üí –µ
    .replace(/\s+/g, ' ') // –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã ‚Üí –æ–¥–∏–Ω
    .trim();
};

const initialSearch = normalizeProductName(suggestion.name);
```

**–ü–æ—á–µ–º—É WOW**: Search **–≤—Å–µ–≥–¥–∞** –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–¥—É–∫—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ –≤ suggestion "–Ø–π—Ü–æ
–≤–∞—Ä—ë–Ω–æ–µ", –∞ –≤ –±–∞–∑–µ "—è–π—Ü–æ –≤–∞—Ä–µ–Ω–æ–µ".

**–¢—Ä–µ–±—É–µ—Ç**: ~10 —Å—Ç—Ä–æ–∫, –º–æ–∂–Ω–æ –≤ inline —Ñ—É–Ω–∫—Ü–∏—é.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Medium. –£–ª—É—á—à–∞–µ—Ç success rate –ø–æ–∏—Å–∫–∞ –Ω–∞ ~15%.

### R9. Meal Creation Wizard (—Ä–µ—à–∞–µ—Ç –ë–ª–æ–∫–µ—Ä 7)

–ü—Ä–∏ –∫–ª–∏–∫–µ "+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–∏—ë–º" –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π wizard:

```javascript
// Phase 1: –í—ã–±—Ä–∞—Ç—å —Ç–∏–ø meal
HEYS.ConfirmModal.show({
  title: '–ö–∞–∫–æ–π —Ç–∏–ø –ø—Ä–∏—ë–º–∞?',
  buttons: [
    { label: 'üç≥ –ó–∞–≤—Ç—Ä–∞–∫', value: 'breakfast' },
    { label: 'ü•ó –û–±–µ–¥', value: 'lunch' },
    { label: 'üç≤ –£–∂–∏–Ω', value: 'dinner' },
    { label: 'üç™ –ü–µ—Ä–µ–∫—É—Å', value: 'snack' },
  ],
  onSelect: (type) => {
    // Phase 2: –°–æ–∑–¥–∞—Ç—å meal —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º
    const newMeal = {
      name: type,
      time: new Date().toTimeString().slice(0, 5),
      items: [],
    };
    day.meals.push(newMeal);
    // Phase 3: –û—Ç–∫—Ä—ã—Ç—å AddProductStep –¥–ª—è –Ω–æ–≤–æ–≥–æ meal
  },
});
```

**–ü–æ—á–µ–º—É WOW**: –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π onboarding –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ meal (–Ω–µ –ø—Ä–æ—Å—Ç–æ
–ø—É—Å—Ç–æ–π meal, –∞ —Å –≤—ã–±–æ—Ä–æ–º —Ç–∏–ø–∞ + –≤—Ä–µ–º–µ–Ω–∏).

**–¢—Ä–µ–±—É–µ—Ç**: –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å `HEYS.Day.addMeal()` –∏–ª–∏ –ø—Ä—è–º—É—é –º—É—Ç–∞—Ü–∏—é day.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Medium. –ù—É–∂–µ–Ω –µ—Å–ª–∏ —Ä–µ—à–µ–Ω–∏–µ –ë–ª–æ–∫–µ—Ä–∞ 7 = –≤–∞—Ä–∏–∞–Ω—Ç (A).

### R10. Undo Action (modern pattern)

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ –ø–æ–∫–∞–∑–∞—Ç—å toast —Å –∫–Ω–æ–ø–∫–æ–π "–û—Ç–º–µ–Ω–∏—Ç—å" (3 —Å–µ–∫ —Ç–∞–π–º–µ—Ä):

```javascript
HEYS.Toast.show({
  message: `‚úÖ ${product.name} (${grams}–≥) ‚Üí –ü—Ä–∏—ë–º ${mealIndex + 1}`,
  action: {
    label: '–û—Ç–º–µ–Ω–∏—Ç—å',
    onClick: () => {
      // –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π item –∏–∑ meal
      HEYS.Day.removeLastItem(mealIndex);
      // Unmarked –≤ feedback loop
      HEYS.InsightsPI.feedbackLoop.markFollowed(recId, false, prof);
    },
  },
  duration: 3000,
});
```

**–ü–æ—á–µ–º—É WOW**: –°–ª–µ–¥—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º UX –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º (Gmail, Slack, Telegram).
–ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–∫–∞—Ç–∏—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑ –∑–∞–∫–∞—Ç–∞ –≤ –¥–Ω–µ–≤–Ω–∏–∫.

**–¢—Ä–µ–±—É–µ—Ç**: API `HEYS.Day.removeLastItem()` –∏–ª–∏ –º—É—Ç–∞—Ü–∏—é
`day.meals[mi].items.pop()`.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Medium. –ü–æ–≤—ã—à–∞–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ("–º–æ–≥—É –æ—Ç–∫–∞—Ç–∏—Ç—å").

### R11. Nutrition Impact Preview (—á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è)

–í ConfirmModal –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–≤—å—é **–¥–µ–ª—å—Ç—ã –Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤** –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞:

```javascript
const mealTotals = calculateMealTotals(day.meals[mealIndex]);
const afterAdd = {
  kcal: mealTotals.kcal + suggestion.kcal,
  prot: mealTotals.prot + suggestion.prot,
  // ...
};

// –í ConfirmModal –¥–æ–±–∞–≤–∏—Ç—å preview
buttons.forEach((btn, i) => {
  btn.subtitle = `–ë: ${mealTotals[i].prot}–≥ ‚Üí ${afterAdd[i].prot}–≥ (+${suggestion.prot}–≥)`;
});
```

**–ü–æ—á–µ–º—É WOW**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç** –¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è. –ü–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏–Ω—è—Ç—å
–æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∫—É–¥–∞ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç.

**–¢—Ä–µ–±—É–µ—Ç**: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ConfirmModal –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ subtitle.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Low. Awesome feature, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
ConfirmModal.

### R12. Voice Command Integration (—Ñ—É—Ç—É—Ä–∏—Å—Ç–∏—á–Ω–æ)

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Web Speech API –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:

```javascript
// –í –±—É–¥—É—â–µ–º: "–î–æ–±–∞–≤—å —è–π—Ü–æ –≤ –∑–∞–≤—Ç—Ä–∞–∫"
if ('webkitSpeechRecognition' in window) {
  const recognition = new webkitSpeechRecognition();
  recognition.onresult = (event) => {
    const command = event.results[0][0].transcript;
    // Parse: "–¥–æ–±–∞–≤—å {–ø—Ä–æ–¥—É–∫—Ç} –≤ {meal}"
    // Trigger handleAddSuggestion flow
  };
}
```

**–ü–æ—á–µ–º—É WOW**: **Zero-click** –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, hands-free. –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ—Ç–æ—Ä—ã–µ
–≥–æ—Ç–æ–≤—è—Ç (—Ä—É–∫–∏ –∑–∞–Ω—è—Ç—ã).

**–¢—Ä–µ–±—É–µ—Ç**: –û—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ + privacy considerations + UX –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∞.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Very Low. –°–∫–æ—Ä–µ–µ R&D, —á–µ–º production feature.

---

## –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è WOW-—Ñ–∏—á (execution order)

**Sprint 1 (Must-have) ‚Äî ‚úÖ COMPLETED (v15, Feb 16 2026):**

- ‚úÖ R1: Smart meal auto-select (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ v13)
- ‚úÖ R6: Smart Grams Pre-fill (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è ML ‚Äî **–†–ê–ë–û–¢–ê–ï–¢**)
- ‚úÖ R5: Toast after add (feedback + –ø—Ä–æ–≤–µ—Ä–∫–∞ API ‚Äî **–†–ê–ë–û–¢–ê–ï–¢**)
- ‚úÖ Verification logging –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**Production Impact Verified:**

```
–î–æ Sprint 1: ML —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç 158–≥ ‚Üí –º–æ–¥–∞–ª–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 100–≥ ‚ùå
–ü–æ—Å–ª–µ Sprint 1: ML —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç 158–≥ ‚Üí –º–æ–¥–∞–ª–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 158–≥ ‚úÖ
–õ–æ–≥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç: usingMLGrams: true ‚úÖ
Toast –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è: "‚úÖ –Ø–π—Ü–æ –≤–∞—Ä—ë–Ω–æ–µ (158–≥) ‚Üí –ó–∞–≤—Ç—Ä–∞–∫" ‚úÖ
```

**Sprint 2 (High value):**

- R7: Product Picker Shortcut (—É—Å–∫–æ—Ä–µ–Ω–∏–µ √ó 2)
- R8: Fuzzy Search normalization (bug fix + UX)
- R9: Meal Creation Wizard (—Ä–µ—à–∞–µ—Ç –ë–ª–æ–∫–µ—Ä 7)

**Sprint 3 (Nice-to-have):**

- R10: Undo Action (modern UX)
- R2: Macro preview in meals
- R3: Smooth transitions

**Future R&D:**

- R4: Long-press quick add
- R11: Nutrition impact preview
- R12: Voice commands

---

---

## Risk Mitigation & Rollback Plan

### Production Risks

#### Risk 1: Multiple modal instances crash UI

**Probability**: Medium (if user clicks fast)  
**Impact**: High (UI freeze, requires reload)  
**Mitigation**: –ë–ª–æ–∫–µ—Ä 8 (isProcessing flag + debounce)  
**Detection**: Monitor console errors `TypeError: modal already open`  
**Rollback**: Revert to v12, redeploy in <5 min

#### Risk 2: Empty products array breaks modal

**Probability**: Low (products cached in localStorage)  
**Impact**: Medium (empty search, user confused)  
**Mitigation**: –ë–ª–æ–∫–µ—Ä 10 (retry with timeout + alert)  
**Detection**: User reports "–Ω–µ –≤–∏–∂—É –ø—Ä–æ–¥—É–∫—Ç—ã –≤ –ø–æ–∏—Å–∫–µ"  
**Rollback**: Graceful degradation ‚Äî show loading spinner

#### Risk 3: initialSearch doesn't match product name

**Probability**: Medium (typos, transliteration)  
**Impact**: Low (user searches manually)  
**Mitigation**: R8 (fuzzy normalization)  
**Detection**: Track search success rate in feedback loop  
**Rollback**: Remove initialSearch param, show empty search

#### Risk 4: Recommendation grams lost (–ë–ª–æ–∫–µ—Ä 12)

**Probability**: **High** (current behavior)  
**Impact**: **Critical** (ML loop broken, user trust loss)  
**Mitigation**: R6 (smart grams pre-fill) ‚Äî MUST fix in Sprint 1  
**Detection**: Users report "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 158–≥, –Ω–æ –º–æ–¥–∞–ª–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 100–≥"  
**Rollback**: N/A ‚Äî current behavior is the bug

#### Risk 5: HEYS.Toast.show() doesn't exist

**Probability**: Medium (API undocumented)  
**Impact**: Low (runtime error, but try-catch wrapped)  
**Mitigation**: –ë–ª–æ–∫–µ—Ä 15 (API check + fallback)  
**Detection**: Console error `Toast.show is not a function`  
**Rollback**: Remove toast, use console.info only

#### Risk 6: ConfirmModal race with heysProductAdded

**Probability**: Low (fixed in –ë–ª–æ–∫–µ—Ä 9)  
**Impact**: Medium (double markFollowed)  
**Mitigation**: Set followedRef BEFORE modal open  
**Detection**: Logs show `[MEALREC] ‚ö†Ô∏è Already marked as followed`  
**Rollback**: Add timestamp check (skip if <500ms since last mark)

### Backward Compatibility

**User data**: No schema changes ‚Äî day format unchanged.  
**API contracts**: No new RPC calls ‚Äî only UI flow changes.  
**Cache invalidation**: Version bump `v12‚Üív13` forces reload.

### Monitoring Plan

**Success metrics** (track in feedback loop):

- Search success rate: `foundProduct / totalSearches > 0.85`
- Grams accuracy: `|userGrams - suggestedGrams| < 20g` in 70% cases
- Modal cancellation rate: `< 15%` (if higher ‚Üí UX too complex)

**Error tracking**:

```javascript
window.addEventListener('error', (e) => {
  if (
    e.message.includes('ConfirmModal') ||
    e.message.includes('AddProductStep')
  ) {
    // Send to analytics
    console.error('[MEALREC] üî¥ Modal error:', e.message);
  }
});
```

### Rollback Procedure (if critical bug in production)

**Step 1** (immediate, <2 min):

```bash
# Revert script version in index.html
# From: <script src="insights/pi_ui_meal_rec_card.js?v=13.0.0"></script>
# To:   <script src="insights/pi_ui_meal_rec_card.js?v=12.0.0"></script>
git checkout HEAD~1 apps/web/index.html
git commit -m "hotfix: rollback MealRec to v12"
git push
```

**Step 2** (restore old behavior, <5 min):

```bash
git checkout HEAD~1 apps/web/insights/pi_ui_meal_rec_card.js
git checkout HEAD~1 apps/web/heys_add_product_step_v1.js
git commit -m "hotfix: restore direct addProductToMeal flow"
git push
```

**Step 3** (verify):

- Check production console ‚Äî no errors
- Test "+" button ‚Äî adds product immediately
- Verify markFollowed still works

**Step 4** (post-mortem):

- Document what broke in `INCIDENT_LOG.md`
- Add regression test
- Fix in dev branch, re-test, re-deploy

---

## What –ø—Ä–∏–ª–æ–∂–∏—Ç—å –≤ –æ—Ç—á—ë—Ç–µ

1. –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å –∫—Ä–∞—Ç–∫–æ–π –ø—Ä–∏—á–∏–Ω–æ–π –ø–æ –∫–∞–∂–¥–æ–º—É
2. –ö–∞–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–æ –ø–æ –∫–∞–∂–¥–æ–º—É –±–ª–æ–∫–µ—Ä—É (A/B/C)
3. –ö–∞–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Ä—É—á–Ω—É—é
4. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤/–ª–∏–Ω—Ç–∞
5. –†–∏—Å–∫–∏/–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–µ—Å–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å)

---

## QA-—á–µ–∫–ª–∏—Å—Ç (—Ä—É—á–Ω–æ–π)

### Happy path

1. –û—Ç–∫—Ä—ã—Ç—å —ç–∫—Ä–∞–Ω —Å MealRec
2. –ù–∞–∂–∞—Ç—å `+` –Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ—è–≤–∏–ª—Å—è –≤—ã–±–æ—Ä meal (ConfirmModal)
4. –í—ã–±—Ä–∞—Ç—å –ø—Ä–∏—ë–º
5. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ—Ç–∫—Ä—ã–ª–∞—Å—å AddProductStep –º–æ–¥–∞–ª–∫–∞
6. (–ï—Å–ª–∏ –ë–ª–æ–∫–µ—Ä 1B: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–∏—Å–∫ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–∞–∑–≤–∞–Ω–∏–µ–º)
7. –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç, –∏–∑–º–µ–Ω–∏—Ç—å –≥—Ä–∞–º–º—ã
8. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
9. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–æ–¥—É–∫—Ç –ø–æ—è–≤–∏–ª—Å—è –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º meal
10. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ `[MEALREC]` –≤ DevTools

### Cancel flow

11. –ù–∞–∂–∞—Ç—å `+`, –∑–∞—Ç–µ–º ¬´–û—Ç–º–µ–Ω–∞¬ª –Ω–∞ ConfirmModal ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ–±–∞–≤–∏–ª–æ—Å—å
12. –í—ã–±—Ä–∞—Ç—å meal, –∑–∞—Ç–µ–º –∑–∞–∫—Ä—ã—Ç—å AddProductStep ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ–±–∞–≤–∏–ª–æ—Å—å
13. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `markFollowed()` –ù–ï –≤—ã–∑–≤–∞–Ω

### Edge cases

14. –ù–µ—Ç –ø—Ä–∏—ë–º–æ–≤ (`day.meals = []`) ‚Üí –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ? fallback?
15. `ConfirmModal` –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω ‚Üí fallback –Ω–∞ –∞–≤—Ç–æ–≤—ã–±–æ—Ä
16. `AddProductStep` –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω ‚Üí warning, early return
17. Shared product ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
18. –ù–∞–∂–∞—Ç—å `+` –¥–≤–∞–∂–¥—ã –±—ã—Å—Ç—Ä–æ ‚Üí –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–≤—É—Ö –º–æ–¥–∞–ª–æ–∫
19. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–≤–æ–π–Ω–æ–≥–æ `markFollowed()` –≤ –ª–æ–≥–∞—Ö
