# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ heys_day_v12.js ‚Äî Phase 2 v2 Status

**–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞**: 2025-12-10  
**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å**: üü° –í –ø—Ä–æ—Ü–µ—Å—Å–µ (Phase 1 —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞)  
**–ë–∞–∑–æ–≤—ã–π —Ñ–∞–π–ª**: `heys_day_v12.js` (16,782 —Å—Ç—Ä–æ–∫–∏)

---

## ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### Phase 1: Constants & Scoring (–ß–∞—Å—Ç–∏—á–Ω–æ)

| –ú–æ–¥—É–ª—å | –°—Ç–∞—Ç—É—Å | –°—Ç—Ä–æ–∫ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------|-------|----------|
| `heys_day_scoring/constants.js` | ‚úÖ –°–æ–∑–¥–∞–Ω | 139 | –í—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã scoring |
| `heys_day_science/liquidFood.js` | ‚úÖ –°–æ–∑–¥–∞–Ω | 37 | `isLiquidFood()` |
| `heys_day_science/glycemicLoad.js` | ‚úÖ –°–æ–∑–¥–∞–Ω | 39 | `calculateMealGL()`, `getGLQualityBonus()` |
| `heys_day_science/circadian.js` | ‚úÖ –°–æ–∑–¥–∞–Ω | 43 | `getCircadianBonus()` |
| `heys_day_scoring/nutrientColors.js` | ‚úÖ –°–æ–∑–¥–∞–Ω | 285 | `getNutrientColor()`, `getNutrientTooltip()` |
| `heys_day_scoring/dailyNutrientColors.js` | ‚úÖ –°–æ–∑–¥–∞–Ω | 228 | `getDailyNutrientColor()`, `getDailyNutrientTooltip()` |

**–ò—Ç–æ–≥–æ —Å–æ–∑–¥–∞–Ω–æ**: 6 –º–æ–¥—É–ª–µ–π, ~771 —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞  
**–û—Å—Ç–∞–ª–æ—Å—å –≤ Phase 1**: `mealQualityScore.js` (–Ω—É–∂–Ω–æ –∏–∑–≤–ª–µ—á—å calc* —Ñ—É–Ω–∫—Ü–∏–∏)

---

## üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

### Phase 1.4: Meal Quality Score Module

**–§–∞–π–ª**: `heys_day_scoring/mealQualityScore.js`  
**–°—Ç—Ä–æ–∫–∏ –≤ heys_day_v12.js**: 1062-1470  
**–°—Ç–∞—Ç—É—Å**: ‚è≥ –ù–µ –Ω–∞—á–∞—Ç–æ

**–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è**:
- `calcKcalScore(kcal, mealType, optimum, timeStr)` 
- `calcMacroScore(prot, carbs, fat, kcal, mealType, timeStr)`
- `calcCarbQuality(simple, complex)`
- `calcFatQuality(bad, good, trans)`
- `calcGiHarmScore(avgGI, avgHarm)`
- `getMealQualityScore(meal, mealType, optimum, pIndex)`
- Helper: `safeRatio(num, denom, fallback)`

---

## ‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è

### Phase 2: Scientific Helpers (Complete)
‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ —Å–æ–∑–¥–∞–Ω—ã

### Phase 3: UI Components (~60 –º–∏–Ω—É—Ç)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç—Ä–æ–∫–∏ | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|-----------|--------|--------|-----------|
| PhotoGallery.js | 87-555 (468 lines) | ‚è≥ Pending | Medium |
| MealCard.js | 1803-2509 (706 lines) | ‚è≥ Pending | High |
| ProductRow.js | 1727-1802 (75 lines) | ‚è≥ Pending | High |
| MealAddProduct.js | 1471-1726 (255 lines) | ‚è≥ Pending | High |
| AdviceCard.js | 2510-~2800 (290 lines) | ‚è≥ Pending | Medium |

**–ò—Ç–æ–≥–æ**: ~1,794 —Å—Ç—Ä–æ–∫–∏ UI –∫–æ–¥–∞

### Phase 4: Integration & Testing (~30 –º–∏–Ω—É—Ç)

- [ ] –û–±–Ω–æ–≤–∏—Ç—å `index.html` —Å –Ω–æ–≤—ã–º–∏ script —Ç–µ–≥–∞–º–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `heys_day_v12.js` (–∑–∞–º–µ–Ω–∏—Ç—å –≤—ã–Ω–µ—Å–µ–Ω–Ω—ã–π –∫–æ–¥ –Ω–∞ –∏–º–ø–æ—Ä—Ç—ã)
- [ ] Syntax validation (`node -c`)
- [ ] Type check (`pnpm type-check`)
- [ ] Build (`pnpm build`)
- [ ] Runtime —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (`pnpm dev`)

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å | –¢–µ–∫—É—â–µ–µ | –ü—Ä–æ–≥—Ä–µ—Å—Å |
|---------|------|---------|----------|
| –ú–æ–¥—É–ª–µ–π —Å–æ–∑–¥–∞–Ω–æ | 12 | 6 | 50% |
| –°—Ç—Ä–æ–∫ –∏–∑–≤–ª–µ—á–µ–Ω–æ | ~8,000 | ~771 | 9.6% |
| –§–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ | 4 | 0.5 | 12.5% |

---

## üöß –ë–ª–æ–∫–µ—Ä—ã

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è:

1. **mealQualityScore.js** ‚Äî —ç—Ç–æ —è–¥—Ä–æ scoring —Å–∏—Å—Ç–µ–º—ã, –±–µ–∑ –Ω–µ–≥–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞
2. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (Phase 3)** ‚Äî MealCard, ProductRow, MealAddProduct –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ–≤—Å–µ–º–µ—Å—Ç–Ω–æ
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞, —á—Ç–æ–±—ã –Ω–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –æ—à–∏–±–∫–∏

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫)

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (Critical):

1. **–°–æ–∑–¥–∞—Ç—å `heys_day_scoring/mealQualityScore.js`**
   - –ò–∑–≤–ª–µ—á—å –≤—Å–µ calc* —Ñ—É–Ω–∫—Ü–∏–∏ (lines 1062-1470)
   - –î–æ–±–∞–≤–∏—Ç—å –≤ namespace HEYS.dayScoring
   - ~400 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

2. **–°–æ–∑–¥–∞—Ç—å index –º–æ–¥—É–ª–∏ (re-export)**
   - `heys_day_scoring/index.js` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö scoring —Ñ—É–Ω–∫—Ü–∏–π
   - `heys_day_science/index.js` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –Ω–∞—É—á–Ω—ã—Ö —Ö–µ–ª–ø–µ—Ä–æ–≤

### –ó–∞—Ç–µ–º (High Priority):

3. **–ò–∑–≤–ª–µ—á—å UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ –æ–¥–Ω–æ–º—É**:
   - –ù–∞—á–∞—Ç—å —Å `ProductRow.js` (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π, 75 —Å—Ç—Ä–æ–∫)
   - –ó–∞—Ç–µ–º `MealAddProduct.js`
   - –ó–∞—Ç–µ–º `MealCard.js` (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç ProductRow –∏ MealAddProduct)

4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Phase 1**:
   - –û–±–Ω–æ–≤–∏—Ç—å `index.html` —Å –Ω–æ–≤—ã–º–∏ script —Ç–µ–≥–∞–º–∏
   - –û–±–Ω–æ–≤–∏—Ç—å `heys_day_v12.js` (–∏–º–ø–æ—Ä—Ç—ã –∏–∑ HEYS.dayScoring/dayScience)
   - **–¢–ï–°–¢**: `pnpm dev` –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å scoring

### –ü–æ—Ç–æ–º (Medium Priority):

5. **Phase 3 –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ**:
   - `PhotoGallery.js`
   - `AdviceCard.js`

6. **Phase 4: Final Integration**
   - –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞ –∏–∑ `heys_day_v12.js`

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏:

1. **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** ‚Äî –º–æ–¥—É–ª–∏ –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–µ—Ç—å –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ `index.html` –∫—Ä–∏—Ç–∏—á–µ–Ω

2. **–ü–æ—Ç–µ—Ä—è –Ω–∞—É—á–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤** ‚Äî PMID —Å—Å—ã–ª–∫–∏ –≤–∞–∂–Ω—ã
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤–º–µ—Å—Ç–µ —Å –∫–æ–¥–æ–º ‚úÖ (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)

3. **HMR –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç—å** ‚Äî Vite –º–æ–∂–µ—Ç –Ω–µ —É–≤–∏–¥–µ—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ `pnpm dev` –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–¥—É–ª–µ–π

4. **–ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º —Ä–∞–±–æ—Ç—ã** ‚Äî ~8000 —Å—Ç—Ä–æ–∫ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –î–µ–ª–∞—Ç—å –º–∞–ª–µ–Ω—å–∫–∏–º–∏ —à–∞–≥–∞–º–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–æ

### –ü—Ä–æ—Ü–µ—Å—Å–Ω—ã–µ —Ä–∏—Å–∫–∏:

1. **–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –Ω–µ–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π** ‚Äî —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ñ–∞–π–ª–æ–≤
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –ö–æ–º–º–∏—Ç–∏—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è

2. **–û—à–∏–±–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å inline –∫–æ–¥ –Ω–∞ –∏–º–ø–æ—Ä—Ç—ã —Å–ª–æ–∂–Ω–æ
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—Ç—å –í–°–ï –º–æ–¥—É–ª–∏, –ø–æ—Ç–æ–º –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å

---

## üìù Lessons Learned (–∏–∑ PR #15)

1. ‚úÖ **–ù–ï —Å–º–µ—à–∏–≤–∞—Ç—å —Ñ–∞–∑—ã** ‚Äî Phase 1 –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –î–û Phase 2
2. ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–æ** ‚Äî –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è –∑–∞–ø—É—Å–∫–∞—Ç—å `pnpm dev`
3. ‚úÖ **–°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** ‚Äî –Ω–∞—É—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –≤ –º–æ–¥—É–ª–∏
4. ‚ö†Ô∏è **–ù–µ –¥–µ–ª–∞—Ç—å —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ PR** ‚Äî —Ç–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥: –º–∞–ª–µ–Ω—å–∫–∏–µ PR, —á–∞—Å—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **Task Plan**: `docs/tasks/2025-12-10-refactor-heys-day-incremental.md`
- **PR #15 Analysis**: `docs/PR15_ANALYSIS.md`
- **Decision Summary**: `docs/REFACTOR_DECISION_SUMMARY.md`

---

## ‚úÖ Checklist –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º

- [x] –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ (`heys_day_scoring/`, `heys_day_science/`, `heys_day_components/`)
- [x] –°–æ–∑–¥–∞–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –Ω–∞—É—á–Ω—ã–µ —Ö–µ–ª–ø–µ—Ä—ã (6 –º–æ–¥—É–ª–µ–π)
- [ ] –°–æ–∑–¥–∞–Ω `mealQualityScore.js` (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
- [ ] –°–æ–∑–¥–∞–Ω `index.js` –¥–ª—è re-export
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω `index.html` —Å script —Ç–µ–≥–∞–º–∏
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω `heys_day_v12.js` —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏
- [ ] –ó–∞–ø—É—â–µ–Ω `pnpm dev` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- [ ] –°–æ–∑–¥–∞–Ω—ã UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (Phase 3)
- [ ] –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Phase 4)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-12-10 10:35 UTC  
**–°—Ç–∞—Ç—É—Å**: üü° Phase 1 —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –Ω—É–∂–µ–Ω `mealQualityScore.js` –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
