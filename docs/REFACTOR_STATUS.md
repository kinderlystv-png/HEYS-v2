# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ heys_day_v12.js ‚Äî –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

**–î–∞—Ç–∞**: 2025-12-09  
**–í–µ—Ç–∫–∞**: `copilot/refactor-heys-day-v12-again`

---

## ‚úÖ –ß—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

### Phase 1: Scoring Logic ‚úÖ COMPLETE
**–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ**: 754 —Å—Ç—Ä–æ–∫–∏ (15,647 ‚Üí 14,893)

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏:**
1. `heys_day_scoring/mealQualityScore.js` (436 —Å—Ç—Ä–æ–∫)
   - getMealQualityScore, calcKcalScore, calcMacroScore
   - calcCarbQuality, calcFatQuality, calcGiHarmScore
   
2. `heys_day_scoring/nutrientColors.js` (398 —Å—Ç—Ä–æ–∫)
   - getNutrientColor, getNutrientTooltip
   - getDailyNutrientColor, getDailyNutrientTooltip

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ heys_day_v12.js

---

### Phase 2: Modal Components üü° PARTIAL
**–¶–µ–ª–µ–≤–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ**: ~1,000 —Å—Ç—Ä–æ–∫  
**–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ**: –ú–æ–¥—É–ª–∏ —Å–æ–∑–¥–∞–Ω—ã, –Ω–æ –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏:**
1. `heys_day_modals/ZoneMinutesPicker.js` (113 —Å—Ç—Ä–æ–∫)
   - –í—ã–±–æ—Ä –º–∏–Ω—É—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (0-120)
   - Props: isOpen, zoneIndex, value, kcalPerMin, onConfirm, onCancel
   
2. `heys_day_modals/SleepQualityPicker.js` (251 —Å—Ç—Ä–æ–∫)
   - –û—Ü–µ–Ω–∫–∞ —Å–Ω–∞ (0-10) —Å emoji, —Å–ª–∞–π–¥–µ—Ä–æ–º, quick chips
   - Props: isOpen, value, note, sleepHours, existingNote, onConfirm, onCancel
   
3. `heys_day_modals/DayScorePicker.js` (221 —Å—Ç—Ä–æ–∫)
   - –û—Ü–µ–Ω–∫–∞ –¥–Ω—è (0-10) —Å –∞–≤—Ç–æ-—Ä–∞—Å—á—ë—Ç–æ–º
   - Props: isOpen, value, comment, autoScore, onConfirm, onCancel

**–°—Ç–∞—Ç—É—Å**: 
- ‚úÖ –ú–æ–¥—É–ª–∏ —Å–æ–∑–¥–∞–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π (IIFE + HEYS namespace)
- ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ index.html
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ heys_day_v12.js
- ‚è∏Ô∏è **–û–∂–∏–¥–∞–µ—Ç**: –ó–∞–º–µ–Ω–∞ inline –∫–æ–¥–∞ –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–æ—Ç–ª–æ–∂–µ–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

**–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–ª–æ–∂–µ–Ω–∏—è**:
- –°–ª–æ–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ React.createElement —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –ø–æ—Ä—Ç–∞–ª–∞–º–∏
- –¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Å—Ç–æ—Ä–æ–∂–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±–µ–∑ –ø–æ–ª–æ–º–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ UI
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è runtime —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

---

## üîÑ –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å

### Phase 2: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–æ–¥–∞–ª–æ–∫
**–û—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å:**
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å inline –∫–æ–¥ ZoneMinutesPicker –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (~33 —Å—Ç—Ä–æ–∫–∏)
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å inline –∫–æ–¥ SleepQualityPicker –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (~150 —Å—Ç—Ä–æ–∫)
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å inline –∫–æ–¥ DayScorePicker –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (~123 —Å—Ç—Ä–æ–∫)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –º–æ–¥–∞–ª–æ–∫ –≤ runtime

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ**: ~306 —Å—Ç—Ä–æ–∫ (14,877 ‚Üí ~14,571)

---

### Phase 3: –ì—Ä–∞—Ñ–∏–∫–∏ (üü° –°–†–ï–î–ù–ò–ô –†–ò–°–ö)
**–¶–µ–ª–µ–≤–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ**: ~2,500 —Å—Ç—Ä–æ–∫

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:**
1. KcalSparkline (~1,300 —Å—Ç—Ä–æ–∫) - –ì—Ä–∞—Ñ–∏–∫ –∫–∞–ª–æ—Ä–∏–π —Å zoom/pan
2. WeightSparkline (~684 —Å—Ç—Ä–æ–∫) - –ì—Ä–∞—Ñ–∏–∫ –≤–µ—Å–∞ —Å cycle –∑–æ–Ω–∞–º–∏
3. MoodSparkline (~200 —Å—Ç—Ä–æ–∫) - –ú–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è

**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: 
- –ú–Ω–æ–≥–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ state (slider, zoom, pan, brush)
- SVG path –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (hover, click, touch)

---

### Phase 4: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞—Ä—Ç–æ—á–µ–∫ (üü° –°–†–ï–î–ù–ò–ô –†–ò–°–ö)
**–¶–µ–ª–µ–≤–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ**: ~3,000 —Å—Ç—Ä–æ–∫

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:**
1. LazyPhotoThumb (~310 —Å—Ç—Ä–æ–∫) - Lazy loading —Ñ–æ—Ç–æ
2. ProductRow (~69 —Å—Ç—Ä–æ–∫) - –°—Ç—Ä–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
3. MealAddProduct (~232 —Å—Ç—Ä–æ–∫) - –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
4. MealCard (~617 —Å—Ç—Ä–æ–∫) - **–°–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
5. AdviceCard (~206 —Å—Ç—Ä–æ–∫) - –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–≤–µ—Ç–∞
6. HeroMetrics (~650 —Å—Ç—Ä–æ–∫) - –ö–∞—Ä—Ç–æ—á–∫–∏ –∫–∞–ª–æ—Ä–∏–π/–≤–æ–¥—ã/—à–∞–≥–æ–≤
7. WaterCard (~320 —Å—Ç—Ä–æ–∫) - –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–æ–¥—ã
8. InsulinWaveIndicator (~379 —Å—Ç—Ä–æ–∫) - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤–æ–ª–Ω—ã
9. StatisticsBlock (~1,203 —Å—Ç—Ä–æ–∫) - –ë–ª–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–°–ª–æ–∂–Ω–æ—Å—Ç—å**:
- MealCard –∏–º–µ–µ—Ç ~22 props –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π memo comparator
- –¢–µ—Å–Ω–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ (ProductRow —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ MealCard)
- –ú–Ω–æ–≥–æ callbacks –∏ refs

---

### Phase 5-6: –§–∏–Ω–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å DayTab –¥–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (~2,000 —Å—Ç—Ä–æ–∫)
- [ ] –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Full E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ò—Å—Ö–æ–¥–Ω–æ–µ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª—å | –ü—Ä–æ–≥—Ä–µ—Å—Å |
|---------|----------|---------|------|----------|
| **heys_day_v12.js** | 15,647 | 14,877* | ~2,000 | 4.9% |
| **–§–∞–π–ª–æ–≤ –º–æ–¥—É–ª–µ–π** | 1 | 6 | ~15 | 40% |
| **–°—Ç—Ä–æ–∫ –∏–∑–≤–ª–µ—á–µ–Ω–æ (–≤ –º–æ–¥—É–ª–∏)** | 0 | ~1,420 | ~13,000 | 10.9% |
| **–°—Ç—Ä–æ–∫ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω–æ** | 0 | 754** | ~13,647 | 5.5% |

\* –í–∫–ª—é—á–∞–µ—Ç +16 —Å—Ç—Ä–æ–∫ –∏–º–ø–æ—Ä—Ç–æ–≤ –¥–ª—è Phase 2 –º–æ–¥–∞–ª–æ–∫  
\*\* –¢–æ–ª—å–∫–æ Phase 1 scoring –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å):
1. ‚úÖ **–ó–∞–≤–µ—Ä—à–∏—Ç—å Phase 2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é** - –∑–∞–º–µ–Ω–∏—Ç—å inline –º–æ–¥–∞–ª–∫–∏ –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (~300 —Å—Ç—Ä–æ–∫)
2. ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ runtime** - `pnpm dev` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Phase 1+2

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (—Å–ª–µ–¥—É—é—â–∞—è —Å–µ—Å—Å–∏—è):
3. üü° **Phase 3: –ì—Ä–∞—Ñ–∏–∫–∏** - —Å–∞–º–∞—è –æ–±—ä—ë–º–Ω–∞—è —Ñ–∞–∑–∞ (~2,500 —Å—Ç—Ä–æ–∫)
4. üü° **Phase 4: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** - —Ç—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏ —Å MealCard

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (—Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏):
5. üü° **Phase 5-6: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è "–ø–æ–ª–∏—Ä–æ–≤–∫–∞"

---

## ‚ö†Ô∏è –ë–ª–æ–∫–µ—Ä—ã –∏ —Ä–∏—Å–∫–∏

### –¢–µ–∫—É—â–∏–µ –±–ª–æ–∫–µ—Ä—ã:
- **–ù–µ—Ç runtime —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** - Phase 1 –∏ Phase 2 –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- **–°–ª–æ–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ React.createElement** - —Ç—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ–π –∑–∞–º–µ–Ω—ã

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏ Phase 3-4:
- –ú–Ω–æ–≥–æ state –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ memo comparators –Ω—É–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é
- ~80 useState –≤ DayTab —Å–æ–∑–¥–∞—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –í–∞—Ä–∏–∞–Ω—Ç A: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Phase 1+2 –≤ runtime (`pnpm dev`)
2. –ü–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å Phase 2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
3. –ó–∞—Ç–µ–º –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ Phase 3

### –í–∞—Ä–∏–∞–Ω—Ç B: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π
1. –ó–∞–≤–µ—Ä—à–∏—Ç—å Phase 2 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å–µ–π—á–∞—Å
2. –ù–∞—á–∞—Ç—å Phase 3 (–≥—Ä–∞—Ñ–∏–∫–∏)
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë —Ä–∞–∑–æ–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í–∞—Ä–∏–∞–Ω—Ç A –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –¥–ª—è production –∫–æ–¥–∞.

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **Phase 1 Summary**: `docs/REFACTOR_PHASE1_SUMMARY.md`
- **Phase 2 Plan**: `docs/REFACTOR_PHASE2_PLAN.md`
- **Original Plan**: `docs/tasks/2025-12-09-refactor-heys-day-v12.md`
- **Backup**: `apps/web/heys_day_v12.pre-refactor.js` (15,647 lines)
