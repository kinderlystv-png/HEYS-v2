# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: –í—ã–Ω–æ—Å MealAddProduct –∑–∞ –ø—Ä–µ–¥–µ–ª—ã DayTab

**–î–∞—Ç–∞**: 2025-12-01  
**–í—Ä–µ–º—è**: ~60-90 –º–∏–Ω  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π (performance)

---

## –ü—Ä–æ–±–ª–µ–º–∞

`MealAddProduct` ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ~800 —Å—Ç—Ä–æ–∫, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π **–≤–Ω—É—Ç—Ä–∏** —Ñ—É–Ω–∫—Ü–∏–∏ `DayTab`.

–ü—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ `DayTab`:
1. –°–æ–∑–¥–∞—ë—Ç—Å—è **–Ω–æ–≤–∞—è** —Ñ—É–Ω–∫—Ü–∏—è `MealAddProduct`
2. React —Å—á–∏—Ç–∞–µ—Ç –µ—ë **–Ω–æ–≤—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º** (—Ä–∞–∑–Ω—ã–µ object references)
3. –†–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—ã–π ‚Üí —Ç–µ—Ä—è—é—Ç—Å—è –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ `useState` (`search`, `open`, `selectedIndex`, `animatedKcal`, etc.)
4. –í—ã–∑—ã–≤–∞–µ—Ç –∫–∞—Å–∫–∞–¥ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤ (70+ –∑–∞ –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ!)

**–°–∏–º–ø—Ç–æ–º—ã**:
- –ú–æ–¥–∞–ª–∫–∞ –≥—Ä–∞–º–º–æ–≤ –∑–∞–∫—Ä—ã–≤–∞–ª–∞—Å—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ (—á–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ lifting state)
- 70+ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤ MealAddProduct –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏
- –ü–æ—Ç–µ—Ä—è —Ñ–æ–∫—É—Å–∞ –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
- –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

---

## –†–µ—à–µ–Ω–∏–µ

–í—ã–Ω–µ—Å—Ç–∏ `MealAddProduct` **–∑–∞ –ø—Ä–µ–¥–µ–ª—ã** `DayTab` –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å `React.memo`.

---

## –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `apps/web/heys_day_v12.js` | –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª, —Å–æ–¥–µ—Ä–∂–∏—Ç DayTab –∏ MealAddProduct |

---

## –ó–∞–¥–∞—á–∏

### 1. –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π MealAddProduct –æ—Ç closure DayTab

- [ ] –°–æ—Å—Ç–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ DayTab, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ MealAddProduct
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–∏–µ –∏–∑ –Ω–∏—Ö –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —á–µ—Ä–µ–∑ props
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–∏–µ –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ callbacks

**–û–∂–∏–¥–∞–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å)**:
```
–ò–∑ DayTab state/props:
- gramsModal, setGramsModal ‚Äî lifted state –¥–ª—è –º–æ–¥–∞–ª–∫–∏
- day, setDay ‚Äî –¥–∞–Ω–Ω—ã–µ –¥–Ω—è
- products ‚Äî –º–∞—Å—Å–∏–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- date ‚Äî —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞ (–¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤)

–ò–∑ closure (—É—Ç–∏–ª–∏—Ç—ã):
- lsGet, lsSet ‚Äî localStorage —Å namespace
- haptic ‚Äî –≤–∏–±—Ä–∞—Ü–∏—è
- uid ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ID
- U ‚Äî dayUtils
- computePopularProducts ‚Äî –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ top20
- buildProductIndex ‚Äî –∏–Ω–¥–µ–∫—Å –ø—Ä–æ–¥—É–∫—Ç–æ–≤
```

### 2. –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å props –¥–ª—è MealAddProduct

- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä props
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π prop

```javascript
// –û–∂–∏–¥–∞–µ–º—ã–µ props:
{
  mi,                    // number ‚Äî –∏–Ω–¥–µ–∫—Å –ø—Ä–∏—ë–º–∞ –ø–∏—â–∏
  gramsModal,           // object|null ‚Äî { product, mealIndex, gramsValue }
  setGramsModal,        // function
  day,                  // object ‚Äî –¥–∞–Ω–Ω—ã–µ –¥–Ω—è
  setDay,               // function  
  products,             // array ‚Äî —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
  date,                 // string ‚Äî YYYY-MM-DD
  // –£—Ç–∏–ª–∏—Ç—ã –º–æ–∂–Ω–æ –±—Ä–∞—Ç—å –∏–∑ window.HEYS –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å
}
```

### 3. –í—ã–Ω–µ—Å—Ç–∏ MealAddProduct –∑–∞ –ø—Ä–µ–¥–µ–ª—ã DayTab

- [ ] –ù–∞–π—Ç–∏ –Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ MealAddProduct (—Å—Ç—Ä–æ–∫–∞ ~435)
- [ ] –ù–∞–π—Ç–∏ –∫–æ–Ω–µ—Ü —Ñ—É–Ω–∫—Ü–∏–∏ MealAddProduct (—Å—Ç—Ä–æ–∫–∞ ~1250)
- [ ] –í—ã—Ä–µ–∑–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
- [ ] –í—Å—Ç–∞–≤–∏—Ç—å **–ø–µ—Ä–µ–¥** –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º `HEYS.DayTab`
- [ ] –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ arrow function —Å React.memo:

```javascript
const MealAddProduct = React.memo(function MealAddProduct({ 
  mi, 
  gramsModal, 
  setGramsModal, 
  day, 
  setDay, 
  products, 
  date 
}) {
  // ... —Ç–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏
});
```

### 4. –ó–∞–º–µ–Ω–∏—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ closure –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –Ω–∞ props

- [ ] `gramsModal` ‚Üí `props.gramsModal` (–∏–ª–∏ –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è)
- [ ] `setGramsModal` ‚Üí `props.setGramsModal`
- [ ] `day` ‚Üí `props.day`
- [ ] `setDay` ‚Üí `props.setDay`
- [ ] `products` ‚Üí `props.products`
- [ ] `date` ‚Üí `props.date`

### 5. –ó–∞–º–µ–Ω–∏—Ç—å —É—Ç–∏–ª–∏—Ç—ã –∏–∑ closure –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ

- [ ] `lsGet` ‚Üí `HEYS.utils.lsGet` –∏–ª–∏ `U.lsGet`
- [ ] `lsSet` ‚Üí `HEYS.utils.lsSet` –∏–ª–∏ `U.lsSet`
- [ ] `haptic` ‚Üí `HEYS.dayUtils.haptic` –∏–ª–∏ `U.haptic`
- [ ] `uid` ‚Üí `HEYS.dayUtils.uid` –∏–ª–∏ `U.uid`
- [ ] `computePopularProducts` ‚Üí `HEYS.dayUtils.computePopularProducts`

### 6. –û–±–Ω–æ–≤–∏—Ç—å –≤—ã–∑–æ–≤—ã MealAddProduct –≤ DayTab

- [ ] –ù–∞–π—Ç–∏ –≤—Å–µ –º–µ—Å—Ç–∞ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `<MealAddProduct mi={...} />`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ props:

```javascript
React.createElement(MealAddProduct, {
  mi: mi,
  gramsModal: gramsModal,
  setGramsModal: setGramsModal,
  day: day,
  setDay: setDay,
  products: products,
  date: date
})
```

### 7. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å callbacks —Å useCallback

- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `setGramsModal` —Å—Ç–∞–±–∏–ª—å–Ω—ã–π (–Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è)
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `setDay` —Å—Ç–∞–±–∏–ª—å–Ω—ã–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å comparison function –≤ React.memo –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:

```javascript
const MealAddProduct = React.memo(function MealAddProduct(props) {
  // ...
}, (prevProps, nextProps) => {
  // Shallow compare –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
  return prevProps.mi === nextProps.mi &&
         prevProps.gramsModal === nextProps.gramsModal &&
         prevProps.day.meals === nextProps.day.meals &&
         prevProps.products === nextProps.products;
});
```

### 8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–æ–¥–∞–ª–∫–∞ –≥—Ä–∞–º–º–æ–≤ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—ã–±–æ—Ä –ø–æ—Ä—Ü–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∞–Ω–∏–º–∞—Ü–∏—è kcal —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –û—Ç–∫—Ä—ã—Ç—å React DevTools Profiler ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ MealAddProduct –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ DayTab

### 9. Cleanup

- [ ] –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ DayTab
- [ ] `pnpm type-check && pnpm lint && pnpm build`

---

## –†–∏—Å–∫–∏

| –†–∏—Å–∫ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-----------|
| –ú–Ω–æ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç closure | –ê–∫–∫—É—Ä–∞—Ç–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ props |
| –°–ª–æ–º–∞–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞ | –¢—â–∞—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —à–∞–≥ |
| –ë–æ–ª—å—à–æ–π diff | –ú–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ 2 PR: 1) –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞, 2) –≤—ã–Ω–æ—Å |

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] `MealAddProduct` –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –í–ù–ï `DayTab`
- [ ] –û–±—ë—Ä–Ω—É—Ç –≤ `React.memo`
- [ ] –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ props
- [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤ MealAddProduct = 1-2 –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏ (–Ω–µ 70+)
- [ ] –ú–æ–¥–∞–ª–∫–∞ –≥—Ä–∞–º–º–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- [ ] Build –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `apps/web/heys_day_v12.js` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª
- `apps/web/heys_day_utils.js` ‚Äî —É—Ç–∏–ª–∏—Ç—ã (U)
- `apps/web/heys_day_hooks.js` ‚Äî hooks

---

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–µ—Å–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–π)

1. **useRef –¥–ª—è MealAddProduct** ‚Äî —Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ ref, –Ω–æ —ç—Ç–æ —Ö–∞–∫
2. **Context** ‚Äî —Å–æ–∑–¥–∞—Ç—å MealAddProductContext –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
3. **Zustand/Jotai** ‚Äî –≤—ã–Ω–µ—Å—Ç–∏ state –≤ store (overkill –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏)

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä—è–º–æ–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ‚Äî –æ–Ω —á–∏—Å—Ç—ã–π –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π.
