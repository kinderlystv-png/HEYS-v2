# ๐ ะะฐะณััะทะพัะฝัะน ะดะตะฝั (Refeed Day) โ ะัะพะทะฝะฐะฝะฝะฐั ะพัะผะตัะบะฐ ะฒ ัะตะบ-ะธะฝะต

**ะะฐัะฐ**: 2025-12-12  
**ะัะตะผั**: ~2-3 ัะฐัะฐ  
**ะัะธะพัะธัะตั**: ะกัะตะดะฝะธะน  
**ะกัะฐััั**: ๐ ะะพะฒัะน

---

## ะะพะฝัะตะฟัะธั

**ะะฐะณััะทะพัะฝัะน ะดะตะฝั (Refeed Day)** โ ััะพ **ะพัะพะทะฝะฐะฝะฝะพะต** ัะตัะตะฝะธะต ะบะปะธะตะฝัะฐ ััะตััั
ะฑะพะปััะต ะฝะพัะผั. ะ ะพัะปะธัะธะต ะพั ัััะฒะฐ (crash/binge), ััะพ ะบะพะฝััะพะปะธััะตะผัะน ะฟัะพัะตัั:

- ะะปะธะตะฝั **ะทะฐัะฐะฝะตะต ะฟะปะฐะฝะธััะตั** ะฟะตัะตะฑะพั
- ะััะฐัะพั **ะฒะธะดะธั** ััะพ ััะพ ะฝะต ัััะฒ, ะฐ ะฟะปะฐะฝ
- ะกะธััะตะผะฐ **ะฝะต ััะณะฐะตั** ะทะฐ ะฟัะตะฒััะตะฝะธะต ะฝะพัะผั
- **ะฃััั ะฒัั ัะฐะฒะฝะพ ะฒะตะดัััั** โ ะบะปะธะตะฝั ััะตะบะฐะตั ะตะดั

### ะะฐัะตะผ ััะพ ะฝัะถะฝะพ?

1. **ะะตัะฐะฑะพะปะธัะตัะบะพะต ะพะฑะพัะฝะพะฒะฐะฝะธะต**: ะะพัะปะต ะฝะตัะบะพะปัะบะธั ะดะฝะตะน ะดะตัะธัะธัะฐ refeed
   ะฟะพะผะพะณะฐะตั ะฒะพัััะฐะฝะพะฒะธัั ะณะพัะผะพะฝะฐะปัะฝัะน ะฑะฐะปะฐะฝั (ะปะตะฟัะธะฝ, ัะตััะพััะตัะพะฝ)
2. **ะัะธัะพะปะพะณะธัะตัะบะธะน ะบะพะฝััะพะปั**: ะะปะธะตะฝั ะฝะต ััะฒััะฒัะตั ะฒะธะฝั โ ััะพ ัะฐััั ะฟะปะฐะฝะฐ
3. **ะัะพะทัะฐัะฝะพััั ะดะปั ะบััะฐัะพัะฐ**: ะััะฐัะพั ะฟะพะฝะธะผะฐะตั ะฟะพัะตะผั ะบะปะธะตะฝั ะฟะตัะตะตะป
4. **Gamification**: ะะต ะปะพะผะฐะตั streak (ะฟัะธ ัะฐะทัะผะฝะพะผ ะฟะตัะตะฑะพัะต)

---

## โ ะัะธะฝัััะต ัะตัะตะฝะธั

1. **ะกัะฐััั ะดะฝั**: ะะฐัะธะฐะฝั B โ ะฒะฒะพะดะธะผ `refeed_ok/refeed_over`, ัะฝะธะผะฐะตะผ
   "ัััะดััะธะต" ะฟัะตะดัะฟัะตะถะดะตะฝะธั ะฟัะธ ratio < 1.35

2. **Streak**: ัะพััะฐะฝัะตะผ ัะตัะธั ะตัะปะธ `ratio >= 0.70 && ratio < 1.35`

3. **ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต**: ะะฐ, ะผะพะถะฝะพ ะฒะบะปััะฐัั/ะฒัะบะปััะฐัั refeed ะฝะต ัะพะปัะบะพ ะฒ ัะตะบ-ะธะฝะต,
   ะฝะพ ะธ ะบะฝะพะฟะบะพะน ๐ ะฒ ะบะฐััะพัะบะต ะบะฐะปะพัะธะน

4. **ะะตะถะธะผ ัะตะปะธ**: ะจะฐะณ ะดะพัััะฟะตะฝ ะฒัะตะผ (deficit/maintenance/bulk). ะขะตะบััั
   ะพะดะธะฝะฐะบะพะฒัะต โ "ะทะฐะณััะทะพัะฝัะน ะดะตะฝั" ะฟะพะฝััะตะฝ ะฒ ะปัะฑะพะผ ัะตะถะธะผะต

5. **ะัะธัะธะฝั**: ะคะธะบัะธัะพะฒะฐะฝะฝัะน ัะฟะธัะพะบ (4-5 ะฒะฐัะธะฐะฝัะพะฒ), ะฑะตะท "ะััะณะพะต" ะดะปั ะฟัะพััะพัั

6. **ะะตััะพ ะฒ ัะตะบ-ะธะฝะต**: ะกัะฐะทั ะฟะพัะปะต `sleepQuality`, ะฟะตัะตะด `cycle/measurements`

7. **ะขัะตะฝะด ะฒะตัะฐ**: ะะฐ, ะธัะบะปััะฐัั refeed-ะดะฝะธ ะธะท ัะฐััััะฐ "ัะธััะพะณะพ" ััะตะฝะดะฐ ะฒะตัะฐ (ะฟะพ
   ะฐะฝะฐะปะพะณะธะธ ั ะถะตะฝัะบะธะผ ัะธะบะปะพะผ) โ ัะบะฐัะพะบ ะฒะตัะฐ ะฟะพัะปะต refeed = ะฒะพะดะฐ/ะณะปะธะบะพะณะตะฝ, ะฝะต ะถะธั

---

## ะะฐะถะฝัะต ััะพัะฝะตะฝะธั (ััะพะฑั ะฝะต ัะดะตะปะฐัั ะปะธัะฝะตะณะพ ะธ ะฝะต ัะปะพะผะฐัั ัััะตััะฒัััะธะน ะบะพะด)

1. **Refeed โ ะฐะฒัะพะฟะพะดะฝััะธะต ะฝะพัะผั.** ะัะผะตัะบะฐ ะบะปะธะตะฝัะฐ โ ััะพ ะฒ ะฟะตัะฒัั ะพัะตัะตะดั
   **ะผะตัะบะฐ ะฝะฐะผะตัะตะฝะธั** + ะธะทะผะตะฝะตะฝะธะต ัะพะฝะฐะปัะฝะพััะธ/ััะฐัััะพะฒ. ะะฒัะพะผะฐัะธัะตัะบะพะต
   ะฟะพะฒััะตะฝะธะต `optimum` ั ะฝะฐั ัะถะต ะดะตะปะฐะตั ัะธััะตะผะฐ **Caloric Debt / needsRefeed**.
   ะัััะต ัะฒะฝะพ ัะฐะทะฒะตััะธ:
   - `caloricDebt.needsRefeed` = ัะธััะตะผะฐ ัะตะบะพะผะตะฝะดัะตั refeed (ะฟะพะดัะบะฐะทะบะฐ)
   - `day.isRefeedDay` = ะบะปะธะตะฝั ะพัะพะทะฝะฐะฝะฝะพ ะพัะผะตัะธะป (ัะฐะบั/ะฝะฐะผะตัะตะฝะธะต)

2. **ะะต ะปะพะผะฐัั API `HEYS.ratioZones`.** `HEYS.ratioZones.getZone(ratio)` ัะถะต
   ะธัะฟะพะปัะทัะตััั ะฒ ัะฐะทะฝัั ะผะตััะฐั. ะะทะผะตะฝะตะฝะธะต ัะธะณะฝะฐัััั (ะดะพะฑะฐะฒะปะตะฝะธะต `options`)
   ะผะพะถะตั ัะธัะพ ะฟะพะปะพะผะฐัั ะฒัะทะพะฒั.

   ะะตะบะพะผะตะฝะดะฐัะธั: ะดะพะฑะฐะฒะธัั ะพัะดะตะปัะฝัะน helper (ะฒ `heys_day_v12.js` ะธะปะธ ะฒะฝัััะธ
   ratioZones ะบะฐะบ ะฝะพะฒัะน ะผะตัะพะด), ะบะพัะพััะน ััะธััะฒะฐะตั `dayData`, ะฝะพ ะพััะฐะฒะปัะตั
   `getZone(ratio)` ะบะฐะบ ะตััั.

3. **ะฆะตะปั refeed ะดะฝั โ "ะบะพะฝััะพะปั ะฑะตะท ะฒะธะฝั", ะฝะพ ะฝะต "ะฑะตะทะปะธะผะธั".** ะ UI ะพะฑัะทะฐัะตะปัะฝะพ
   ะดะตัะถะฐัั ะณัะฐะฝะธัั: ะผัะณะบะธะน "ะทะตะปัะฝัะน" ะดะธะฐะฟะฐะทะพะฝ ะดะพ `ratio < 1.35`, ะฐ ะฟะพัะปะต โ
   ัะตััะฝะฐั ะบัะฐัะฝะฐั ะฟะพะดัะฒะตัะบะฐ.

4. **ะฅัะฐะฝะตะฝะธะต.** ะะพะปั ะดะพะปะถะฝั ะปะตะถะฐัั ะฒ `heys_dayv2_{date}` (ัะตัะตะท StepModal utils
   `lsGet/lsSet`, ััะพะฑั ะบะพััะตะบัะฝะพ ัะฐะฑะพัะฐะป namespace clientId ะธ ัะธะฝะบ ะดะฝั).

---

## ะะปััะตะฒัะต ัะฐะนะปั

| ะคะฐะนะป                           | ะงัะพ ะดะตะปะฐัั                                                                             |
| ------------------------------ | -------------------------------------------------------------------------------------- |
| `heys_steps_v1.js`             | ะะพะฒัะน ัะฐะณ `refeed` ะดะปั ัััะตะฝะฝะตะณะพ ัะตะบ-ะธะฝะฐ                                               |
| `heys_morning_checkin_v1.js`   | ะะพะฑะฐะฒะธัั `refeed` ะฒ `getCheckinSteps()`                                                |
| `heys_day_v12.js`              | UI: ะฑะตะนะดะถ ะฝะฐ ะณัะฐัะธะบะต, ะบะฐััะพัะบะฐ ะบะฐะปะพัะธะน + **ะบะฝะพะฟะบะฐ ๐ ะดะปั ะฒะบะปััะตะฝะธั/ะฒัะบะปััะตะฝะธั refeed** |
| `heys_advice_v1.js`            | ะกะฟะตัะธะฐะปัะฝัะต ัะพะฒะตัั ะดะปั refeed day                                                      |
| `heys_ratio_zones_v1.js`       | ะะพะฒัะน ะผะตัะพะด `getDayZone(ratio, dayData)` โ ะฝะต ะปะพะผะฐะตะผ ััะฐััะน `getZone`                  |
| `docs/DATA_MODEL_REFERENCE.md` | ะะพะบัะผะตะฝัะฐัะธั ะฝะพะฒะพะณะพ ะฟะพะปั                                                               |

---

## ะะฐะดะฐัะธ

### 1. ะะพะดะตะปั ะดะฐะฝะฝัั โ DayRecord

ะะพะฑะฐะฒะธัั ะฟะพะปะต ะฒ ััััะบัััั ะดะฝั:

```javascript
// ะ DayRecord (heys_day_v12.js, DATA_MODEL_REFERENCE.md)
{
  isRefeedDay: boolean,        // ะะฐะณััะทะพัะฝัะน ะดะตะฝั (ะพัะผะตัะตะฝ ะฒ ัะตะบ-ะธะฝะต ะธะปะธ ะบะฝะพะฟะบะพะน)
  refeedReason: string | null, // ะะฟัะธะพะฝะฐะปัะฝะพ: ะฟัะธัะธะฝะฐ ("ััะตะฝะธัะพะฒะบะฐ", "ะฟัะฐะทะดะฝะธะบ", "refeed ะฟะพัะปะต ะดะตัะธัะธัะฐ")
  refeedNote: string | null    // ะะฟัะธะพะฝะฐะปัะฝะพ: ะทะฐะผะตัะบะฐ ะบะปะธะตะฝัะฐ
}
```

---

### 2. ะจะฐะณ ะฒ ัััะตะฝะฝะตะผ ัะตะบ-ะธะฝะต

**ะคะฐะนะป**: `heys_steps_v1.js`

ะกะพะทะดะฐัั ะฝะพะฒัะน ัะฐะณ `refeed`:

```javascript
// RefeedStepComponent
// - ะะตัะตะบะปััะฐัะตะปั (toggle): "ะกะตะณะพะดะฝั ะทะฐะณััะทะพัะฝัะน ะดะตะฝั"
// - ะัะธ ะฒะบะปััะตะฝะธะธ โ ะฟะพะบะฐะทะฐัั dropdown ั ะฟัะธัะธะฝะพะน:
//   - "ะะพัะปะต ะฝะตัะบะพะปัะบะธั ะดะฝะตะน ะดะตัะธัะธัะฐ"
//   - "ะะตะฝั ัะพะถะดะตะฝะธั / ะฟัะฐะทะดะฝะธะบ"
//   - "ะขัะถัะปะฐั ััะตะฝะธัะพะฒะบะฐ"
//   - "ะัะพััะพ ะฝัะถะตะฝ ะพัะดัั ะพั ะดะธะตัั"
// - ะะะ ะฟะพะปั ะทะฐะผะตัะบะธ (ะดะปั ะฟัะพััะพัั)
```

**UI ัะฐะณะฐ**:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐  ะกะตะณะพะดะฝั ะทะฐะณััะทะพัะฝัะน ะดะตะฝั?         โ
โ                                         โ
โ  โ ะะตั, ะพะฑััะฝัะน ะดะตะฝั                   โ
โ  โ ะะฐ, ะฟะปะฐะฝะธััั ะตััั ะฑะพะปััะต            โ
โ                                         โ
โ  ะัะธัะธะฝะฐ: [ะะพัะปะต ะดะฝะตะน ะดะตัะธัะธัะฐ   โผ]    โ
โ                                         โ
โ  ๐ก ะฃััั ะฒะฐะถะตะฝ ะดะฐะถะต ะฒ ะทะฐะณััะทะพัะฝัะน ะดะตะฝั! โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะัะธัะธะฝั (ัะธะบัะธัะพะฒะฐะฝะฝัะน ัะฟะธัะพะบ)**:

```javascript
const REFEED_REASONS = [
  { id: 'deficit', label: 'ะะพัะปะต ะดะฝะตะน ะดะตัะธัะธัะฐ', icon: '๐' },
  { id: 'holiday', label: 'ะัะฐะทะดะฝะธะบ / ัะพะฑััะธะต', icon: '๐' },
  { id: 'training', label: 'ะะฝัะตะฝัะธะฒะฝะฐั ััะตะฝะธัะพะฒะบะฐ', icon: '๐๏ธ' },
  { id: 'rest', label: 'ะัะดัั ะพั ะดะธะตัั', icon: '๐' },
];
```

**ะะตะณะธัััะฐัะธั ัะฐะณะฐ**:

```javascript
registerStep('refeed', {
  title: 'ะะฐะณััะทะพัะฝัะน ะดะตะฝั',
  hint: 'ะะปะฐะฝะธััะตัะต ะตััั ะฑะพะปััะต?',
  icon: '๐',
  component: RefeedStepComponent,
  getInitialData: () => {
    // ะงะธัะฐะตะผ ัะตะบััะตะต ะทะฝะฐัะตะฝะธะต ะธะท dayData (ะตัะปะธ ัะถะต ะฑัะปะพ ัััะฐะฝะพะฒะปะตะฝะพ ะบะฝะพะฟะบะพะน)
    const todayKey = getTodayKey();
    const dayData = lsGet(`heys_dayv2_${todayKey}`, {});
    return {
      isRefeed: dayData.isRefeedDay || false,
      reason: dayData.refeedReason || null,
    };
  },
  onSave: (data) => {
    const todayKey = getTodayKey();
    const dayData = lsGet(`heys_dayv2_${todayKey}`, {});
    dayData.isRefeedDay = data.isRefeed;
    dayData.refeedReason = data.reason;
    lsSet(`heys_dayv2_${todayKey}`, dayData);
  },
  canSkip: true, // ะะพะถะฝะพ ะฟัะพะฟัััะธัั โ ะพะฑััะฝัะน ะดะตะฝั
});
```

---

### 3. ะะพะฑะฐะฒะธัั ัะฐะณ ะฒ ัะตะบ-ะธะฝ

**ะคะฐะนะป**: `heys_morning_checkin_v1.js`

ะ ััะฝะบัะธะธ `getCheckinSteps(profile)`:

```javascript
function getCheckinSteps(profile) {
  const steps = [];
  // ... ัััะตััะฒัััะฐั ะปะพะณะธะบะฐ ...

  // ะะฐะทะพะฒัะต ัะฐะณะธ
  if (!hasProfileSteps) {
    steps.push('weight');
  }
  steps.push('sleepTime', 'sleepQuality');

  // ๐ ะะฐะณััะทะพัะฝัะน ะดะตะฝั โ ะกะะะะฃ ะะะกะะ sleepQuality
  steps.push('refeed');

  // ะฃัะปะพะฒะฝัะต ัะฐะณะธ (cycle, measurements)
  if (
    HEYS.Steps &&
    HEYS.Steps.shouldShowCycleStep &&
    HEYS.Steps.shouldShowCycleStep()
  ) {
    steps.push('cycle');
  }
  if (
    HEYS.Steps &&
    HEYS.Steps.shouldShowMeasurements &&
    HEYS.Steps.shouldShowMeasurements()
  ) {
    steps.push('measurements');
  }

  // ... ะพััะฐะปัะฝัะต ัะฐะณะธ
}
```

**ะัะพะณะพะฒัะน ะฟะพััะดะพะบ**:
`weight โ sleepTime โ sleepQuality โ **refeed** โ [cycle] โ [measurements] โ cold_exposure โ morning_mood โ stepsGoal โ morningRoutine`

---

### 4. ะะฝะพะฟะบะฐ ๐ ะฒ ะบะฐััะพัะบะต ะบะฐะปะพัะธะน (toggle refeed ะฒ ัะตัะตะฝะธะต ะดะฝั)

**ะคะฐะนะป**: `heys_day_v12.js` โ ะฑะปะพะบ ั optimum/remaining

ะะพะฑะฐะฒะธัั ะบะฝะพะฟะบั ะดะปั ะฒะบะปััะตะฝะธั/ะฒัะบะปััะตะฝะธั refeed ะฒ ะปัะฑะพะน ะผะพะผะตะฝั:

```javascript
// ะ UI ะบะฐััะพัะบะธ ะบะฐะปะพัะธะน, ััะดะพะผ ั ะทะฐะณะพะปะพะฒะบะพะผ ะธะปะธ ะฒ ะผะตะฝั
<button
  onClick={() => toggleRefeedDay()}
  className={`refeed-toggle ${day.isRefeedDay ? 'active' : ''}`}
>
  ๐ {day.isRefeedDay ? 'Refeed โ' : 'Refeed'}
</button>;

// ะคัะฝะบัะธั toggle
function toggleRefeedDay() {
  const newValue = !day.isRefeedDay;
  // ะัะปะธ ะฒะบะปััะฐะตะผ โ ะฟะพะบะฐะทะฐัั popup ั ะฒัะฑะพัะพะผ ะฟัะธัะธะฝั
  if (newValue) {
    showRefeedReasonPopup((reason) => {
      updateDay({ isRefeedDay: true, refeedReason: reason });
    });
  } else {
    updateDay({ isRefeedDay: false, refeedReason: null });
  }
}
```

---

### 5. UI ะฝะฐ ะณัะฐัะธะบะต ะบะฐะปะพัะธะน (sparkline)

**ะคะฐะนะป**: `heys_day_v12.js` โ `KcalSparkline`

ะัะปะธ ะดะตะฝั ะพัะผะตัะตะฝ ะบะฐะบ refeed:

- **ะขะพัะบะฐ ะฝะฐ ะณัะฐัะธะบะต**: ะัะฐะฝะถะตะฒะฐั ะพะฑะฒะพะดะบะฐ ะธะปะธ ะทะฐะปะธะฒะบะฐ
- **ะะฐะปะตะฝัะบะฐั ะธะบะพะฝะบะฐ ๐** ััะดะพะผ ั ัะพัะบะพะน (ะตัะปะธ ratio > 1.0)
- **Tooltip**: "ะะฐะณััะทะพัะฝัะน ะดะตะฝั: [ะฟัะธัะธะฝะฐ]"

```javascript
// ะ ัะตะฝะดะตัะต ัะพัะบะธ ะณัะฐัะธะบะฐ
const isRefeed = dayData.isRefeedDay;
const pointColor = isRefeed ? '#f59e0b' : getRatioColor(ratio); // ะัะฐะฝะถะตะฒัะน ะดะปั refeed
const showRefeedBadge = isRefeed; // ะัะตะณะดะฐ ะฟะพะบะฐะทัะฒะฐะตะผ ะดะปั refeed-ะดะฝะตะน
```

---

### 6. UI ะฒ ะบะฐััะพัะบะต ัะตะปะธ ะฟะพ ะบะฐะปะพัะธัะผ

**ะคะฐะนะป**: `heys_day_v12.js` โ ะฑะปะพะบ ั optimum/remaining

ะัะปะธ `day.isRefeedDay`:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ ะะะะะฃะะะงะะซะ ะะะะฌ  [ะัะบะป.]              โ
โ  ะัะธัะธะฝะฐ: ะะพัะปะต ะดะฝะตะน ะดะตัะธัะธัะฐ               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ะะพัะผะฐ: 2000 ะบะบะฐะป                [โโโโโโโโ] โ
โ  ะกัะตะดะตะฝะพ: 2400 ะบะบะฐะป (+20%)                  โ
โ  โ ะ ะฟัะตะดะตะปะฐั refeed ะฝะพัะผั                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ๐ก ะฃััั ะฒะฐะถะตะฝ ะดะฐะถะต ะฒ ะทะฐะณััะทะพัะฝัะน ะดะตะฝั!     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะพะฒะตะดะตะฝะธะต**:

- ะะตะนะดะถ ๐ ะฒ ะทะฐะณะพะปะพะฒะบะต + ะบะฝะพะฟะบะฐ [ะัะบะป.] ะดะปั ะพัะผะตะฝั refeed
- ะะพะบะฐะทะฐัั ะฟัะธัะธะฝั (ะตัะปะธ ัะบะฐะทะฐะฝะฐ)
- ะฆะฒะตั ะฟัะพะณัะตััะฐ โ **ะทะตะปัะฝัะน ะดะพ 1.35**, ะพัะฐะฝะถะตะฒัะน ะตัะปะธ ะฒััะต
- ะะพะดัะบะฐะทะบะฐ "ัััั ะฒะฐะถะตะฝ" โ ะฝะฐะฟะพะผะธะฝะฐะฝะธะต ััะตะบะฐัั

---

### 7. ะะพะฒัะน ะผะตัะพะด ะฒ ratioZones

**ะคะฐะนะป**: `heys_ratio_zones_v1.js`

ะะพะฑะฐะฒะธัั **ะฝะพะฒัะน ะผะตัะพะด** (ะฝะต ะปะพะผะฐะตะผ ัััะตััะฒัััะธะน `getZone`):

```javascript
// ะะพะฑะฐะฒะธัั ะฒ ratioZones ะพะฑัะตะบั:
getDayZone(ratio, dayData) {
  if (dayData?.isRefeedDay) {
    if (ratio < 0.70) return { id: 'refeed_under', name: 'ะะฐะปะพะฒะฐัะพ ะดะปั refeed', color: '#f59e0b', textColor: '#000' };
    if (ratio < 1.35) return { id: 'refeed_ok', name: 'ะะฐะณััะทะพัะฝัะน ะดะตะฝั โ', color: '#22c55e', textColor: '#fff' };
    return { id: 'refeed_over', name: 'ะะฐะถะต ะดะปั refeed ะผะฝะพะณะพ!', color: '#ef4444', textColor: '#fff' };
  }
  return this.getZone(ratio);
},

// ะะปั streak ัะฐััััะฐ
isRefeedStreakDay(ratio) {
  return ratio >= 0.70 && ratio < 1.35;
}
```

**ะะพะฒัะต ะทะพะฝั ะดะปั refeed**:

| ID             | ะะธะฐะฟะฐะทะพะฝ    | ะฆะฒะตั       | ะะฐะทะฒะฐะฝะธะต                 |
| -------------- | ----------- | ---------- | ------------------------ |
| `refeed_under` | < 0.70      | ๐ก ะัะปััะน  | "ะะฐะปะพะฒะฐัะพ ะดะปั refeed"    |
| `refeed_ok`    | 0.70 - 1.35 | ๐ข ะะตะปัะฝัะน | "ะะฐะณััะทะพัะฝัะน ะดะตะฝั โ"     |
| `refeed_over`  | > 1.35      | ๐ด ะัะฐัะฝัะน | "ะะฐะถะต ะดะปั refeed ะผะฝะพะณะพ!" |

---

### 8. ะกะพะฒะตัั ะดะปั refeed ะดะฝั

**ะคะฐะนะป**: `heys_advice_v1.js`

ะะพะฑะฐะฒะธัั ัะพะฒะตัั:

| ID                          | ะฃัะปะพะฒะธะต                                      | ะขะตะบัั                                               |
| --------------------------- | -------------------------------------------- | --------------------------------------------------- |
| `refeed_planned`            | `isRefeedDay && ratio < 0.5`                 | "ะะฐะณััะทะพัะฝัะน ะดะตะฝั โ ะผะพะถะฝะพ ะตััั ัะผะตะปะตะต! ๐"          |
| `refeed_on_track`           | `isRefeedDay && ratio 0.9-1.2`               | "ะะฐะณััะทะพัะฝัะน ะดะตะฝั ะธะดัั ะฟะพ ะฟะปะฐะฝั โ"                  |
| `refeed_protein_focus`      | `isRefeedDay && proteinPct < 0.8`            | "ะ refeed day ะฑะตะปะพะบ ะพัะพะฑะตะฝะฝะพ ะฒะฐะถะตะฝ โ ะธะดัั ะฒ ะผัััั!" |
| `refeed_dont_skip_tracking` | `isRefeedDay && mealCount < 2 && hour >= 14` | "ะะต ะทะฐะฑัะฒะฐะน ััะตะบะฐัั ะดะฐะถะต ะฒ ะทะฐะณััะทะพัะฝัะน ะดะตะฝั!"       |
| `refeed_morning_carbs`      | `isRefeedDay && hour < 12 && carbsPct < 0.3` | "ะฃััะพะผ refeed โ ะปัััะตะต ะฒัะตะผั ะดะปั ัะณะปะตะฒะพะดะพะฒ ๐ฅ"      |

**ะะปะพะบะธัะพะฒะบะฐ ะพะฑััะฝัั ัะพะฒะตัะพะฒ ะพ ะฟะตัะตะฑะพัะต** ะฟัะธ `isRefeedDay`:

- `kcal_excess_critical` โ ะะ ะฟะพะบะฐะทัะฒะฐัั ะตัะปะธ refeed ะธ ratio < 1.35
- `kcal_excess_mild` โ ะะ ะฟะพะบะฐะทัะฒะฐัั ะตัะปะธ refeed
- `crash_support` (ะฟัะพ ะฟะตัะตะตะดะฐะฝะธะต) โ ะะ ะฟะพะบะฐะทัะฒะฐัั ะตัะปะธ refeed

---

### 9. Streak ะปะพะณะธะบะฐ

**ะคะฐะนะป**: `heys_day_v12.js` โ ัะฐัััั streak

```javascript
// ะะฑะฝะพะฒะธัั ััะฝะบัะธั isStreakDay
function isStreakDay(ratio, dayData) {
  if (dayData?.isRefeedDay) {
    // Refeed ัะพััะฐะฝัะตั streak ะตัะปะธ ะฒ ะฟัะตะดะตะปะฐั 0.70-1.35
    return HEYS.ratioZones.isRefeedStreakDay(ratio);
  }
  return HEYS.ratioZones.isSuccess(ratio); // ะะฑััะฝะฐั ะปะพะณะธะบะฐ (0.75-1.15)
}
```

---

### 10. ะะฝัะตะณัะฐัะธั ั Caloric Debt

**ะกะฒัะทั**: ะัะปะธ ัะธััะตะผะฐ ะพะฟัะตะดะตะปะธะปะฐ `needsRefeed: true`, ะฟัะตะดะปะพะถะธัั ะพัะผะตัะธัั
refeed:

```javascript
// ะ RefeedStepComponent ะธะปะธ ะฒ ะบะฐััะพัะบะต ะบะฐะปะพัะธะน
const caloricDebt = getCaloricDebt(); // ะะท ะบะพะฝัะตะบััะฐ
const suggestRefeed = caloricDebt?.needsRefeed && !day.isRefeedDay;

// UI ะฟะพะดัะบะฐะทะบะฐ
{
  suggestRefeed && (
    <div className="refeed-suggestion">
      ๐ก ะกะธััะตะผะฐ ัะตะบะพะผะตะฝะดัะตั refeed โ ะฝะฐะบะพะฟะธะปัั ะดะตัะธัะธั {caloricDebt.debt} ะบะบะฐะป
      <button onClick={() => toggleRefeedDay()}>ะัะผะตัะธัั refeed</button>
    </div>
  );
}
```

---

### 11. ะัะพะฑัะฐะถะตะฝะธะต ะดะปั ะบััะฐัะพัะฐ

**ะะดะต**: ะะฑะทะพั ะดะฝั ะบะปะธะตะฝัะฐ (ะตัะปะธ ะตััั ะบะฐะฑะธะฝะตั ะบััะฐัะพัะฐ)

ะััะฐัะพั ะดะพะปะถะตะฝ ะฒะธะดะตัั:

- ะะตะนะดะถ ๐ ััะดะพะผ ั ะดะฐัะพะน
- ะัะธัะธะฝั refeed
- ะงัะพ ััะพ **ะพัะพะทะฝะฐะฝะฝัะน** ะฒัะฑะพั, ะฝะต ัััะฒ

**ะคะพัะผะฐั ะฒ ัะบัะฟะพััะต/API**:

```json
{
  "date": "2025-12-12",
  "isRefeedDay": true,
  "refeedReason": "deficit",
  "ratio": 1.28,
  "status": "refeed_ok"
}
```

---

### 12. ะัะบะปััะตะฝะธะต ะธะท ััะตะฝะดะฐ ะฒะตัะฐ

**ะคะฐะนะป**: `heys_day_v12.js` โ WeightSparkline / ัะฐัััั ััะตะฝะดะฐ

ะะพ ะฐะฝะฐะปะพะณะธะธ ั ะถะตะฝัะบะธะผ ัะธะบะปะพะผ, ะธัะบะปััะฐัั refeed-ะดะฝะธ ะธะท ัะฐััััะฐ "ัะธััะพะณะพ" ััะตะฝะดะฐ
ะฒะตัะฐ:

```javascript
// ะ ััะฝะบัะธะธ ัะฐััััะฐ ััะตะฝะดะฐ ะฒะตัะฐ
function shouldExcludeFromWeightTrend(dayData) {
  // ะะตะฝัะบะธะน ัะธะบะป โ ัะถะต ะตััั
  if (HEYS.Cycle?.shouldExcludeFromWeightTrend(dayData.cycleDay)) return true;

  // Refeed ะดะตะฝั โ ะะะะะ
  if (dayData.isRefeedDay) return true;

  return false;
}
```

**ะะธะทัะฐะปะธะทะฐัะธั ะฝะฐ sparkline ะฒะตัะฐ**:

- ะัะฐะฝะถะตะฒะฐั ะพะฑะฒะพะดะบะฐ ะดะปั refeed-ะดะฝะตะน (ะฟะพ ะฐะฝะฐะปะพะณะธะธ ั ัะพะทะพะฒัะผะธ ะดะปั ัะธะบะปะฐ)
- ะะตะนะดะถ "๐ ัะธัััะน" โ ััะตะฝะด ัะฐัััะธัะฐะฝ ะฑะตะท refeed-ะดะฝะตะน
- ะกะฝะพัะบะฐ ะฟะพะด ะณัะฐัะธะบะพะผ: "ะะฝะธ refeed ะธัะบะปััะตะฝั ะธะท ััะตะฝะดะฐ (ะทะฐะดะตัะถะบะฐ ะฒะพะดั)"

---

## ะัะธัะตัะธะธ ะณะพัะพะฒะฝะพััะธ

- [ ] ะจะฐะณ `refeed` ะฒ `heys_steps_v1.js`
- [ ] ะจะฐะณ ะดะพะฑะฐะฒะปะตะฝ ะฒ `getCheckinSteps()` ะฟะพัะปะต `sleepQuality`
- [ ] ะะพะปะต `isRefeedDay` ัะพััะฐะฝัะตััั ะฒ DayRecord
- [ ] ะะฝะพะฟะบะฐ ๐ ะฒ ะบะฐััะพัะบะต ะบะฐะปะพัะธะน ะดะปั toggle ะฒ ัะตัะตะฝะธะต ะดะฝั
- [ ] ะะตะนะดะถ ๐ ะฝะฐ sparkline ะดะปั refeed-ะดะฝะตะน
- [ ] ะะฐััะพัะบะฐ ะบะฐะปะพัะธะน ะฟะพะบะฐะทัะฒะฐะตั ััะฐััั refeed
- [ ] ะะตัะพะด `getDayZone(ratio, dayData)` ะฒ ratioZones
- [ ] ะะธะฝะธะผัะผ 5 ัะพะฒะตัะพะฒ ะดะปั refeed ะดะฝั
- [ ] ะะฑััะฝัะต ัะพะฒะตัั ะพ ะฟะตัะตะฑะพัะต ะฑะปะพะบะธัััััั ะดะปั refeed
- [ ] Streak ะปะพะณะธะบะฐ: ัะพััะฐะฝัะตะผ ะฟัะธ ratio 0.70-1.35
- [ ] Refeed-ะดะฝะธ ะธัะบะปััะฐัััั ะธะท ััะตะฝะดะฐ ะฒะตัะฐ
- [ ] ะะพะบัะผะตะฝัะฐัะธั ะฒ DATA_MODEL_REFERENCE.md

---

## ะขะตััะธัะพะฒะฐะฝะธะต

1. **ะฃััะตะฝะฝะธะน ัะตะบ-ะธะฝ**:
   - [ ] ะจะฐะณ ะฟะพะบะฐะทัะฒะฐะตััั ะฟะพัะปะต sleepQuality
   - [ ] Radio-ะบะฝะพะฟะบะธ ัะฐะฑะพัะฐัั
   - [ ] ะัะธัะธะฝะฐ ะฟะพะบะฐะทัะฒะฐะตััั ัะพะปัะบะพ ะฟัะธ "ะะฐ"
   - [ ] ะะพะถะฝะพ ะฟัะพะฟัััะธัั

2. **ะะฝะพะฟะบะฐ ะฒ ะบะฐััะพัะบะต ะบะฐะปะพัะธะน**:
   - [ ] Toggle ะฒะบะปััะฐะตั/ะฒัะบะปััะฐะตั refeed
   - [ ] ะัะธ ะฒะบะปััะตะฝะธะธ ะฟะพัะฒะปัะตััั popup ั ะฟัะธัะธะฝะพะน
   - [ ] ะัะธ ะฒัะบะปััะตะฝะธะธ ะฟัะธัะธะฝะฐ ัะฑัะฐััะฒะฐะตััั

3. **UI ะดะฝั**:
   - [ ] ะะตะนะดะถ ะฝะฐ ะณัะฐัะธะบะต (sparkline)
   - [ ] ะะฐััะพัะบะฐ ะบะฐะปะพัะธะน ั refeed-ััะฐัััะพะผ
   - [ ] ะฆะฒะตัะฐ: ะทะตะปัะฝัะน ะดะพ 1.35, ะบัะฐัะฝัะน ะฟะพัะปะต

4. **ะกะพะฒะตัั**:
   - [ ] ะกะพะฒะตัั ะดะปั refeed ะฟะพะบะฐะทัะฒะฐัััั
   - [ ] ะะฑััะฝัะต ัะพะฒะตัั ะพ ะฟะตัะตะฑะพัะต ะะ ะฟะพะบะฐะทัะฒะฐัััั

5. **Streak**:
   - [ ] Refeed 0.70-1.35 ัะพััะฐะฝัะตั streak
   - [ ] Refeed > 1.35 ะปะพะผะฐะตั streak
   - [ ] Refeed < 0.70 ะปะพะผะฐะตั streak

6. **ะขัะตะฝะด ะฒะตัะฐ**:
   - [ ] Refeed-ะดะฝะธ ะธัะบะปััะตะฝั ะธะท ัะฐััััะฐ ััะตะฝะดะฐ
   - [ ] ะัะฐะฝะถะตะฒะฐั ะพะฑะฒะพะดะบะฐ ะฝะฐ ัะพัะบะฐั refeed-ะดะฝะตะน
   - [ ] ะกะฝะพัะบะฐ "๐ ัะธัััะน" ะตัะปะธ ะตััั ะธัะบะปัััะฝะฝัะต ะดะฝะธ

---

## ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะกัะตะฝะฐัะธะน 1: ะะพัะปะต ะฝะตะดะตะปะธ ะดะตัะธัะธัะฐ

ะะปะธะตะฝั 5 ะดะฝะตะน ะตะป ั ะดะตัะธัะธัะพะผ -20%. ะฃััะพะผ ะพัะผะตัะฐะตั refeed โ ัะธััะตะผะฐ ะฝะต ััะณะฐะตั ะทะฐ
+30% ะบะฐะปะพัะธะน, streak ัะพััะฐะฝัะตััั.

### ะกัะตะฝะฐัะธะน 2: ะะตะฝั ัะพะถะดะตะฝะธั

ะะปะธะตะฝั ะทะฝะฐะตั ััะพ ะฑัะดะตั ัะพัั. ะัะผะตัะฐะตั refeed ะบะฝะพะฟะบะพะน ะฒ ะบะฐััะพัะบะต ะบะฐะปะพัะธะน ั
ะฟัะธัะธะฝะพะน "ะัะฐะทะดะฝะธะบ" โ ะบััะฐัะพั ะฒะธะดะธั ะพัะพะทะฝะฐะฝะฝัะน ะฒัะฑะพั.

### ะกัะตะฝะฐัะธะน 3: ะะพัะปะต ััะถัะปะพะน ััะตะฝะธัะพะฒะบะธ

ะัะตัะฐ ะฑัะปะฐ ัะธะปะพะฒะฐั, ัะตะณะพะดะฝั ะผัััะฐะผ ะฝัะถะฝะฐ ะตะดะฐ โ ะพัะผะตัะฐะตั refeed ั ะฟัะธัะธะฝะพะน
"ะขัะตะฝะธัะพะฒะบะฐ".

### ะกัะตะฝะฐัะธะน 4: ะะฐะฑัะป ะพัะผะตัะธัั ัััะพะผ

ะะปะธะตะฝั ะฒ ะพะฑะตะด ะฟะพะฝัะป ััะพ ัะตะณะพะดะฝั ะฑัะดะตั ะฟัะฐะทะดะฝะธัะฝัะน ัะถะธะฝ โ ะฝะฐะถะธะผะฐะตั ะบะฝะพะฟะบั ๐ ะฒ
ะบะฐััะพัะบะต ะบะฐะปะพัะธะน, ะฒัะฑะธัะฐะตั ะฟัะธัะธะฝั "ะัะฐะทะดะฝะธะบ".

---

## ะกะฒัะทะฐะฝะฝัะต ะทะฐะดะฐัะธ

- [๐ฐ Caloric Debt System](../DATA_MODEL_REFERENCE.md#-caloric-debt-ะบะฐะปะพัะธะนะฝัะน-ะดะพะปะณ)
  โ ะธะฝัะตะณัะฐัะธั ั `needsRefeed`
- ะะฐะฑะธะฝะตั ะบััะฐัะพัะฐ โ ะพัะพะฑัะฐะถะตะฝะธะต refeed-ััะฐัััะฐ ะบะปะธะตะฝัะฐ
