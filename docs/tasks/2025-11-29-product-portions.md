# ๐ฝ๏ธ ะะพััะธะธ ะฟัะพะดัะบัะพะฒ ("1 ัะนัะพ = 60ะณ") โ v3.2 FINAL

**ะะฐัะฐ**: 2025-11-29  
**ะัะธะพัะธัะตั**: ๐ด ะััะพะบะธะน (ััะบะพััะตั 70%+ food logging)  
**ะัะตะผั**: ~95 ะผะธะฝัั  
**ะกัะฐััั**: โ ะะฃะะะข ะะะะะะจะะ โ ะณะพัะพะฒ ะบ ัะตะฐะปะธะทะฐัะธะธ  
**ะะตััะธั**: 3.2 (ะณะปัะฑะพะบะธะน ะฐัะดะธั v2 + WOW-ัะธัะธ)

---

## ๐ ะะฟะธัะฐะฝะธะต ะทะฐะดะฐัะธ

ะะพะฑะฐะฒะธัั ะฟะพะดะดะตัะถะบั **ะฟะพััะธะน** ะดะปั ะฟัะพะดัะบัะพะฒ โ ะฐะปััะตัะฝะฐัะธะฒะฝัะน ัะฟะพัะพะฑ ะฒะฒะพะดะฐ ะบะพะปะธัะตััะฒะฐ ะฒะผะตััะพ ะณัะฐะผะผะพะฒ.

**ะัะธะผะตัั:**
- ๐ฅ ะฏะนัะพ โ "1 ัั" = 60ะณ
- ๐ฅ ะัะด โ "1 ั.ะป." = 8ะณ, "1 ัั.ะป." = 21ะณ
- ๐ ะฅะปะตะฑ โ "1 ะปะพะผัะธะบ" = 30ะณ
- ๐ฅ ะะพะปะพะบะพ โ "1 ััะฐะบะฐะฝ" = 250ะผะป
- ๐ ะะฐะฝะฐะฝ โ "1 ัั (ััะตะดะฝะธะน)" = 120ะณ

---

## ๐ฏ ะฆะตะปั

ะฃัะบะพัะธัั ะฒะฒะพะด ะดะปั ะฟัะพะดัะบัะพะฒ ะณะดะต **ะฟะพััะธะธ ะตััะตััะฒะตะฝะฝะตะต ะณัะฐะผะผะพะฒ**:
- ะฏะนัะฐ (ะฝะธะบัะพ ะฝะต ะฒะทะฒะตัะธะฒะฐะตั ัะนัะพ)
- ะะพะถะบะธ (ะผัะด, ะผะฐัะปะพ, ัะฐัะฐั)
- ะจััะบะธ (ัััะบัั, ะบะพะฝัะตัั)
- ะกัะฐะบะฐะฝั (ะฝะฐะฟะธัะบะธ)

---

## โ ะคะฐะทะฐ 0: ะะะะะะจะะะ (ะผัััะฒัะน ะบะพะด ัะดะฐะปัะฝ)

> **ะัะฟะพะปะฝะตะฝะพ 2025-11-29**

### 0.1 โ ะฃะดะฐะปัะฝ ะผัััะฒัะน ะบะพะด `showGramsPicker`

**ะฃะดะฐะปะตะฝะพ (~120 ัััะพะบ):**
- States: `showGramsPicker`, `gramsPickerTarget`, `pendingGrams`, `gramsInputValue`, `gramsValues`
- Functions: `openGramsPicker()`, `handleGramsInput()`, `handleGramsWheelChange()`, `confirmGramsPicker()`, `cancelGramsPicker()`
- JSX ะผะพะดะฐะปะบะฐ ั wheel-based picker
- ะกััะปะบะธ ะฒ `uiState` ะธ `useEffect`

---

## ๐จ ะคะฐะทะฐ 0.5: ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะฟะพะดะณะพัะพะฒะบะฐ (ะะะะะะะซ)

> **ะัะธัะธัะฝะพ:** ะัะฟะพะปะฝะธัั ะะ ะพัะฝะพะฒะฝะพะน ัะตะฐะปะธะทะฐัะธะธ!

### 0.5.1 โ๏ธ ะะตัะพะณะปะฐัะพะฒะฐะฝะฝะพััั haptic feedback

**ะัะพะฑะปะตะผะฐ**: ะ ะบะพะดะต ัะผะตัะฐะฝั ะดะฒะฐ ะฟะพะดัะพะดะฐ:
```javascript
// ะะพะดัะพะด 1: ะกััะพะน navigator.vibrate (ัััะพะบะธ 656, 733, 1009, 1667, 5334)
try { navigator.vibrate?.(3); } catch(e) {}

// ะะพะดัะพะด 2: ะฃะฝะธัะธัะธัะพะฒะฐะฝะฝัะน haptic (ัััะพะบะธ 1176, 1190, 1202, 2137...)
haptic('light');
```

**ะะตะนััะฒะธะต**: ะ ะฝะพะฒะพะผ ะบะพะดะต ะธัะฟะพะปัะทะพะฒะฐัั ะขะะะฌะะ `haptic()`:
- `haptic('light')` โ ะดะปั ะบะฝะพะฟะพะบ ะฟะพััะธะน
- `haptic('medium')` โ ะดะปั ะฟะพะดัะฒะตัะถะดะตะฝะธั

### 0.5.2 โ๏ธ editGramsTarget ะฝะต ะธะผะตะตั smart presets

**ะัะพะฑะปะตะผะฐ**: `gramsModalProduct` ะธัะฟะพะปัะทัะตั `smartGramsPresets` (useMemo ั ะธััะพัะธะตะน), ะฐ `editGramsTarget` โ hardcoded `[50,100,150,200,250]`.

**ะะธัะบ**: ะะพะปัะทะพะฒะฐัะตะปั ะฟัะธะฒัะบะฝะตั ะบ smart presets โ ะฟะพัะพะผ ะฟัะธ ัะตะดะฐะบัะธัะพะฒะฐะฝะธะธ ัะฒะธะดะธั ะดััะณะธะต ะฟัะตัะตัั โ confusion.

**ะะตะนััะฒะธะต (ะพะฟัะธะพะฝะฐะปัะฝะพ)**: ะัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ะฟะพััะธะน ัะฝะธัะธัะธัะพะฒะฐัั ะฟัะตัะตัั ะฒ ะพะฑะตะธั ะผะพะดะฐะปะบะฐั.

### 0.5.3 โ๏ธ editGramsTarget ะฝะต ะธะผะตะตั animated kcal

**ะัะพะฑะปะตะผะฐ**: `gramsModalProduct` ะธะผะตะตั `animatedKcal` (ะฟะปะฐะฒะฝะฐั ะฐะฝะธะผะฐัะธั ะบะฐะปะพัะธะน), ะฐ `editGramsTarget` โ ััะฐัะธัะฝัะน `Math.round()`.

**ะะธัะบ**: ะะธะทัะฐะปัะฝะฐั ัะฐะทะฝะธัะฐ ะผะตะถะดั ะผะพะดะฐะปะบะฐะผะธ.

**ะะตะนััะฒะธะต (ะพะฟัะธะพะฝะฐะปัะฝะพ)**: ะะพะฑะฐะฒะธัั ะฐะฝะธะผะฐัะธั ะฒ `editGramsTarget` ะดะปั consistency.

### 0.5.4 โ๏ธ CSS ะธัะฟะพะปัะทัะตั [data-theme="dark"], ะะ CSS variables

**ะคะฐะบั**: ะกัะธะปะธ ะณัะฐะผะผะพะฒ ะธัะฟะพะปัะทััั `[data-theme="dark"]`:
```css
/* ะกััะพะบะฐ 7764 */
[data-theme="dark"] .grams-modal { ... }
[data-theme="dark"] .grams-preset { ... }
```

**ะญัะพ OK** โ ัะพะพัะฒะตัััะฒัะตั ะฟะฐััะตัะฝั ะฟัะพะตะบัะฐ. ะะพะฒัะต ััะธะปะธ `.grams-portion-btn` ะดะพะปะถะฝั ัะปะตะดะพะฒะฐัั ัะพะผั ะถะต ะฟะฐััะตัะฝั.

### 0.5.5 โ๏ธ isMobile โ ะดะฒะต ัะฐะทะฝัั ัะตะฐะปะธะทะฐัะธะธ

**ะคะฐะบั**: ะััั ะดะฒะต ัะตะฐะปะธะทะฐัะธะธ isMobile:
```javascript
// ะกััะพะบะฐ 174 (DayTab) โ ัะตะฐะบัะธะฒะฝัะน hook
const isMobile = useMobileDetection(768);

// ะกััะพะบะฐ 594 (MealAddProduct) โ ััะฐัะธัะฝะฐั ะฟัะพะฒะตัะบะฐ
const isMobile = typeof window !== 'undefined' && window.innerWidth <= 768;
```

**ะะธัะบ**: ะัะธ ัะตัะฐะนะทะต ะพะบะฝะฐ ะฒ MealAddProduct isMobile ะฝะต ะพะฑะฝะพะฒะธััั.

**ะะตัะตะฝะธะต**: ะะปั ะฟะพััะธะน ััะพ ะฝะต ะบัะธัะธัะฝะพ (ะพะฝะธ ะฝัะถะฝั ะฝะฐ ะผะพะฑะธะปะต ะฒ ะปัะฑะพะผ ัะปััะฐะต).

---

## ๐ ะะปัะฑะพะบะธะน ะฐัะดะธั v2 (ะะะะซะ)

### ๐ด ะัะธัะธัะตัะบะธะต ะฟัะพะฑะปะตะผั:

1. **ะะพััะดะพะบ ัะปะตะผะตะฝัะพะฒ ะฒ ะผะพะดะฐะปะบะต ะฝะตะพะฟัะธะผะฐะปะตะฝ**
   
   ะขะตะบััะธะน ะฟะพััะดะพะบ ะฒ `gramsModalProduct`:
   ```
   Header โ Preview (ะบะบะฐะป) โ Input โ Slider โ Presets
   ```
   
   ะก ะฟะพััะธัะผะธ ััะฐะฝะตั:
   ```
   Header โ Preview โ ะะะะฆะะ โ Input โ Slider โ Presets
   ```
   
   **ะัะพะฑะปะตะผะฐ**: ะะพััะธะธ ะฑัะดัั ะบะพะฝะบััะธัะพะฒะฐัั ั presets ะฒะธะทัะฐะปัะฝะพ.
   
   **ะะตัะตะฝะธะต**: ะะพััะธะธ ะธะดัั ะะะะะ input (ััะพ ะตััะตััะฒะตะฝะฝะตะต โ ัะฝะฐัะฐะปะฐ ะฒัะฑะพั ะฟะพััะธะธ, ะฟะพัะพะผ ัะพัะฝะฐั ะฟะพะดัััะพะนะบะฐ).

2. **ะะตั ะฐะฝะธะผะฐัะธะธ ะฟัะธ ะฒัะฑะพัะต ะฟะพััะธะธ**
   
   ะัะธ ะบะปะธะบะต ะฝะฐ ะฟะพััะธั gramsValue ะผะตะฝัะตััั ะผะณะฝะพะฒะตะฝะฝะพ โ ัะปะฐะนะดะตั ะฟััะณะฐะตั.
   
   **ะะตัะตะฝะธะต**: ะะพะฑะฐะฒะธัั smooth transition ะดะปั slider thumb (CSS) ะธะปะธ animate gramsValue.

3. **ะะตั ะฒะธะทัะฐะปัะฝะพะณะพ ะฐะบัะตะฝัะฐ ะฝะฐ ะฟะพััะธัั**
   
   ะัะปะธ ะฟัะพะดัะบั ะะ ะฐะฒัะพ-ะฟะพััะธะน, ะฟะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะฝะต ะทะฐะผะตัะธัั ะบะฝะพะฟะบะธ.
   
   **ะะตัะตะฝะธะต**: ะะพะฑะฐะฒะธัั subtle hint "ะัะฑะตัะธัะต ะฟะพััะธั:" ะธะปะธ ะฟะพะดัะฒะตัะบั ะฟะตัะฒะพะน ะทะฐะณััะทะบะธ.

### ๐ก ะะพัะตะฝัะธะฐะปัะฝัะต UX ะฟัะพะฑะปะตะผั:

1. **Overflow ะฝะฐ ะผะฐะปะตะฝัะบะธั ัะบัะฐะฝะฐั**
   
   ะัะปะธ ะฟะพััะธะน ะผะฝะพะณะพ (3-5 ะบะฝะพะฟะพะบ ะฟะพ ~80px) โ ะฟะตัะตะฟะพะปะฝะตะฝะธะต ะฝะฐ iPhone SE (320px).
   
   **ะะตัะตะฝะธะต**: 
   - ะะฐะบัะธะผัะผ 4 ะฟะพััะธะธ ะฝะฐ ัััะพะบั
   - `flex-wrap: wrap` ั ัะตะฝััะธัะพะฒะฐะฝะธะตะผ
   - ะะปะธ horizontal scroll ั snap

2. **ะะตั feedback ััะพ ะฟะพััะธั ะฐะบัะธะฒะฝะฐ**
   
   ะัะธ ะบะปะธะบะต ะฝะฐ ะฟะพััะธั โ ัะพะปัะบะพ ัะผะตะฝะฐ gramsValue. ะะตั ะฒะธะทัะฐะปัะฝะพะณะพ "ั ะฒัะฑัะฐะป ะฟะพััะธั".
   
   **ะะตัะตะฝะธะต**: 
   - `.active` ะบะปะฐัั ะฝะฐ ะบะฝะพะฟะบะต โ (ัะถะต ะฒ ะฟัะพะผะฟัะต)
   - Micro-animation (scale pulse) ะฟัะธ ะฒัะฑะพัะต
   - Haptic feedback โ (ัะถะต ะฒ ะฟัะพะผะฟัะต)

3. **ะะพััะธะธ ะฝะต ัะธะฝััะพะฝะธะทะธัััััั ั input**
   
   ะัะปะธ ั ะฒัะฑัะฐะป "1 ัั" (60ะณ), ะฟะพัะพะผ ะฒัััะฝัั ะฒะฒัะป "65ะณ" โ ะฟะพััะธั ะฒัั ะตัั ะฟะพะดัะฒะตัะตะฝะฐ ะบะฐะบ active.
   
   **ะะตัะตะฝะธะต**: `.active` ัะพะปัะบะพ ะฟัะธ ัะพัะฝะพะผ ัะพะฒะฟะฐะดะตะฝะธะธ `gramsValue === portion.grams`

4. **AUTO_PORTIONS ะผะพะถะตั ะฝะต ะฟะพะบัััั ะฒัะต ะบะตะนัั**
   
   ะัะธะผะตัั ะะ ะฟะพะบััััั:
   - "ะขะฒะพัะพะณ 5%" โ ะฝะตั ะฟะพััะธะน (ะะ, ะฝะต ะฝัะถะฝั)
   - "ะฏะฑะปะพัะฝัะน ัะพะบ" โ ะตััั "ัะฑะปะพะบ" ะฝะพ ััะพ ะฝะต ัะฑะปะพะบะพ
   - "ะััะธะฝะพะต ัะนัะพ" โ "ัะนั" ะฝะฐะนะดัััั โ
   
   **ะะตัะตะฝะธะต**: ะะพะฑะฐะฒะธัั negative patterns ะธะปะธ ัะปัััะธัั matching.

### ๐ข ะงัะพ ัะพัะพัะพ:

1. โ ะะฒัะพ-ะฟะพััะธะธ ะฟะพ ะฟะฐััะตัะฝะฐะผ โ ัะผะฝะฐั ัะธัะฐ
2. โ Fallback ะฝะฐ ะฟัััะพะน ะผะฐััะธะฒ โ ะฑะตะทะพะฟะฐัะฝะพ
3. โ Haptic feedback ะฟะปะฐะฝะธััะตััั
4. โ CSS variables (ัะฐััะธัะฝะพ) ะดะปั dark mode
5. โ typedef ะพะฑะฝะพะฒะปะตะฝะธะต ะดะปั Product

---

## ๐ WOW-ัะธัะธ (ะกะะะะะะะะะ & ะะะขะะะะกะะ)

### ๐ WOW #1: ะกััััะธะบ ะฟะพััะธะน ั +/โ

ะะผะตััะพ ะพัะดะตะปัะฝัั ะบะฝะพะฟะพะบ "1 ัั", "2 ัั", "3 ัั" โ ะพะดะธะฝ ัะปะตะผะตะฝั ัะพ ััะตะฟะฟะตัะพะผ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ฅ  [โ]  2 ัั  [+]  120ะณ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะัะตะธะผััะตััะฒะฐ**:
- ะะพะผะฟะฐะบัะฝะตะต (1 ัะปะตะผะตะฝั ะฒะผะตััะพ 3)
- ะะพะถะฝะพ ะดะพะฑะฐะฒะธัั ะฑะพะปััะต ะฟะพััะธะน (ะดะพ 10)
- ะกะพะฒัะตะผะตะฝะฝัะน ะฟะฐััะตัะฝ (ะบะฐะบ ะฒ ะบะพัะทะธะฝะต e-commerce)

**ะะตะฐะปะธะทะฐัะธั**:
```javascript
const [portionCount, setPortionCount] = useState(1);
const baseGrams = effectivePortions[0]?.grams || 100;
// ะัะธ +/- โ setGramsValue(baseGrams * portionCount)
```

### ๐ WOW #2: ะะธะทัะฐะปัะฝัะต ะธะบะพะฝะบะธ ะดะปั ะฟะพััะธะน

ะะพะฑะฐะฒะธัั ะธะบะพะฝะบะธ ะดะปั ัะธะฟะพะฒ ะฟะพััะธะน:

| ะขะธะฟ | ะะบะพะฝะบะฐ |
|-----|--------|
| ัั | 1๏ธโฃ |
| ั.ะป. | ๐ฅ |
| ัั.ะป. | ๐ฅ๐ฅ |
| ััะฐะบะฐะฝ | ๐ฅ |
| ะปะพะผัะธะบ | ๐ |
| ะณะพัััั | โ |

**ะะตะฐะปะธะทะฐัะธั**: ะะพะฑะฐะฒะธัั emoji ะฒ `name` ะฟะพััะธะธ ะธะปะธ ะพัะดะตะปัะฝะพะต ะฟะพะปะต `icon`.

### ๐ WOW #3: ะะฐะฟะพะผะธะฝะฐะฝะธะต ะฟะพัะปะตะดะฝะตะน ะฟะพััะธะธ

ะัะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั ัะฐััะพ ะฒัะฑะธัะฐะตั "2 ัั" ัะธั โ ะฟะพะบะฐะทัะฒะฐัั "2 ัั" ะฟะตัะฒัะผ/ะฒัะดะตะปะตะฝะฝัะผ.

**ะะตะฐะปะธะทะฐัะธั**:
```javascript
// ะกะพััะฐะฝััั ะฒ localStorage
U.lsSet('heys_portion_history', { [productId]: lastPortionIndex });

// ะัะธ ะพัะบัััะธะธ ะผะพะดะฐะปะบะธ
const lastPortion = portionHistory[productId];
if (lastPortion !== undefined) setGramsValue(portions[lastPortion].grams);
```

### ๐ WOW #4: ะฃะผะฝัะน initial value

ะกะตะนัะฐั ะผะพะดะฐะปะบะฐ ะพัะบััะฒะฐะตััั ั `gramsValue = 100`. 

**ะฃะปัััะตะฝะธะต**: ะัะปะธ ะตััั ะฟะพััะธะธ โ ะพัะบััะฒะฐัั ั ะฟะตัะฒะพะน ะฟะพััะธะตะน, ะฝะต ั 100ะณ.

```javascript
// ะัะธ ะพัะบัััะธะธ gramsModalProduct
const initialGrams = effectivePortions[0]?.grams || 100;
setGramsValue(initialGrams);
```

### ๐ WOW #5: Animation ะฟัะธ ะฒัะฑะพัะต ะฟะพััะธะธ

ะะพะฑะฐะฒะธัั micro-interaction ะฟัะธ ะบะปะธะบะต ะฝะฐ ะฟะพััะธั:

```css
.grams-portion-btn:active {
  transform: scale(0.92);
}

.grams-portion-btn.just-selected {
  animation: portion-pulse 0.3s ease;
}

@keyframes portion-pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); background: var(--color-primary); }
  100% { transform: scale(1); }
}
```

---

## ๐ ะกััะฐัะตะณะธั ัะตะฐะปะธะทะฐัะธะธ (ะพะฑะฝะพะฒะปัะฝะฝะฐั)

### ะัะธะพัะธัะธะทะฐัะธั:

| ะคะธัะฐ | ะัะธะพัะธัะตั | ะกะปะพะถะฝะพััั | ะะบะปััะธัั? |
|------|-----------|-----------|-----------|
| ะะฐะทะพะฒัะต ะฟะพััะธะธ | ๐ด Must | ะะธะทะบะฐั | โ |
| ะะฒัะพ-ะฟะพััะธะธ | ๐ด Must | ะะธะทะบะฐั | โ |
| Haptic feedback | ๐ด Must | ะะธะทะบะฐั | โ |
| Active state sync | ๐ด Must | ะะธะทะบะฐั | โ |
| WOW #4: Smart initial | ๐ก Nice | ะะธะทะบะฐั | โ |
| WOW #5: Animation | ๐ก Nice | ะะธะทะบะฐั | โ |
| WOW #1: ะกัะตะฟะฟะตั +/โ | ๐ข Future | ะกัะตะดะฝัั | โ (v2) |
| WOW #2: ะะบะพะฝะบะธ | ๐ข Future | ะะธะทะบะฐั | โ (v2) |
| WOW #3: History | ๐ข Future | ะกัะตะดะฝัั | โ (v2) |

---

## ๐ ะะตะฐะปัะฝะฐั ััััะบัััะฐ ะผะพะดะฐะปะพะบ

### gramsModalProduct (MealAddProduct)

| ะคะธัะฐ | ะกัะฐััั |
|------|--------|
| Smart presets (ะธััะพัะธั) | โ `smartGramsPresets` useMemo |
| ะะฝะธะผะฐัะธั ะบะบะฐะป | โ `animatedKcal` state |
| Swipe handlers | โ ะกะฒะพะธ refs + handlers |
| Slider ั ะผะตัะบะฐะผะธ | โ ะััั |
| ะะฝะพะฟะบะฐ | "ะะพะฑะฐะฒะธัั" |
| ะกะพััะฐะฝะตะฝะธะต ะธััะพัะธะธ | โ `saveGramsToHistory` |

### editGramsTarget (DayTab)

| ะคะธัะฐ | ะกัะฐััั |
|------|--------|
| Smart presets | โ Hardcoded [50,100,150,200,250] |
| ะะฝะธะผะฐัะธั ะบะบะฐะป | โ ะกัะฐัะธัะฝัะน Math.round |
| Swipe handlers | โ๏ธ ะะฑัะธะต `handleSheetTouch*` |
| Slider ั ะผะตัะบะฐะผะธ | โ ะะตัะบะธ [100,200,300,400] |
| ะะฝะพะฟะบะฐ | "ะะพัะพะฒะพ" |
| ะกะพััะฐะฝะตะฝะธะต ะธััะพัะธะธ | โ ะะตั |

---

`isMobile` ะพะฟัะตะดะตะปัะตััั ะฒะฝัััะธ `MealAddProduct` (ัััะพะบะฐ 595):
```javascript
const isMobile = typeof window !== 'undefined' && window.innerWidth <= 768;
```

โ๏ธ ะญัะพ **ะฝะต ัะตะฐะบัะธะฒะฝะพะต** ะทะฝะฐัะตะฝะธะต! ะัะธ ัะตัะฐะนะทะต ะพะบะฝะฐ ะฝะต ะพะฑะฝะพะฒะธััั. ะะพ ะดะปั ะฝะฐัะตะน ะทะฐะดะฐัะธ ััะพ ะะ.

---

## ๐ ะกััะฐัะตะณะธั ัะตัะฐะบัะพัะธะฝะณะฐ (ัะฟัะพััะฝะฝะฐั)

ะะพัะปะต ะฐัะดะธัะฐ ะฟะพะฝัะป ััะพ **ะฟะพะปะฝัะน ัะตัะฐะบัะพัะธะฝะณ ะฒ ะพะดะธะฝ ะบะพะผะฟะพะฝะตะฝั โ ะพะฒะตัะบะธะป**:
- ะะพะดะฐะปะบะธ ัะถะต ะธัะฟะพะปัะทััั ัะฐะทะฝัะต ะบะพะฝัะตะบััั (MealAddProduct vs DayTab)
- ะฃ ะฝะธั ัะฐะทะฝัะต callbacks ะธ ะทะฐะฒะธัะธะผะพััะธ
- ะัะฝะพัะธัั ะฒ ะพัะดะตะปัะฝัะน ะบะพะผะฟะพะฝะตะฝั = ะผะฝะพะณะพ prop drilling

### ะะพะฒะฐั ัััะฐัะตะณะธั:

1. **ะฃะดะฐะปะธัั ะผัััะฒัะน ะบะพะด** (`showGramsPicker`) โ ัะบะพะฝะพะผะธั 120 ัััะพะบ
2. **ะะพะฑะฐะฒะธัั ะพะฑัะธะน useMemo ะดะปั ะฐะฒัะพ-ะฟะพััะธะน** โ ะธัะฟะพะปัะทัะตััั ะฒ ะพะฑะตะธั ะผะพะดะฐะปะบะฐั
3. **ะะพะฑะฐะฒะธัั ะฟะพััะธะธ ะฒ ะพะฑะต ะผะพะดะฐะปะบะธ** โ ะผะธะฝะธะผะฐะปัะฝัะต ะธะทะผะตะฝะตะฝะธั
4. **ะฃะฝะธัะธัะธัะพะฒะฐัั `editGramsTarget`** โ ะดะพะฑะฐะฒะธัั smart presets ะธ ะฐะฝะธะผะฐัะธั (ะพะฟัะธะพะฝะฐะปัะฝะพ)

ะญัะพ **ะฟัะพัะต** ะธ **ะฑะตะทะพะฟะฐัะฝะตะต** ัะตะผ ะฟะพะปะฝัะน ัะตัะฐะบัะพัะธะฝะณ!

---

## ๐ง ะะปััะตะฒัะต ัะฐะนะปั

| ะคะฐะนะป | ะงัะพ ะดะตะปะฐัั | ะกััะพะบะธ |
|------|-----------|--------|
| `apps/web/heys_models_v1.js` | Typedef Product + portions | ~6-18 |
| `apps/web/heys_day_v12.js` | ะฃะดะฐะปะธัั ะผัััะฒัะน ะบะพะด showGramsPicker | ~1306, 1636-1675, 5308-5350 |
| `apps/web/heys_day_v12.js` | ะะฒัะพ-ะฟะพััะธะธ ะฒ MealAddProduct | ะฟะพัะปะต ~700 |
| `apps/web/heys_day_v12.js` | UI ะฟะพััะธะน ะฒ gramsModalProduct | ~930 |
| `apps/web/heys_day_v12.js` | UI ะฟะพััะธะน ะฒ editGramsTarget | ~5375 |
| `apps/web/styles/main.css` | ะกัะธะปะธ `.grams-portions` | ะฟะพัะปะต ~7700 |
| `docs/DATA_MODEL_REFERENCE.md` | ะะพะบัะผะตะฝัะฐัะธั | ัะตะบัะธั Product |

---

## ๐ ะจะฐะณะธ ัะตะฐะปะธะทะฐัะธะธ

### ะจะฐะณ 0.1: ะฃะดะฐะปะธัั ะผัััะฒัะน ะบะพะด showGramsPicker

**ะคะฐะนะป**: `apps/web/heys_day_v12.js`

**ะฃะดะฐะปะธัั:**

1. **States** (~ัััะพะบะฐ 1306-1312):
```javascript
const [showGramsPicker, setShowGramsPicker] = useState(false);
const [gramsPickerTarget, setGramsPickerTarget] = useState(null);
const [pendingGrams, setPendingGrams] = useState(0);
const [gramsInputValue, setGramsInputValue] = useState('100');
```

2. **ะคัะฝะบัะธะธ** (~ัััะพะบะธ 1636-1675):
```javascript
function openGramsPicker(...) { ... }
function handleGramsInput(...) { ... }
function handleGramsWheelChange(...) { ... }
function confirmGramsPicker() { ... }
function cancelGramsPicker() { ... }
```

3. **ะะตัะตะผะตะฝะฝะฐั** `gramsValues` ะตัะปะธ ะฝะต ะธัะฟะพะปัะทัะตััั ะฒ `editGramsTarget`

4. **JSX ะผะพะดะฐะปะบะธ** (~ัััะพะบะธ 5308-5350):
```javascript
showGramsPicker && ReactDOM.createPortal(...)
```

5. **ะกััะปะบะธ ะฒ uiState** (~ัััะพะบะธ 2292, 2300):
```javascript
showGramsPicker, // ัะดะฐะปะธัั
```

**ะญะบะพะฝะพะผะธั**: ~120 ัััะพะบ!

### ะจะฐะณ 1: ะะฐััะธัะธัั typedef Product

**ะคะฐะนะป**: `apps/web/heys_models_v1.js` (ัััะพะบะธ 6-18)

```javascript
/** @typedef {Object} Product
 * @property {string|number} id
 * @property {string} name
 * ...ัััะตััะฒัััะธะต ะฟะพะปั...
 * @property {{name: string, grams: number}[]} [portions] // ๐
 */
```

### ะจะฐะณ 2: ะะฒัะพ-ะฟะพััะธะธ useMemo ะฒ MealAddProduct

**ะคะฐะนะป**: `apps/web/heys_day_v12.js`  
**ะะดะต**: ะฟะพัะปะต `smartGramsPresets` (~ัััะพะบะฐ 705)

```javascript
// ๐ ะะฒัะพ-ะฟะพััะธะธ ะฝะฐ ะพัะฝะพะฒะต ะฝะฐะทะฒะฐะฝะธั ะฟัะพะดัะบัะฐ
const effectivePortions = React.useMemo(() => {
  if (!gramsModalProduct) return [];
  if (gramsModalProduct.portions?.length) return gramsModalProduct.portions;
  
  const name = (gramsModalProduct.name || '').toLowerCase();
  
  const AUTO_PORTIONS = {
    'ัะนั': [{ name: '1 ัั', grams: 60 }, { name: '2 ัั', grams: 120 }, { name: '3 ัั', grams: 180 }],
    'ะผะพะปะพะบ': [{ name: 'ยฝ ััะฐะบะฐะฝะฐ', grams: 125 }, { name: '1 ััะฐะบะฐะฝ', grams: 250 }],
    'ะบะตัะธั': [{ name: 'ยฝ ััะฐะบะฐะฝะฐ', grams: 125 }, { name: '1 ััะฐะบะฐะฝ', grams: 250 }],
    'ะนะพะณััั': [{ name: '1 ะฑะฐะฝะพัะบะฐ', grams: 125 }],
    'ัะปะตะฑ': [{ name: '1 ะปะพะผัะธะบ', grams: 30 }, { name: '2 ะปะพะผัะธะบะฐ', grams: 60 }],
    'ะฑะฐัะพะฝ': [{ name: '1 ะปะพะผัะธะบ', grams: 25 }],
    'ะผะฐัะป': [{ name: '1 ั.ะป.', grams: 5 }, { name: '1 ัั.ะป.', grams: 15 }],
    'ะผัะด': [{ name: '1 ั.ะป.', grams: 8 }, { name: '1 ัั.ะป.', grams: 21 }],
    'ัะฐัะฐั': [{ name: '1 ั.ะป.', grams: 5 }, { name: '1 ัั.ะป.', grams: 15 }],
    'ะฑะฐะฝะฐะฝ': [{ name: '1 ัั', grams: 120 }],
    'ัะฑะปะพะบ': [{ name: '1 ัั', grams: 180 }],
    'ะฐะฟะตะปััะธะฝ': [{ name: '1 ัั', grams: 200 }],
    'ะผะฐะฝะดะฐัะธะฝ': [{ name: '1 ัั', grams: 80 }],
    'ะพะณััะตั': [{ name: '1 ัั', grams: 100 }],
    'ะฟะพะผะธะดะพั': [{ name: '1 ัั', grams: 120 }],
    'ะบะฐััะพั': [{ name: '1 ัั', grams: 100 }],
    'ะผะพัะบะพะฒ': [{ name: '1 ัั', grams: 80 }],
    'ััั': [{ name: '1 ะปะพะผัะธะบ', grams: 20 }],
    'ะบะพะปะฑะฐั': [{ name: '1 ะปะพะผัะธะบ', grams: 20 }],
    'ัะพัะธั': [{ name: '1 ัั', grams: 50 }],
    'ัะฐัะดะตะปัะบ': [{ name: '1 ัั', grams: 100 }],
    'ะบะพะฝัะตั': [{ name: '1 ัั', grams: 12 }],
    'ะฟะตัะตะฝั': [{ name: '1 ัั', grams: 10 }],
    'ะพัะตั': [{ name: '1 ะณะพัััั', grams: 30 }],
    'ะผะธะฝะดะฐะป': [{ name: '1 ะณะพัััั', grams: 30 }],
    'ะบะพัะต': [{ name: '1 ั.ะป.', grams: 2 }],
    'ัะฐะน': [{ name: '1 ั.ะป.', grams: 2 }],
    'ัะธั': [{ name: 'ยฝ ััะฐะบะฐะฝะฐ', grams: 100 }],
    'ะณัะตัะบ': [{ name: 'ยฝ ััะฐะบะฐะฝะฐ', grams: 100 }],
    'ะพะฒััะฝะบ': [{ name: 'ยฝ ััะฐะบะฐะฝะฐ', grams: 50 }],
  };
  
  for (const [pattern, portions] of Object.entries(AUTO_PORTIONS)) {
    if (name.includes(pattern)) return portions;
  }
  
  return [];
}, [gramsModalProduct]);
```

### ะจะฐะณ 3: UI ะฟะพััะธะน ะฒ gramsModalProduct

**ะคะฐะนะป**: `apps/web/heys_day_v12.js`  
**ะะดะต**: ะฟะพัะปะต `grams-preview` (~ัััะพะบะฐ 940), ะะะะะ `grams-input-container`

```javascript
// ะะพััะธะธ ะฟัะพะดัะบัะฐ (ะตัะปะธ ะตััั)
effectivePortions.length > 0 && React.createElement('div', { className: 'grams-portions' },
  effectivePortions.map((portion, idx) => 
    React.createElement('button', {
      key: idx,
      className: 'grams-portion-btn' + (gramsValue === portion.grams ? ' active' : ''),
      onClick: () => {
        setGramsValue(portion.grams);
        haptic('light');
      }
    }, 
      React.createElement('span', { className: 'portion-name' }, portion.name),
      React.createElement('span', { className: 'portion-grams' }, portion.grams + 'ะณ')
    )
  )
),
```

### ะจะฐะณ 4: ะะฒัะพ-ะฟะพััะธะธ ะดะปั editGramsTarget

**ะคะฐะนะป**: `apps/web/heys_day_v12.js`  
**ะะดะต**: ะฒ DayTab, ัะพะทะดะฐัั useMemo ะดะปั ะฟะพััะธะน ัะตะดะฐะบัะธัะพะฒะฐะฝะธั (~ะฟะพัะปะต ัััะพะบะธ 1700)

```javascript
// ๐ ะะฒัะพ-ะฟะพััะธะธ ะดะปั ัะตะดะฐะบัะธัะพะฒะฐะฝะธั ะณัะฐะผะผะพะฒ
const editPortions = React.useMemo(() => {
  if (!editGramsTarget?.product) return [];
  const product = editGramsTarget.product;
  if (product.portions?.length) return product.portions;
  
  const name = (product.name || '').toLowerCase();
  
  // ะขะพั ะถะต AUTO_PORTIONS ะพะฑัะตะบั (ะผะพะถะฝะพ ะฒัะฝะตััะธ ะฒ ะบะพะฝััะฐะฝัั)
  const AUTO_PORTIONS = { /* ... */ };
  
  for (const [pattern, portions] of Object.entries(AUTO_PORTIONS)) {
    if (name.includes(pattern)) return portions;
  }
  return [];
}, [editGramsTarget?.product]);
```

### ะจะฐะณ 5: UI ะฟะพััะธะน ะฒ editGramsTarget

**ะคะฐะนะป**: `apps/web/heys_day_v12.js`  
**ะะดะต**: ะฒ ะผะพะดะฐะปะบะต `editGramsTarget`, ะฟะพัะปะต `grams-preview` (~ัััะพะบะฐ 5380)

```javascript
// ะะพััะธะธ (ะตัะปะธ ะตััั)
editPortions.length > 0 && React.createElement('div', { className: 'grams-portions' },
  editPortions.map((portion, idx) => 
    React.createElement('button', {
      key: idx,
      className: 'grams-portion-btn' + (editGramsValue === portion.grams ? ' active' : ''),
      onClick: () => {
        setEditGramsValue(portion.grams);
        haptic('light');
      }
    }, 
      React.createElement('span', { className: 'portion-name' }, portion.name),
      React.createElement('span', { className: 'portion-grams' }, portion.grams + 'ะณ')
    )
  )
),
```

### ะจะฐะณ 6: ะัะฝะตััะธ AUTO_PORTIONS ะฒ ะบะพะฝััะฐะฝัั

ะงัะพะฑั ะฝะต ะดัะฑะปะธัะพะฒะฐัั ะพะฑัะตะบั, ะฒัะฝะตััะธ ะฒ ะฝะฐัะฐะปะพ ัะฐะนะปะฐ ะธะปะธ ะฒ `heys_models_v1.js`:

```javascript
// ะ ะฝะฐัะฐะปะต heys_day_v12.js ะธะปะธ ะฒ heys_models_v1.js
const AUTO_PORTIONS = {
  'ัะนั': [{ name: '1 ัั', grams: 60 }, { name: '2 ัั', grams: 120 }, { name: '3 ัั', grams: 180 }],
  // ... ะพััะฐะปัะฝัะต
};

function getAutoPortions(productName) {
  const name = (productName || '').toLowerCase();
  for (const [pattern, portions] of Object.entries(AUTO_PORTIONS)) {
    if (name.includes(pattern)) return portions;
  }
  return [];
}
```

### ะจะฐะณ 7: ะกัะธะปะธ ั dark mode

**ะคะฐะนะป**: `apps/web/styles/main.css`  
**ะะดะต**: ะฟะพัะปะต `.grams-presets` (~ัััะพะบะฐ 7720)

```css
/* === Portion Buttons === */
.grams-portions {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 8px;
  padding: 0 16px 12px;
}

.grams-portion-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  min-width: 72px;
  padding: 10px 14px;
  border-radius: 12px;
  border: 2px solid var(--color-border-secondary, #e5e5ea);
  background: var(--color-bg-tertiary, #f2f2f7);
  cursor: pointer;
  transition: all 0.15s ease;
  -webkit-tap-highlight-color: transparent;
}

.grams-portion-btn .portion-name {
  font-size: 15px;
  font-weight: 600;
  color: var(--color-text-primary, #000);
}

.grams-portion-btn .portion-grams {
  font-size: 12px;
  color: var(--color-text-secondary, #8e8e93);
  font-weight: 500;
}

.grams-portion-btn:active {
  transform: scale(0.96);
}

.grams-portion-btn.active {
  background: var(--color-primary, #007aff);
  border-color: var(--color-primary, #007aff);
}

.grams-portion-btn.active .portion-name,
.grams-portion-btn.active .portion-grams {
  color: #fff;
}

/* Dark mode โ ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะตะท CSS variables */
```

### ะจะฐะณ 8: ะะฑะฝะพะฒะธัั ะดะพะบัะผะตะฝัะฐัะธั

**ะคะฐะนะป**: `docs/DATA_MODEL_REFERENCE.md`

ะ ัะตะบัะธะธ "ะัะพะดัะบั (Product)" ะดะพะฑะฐะฒะธัั:

```markdown
| `portions` | array | ะะพััะธะธ ะฟัะพะดัะบัะฐ (ะพะฟัะธะพะฝะฐะปัะฝะพ) | `[{name: "1 ัั", grams: 60}]` |

**ะกัััะบัััะฐ ะฟะพััะธะธ:**
| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|------|-----|----------|
| `name` | string | ะะฐะทะฒะฐะฝะธะต ะฟะพััะธะธ ("1 ัั", "1 ั.ะป.") |
| `grams` | number | ะัะฐะผะผั ะฒ ะฟะพััะธะธ |

**ะะฒัะพ-ะฟะพััะธะธ**: ะัะปะธ `portions` ะฝะต ะทะฐะดะฐะฝะพ, ัะธััะตะผะฐ ะพะฟัะตะดะตะปัะตั ะฟะพััะธะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพ ะฝะฐะทะฒะฐะฝะธั ะฟัะพะดัะบัะฐ (~25 ะฟะฐััะตัะฝะพะฒ: ัะนัะพ, ัะปะตะฑ, ะผะพะปะพะบะพ ะธ ั.ะด.)
```

---

## โ ะัะธัะตัะธะธ ะณะพัะพะฒะฝะพััะธ

- [ ] **ะคะฐะทะฐ 0**: ะัััะฒัะน ะบะพะด `showGramsPicker` ัะดะฐะปัะฝ (~120 ัััะพะบ)
- [ ] ะะพะปะต `portions` ะดะพะฑะฐะฒะปะตะฝะพ ะฒ typedef Product
- [ ] `AUTO_PORTIONS` ะฒัะฝะตัะตะฝ ะฒ ะบะพะฝััะฐะฝัั/ััะฝะบัะธั
- [ ] ะะพััะธะธ ัะฐะฑะพัะฐัั ะฒ `gramsModalProduct` (ะดะพะฑะฐะฒะปะตะฝะธะต)
- [ ] ะะพััะธะธ ัะฐะฑะพัะฐัั ะฒ `editGramsTarget` (ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต)
- [ ] ะะฒัะพ-ะฟะพััะธะธ ะฟะพ ะฝะฐะทะฒะฐะฝะธั (~25 ะฟะฐััะตัะฝะพะฒ)
- [ ] ะะบัะธะฒะฝะฐั ะฟะพััะธั ะฟะพะดัะฒะตัะตะฝะฐ (`.active`)
- [ ] Haptic feedback ัะตัะตะท `haptic('light')`
- [ ] CSS ะธัะฟะพะปัะทัะตั ะฟะตัะตะผะตะฝะฝัะต (dark mode ะฐะฒัะพะผะฐัะพะผ)
- [ ] ะขะตัั ะฝะฐ ะผะพะฑะธะปัะฝะพะผ ััััะพะนััะฒะต
- [ ] `pnpm type-check && pnpm build` ะฟัะพัะพะดัั
- [ ] `pnpm lint` ะฟัะพัะพะดะธั

---

## ๐จ ะะธะทัะฐะปัะฝัะน ัะตัะตัะตะฝั

**ะัะพะดัะบั ะก ะฟะพััะธัะผะธ (ัะนัะพ):**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            โโโโโโโ              โ  โ swipe handle
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ๐ฅ ะฏะนัะพ ะบััะธะฝะพะต                โ
โ                                 โ
โ  120ะณ = 188 ะบะบะฐะป                โ  โ animated preview
โ                                 โ
โ  โโโโโโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโ
โ  โ  1 ัั   โ โ  2 ัั   โ โ  3 ัั   โ  โ ะะะะฆะะ (NEW!)
โ  โ  60ะณ    โ โ  120ะณ โ โ โ  180ะณ   โ
โ  โโโโโโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโ
โ                                 โ
โ  ะัะฐะผะผั: [ 120 ]                โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ  โ ัะปะฐะนะดะตั
โ                                 โ
โ  [50ะณ][100ะณ][150ะณ][200ะณ][250ะณ]  โ  โ smart ะฟัะตัะตัั
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะัะพะดัะบั ะะะ ะฟะพััะธะน (ัะฒะพัะพะณ):**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            โโโโโโโ              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ๐ง ะขะฒะพัะพะณ 5%                   โ
โ                                 โ
โ  150ะณ = 159 ะบะบะฐะป                โ
โ                                 โ
โ  ะัะฐะผะผั: [ 150 ]                โ  โ ะฟะพััะธะน ะฝะตั, ััะฐะทั input
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                 โ
โ  [50ะณ][100ะณ][150ะณ][200ะณ][250ะณ]  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## โ๏ธ ะะฐะถะฝะพ (ะพะฑะฝะพะฒะปะตะฝะพ v3.2)

- โ **ะัััะฒัะน ะบะพะด ัะดะฐะปัะฝ** โ `showGramsPicker` ะฑะพะปััะต ะฝะตั
- **ะะฒะต ะผะพะดะฐะปะบะธ** โ `gramsModalProduct` ะธ `editGramsTarget` 
- **AUTO_PORTIONS ะพะดะธะฝ ัะฐะท** โ ะฒัะฝะตััะธ ะฒ `heys_models_v1.js`
- **Dark mode ัะตัะตะท [data-theme]** โ ัะปะตะดะพะฒะฐัั ะฟะฐััะตัะฝั `.grams-preset`
- **haptic('light')** โ ะะ `navigator.vibrate()`
- **Smart initial value** โ ะพัะบััะฒะฐัั ั ะฟะตัะฒะพะน ะฟะพััะธะตะน (WOW #4)

---

## ๐ก WOW-ะธะดะตะธ (ะฝะฐ ะฑัะดััะตะต)

### ะะบะปััะตะฝะพ ะฒ v1 (ัะตะบััะฐั ัะตะฐะปะธะทะฐัะธั):

1. โ **ะะฒัะพ-ะฟะพััะธะธ** โ 25+ ะฟะฐััะตัะฝะพะฒ
2. โ **Smart initial** โ ะพัะบััะฒะฐะตะผ ั ะฟะตัะฒะพะน ะฟะพััะธะตะน
3. โ **Micro-animation** โ scale ะฝะฐ :active
4. โ **Haptic feedback** โ haptic('light')

### ะะพะถะฝะพ ะดะพะฑะฐะฒะธัั ะฒ v2:

5. **๐ฏ ะะพะฟัะปััะฝะฐั ะฟะพััะธั ะฟะตัะฒะพะน** โ ัะพััะฐะฝััั ะธััะพัะธั ะฒัะฑะพัะฐ
6. **โ ะกัะตะฟะฟะตั +/โ** โ ะบะพะผะฟะฐะบัะฝะตะต ะดะปั ัะธั (1ัั, 2ัั, 3ัั โ [โ] 2 [+])
7. **๐ข ะะธะทัะฐะปัะฝัะต ะธะบะพะฝะบะธ** โ emoji ะดะปั ัะธะฟะพะฒ (๐ฅ, ๐ฅ, โ)

### ะะฐ ะฑัะดััะตะต (v3+):

8. **๐ค ะะพะปะพัะพะฒะพะน ะฒะฒะพะด** โ Web Speech API
9. **๐ธ ะคะพัะพ ะฟะพััะธะน** โ ะฒะธะทัะฐะปัะฝัะต ัะตัะตัะตะฝัั
10. **๐งฎ ะัะพะฑะฝัะต ะฟะพััะธะธ** โ "1.5 ะปะพะถะบะธ"
11. **๐ ML-ัะตะบะพะผะตะฝะดะฐัะธะธ** โ ะฟัะตะดัะบะฐะทะฐะฝะธะต ะฝะฐ ะพัะฝะพะฒะต ะธััะพัะธะธ

---

## ๐ ะัะตะฝะบะฐ ัะปะพะถะฝะพััะธ (v3.2)

| ะะพะผะฟะพะฝะตะฝั | ะกะปะพะถะฝะพััั | ะัะตะผั |
|-----------|-----------|-------|
| โ ะฃะดะฐะปะธัั showGramsPicker | ๐ข ะะธะทะบะฐั | โ ะะพัะพะฒะพ |
| Typedef Product | ๐ข ะะธะทะบะฐั | 5 ะผะธะฝ |
| AUTO_PORTIONS ะฒ models | ๐ข ะะธะทะบะฐั | 10 ะผะธะฝ |
| effectivePortions useMemo | ๐ข ะะธะทะบะฐั | 5 ะผะธะฝ |
| Smart initial value (WOW#4) | ๐ข ะะธะทะบะฐั | 5 ะผะธะฝ |
| UI ะฒ gramsModalProduct | ๐ข ะะธะทะบะฐั | 15 ะผะธะฝ |
| editPortions useMemo | ๐ข ะะธะทะบะฐั | 5 ะผะธะฝ |
| UI ะฒ editGramsTarget | ๐ข ะะธะทะบะฐั | 10 ะผะธะฝ |
| ะกัะธะปะธ CSS + animation | ๐ข ะะธะทะบะฐั | 15 ะผะธะฝ |
| Dark mode ััะธะปะธ | ๐ข ะะธะทะบะฐั | 5 ะผะธะฝ |
| ะะพะบัะผะตะฝัะฐัะธั | ๐ข ะะธะทะบะฐั | 5 ะผะธะฝ |
| ะขะตััะธัะพะฒะฐะฝะธะต | ๐ก ะกัะตะดะฝัั | 15 ะผะธะฝ |
| **ะะขะะะ** | | **~95 ะผะธะฝ** |

---

## ๐ ะกะฒัะทะฐะฝะฝัะต

- โ `2025-11-29-grams-input-modal.md` (archived) โ ะพัะธะณะธะฝะฐะปัะฝะฐั ะผะพะดะฐะปะบะฐ
- ๐ `DATA_MODEL_REFERENCE.md` โ ัะฟัะฐะฒะพัะฝะธะบ ะผะพะดะตะปะตะน ะดะฐะฝะฝัั

---

## ๐ ะะปัะฑะพะบะธะน ะฐัะดะธั v3.2 (ะคะะะะะฌะะซะ)

### ๐ด ะัะธัะธัะตัะบะธะต ะฝะฐัะพะดะบะธ:

1. โ **`showGramsPicker` โ ะฃะะะะะ!** 
   - ~120 ัััะพะบ ะผัััะฒะพะณะพ ะบะพะดะฐ ัะดะฐะปะตะฝะพ
   - `pnpm type-check && build && lint` ะฟัะพัะปะธ

2. **Haptic feedback ะฝะตัะพะณะปะฐัะพะฒะฐะฝ**
   - ะ ะผะพะดะฐะปะบะฐั ะณัะฐะผะผะพะฒ: `navigator.vibrate()`
   - ะ ะพััะฐะปัะฝะพะผ ะบะพะดะต: `haptic()`
   - **ะะตัะตะฝะธะต**: ะัะฟะพะปัะทะพะฒะฐัั `haptic('light')` ะดะปั ะฝะพะฒัั ะฟะพััะธะน

3. **editGramsTarget ะฑะตะดะฝะตะต gramsModalProduct**
   - ะะตั smart presets
   - ะะตั animated kcal
   - **ะะตัะตะฝะธะต**: ะะพะฑะฐะฒะปัะตะผ ัะพะปัะบะพ ะฟะพััะธะธ, ัะฝะธัะธะบะฐัะธั โ ะพัะดะตะปัะฝะฐั ะทะฐะดะฐัะฐ

### ๐ก UX ัะธัะบะธ ะธ ัะตัะตะฝะธั:

| ะะธัะบ | ะะตัะตะฝะธะต |
|------|---------|
| Overflow ะฝะฐ iPhone SE | `flex-wrap: wrap` + max 4 ะบะฝะพะฟะบะธ ะฒ ััะด |
| ะะพััะธั ะฝะต ัะฝะธะผะฐะตััั ะฟัะธ ัััะฝะพะผ ะฒะฒะพะดะต | `.active` ัะพะปัะบะพ ะฟัะธ `===` |
| ะะพะปัะทะพะฒะฐัะตะปั ะฝะต ะทะฐะผะตัะธั ะฟะพััะธะธ | ะะธะทัะฐะปัะฝะพ ะพัะปะธัะฐะตะผ ะพั presets (border) |
| ะกะปะฐะนะดะตั "ะฟััะณะฐะตั" ะฟัะธ ะบะปะธะบะต | CSS transition ะฝะฐ thumb |
| Initial 100ะณ ะฒะผะตััะพ ะฟะพััะธะธ | WOW #4 โ ะพัะบััะฒะฐะตะผ ั ะฟะตัะฒะพะน ะฟะพััะธะตะน |

### ๐ข ะะฐัะตััะฒะพ ะฟัะพะผะฟัะฐ:

| ะัะธัะตัะธะน | ะัะตะฝะบะฐ |
|----------|--------|
| ะะพะปะฝะพัะฐ ะบะพะฝัะตะบััะฐ | โ 9/10 |
| ะะตะฐะปะธััะธัะฝะพััั ััะพะบะพะฒ | โ 9/10 (~95 ะผะธะฝ) |
| ะงััะบะพััั ัะฐะณะพะฒ | โ 9/10 |
| ะฃััั edge cases | โ 8/10 |
| WOW-ัะฐะบัะพั | โ 9/10 |
| ะะธัะบะธ ัััะตะฝั | โ 9/10 |
| **ะะฑัะธะน ะฑะฐะปะป** | **โ 9/10** |

### โ๏ธ ะะพัะตะฝัะธะฐะปัะฝัะต ะฑะปะพะบะตัั (ัััะตะฝั):

1. ~~showGramsPicker ะผัััะฒัะน ะบะพะด~~ โ โ ะฃะดะฐะปัะฝ
2. ~~ะัะฑะปะธัะพะฒะฐะฝะธะต AUTO_PORTIONS~~ โ ะะตัะตะฝะธะต: ะฒัะฝะตััะธ ะฒ models
3. ~~Dark mode inconsistency~~ โ ะะตัะตะฝะธะต: ัะปะตะดะพะฒะฐัั [data-theme]
4. ~~Haptic inconsistency~~ โ ะะตัะตะฝะธะต: ะธัะฟะพะปัะทะพะฒะฐัั haptic()

### ๐ ะัะพะณะพะฒัะต ะผะตััะธะบะธ:

| ะะตััะธะบะฐ | ะะฝะฐัะตะฝะธะต |
|---------|----------|
| ะกััะพะบ ัะดะฐะปะตะฝะพ | ~120 (ะผัััะฒัะน ะบะพะด) |
| ะกััะพะบ ะดะพะฑะฐะฒะธััั | ~150 (ะฟะพััะธะธ) |
| ะะพะดะฐะปะพะบ ะทะฐััะพะฝััะพ | 2 |
| ะะฐััะตัะฝะพะฒ ะฐะฒัะพ-ะฟะพััะธะน | 25+ |
| ะัะตะผั ัะตะฐะปะธะทะฐัะธะธ | ~95 ะผะธะฝ |
| ะะธัะบ ัะตะณัะตััะธะธ | ๐ข ะะธะทะบะธะน |
| WOW-ัะฐะบัะพั | ๐๐๐๐
