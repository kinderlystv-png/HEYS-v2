# Промпт: Порции продуктов ("1 яйцо = 60г")

**Дата**: 2025-11-29  
**Приоритет**: 🟡 Средний (UX улучшение)  
**Время**: ~45-60 минут  
**Статус**: ⬜ Не начато

---

## 📋 Описание задачи

Добавить поддержку **порций** для продуктов — альтернативный способ ввода количества вместо граммов.

**Примеры:**
- 🥚 Яйцо → "1 шт" = 60г
- 🥄 Мёд → "1 ч.л." = 8г, "1 ст.л." = 21г
- 🍞 Хлеб → "1 ломтик" = 30г
- 🥛 Молоко → "1 стакан" = 250мл
- 🍌 Банан → "1 шт (средний)" = 120г

---

## 🎯 Цель

Ускорить ввод для продуктов где **порции естественнее граммов**:
- Яйца (никто не взвешивает яйцо)
- Ложки (мёд, масло, сахар)
- Штуки (фрукты, конфеты)
- Стаканы (напитки)

---

## 🔧 Ключевые файлы

| Файл | Что делать |
|------|-----------|
| `apps/web/heys_models_v1.js` | Добавить поле `portions` в Product |
| `apps/web/heys_day_v12.js` | UI выбора порций в модалке граммов |
| `apps/web/styles/main.css` | Стили для кнопок порций |
| `docs/DATA_MODEL_REFERENCE.md` | Документация нового поля |

---

## 📝 Шаги реализации

### Шаг 1: Расширить модель Product

**Файл**: `apps/web/heys_models_v1.js`

Добавить опциональное поле `portions`:

```javascript
// В Product модели
portions: [
  { name: "1 шт", grams: 60 },
  { name: "1/2 шт", grams: 30 }
]
// portions: undefined — если порции не заданы
```

**Структура порции:**
| Поле | Тип | Описание | Пример |
|------|-----|----------|--------|
| `name` | string | Название порции | "1 ч.л.", "1 шт" |
| `grams` | number | Граммы в порции | 8, 60, 250 |

### Шаг 2: UI в модалке граммов

**Файл**: `apps/web/heys_day_v12.js` (GramsInputModal)

Если у продукта есть `portions` — показать кнопки порций **над** пресетами граммов:

```
┌─────────────────────────────────┐
│  🥚 Яйцо куриное                │
│                                 │
│  120г = 188 ккал                │
│                                 │
│  ┌──────────┐ ┌──────────┐      │  ← ПОРЦИИ (если есть)
│  │ 1 шт 60г │ │ 2 шт 120г│      │
│  └──────────┘ └──────────┘      │
│                                 │
│  Граммы: [ 120 ]                │
│                                 │
│  ┌────┐┌────┐┌────┐┌────┐┌────┐│  ← пресеты (fallback)
│  │ 50 ││100 ││150 ││200 ││250 ││
│  └────┘└────┘└────┘└────┘└────┘│
└─────────────────────────────────┘
```

**Логика:**
1. Если `product.portions` существует и непустой → показать кнопки порций
2. Клик на порцию → `setGramsValue(portion.grams)`
3. Пресеты граммов показывать всегда (fallback)

### Шаг 3: Стили кнопок порций

**Файл**: `apps/web/styles/main.css`

```css
.grams-portions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 12px;
}

.grams-portion-btn {
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
  background: #f8fafc;
  font-size: 13px;
  font-weight: 500;
  color: #334155;
  cursor: pointer;
  transition: all 0.15s ease;
}

.grams-portion-btn:active {
  transform: scale(0.97);
}

.grams-portion-btn.active {
  background: #22c55e;
  border-color: #22c55e;
  color: white;
}

/* Мелкий текст с граммами */
.grams-portion-btn small {
  font-size: 11px;
  opacity: 0.7;
  margin-left: 4px;
}
```

### Шаг 4: Добавить порции к популярным продуктам

Создать функцию для добавления стандартных порций:

```javascript
// Стандартные порции для категорий
const STANDARD_PORTIONS = {
  'яйцо': [{ name: '1 шт', grams: 60 }, { name: '2 шт', grams: 120 }],
  'молоко': [{ name: '1 стакан', grams: 250 }, { name: '100 мл', grams: 100 }],
  'хлеб': [{ name: '1 ломтик', grams: 30 }, { name: '2 ломтика', grams: 60 }],
  'масло': [{ name: '1 ч.л.', grams: 5 }, { name: '1 ст.л.', grams: 15 }],
  'мёд': [{ name: '1 ч.л.', grams: 8 }, { name: '1 ст.л.', grams: 21 }],
  'сахар': [{ name: '1 ч.л.', grams: 5 }, { name: '1 ст.л.', grams: 15 }],
  'банан': [{ name: '1 шт', grams: 120 }],
  'яблоко': [{ name: '1 шт', grams: 180 }],
  'апельсин': [{ name: '1 шт', grams: 200 }],
};
```

### Шаг 5: UI для редактирования порций (опционально)

В карточке редактирования продукта добавить возможность настроить порции.

---

## ✅ Критерии готовности

- [ ] Поле `portions` добавлено в модель Product
- [ ] Кнопки порций отображаются в модалке (если есть)
- [ ] Клик на порцию устанавливает граммы
- [ ] Активная порция подсвечена
- [ ] Haptic при выборе порции
- [ ] Стандартные порции для 10+ популярных продуктов
- [ ] Dark mode стили
- [ ] `pnpm type-check && pnpm build` проходят

---

## 🎨 Визуальный референс

**Продукт БЕЗ порций:**
```
┌─────────────────────────────────┐
│  🧀 Творог 5%                   │
│  150г = 159 ккал                │
│  Граммы: [ 150 ]                │
│  [50][100][150][200][250]       │  ← только пресеты
└─────────────────────────────────┘
```

**Продукт С порциями:**
```
┌─────────────────────────────────┐
│  🥚 Яйцо куриное                │
│  120г = 188 ккал                │
│                                 │
│  [1 шт 60г] [2 шт 120г]         │  ← порции (приоритет)
│                                 │
│  Граммы: [ 120 ]                │
│  [50][100][150][200][250]       │  ← пресеты (всегда)
└─────────────────────────────────┘
```

---

## ⚠️ Важно

- **Порции опциональны** — большинство продуктов будут без них
- **Не ломать существующий flow** — граммы всегда работают
- **Порции = convenience** — не замена граммам, а дополнение
- **Стандартные порции** — только для очевидных случаев (яйца, ложки)

---

## 💡 Потенциальные улучшения (на будущее)

1. **Автоопределение порций** — по названию продукта
2. **Пользовательские порции** — "моя чашка = 300мл"
3. **Калькулятор порций** — "2.5 шт" = 150г
4. **Импорт порций** — из базы USDA/FatSecret

---

## 📊 Оценка сложности

| Компонент | Сложность | Время |
|-----------|-----------|-------|
| Модель Product | 🟢 Низкая | 5 мин |
| UI кнопок порций | 🟢 Низкая | 15 мин |
| Стили + dark mode | 🟢 Низкая | 10 мин |
| Стандартные порции | 🟢 Низкая | 10 мин |
| Тестирование | 🟢 Низкая | 5 мин |
| **ИТОГО** | | **45 мин** |

---

## 🔗 Связанные задачи

- ✅ `2025-11-29-grams-input-modal.md` (archived) — базовая модалка готова
