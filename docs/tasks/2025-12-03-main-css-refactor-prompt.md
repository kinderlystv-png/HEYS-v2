# main.css Refactor ‚Äî –∞—É–¥–∏—Ç –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç

**–î–∞—Ç–∞:** 2025-12-03  
**–§–∞–π–ª-—Ü–µ–ª—å:** `apps/web/styles/main.css` (entry —Å `@import`), –º–æ–¥—É–ª–∏ `apps/web/styles/modules/*` —Å—É–º–º–∞—Ä–Ω–æ 20‚ÄØ241 —Å—Ç—Ä–æ–∫, 210 `!important`, 512 dark-theme –ø—Ä–∞–≤–∏–ª, 187 –∞–Ω–∏–º–∞—Ü–∏–π  
**–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è:** `apps/web/index.html` —á–µ—Ä–µ–∑ `styles/main.css?v=1011`  
**–ù–ï —Ç—Ä–æ–≥–∞—Ç—å:** –∫–æ—Ä–Ω–µ–≤–æ–π `styles/main.css` (–¥–ª—è —Ç–µ—Å—Ç–æ–≤), `styles/critical.css`

---

## ‚ö†Ô∏è –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –†–∏—Å–∫ |
|---------|----------|------|
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | 20 241 | üî¥ –û–≥—Ä–æ–º–Ω—ã–π —Ñ–∞–π–ª |
| `!important` | 210 | üü° –¢—Ä–µ–±—É–µ—Ç –∞–∫–∫—É—Ä–∞—Ç–Ω–æ—Å—Ç–∏ |
| Dark theme –ø—Ä–∞–≤–∏–ª | 512 | üî¥ –ì–ª–∞–≤–Ω—ã–π —Ä–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∞ |
| –ê–Ω–∏–º–∞—Ü–∏–π (@keyframes) | 187 | üü° –õ–µ–≥–∫–æ —Å–ª–æ–º–∞—Ç—å |
| –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å–æ–≤ | 28 | üü¢ –£–ø—Ä–∞–≤–ª—è–µ–º–æ |
| –î—É–±–ª–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ | ~50 | üü° –ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ |

**‚è±Ô∏è –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –≤—Ä–µ–º—è:** 3-4 —á–∞—Å–∞ (—Ä–∞–∑–±–∏—Ç—å –Ω–∞ 3-4 —Å–µ—Å—Å–∏–∏ –ø–æ 45-60 –º–∏–Ω)

---

## Phase 0 ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–ë–õ–û–ö–ï–†–´)

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–¥–æ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã)
- [ ] `git stash` –∏–ª–∏ `git commit` —Ç–µ–∫—É—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `heys_step_modal_v1.js`, `heys_add_product_step_v1.js`, `main.css`
- [ ] `git status` + `git diff --stat` ‚Äî –Ω–µ—Ç —Å–∫—Ä—ã—Ç—ã—Ö –ø—Ä–∞–≤–æ–∫ –≤ `apps/web/styles/main.css`
- [ ] –ë—ç–∫–∞–ø entry: `cp apps/web/styles/main.css apps/web/styles/main.css.$(date +%Y%m%d).bak` (–µ—Å—Ç—å –ø—Ä–µ–¥—Å–ø–ª–∏—Ç `main.css.pre-split-2025-12-03`)
- [ ] –°–∫—Ä–∏–Ω—à–æ—Ç—ã baseline: DayTab (light + dark), –º–æ–¥–∞–ª–∫–∏, toast, water-ring, sparkline, confetti
- [ ] `pnpm dev` —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–æ–Ω—Å–æ–ª—å —á–∏—Å—Ç–∞—è

### üìä –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–æ/–ø–æ—Å–ª–µ)
```bash
cat apps/web/styles/modules/*.css | wc -l                    # ‚Üí 20203
rg '!important' apps/web/styles/modules | wc -l              # ‚Üí 210
rg 'data-theme="dark"' apps/web/styles/modules | wc -l       # ‚Üí 512
rg '@keyframes' apps/web/styles/modules | wc -l              # ‚Üí 187
rg -o "#[0-9a-fA-F]{3,6}" apps/web/styles/modules | sort | uniq -c | sort -nr | head  # —Ç–æ–ø-hex –¥–ª—è var()
```

### üîç –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [ ] –ê–Ω–∏–º–∞—Ü–∏–∏ –ù–ï —É–¥–∞–ª—è—Ç—å: `confetti`, `toast-slide`, `pulse`, `shake`, `splash`, `fade`, `spin`, `bounce`
- [ ] –ö–ª–∞—Å—Å—ã –≤ JS (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å usages): `.macro-toast-*`, `.grams-input`, `.fab-*`, `.sparkline-*`, `.mpc-*`, `.water-ring`, `.confetti-*`
- [ ] SW –∫—ç—à: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `apps/web/heys_service_worker_v1.js` ‚Äî –ø—É—Ç—å –∫ main.css
- [ ] Safe-area/notch: —Å–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Å `docs/tasks/archive/2025-11-24-mobile-ux-phase-2.md`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ main.css –≤ `docs/tasks`, `archive/docs`, `TESTS/*.html` ‚Äî –Ω–µ –ª–æ–º–∞—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–Ω—ã–µ –¥–µ–º–æ

---

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è: 4 –º–∏–Ω–∏-—Å–ø—Ä–∏–Ω—Ç–∞ (–Ω–µ –≤—Å—ë —Å—Ä–∞–∑—É!)

### Sprint 1: –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ + —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (30 –º–∏–Ω) ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û
- –î–æ–±–∞–≤–∏—Ç—å Table of Contents –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞
- –ü—Ä–æ–Ω—É–º–µ—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ü–∏–∏ –º–∞—Ä–∫–µ—Ä–∞–º–∏ `/* === 01. BASE === */`
- –ù–ï –º–µ–Ω—è—Ç—å –∫–æ–¥, —Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- **–†–∏—Å–∫:** –ù—É–ª–µ–≤–æ–π

### Sprint 2: CSS Variables (45 –º–∏–Ω) üü° –°–†–ï–î–ù–ò–ô –†–ò–°–ö ‚úÖ –°–î–ï–õ–ê–ù–û
–ó–∞–º–µ–Ω–∏—Ç—å —Ç–æ–ø-15 hex –Ω–∞ var() —Å fallback:

| –¶–≤–µ—Ç | –ö–æ–ª-–≤–æ | –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è |
|------|--------|------------|
| `#fff` | 102 | `var(--color-white, #fff)` |
| `#64748b` | 88 | `var(--color-slate-500, #64748b)` |
| `#f1f5f9` | 83 | `var(--color-slate-100, #f1f5f9)` |
| `#94a3b8` | 80 | `var(--color-slate-400, #94a3b8)` |
| `#e2e8f0` | 76 | `var(--color-slate-200, #e2e8f0)` |
| `#6b7280` | 66 | `var(--color-gray-500, #6b7280)` |
| `#334155` | 66 | `var(--color-slate-700, #334155)` |
| `#3b82f6` | 53 | `var(--color-blue-500, #3b82f6)` |
| `#10b981` | 46 | `var(--color-emerald-500, #10b981)` |
| `#ef4444` | 45 | `var(--color-red-500, #ef4444)` |

- –î–æ–±–∞–≤–∏—Ç—å dark-theme –ø–∞—Ä—ã –≤ `:root` –∏ `[data-theme="dark"]`
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥—ã—Ö 5-10 –∑–∞–º–µ–Ω
- **–†–∏—Å–∫:** –°–ª–æ–º–∞—Ç—å dark theme –µ—Å–ª–∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–µ –≤–µ—Ç–∫–∏

### Sprint 3: –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–µ–π (30 –º–∏–Ω) üü° –°–†–ï–î–ù–ò–ô –†–ò–°–ö  
–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Å–µ–ª–µ–∫—Ç–æ—Ä—ã:
- `.confetti-container` ‚Äî 4 —Ä–∞–∑–∞
- `.tab`, `.metrics-value`, `.metrics-card` ‚Äî 3 —Ä–∞–∑–∞
- ~20 —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –ø–æ 2 —Ä–∞–∑–∞

- –ü—Ä–æ–≤–µ—Ä—è—Ç—å usages —á–µ—Ä–µ–∑ `grep -r` –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
- –ü–æ–º–µ—á–∞—Ç—å —Å–æ–º–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∫–∞–∫ `/* legacy? */`
- **–†–∏—Å–∫:** –£–¥–∞–ª–∏—Ç—å –Ω—É–∂–Ω—ã–π override

### Sprint 4: !important –∞—É–¥–∏—Ç (45 –º–∏–Ω) üî¥ –í–´–°–û–ö–ò–ô –†–ò–°–ö
- **–ù–ï —É–¥–∞–ª—è—Ç—å –º–∞—Å—Å–æ–≤–æ!**
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ !important:
  1. –ù–∞–π—Ç–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–π —Å–µ–ª–µ–∫—Ç–æ—Ä
  2. –£–≤–µ–ª–∏—á–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ—Å—Ç—å –±–µ–∑ !important –ò–õ–ò
  3. –ü–æ–º–µ—Ç–∏—Ç—å `/* TODO: investigate !important */`
- **–¶–µ–ª—å:** —Å–Ω–∏–∑–∏—Ç—å —Å 210 –¥–æ ~150-170 (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
- **–†–∏—Å–∫:** –°–ª–æ–º–∞—Ç—å –∫–∞—Å–∫–∞–¥ —Å—Ç–∏–ª–µ–π

---

## –ö—Ä–∞—Ç–∫–∏–π –∞—É–¥–∏—Ç —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (:root)
–£–∂–µ –µ—Å—Ç—å –±–∞–∑–æ–≤—ã–µ: `--bg`, `--card`, `--text`, `--muted`, `--border`, `--acc`, `--success`, `--warning`, `--danger`, `--protein`, `--fat`, `--carbs`

### –ü—Ä–æ–±–ª–µ–º—ã —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –§–∞–π–ª —Ä–∞–∑–¥—É—Ç –¥–æ 20k —Å—Ç—Ä–æ–∫, —Å–µ–∫—Ü–∏–∏ –±–µ–∑ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è
- –ù–æ–≤—ã–µ –±–ª–æ–∫–∏ (APS/Advice/XP) –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–æ–Ω–µ—Ü –±–µ–∑ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
- 512 dark-theme –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ —Ñ–∞–π–ª—É
- –ö–ª–∞—Å—Å—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ UMD-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º ‚Äî –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ

### –ß—Ç–æ —É–ø—É—â–µ–Ω–æ / —Ä–∏—Å–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ù–µ—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–∞—Ä–≥–µ—Ç–∞ –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é `!important` –∏ —Å—Ç—Ä–æ–∫: –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –æ–± —É—Å–ø–µ—Ö–µ –∑–∞—Ä–∞–Ω–µ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, -10% –±–µ–∑ —Ä–µ–≥—Ä–µ—Å—Å–∞).
- –ù–µ –ø—Ä–æ–ø–∏—Å–∞–Ω –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ —Å `styles/critical.css` (—á—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –≤ critical, —á—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç—å –≤ main).
- –ù–µ —Ä–µ—à–µ–Ω–æ, –∫–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å `?v=1010` –∏ —á–∏—Å—Ç–∏—Ç—å SW-–∫—ç—à ‚Äî —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∏–ª–∏ –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º.
- –ù–µ –æ–ø–∏—Å–∞–Ω—ã edge-–∫–µ–π—Å—ã: `prefers-reduced-motion`, zoom 200%, RTL (–µ—Å–ª–∏ –±—É–¥–µ—Ç), high-contrast ‚Äî —Å—Ç–æ–∏—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–Ω–∏–º—É–º toasts/–∫–Ω–æ–ø–∫–∏.
- Safe-area –∏ –º–æ–±–∏–ª—å–Ω—ã–µ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω—ã: –Ω—É–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å, –∫–∞–∫–∏–µ –æ—Ç—Å—Ç—É–ø—ã —Å—á–∏—Ç–∞—é—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã (`viewport-fit=cover`).

---

## –¶–µ–ª—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

| ‚úÖ –î–µ–ª–∞—Ç—å | ‚ùå –ù–ï –¥–µ–ª–∞—Ç—å |
|-----------|--------------|
| –î–æ–±–∞–≤–∏—Ç—å –æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ | –£–¥–∞–ª—è—Ç—å "–º—ë—Ä—Ç–≤—ã–π" –∫–æ–¥ –±–µ–∑ 100% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ |
| –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ var() | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å @layer (—Å–ª–æ–º–∞–µ—Ç –∫–∞—Å–∫–∞–¥) |
| –°–Ω–∏–∑–∏—Ç—å !important —Å 210 –¥–æ ~150 | –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å –∫–ª–∞—Å—Å—ã (JS –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏) |
| –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥—É–±–ª–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ | –¢—Ä–æ–≥–∞—Ç—å @keyframes –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã |

## –û–≤–µ—Ä–∫–∏–ª–ª ‚Äî —á–µ–≥–æ –∏–∑–±–µ–≥–∞—Ç—å
- –¢–æ—Ç–∞–ª—å–Ω–∞—è –∑–∞–º–µ–Ω–∞ –≤—Å–µ—Ö hex —Å—Ä–∞–∑—É: –≤—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–µ–≥—Ä–µ—Å—Å–∞, –ª—É—á—à–µ –ø–∞–∫–µ—Ç–∞–º–∏ –ø–æ 5-10 –∑–∞–º–µ–Ω —Å —Ç–µ—Å—Ç–æ–º.
- –ú–∞—Å—Å–æ–≤–æ–µ —Å–Ω—è—Ç–∏–µ `!important` –±–µ–∑ —Ñ–∏–∫—Å–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤: –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∫–∞—Å–∫–∞–¥–Ω—ã–º –±–∞–≥–∞–º.
- –ü–µ—Ä–µ–Ω–æ—Å –±–∞–∑–æ–≤—ã—Ö —Å—Ç–∏–ª–µ–π –≤ `critical.css` –±–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏—è FOUC: –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –ø–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä.
- –í–Ω–µ–¥—Ä–µ–Ω–∏–µ utility-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞/Tailwind –Ω–∞ —Ö–æ–¥—É: –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ scope –∏ –º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å.

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Ç–æ—á–∫–∏ –≤–Ω–∏–º–∞–Ω–∏—è

- `apps/web/index.html` ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ main.css
- JS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª–∞—Å—Å—ã: `.macro-toast-*`, `.grams-input`, `.fab-*`, `.sparkline-*`, `.mpc-*`, `.water-ring`, `.confetti-*`
- Dark mode: 512 `[data-theme="dark"]` ‚Äî –ø—Ä–∏ –∑–∞–º–µ–Ω–µ hex –ø—Ä–æ–≤–µ—Ä—è—Ç—å –û–ë–ï –≤–µ—Ç–∫–∏
- –ê–Ω–∏–º–∞—Ü–∏–∏: 187 @keyframes ‚Äî –ù–ï —Ç—Ä–æ–≥–∞—Ç—å –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã
- SW/–∫—ç—à: `heys_service_worker_v1.js` ‚Äî –ø—É—Ç—å –∫ CSS

---

## –†–∏—Å–∫-–º–∞—Ç—Ä–∏—Ü–∞

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –ò–º–ø–∞–∫—Ç | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|--------|-----------|
| –°–ª–æ–º–∞—Ç—å dark theme | –í—ã—Å–æ–∫–∞—è | –í—ã—Å–æ–∫–∏–π | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–∞ —Ä–µ–∂–∏–º–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞ |
| –°–ª–æ–º–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–∏–π | –ù–ï —Ç—Ä–æ–≥–∞—Ç—å @keyframes |
| –£–¥–∞–ª–∏—Ç—å –Ω—É–∂–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–∏–π | `grep -r` –≤ JS/HTML –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º |
| !important regression | –í—ã—Å–æ–∫–∞—è | –°—Ä–µ–¥–Ω–∏–π | –°–Ω–∏–º–∞—Ç—å –ø–æ –æ–¥–Ω–æ–º—É, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å |
| –ö—ç—à –æ—Ç–¥–∞—ë—Ç —Å—Ç–∞—Ä—ã–π CSS | –°—Ä–µ–¥–Ω—è—è | –ù–∏–∑–∫–∏–π | Hard refresh, –æ–±–Ω–æ–≤–∏—Ç—å ?v= |
| Safe-area/notch | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–∏–π | –°–≤–µ—Ä–∏—Ç—å —Å mobile-ux Phase 2, —Ç–µ—Å—Ç –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ/—Å–∫—Ä–∏–Ω–µ |
| Prefers-reduced-motion | –ù–∏–∑–∫–∞—è | –ù–∏–∑–∫–∏–π | –û—Å—Ç–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏, –Ω–æ —É–≤–∞–∂–∞—Ç—å –º–µ–¥–∏–∞–≤—ã—Ä–∞–∂–µ–Ω–∏–µ |

---

## –¢–µ—Å—Ç—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞

- [ ] `pnpm dev` ‚Äî –±–µ–∑ –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
- [ ] –ú–æ–±–∏–ª—å–Ω—ã–π DayTab ‚Äî meals, accordion, swipe
- [ ] –ú–æ–¥–∞–ª–∫–∏ ‚Äî StepModal, AddProduct, Training
- [ ] Toast ‚Äî –ø–æ—è–≤–ª–µ–Ω–∏–µ/–∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
- [ ] –ì—Ä–∞—Ñ–∏–∫–∏ ‚Äî sparkline, weight-sparkline
- [ ] Water ring ‚Äî –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- [ ] Dark mode ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å—ë –≤—ã—à–µ
- [ ] Confetti ‚Äî —Ç—Ä–∏–≥–≥–µ—Ä–Ω—É—Ç—å streak celebration

---

## üöÄ WOW-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!)

### 1. CSS Custom Properties —Å fallback (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
```css
/* –í–º–µ—Å—Ç–æ */
color: var(--text);
/* –î–µ–ª–∞—Ç—å */
color: var(--text, #111827);
```

### 2. `prefers-contrast` –¥–ª—è accessibility
```css
@media (prefers-contrast: high) {
  :root {
    --border: #000;
    --muted: #333;
  }
}
```

### 3. Native CSS nesting (future-proof, 2025 –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 95%+)
```css
.card {
  background: var(--card);
  
  &:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  
  & .title {
    font-weight: 600;
  }
}
```

### 4. Design tokens naming (Tailwind-style)
```css
:root {
  /* Semantic */
  --color-bg-primary: var(--color-white);
  --color-bg-secondary: var(--color-slate-100);
  --color-text-primary: var(--color-slate-900);
  --color-text-muted: var(--color-slate-500);
  
  /* Functional */
  --color-success: var(--color-emerald-500);
  --color-warning: var(--color-amber-500);
  --color-danger: var(--color-red-500);
}
```

- –î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–µ doc-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–µ—Ä–µ–¥ –∫—Ä—É–ø–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏ (graphs, toasts, hydration, XP/APS) —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ JS-–∏—Å—Ç–æ—á–Ω–∏–∫ ‚Äî –ø–æ–≤—ã—à–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å.
- –ú–∏–Ω–∏-–Ω–∞–±–æ—Ä utility-–∫–ª–∞—Å—Å–æ–≤ (gap/padding/radius) –±–µ–∑ Tailwind ‚Äî —Å–Ω–∏–∑–∏—Ç –¥—É–±–ª–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤.
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å easing/–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–π (toasts, buttons) –∏ –¥–æ–±–∞–≤–∏—Ç—å `@media (prefers-reduced-motion: reduce)` ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UX.
- –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å `@layer` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–±–æ—Ä–∫–∞ –Ω–µ –ª–æ–º–∞–µ—Ç—Å—è; –∏–Ω–∞—á–µ ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –∏–¥–µ—é –Ω–∞ –±—É–¥—É—â–µ–µ.

---

## –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–ø–ª–∏—Ç–∞ (2025-12-03)
- `apps/web/styles/main.css` —Ç–µ–ø–µ—Ä—å ‚Äî entry —Å `@import` –ø–æ—Ä—è–¥–∫–∞ (000‚Üí600), —Å–æ—Ö—Ä–∞–Ω—è—è –∫–∞—Å–∫–∞–¥.
- –ú–æ–¥—É–ª–∏: `apps/web/styles/modules/000-base-and-gamification.css`, `100-metrics-and-graphs.css`, `200-dark-and-effects.css`, `300-modals-and-day.css`, `400-water-and-hydration.css`, `500-pwa-and-offline.css`, `600-steps-and-aps.css`.
- –ë—ç–∫–∞–ø –º–æ–Ω–æ–ª–∏—Ç–∞ –ø–µ—Ä–µ–¥ —Å–ø–ª–∏—Ç–æ–º: `apps/web/styles/main.css.pre-split-2025-12-03`.
- –í–µ—Ä—Å–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ `?v=1011`; SW precache –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–æ–≤—ã–º–∏ CSS-–º–æ–¥—É–ª—è–º–∏.

---

## Rollback

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
cp apps/web/styles/main.css.pre-split-2025-12-03 apps/web/styles/main.css

# –ò–ª–∏ —á–µ—Ä–µ–∑ git
git checkout apps/web/styles/main.css
```

---

## –û—Ü–µ–Ω–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–º–ø—Ç–∞:** 92%
- **–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** ~3-4 —á–∞—Å–∞ (4 —Å–ø—Ä–∏–Ω—Ç–∞ –ø–æ 30-45 –º–∏–Ω)
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —Å Sprint 1 (–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ) ‚Äî 100% –±–µ–∑–æ–ø–∞—Å–Ω–æ, —Å—Ä–∞–∑—É —É–ª—É—á—à–∏—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é

## –£—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
1) –ù—É–∂–Ω–æ –ª–∏ —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è—Ç—å query `?v=1010` –∏ —á–∏—Å—Ç–∏—Ç—å SW-–∫—ç—à, –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ —Ä–µ–ª–∏–∑–∞?
2) –ï—Å—Ç—å –ª–∏ –∑–∞–ø—Ä–µ—Ç–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –ø–æ–º–∏–º–æ –≥—Ä–∞—Ñ–∏–∫–æ–≤ 3400‚Äì6600 (–Ω–∞–ø—Ä–∏–º–µ—Ä, toasts, water, APS/XP)?
3) –ö–∞–∫–æ–π —Ç–∞—Ä–≥–µ—Ç –ø–æ `!important` –∏ —Å—Ç—Ä–æ–∫–∞–º —Å—á–∏—Ç–∞–µ–º —É—Å–ø–µ—Ö–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, -10% –±–µ–∑ —Ä–µ–≥—Ä–µ—Å—Å–∏–π)?
