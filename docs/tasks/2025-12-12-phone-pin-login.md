---
template-version: 3.3.0
created: 2025-12-12
updated: 2025-12-12
purpose: –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –≤—Ö–æ–¥–∞ (–∫–ª–∏–µ–Ω—Ç: —Ç–µ–ª–µ—Ñ–æ–Ω+PIN, –∫—É—Ä–∞—Ç–æ—Ä: –ø–∞—Ä–æ–ª—å)
---

# Task: –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –≤—Ö–æ–¥–∞ ‚Äî –ö–ª–∏–µ–Ω—Ç (—Ç–µ–ª–µ—Ñ–æ–Ω + PIN) + –ö—É—Ä–∞—Ç–æ—Ä (–ø–∞—Ä–æ–ª—å)

## üéØ WHY (–ë–∏–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç)

**Problem**: –°–µ–π—á–∞—Å –≤—Ö–æ–¥/–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Ç–µ–ª–µ—Ñ–æ–Ω—É+PIN –∫–∞–∫ –∫
–ø–æ–Ω—è—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π; –∫—É—Ä–∞—Ç–æ—Ä—É –Ω–µ—É–¥–æ–±–Ω–æ –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –ø—Ä—è–º–æ —Å–æ –≤—Ö–æ–¥–Ω–æ–π.

**Impact**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—É—Ç–∞—é—Ç—Å—è (–∫–∞–∫ ¬´–≤–æ–π—Ç–∏¬ª), –∫—É—Ä–∞—Ç–æ—Ä —Ç—Ä–∞—Ç–∏—Ç –≤—Ä–µ–º—è –Ω–∞
–Ω–∞–≤–∏–≥–∞—Ü–∏—é/–ø–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞.

**Value**: –ï–¥–∏–Ω—ã–π —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω —Å –ø–æ–Ω—è—Ç–Ω—ã–º –≤—Ö–æ–¥–æ–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ –±—ã—Å—Ç—Ä—ã–º –≤—Ö–æ–¥–æ–º
–∫—É—Ä–∞—Ç–æ—Ä–∞ + –±—ã—Å—Ç—Ä—ã–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º –∫–ª–∏–µ–Ω—Ç–æ–≤.

---

## ü§ñ Output Preferences

**Workflow**: Explain logic first ‚Üí then implement.

**Code style**: Follow `.github/copilot-instructions.md` (Legacy JS,
Tailwind-first, –±–µ–∑ inline styles, –±–µ–∑ –ø—Ä—è–º–æ–≥–æ `localStorage.setItem` —Ç–∞–º –≥–¥–µ
–µ—Å—Ç—å `U.lsSet` / `HEYS.store`).

---

## ‚úÖ –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è (Assumptions)

| #   | –í–æ–ø—Ä–æ—Å                                | –†–µ—à–µ–Ω–∏–µ                                                                                                                   |
| --- | ------------------------------------- | ------------------------------------------------------------------------------------------------------------------------- |
| 1   | –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—ã?                 | **–¢–æ–ª—å–∫–æ Supabase** (–æ–±–ª–∞–∫–æ). PIN-hash —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ clients.                                                        |
| 2   | –ö—Ä–æ—Å—Å-–¥–µ–≤–∞–π—Å?                         | **–î–∞** ‚Äî –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ —Å –ª—é–±–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.                                                                          |
| 3   | Legacy-–∫–ª–∏–µ–Ω—Ç—ã –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞?          | **–ù–µ—Ç legacy** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –Ω–æ–≤–∞—è. –û–¥–∏–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç (–∞–≤—Ç–æ—Ä) ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è.                              |
| 4   | –û—Ç–∫—É–¥–∞ –∫—É—Ä–∞—Ç–æ—Ä –±–µ—Ä—ë—Ç —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤? | **–¢–æ–ª—å–∫–æ –∏–∑ Supabase** (–æ–±–ª–∞–∫–æ).                                                                                          |
| 5   | –ß—Ç–æ —Ç–∞–∫–æ–µ –∫—É—Ä–∞—Ç–æ—Ä —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏?         | **Supabase auth (email+password)**. –ü–æ–∫–∞ –æ–¥–∏–Ω –∫—É—Ä–∞—Ç–æ—Ä, –Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ.                      |
| 6   | Web Crypto API fallback?              | **–î–æ–±–∞–≤–∏—Ç—å** –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ + graceful degradation.                                                                   |
| 7   | –§–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞?                      | **–ú–∞—Å–∫–∞ `+7 (___) ___-__-__`** ‚Äî —Ç–æ–ª—å–∫–æ –†–§, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.                                                                  |
| 8   | –ö–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω?     | **–¢–æ–ª—å–∫–æ –µ—Å–ª–∏** `heys_client_current` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ò–õ–ò —Å–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. Logout ‚Äî –∫–Ω–æ–ø–∫–∞ –≤ —à–∞–ø–∫–µ.                          |
| 9   | –ö—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∏ PIN?            | **–ö—É—Ä–∞—Ç–æ—Ä** —Å–æ–∑–¥–∞—ë—Ç –∫–ª–∏–µ–Ω—Ç–∞ (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, PIN). **–ù–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**. –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç —Å–º–µ–Ω–∏—Ç—å PIN –ø–æ–∑–∂–µ –≤ –ø—Ä–æ—Ñ–∏–ª–µ. |
| 10  | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞? | **–ß–µ—Ä–µ–∑ –∫—É—Ä–∞—Ç–æ—Ä–∞** ‚Äî –æ–Ω –º–æ–∂–µ—Ç —Å–±—Ä–æ—Å–∏—Ç—å/—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π PIN –∫–ª–∏–µ–Ω—Ç—É.                                                      |

---

## üìå Product Requirements (—á—Ç–æ —Ö–æ—Ç–∏–º –ø–æ–ª—É—á–∏—Ç—å)

### –†–æ–ª–∏

1. **–ö–ª–∏–µ–Ω—Ç**

- –í—Ö–æ–¥–∏—Ç –ø–æ **—Ç–µ–ª–µ—Ñ–æ–Ω—É** + **PIN-–∫–æ–¥—É**, –≤—ã–¥–∞–Ω–Ω–æ–º—É –∫—É—Ä–∞—Ç–æ—Ä–æ–º.
- –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ–±—ã—á–Ω—ã–π –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ä–µ–∂–∏–º (–∫–∞–∫ —Å–µ–π—á–∞—Å, –Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫
  —É—á—ë—Ç–∫–µ –∫–ª–∏–µ–Ω—Ç–∞).
- **–ú–æ–∂–µ—Ç –≤–æ–π—Ç–∏ —Å –ª—é–±–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** (–¥–∞–Ω–Ω—ã–µ –≤ –æ–±–ª–∞–∫–µ).
- **–°–º–µ–Ω–∞ PIN** –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –ø—Ä–æ—Ñ–∏–ª–µ (–±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞).
- **–ù–µ—Ç —Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**.

2. **–ö—É—Ä–∞—Ç–æ—Ä**

- –ù–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –µ—Å—Ç—å —è–≤–Ω–∞—è —Å—Å—ã–ª–∫–∞/–∫–Ω–æ–ø–∫–∞ **¬´–í—Ö–æ–¥ –∫—É—Ä–∞—Ç–æ—Ä–∞¬ª**.
- –ö—É—Ä–∞—Ç–æ—Ä –≤—Ö–æ–¥–∏—Ç **–ø–æ Supabase auth (email+password)**.
- **–ö—É—Ä–∞—Ç–æ—Ä –ù–ï –≤–≤–æ–¥–∏—Ç PIN** ‚Äî –æ–Ω "–±–æ–≥ —Å–∏—Å—Ç–µ–º—ã".
- –ú–æ–∂–µ—Ç **—Å–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞** (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, PIN) –∏ **—Å–±—Ä–æ—Å–∏—Ç—å PIN**
  —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É.
- –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤–∏–¥–∏—Ç **—Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ Supabase** –∏ –º–æ–∂–µ—Ç **–±—ã—Å—Ç—Ä–æ
  –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è** –º–µ–∂–¥—É –Ω–∏–º–∏.

### UX –Ω–∞ –≤—Ö–æ–¥–Ω–æ–º —ç–∫—Ä–∞–Ω–µ

> **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏**: `heys_client_current` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ò–õ–ò —Å–µ—Å—Å–∏—è
> –∏—Å—Ç–µ–∫–ª–∞.

- –≠–∫—Ä–∞–Ω –∑–∞–ø—É—Å–∫–∞ (landing) —Å–æ–¥–µ—Ä–∂–∏—Ç:
  - –ü–æ–ª–µ **–¢–µ–ª–µ—Ñ–æ–Ω** ‚Äî –º–∞—Å–∫–∞ `+7 (___) ___-__-__`, —Ç–æ–ª—å–∫–æ –†–§.
  - –ü–æ–ª–µ **PIN** (4‚Äì6 —Ü–∏—Ñ—Ä; —Å–∫—Ä—ã—Ç–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ; toggle ¬´–ø–æ–∫–∞–∑–∞—Ç—å¬ª –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
  - –ö–Ω–æ–ø–∫–∞ **¬´–í–æ–π—Ç–∏¬ª**.
  - **–ù–µ—Ç –∫–Ω–æ–ø–∫–∏ –ø—É–±–ª–∏—á–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** (–∫–ª–∏–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞—ë—Ç –∫—É—Ä–∞—Ç–æ—Ä).
  - –°—Å—ã–ª–∫–∞ **¬´–í—Ö–æ–¥ –∫—É—Ä–∞—Ç–æ—Ä–∞¬ª** ‚Üí Supabase auth.

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (–∫—É—Ä–∞—Ç–æ—Ä–æ–º)

- –ü–æ—Ç–æ–∫ (—á–µ—Ä–µ–∑ UI –∫—É—Ä–∞—Ç–æ—Ä–∞):
  1. –í–≤–æ–¥ –∏–º–µ–Ω–∏
  2. –í–≤–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–º–∞—Å–∫–∞ `+7 (___) ___-__-__`, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è)
  3. –í–≤–æ–¥ PIN (–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ PIN)
  4. –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ **Supabase** (—Ç–∞–±–ª–∏—Ü–∞ `clients`)
  5. –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç —Å—Ä–∞–∑—É –≤–æ–π—Ç–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É+PIN –Ω–∞ –ª—é–±–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

### –°–º–µ–Ω–∞ PIN –≤ –ø—Ä–æ—Ñ–∏–ª–µ (–∫–ª–∏–µ–Ω—Ç)

- –í –ø—Ä–æ—Ñ–∏–ª–µ –∫–Ω–æ–ø–∫–∞ ¬´–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PIN¬ª (–µ—Å–ª–∏ –Ω–µ—Ç) –∏–ª–∏ ¬´–°–º–µ–Ω–∏—Ç—å PIN¬ª.
- –§–ª–æ—É: –≤–≤–æ–¥ PIN ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Supabase ‚Üí –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  –æ–± —É—Å–ø–µ—Ö–µ.

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π baseline)

- **–ù–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å PIN –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ**.
- PIN —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ **hash + salt** –≤ Supabase (–ø–æ–ª—è `pin_hash`, `pin_salt`).
- –ü—Ä–æ–≤–µ—Ä–∫–∞ PIN: hash( salt + pin ) —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º.
- –í UI: **–µ–¥–∏–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ** (¬´–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ PIN¬ª) ‚Äî –Ω–µ
  —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ–≤–µ—Ä–Ω–æ.
- **Fake delay 500–º—Å** –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ –ª–æ–≥–∏–Ω–∞ ‚Äî –º–∞—Å–∫–∏—Ä—É–µ—Ç timing attack –∏
  enumeration.
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Å—Ç—É—é –∑–∞—â–∏—Ç—É –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞:
  - –ª–æ–∫–∞–ª—å–Ω—ã–π rate limit –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (5 –ø–æ–ø—ã—Ç–æ–∫ ‚Üí –±–ª–æ–∫ 60 —Å–µ–∫)
  - —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff: 1‚Üí2‚Üí4‚Üí8 –º–∏–Ω—É—Ç –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö
- **Web Crypto API**: SHA-256 + salt –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω –¥–ª—è PIN –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç—Ä–µ–∫–µ—Ä–∞
  –ø–∏—Ç–∞–Ω–∏—è.
  - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ + fallback (js-sha256).
  - _Nice to have_: PBKDF2 —Å 10k –∏—Ç–µ—Ä–∞—Ü–∏–π (–µ—Å–ª–∏ –≤—Ä–µ–º—è –ø–æ–∑–≤–æ–ª–∏—Ç).

> **–ö–æ–Ω—Ç–µ–∫—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: HEYS ‚Äî —Ç—Ä–µ–∫–µ—Ä –ø–∏—Ç–∞–Ω–∏—è, –Ω–µ –±–∞–Ω–∫. –£–≥—Ä–æ–∑–∞ "brute-force
> PIN –∫–ª–∏–µ–Ω—Ç–∞ –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–∞" ‚Äî –Ω–∏–∑–∫–∞—è. –¢–µ–∫—É—â–∏–µ –º–µ—Ä—ã –∞–¥–µ–∫–≤–∞—Ç–Ω—ã.

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—Å–µ—Ä–≤–µ—Ä–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ ‚Äî Supabase RLS)

> **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: –≤—Å—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Supabase
> RLS/Functions), –∫–ª–∏–µ–Ω—Ç ‚Äî —Ç–æ–ª—å–∫–æ UI.

| –£–≥—Ä–æ–∑–∞                       | –ó–∞—â–∏—Ç–∞                                                                       |
| ---------------------------- | ---------------------------------------------------------------------------- |
| SQL Injection                | Supabase JS SDK –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏                          |
| PIN enumeration (—É–≥–∞–¥—ã–≤–∞–Ω–∏–µ) | RLS: anon –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ `SELECT ... WHERE phone = $1`, –Ω–µ–ª—å–∑—è `SELECT *`      |
| –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤—Å–µ–π –±–∞–∑—ã         | RLS –ø–æ–ª–∏—Ç–∏–∫–∞: anon –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –ø–æ–∏—Å–∫–æ–º –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–µ–ª–µ—Ñ–æ–Ω—É                 |
| Timing attack                | –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `verify_pin()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è |
| Rate limiting –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ     | _–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ_: `pg_cron` + —Å—á—ë—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ               |

**RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `clients`:**

```sql
-- 1. Anon –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¢–û–õ–¨–ö–û salt –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–¥–ª—è –ª–æ–≥–∏–Ω–∞)
CREATE POLICY "anon_select_salt" ON clients
  FOR SELECT TO anon
  USING (true)
  WITH CHECK (true);
-- –í–ê–ñ–ù–û: —á–µ—Ä–µ–∑ SELECT clause –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è

-- 2. –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ PIN (–∏–∑–±–µ–≥–∞–µ–º timing attack)
CREATE OR REPLACE FUNCTION verify_client_pin(p_phone TEXT, p_pin_hash TEXT)
RETURNS TABLE(id UUID, name TEXT, phone_normalized TEXT) AS $$
BEGIN
  -- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  PERFORM pg_sleep(0.1);

  RETURN QUERY
  SELECT c.id, c.name, c.phone_normalized
  FROM clients c
  WHERE c.phone_normalized = p_phone
    AND c.pin_hash = p_pin_hash;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- 3. Authenticated (–∫—É—Ä–∞—Ç–æ—Ä) –∏–º–µ–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
CREATE POLICY "curator_full_access" ON clients
  FOR ALL TO authenticated
  USING (true)
  WITH CHECK (true);
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (—Ç–æ–ª—å–∫–æ UX, –Ω–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å):**

- –§–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–º–∞—Å–∫–∞)
- –î–ª–∏–Ω–∞ PIN (4-6 —Ü–∏—Ñ—Ä)
- –ù–µ–ø—É—Å—Ç—ã–µ –ø–æ–ª—è

**–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏):**

- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å `phone_normalized` (UNIQUE constraint)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ PIN —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
- Rate limiting (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ pg_cron)

### Logout

- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ —É–∂–µ –µ—Å—Ç—å **–≤ —à–∞–ø–∫–µ** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- –ü—Ä–∏ logout: –æ—á–∏—Å—Ç–∏—Ç—å `heys_client_current` ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω.

---

## üìã WHAT (–ß–µ–∫-–ª–∏—Å—Ç –∑–∞–¥–∞—á)

### Must Have (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ä–µ–ª–∏–∑–∞)

- [x] **Investigate** ‚Äî –Ω–∞–π—Ç–∏ —Ç–µ–∫—É—â–∏–π entry-flow ¬´–≤—Ö–æ–¥/–≤—ã–±–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞/–∫—É—Ä–∞—Ç–æ—Ä¬ª
  - **Acceptance**: –ø–æ–Ω—è—Ç–Ω–æ, –≥–¥–µ —Å–µ–π—á–∞—Å —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–ª–∏–µ–Ω—Ç, –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è
    `heys_client_current`, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –≤—Ö–æ–¥ –∫—É—Ä–∞—Ç–æ—Ä–∞ (Supabase auth)
  - **Likely files**: `apps/web/index.html`, `apps/web/heys_app_v12.js`,
    `apps/web/heys_user_v12.js`, `apps/web/heys_storage_supabase_v1.js`,
    `apps/web/heys_core_v12.js`

- [x] **Supabase schema & RLS** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø
  - **–§–∞–π–ª**: `database/2025-12-12_phone_pin_auth.sql`
  - **Fields**: `phone_normalized` (unique), `pin_hash`, `pin_salt`,
    `pin_updated_at`
  - **RLS Policies**:
    - `public` (anon) –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å
      `SELECT pin_salt FROM clients WHERE phone_normalized = X` (–¥–ª—è –ª–æ–≥–∏–Ω–∞)
    - `public` (anon) –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å
      `SELECT * FROM clients WHERE phone_normalized = X AND pin_hash = Y`
      (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞)
    - `authenticated` (–∫—É—Ä–∞—Ç–æ—Ä) –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –≤—Å—ë (`ALL`)
  - **Acceptance**: –∞–Ω–æ–Ω–∏–º–Ω—ã–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Å–æ–ª—å, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å
    –≤—Å—é –±–∞–∑—É
  - **Files**: `database/*.sql`

- [x] **Auth module** ‚Äî `heys_auth_v1.js`
  - `normalizePhone(input)` ‚Üí `+79991234567`
  - `hashPin(pin, salt)` ‚Üí hash (Web Crypto API + fallback)
  - `generateSalt()` ‚Üí random string
  - `verifyPin(pin, salt, hash)` ‚Üí boolean
  - `loginClient(phone, pin)` ‚Üí client object or error
  - `registerClient(phone, pin, name)` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—É—Ä–∞—Ç–æ—Ä–æ–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
    –∫–ª–∏–µ–Ω—Ç–∞
  - **Acceptance**: unit tests –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

- [x] **Legacy UI** ‚Äî —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω: —Ç–µ–ª–µ—Ñ–æ–Ω + PIN + ¬´–í–æ–π—Ç–∏¬ª + ¬´–í—Ö–æ–¥ –∫—É—Ä–∞—Ç–æ—Ä–∞¬ª
  - **–§–∞–π–ª**: `apps/web/heys_login_screen_v1.js`
  - **Why**: –ø–æ–Ω—è—Ç–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –∏ –∫—É—Ä–∞—Ç–æ—Ä–∞
  - **Acceptance**:
    - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `heys_client_current` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
    - –ø–æ–ª—è –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è (–ø—É—Å—Ç–æ/–∫–æ—Ä–æ—Ç–∫–∏–π PIN/–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω)
    - –º–∞—Å–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ `+7 (___) ___-__-__`
    - –∫–Ω–æ–ø–∫–∞ ¬´–í–æ–π—Ç–∏¬ª –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞, –ø–æ–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ
    - –æ—à–∏–±–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏
    - mobile touch targets ‚â•44px
  - **Files**: `apps/web/index.html`, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç LoginScreen

- [x] **Auth (Client Login)** ‚Äî –ª–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É+PIN
  - **Flow**:
    1. `SELECT pin_salt FROM clients WHERE phone = ...`
    2. `hash = hashPin(inputPin, salt)`
    3. `SELECT * FROM clients WHERE phone = ... AND pin_hash = hash`
  - **Acceptance**:
    - –ø—Ä–∏ —É—Å–ø–µ—Ö–µ: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å `heys_client_current`, –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
    - –ø—Ä–∏ –æ—à–∏–±–∫–µ: ¬´–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ PIN¬ª, –Ω–µ –º–µ–Ω—è—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
    - rate limiting: 5 –ø–æ–ø—ã—Ç–æ–∫ ‚Üí –±–ª–æ–∫ 60 —Å–µ–∫

- [ ] **Profile: Set/Change PIN** ‚Äî —Å–º–µ–Ω–∞ PIN –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ñ–∏–ª—è –∫–ª–∏–µ–Ω—Ç–∞
  - **Acceptance**:
    - –∫–Ω–æ–ø–∫–∞ ¬´–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PIN¬ª (–µ—Å–ª–∏ –Ω–µ—Ç) –∏–ª–∏ ¬´–°–º–µ–Ω–∏—Ç—å PIN¬ª
    - –≤–≤–æ–¥ PIN ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Supabase
    - —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ, –±–µ–∑ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –¥–µ—Ç–∞–ª–µ–π
  - **Files**: `apps/web/heys_user_v12.js`

- [ ] **Curator: —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ (–∏–º—è + —Ç–µ–ª–µ—Ñ–æ–Ω + PIN)**
  - **Acceptance**:
    - —Ñ–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –∫—É—Ä–∞—Ç–æ—Ä—É (–ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞)
    - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (Supabase UNIQUE)
    - PIN —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ hash+salt
    - –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É+PIN
  - **Files**: `apps/web/heys_user_v12.js` –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫—É—Ä–∞—Ç–æ—Ä—Å–∫–∏–π UI

- [ ] **Curator entry** ‚Äî —Å—Å—ã–ª–∫–∞ ¬´–í—Ö–æ–¥ –∫—É—Ä–∞—Ç–æ—Ä–∞¬ª –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π
  - **Acceptance**: –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Supabase auth (email+password), —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫
    —Å–µ–π—á–∞—Å

- [ ] **Curator: —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ + –±—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**
  - **Acceptance**:
    - —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ Supabase (–≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã)
    - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–º–µ–Ω–∏
    - –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/—Ç–µ–ª–µ—Ñ–æ–Ω—É
    - –∫–ª–∏–∫ ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ `heys_client_current` ‚Üí –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä UI
    - —è–≤–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
    - **–∫—É—Ä–∞—Ç–æ—Ä –ù–ï –≤–≤–æ–¥–∏—Ç PIN** ‚Äî –æ–Ω "–±–æ–≥"

- [ ] **Curator: —Å–±—Ä–æ—Å PIN –∫–ª–∏–µ–Ω—Ç—É**
  - **Acceptance**:
    - –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –∫–ª–∏–µ–Ω—Ç–∞ –∫–Ω–æ–ø–∫–∞ ¬´–°–±—Ä–æ—Å–∏—Ç—å PIN¬ª
    - –∫—É—Ä–∞—Ç–æ—Ä –≤–≤–æ–¥–∏—Ç –Ω–æ–≤—ã–π PIN –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
    - PIN —Ö—ç—à–∏—Ä—É–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Supabase
    - –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ —Å –Ω–æ–≤—ã–º PIN

### Should Have (–≤–∞–∂–Ω–æ, –Ω–æ –Ω–µ –±–ª–æ–∫–µ—Ä)

- [ ] **PIN UX** ‚Äî –º–∞—Å–∫–∞ PIN (—Ü–∏—Ñ—Ä—ã), –∫–Ω–æ–ø–∫–∞ ¬´–ø–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å¬ª
  - **Acceptance**: —É–¥–æ–±–Ω–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º, inputmode="numeric"

- [ ] **Phone input UX** ‚Äî –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Ä–µ –≤–≤–æ–¥–∞
  - **Acceptance**: –ø—Ä–∏ –≤–≤–æ–¥–µ `9991234567` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç—Å—è –≤
    `+7 (999) 123-45-67`

- [ ] **Telemetry** ‚Äî –æ—à–∏–±–∫–∏ –ª–æ–≥–∏–Ω–∞/—Å–æ–∑–¥–∞–Ω–∏—è/—Å–±—Ä–æ—Å–∞ PIN —Ç—Ä–µ–∫–∞—Ç—å —á–µ—Ä–µ–∑
      `HEYS.analytics.trackError()` (–±–µ–∑ `console.error` –Ω–∞–ø—Ä—è–º—É—é)

### Could Have (nice to have)

- [ ] **Remember session** ‚Äî ¬´–û—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ¬ª –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (—Ö—Ä–∞–Ω–∏—Ç—å
      —Ç–æ–ª—å–∫–æ clientId, –Ω–µ PIN)
- [ ] **Multiple curators** ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç, UI –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
      –ø–æ–∑–∂–µ

---

## ‚úÖ DONE (–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏)

### Functional

- [ ] –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç: –≤–æ–π—Ç–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É+PIN, –≤—ã–¥–∞–Ω–Ω–æ–º—É –∫—É—Ä–∞—Ç–æ—Ä–æ–º, –∏ –≤–∏–¥–µ—Ç—å —Å–≤–æ–∏
      –¥–∞–Ω–Ω—ã–µ
- [ ] –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç —Å–º–µ–Ω–∏—Ç—å PIN –≤ –ø—Ä–æ—Ñ–∏–ª–µ
- [ ] –ö—É—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç: –≤–æ–π—Ç–∏ –ø–æ Supabase auth ‚Üí —Å–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ ‚Üí –≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫
      –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ –æ–±–ª–∞–∫–∞ ‚Üí –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è ‚Üí —Å–±—Ä–æ—Å–∏—Ç—å PIN –∫–ª–∏–µ–Ω—Ç—É
- [ ] –ö—É—Ä–∞—Ç–æ—Ä –ù–ï –≤–≤–æ–¥–∏—Ç PIN –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞

### Edge cases

- [ ] –¢–µ–ª–µ—Ñ–æ–Ω –≤–≤–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ `+79991234567`
- [ ] –î—É–±–ª–∏–∫–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫—É—Ä–∞—Ç–æ—Ä–æ–º ‚Üí –ø–æ–Ω—è—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ ¬´–≠—Ç–æ—Ç –Ω–æ–º–µ—Ä —É–∂–µ
      –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω¬ª
- [ ] 5+ –Ω–µ–≤–µ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ PIN ‚Üí –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ 60 —Å–µ–∫
- [ ] Web Crypto API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ‚Üí fallback —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Logout ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω

### UI Testing

- [ ] Mobile (iPhone SE): —É–¥–æ–±–Ω–æ –≤–≤–æ–¥–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω/PIN, –∫–Ω–æ–ø–∫–∏ ‚â•44px
- [ ] Desktop: –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ hover/focus —Å–æ—Å—Ç–æ—è–Ω–∏—è
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏

### Quality Gates

- [ ] `pnpm test:all` PASS
- [ ] (–ï—Å–ª–∏ –º–µ–Ω—è–ª—Å—è TS) `pnpm type-check` PASS
- [ ] `pnpm lint` PASS
- [ ] `pnpm build` PASS (–ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º)

---

## ü§ñ AI Context (Technical Specs)

- **Legacy runtime**: `apps/web/` (inline React 18)
- **Storage**: Supabase –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ PIN-hash
- **Auth –∫—É—Ä–∞—Ç–æ—Ä–∞**: Supabase auth (email+password) ‚Äî —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤
  `heys_storage_supabase_v1.js`
- **Storage pattern –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:
  - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `U.lsGet/U.lsSet` (clientId namespace)
  - –Ω–µ –ø–∏—Å–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é `localStorage.setItem` –¥–ª—è –∫–ª—é—á–µ–π –∫–ª–∏–µ–Ω—Ç–∞
- –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å inline styles –≤ JSX; Tailwind first
- –ù–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å legacy JS –≤ TS –±–µ–∑ —è–≤–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

### Supabase Table Schema (clients)

```sql
ALTER TABLE clients ADD COLUMN IF NOT EXISTS phone_normalized TEXT UNIQUE;
ALTER TABLE clients ADD COLUMN IF NOT EXISTS pin_hash TEXT;
ALTER TABLE clients ADD COLUMN IF NOT EXISTS pin_salt TEXT;
ALTER TABLE clients ADD COLUMN IF NOT EXISTS pin_updated_at TIMESTAMPTZ;

-- Index –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
CREATE INDEX IF NOT EXISTS idx_clients_phone ON clients(phone_normalized);
```

### Web Crypto API (hashing)

```javascript
// Preferred: Web Crypto API
async function hashPin(pin, salt) {
  const encoder = new TextEncoder();
  const data = encoder.encode(salt + pin);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  return Array.from(new Uint8Array(hashBuffer))
    .map((b) => b.toString(16).padStart(2, '0'))
    .join('');
}

// Fallback: –µ—Å–ª–∏ crypto.subtle –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
function hashPinFallback(pin, salt) {
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å js-sha256 –∏–ª–∏ –∞–Ω–∞–ª–æ–≥
}
```

### Phone Normalization

```javascript
function normalizePhone(input) {
  // –£–±—Ä–∞—Ç—å –≤—Å—ë –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
  const digits = input.replace(/\D/g, '');

  // –ï—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 8, –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ 7
  if (digits.startsWith('8') && digits.length === 11) {
    return '+7' + digits.slice(1);
  }

  // –ï—Å–ª–∏ 10 —Ü–∏—Ñ—Ä (–±–µ–∑ –∫–æ–¥–∞), –¥–æ–±–∞–≤–∏—Ç—å +7
  if (digits.length === 10) {
    return '+7' + digits;
  }

  // –ï—Å–ª–∏ 11 —Ü–∏—Ñ—Ä –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 7
  if (digits.length === 11 && digits.startsWith('7')) {
    return '+' + digits;
  }

  return null; // invalid
}
```
