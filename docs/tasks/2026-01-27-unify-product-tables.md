---
template-version: 4.0.0
created: 2026-01-27
updated: 2026-01-28
purpose: Task-First prompt ‚Äî —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω)
---

# Task: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤—ã–≤–æ–¥ –ª–∏—á–Ω–æ–π –∏ –æ–±—â–µ–π —Ç–∞–±–ª–∏—Ü –ø—Ä–æ–¥—É–∫—Ç–æ–≤

## üìå TL;DR

**–¶–µ–ª—å**: –ø—Ä–∏–≤–µ—Å—Ç–∏ –æ–±—â—É—é –±–∞–∑—É –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∫ —Ç–æ–º—É –∂–µ —Ñ–æ—Ä–º–∞—Ç—É –≤—ã–≤–æ–¥–∞, —á—Ç–æ –∏ –ª–∏—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞.

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ –±–∞–≥–∞**: Shared-—Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –ë–î –±–µ–∑ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Å **–¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º—É–ª–æ–π –∫–∞–ª–æ—Ä–∏–π** (√ó4 –≤–º–µ—Å—Ç–æ √ó3 –¥–ª—è –±–µ–ª–∫–∞).

**–ü—Ä–∏–º–µ—Ä**: –£—Ä–±–µ—á ‚Äî 680 –∫–∫–∞–ª –≤ –ª–∏—á–Ω–æ–π vs 693 –∫–∫–∞–ª –≤ shared (—Ä–∞–∑–Ω–∏—Ü–∞ = 13–≥ –±–µ–ª–∫–∞ √ó 1 –∫–∫–∞–ª).

**–ü—Ä–∏–Ω—Ü–∏–ø**: ¬´Normalize Once, Render Anywhere¬ª ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –µ–¥–∏–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä.

**–í—Ä–µ–º—è**: 5‚Äì8 —á–∞—Å–æ–≤

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –†–ï–®–ï–ù–ò–Ø (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ)

| –†–µ—à–µ–Ω–∏–µ | –û—Ç–≤–µ—Ç |
|---------|-------|
| **–§–æ—Ä–º—É–ª–∞ –∫–∞–ª–æ—Ä–∏–π** | TEF-aware: `kcal = protein√ó3 + carbs√ó4 + fat√ó9`. SoT = `computeDerivedProduct()` |
| **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç kcal100** | UI —Å—á–∏—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `computeDerived()`, –ë–î –Ω–µ —Ç—Ä–æ–≥–∞–µ–º (soft migration) |
| **NULL-–ø–æ–ª–∏—Ç–∏–∫–∞** | –ë–∞–∑–æ–≤—ã–µ –º–∞–∫—Ä–æ—Å—ã ‚Üí 0; Extended —á–∏—Å–ª–æ–≤—ã–µ ‚Üí ¬´‚Äî¬ª; Boolean ‚Üí —Ç—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è (true/false/null=¬´‚Äî¬ª) |
| **Shared —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | –¢–æ–ª—å–∫–æ –∫—É—Ä–∞—Ç–æ—Ä (`isCurator === true`) |
| **snake_case ‚Üí camelCase** | –ë–î —Ö—Ä–∞–Ω–∏—Ç snake_case, JS –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –≤ camelCase |
| **Backward compatibility** | Feature flag `HEYS.features.unifiedTables` + graceful degradation |
| **Sync –∫–ª–æ–Ω–æ–≤** | –¢–æ–ª—å–∫–æ –±–µ–π–¥–∂ ¬´üîÑ¬ª, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π merge –ù–ï –¥–µ–ª–∞–µ–º |
| **Offline-first** | –ù–µ –≤ scope —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ |
| **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã** | –ü–æ computed –∑–Ω–∞—á–µ–Ω–∏—è–º (–∫–∞–∫ –≤ UI), –Ω–µ –ø–æ raw –∏–∑ –ë–î |
| **Export CSV** | –≠–∫—Å–ø–æ—Ä—Ç normalized –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∫ –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) |
| **–ö—ç—à localStorage** | –ù–µ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ |

---

# üöß –§–ê–ó–ê 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

> **–¶–µ–ª—å**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–Ω–∏–º–∞–µ–º –ø—Ä–æ–±–ª–µ–º—É –Ω–∞ 100% –∏ –Ω–µ —Å–ª–æ–º–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ.
> **–ë–ª–æ–∫–µ—Ä**: –ü–æ–∫–∞ —Ñ–∞–∑–∞ 0 –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞.

## 0.1 –ê—É–¥–∏—Ç —Ñ–æ—Ä–º—É–ª—ã –∫–∞–ª–æ—Ä–∏–π

**–í–æ–ø—Ä–æ—Å**: –§–æ—Ä–º—É–ª–∞ –∫–∞–ª–æ—Ä–∏–π ‚Äî $3$ –∏–ª–∏ $4$ –¥–ª—è –±–µ–ª–∫–∞?

**–û—Ç–≤–µ—Ç**: **TEF-aware $3$ –∫–∫–∞–ª/–≥ –±–µ–ª–∫–∞** ‚Äî –µ–¥–∏–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- [x] `apps/web/heys_models_v1.js` ‚Üí `computeDerivedProduct()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `3`
- [x] `apps/web/heys_core_v12.js:~3208` ‚Üí shared —Ç–∞–±–ª–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `computeDerived()` (inline —Ñ–æ—Ä–º—É–ª–∞ —É–¥–∞–ª–µ–Ω–∞)
- [x] `docs/DATA_MODEL_REFERENCE.md` ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å –∫–æ–¥–æ–º

**–î–µ–π—Å—Ç–≤–∏–µ**: –£–¥–∞–ª–∏—Ç—å inline-—Ä–∞—Å—á—ë—Ç –≤ shared, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `computeDerived()`.

---

## 0.2 –ê—É–¥–∏—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

**–í–æ–ø—Ä–æ—Å**: –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —ç—Ç–∞–ª–æ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞? –ö–∞–∫–∏–µ –ø–æ–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è?

**–û—Ç–≤–µ—Ç**: SoT = `HEYS.models.computeDerivedProduct()`. –õ—é–±—ã–µ —Ä–∞—Å—á—ë—Ç—ã –≤ UI –∑–∞–ø—Ä–µ—â–µ–Ω—ã.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- [x] `heys_cloud_shared_v1.js:67-95` ‚Üí `normalizeSharedProduct()` —Ä–∞—Å—à–∏—Ä–µ–Ω –Ω–∞ extended –ø–æ–ª—è + computeDerived
- [x] `heys_models_v1.js:572-586` ‚Üí `normalizeProductFields()` –ø–æ–∫—Ä—ã–≤–∞–µ—Ç `harm`, `badFat100/goodFat100`

**–î–µ–π—Å—Ç–≤–∏–µ**: –†–∞—Å—à–∏—Ä–∏—Ç—å `normalizeSharedProduct()` –¥–ª—è –≤—Å–µ—Ö 29 extended –ø–æ–ª–µ–π.

---

## 0.3 –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ extended-–ø–æ–ª–µ–π (29 —à—Ç)

**–í–æ–ø—Ä–æ—Å**: –ö–∞–∫–∏–µ –ø–æ–ª—è –≤—Ö–æ–¥—è—Ç –≤ extended?

**–û—Ç–≤–µ—Ç** (–∏–∑ `EXTENDED_NUTRIENT_KEYS`):

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ü–æ–ª—è (snake_case ‚Üí camelCase) |
|-----------|-------------------------------|
| **Omega/Sodium** | `sodium100`, `omega3_100`, `omega6_100` |
| **Computed** | `nutrient_density` ‚Üí `nutrientDensity`, `nova_group` ‚Üí `novaGroup` |
| **–§–ª–∞–≥–∏** | `is_organic` ‚Üí `isOrganic`, `is_whole_grain` ‚Üí `isWholeGrain`, `is_fermented` ‚Üí `isFermented`, `is_raw` ‚Üí `isRaw`, `additives` |
| **–í–∏—Ç–∞–º–∏–Ω—ã (11)** | `vitamin_a/c/d/e/k/b1/b2/b3/b6/b9/b12` ‚Üí `vitaminA/C/D/E/K/B1/B2/B3/B6/B9/B12` |
| **–ú–∏–Ω–µ—Ä–∞–ª—ã (8)** | `calcium/iron/magnesium/phosphorus/potassium/zinc/selenium/iodine` |

**–ï–¥–∏–Ω–∏—Ü—ã**: –º–∞–∫—Ä–æ—Å—ã –≥/100–≥; sodium –º–≥/100–≥; omega –≥/100–≥; vitamins/minerals %DV; NOVA 1‚Äì4; ND 0‚Äì100.

---

## 0.4 Mapping –ø–æ–ª–µ–π DB ‚Üí JS

**–í–æ–ø—Ä–æ—Å**: –ö–∞–∫–æ–π mapping snake_case ‚Üí camelCase?

**–û—Ç–≤–µ—Ç**: –•—Ä–∞–Ω–∏–º –≤ –ë–î snake_case, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤ JS.

| DB (snake_case) | JS (camelCase) | –°—Ç–∞—Ç—É—Å |
|-----------------|----------------|--------|
| `badfat100` | `badFat100` | ‚ö†Ô∏è –ù—É–∂–µ–Ω |
| `goodfat100` | `goodFat100` | ‚ö†Ô∏è –ù—É–∂–µ–Ω |
| `nova_group` | `novaGroup` | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ |
| `nutrient_density` | `nutrientDensity` | ‚ö†Ô∏è –ù—É–∂–µ–Ω |
| `is_organic` | `isOrganic` | ‚ö†Ô∏è –ù—É–∂–µ–Ω |
| `is_whole_grain` | `isWholeGrain` | ‚ö†Ô∏è –ù—É–∂–µ–Ω |
| `is_fermented` | `isFermented` | ‚ö†Ô∏è –ù—É–∂–µ–Ω |
| `is_raw` | `isRaw` | ‚ö†Ô∏è –ù—É–∂–µ–Ω |
| `vitamin_*` | `vitamin*` | ‚ö†Ô∏è –ù—É–∂–µ–Ω |

**–î–µ–π—Å—Ç–≤–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å mapping –≤ `normalizeSharedProduct()`.

---

## 0.5 –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ —Ä–æ–ª–∏

**–í–æ–ø—Ä–æ—Å**: –ö—Ç–æ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å shared? –ì–¥–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è `isCurator`?

**–û—Ç–≤–µ—Ç**: 
- UPDATE/DELETE `shared_products` ‚Äî —Ç–æ–ª—å–∫–æ `admin/curator` —á–µ—Ä–µ–∑ RPC —Å RLS
- –ö–ª–∏–µ–Ω—Ç ‚Äî read-only, –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ `create_pending_product_by_session`
- `isCurator` = `HEYS.auth.isCuratorSession()` (JWT `heys_curator_session` + legacy supabase + fallback `HEYS.cloud.getUser()`)

**–†–æ–ª–∏**: `admin` (–ø–æ–ª–Ω—ã–π), `curator` (shared), `moderator` (–º–æ–¥–µ—Ä–∞—Ü–∏—è), `user` (read-only shared).

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- [x] `heys_bootstrap_v1.js` ‚Üí `heys_curator_token`
- [x] `heys_app_onboarding_v1.js` ‚Üí `HEYS.cloud.role`

**–î–µ–π—Å—Ç–≤–∏–µ**: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `isCurator()` –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.

---

## 0.6 –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ shared ‚Üí personal

**–í–æ–ø—Ä–æ—Å—ã**:
- –ö–∞–∫–æ–µ –ø–æ–ª–µ —Ö—Ä–∞–Ω–∏—Ç —Å–≤—è–∑—å –∫–ª–æ–Ω–∞ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º?
- –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –∏–º—ë–Ω?
- –ö–æ–ø–∏—Ä—É—é—Ç—Å—è –ª–∏ –ø–æ—Ä—Ü–∏–∏?

**–û—Ç–≤–µ—Ç—ã**:
- –ü–æ–ª—è: `shared_origin_id` + `cloned_at` + `shared_updated_at`. –ù–æ–≤—ã—Ö –ø–æ–ª–µ–π –Ω–µ –≤–≤–æ–¥–∏–º.
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –∏–º—ë–Ω: –¥–æ–±–∞–≤–ª—è–µ–º —Å—É—Ñ—Ñ–∏–∫—Å ¬´(–∫–æ–ø–∏—è)¬ª, merge –ø–æ –∏–º–µ–Ω–∏ **–Ω–µ –¥–µ–ª–∞–µ–º**.
- –ü–æ—Ä—Ü–∏–∏: deep-copy –±–µ–∑ —Å—Å—ã–ª–æ–∫.
- –°—Ç–∞—Ä—ã–µ –∫–ª–æ–Ω—ã –±–µ–∑ `shared_origin_id` —Å—á–∏—Ç–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- [x] `heys_core_v12.js` ‚Üí `cloneSharedToPersonal()` –∫–æ–ø–∏—Ä—É–µ—Ç `portions`
- [x] `heys_core_v12.js` ‚Üí `addFromShared()` —Å–æ–∑–¥–∞—ë—Ç –∫–ª–æ–Ω —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º ¬´(–∫–æ–ø–∏—è)¬ª (–±–µ–∑ merge –ø–æ –∏–º–µ–Ω–∏)

---

## 0.7 –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–í–æ–ø—Ä–æ—Å**: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –∫–ª–æ–Ω–∞–º–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ shared?

**–û—Ç–≤–µ—Ç**: 
- `shared_updated_at` —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫–ª–æ–Ω–µ
- –ö–ª–æ–Ω—ã **–Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–µ–π–¥–∂ ¬´üîÑ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –≤ shared¬ª –µ—Å–ª–∏ `shared_updated_at > cloned_at`

---

## 0.8 API –∏ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å

**–í–æ–ø—Ä–æ—Å—ã**:
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏ `get_shared_products` –≤—Å–µ extended –ø–æ–ª—è?
- –ö–∞–∫–æ–π —Ä–∞–∑–º–µ—Ä shared_products?
- –°–µ—Ä–≤–µ—Ä–Ω–∞—è –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è/–ø–æ–∏—Å–∫?

**–û—Ç–≤–µ—Ç—ã**:
- [x] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SELECT –≤ RPC ‚Äî –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å –≤—Å–µ 29 –∫–æ–ª–æ–Ω–æ–∫
- –†–∞–∑–º–µ—Ä: –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º 30k+; UI –æ–±—è–∑–∞–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- –ü–æ–∏—Å–∫ shared ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω—ã–π (`ilike`); –ø–æ–∏—Å–∫ personal ‚Äî –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è: —Å–µ—Ä–≤–µ—Ä–Ω–∞—è `limit/offset`, UI –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –ø–∞—Ä—Ç–∏—è–º–∏ (default 500)

**–§–∞–∫—Ç—ã (–∞—É–¥–∏—Ç)**:
- RPC `get_shared_products` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `p_search`, `p_limit`, `p_offset` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç extended –ø–æ–ª—è (—Å–º. `database/2026-01-18_update_get_shared_products.sql`).
- `HEYS.cloud.getAllSharedProducts()` –≤—ã–∑—ã–≤–∞–µ—Ç RPC —Å `p_limit=500` –∏ `p_offset=0` (–ø–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è).
- –ü–æ–∏—Å–∫ shared –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `YandexAPI.rest('shared_products')` —Å `ilike.name_norm` –∏ `limit`.

---

## 0.9 Backup –∏ rollback

**–í–æ–ø—Ä–æ—Å**: –ö–∞–∫ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è?

**–û—Ç–≤–µ—Ç**:
- [x] –ü–µ—Ä–µ–¥ –ª—é–±–æ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π ‚Äî `pg_dump shared_products`
- [ ] –í—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ `kcal100_old` –¥–ª—è –æ—Ç–∫–∞—Ç–∞
- Downtime –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è: –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –±–∞—Ç—á–∞–º–∏

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç**: `scripts/backup_shared_products.sh` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `PGHOST/PGPORT/PGDATABASE/PGUSER/PGPASSWORD`).

---

## 0.10 –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç-–ø—Ä–æ–¥—É–∫—Ç –≤ shared —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ extended –ø–æ–ª—è–º–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö ‚Äî –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–¥–µ–Ω—Ç–∏—á–Ω—ã
- [ ] –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å
- [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–æ–Ω ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ shared –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- [ ] –ü—Ä–æ–¥—É–∫—Ç –±–µ–∑ extended –ø–æ–ª–µ–π ‚Üí ¬´‚Äî¬ª –≤–µ–∑–¥–µ
- [ ] –ü—Ä–æ–¥—É–∫—Ç —Å NULL –≤ boolean ‚Üí ¬´‚Äî¬ª (–Ω–µ ¬´–Ω–µ—Ç¬ª!)

**Test environment**: –ª–æ–∫–∞–ª—å–Ω—ã–π API (`API_PORT=4001`) –∏–ª–∏ staging –ë–î.

---

## 0.11 üî¥ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö shared_products

**–í–æ–ø—Ä–æ—Å**: –ö–∞–∫ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å 272 –ø—Ä–æ–¥—É–∫—Ç–∞, –≥–¥–µ `kcal100` –ø–æ—Å—á–∏—Ç–∞–Ω–æ –ø–æ —Ñ–æ—Ä–º—É–ª–µ √ó4?

**–ê–Ω–∞–ª–∏–∑ (–≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL)**:
```sql
-- –°–∫–æ–ª—å–∫–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–º–µ—é—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ >5 –∫–∫–∞–ª?
SELECT COUNT(*), 
       AVG(ABS(kcal100 - (protein100*3 + (simple100+complex100)*4 + (badfat100+goodfat100+trans100)*9))) as avg_diff
FROM shared_products 
WHERE kcal100 IS NOT NULL;

-- –ö–∞–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏–∑–º–µ–Ω—è—Ç—Å—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?
SELECT name, protein100, kcal100,
       (protein100*3 + (simple100+complex100)*4 + (badfat100+goodfat100+trans100)*9) as kcal_new,
       kcal100 - (protein100*3 + (simple100+complex100)*4 + (badfat100+goodfat100+trans100)*9) as diff
FROM shared_products
ORDER BY ABS(diff) DESC LIMIT 20;
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è**: **–í–∞—Ä–∏–∞–Ω—Ç B ‚Äî Soft migration**

| –≠—Ç–∞–ø | –î–µ–π—Å—Ç–≤–∏–µ | –†–∏—Å–∫ |
|------|----------|------|
| 1. –°–µ–π—á–∞—Å | UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `computeDerived()`, –ë–î –Ω–µ —Ç—Ä–æ–≥–∞–µ–º | –ù–∏–∑–∫–∏–π |
| 2. –ü–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ | Batch-update `kcal100` –≤ –ë–î –Ω–æ—á—å—é | –°—Ä–µ–¥–Ω–∏–π |
| 3. Fallback | `kcal100_legacy` –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è –æ—Ç–∫–∞—Ç–∞ | ‚Äî |

**–†–µ—à–µ–Ω–∏–µ**: 
- **–ù–ï –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ë–î —Å–µ–π—á–∞—Å** ‚Äî —Ç–æ–ª—å–∫–æ UI
- –î–æ–±–∞–≤–∏—Ç—å `_normalized: true` —Ñ–ª–∞–≥ –∫ –ø—Ä–æ–¥—É–∫—Ç–∞–º –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- –ß–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –ë–î

**SQL-–∞—É–¥–∏—Ç (–≥–æ—Ç–æ–≤–æ –∫–∞–∫ –º–∏–≥—Ä–∞—Ü–∏—è)**:
- [x] –§–∞–π–ª: `database/2026-01-28_shared_products_kcal_audit.sql`
- [x] –î–æ–±–∞–≤–ª—è–µ—Ç `kcal100_legacy` (optional) –∏ view `shared_products_kcal_audit`.
- [x] –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∫ prod –ë–î 2026-01-28.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- [x] SQL-–∞–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø–∏—Å–∞–Ω—ã
- [x] –ü—Ä–æ–¥—É–∫—Ç–æ–≤ —Å diff >10 –∫–∫–∞–ª: N/A (–≤ –ë–î –Ω–µ—Ç `kcal100`)
- [x] –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ: N/A (–≤ –ë–î –Ω–µ—Ç `kcal100`)

**–§–∞–∫—Ç—ã (–∞—É–¥–∏—Ç)**:
- –í `shared_products` –Ω–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ `kcal100`, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ diff –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î.
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ `shared_products`: 286.

---

## 0.12 –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–ª–æ–Ω–æ–≤

**–í–æ–ø—Ä–æ—Å**: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –∫–æ–≥–¥–∞ shared –æ–±–Ω–æ–≤–∏–ª—Å—è, –∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –∫–ª–æ–Ω?

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è MVP**:
1. **–¢–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–µ–π–¥–∂** ‚Äî `üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–æ –≤ –æ–±—â–µ–π –±–∞–∑–µ`
2. **–£—Å–ª–æ–≤–∏–µ –ø–æ–∫–∞–∑–∞**: `shared_updated_at > cloned_at && !user_modified`
3. **–î–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –†—É—á–Ω–æ–π delete + re-clone (–Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π merge)

**–ü–æ—á–µ–º—É –ù–ï –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π merge**:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ –ø–æ—Ä—Ü–∏–∏
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥ —Å–µ–±—è
- –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö > –Ω–µ—É–¥–æ–±—Å—Ç–≤–æ —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–§–∞–∑–∞ 4, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**:
```js
// –í renderProductTableRow() –¥–ª—è personal
{product.shared_origin_id && isOutdated(product) && (
  <span className="badge badge-warning" title="–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å">
    üîÑ
  </span>
)}
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- [x] –ü–æ–ª–µ `shared_updated_at` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ personal products
- [x] –ü–æ–ª–µ `user_modified` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –ë–µ–π–¥–∂ ¬´üîÑ¬ª —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –≤ –ª–∏—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ (renderProductTableRow)

---

## 0.13 Performance baseline

**–í–æ–ø—Ä–æ—Å**: –ö–∞–∫–∞—è —Ç–µ–∫—É—â–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —á—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ?

**–ú–µ—Ç—Ä–∏–∫–∏ –î–û –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∑–∞–º–µ—Ä–∏—Ç—å)**:
- [ ] –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ shared —Ç–∞–±–ª–∏—Ü—ã: _____ ms (Network + Parse + Render)
- [ ] FPS –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ 500 –ø—Ä–æ–¥—É–∫—Ç–æ–≤: _____ fps
- [ ] Memory footprint: _____ MB
- [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ shared_products: _____ —à—Ç

**Lighthouse baseline (localhost:3001, headless)**:
- Performance: 47 / Accessibility: 76 / Best Practices: 100 / SEO: 91
- FCP: 23.09s, LCP: 59.79s, TTI: 57.29s, TTFB: 263ms, CLS: 0.000
- Transfer size: ~8.00 MB, Requests: 231

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: —ç—Ç–æ –æ–±—â–∏–π baseline —Å—Ç—Ä–∞–Ω–∏—Ü—ã; –º–µ—Ç—Ä–∏–∫–∏ —Ç–∞–±–ª–∏—Ü—ã (load/FPS/memory) –≤—Å—ë –µ—â—ë –Ω—É–∂–Ω—ã –≤—Ä—É—á–Ω—É—é –≤ DevTools.

**Acceptance criteria**:
| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ–ø—É—Å—Ç–∏–º–æ | –ö—Ä–∏—Ç–∏—á–Ω–æ |
|---------|-----------|----------|
| –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ | <2s | >5s |
| –°–∫—Ä–æ–ª–ª FPS | >30 | <15 |
| Memory (10k items) | <100MB | >200MB |

**–ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç)**:
1. **–í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è** ‚Äî `react-window` –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã (–æ—Ç–ª–æ–∂–µ–Ω–æ, –Ω–µ –≤ scope)
2. **Lazy extended** ‚Äî –∑–∞–≥—Ä—É–∂–∞—Ç—å vitamins/minerals —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–æ–∫–∏
3. **IndexedDB –∫–µ—à** ‚Äî shared products —Å TTL 24h
4. **Server-side sort/filter** ‚Äî —É–∂–µ –µ—Å—Ç—å, —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ—Ä–∏—Ç—å baseline ‚Üí –µ—Å–ª–∏ OK, –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º. –ï—Å–ª–∏ >2s ‚Äî Lazy extended.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- [ ] Baseline –∑–∞–º–µ—Ä–µ–Ω
- [ ] –†–µ—à–µ–Ω–∏–µ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–Ω—è—Ç–æ: ____________

**–§–∞–∫—Ç—ã (–∞—É–¥–∏—Ç)**:
- Lighthouse baseline —Å–Ω—è—Ç –ª–æ–∫–∞–ª—å–Ω–æ; —Ç–∞–±–ª–∏—Ü–∞ shared —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∑–∞–º–µ—Ä–∞.

---

## 0.14 –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏ Feature Flag

**–í–æ–ø—Ä–æ—Å**: –ö–∞–∫ –Ω–µ —Å–ª–æ–º–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ PWA –≤ –∫–µ—à–µ?

**–†–∏—Å–∫–∏**:
1. Service Worker –∫–µ—à–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—ã–π JS
2. –°—Ç–∞—Ä—ã–π –∫–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç `normalizeSharedProduct()` –±–µ–∑ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
3. IndexedDB —Ö—Ä–∞–Ω–∏—Ç –ø—Ä–æ–¥—É–∫—Ç—ã –≤ —Å—Ç–∞—Ä–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

**–†–µ—à–µ–Ω–∏–µ**: Feature flag + graceful degradation

```js
// –í heys_bootstrap_v1.js
window.HEYS = window.HEYS || {};
HEYS.features = {
  unifiedTables: true,  // –í–∫–ª—é—á–∏—Ç—å –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
  extendedNutrients: true,
};

// –í normalizeSharedProduct()
function normalizeSharedProduct(p) {
  if (!HEYS.features?.unifiedTables) {
    return legacyNormalize(p); // –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞
  }
  // –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞...
}
```

**Service Worker**:
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `sw.js` ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é –≤ `APP_VERSION` –¥–ª—è cache bust
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ critical JS –Ω–µ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞–≤–µ—á–Ω–æ

**Rollback –ø–ª–∞–Ω (5 –º–∏–Ω—É—Ç)**:
1. `HEYS.features.unifiedTables = false` –≤ –∫–æ–Ω—Å–æ–ª–∏
2. Hard refresh (Ctrl+Shift+R)
3. –ï—Å–ª–∏ –º–∞—Å—Å–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞ ‚Üí revert commit + deploy

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- [x] Feature flag –¥–æ–±–∞–≤–ª–µ–Ω
- [ ] Rollback –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ

**–§–∞–∫—Ç—ã (–∞—É–¥–∏—Ç)**:
- `HEYS.features.unifiedTables` –¥–æ–±–∞–≤–ª–µ–Ω (heys_bootstrap_v1.js) + —É—á—Ç—ë–Ω –≤ normalizers.

---

## 0.15 TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è (JSDoc) ‚Äî OPTIONAL

**–°—Ç–∞—Ç—É—Å**: üü° Nice-to-have, –ù–ï –±–ª–æ–∫–µ—Ä

**–í–æ–ø—Ä–æ—Å**: –ù—É–∂–Ω–∞ –ª–∏ —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è?

**–û—Ç–≤–µ—Ç**: –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è MVP. –ß–µ—Ä–µ–∑ **JSDoc** (–±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ .ts).

**–ú–∏–Ω–∏–º—É–º (–¥–æ–±–∞–≤–∏—Ç—å –≤ header —Ñ–∞–π–ª–∞)**:
```js
/**
 * @typedef {Object} NormalizedProduct
 * @property {string} id
 * @property {string} name  
 * @property {number} kcal100
 * @property {number} protein100
 * @property {number} [novaGroup] - 1-4
 * @property {boolean} [_normalized]
 */
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- [ ] –ë–∞–∑–æ–≤—ã–π JSDoc –¥–æ–±–∞–≤–ª–µ–Ω (optional)

---

## 0.16 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Äî –£–ü–†–û–©–Å–ù–ù–´–ô

**–°—Ç–∞—Ç—É—Å**: üü¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –¥–ª—è pre-prod

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã:

```js
// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ (—É–∂–µ –µ—Å—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ)
console.error('[HEYS.shared] –ë–∏—Ç—ã–π –ø—Ä–æ–¥—É–∫—Ç:', p.id, e);

// –ü—Ä–æ—Å—Ç–æ–π timing (–±–µ–∑ performance API)
console.time('shared-table-render');
// ... render
console.timeEnd('shared-table-render');
```

**–†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è (5 –º–∏–Ω)**:
- [ ] –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å ‚Üí –Ω–µ—Ç –∫—Ä–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫
- [ ] `heysStats()` ‚Üí –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [ ] Shared —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è <2s

---

## 0.17 üî¥ –ü—Ä–æ–≤–µ—Ä–∫–∞ API SELECT (BLOCKER)

**–í–æ–ø—Ä–æ—Å**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏ RPC `get_shared_products` –≤—Å–µ 29 extended –ø–æ–ª–µ–π?

**–†–∏—Å–∫**: –ï—Å–ª–∏ API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—è ‚Äî –≤—Å—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –±–µ—Å–ø–æ–ª–µ–∑–Ω–∞.

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
```sql
-- –í PostgreSQL –∏–ª–∏ —á–µ—Ä–µ–∑ API
SELECT column_name FROM information_schema.columns 
WHERE table_name = 'shared_products';

-- –ò–ª–∏ —á–µ—Ä–µ–∑ curl
curl -s -X POST 'https://api.heyslab.ru/rpc?fn=get_shared_products' \
  -H 'Content-Type: application/json' \
  -H 'Origin: https://app.heyslab.ru' \
  -d '{"limit": 1}' | jq 'keys'
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ø–æ–ª—è (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ)**:
- [x] `sodium100` –∏–ª–∏ `sodium_100`
- [x] `nova_group`
- [x] `is_organic`, `is_raw`, `is_fermented`, `is_whole_grain`
- [x] `vitamin_a`, `vitamin_c`, ... (—Ö–æ—Ç—è –±—ã 2-3)
- [x] `calcium`, `iron`, ... (—Ö–æ—Ç—è –±—ã 2-3)

**–ï—Å–ª–∏ –ø–æ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏—é –≤ `yandex-cloud-functions/heys-api-rpc/`
2. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è –≤ SELECT
3. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –¥–æ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏**: OK ‚Äî `get_shared_products` (database/2026-01-18_update_get_shared_products.sql) –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ extended –ø–æ–ª—è.

---

## 0.18 Edge Cases (–≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏)

**–í–æ–ø—Ä–æ—Å**: –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?

| –°–ª—É—á–∞–π | –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ |
|--------|---------------------|
| `protein100 = null`, `kcal100 = 500` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `kcal100` –∏–∑ –ë–î, –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å |
| `protein100 = 50`, `kcal100 = null` | –í—ã—á–∏—Å–ª–∏—Ç—å —á–µ—Ä–µ–∑ `computeDerived()` |
| –í—Å–µ –º–∞–∫—Ä–æ—Å—ã = 0, `kcal100 = 0` | –í–∞–ª–∏–¥–Ω–æ (–≤–æ–¥–∞, —Å–ø–µ—Ü–∏–∏) |
| `protein100 = -5` | Clamp –≤ 0, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å warning |
| `protein100 = 150` | –î–æ–ø—É—Å—Ç–∏–º–æ (–∏–∑–æ–ª—è—Ç), –ù–ï clamp |
| `kcal100 = NaN` | –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —á–µ—Ä–µ–∑ `computeDerived()` |
| –ü—Ä–æ–¥—É–∫—Ç –±–µ–∑ `name` | –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å error |

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
- [ ] –¢–µ—Å—Ç–æ–≤—ã–µ –∫–µ–π—Å—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ 0.10
- [ ] `normalizeSharedProduct()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Å–ª—É—á–∞–∏

**–§–∞–∫—Ç—ã (–∞—É–¥–∏—Ç)**:
- `computeDerivedProduct()` –∏ `normalizeExtendedProduct()` –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç `kcal100` –ø–æ —Ñ–æ—Ä–º—É–ª–µ (–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç –≤—Ö–æ–¥–Ω–æ–π `kcal100`).
- –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è clamp‚Äô—è—Ç—Å—è –¥–æ 0 (–≤ `normalizeExtendedProduct()` —Å warn).
- `normalizeExtendedProduct()` –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø—Ä–æ–¥—É–∫—Ç—ã –±–µ–∑ `name`.
- –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –≤ 0/`null` (base ‚Üí 0, extended ‚Üí null/0).

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –§–∞–∑—ã 0 (–ü–û–õ–ù–´–ô)

### –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- [x] –§–æ—Ä–º—É–ª–∞ –∫–∞–ª–æ—Ä–∏–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ (√ó3 –¥–ª—è –±–µ–ª–∫–∞)
- [x] Inline-—Ä–∞—Å—á—ë—Ç –≤ shared —É–¥–∞–ª—ë–Ω (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è computeDerived)
- [x] –°–ø–∏—Å–æ–∫ 29 extended –ø–æ–ª–µ–π –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω
- [x] Mapping snake_case ‚Üí camelCase –≥–æ—Ç–æ–≤
- [x] `isCurator` –∏—Å—Ç–æ—á–Ω–∏–∫ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω
- [x] Backup –ø–ª–∞–Ω –≥–æ—Ç–æ–≤
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç —Å–æ–∑–¥–∞–Ω

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–ë–õ–û–ö–ï–†–´)
- [x] **0.11 –ú–∏–≥—Ä–∞—Ü–∏—è**: SQL-–∞–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–±—Ä–∞–Ω–∞
- [ ] **0.13 Performance**: Baseline –∑–∞–º–µ—Ä–µ–Ω, —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ
- [ ] **0.14 Feature flag**: –î–æ–±–∞–≤–ª–µ–Ω, rollback –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [x] **0.17 API SELECT**: RPC –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ extended –ø–æ–ª—è ‚Üê **–ö–†–ò–¢–ò–ß–ù–û!**
- [x] **0.18 Edge cases**: –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

### üü° –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- [x] **0.12 –ö–ª–æ–Ω—ã**: –ü–æ–ª—è `shared_updated_at` –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] **0.15 TypeScript**: –ë–∞–∑–æ–≤—ã–π JSDoc –¥–æ–±–∞–≤–ª–µ–Ω (optional)
- [x] **0.16 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: console.error –¥–æ–±–∞–≤–ª–µ–Ω (normalizeSharedProduct)

### –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- [ ] –í—Å–µ üî¥ –ë–õ–û–ö–ï–†–´ –æ—Ç–º–µ—á–µ–Ω—ã
- [ ] –ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –±–µ–∑ –æ—Ç–≤–µ—Ç–∞
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏–¥–µ–Ω—Ç–∏—á–Ω–æ –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

**‚ö†Ô∏è –°–¢–û–ü! –ï—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω üî¥ –ë–õ–û–ö–ï–† –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞.**

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –§–∞–∑–µ 1.

---

## üß™ Smoke Test (–ø–æ—Å–ª–µ –ö–ê–ñ–î–û–ô —Ñ–∞–∑—ã)

> **–í—Ä–µ–º—è**: 5 –º–∏–Ω—É—Ç. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º.

### –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

| # | –ü—Ä–æ–≤–µ—Ä–∫–∞ | –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å | ‚úÖ |
|---|----------|---------------|---|
| 1 | **–õ–∏—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞** | –û—Ç–∫—Ä—ã—Ç—å ProductsTab ‚Üí –ø—Ä–æ–¥—É–∫—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è | ‚òë |
| 2 | **Shared —Ç–∞–±–ª–∏—Ü–∞** | –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ "–û–±—â–∞—è –±–∞–∑–∞" ‚Üí –ø—Ä–æ–¥—É–∫—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è | ‚òë |
| 3 | **–ö–∞–ª–æ—Ä–∏–∏ –£—Ä–±–µ—á** | –ù–∞–π—Ç–∏ "–£—Ä–±–µ—á" ‚Üí –∫–∫–∞–ª = **680** –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö | ‚òë |
| 4 | **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** | Shared ‚Üí "+" ‚Üí –ø–æ—è–≤–∏–ª—Å—è –≤ –ª–∏—á–Ω–æ–π | ‚òë |
| 5 | **–ö–æ–Ω—Å–æ–ª—å —á–∏—Å—Ç–∞—è** | DevTools Console ‚Üí –Ω–µ—Ç –∫—Ä–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫ | ‚òë |
| 6 | **–ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç** | –í–≤–µ—Å—Ç–∏ "—Ç–≤–æ—Ä–æ–≥" ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è | ‚òë |

### –ü—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ —Ç–µ—Å—Ç–∞

1. **–°–¢–û–ü** ‚Äî –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Ñ–∞–∑—É
2. –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git checkout -- <file>`)
3. –ü–æ–Ω—è—Ç—å –ø—Ä–∏—á–∏–Ω—É
4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å
5. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å smoke test

---

# üì¶ –§–ê–ó–ê 1: –†–∞—Å—à–∏—Ä–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é

> **–¶–µ–ª—å**: –í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã (shared –∏ personal) –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ.

## 1.1 –†–∞—Å—à–∏—Ä–∏—Ç—å `normalizeSharedProduct()`

**–§–∞–π–ª**: `apps/web/heys_cloud_shared_v1.js:67-95`

**–ß—Ç–æ –¥–µ–ª–∞–µ–º**:
```js
function normalizeSharedProduct(p) {
  // 1. Case mapping (snake ‚Üí camel)
  const normalized = {
    ...p,
    badFat100: p.badfat100 ?? p.badFat100,
    goodFat100: p.goodfat100 ?? p.goodFat100,
    novaGroup: p.nova_group ?? p.novaGroup,
    nutrientDensity: p.nutrient_density ?? p.nutrientDensity,
    isOrganic: p.is_organic ?? p.isOrganic,
    isWholeGrain: p.is_whole_grain ?? p.isWholeGrain,
    isFermented: p.is_fermented ?? p.isFermented,
    isRaw: p.is_raw ?? p.isRaw,
    // vitamins...
    // minerals...
  };
  
  // 2. Apply computeDerived –¥–ª—è kcal/carbs/fat
  return HEYS.models.computeDerivedProduct(normalized);
}
```

**Acceptance**: 
- [x] –í—Å–µ 29 extended –ø–æ–ª–µ–π –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [x] `kcal100` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `computeDerived()` (fallback –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

---

## 1.2 Defensive-normalize

**–ß—Ç–æ –¥–µ–ª–∞–µ–º**: try/catch –≤–Ω—É—Ç—Ä–∏ `.map()` ‚Äî –±–∏—Ç—ã–π –ø—Ä–æ–¥—É–∫—Ç –Ω–µ –ª–æ–º–∞–µ—Ç –º–∞—Å—Å–∏–≤.

```js
products.map(p => {
  try {
    return normalizeSharedProduct(p);
  } catch (e) {
    console.error('[HEYS.shared] –ë–∏—Ç—ã–π –ø—Ä–æ–¥—É–∫—Ç:', p.id, e);
    return null;
  }
}).filter(Boolean);
```

**Acceptance**: 
- [x] –ë–∏—Ç—ã–µ –∑–∞–ø–∏—Å–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è
- [x] UI –Ω–µ –ø–∞–¥–∞–µ—Ç

---

## 1.3 –í–≤–µ—Å—Ç–∏ `normalizePersonalProduct()`

**–§–∞–π–ª**: `apps/web/heys_core_v12.js` (–≤ `loadProducts()`)

**–ó–∞—á–µ–º**: –õ–∏—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã —Ç–æ–∂–µ –º–æ–≥—É—Ç –±—ã—Ç—å legacy/–±–∏—Ç—ã–º–∏.

**Acceptance**: 
- [x] Personal –∏ shared –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É
- [x] Legacy –ø—Ä–æ–¥—É–∫—Ç—ã –±–µ–∑ extended –ø–æ–ª–µ–π ‚Üí `null` (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º ¬´‚Äî¬ª)

---

## 1.4 –ü—Ä–∏–º–µ–Ω–∏—Ç—å `computeDerived()` –∫ shared

**–í–æ–ø—Ä–æ—Å**: –ö–æ–≥–¥–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å `kcal100`?

**–û—Ç–≤–µ—Ç**: 
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: –µ—Å–ª–∏ `kcal100` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ `null` ‚Üí –≤—ã—á–∏—Å–ª—è–µ–º
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏/–ø—É–±–ª–∏–∫–∞—Ü–∏–∏: –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è: –Ω–µ —Ç—Ä–æ–≥–∞–µ–º

**Acceptance**: 
- [x] Shared –∫–∞–ª–æ—Ä–∏–∏ = –ª–∏—á–Ω—ã–µ –∫–∞–ª–æ—Ä–∏–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞

---

## 1.5 –ú—è–≥–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–í–æ–ø—Ä–æ—Å**: –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å `protein100 > 100` –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏?

**–û—Ç–≤–µ—Ç**:
- `< 0` ‚Üí clamp –≤ 0
- `> 100` ‚Üí –¥–æ–ø—É—Å—Ç–∏–º–æ (–±—ã–≤–∞—é—Ç –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç—ã), –Ω–æ –ª–æ–≥–∏—Ä—É–µ–º warning
- `> 1000` ‚Üí warning
- `NaN` ‚Üí fallback 0

**Acceptance**: 
- [ ] UI –Ω–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –§–∞–∑—ã 1

- [x] `normalizeSharedProduct()` —Ä–∞—Å—à–∏—Ä–µ–Ω
- [x] `normalizePersonalProduct()` —Å–æ–∑–¥–∞–Ω
- [x] `computeDerived()` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ shared
- [x] Defensive-normalize —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –¢–µ—Å—Ç: –£—Ä–±–µ—á –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 680 –∫–∫–∞–ª –≤ shared

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –§–∞–∑–µ 2.

---

# üé® –§–ê–ó–ê 2: –ï–¥–∏–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä —Å—Ç—Ä–æ–∫–∏

> **–¶–µ–ª—å**: –û–¥–∏–Ω –∫–æ–¥ —Ä–µ–Ω–¥–µ—Ä–∞ –¥–ª—è –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü.

## 2.1 –°–æ–∑–¥–∞—Ç—å `renderProductTableRow()`

**–§–∞–π–ª**: `apps/web/heys_core_v12.js`

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞**:
```js
function renderProductTableRow(product, options) {
  // options: { mode: 'personal'|'shared', isCurator, onEdit, onDelete, ... }
}
```

**–í–æ–ø—Ä–æ—Å**: –°–∫–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ?

**–û—Ç–≤–µ—Ç**: 44 –∫–æ–ª–æ–Ω–∫–∏ (–≤–∫–ª—é—á–∞—è actions). –î–µ—Ñ–æ–ª—Ç = –ò–º—è, –ö–∫–∞–ª, –ë/–ñ/–£, –ì–ò, Harm, NOVA.

---

## 2.2 –ó–∞–º–µ–Ω–∏—Ç—å inline-—Ä–µ–Ω–¥–µ—Ä –≤ –ª–∏—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ

**–§–∞–π–ª**: `apps/web/heys_core_v12.js:2900-3000`

**Acceptance**: 
- [x] –õ–∏—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- [x] –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π

---

## 2.3 –ó–∞–º–µ–Ω–∏—Ç—å inline-—Ä–µ–Ω–¥–µ—Ä –≤ shared —Ç–∞–±–ª–∏—Ü–µ

**–§–∞–π–ª**: `apps/web/heys_core_v12.js:3100-3300`

**–ö—Ä–∏—Ç–∏—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π `safeNum()` –∏ inline-—Ä–∞—Å—á—ë—Ç –∫–∞–ª–æ—Ä–∏–π.

**Acceptance**: 
- [x] Shared —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- [x] Inline-—Ñ–æ—Ä–º—É–ª–∞ √ó4 —É–¥–∞–ª–µ–Ω–∞

---

## 2.4 –ì–µ–π—Ç–∏–Ω–≥ –¥–µ–π—Å—Ç–≤–∏–π –≤ shared

**–í–æ–ø—Ä–æ—Å**: –ö—Ç–æ –≤–∏–¥–∏—Ç –∫–Ω–æ–ø–∫–∏ edit/delete –≤ shared?

**–û—Ç–≤–µ—Ç**: –¢–æ–ª—å–∫–æ `isCurator === true`.

```js
{options.mode === 'shared' && !options.isCurator ? null : (
  <button onClick={options.onEdit}>‚úèÔ∏è</button>
)}
```

**Acceptance**: 
- [x] –ö–ª–∏–µ–Ω—Ç –Ω–µ –≤–∏–¥–∏—Ç edit/delete –≤ shared
- [x] –ö—É—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç –≤—Å–µ –∫–Ω–æ–ø–∫–∏

---

## 2.5 –†–µ–Ω–¥–µ—Ä NULL/extended

**–í–æ–ø—Ä–æ—Å**: –ö–∞–∫ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å NULL –≤ extended –ø–æ–ª—è—Ö?

**–û—Ç–≤–µ—Ç**:
- Extended —á–∏—Å–ª–æ–≤—ã–µ: `null/undefined ‚Üí '‚Äî'`
- Extended boolean: `null ‚Üí '‚Äî'`, `true ‚Üí '–¥–∞'`, `false ‚Üí '–Ω–µ—Ç'`

```js
const renderValue = (val, type) => {
  if (val === null || val === undefined) return '‚Äî';
  if (type === 'boolean') return val ? '–¥–∞' : '–Ω–µ—Ç';
  return val;
};
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –§–∞–∑—ã 2

- [x] `renderProductTableRow()` —Å–æ–∑–¥–∞–Ω
- [x] –õ–∏—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
- [x] Shared —Ç–∞–±–ª–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
- [x] Inline-—Ñ–æ—Ä–º—É–ª–∞ —É–¥–∞–ª–µ–Ω–∞
- [x] –ì–µ–π—Ç–∏–Ω–≥ edit/delete —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] NULL ‚Üí ¬´‚Äî¬ª –≤–µ–∑–¥–µ

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –§–∞–∑–µ 3.

---

# üßπ –§–ê–ó–ê 3: –û—á–∏—Å—Ç–∫–∞

> **–¶–µ–ª—å**: –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.

## 3.1 –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥

- [x] –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ `safeNum()` –≤ shared-—Ä–µ–Ω–¥–µ—Ä–µ
- [x] –£–¥–∞–ª–∏—Ç—å inline-—Ä–∞—Å—á—ë—Ç—ã –∫–∞–ª–æ—Ä–∏–π
- [x] –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ mapping-–ª–æ–≥–∏–∫–∏

---

## 3.2 –î–æ–±–∞–≤–∏—Ç—å JSDoc

**–§–∞–π–ª**: `apps/web/heys_cloud_shared_v1.js`

```js
/**
 * @architecture "Normalize Once, Render Anywhere"
 * - –í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
 * - –†–µ–Ω–¥–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–æ—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
 * - –õ–∏—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ = —ç—Ç–∞–ª–æ–Ω —Ñ–æ—Ä–º–∞—Ç–∞
 * - SoT —Ñ–æ—Ä–º—É–ª—ã = computeDerivedProduct()
 */
```

---

## 3.3 –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

- [x] `docs/DATA_MODEL_REFERENCE.md` ‚Üí —Ñ–æ—Ä–º—É–ª–∞ –∫–∞–ª–æ—Ä–∏–π = √ó3 –¥–ª—è –±–µ–ª–∫–∞
- [x] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –¥—Ä—É–≥–∏–º–∏ –¥–æ–∫–∞–º–∏

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –§–∞–∑—ã 3

- [x] –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥ —É–¥–∞–ª—ë–Ω
- [x] JSDoc –¥–æ–±–∞–≤–ª–µ–Ω
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞

---

# ‚ú® –§–ê–ó–ê 4: UX —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

> **–¶–µ–ª—å**: –£–ª—É—á—à–∏—Ç—å —é–∑–∞–±–∏–ª–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü.

## 4.1 Column toggle

**–ó–∞—á–µ–º**: 44 –∫–æ–ª–æ–Ω–∫–∏ ‚Äî UX-–∫–æ—à–º–∞—Ä –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö.

**–ü—Ä–µ—Å–µ—Ç—ã**:
- `basic`: –ò–º—è, –ö–∫–∞–ª, –ë/–ñ/–£, –ì–ò, Harm
- `extended`: + NOVA, Na, Œ©3/Œ©6, ND
- `full`: –≤—Å–µ 44

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: `localStorage: heys_product_table_view`

---

## 4.2 Sticky –∫–æ–ª–æ–Ω–∫–∏

**–ß—Ç–æ**: –ù–∞–∑–≤–∞–Ω–∏–µ + Actions sticky –ø—Ä–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º —Å–∫—Ä–æ–ª–ª–µ.

---

## 4.3 Diff-highlighting –¥–ª—è –∫–ª–æ–Ω–æ–≤

**–ß—Ç–æ**: –ë–µ–π–¥–∂ ¬´üîÑ¬ª –µ—Å–ª–∏ `shared_updated_at > cloned_at`.

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ**: –¢–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–æ–Ω–æ–≤ (—Å–æ `shared_origin_id`).

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `renderProductTableRow()` (–ª–∏—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞).

---

# ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–Å–ú–ö–ò (DONE)

## Functional

- [ ] ¬´–£—Ä–±–µ—á¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **680 –∫–∫–∞–ª** –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- [ ] Extended nutrients (Na, Œ©3, Œ©6, NOVA, ND, –≤–∏—Ç–∞–º–∏–Ω—ã) –∏–¥–µ–Ω—Ç–∏—á–Ω—ã
- [ ] –§–ª–∞–≥–∏: `is_raw = true` ‚Üí ¬´–¥–∞¬ª –≤ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- [ ] NULL ‚Üí ¬´‚Äî¬ª –≤–µ–∑–¥–µ
- [ ] `cloneSharedToPersonal()` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Shared edit/delete –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∫—É—Ä–∞—Ç–æ—Ä—É

## Technical

- [ ] `pnpm type-check` PASS
- [ ] `pnpm lint` PASS
- [ ] `pnpm build` PASS
- [ ] –ù–µ—Ç console.error –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- [ ] –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –≤ –ª–∏—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ

---

# üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|-----------|
| `apps/web/heys_cloud_shared_v1.js` | `normalizeSharedProduct()` + computeDerived |
| `apps/web/heys_core_v12.js` | `renderProductTableRow()` + —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è |
| `apps/web/heys_models_v1.js` | –í–æ–∑–º–æ–∂–Ω–æ: —Ä–∞—Å—à–∏—Ä–∏—Ç—å `normalizeProductFields()` |

---

# üìù Meta

- **Priority**: high
- **Complexity**: M-L
- **Risk**: 
  - –ü–æ–ª–æ–º–∫–∞ `cloneSharedToPersonal()` ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã
  - –†–µ–≥—Ä–µ—Å—Å–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
  - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ –≤ Service Worker
- **Created**: 2026-01-27
- **Updated**: 2026-01-28

## ‚ùó –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

**–§–∞–∑–∞ 4** ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏.

---

## üìä Out of Scope (–æ—Ç–ª–æ–∂–µ–Ω–æ)

| –§–∏—á–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –ö–æ–≥–¥–∞ |
|------|---------|-------|
| Offline-first –¥–ª—è shared | –û—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ | Q2 2026 |
| –ò–º–ø–æ—Ä—Ç –∏–∑ FatSecret/MFP | –ù–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ | Backlog |
| Barcode scanner | –ü–æ–ª—è —É–∂–µ –µ—Å—Ç—å, UI –æ—Ç–ª–æ–∂–µ–Ω | v2 |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π merge –∫–ª–æ–Ω–æ–≤ | –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö | –ù–∏–∫–æ–≥–¥–∞ |
| Virtual scrolling | –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ performance <30fps | –ü–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ |
