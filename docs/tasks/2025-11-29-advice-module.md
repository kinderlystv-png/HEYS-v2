# ğŸ§  HEYS Advice Module â€” Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒĞ¼Ğ½Ñ‹Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²

> **Ğ¦ĞµĞ»ÑŒ**: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ², ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ’Ğ¡Ğ• Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¹.

## âš ï¸ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ• ĞŸĞ Ğ•Ğ”Ğ£Ğ¡Ğ›ĞĞ’Ğ˜Ğ•

**Ğ¡ĞĞĞ§ĞĞ›Ğ** Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ [2025-11-28-smart-toast-recommendations.md](./2025-11-28-smart-toast-recommendations.md):
- Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ±Ğ°Ğ³ `dayTot.protein` â†’ `dayTot.prot` (ÑÑ‚Ñ€Ğ¾ĞºĞ° 2654 Ğ² heys_day_v12.js)
- Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ±Ğ°Ğ³ `normAbs.protein` â†’ `normAbs.prot`
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ CSS Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² toast

**ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°**: ĞŸĞ¾ÑĞ»Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ° ÑƒĞ±ĞµĞ´Ğ¸ÑÑŒ Ñ‡Ñ‚Ğ¾ Ğ² `heys_day_v12.js`:
```javascript
const proteinPct = (dayTot.prot || 0) / (normAbs.prot || 1);  // ĞĞ• protein!
```

### ğŸ”´ Ğ•Ğ¡Ğ›Ğ˜ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚ ĞĞ• Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½:
ĞŸĞµÑ€ĞµĞ´ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾Ğ¼ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²ÑŒ Ğ±Ğ°Ğ³ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ:
```javascript
// Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° 2654 â€” Ğ‘Ğ«Ğ›Ğ:
const proteinPct = (dayTot.protein || 0) / (normAbs.protein || 1);

// Ğ¡Ğ¢ĞĞ›Ğ:
const proteinPct = (dayTot.prot || 0) / (normAbs.prot || 1);

// Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° 2698 â€” Ğ‘Ğ«Ğ›Ğ (Ğ² dependencies):
}, [dayTot.protein, dayTot.fat, ... normAbs.protein, normAbs.fat, ...]);

// Ğ¡Ğ¢ĞĞ›Ğ:
}, [dayTot.prot, dayTot.fat, ... normAbs.prot, normAbs.fat, ...]);
```

---

ğŸ“Š **[DATA_MODEL_REFERENCE.md](../DATA_MODEL_REFERENCE.md)** â€” ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ²ÑĞµÑ… Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ² (dayTot, normAbs, Product, Meal, Training Ğ¸ Ğ´Ñ€.)

---

## âš ï¸ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ• Ğ—ĞĞœĞ•Ğ§ĞĞĞ˜Ğ¯ Ğ”Ğ›Ğ¯ Ğ Ğ•ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ˜

### Z-index Ğ¸ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
- **Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ toast**: `z-index: 1000`, `bottom: 80px`
- **ĞœĞ¾Ğ´Ğ°Ğ»ĞºĞ¸** (time-picker, deficit-picker): Ğ¿ĞµÑ€ĞµĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‚ Ğ²ÑÑ‘
- **Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**: ĞĞ• Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ fixed. Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ expandable toast â€” ĞºĞ»Ğ¸Ğº Ğ½Ğ° toast Ñ€Ğ°ÑĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ’ĞĞ£Ğ¢Ğ Ğ˜ Ñ‚Ğ¾Ğ³Ğ¾ Ğ¶Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ°

### Side effects Ğ² useMemo â€” Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ!
```javascript
// âŒ ĞĞ•Ğ›Ğ¬Ğ—Ğ¯ (Ğ² Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾):
onShow: () => sessionStorage.setItem('heys_streak7', '1')

// âœ… ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ â€” Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ onShow Ğ² useEffect Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğµ:
useEffect(() => {
  if (primary?.onShow) primary.onShow();
}, [primary?.id]);
```

### ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²
Ğ’ `index.html` Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞŸĞ•Ğ Ğ•Ğ” `heys_day_v12.js` (Ğ½Ğ°Ğ¹Ñ‚Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºÑƒ Ñ `heys_day_v12.js` Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞŸĞ•Ğ Ğ•Ğ” Ğ½ĞµĞ¹):
```html
<script defer src="heys_advice_v1.js?v=1" fetchpriority="low"></script>
```

### Defensive programming
```javascript
// Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞ¹ Ğ½Ğ° undefined:
const advices = allAdvices || [];
const meals = day?.meals || [];
```

### fmtDate fallback
```javascript
// Inline Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ window.fmtDate:
const formatDate = (d) => {
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth() + 1).padStart(2, '0');
  const dd = String(d.getDate()).padStart(2, '0');
  return `${yyyy}-${mm}-${dd}`;
};
```

### ğŸ§  Smart Timing â€” Ğ£Ğ¼Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° (Deep Psychology Edition)

**ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ Ğ¸Ğ´ĞµÑ**: Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ **Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğ¸Ñ… Ğ²Ğ¾ÑĞ¿Ñ€Ğ¸Ğ½ÑÑ‚ÑŒ** Ğ¸ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¾Ğ½Ğ¸ **Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ñ‹**.

---

#### ğŸŒ… Ğ¦Ğ¸Ñ€ĞºĞ°Ğ´Ğ½Ñ‹Ğµ Ñ€Ğ¸Ñ‚Ğ¼Ñ‹ â€” Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ´ Ğ²Ñ€ĞµĞ¼Ñ ÑÑƒÑ‚Ğ¾Ğº

| Ğ’Ñ€ĞµĞ¼Ñ | Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ | ĞšĞ°ĞºĞ¸Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ | Ğ¢Ğ¾Ğ½ |
|-------|------------------------|--------------|-----|
| 6:00-9:00 | ĞŸÑ€Ğ¾ÑÑ‹Ğ¿Ğ°ĞµÑ‚ÑÑ, Ğ½Ğ¸Ğ·ĞºĞ°Ñ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ | ĞœÑĞ³ĞºĞ°Ñ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ | "Ğ”Ğ¾Ğ±Ñ€Ğ¾Ğµ ÑƒÑ‚Ñ€Ğ¾! ĞĞ°Ñ‡Ğ½Ğ¸ Ğ´ĞµĞ½ÑŒ Ñ..." |
| 9:00-12:00 | ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½, Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ | ĞšĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ | Ğ”ĞµĞ»Ğ¾Ğ²Ğ¾Ğ¹, Ñ‡Ñ‘Ñ‚ĞºĞ¸Ğ¹ |
| 12:00-14:00 | ĞĞ±ĞµĞ´, ÑĞ¿ĞµÑˆĞ¸Ñ‚ | ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 2-3 ÑĞ»Ğ¾Ğ²Ğ° | "Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ±ĞµĞ»ĞºĞ° ğŸ’ª" |
| 14:00-17:00 | "Ğ¡Ğ°Ñ…Ğ°Ñ€Ğ½Ğ°Ñ ÑĞ¼Ğ°", ÑĞ¿Ğ°Ğ´ | ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¾ ÑĞ»Ğ°Ğ´ĞºĞ¾Ğ¼ | Ğ—Ğ°Ğ±Ğ¾Ñ‚Ğ»Ğ¸Ğ²Ñ‹Ğ¹ |
| 17:00-20:00 | Ğ£ÑÑ‚Ğ°Ğ»Ğ¾ÑÑ‚ÑŒ, Ğ´Ğ¾Ğ¼Ğ¾Ğ¹ | Ğ˜Ñ‚Ğ¾Ğ³Ğ¸ Ğ´Ğ½Ñ, Ñ‡Ñ‚Ğ¾ Ğ´Ğ¾ĞµÑÑ‚ÑŒ | ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‰Ğ¸Ğ¹ |
| 20:00-23:00 | Ğ Ğ°ÑÑĞ»Ğ°Ğ±Ğ»ĞµĞ½, Ñ€ĞµÑ„Ğ»ĞµĞºÑĞ¸Ñ | ĞŸĞ¾Ñ…Ğ²Ğ°Ğ»Ğ°, Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ | Ğ¢Ñ‘Ğ¿Ğ»Ñ‹Ğ¹, Ñ…Ğ²Ğ°Ğ»ÑÑ‰Ğ¸Ğ¹ |
| 23:00-6:00 | **ĞĞ• Ğ‘Ğ•Ğ¡ĞŸĞĞšĞĞ˜Ğ¢Ğ¬!** | ĞĞ˜ĞšĞĞšĞ˜Ğ¥ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² | â€” |

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**
```javascript
function getToneForHour(hour) {
  if (hour >= 23 || hour < 6) return 'silent';
  if (hour < 9) return 'gentle';
  if (hour < 12) return 'business';
  if (hour < 14) return 'brief';
  if (hour < 17) return 'caring';
  if (hour < 20) return 'supportive';
  return 'warm';
}
```

---

#### ğŸ˜Š Ğ­Ğ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚ â€” Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ´ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ

| Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ | ĞšĞ°Ğº Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ | Ğ ĞµĞ°ĞºÑ†Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ |
|-----------|----------------|-----------------|
| **Ğ¡Ñ‚Ñ€ĞµÑÑ** | mood < 3 Ğ² Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ñ… | Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°, Ğ±ĞµĞ· ĞºÑ€Ğ¸Ñ‚Ğ¸ĞºĞ¸ |
| **Ğ¡Ñ€Ñ‹Ğ²** | kcalPct > 1.5 Ñ€ĞµĞ·ĞºĞ¾ | "Ğ‘Ñ‹Ğ²Ğ°ĞµÑ‚! Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ° Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ ğŸ’™" |
| **Ğ£ÑĞ¿ĞµÑ…** | streak >= 3 | ĞŸÑ€Ğ°Ğ·Ğ´Ğ½Ğ¾Ğ²Ğ°Ñ‚ÑŒ! Confetti! |
| **Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ** | lastVisit > 2 Ğ´Ğ½ĞµĞ¹ | "Ğ Ğ°Ğ´Ñ‹ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ! ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ğ¼?" |
| **ĞĞ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº** | totalDays < 3 | Onboarding ÑĞ¾Ğ²ĞµÑ‚Ñ‹ |
| **Ğ£Ğ´Ğ°Ğ»Ğ¸Ğ» Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚** | action === 'delete' | ĞœĞ¾Ğ»Ñ‡Ğ¸Ğ¼ (Ğ½Ğµ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼) |

**ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ¾**: Ğ•ÑĞ»Ğ¸ `mood < 3` Ğ¸Ğ»Ğ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ñ‚Ğ¾ Ğ±Ñ‹Ğ» ÑÑ€Ñ‹Ğ² â€” **ĞĞ• Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ warning**, Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ `achievement` Ğ¸ `tip`.

---

#### ğŸ”„ ĞŸĞ¾Ğ²ĞµĞ´ĞµĞ½Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ â€” Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ·Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºĞ¸ Ğ¸ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ:

| ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ | ĞšĞ°Ğº Ñ€Ğ°ÑĞ¿Ğ¾Ğ·Ğ½Ğ°Ñ‚ÑŒ | ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞ¾Ğ²ĞµÑ‚ |
|---------|----------------|---------------------------|
| **"Ğ—Ğ°Ğ±Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº"** | 5+ Ğ´Ğ½ĞµĞ¹ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ Ğ¿Ğ¾ÑĞ»Ğµ 11:00 | "Ğ—Ğ°Ğ¼ĞµÑ‡Ğ°Ñ, Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ..." |
| **"Ğ’ĞµÑ‡ĞµÑ€Ğ½Ğ¸Ğ¹ ĞµĞ´Ğ¾Ğº"** | >60% ĞºĞºĞ°Ğ» Ğ¿Ğ¾ÑĞ»Ğµ 18:00 Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾ | "ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ÑĞ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸ Ğ½Ğ° Ğ´ĞµĞ½ÑŒ" |
| **"Ğ¡Ğ»Ğ°Ğ´ĞºĞ¾ĞµĞ¶ĞºĞ°"** | simplePct > 40% Ğ½ĞµĞ´ĞµĞ»Ñ | "Ğ”Ğ°Ğ²Ğ°Ğ¹ Ğ½Ğ°Ğ¹Ğ´Ñ‘Ğ¼ Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ñƒ ÑĞ»Ğ°Ğ´ĞºĞ¾Ğ¼Ñƒ?" |
| **"Ğ‘ĞµĞ»ĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚"** | proteinPct < 50% Ğ½ĞµĞ´ĞµĞ»Ñ | "Ğ‘ĞµĞ»Ğ¾Ğº â€” Ñ‚Ğ²Ğ¾Ñ Ğ·Ğ¾Ğ½Ğ° Ñ€Ğ¾ÑÑ‚Ğ° ğŸ’ª" |
| **"ĞŸĞµÑ€Ñ„ĞµĞºÑ†Ğ¸Ğ¾Ğ½Ğ¸ÑÑ‚"** | Ğ’ÑĞµĞ³Ğ´Ğ° 95-105% | "Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾! ĞœĞ¾Ğ¶ĞµÑˆÑŒ Ğ¸Ğ½Ğ¾Ğ³Ğ´Ğ° Ñ€Ğ°ÑÑĞ»Ğ°Ğ±Ğ¸Ñ‚ÑŒÑÑ" |
| **"Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ = ÑÑ€Ñ‹Ğ²"** | Ğ¡Ğ±-Ğ’Ñ Ğ¿ĞµÑ€ĞµĞ±Ğ¾Ñ€, ĞŸĞ½-ĞŸÑ‚ Ğ½Ğ¾Ñ€Ğ¼Ğ° | Ğ’ Ğ¿ÑÑ‚Ğ½Ğ¸Ñ†Ñƒ: "Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ â€” Ğ¿Ğ¾Ğ¼Ğ½Ğ¸ Ğ¾ Ñ†ĞµĞ»ÑÑ…!" |

---

#### ğŸš« ĞšĞ¾Ğ³Ğ´Ğ° ĞĞ• Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ â€” ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ·Ğ°Ğ½ÑÑ‚Ğ¾ÑÑ‚Ğ¸

| Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ UI | ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ? | ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° |
|--------------|-------------|---------|
| ĞÑ‚ĞºÑ€Ñ‹Ñ‚ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² | âŒ | ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ½ÑÑ‚ |
| Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ | âŒ | Ğ¤Ğ¾ĞºÑƒÑ Ğ½Ğ° Ğ²Ğ²Ğ¾Ğ´Ğµ |
| Ğ›ÑĞ±Ğ°Ñ Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºĞ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ° | âŒ | Ğ‘Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ |
| Ğ¡ĞºÑ€Ğ¾Ğ»Ğ»Ğ¸Ñ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº | âŒ | Ğ˜Ğ·ÑƒÑ‡Ğ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ |
| Idle 3+ ÑĞµĞºÑƒĞ½Ğ´ | âœ… | Ğ“Ğ¾Ñ‚Ğ¾Ğ² Ğº Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ |
| Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ» Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚ | âœ… | ĞœĞ¾Ğ¼ĞµĞ½Ñ‚ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ |
| Ğ£Ğ´Ğ°Ğ»Ğ¸Ğ» Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚ | âŒ | ĞĞµ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ |

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**
```javascript
const isUserBusy = modalOpen || searchOpen || isEditing || isScrolling;
if (isUserBusy) return { primary: null, ... };
```

---

#### ğŸ“… Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ/ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹

| Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€ | Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ | ĞÑĞ¾Ğ±Ñ‹Ğ¹ ÑĞ¾Ğ²ĞµÑ‚ |
|--------|---------|--------------|
| **ĞŸĞ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº** | day === 1 | "ĞĞ¾Ğ²Ğ°Ñ Ğ½ĞµĞ´ĞµĞ»Ñ â€” Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚!" |
| **ĞŸÑÑ‚Ğ½Ğ¸Ñ†Ğ° Ğ²ĞµÑ‡ĞµÑ€** | day === 5 && hour >= 17 | "Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ â€” Ğ½Ğµ Ğ·Ğ°Ğ±Ñ‹Ğ²Ğ°Ğ¹ Ğ¾ Ñ†ĞµĞ»ÑÑ…" |
| **Ğ’Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ Ğ²ĞµÑ‡ĞµÑ€** | day === 0 && hour >= 18 | "Ğ¡Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞ¹ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ" |
| **ĞšĞ¾Ğ½ĞµÑ† Ğ¼ĞµÑÑÑ†Ğ°** | date >= 28 | "Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ñ‹Ğ²Ğ¾Ğº Ğ¼ĞµÑÑÑ†Ğ°!" |
| **1 ÑĞ½Ğ²Ğ°Ñ€Ñ** | month === 0 && date === 1 | "ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ³Ğ¾Ğ´ â€” Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚! ğŸ‰" |
| **Ğ”ĞµĞ½ÑŒ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ** | (ĞµÑĞ»Ğ¸ Ğ·Ğ½Ğ°ĞµĞ¼) | "Ğ¡ Ğ´Ğ½Ñ‘Ğ¼ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ! Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ²ÑÑ‘ ğŸ‚" |

---

#### ğŸ¯ Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñ‹ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° (Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°)

| Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ | ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ | Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ | TTL | ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ |
|---------|----------|--------|-----|-----------|
| `tab_open` | ĞŸĞµÑ€Ğ²Ğ¾Ğµ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ·Ğ° ÑĞµÑÑĞ¸Ñ | Streak, Ğ±Ğ°Ğ»Ğ°Ğ½Ñ, Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ | 5 ÑĞµĞº | 1 |
| `product_added` | ĞŸĞ¾ÑĞ»Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ | Ğ‘Ğ–Ğ£, ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ°, Ğ“Ğ˜ | 4 ÑĞµĞº | 2 |
| `meal_opened` | ĞšĞ»Ğ¸Ğº Ğ½Ğ° Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ | Ğ¡Ğ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ° | 3 ÑĞµĞº | 3 |
| `day_changed` | Ğ¡Ğ¼ĞµĞ½Ğ° Ğ´Ğ°Ñ‚Ñ‹ | Ğ˜Ñ‚Ğ¾Ğ³Ğ¸ / Ğ¿Ğ»Ğ°Ğ½ | 5 ÑĞµĞº | 1 |
| `idle_5s` | Ğ‘ĞµĞ·Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ 5 ÑĞµĞº | ĞĞ±Ñ‰Ğ¸Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ | 4 ÑĞµĞº | 4 |
| `time_evening` | 18:00+ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ· | Ğ’ĞµÑ‡ĞµÑ€Ğ½Ğ¸Ğµ | 5 ÑĞµĞº | 2 |
| `time_night` | 23:00+ | **ĞĞ˜Ğ§Ğ•Ğ“Ğ** | â€” | â€” |

---

#### ğŸ”‡ Cooldown Ğ¸ Ğ´ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ

```javascript
const COOLDOWN_MS = 30000;      // ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 30 ÑĞµĞº Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ¾Ğ²ĞµÑ‚Ğ°Ğ¼Ğ¸
const ADVICE_MEMORY_MS = 300000; // ĞĞµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑ‚ÑŒ ÑĞ¾Ğ²ĞµÑ‚ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
const MAX_ADVICES_PER_SESSION = 10; // ĞĞµ Ğ½Ğ°Ğ´Ğ¾ĞµĞ´Ğ°Ñ‚ÑŒ

// Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑĞµĞ³Ğ´Ğ°):
const ALWAYS_SHOW = ['streak_7', 'perfect_day', 'first_day'];
```

---

## ğŸ¯ ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

| ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|----------|----------|
| **ĞĞ´Ğ¸Ğ½ toast** | ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ½Ñƒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ (Ğ¿ĞµÑ€Ğ²ÑƒÑ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñƒ) |
| **ĞŸĞ¾Ñ‚ĞµÑ€Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°** | ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ ÑĞºÑ€Ñ‹Ñ‚Ñ‹ |
| **Ğ–Ñ‘ÑÑ‚ĞºĞ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°** | Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ·Ğ°Ñ…Ğ°Ñ€Ğ´ĞºĞ¾Ğ¶ĞµĞ½Ñ‹ Ğ² useMemo |
| **ĞĞµÑ‚ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸** | Ğ’ÑĞµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºÑƒÑ‡Ğµ |

---

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Advice Module

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADVICE ENGINE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Context Collector          â†’  Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ’Ğ¡Ğ• Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ          â”‚
â”‚  â”œâ”€â”€ DayContext             (dayTot, normAbs, meals, etc.)  â”‚
â”‚  â”œâ”€â”€ TimeContext            (hour, isEvening, isWeekend)    â”‚
â”‚  â”œâ”€â”€ TrendContext           (streak, weight trend)          â”‚
â”‚  â””â”€â”€ ProfileContext         (goals, preferences)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Rule Engine                â†’  ĞÑ†ĞµĞ½Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ²ÑĞµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°        â”‚
â”‚  â”œâ”€â”€ Warning Rules          (ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ, priority: 1)      â”‚
â”‚  â”œâ”€â”€ Achievement Rules      (Ğ¿Ğ¾Ñ…Ğ²Ğ°Ğ»Ğ°, priority: 2)          â”‚
â”‚  â”œâ”€â”€ Nutrition Rules        (Ğ‘Ğ–Ğ£, ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ°, Ğ“Ğ˜)            â”‚
â”‚  â”œâ”€â”€ Timing Rules           (Ğ²Ñ€ĞµĞ¼Ñ ÑÑƒÑ‚Ğ¾Ğº, Ğ¿ĞµÑ€ĞµÑ€Ñ‹Ğ²Ñ‹)         â”‚
â”‚  â”œâ”€â”€ Training Rules         (ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸)           â”‚
â”‚  â””â”€â”€ Lifestyle Rules        (ÑĞ¾Ğ½, ÑˆĞ°Ğ³Ğ¸, Ğ²Ğ¾Ğ´Ğ°)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Advice Prioritizer         â†’  Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµÑ‚        â”‚
â”‚  â”œâ”€â”€ ĞŸĞ¾ severity            (warning > achievement > tip)   â”‚
â”‚  â”œâ”€â”€ ĞŸĞ¾ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸        (Ğ²Ñ€ĞµĞ¼Ñ ÑÑƒÑ‚Ğ¾Ğº, ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚)         â”‚
â”‚  â””â”€â”€ ĞŸĞ¾ Ğ½Ğ¾Ğ²Ğ¸Ğ·Ğ½Ğµ             (Ğ½Ğµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑ‚ÑŒ Ñ‡Ğ°ÑÑ‚Ğ¾)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Delivery Layer             â†’  ĞšĞ°Ğº Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ               â”‚
â”‚  â”œâ”€â”€ Toast (1 Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹)      - Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»            â”‚
â”‚  â”œâ”€â”€ Advice Panel           - Ñ€Ğ°ÑĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‰Ğ¸Ğ¹ÑÑ ÑĞ¿Ğ¸ÑĞ¾Ğº         â”‚
â”‚  â””â”€â”€ Daily Summary          - Ğ¸Ñ‚Ğ¾Ğ³Ğ¸ Ğ´Ğ½Ñ (Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------|----------|
| `apps/web/heys_advice_v1.js` | **ĞĞĞ’Ğ«Ğ™** â€” ĞœĞ¾Ğ´ÑƒĞ»ÑŒ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² |
| `apps/web/heys_day_v12.js` | Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¾Ğ´ÑƒĞ»Ñ, Ğ·Ğ°Ğ¼ĞµĞ½Ğ° macroTip |
| `apps/web/styles/main.css` | Ğ¡Ñ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ Advice Panel |

---

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Advice

```javascript
/**
 * @typedef {Object} Advice
 * @property {string} id - Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ID Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° (e.g., 'low_protein', 'streak_7')
 * @property {string} icon - Emoji Ğ¸ĞºĞ¾Ğ½ĞºĞ°
 * @property {string} text - Ğ¢ĞµĞºÑÑ‚ ÑĞ¾Ğ²ĞµÑ‚Ğ°
 * @property {'warning'|'achievement'|'tip'|'info'} type - Ğ¢Ğ¸Ğ¿
 * @property {number} priority - ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ (1-100, Ğ¼ĞµĞ½ÑŒÑˆĞµ = Ğ²Ğ°Ğ¶Ğ½ĞµĞµ)
 * @property {string} category - ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ (nutrition, timing, training, lifestyle)
 * @property {number} score - Ğ ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ (0-1)
 * @property {string[]} triggers - ĞšĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ: ['tab_open', 'product_added', 'meal_opened', 'day_changed']
 * @property {number} [ttl] - Ğ’Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° Ğ² Ğ¼Ñ (default: 5000)
 * @property {boolean} [dismissable] - ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ»Ğ¸ ÑĞºÑ€Ñ‹Ñ‚ÑŒ
 * @property {Function} [onShow] - Callback Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğµ (Ğ´Ğ»Ñ sessionStorage)
 */

/**
 * @typedef {'tab_open'|'product_added'|'meal_opened'|'day_changed'|'time_check'|null} ShowTrigger
 */
```

---

## ğŸ¯ Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸

### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ» heys_advice_v1.js

**Ğ Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ**: `apps/web/heys_advice_v1.js`

```javascript
// heys_advice_v1.js â€” ĞœĞ¾Ğ´ÑƒĞ»ÑŒ ÑƒĞ¼Ğ½Ñ‹Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² HEYS
// Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: docs/DATA_MODEL_REFERENCE.md

(function() {
  'use strict';

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONSTANTS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const SHOWN_KEY = 'heys_shown_advices';
  const COOLDOWN_MS = 30000;        // ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 30 ÑĞµĞº Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ¾Ğ²ĞµÑ‚Ğ°Ğ¼Ğ¸
  const ADVICE_MEMORY_MS = 300000;  // ĞĞµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑ‚ÑŒ ÑĞ¾Ğ²ĞµÑ‚ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
  const MAX_ADVICES_PER_SESSION = 10;
  const ALWAYS_SHOW = ['streak_7', 'perfect_day', 'first_day']; // Ğ˜ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
  
  let lastShowTime = 0;
  let sessionAdviceCount = 0;
  
  // Cleanup Ğ¿Ñ€Ğ¸ ÑĞ¼ĞµĞ½Ğµ Ğ´Ğ°Ñ‚Ñ‹ (Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ·Ğ²Ğ½Ğµ Ğ¿Ñ€Ğ¸ date change)
  function resetSessionAdvices() {
    sessionAdviceCount = 0;
    lastShowTime = 0;
    try {
      // ĞÑ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ advice-related ĞºĞ»ÑÑ‡Ğ¸, Ğ½Ğµ streak
      sessionStorage.removeItem(SHOWN_KEY);
    } catch(e) {}
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ§  CONTEXT ANALYZERS â€” ĞĞ½Ğ°Ğ»Ğ¸Ğ· ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ñ‚Ğ¾Ğ½ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ÑÑƒÑ‚Ğ¾Ğº
   * @param {number} hour - Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ‡Ğ°Ñ (0-23)
   * @returns {'silent'|'gentle'|'business'|'brief'|'caring'|'supportive'|'warm'}
   */
  function getToneForHour(hour) {
    if (hour >= 23 || hour < 6) return 'silent';   // ĞĞµ Ğ±ĞµÑĞ¿Ğ¾ĞºĞ¾Ğ¸Ñ‚ÑŒ!
    if (hour < 9) return 'gentle';                  // ĞœÑĞ³ĞºĞ¾, ÑƒÑ‚Ñ€Ğ¾
    if (hour < 12) return 'business';               // Ğ”ĞµĞ»Ğ¾Ğ²Ğ¾Ğ¹
    if (hour < 14) return 'brief';                  // ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾ (Ğ¾Ğ±ĞµĞ´)
    if (hour < 17) return 'caring';                 // Ğ—Ğ°Ğ±Ğ¾Ñ‚Ğ»Ğ¸Ğ²Ğ¾ (ÑĞ¿Ğ°Ğ´ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸)
    if (hour < 20) return 'supportive';             // ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° (Ğ²ĞµÑ‡ĞµÑ€)
    return 'warm';                                  // Ğ¢Ñ‘Ğ¿Ğ»Ñ‹Ğ¹ (Ñ€ĞµÑ„Ğ»ĞµĞºÑĞ¸Ñ)
  }

  /**
   * ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
   * @param {Object} ctx - ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
   * @returns {'stressed'|'crashed'|'success'|'returning'|'newbie'|'normal'}
   */
  function getEmotionalState(ctx) {
    const { day, currentStreak, mealCount, kcalPct, totalDaysTracked } = ctx;
    
    // ĞĞ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº (Ğ¼ĞµĞ½ĞµĞµ 3 Ğ´Ğ½ĞµĞ¹ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸)
    if (totalDaysTracked < 3) return 'newbie';
    
    // Ğ£ÑĞ¿ĞµÑ… (streak 3+ Ğ´Ğ½ĞµĞ¹)
    if (currentStreak >= 3) return 'success';
    
    // Ğ¡Ñ€Ñ‹Ğ² (Ñ€ĞµĞ·ĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ĞµĞ±Ğ¾Ñ€ >150% ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹)
    if (kcalPct > 1.5) return 'crashed';
    
    // Ğ¡Ñ‚Ñ€ĞµÑÑ (Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹ mood Ğ² Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ñ…)
    const meals = day?.meals || [];
    const moodsWithValues = meals.filter(m => m.mood && !isNaN(+m.mood));
    if (moodsWithValues.length > 0) {
      const avgMood = moodsWithValues.reduce((sum, m) => sum + (+m.mood), 0) / moodsWithValues.length;
      if (avgMood < 3) return 'stressed';
    }
    
    return 'normal';
  }

  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ·Ğ°Ğ½ÑÑ‚ Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ
   * @param {Object} uiState - Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ UI
   * @returns {boolean}
   */
  function isUserBusy(uiState) {
    const { modalOpen, searchOpen, isEditing, isScrolling } = uiState || {};
    return modalOpen || searchOpen || isEditing || isScrolling;
  }

  /**
   * ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ğ¾ÑĞ¾Ğ±Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ (Ğ¿Ğ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº, Ğ¿Ñ€Ğ°Ğ·Ğ´Ğ½Ğ¸Ğº Ğ¸ Ñ‚.Ğ´.)
   * @param {Date} date
   * @returns {string|null}
   */
  function getSpecialDay(date) {
    const day = date.getDay();
    const month = date.getMonth();
    const dateNum = date.getDate();
    const hour = date.getHours();
    
    // ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ³Ğ¾Ğ´
    if (month === 0 && dateNum === 1) return 'new_year';
    
    // ĞŸĞ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº ÑƒÑ‚Ñ€Ğ¾
    if (day === 1 && hour < 12) return 'monday_morning';
    
    // ĞŸÑÑ‚Ğ½Ğ¸Ñ†Ğ° Ğ²ĞµÑ‡ĞµÑ€
    if (day === 5 && hour >= 17) return 'friday_evening';
    
    // Ğ’Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ Ğ²ĞµÑ‡ĞµÑ€
    if (day === 0 && hour >= 18) return 'sunday_evening';
    
    // ĞšĞ¾Ğ½ĞµÑ† Ğ¼ĞµÑÑÑ†Ğ°
    if (dateNum >= 28) return 'month_end';
    
    return null;
  }

  /**
   * Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
   * @param {Array} advices
   * @param {string} emotionalState
   * @returns {Array}
   */
  function filterByEmotionalState(advices, emotionalState) {
    // ĞŸÑ€Ğ¸ ÑÑ‚Ñ€ĞµÑÑĞµ Ğ¸Ğ»Ğ¸ ÑÑ€Ñ‹Ğ²Ğµ â€” ÑƒĞ±Ğ¸Ñ€Ğ°ĞµĞ¼ warnings
    if (emotionalState === 'stressed' || emotionalState === 'crashed') {
      return advices.filter(a => a.type !== 'warning');
    }
    return advices;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SHOWN ADVICES TRACKER â€” ĞšĞ°ĞºĞ¸Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ ÑƒĞ¶Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ñ‹ Ğ² ÑĞµÑÑĞ¸Ğ¸
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  function getShownAdvices() {
    try {
      return JSON.parse(sessionStorage.getItem(SHOWN_KEY) || '{}');
    } catch { return {}; }
  }
  
  function markAdviceShown(id) {
    try {
      const shown = getShownAdvices();
      shown[id] = Date.now();
      sessionStorage.setItem(SHOWN_KEY, JSON.stringify(shown));
      sessionAdviceCount++;
    } catch {}
  }
  
  function wasShownRecently(id, withinMs = ADVICE_MEMORY_MS) {
    if (ALWAYS_SHOW.includes(id)) return false; // Ğ­Ñ‚Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²ÑĞµĞ³Ğ´Ğ°
    const shown = getShownAdvices();
    return shown[id] && (Date.now() - shown[id] < withinMs);
  }
  
  function canShowNow() {
    if (sessionAdviceCount >= MAX_ADVICES_PER_SESSION) return false;
    return Date.now() - lastShowTime > COOLDOWN_MS;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADVICE RULES â€” Ğ’ÑĞµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
   * @param {Object} ctx - ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
   * @returns {Array<Advice>} ĞœĞ°ÑÑĞ¸Ğ² Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
   */
  function evaluateRules(ctx) {
    const {
      dayTot, normAbs, optimum, day, pIndex,
      currentStreak, hour, mealCount, hasTraining,
      emotionalState, tone, specialDay
    } = ctx;

    const advices = [];
    
    // ĞĞ¾Ñ‡ÑŒÑ â€” Ğ½Ğµ Ğ±ĞµÑĞ¿Ğ¾ĞºĞ¾Ğ¸Ğ¼!
    if (tone === 'silent') return [];

    // Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚Ñ‹
    const kcalPct = (dayTot.kcal || 0) / (optimum || 1);
    const proteinPct = (dayTot.prot || 0) / (normAbs.prot || 1);
    const fatPct = (dayTot.fat || 0) / (normAbs.fat || 1);
    const carbsPct = (dayTot.carbs || 0) / (normAbs.carbs || 1);
    const fiberPct = (dayTot.fiber || 0) / (normAbs.fiber || 25);
    
    const simpleCarbs = dayTot.simple || 0;
    const complexCarbs = dayTot.complex || 0;
    const totalCarbs = simpleCarbs + complexCarbs;
    const simplePct = totalCarbs > 0 ? (simpleCarbs / totalCarbs) : 0;
    
    const badFat = dayTot.bad || 0;
    const totalFat = dayTot.fat || 0;
    const badFatPct = totalFat > 0 ? (badFat / totalFat) : 0;
    
    const avgGI = dayTot.gi || 0;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ“… SPECIAL DAY TIPS â€” ĞÑĞ¾Ğ±Ñ‹Ğµ Ğ´Ğ½Ğ¸
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    if (specialDay === 'new_year') {
      advices.push({
        id: 'new_year',
        icon: 'ğŸ‰',
        text: 'Ğ¡ ĞĞ¾Ğ²Ñ‹Ğ¼ Ğ³Ğ¾Ğ´Ğ¾Ğ¼! Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ€Ñ‚Ğ°!',
        type: 'achievement',
        priority: 0,
        category: 'special',
        triggers: ['tab_open'],
        ttl: 7000
      });
    }
    
    if (specialDay === 'monday_morning') {
      advices.push({
        id: 'monday_motivation',
        icon: 'ğŸ’ª',
        text: 'ĞĞ¾Ğ²Ğ°Ñ Ğ½ĞµĞ´ĞµĞ»Ñ â€” Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸!',
        type: 'tip',
        priority: 5,
        category: 'motivation',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    if (specialDay === 'friday_evening') {
      advices.push({
        id: 'friday_reminder',
        icon: 'ğŸ¯',
        text: 'Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ â€” Ğ¿Ğ¾Ğ¼Ğ½Ğ¸ Ğ¾ ÑĞ²Ğ¾Ğ¸Ñ… Ñ†ĞµĞ»ÑÑ…!',
        type: 'tip',
        priority: 10,
        category: 'motivation',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    if (specialDay === 'sunday_evening') {
      advices.push({
        id: 'sunday_planning',
        icon: 'ğŸ“‹',
        text: 'Ğ¡Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞ¹ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ',
        type: 'tip',
        priority: 10,
        category: 'motivation',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ˜Š EMOTIONAL STATE TIPS â€” ĞŸĞ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    if (emotionalState === 'returning') {
      advices.push({
        id: 'welcome_back',
        icon: 'ğŸ‘‹',
        text: 'Ğ Ğ°Ğ´Ñ‹ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ! ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ğ¼ Ñ Ñ‚Ğ¾Ğ³Ğ¾ Ğ¼ĞµÑÑ‚Ğ°?',
        type: 'achievement',
        priority: 1,
        category: 'emotional',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    if (emotionalState === 'crashed') {
      advices.push({
        id: 'crash_support',
        icon: 'ğŸ’™',
        text: 'Ğ‘Ñ‹Ğ²Ğ°ĞµÑ‚! Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ° Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ. Ğ¢Ñ‹ ÑĞ¿Ñ€Ğ°Ğ²Ğ¸ÑˆÑŒÑÑ!',
        type: 'achievement',
        priority: 1,
        category: 'emotional',
        triggers: ['tab_open', 'product_added'],
        ttl: 6000
      });
    }
    
    if (emotionalState === 'stressed') {
      advices.push({
        id: 'stress_support',
        icon: 'ğŸ¤—',
        text: 'Ğ¢Ñ‹ Ğ¼Ğ¾Ğ»Ğ¾Ğ´ĞµÑ†, Ñ‡Ñ‚Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑˆÑŒ. Ğ­Ñ‚Ğ¾ ÑƒĞ¶Ğµ ÑƒÑĞ¿ĞµÑ…!',
        type: 'achievement',
        priority: 2,
        category: 'emotional',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ† ACHIEVEMENTS (priority: 1-10) â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ¿Ñ€Ğ¸ tab_open
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (currentStreak >= 7 && !sessionStorage.getItem('heys_streak7')) {
      advices.push({
        id: 'streak_7',
        icon: 'ğŸ†',
        text: `ĞĞµĞ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾! ${currentStreak} Ğ´Ğ½ĞµĞ¹ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ!`,
        type: 'achievement',
        priority: 1,
        category: 'achievement',
        score: 1.0,
        triggers: ['tab_open'],
        ttl: 7000,
        showConfetti: true,
        onShow: () => { try { sessionStorage.setItem('heys_streak7', '1'); } catch(e) {} }
      });
    }
    
    if (currentStreak >= 3 && currentStreak < 7 && !sessionStorage.getItem('heys_streak3')) {
      advices.push({
        id: 'streak_3',
        icon: 'ğŸ”¥',
        text: `${currentStreak} Ğ´Ğ½Ñ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ! Ğ¢Ğ°Ğº Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ!`,
        type: 'achievement',
        priority: 2,
        category: 'achievement',
        score: 0.9,
        triggers: ['tab_open'],
        ttl: 5000,
        onShow: () => { try { sessionStorage.setItem('heys_streak3', '1'); } catch(e) {} }
      });
    }
    
    // Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸ tab_open Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼
    if (hour >= 18 && kcalPct >= 0.95 && kcalPct <= 1.05 && 
        proteinPct >= 0.9 && fatPct >= 0.9 && carbsPct >= 0.9) {
      advices.push({
        id: 'perfect_day',
        icon: 'â­',
        text: 'Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ! ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° ğŸ‰',
        type: 'achievement',
        priority: 5,
        category: 'achievement',
        score: 1.0,
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ â€” Ğ¿Ğ¾ÑĞ»Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°
    if (mealCount === 1 && !localStorage.getItem('heys_first_meal_tip')) {
      advices.push({
        id: 'first_day',
        icon: 'ğŸ‘‹',
        text: 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾! Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ¹ Ğ²ÑÑ‘ â€” ÑÑ‚Ğ¾ ĞºĞ»ÑÑ‡ Ğº ÑƒÑĞ¿ĞµÑ…Ñƒ',
        type: 'achievement',
        priority: 3,
        category: 'achievement',
        score: 1.0,
        triggers: ['product_added'],
        ttl: 5000,
        onShow: () => { try { localStorage.setItem('heys_first_meal_tip', '1'); } catch(e) {} }
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // âš ï¸ WARNINGS (priority: 11-30) â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (kcalPct >= 1.25) {
      advices.push({
        id: 'kcal_excess_critical',
        icon: 'âš ï¸',
        text: 'ĞŸĞµÑ€ĞµĞ±Ğ¾Ñ€ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹! Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ° ÑĞ´ĞµĞ»Ğ°Ğ¹ Ñ€Ğ°Ğ·Ğ³Ñ€ÑƒĞ·Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ',
        type: 'warning',
        priority: 11,
        category: 'nutrition',
        score: 1.0,
        triggers: ['product_added', 'tab_open'],
        ttl: 6000
      });
    }
    
    if (simplePct > 0.5 && simpleCarbs > 30) {
      advices.push({
        id: 'simple_carbs_high',
        icon: 'âš ï¸',
        text: 'ĞœĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ²! Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸ ÑĞ»Ğ°Ğ´ĞºĞ¾Ğµ Ğ½Ğ° ĞºĞ°ÑˆÑƒ/Ğ¾Ğ²Ğ¾Ñ‰Ğ¸',
        type: 'warning',
        priority: 12,
        category: 'nutrition',
        score: simplePct,
        triggers: ['product_added'],
        ttl: 5000
      });
    }
    
    if (badFatPct > 0.4 && badFat > 20) {
      advices.push({
        id: 'bad_fat_high',
        icon: 'âš ï¸',
        text: 'ĞœĞ½Ğ¾Ğ³Ğ¾ Ğ²Ñ€ĞµĞ´Ğ½Ñ‹Ñ… Ğ¶Ğ¸Ñ€Ğ¾Ğ²! Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸ Ğ½Ğ° Ñ€Ñ‹Ğ±Ñƒ/Ğ¾Ñ€ĞµÑ…Ğ¸/Ğ°Ğ²Ğ¾ĞºĞ°Ğ´Ğ¾',
        type: 'warning',
        priority: 13,
        category: 'nutrition',
        score: badFatPct,
        triggers: ['product_added'],
        ttl: 5000
      });
    }
    
    if (avgGI > 70 && dayTot.kcal > 500) {
      advices.push({
        id: 'high_gi',
        icon: 'ğŸ“ˆ',
        text: 'Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ“Ğ˜ â€” Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ½Ğ° ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ',
        type: 'warning',
        priority: 14,
        category: 'nutrition',
        score: avgGI / 100,
        triggers: ['product_added'],
        ttl: 5000
      });
    }
    
    // ĞœĞ°Ğ»Ğ¾ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹ Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼ â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸ tab_open
    if (hour >= 18 && dayTot.kcal < 500 && dayTot.kcal > 0) {
      advices.push({
        id: 'too_few_kcal',
        icon: 'âš ï¸',
        text: 'Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ°Ğ»Ğ¾ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹ â€” ÑÑ‚Ğ¾ Ğ²Ñ€ĞµĞ´Ğ¸Ñ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼Ñƒ',
        type: 'warning',
        priority: 15,
        category: 'nutrition',
        score: 0.9,
        triggers: ['tab_open', 'time_check'],
        ttl: 5000
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ¥¬ NUTRITION TIPS (priority: 31-50) â€” Ğ¿Ğ¾ÑĞ»Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (fiberPct < 0.5 && dayTot.kcal > 500) {
      advices.push({
        id: 'low_fiber',
        icon: 'ğŸ¥¬',
        text: 'Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ¸: Ğ¾Ğ²Ğ¾Ñ‰Ğ¸, Ñ„Ñ€ÑƒĞºÑ‚Ñ‹, ĞºĞ°ÑˆĞ°',
        type: 'fiber',
        priority: 31,
        category: 'nutrition',
        score: 1 - fiberPct,
        triggers: ['product_added', 'meal_opened'],
        ttl: 4000
      });
    }
    
    if (carbsPct > 0.7 && proteinPct < 0.4) {
      advices.push({
        id: 'carbs_no_protein',
        icon: 'ğŸ½ï¸',
        text: 'Ğ£Ğ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ±ĞµĞ· Ğ±ĞµĞ»ĞºĞ° = Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ³Ğ¾Ğ»Ğ¾Ğ´. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ±ĞµĞ»Ğ¾Ğº!',
        type: 'tip',
        priority: 32,
        category: 'nutrition',
        score: 0.8,
        triggers: ['product_added'],
        ttl: 4000
      });
    }
    
    if (fatPct > 0.7 && carbsPct < 0.4) {
      advices.push({
        id: 'fat_no_carbs',
        icon: 'âš¡',
        text: 'Ğ”Ğ»Ñ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸ Ğ½ÑƒĞ¶Ğ½Ñ‹ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ â€” Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ĞºĞ°ÑˆÑƒ',
        type: 'tip',
        priority: 33,
        category: 'nutrition',
        score: 0.8,
        triggers: ['product_added'],
        ttl: 4000
      });
    }
    
    // Ğ”ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ñ‹ Ğ¼Ğ°ĞºÑ€Ğ¾ÑĞ¾Ğ² â€” Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğµ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ° Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾ÑĞ»Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ
    if (proteinPct < 0.5 && fatPct >= 0.5 && carbsPct >= 0.5) {
      advices.push({
        id: 'low_protein',
        icon: 'ğŸ¥©',
        text: 'Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ±ĞµĞ»ĞºĞ°: Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³, ÑĞ¹Ñ†Ğ°, ĞºÑƒÑ€Ğ¸Ñ†Ğ°',
        type: 'protein',
        priority: 41,
        category: 'nutrition',
        score: 1 - proteinPct,
        triggers: ['product_added', 'meal_opened'],
        ttl: 4000
      });
    }
    
    if (fatPct < 0.5 && proteinPct >= 0.5 && carbsPct >= 0.5) {
      advices.push({
        id: 'low_fat',
        icon: 'ğŸ¥‘',
        text: 'ĞœĞ°Ğ»Ğ¾ Ğ¶Ğ¸Ñ€Ğ¾Ğ²: Ğ¾Ñ€ĞµÑ…Ğ¸, Ğ°Ğ²Ğ¾ĞºĞ°Ğ´Ğ¾, Ğ¼Ğ°ÑĞ»Ğ¾',
        type: 'fat',
        priority: 42,
        category: 'nutrition',
        score: 1 - fatPct,
        triggers: ['product_added', 'meal_opened'],
        ttl: 4000
      });
    }
    
    if (carbsPct < 0.5 && proteinPct >= 0.5 && fatPct >= 0.5) {
      advices.push({
        id: 'low_carbs',
        icon: 'ğŸ',
        text: 'Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ²: ĞºĞ°ÑˆĞ°, Ñ…Ğ»ĞµĞ±, Ñ„Ñ€ÑƒĞºÑ‚Ñ‹',
        type: 'carbs',
        priority: 43,
        category: 'nutrition',
        score: 1 - carbsPct,
        triggers: ['product_added', 'meal_opened'],
        ttl: 4000
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // â° TIMING TIPS (priority: 51-70) â€” ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ½Ñ‹Ğµ Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ’ĞµÑ‡ĞµÑ€Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ â€” Ğ¿Ğ¾ÑĞ»Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼
    if (hour >= 18 && simplePct > 0.4 && simpleCarbs > 50) {
      advices.push({
        id: 'evening_sugar',
        icon: 'ğŸŒ™',
        text: 'Ğ¡Ğ»Ğ°Ğ´ĞºĞ¾Ğµ Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼ â†’ Ğ¿Ğ»Ğ¾Ñ…Ğ¾Ğ¹ ÑĞ¾Ğ½. Ğ›ÑƒÑ‡ÑˆĞµ Ğ±ĞµĞ»Ğ¾Ğº!',
        type: 'tip',
        priority: 51,
        category: 'timing',
        score: 0.7,
        triggers: ['product_added'],
        ttl: 4000
      });
    }
    
    // ĞŸÑ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº â€” Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞ¸ Ğ´Ğ½Ñ‘Ğ¼
    if (hour >= 12 && mealCount === 0) {
      advices.push({
        id: 'no_breakfast',
        icon: 'ğŸŒ…',
        text: 'Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼ â€” Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°Ğ¹!',
        type: 'tip',
        priority: 52,
        category: 'timing',
        score: 0.8,
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    if (hour >= 14 && mealCount === 1 && dayTot.kcal > 300) {
      advices.push({
        id: 'long_gap',
        icon: 'â°',
        text: 'Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ Ğ¿ĞµÑ€ĞµÑ€Ñ‹Ğ²Ñ‹ Ğ·Ğ°Ğ¼ĞµĞ´Ğ»ÑÑÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼ â€” Ğ¿ĞµÑ€ĞµĞºÑƒÑĞ¸!',
        type: 'tip',
        priority: 53,
        category: 'timing',
        score: 0.6,
        triggers: ['tab_open'],
        ttl: 4000
      });
    }
    
    if (mealCount === 1 && dayTot.kcal > 800) {
      advices.push({
        id: 'one_big_meal',
        icon: 'ğŸ½ï¸',
        text: 'Ğ›ÑƒÑ‡ÑˆĞµ 3-4 Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ° Ñ‡ĞµĞ¼ 1 Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹',
        type: 'tip',
        priority: 54,
        category: 'timing',
        score: 0.5,
        triggers: ['product_added'],
        ttl: 4000
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ’ª TRAINING TIPS (priority: 71-80)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (hasTraining && proteinPct < 0.6) {
      advices.push({
        id: 'training_protein',
        icon: 'ğŸ’ª',
        text: 'ĞŸĞ¾ÑĞ»Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ²Ğ°Ğ¶ĞµĞ½ Ğ±ĞµĞ»Ğ¾Ğº Ğ´Ğ»Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ',
        type: 'tip',
        priority: 71,
        category: 'training',
        score: 0.8,
        triggers: ['tab_open', 'product_added'],
        ttl: 5000
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ¯ GOAL TIPS (priority: 81-90)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (kcalPct >= 1.1 && kcalPct < 1.25) {
      advices.push({
        id: 'kcal_slight_excess',
        icon: 'ğŸ“Š',
        text: 'ĞĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ¿ĞµÑ€ĞµĞ±Ğ¾Ñ€ â€” Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ° Ñ‡ÑƒÑ‚ÑŒ Ğ¼ĞµĞ½ÑŒÑˆĞµ, Ğ¸ Ğ²ÑÑ‘ Ğ¾Ğº ğŸ˜Š',
        type: 'tip',
        priority: 81,
        category: 'nutrition',
        score: 0.6,
        triggers: ['product_added', 'tab_open'],
        ttl: 4000
      });
    }
    
    if (kcalPct >= 0.8 && kcalPct < 0.95) {
      const remaining = Math.round(optimum - dayTot.kcal);
      advices.push({
        id: 'kcal_remaining',
        icon: 'ğŸ¯',
        text: `ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ ${remaining} ĞºĞºĞ°Ğ» â€” Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞºÑƒÑĞ°`,
        type: 'tip',
        priority: 82,
        category: 'nutrition',
        score: 0.5,
        triggers: ['tab_open', 'meal_opened'],
        ttl: 4000
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // âœ… SUCCESS (priority: 91-100)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (proteinPct >= 0.8 && fatPct >= 0.8 && carbsPct >= 0.8) {
      advices.push({
        id: 'all_balanced',
        icon: 'âœ…',
        text: 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! Ğ’ÑĞµ Ğ¼Ğ°ĞºÑ€Ğ¾ÑÑ‹ Ğ² Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞµ',
        type: 'success',
        priority: 91,
        category: 'nutrition',
        score: 0.9,
        triggers: ['tab_open', 'product_added'],
        ttl: 4000
      });
    }

    // Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñƒ
    return advices.sort((a, b) => a.priority - b.priority);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADVICE ENGINE â€” ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ñ…ÑƒĞº
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * React hook Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ ÑĞ¾Ğ²ĞµÑ‚Ğ°Ğ¼Ğ¸
   * @param {Object} params - ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹
   * @param {ShowTrigger} params.trigger - Ğ§Ñ‚Ğ¾ Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ»Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·
   * @param {Object} params.uiState - Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ UI Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ·Ğ°Ğ½ÑÑ‚Ğ¾ÑÑ‚Ğ¸
   * @returns {Object} ĞĞ±ÑŠĞµĞºÑ‚ Ñ ÑĞ¾Ğ²ĞµÑ‚Ğ°Ğ¼Ğ¸ Ğ¸ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ°Ğ¼Ğ¸
   */
  function useAdviceEngine(params) {
    const { dayTot, normAbs, optimum, day, pIndex, activeDays, trigger, uiState } = params;
    const React = window.React;

    // Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
    const ctx = React.useMemo(() => {
      const now = new Date();
      const hour = now.getHours();
      const meals = day?.meals || [];
      const mealCount = meals.filter(m => m.items?.length > 0).length;
      const trainings = day?.trainings || [];
      const hasTraining = trainings.some(t => t.z && t.z.some(m => m > 0));
      
      // Streak â€” inline formatDate Ğ´Ğ»Ñ Ğ½ĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ window.fmtDate
      const formatDate = (d) => {
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        return `${yyyy}-${mm}-${dd}`;
      };
      
      let currentStreak = 0;
      if (activeDays && activeDays.size > 0) {
        let checkDate = new Date();
        checkDate.setHours(12);
        for (let i = 0; i < 30; i++) {
          const dateStr = formatDate(checkDate);
          const dayData = activeDays.get(dateStr);
          if (dayData && dayData.ratio >= 0.75 && dayData.ratio <= 1.15) {
            currentStreak++;
          } else if (i > 0) {
            break;
          }
          checkDate.setDate(checkDate.getDate() - 1);
        }
      }
      
      // ğŸ§  Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
      const kcalPct = (dayTot?.kcal || 0) / (optimum || 2000);
      const tone = getToneForHour(hour);
      const specialDay = getSpecialDay(now);
      const emotionalState = getEmotionalState({
        day,
        currentStreak,
        mealCount,
        kcalPct,
        lastVisitDaysAgo: 0, // TODO: Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ· localStorage
        totalDaysTracked: activeDays?.size || 0
      });

      return {
        dayTot: dayTot || {},
        normAbs: normAbs || {},
        optimum: optimum || 2000,
        day: day || {},
        pIndex: pIndex || new Map(),
        currentStreak,
        hour,
        mealCount,
        hasTraining,
        // ĞĞ¾Ğ²Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ
        kcalPct,
        tone,
        specialDay,
        emotionalState
      };
    }, [dayTot, normAbs, optimum, day, pIndex, activeDays]);

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ’Ğ¡Ğ• ÑĞ¾Ğ²ĞµÑ‚Ñ‹ (Ğ±ĞµĞ· Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ trigger)
    const allAdvices = React.useMemo(() => {
      try {
        const advices = evaluateRules(ctx);
        // Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
        return filterByEmotionalState(advices, ctx.emotionalState);
      } catch (e) {
        console.error('[Advice] Error evaluating rules:', e);
        return [];
      }
    }, [ctx]);

    // Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ trigger + Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ cooldown + Ğ·Ğ°Ğ½ÑÑ‚Ğ¾ÑÑ‚ÑŒ
    const relevantAdvices = React.useMemo(() => {
      // Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ½ÑÑ‚ â€” Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼
      if (isUserBusy(uiState)) return [];
      
      // ĞĞ¾Ñ‡ÑŒÑ â€” Ğ½Ğµ Ğ±ĞµÑĞ¿Ğ¾ĞºĞ¾Ğ¸Ğ¼
      if (ctx.tone === 'silent') return [];
      
      if (!trigger || !canShowNow()) return [];
      
      return (allAdvices || []).filter(advice => {
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ»Ğ¸ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€
        if (!advice.triggers?.includes(trigger)) return false;
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ»Ğ¸ Ğ»Ğ¸ Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¾
        if (wasShownRecently(advice.id)) return false;
        return true;
      });
    }, [allAdvices, trigger, uiState, ctx.tone]);

    // Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼
    const byCategory = React.useMemo(() => {
      const grouped = {
        achievement: [],
        nutrition: [],
        timing: [],
        training: [],
        lifestyle: [],
        emotional: [],
        motivation: [],
        special: []
      };
      (allAdvices || []).forEach(a => {
        if (grouped[a.category]) {
          grouped[a.category].push(a);
        }
      });
      return grouped;
    }, [allAdvices]);

    // Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ÑĞ¾Ğ²ĞµÑ‚ Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° (Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¸Ğ· relevantAdvices)
    const primary = relevantAdvices[0] || null;
    
    // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¾Ñ‚Ğ¼ĞµÑ‚ĞºĞ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°
    const markShown = React.useCallback((id) => {
      markAdviceShown(id);
      lastShowTime = Date.now();
    }, []);

    return {
      primary,             // Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ÑĞ¾Ğ²ĞµÑ‚ Ğ´Ğ»Ñ toast (Ğ¸Ğ»Ğ¸ null ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ñ…)
      relevant: relevantAdvices, // Ğ’ÑĞµ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ»Ñ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ trigger
      all: allAdvices,     // Ğ’Ğ¡Ğ• Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ (Ğ´Ğ»Ñ Ğ´ĞµĞ±Ğ°Ğ³Ğ°)
      byCategory,          // Ğ¡Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼
      count: relevantAdvices.length,
      streak: ctx.currentStreak,
      markShown            // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¼ĞµÑ‚ĞºĞ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EXPORTS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  window.HEYS = window.HEYS || {};
  window.HEYS.advice = {
    useAdviceEngine,
    evaluateRules,
    // Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ²Ğ½ĞµÑˆĞ½ĞµĞ³Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    canShowNow,
    wasShownRecently,
    markAdviceShown,
    resetSessionAdvices, // Ğ”Ğ»Ñ ÑĞ±Ñ€Ğ¾ÑĞ° Ğ¿Ñ€Ğ¸ ÑĞ¼ĞµĞ½Ğµ Ğ´Ğ°Ñ‚Ñ‹
    // ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ (Ğ´Ğ»Ñ Ğ²Ğ½ĞµÑˆĞ½ĞµĞ³Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)
    getToneForHour,
    getEmotionalState,
    getSpecialDay,
    isUserBusy
  };

})();
```

### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 2: Expandable Toast UI Ñ Smart Timing

**ĞšĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ**: Toast Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¸ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ñ‹Ñ… Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğ°Ñ…, ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ·Ğ°Ğ½ÑÑ‚Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¸ÑÑ‡ĞµĞ·Ğ°ĞµÑ‚.

**Ğ“Ğ´Ğµ**: Ğ’ DayTab `heys_day_v12.js`

**âš ï¸ Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•**: ĞŸĞµÑ€ĞµĞ´ ÑÑ‚Ğ¾Ğ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡ĞµĞ¹ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚ `2025-11-28-smart-toast-recommendations.md` â€” Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ³Ğ° `prot/protein`!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SMART TIMING â€” Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñ‹ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€ÑĞ´Ğ¾Ğ¼ Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¼Ğ¸ useState Ğ² DayTab, Ğ¿Ğ¾ÑĞ»Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ ~707)
const [adviceTrigger, setAdviceTrigger] = React.useState(null);
const [adviceExpanded, setAdviceExpanded] = React.useState(false);
// âš ï¸ Ğ’ĞĞ–ĞĞ: toastVisible, toastDismissed Ğ¸ toastTimeoutRef Ğ£Ğ–Ğ• ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‚ (ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 705-707)
// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ˜Ğ¥, Ğ½Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ!

// UI State Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ·Ğ°Ğ½ÑÑ‚Ğ¾ÑÑ‚Ğ¸
// âš ï¸ Ğ’ĞĞ–ĞĞ: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ Ğ•ĞĞ›Ğ¬ĞĞ«Ğ• Ğ¸Ğ¼ĞµĞ½Ğ° Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¸Ğ· DayTab!
// âš ï¸ showTrainingPicker â€” ĞĞ• ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚! Ğ•ÑÑ‚ÑŒ: showTimePicker, showGramsPicker, showWeightPicker, showDeficitPicker, showZonePicker, showSleepQualityPicker, showDayScorePicker, showHouseholdPicker
const uiState = React.useMemo(() => ({
  modalOpen: showTimePicker || showGramsPicker || showWeightPicker || showDeficitPicker || showZonePicker || showSleepQualityPicker || showDayScorePicker || showHouseholdPicker,
  searchOpen: false, // ĞĞµÑ‚ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ searchOpen Ğ² DayTab â€” Ğ¿Ğ¾Ğ¸ÑĞº Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ MealAddProduct
  isEditing: false, // Ğ“Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€ÑƒÑÑ‚ÑÑ inline Ğ±ĞµĞ· Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
  isScrolling: false // ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ scroll listener
}), [showTimePicker, showGramsPicker, showWeightPicker, showDeficitPicker, showZonePicker, showSleepQualityPicker, showDayScorePicker, showHouseholdPicker]);

// Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ Ğ²ĞºĞ»Ğ°Ğ´ĞºĞ¸ (Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· Ğ·Ğ° ÑĞµÑÑĞ¸Ñ)
// âš ï¸ Ğ’ĞĞ–ĞĞ: ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ½Ğ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ `date`, ĞĞ• `curDate`!
React.useEffect(() => {
  const sessionKey = 'heys_tab_opened_' + date;
  if (!sessionStorage.getItem(sessionKey)) {
    sessionStorage.setItem(sessionKey, '1');
    // ĞĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ°, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ "Ğ¾ÑĞ²Ğ¾Ğ¸Ğ»ÑÑ"
    setTimeout(() => setAdviceTrigger('tab_open'), 1500);
  }
}, [date]);

// Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ Ğ¿Ğ¾ÑĞ»Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ° (Ñ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹)
const handleProductAdded = React.useCallback(() => {
  // ... ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ...
  // Ğ—Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° 500ms Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒĞ²Ğ¸Ğ´ĞµĞ» Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
  setTimeout(() => setAdviceTrigger('product_added'), 500);
}, []);

// Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ° Ğ¿Ğ¸Ñ‰Ğ¸
const handleMealOpen = React.useCallback((mealIndex) => {
  // ... ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ...
  setTimeout(() => setAdviceTrigger('meal_opened'), 300);
}, []);

// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ñ‡ĞµÑ€ĞµĞ· Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ Ñ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğ¾Ğ¼ Ğ˜ uiState
const { primary, relevant, count: adviceCount, markShown } = 
  window.HEYS?.advice?.useAdviceEngine?.({
    dayTot, normAbs, optimum, day, pIndex, activeDays,
    trigger: adviceTrigger,
    uiState // <-- Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ğ¼ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ UI
  }) || { primary: null, relevant: [], count: 0, markShown: () => {} };

// ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ¾ĞºĞ°Ğ·/ÑĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ toast
React.useEffect(() => {
  if (primary && adviceTrigger) {
    // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ toast
    setToastVisible(true);
    
    // Haptic feedback Ğ´Ğ»Ñ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
    if (primary.type === 'achievement' || primary.type === 'warning') {
      haptic && haptic('light');
    }
    
    // Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ onShow
    if (primary.onShow) primary.onShow();
    
    // Confetti Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹
    if (primary.showConfetti && window.HEYS?.showConfetti) {
      window.HEYS.showConfetti();
      haptic && haptic('success');
    }
    
    // ĞÑ‚Ğ¼ĞµÑ‡Ğ°ĞµĞ¼ ĞºĞ°Ğº Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¹
    markShown(primary.id);
    
    // Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ñ‚Ğ°Ğ¹Ğ¼ĞµÑ€ ÑĞºÑ€Ñ‹Ñ‚Ğ¸Ñ
    if (toastTimerRef.current) clearTimeout(toastTimerRef.current);
    toastTimerRef.current = setTimeout(() => {
      setToastVisible(false);
      setAdviceExpanded(false);
      setAdviceTrigger(null);
    }, primary.ttl || 5000);
  }
  
  return () => {
    if (toastTimerRef.current) clearTimeout(toastTimerRef.current);
  };
}, [primary?.id, adviceTrigger]);

// Ğ¡Ğ±Ñ€Ğ¾Ñ advice state Ğ¿Ñ€Ğ¸ ÑĞ¼ĞµĞ½Ğµ Ğ´Ğ°Ñ‚Ñ‹
React.useEffect(() => {
  setAdviceTrigger(null);
  setAdviceExpanded(false);
  setToastVisible(false);
  // Ğ¡Ğ±Ñ€Ğ¾Ñ session ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²
  if (window.HEYS?.advice?.resetSessionAdvices) {
    window.HEYS.advice.resetSessionAdvices();
  }
}, [curDate]);

// Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºĞ¸
React.useEffect(() => {
  if (uiState.modalOpen || uiState.searchOpen) {
    setAdviceTrigger(null);
    setAdviceExpanded(false);
    setToastVisible(false);
  }
}, [uiState.modalOpen, uiState.searchOpen]);

// Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ toast (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ visible)
// âš ï¸ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ role="alert" Ğ´Ğ»Ñ accessibility Ğ¸ haptic Ğ´Ğ»Ñ feedback
toastVisible && primary && React.createElement('div', { 
  className: `macro-toast macro-toast-${primary.type} ${adviceExpanded ? 'expanded' : ''} ${toastVisible ? 'visible' : ''}`,
  role: 'alert',
  'aria-live': 'polite',
  onClick: () => adviceCount > 1 && setAdviceExpanded(!adviceExpanded)
},
  // ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ÑĞ¾Ğ²ĞµÑ‚
  React.createElement('div', { className: 'macro-toast-main' },
    React.createElement('span', { className: 'macro-toast-icon' }, primary.icon),
    React.createElement('span', { className: 'macro-toast-text' }, primary.text),
    adviceCount > 1 && React.createElement('span', { 
      className: 'macro-toast-badge' 
    }, `+${adviceCount - 1}`)
  ),
  
  // Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ (Ğ¿Ñ€Ğ¸ Ñ€Ğ°ÑĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸)
  adviceExpanded && React.createElement('div', { className: 'macro-toast-extras' },
    (relevant || []).slice(1, 4).map(advice => 
      React.createElement('div', { 
        key: advice.id,
        className: `macro-toast-extra macro-toast-extra-${advice.type}`
      },
        React.createElement('span', null, advice.icon),
        React.createElement('span', null, advice.text)
      )
    )
  )
)
```

### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 3: CSS Ğ´Ğ»Ñ Expandable Toast Ñ Ğ°Ğ²Ñ‚Ğ¾ÑĞºÑ€Ñ‹Ñ‚Ğ¸ĞµĞ¼

**Ğ“Ğ´Ğµ**: `apps/web/styles/main.css`

**âš ï¸ Ğ’ĞĞ–ĞĞ**: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞŸĞĞ¡Ğ›Ğ• ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… `.macro-toast-*` ÑÑ‚Ğ¸Ğ»ĞµĞ¹ (Ğ¿Ğ¾ÑĞ»Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ ~4935)

```css
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPANDABLE ADVICE TOAST WITH AUTO-HIDE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* ĞĞ¾Ğ²Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ toast */
.macro-toast-fiber {
  border-left: 4px solid #22c55e;
  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
}

.macro-toast-tip {
  border-left: 4px solid #3b82f6;
  background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
}

.macro-toast-achievement {
  border-left: 4px solid #f59e0b;
  background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
  animation: achievementPulse 0.5s ease-out;
}

@keyframes achievementPulse {
  0% { transform: translateX(-50%) scale(0.9); }
  50% { transform: translateX(-50%) scale(1.05); }
  100% { transform: translateX(-50%) scale(1); }
}

/* Dark theme Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² */
[data-theme="dark"] .macro-toast-fiber {
  background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
  border-left-color: #10b981;
}

[data-theme="dark"] .macro-toast-tip {
  background: linear-gradient(135deg, #1e3a5f 0%, #1e40af 100%);
  border-left-color: #3b82f6;
}

[data-theme="dark"] .macro-toast-achievement {
  background: linear-gradient(135deg, #78350f 0%, #92400e 100%);
  border-left-color: #f59e0b;
}

/* Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ğ¾Ğ³Ğ¾ toast */
.macro-toast {
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.32, 0.72, 0, 1);
}

.macro-toast.expanded {
  bottom: 90px;
  max-height: 300px;
  border-radius: 16px;
}

.macro-toast-main {
  display: flex;
  align-items: center;
  gap: 10px;
}

.macro-toast-badge {
  background: rgba(255, 255, 255, 0.3);
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  margin-left: auto;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

.macro-toast-extras {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid rgba(255, 255, 255, 0.2);
  animation: slideDown 0.2s ease-out;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.macro-toast-extra {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  font-size: 13px;
}

.macro-toast-extra-warning { background: rgba(239, 68, 68, 0.2); }
.macro-toast-extra-achievement { background: rgba(234, 179, 8, 0.2); }
.macro-toast-extra-tip { background: rgba(59, 130, 246, 0.2); }
.macro-toast-extra-fiber { background: rgba(34, 197, 94, 0.2); }

/* Mobile: Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ ÑˆĞ¸Ñ€Ğ¸Ğ½Ñƒ Ğ¸ Ğ²Ñ‹ÑĞ¾Ñ‚Ñƒ */
@media (max-width: 480px) {
  .macro-toast {
    max-width: calc(100vw - 24px);
    font-size: 13px;
  }
  
  .macro-toast.expanded {
    max-height: 250px;
    overflow-y: auto;
  }
  
  .macro-toast-extras {
    max-height: 150px;
    overflow-y: auto;
  }
  
  .macro-toast-extra {
    font-size: 12px;
    padding: 6px 10px;
  }
}

/* Accessibility: Ñ€Ğ¾Ğ»ÑŒ alert Ğ´Ğ»Ñ screen readers */
.macro-toast[role="alert"] {
  /* Ğ¡Ñ‚Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¸ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ */
}
```

### Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 4: Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ² DayTab

**Ğ“Ğ´Ğµ**: `apps/web/heys_day_v12.js` Ğ¸ `apps/web/index.html`

#### 4.1 Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ² index.html

**ĞŸĞ•Ğ Ğ•Ğ”** `heys_day_v12.js`:
```html
<script defer src="heys_advice_v1.js?v=1" fetchpriority="low"></script>
```

#### 4.2 Ğ’ DayTab:
1. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ `const [adviceExpanded, setAdviceExpanded] = React.useState(false);`
2. Ğ’Ñ‹Ğ·Ğ²Ğ°Ñ‚ÑŒ `useAdviceEngine` Ñ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ°Ğ¼Ğ¸
3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ useEffect Ğ´Ğ»Ñ onShow (ÑĞ¼. Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 2)
4. Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ toast Ğ½Ğ° expandable Ğ²ĞµÑ€ÑĞ¸Ñ
5. **Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ macroTip useMemo** â€” Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ² Ğ¼Ğ¾Ğ´ÑƒĞ»Ğµ

#### 4.3 Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´Ğ°Ğ»Ğ¾Ğº

```javascript
// Ğ’ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°Ñ… Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Ğ¼Ğ¾Ğ´Ğ°Ğ»Ğ¾Ğº Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ:
setAdviceExpanded(false);
```

---

## âœ… Definition of Done

### Core Engine
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½ `heys_advice_v1.js` Ñ Ğ´Ğ²Ğ¸Ğ¶ĞºĞ¾Ğ¼ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
- [ ] Ğ’ÑĞµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ¸Ğ¼ĞµÑÑ‚ `triggers[]` Ğ¸ `ttl`
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ñ‚Ñ€ĞµĞºĞµÑ€ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² (sessionStorage)
- [ ] Cooldown 30 ÑĞµĞº Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ¼Ğ¸
- [ ] MAX_ADVICES_PER_SESSION = 10

### ğŸ§  Smart Timing (Deep Psychology)
- [ ] `getToneForHour()` â€” Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¾Ğ½Ğ° Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
- [ ] `getEmotionalState()` â€” Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ (stressed, crashed, success)
- [ ] `getSpecialDay()` â€” Ğ¾ÑĞ¾Ğ±Ñ‹Ğµ Ğ´Ğ½Ğ¸ (Ğ¿Ğ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº, Ğ¿ÑÑ‚Ğ½Ğ¸Ñ†Ğ°, ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ³Ğ¾Ğ´)
- [ ] `isUserBusy()` â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ°Ğ½ÑÑ‚Ğ¾ÑÑ‚Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
- [ ] `filterByEmotionalState()` â€” ÑƒĞ±Ğ¸Ñ€Ğ°Ñ‚ÑŒ warnings Ğ¿Ñ€Ğ¸ ÑÑ‚Ñ€ĞµÑÑĞµ/ÑÑ€Ñ‹Ğ²Ğµ
- [ ] ĞĞ¾Ñ‡ÑŒÑ (23:00-6:00) â€” ĞĞ˜ĞšĞĞšĞ˜Ğ¥ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² (tone === 'silent')

### UI Integration
- [ ] ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° `uiState` Ğ² useAdviceEngine
- [ ] Ğ—Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ (500ms product_added, 1500ms tab_open)
- [ ] Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ¿Ñ€Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºĞ¸/Ğ¿Ğ¾Ğ¸ÑĞºĞ°
- [ ] Expandable Toast UI + Ğ°Ğ²Ñ‚Ğ¾ÑĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ¿Ğ¾ TTL
- [ ] CSS Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ÑĞ²Ğ»ĞµĞ½Ğ¸Ñ/Ğ¸ÑÑ‡ĞµĞ·Ğ½Ğ¾Ğ²ĞµĞ½Ğ¸Ñ

### Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ÑĞ¼
- [ ] `welcome_back` â€” Ğ¿Ñ€Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ¾ÑĞ»Ğµ 2+ Ğ´Ğ½ĞµĞ¹
- [ ] `crash_support` â€” Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¿Ñ€Ğ¸ ÑÑ€Ñ‹Ğ²Ğµ (>150% ĞºĞºĞ°Ğ»)
- [ ] `stress_support` â€” Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ½Ğ¸Ğ·ĞºĞ¾Ğ¼ mood
- [ ] `monday_motivation` â€” Ğ¿Ğ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº ÑƒÑ‚Ñ€Ğ¾
- [ ] `friday_reminder` â€” Ğ¿ÑÑ‚Ğ½Ğ¸Ñ†Ğ° Ğ²ĞµÑ‡ĞµÑ€
- [ ] `sunday_planning` â€” Ğ²Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ Ğ²ĞµÑ‡ĞµÑ€

### Cleanup
- [ ] macroTip useMemo Ğ£Ğ”ĞĞ›ĞĞ
- [ ] `pnpm type-check && pnpm build` Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ñ‚

---

## ğŸš« ĞĞ• Ğ”Ğ•Ğ›ĞĞ¢Ğ¬

- âŒ ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½ÑƒÑ fixed Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ (ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚ z-index Ñ Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºĞ°Ğ¼Ğ¸)
- âŒ Side effects Ğ² useMemo (React Strict Mode)
- âŒ Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¾Ñ‚ window.fmtDate (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ inline formatDate)
- âŒ Dark theme CSS (light Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾, toast ÑƒĞ¶Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ ÑĞ²Ğ¾Ğ¸ Ñ†Ğ²ĞµÑ‚Ğ°)
- âŒ ĞŸĞµÑ€ĞµÑƒÑĞ»Ğ¾Ğ¶Ğ½ÑÑ‚ÑŒ â€” ÑÑ‚Ğ¾ Ğ½Ğµ AI engine
- âŒ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ¿ĞµÑ€ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² Ğ² localStorage
- âŒ Ğ”ĞµĞ»Ğ°Ñ‚ÑŒ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ ĞºĞ»Ğ¸ĞºĞ°Ğ±ĞµĞ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸ÑĞ¼Ğ¸ (Ğ¿Ğ¾ĞºĞ°)
- âŒ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ·Ğ²ÑƒĞºĞ¸/Ğ²Ğ¸Ğ±Ñ€Ğ°Ñ†Ğ¸Ñ
- âŒ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½ÑƒÑ Ğ²ĞºĞ»Ğ°Ğ´ĞºÑƒ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²

---

## ğŸ”® Ğ‘ÑƒĞ´ÑƒÑ‰Ğ¸Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ (Ğ½Ğµ Ğ² ÑÑ‚Ğ¾Ğ¼ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğµ)

1. **Daily Summary** â€” Ğ¸Ñ‚Ğ¾Ğ³Ğ¸ Ğ´Ğ½Ñ Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼ (Ğ¿Ğ¾ÑĞ»Ğµ 21:00)
2. **ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** â€” ÑƒÑ‡Ñ‘Ñ‚ Ğ¿Ñ€ĞµĞ´Ğ¿Ğ¾Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
3. **Ğ¢Ñ€ĞµĞ½Ğ´Ñ‹** â€” ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºĞ¸ Ğ²ĞµÑĞ°/ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹
4. **ĞœĞ¸ĞºÑ€Ğ¾Ğ½ÑƒÑ‚Ñ€Ğ¸ĞµĞ½Ñ‚Ñ‹** â€” ĞºĞ¾Ğ³Ğ´Ğ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ Ğ²Ğ¸Ñ‚Ğ°Ğ¼Ğ¸Ğ½Ğ°Ğ¼
5. **Inline ÑĞ¾Ğ²ĞµÑ‚Ñ‹** â€” Ğ¿Ğ¾ĞºĞ°Ğ· Ñ€ÑĞ´Ğ¾Ğ¼ Ñ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ (ÑĞ¾Ğ²ĞµÑ‚ Ğ¾ Ğ±ĞµĞ»ĞºĞµ â†’ Ñ€ÑĞ´Ğ¾Ğ¼ Ñ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¾Ğ¹ Ğ±ĞµĞ»ĞºĞ°)

---

## ğŸ”— Ğ¡Ğ²ÑĞ·ÑŒ Ñ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¼ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼

**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ**: Ğ­Ñ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ [2025-11-28-smart-toast-recommendations.md](./2025-11-28-smart-toast-recommendations.md) ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ°:
- ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚: Ğ±Ğ°Ğ³Ñ„Ğ¸ĞºÑ `prot/protein` + Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ CSS Ñ‚Ğ¸Ğ¿Ğ¾Ğ² toast
- Ğ­Ñ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚: Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² + expandable UI

**ĞŸĞ¾ÑĞ»Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ¾Ğ±Ğ¾Ğ¸Ñ…**: macroTip useMemo Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ ÑƒĞ´Ğ°Ğ»ÑĞµÑ‚ÑÑ, Ğ²ÑÑ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ² `heys_advice_v1.js`

---

**Ğ’Ñ€ĞµĞ¼Ñ**: ~2-3 Ñ‡Ğ°ÑĞ°
**Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ**: Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ
**Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸**: Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° 2025-11-28-smart-toast-recommendations.md
