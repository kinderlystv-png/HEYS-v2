# –£–ª—É—á—à–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –∫–∞–ª–æ—Ä–∏–π v2

> **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π  
> **–í—Ä–µ–º—è**: ~60 –º–∏–Ω—É—Ç  
> **–§–∞–π–ª—ã**: `heys_day_v12.js`, `heys_day_utils.js`, `main.css`

---

## üîç –ê—É–¥–∏—Ç –ø—Ä–æ–º–ø—Ç–∞

### ‚úÖ –ß—Ç–æ —Ö–æ—Ä–æ—à–æ
- –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Ñ–∞–∑—ã
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞ –∏ —Ä–∞–∑–º–µ—Ä—ã
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏ —Å –∫–æ–¥–æ–º

### üî¥ –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–µ—Ä—ã (–≤—ã—è–≤–ª–µ–Ω—ã)

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–∏—Å–∫ | –†–µ—à–µ–Ω–∏–µ |
|----------|------|---------|
| `getActiveDaysForMonth()` –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `moodAvg` | Mood-–ø–æ–ª–æ—Å–∞ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å | –î–æ–±–∞–≤–∏—Ç—å –≤ –§–∞–∑—É 0 |
| `forecastPts` –Ω–µ –∏–º–µ–µ—Ç `date` | –ù–µ–ª—å–∑—è –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞—Ç—ã –ø—Ä–æ–≥–Ω–æ–∑–∞ | –í—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ |
| Slider state –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å popup | –î–≤–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø–æ–∫–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç slider > popup |
| `chartTransitioning` —É–∂–µ –µ—Å—Ç—å, –Ω–æ fade | Morph —Ç—Ä–µ–±—É–µ—Ç –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CSS transitions |
| Touch –Ω–∞ mobile vs mouse –Ω–∞ desktop | –†–∞–∑–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è | –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ pointer events |
| 30 –¥–Ω–µ–π = 30 —Ç–æ—á–µ–∫ = –ø–µ—Ä–µ–≥—Ä—É–∑ | Slider —Å 30 —Ç–æ—á–∫–∞–º–∏ —Ç—è–∂—ë–ª—ã–π | Throttle + nearest point |

### üü° –û–≤–µ—Ä–∫–∏–ª-—Ä–∏—Å–∫–∏

| –§–∏—á–∞ | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|--------|-------------|
| Mood-–ø–æ–ª–æ—Å–∞ | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π | –ï—Å–ª–∏ –Ω–µ—Ç mood –¥–∞–Ω–Ω—ã—Ö ‚Äî fallback –Ω–∞ heatmap |
| CSS path morphing | ‚ö†Ô∏è –í—ã—Å–æ–∫–∏–π | –ù–µ –≤—Å–µ –±—Ä–∞—É–∑–µ—Ä—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç `d` transition |
| –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π slider | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π | –ú–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å scroll –Ω–∞ mobile |

### üí° WOW-–∏–¥–µ–∏ (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã 2024-2025)

1. **Haptic feedback –ø—Ä–∏ slider** ‚Äî –≤–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏
2. **Confetti –ø—Ä–∏ streak ‚â•5** ‚Äî –º–∏–Ω–∏-–∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –∞–Ω–∏–º–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. **Glassmorphism tooltip** ‚Äî blur-—ç—Ñ—Ñ–µ–∫—Ç –∫–∞–∫ –≤ iOS
4. **Micro-animations** ‚Äî bounce —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Ç–æ—á–µ–∫

---

## –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (5 –º–∏–Ω) üÜï

### 0.1 –†–∞—Å—à–∏—Ä–∏—Ç—å `getActiveDaysForMonth()` –¥–ª—è mood
- [ ] –î–æ–±–∞–≤–∏—Ç—å `moodAvg` –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π –æ–±—ä–µ–∫—Ç
- [ ] –ß–∏—Ç–∞—Ç—å –∏–∑ `dayInfo.moodAvg` (—É–∂–µ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –≤ DayTab)
- [ ] Fallback: `null` –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö

```javascript
// –í heys_day_utils.js ‚Üí getActiveDaysForMonth()
daysData.set(dateStr, { 
  kcal: dayInfo.kcal, 
  target, 
  ratio, 
  hasTraining, 
  trainingTypes,
  moodAvg: dayInfo.moodAvg || null  // üÜï
});
```

### 0.2 –î–æ–±–∞–≤–∏—Ç—å `date` –≤ forecastPts
- [ ] –í—ã—á–∏—Å–ª–∏—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –¥–∞—Ç—É –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–Ω—è –¥–∞–Ω–Ω—ã—Ö
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `addDays` –∏–ª–∏ inline —Ñ–æ—Ä–º—É–ª—É

### 0.3 –°–æ–∑–¥–∞—Ç—å helper –¥–ª—è weekend/holiday
- [ ] `isWeekend(dateStr)` –∏ `isHoliday(dateStr)` ‚Äî –≤ –Ω–∞—á–∞–ª–æ `renderSparkline`
- [ ] –î–æ–±–∞–≤–∏—Ç—å `isWeekend` —Ñ–ª–∞–≥ –≤ –∫–∞–∂–¥—É—é —Ç–æ—á–∫—É

---

## –§–∞–∑–∞ 1: –í–∏–∑—É–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (15 –º–∏–Ω)

### 1.1 –ó–æ–ª–æ—Ç–∞—è –ª–∏–Ω–∏—è streak –º–µ–∂–¥—É üî•
- [ ] –ù–∞–π—Ç–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –¥–Ω–∏ —Å `isPerfect === true` (‚â•2 –ø–æ–¥—Ä—è–¥)
- [ ] –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –∑–æ–ª–æ—Ç—É—é –ª–∏–Ω–∏—é (`#f59e0b`) –ü–û–í–ï–†–• –æ—Å–Ω–æ–≤–Ω–æ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–≤–µ—á–µ–Ω–∏–µ: `filter: drop-shadow(0 0 4px rgba(245,158,11,0.6))`
- [ ] –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è: `stroke-dashoffset` –∫–∞–∫ —É –æ—Å–Ω–æ–≤–Ω–æ–π –ª–∏–Ω–∏–∏
- [ ] CSS –∫–ª–∞—Å—Å `.sparkline-streak-line`

### 1.2 –î–∞—Ç—ã —Å —Ä–∞–∑–Ω—ã–º –≤–µ—Å–æ–º —à—Ä–∏—Ñ—Ç–∞
- [ ] –û—Å–Ω–æ–≤–Ω—ã–µ –¥–Ω–∏: `font-weight: 600`
- [ ] –ü—Ä–æ–≥–Ω–æ–∑–Ω—ã–µ –¥–Ω–∏: `font-weight: 300`, `opacity: 0.5`, –∫—É—Ä—Å–∏–≤
- [ ] CSS –∫–ª–∞—Å—Å—ã: `.sparkline-day-label` (base), `.sparkline-day-forecast`

### 1.3 –í—ã—Ö–æ–¥–Ω—ã–µ –∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏ –∫—Ä–∞—Å–Ω—ã–º
- [ ] –î–æ–±–∞–≤–∏—Ç—å `isWeekend` –≤ –∫–∞–∂–¥—É—é —Ç–æ—á–∫—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- [ ] –°—É–±–±–æ—Ç–∞ (6) –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ (0) ‚Äî `fill: #ef4444`
- [ ] –ü—Ä–∞–∑–¥–Ω–∏–∫–∏ –†–§ ‚Äî —Ç–æ–∂–µ –∫—Ä–∞—Å–Ω—ã–º
- [ ] CSS –∫–ª–∞—Å—Å `.sparkline-day-weekend`

---

## –§–∞–∑–∞ 2: –ê–Ω–∏–º–∞—Ü–∏–∏ (10 –º–∏–Ω)

### 2.1 –£–ª—É—á—à–µ–Ω–Ω—ã–π transition –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–µ—Ä–∏–æ–¥–∞
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `chartTransitioning` state
- [ ] –ü—Ä–∏ `true`: opacity 0.3 + scale 0.98
- [ ] –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 200ms ease-out
- [ ] CSS: `.sparkline-svg.transitioning { opacity: 0.3; transform: scale(0.98); }`

**‚ö†Ô∏è –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CSS `d` transition** ‚Äî –ø–ª–æ—Ö–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±—Ä–∞—É–∑–µ—Ä–æ–≤!

---

## –§–∞–∑–∞ 3: Mood-–ø–æ–ª–æ—Å–∞ (10 –º–∏–Ω)

### 3.1 –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–∞—è –ø–æ–ª–æ—Å–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ mood –¥–∞–Ω–Ω—ã—Ö: `points.some(p => p.moodAvg != null)`
- [ ] –ï—Å–ª–∏ –µ—Å—Ç—å mood ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å mood-–ø–æ–ª–æ—Å—É
- [ ] –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å heatmap –∫–∞–ª–æ—Ä–∏–π (–∫–∞–∫ —Å–µ–π—á–∞—Å)

**–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ mood:**
| –ó–Ω–∞—á–µ–Ω–∏–µ | –≠–º–æ–¥–∑–∏ | –¶–≤–µ—Ç |
|----------|--------|------|
| null | ‚Äî | `#e2e8f0` (—Å–µ—Ä—ã–π) |
| 1-2 | üò¢ | `#94a3b8` (—Å–µ—Ä—ã–π) |
| 3 | üòê | `#fbbf24` (–∂—ë–ª—Ç—ã–π) |
| 4-5 | üòä | `#22c55e` (–∑–µ–ª—ë–Ω—ã–π) |

- [ ] –°–æ–∑–¥–∞—Ç—å `<linearGradient id="moodGradient">` —Å stops –ø–æ —Ç–æ—á–∫–∞–º
- [ ] `<rect>` —Å —ç—Ç–∏–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º, –≤—ã—Å–æ—Ç–∞ 6px, —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ –∫—Ä–∞—è

---

## –§–∞–∑–∞ 4: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π slider (15 –º–∏–Ω)

### 4.1 State –¥–ª—è slider
- [ ] `const [sliderPoint, setSliderPoint] = useState(null)`
- [ ] –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –µ—Å–ª–∏ slider –∞–∫—Ç–∏–≤–µ–Ω ‚Üí –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å popup

### 4.2 Pointer events (—É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `onPointerMove` –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö touch/mouse
- [ ] `onPointerDown` ‚Üí –Ω–∞—á–∞—Ç—å tracking
- [ ] `onPointerMove` ‚Üí –Ω–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à—É—é —Ç–æ—á–∫—É
- [ ] `onPointerUp` / `onPointerLeave` ‚Üí —Å–∫—Ä—ã—Ç—å slider

```javascript
const handlePointerMove = (e) => {
  const svg = e.currentTarget;
  const rect = svg.getBoundingClientRect();
  const x = (e.clientX - rect.left) * (width / rect.width);
  
  // –ù–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à—É—é —Ç–æ—á–∫—É
  const nearest = points.reduce((prev, curr) => 
    Math.abs(curr.x - x) < Math.abs(prev.x - x) ? curr : prev
  );
  
  setSliderPoint(nearest);
  haptic('selection'); // –ª—ë–≥–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–æ—á–∫–∏
};
```

### 4.3 –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã slider
- [ ] –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è –æ—Ç top –¥–æ bottom: `stroke: #94a3b8`, `stroke-width: 1`
- [ ] –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞: `r: 6` –≤–º–µ—Å—Ç–æ `r: 2.5`
- [ ] Glassmorphism tooltip —Å–≤–µ—Ä—Ö—É

**Glassmorphism tooltip CSS:**
```css
.sparkline-slider-tooltip {
  background: rgba(255, 255, 255, 0.85);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 8px;
  padding: 4px 8px;
  font-size: 11px;
  font-weight: 600;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
```

### 4.4 Throttle –¥–ª—è performance
- [ ] Throttle `onPointerMove` –¥–æ 16ms (60fps)
- [ ] –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å: –µ—Å–ª–∏ nearest === prev, –Ω–µ –æ–±–Ω–æ–≤–ª—è—Ç—å

---

## –§–∞–∑–∞ 5: Polish & Details (5 –º–∏–Ω) üÜï

### 5.1 Haptic feedback
- [ ] –ü—Ä–∏ slider –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏: `haptic('selection')`
- [ ] –ü—Ä–∏ tap –Ω–∞ üî•: `haptic('medium')` (—É–∂–µ –µ—Å—Ç—å ‚úÖ)

### 5.2 Dark mode —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–≤–µ—Ç–∞ streak/mood –≤ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ
- [ ] Glassmorphism tooltip: `rgba(30, 30, 30, 0.85)` –¥–ª—è dark

---

## –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ß—Ç–æ –º–µ–Ω—è—Ç—å |
|------|------------|
| `apps/web/heys_day_utils.js` | `getActiveDaysForMonth()` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `moodAvg` |
| `apps/web/heys_day_v12.js` | `renderSparkline()` ‚Äî streak, dates, weekend, slider |
| `apps/web/styles/main.css` | –ù–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã + glassmorphism tooltip |

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏

**Streak detection:**
```javascript
const findStreaks = (points) => {
  const streaks = [];
  let current = [];
  
  points.forEach((p) => {
    if (p.isPerfect && p.kcal > 0) {
      current.push(p);
    } else {
      if (current.length >= 2) streaks.push([...current]);
      current = [];
    }
  });
  if (current.length >= 2) streaks.push(current);
  return streaks;
};
```

**Weekend/Holiday check:**
```javascript
const RU_HOLIDAYS = [
  '01-01', '01-02', '01-03', '01-04', '01-05', '01-06', '01-07', '01-08',
  '02-23', '03-08', '05-01', '05-09', '06-12', '11-04'
];

const isWeekend = (dateStr) => {
  const day = new Date(dateStr).getDay();
  return day === 0 || day === 6;
};

const isHoliday = (dateStr) => RU_HOLIDAYS.includes(dateStr.slice(5));
```

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –ó–æ–ª–æ—Ç–∞—è –ª–∏–Ω–∏—è —Å–æ–µ–¥–∏–Ω—è–µ—Ç üî• –¥–Ω–∏ —Å–æ —Å–≤–µ—á–µ–Ω–∏–µ–º
- [ ] –ü—Ä–æ–≥–Ω–æ–∑–Ω—ã–µ –¥–∞—Ç—ã ‚Äî —Ä–µ–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–∞, —Ç–æ–Ω–∫–∏–º —à—Ä–∏—Ñ—Ç–æ–º
- [ ] –í—ã—Ö–æ–¥–Ω—ã–µ –∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏ –∫—Ä–∞—Å–Ω—ã–º —Ü–≤–µ—Ç–æ–º
- [ ] –ü–ª–∞–≤–Ω—ã–π fade –ø—Ä–∏ —Å–º–µ–Ω–µ 7–¥/14–¥/30–¥
- [ ] Mood-–ø–æ–ª–æ—Å–∞ –≤–º–µ—Å—Ç–æ heatmap (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ)
- [ ] Slider —Å glassmorphism tooltip –∏ haptic
- [ ] `pnpm type-check && pnpm build` –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] Dark mode –Ω–µ —Å–ª–æ–º–∞–Ω

---

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```
–§–∞–∑–∞ 0 (–¥–∞–Ω–Ω—ã–µ) ‚Üí –§–∞–∑–∞ 1 (–≤–∏–∑—É–∞–ª) ‚Üí –§–∞–∑–∞ 2 (–∞–Ω–∏–º–∞—Ü–∏–∏) ‚Üí 
–§–∞–∑–∞ 3 (mood) ‚Üí –§–∞–∑–∞ 4 (slider) ‚Üí –§–∞–∑–∞ 5 (polish)
```

–ö–∞–∂–¥–∞—è —Ñ–∞–∑–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–æ–π `pnpm build`.
