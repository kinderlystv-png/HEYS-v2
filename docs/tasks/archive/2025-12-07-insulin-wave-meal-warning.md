---
template-version: 3.3.0
created: 2025-12-07
updated: 2025-12-07
purpose: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø—Ä–∏—ë–º–µ –ø–∏—â–∏ –≤ –∞–∫—Ç–∏–≤–Ω—É—é –∏–Ω—Å—É–ª–∏–Ω–æ–≤—É—é –≤–æ–ª–Ω—É
optimization: HEYS-v2 legacy web (apps/web)
audit-status: ‚úÖ –ì–ª—É–±–æ–∫–∏–π –∞—É–¥–∏—Ç –ø—Ä–æ–≤–µ–¥—ë–Ω
---

# Task: –ò–Ω—Å—É–ª–∏–Ω–æ–≤–∞—è –≤–æ–ª–Ω–∞ ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏—ë–º–∞

> **Workflow Hint**: Strategic ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç, –¥–µ–ª–∞–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ —á–µ–∫-–ª–∏—Å—Ç—É.

## üéØ WHY (–ë–∏–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç)

**Problem**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∑–Ω–∞—á–∏—Ç—å –≤—Ä–µ–º—è –ø—Ä–∏—ë–º–∞ –ø–∏—â–∏ –≤ –∞–∫—Ç–∏–≤–Ω—É—é –∏–Ω—Å—É–ª–∏–Ω–æ–≤—É—é –≤–æ–ª–Ω—É (–¥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –ª–∏–ø–æ–ª–∏–∑–∞), —Å–Ω–∏–∂–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏—è.

**Impact**: –ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –¥–µ—Ñ–∏—Ü–∏—Ç–µ/–ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–∏, —É—Ö—É–¥—à–∞–µ—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—é.

**Value**: –°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π –ø–æ–≤—ã—à–∞–µ—Ç –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å –∏ —É–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

## ü§ñ Output Preferences

**Workflow**: Implement directly (—Å–Ω–∞—á–∞–ª–∞ —á–µ–∫-–ª–∏—Å—Ç ‚Üí —Å—Ä–∞–∑—É –∫–æ–¥)

**Code style**: Follow copilot-instructions.md (legacy JS, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º)

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ö–û–ù–¢–ï–ö–°–¢ (–∏–∑ –∞—É–¥–∏—Ç–∞)

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ‚Äî –ù–ï –î–£–ë–õ–ò–†–û–í–ê–¢–¨!

| –ú–æ–¥—É–ª—å | –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å | –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|--------|--------------|------------------|
| `heys_insulin_wave_v1.js` | –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –≤–æ–ª–Ω—ã (16 —Ñ–∞–∫—Ç–æ—Ä–æ–≤: –ì–ò, –∂–∏—Ä—ã, –±–µ–ª–æ–∫, —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, —Å—Ç—Ä–µ—Å—Å, —Å–æ–Ω –∏ —Ç.–¥.) | **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `HEYS.InsulinWave.calculate()`** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤–æ–ª–Ω—ã |
| `heys_meal_step_v1.js` | Flow –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏—ë–º–∞ (wheel picker, —à–∞–≥–∏) | **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ó–î–ï–°–¨**, –Ω–µ –≤ `heys_day_v12.js` |
| `heys_advice_v1.js` | –°–æ–≤–µ—Ç `insulin_too_fast` –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ | –≠—Ç–æ POST-factum —Å–æ–≤–µ—Ç, –Ω–∞—à ‚Äî PRE-emptive –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ |

### –ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–ù–ï —É–ø—Ä–æ—â–∞—Ç—å!)

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞):
if (selectedTime < lastMealTime + insulinWaveHours) { /* warn */ }

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Ä–∞—Å—á—ë—Ç:
const waveData = HEYS.InsulinWave.calculate({
  meals, pIndex, getProductFromItem, 
  baseWaveHours: prof?.insulinWaveHours || 3,
  trainings: day.trainings,
  dayData: day
});

if (waveData && waveData.status !== 'lipolysis') {
  // –í–æ–ª–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
  const remainingMinutes = waveData.remaining;
  const endTime = waveData.endTimeDisplay;
}
```

---

## üìã WHAT (–ß–µ–∫-–ª–∏—Å—Ç –∑–∞–¥–∞—á)

### Phase 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–±–ª–æ–∫–µ—Ä—ã)

- [x] **–ü—Ä–æ–≤–µ—Ä–∫–∞ API** ‚Äî –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `HEYS.InsulinWave.calculate()` –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞ –∏–∑ `heys_meal_step_v1.js`
  - **How**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ `index.html`
  - **Done**: `heys_insulin_wave_v1.js` (—Å—Ç—Ä–æ–∫–∞ 248) –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –î–û `heys_meal_step_v1.js` (—Å—Ç—Ä–æ–∫–∞ 252) ‚úÖ

- [x] **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö** ‚Äî –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã `pIndex`, `getProductFromItem`, `day.trainings`, `day.deficitPct`/`prof.deficitPctTarget`
  - **How**: –ü–µ—Ä–µ–¥–∞—Ç—å —á–µ—Ä–µ–∑ `showAddMealModal()` ‚Üí `context` ‚Üí `MealTimeStep`
  - **Done**: –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `heys_day_v12.js` –∏ `heys_meal_step_v1.js` ‚úÖ

- [x] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è UI** ‚Äî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `HEYS.InsulinWave.renderProgressBar` –¥–æ—Å—Ç—É–ø–µ–Ω (—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω) –∏ –º–æ–∂–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ StepModal
  - **How**: –ö–æ–Ω—Å–æ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `HEYS.InsulinWave.renderProgressBar`
  - **Done**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º fallback ‚úÖ

- [x] **React/Tailwind –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å** ‚Äî StepModal –¥–æ–ø—É—Å–∫–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å Tailwind –∫–ª–∞—Å—Å–∞–º–∏ –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å—Ç–∏–ª–µ–π
  - **Done**: Tailwind –∫–ª–∞—Å—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ

- [x] **–î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º** ‚Äî –ü–æ–ª—É—á–∏—Ç—å –≤ `MealTimeStep` –¥–æ—Å—Ç—É–ø –∫: `meals`, `pIndex`, `getProductFromItem`, `prof`, `day`
  - **How**: –ü–µ—Ä–µ–¥–∞—Ç—å —á–µ—Ä–µ–∑ `context` –≤ `showAddMealModal()`
  - **Done**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å fallback –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã ‚úÖ

### Phase 1: Must Have (MVP)

- [x] **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–∫—Ä–æ–ª–ª–µ** ‚Äî `apps/web/heys_meal_step_v1.js` ‚Üí –≤ `MealTimeStepComponent` –ø—Ä–∏ **–ø–µ—Ä–≤–æ–º —Å–∫—Ä–æ–ª–ª–µ –∫–æ–ª–µ—Å–∞ –≤—Ä–µ–º–µ–Ω–∏** –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –ø–æ–ø–∞–¥–∞–µ—Ç –ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤ –∞–∫—Ç–∏–≤–Ω—É—é –≤–æ–ª–Ω—É
  - **Done**: `maybeShowInsulinWaveWarning()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `updateHours` –∏ `updateMinutes` ‚úÖ
  - **Trigger**: –ü–µ—Ä–≤—ã–π `onChange` —Å–æ–±—ã—Ç–∏—è wheel picker (–ù–ï –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–∫—Ä–æ–ª–ª–µ, —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —Ä–∞–∑)
  - **Scope**: –¢–æ–ª—å–∫–æ –¥–ª—è **–Ω–æ–≤–æ–≥–æ –ø—Ä–∏—ë–º–∞**, –ù–ï –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `isEditMode` ‚úÖ

- [x] **UI –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π InsulinWave** ‚Äî –ú–æ–¥–∞–ª–∫–∞ —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –≤–∏–¥–∂–µ—Ç–æ–º –∏–Ω—Å—É–ª–∏–Ω–æ–≤–æ–π –≤–æ–ª–Ω—ã
  - **Done**: Tailwind overlay —Å `insulinWave.renderProgressBar(cachedWave)` + —Ç–µ–∫—Å—Ç–æ–≤—ã–π fallback ‚úÖ
  - **Integration**: –ö–Ω–æ–ø–∫–∏ ¬´–ü–æ–¥–æ–∂–¥–∞—Ç—å¬ª (–∑–∞–∫—Ä—ã–≤–∞–µ—Ç flow) –∏ ¬´–í—Å—ë —Ä–∞–≤–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å¬ª (–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç) ‚úÖ
  - **Smart suggestion**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `cachedWave?.foodAdvice?.good` ‚úÖ

- [x] **–§–ª–∞–≥ "—É–∂–µ –ø–æ–∫–∞–∑–∞–ª–∏"** ‚Äî –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
  - **Done**: `useState hasShownWarning` + –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ `maybeShowInsulinWaveWarning` ‚úÖ
  - **Reset**: –ü—Ä–∏ –Ω–æ–≤–æ–º –≤—ã–∑–æ–≤–µ `showAddMealModal()` ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∏ state —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è ‚úÖ

### Phase 2: Should Have

- [x] **Analytics** ‚Äî –¢—Ä–µ–∫–∏–Ω–≥ –ø–æ–∫–∞–∑–∞ –∏ –≤—ã–±–æ—Ä–∞
  - **Done**: `trackInsulinEvent('show'/'wait'/'continue', wave)` —á–µ—Ä–µ–∑ `HEYS.analytics.trackDataOperation` ‚úÖ
  - **Spam guard**: –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–∫–∞–∑–µ/–¥–µ–π—Å—Ç–≤–∏–∏ (—á–µ—Ä–µ–∑ `hasShownWarning`) ‚úÖ

- [x] **Smart suggestion** ‚Äî –ü–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ –º–æ–∂–Ω–æ —Å—ä–µ—Å—Ç—å –±–µ–∑ —Å–∏–ª—å–Ω–æ–≥–æ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –≤–æ–ª–Ω—ã
  - **Done**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `cachedWave?.foodAdvice?.good` —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –ø—Ä–æ –≤–æ–¥—É/—á–∞–π ‚úÖ

### Phase 3: Could Have (WOW!)

- [ ] **Visual timeline** ‚Äî –ü–æ–∫–∞–∑–∞—Ç—å –º–∏–Ω–∏-–≥—Ä–∞—Ñ–∏–∫ –¥–Ω—è –≤ –º–æ–¥–∞–ª–∫–µ: –≤–æ–ª–Ω—ã, –ª–∏–ø–æ–ª–∏–∑, –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
  - **Why**: –í–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç–Ω–µ–µ —á–µ–º —Ç–µ–∫—Å—Ç
  - **Acceptance**: –ü—Ä–æ—Å—Ç–∞—è SVG –ø–æ–ª–æ—Å–∞ —Å —Ü–≤–µ—Ç–æ–≤—ã–º–∏ –∑–æ–Ω–∞–º–∏

- [ ] **Remind me** ‚Äî –ö–Ω–æ–ø–∫–∞ "–ù–∞–ø–æ–º–Ω–∏ —á–µ—Ä–µ–∑ X –º–∏–Ω—É—Ç" —Å Web Notification
  - **Why**: –£–¥–æ–±–Ω–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –¥–æ–∂–¥–∞—Ç—å—Å—è –ª–∏–ø–æ–ª–∏–∑–∞
  - **Acceptance**: `Notification.requestPermission()` + `setTimeout` ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

---

## ‚úÖ DONE (–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏)

### Functional

- [x] –ü—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–∫—Ä–æ–ª–ª–µ –∫–æ–ª–µ—Å–∞ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–æ–≤—ã–π –ø—Ä–∏—ë–º) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –≤–æ–ª–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞
- [x] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç—å flow –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—Ä–∏—ë–º–æ–≤ (–ø–µ—Ä–≤—ã–π –ø—Ä–∏—ë–º –¥–Ω—è)
- [x] –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –µ—Å–ª–∏ –≤–æ–ª–Ω–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å (`status === 'lipolysis'`)
- [x] –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –µ—Å–ª–∏ —Ü–µ–ª—å = –Ω–∞–±–æ—Ä –º–∞—Å—Å—ã (`deficitPct >= 10`)
- [x] –ù–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–∏—ë–º–∞
- [x] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é (—Ñ–ª–∞–≥ `hasShownWarning`)
- [x] –í –º–æ–¥–∞–ª–∫–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–∏–¥–∂–µ—Ç –∏–Ω—Å—É–ª–∏–Ω–æ–≤–æ–π –≤–æ–ª–Ω—ã (`HEYS.InsulinWave.renderProgressBar`)
- [x] –†–∞—Å—á—ë—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `HEYS.InsulinWave.calculate()` ‚Äî –≤—Å–µ 16 —Ñ–∞–∫—Ç–æ—Ä–æ–≤ —É—á—Ç–µ–Ω—ã

### Edge Cases

- [x] **–ü–µ—Ä–≤—ã–π –ø—Ä–∏—ë–º –¥–Ω—è** ‚Äî –Ω–µ—Ç –≤–æ–ª–Ω—ã, –Ω–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `mealsForWave.length === 0`)
- [x] **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏** ‚Äî –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `isEditMode`)
- [x] **–ù–æ—á–Ω–æ–π –ø—Ä–∏—ë–º (00:00-03:00)** ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `wheelIndexToHour` –∏–∑ dayUtils)
- [x] **–ù–µ—Ç pIndex/getProductFromItem** ‚Äî graceful fallback –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
- [x] **–ù–∞–±–æ—Ä –º–∞—Å—Å—ã** ‚Äî `deficitPct >= 10` –∏–ª–∏ `deficitPctTarget >= 10` ‚Üí –Ω–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `isBulkMode`)
- [x] **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ renderProgressBar** ‚Äî fallback –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –∫–æ–Ω—Ü–∞ –≤–æ–ª–Ω—ã
- [x] **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏** ‚Äî —Ñ–ª–∞–≥ `hasShownWarning` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–æ–≤–æ–º `showAddMealModal()` (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è)

### Quality Gates

- [x] **Build**: `pnpm build` PASS ‚úÖ

### UI Testing

**Mobile (iPhone SE):**
- [x] –ú–æ–¥–∞–ª–∫–∞ –≤–∏–¥–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é, –∫–Ω–æ–ø–∫–∏ ‚â•44px (`min-h-11` –¥–æ–±–∞–≤–ª–µ–Ω)
- [x] –ù–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç wheel picker (overlay –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ)

**Desktop:**
- [x] –ù–µ—Ç –∫–æ–Ω—Å–æ–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫
- [x] Keyboard: Escape –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫—É (–¥–æ–±–∞–≤–ª–µ–Ω `useEffect` —Å `handleEscape`)

### Performance

- [x] –†–∞—Å—á—ë—Ç –≤–æ–ª–Ω—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 1 —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–∫—Ä–æ–ª–ª–µ, –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –≤ `cachedWave`
- [x] Legacy —Ñ–∞–π–ª –Ω–µ –≤—ã—Ä–æ—Å —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ (~150 —Å—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ)
- [x] –ù–µ—Ç –ª–∏—à–Ω–∏—Ö `console.log` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `HEYS.analytics.trackDataOperation`)

---

## ü§ñ AI Context (Technical Specs)

### üìê Architecture

```
heys_insulin_wave_v1.js  ‚Üê –†–∞—Å—á—ë—Ç –≤–æ–ª–Ω—ã (–ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨!)
        ‚Üì
heys_meal_step_v1.js     ‚Üê Flow –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–ú–û–î–ò–§–ò–¶–ò–†–û–í–ê–¢–¨!)
        ‚Üì
heys_day_v12.js          ‚Üê –í—ã–∑–æ–≤ showAddMealModal (–ø–µ—Ä–µ–¥–∞—Ç—å context)
```

### üîë Key Files

| –§–∞–π–ª | –†–æ–ª—å | –ß—Ç–æ –¥–µ–ª–∞–µ–º |
|------|------|-----------|
| `heys_insulin_wave_v1.js` | –†–∞—Å—á—ë—Ç –≤–æ–ª–Ω—ã | –í—ã–∑—ã–≤–∞–µ–º `HEYS.InsulinWave.calculate()` |
| `heys_meal_step_v1.js` | Flow –¥–æ–±–∞–≤–ª–µ–Ω–∏—è | –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É + –º–æ–¥–∞–ª–∫—É |
| `heys_day_v12.js` | –í—ã–∑–æ–≤ –º–æ–¥–∞–ª–∫–∏ | –ü–µ—Ä–µ–¥–∞—ë–º `meals`, `pIndex`, `prof`, `day` –≤ context |

### ‚ùå Anti-Patterns

- **–ù–ï –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É —Ä–∞—Å—á—ë—Ç–∞ –≤–æ–ª–Ω—ã** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –º–æ–¥—É–ª—å
- **–ù–ï —É–ø—Ä–æ—â–∞—Ç—å —Ñ–æ—Ä–º—É–ª—É** –¥–æ `lastMealTime + insulinWaveHours`
- **–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–∫—Ä–æ–ª–ª–µ** ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º (—Ñ–ª–∞–≥ `hasShownWarning`)
- **–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏** ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–∏—ë–º–æ–≤
- **–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–ª—è –Ω–∞–±–æ—Ä–∞ –º–∞—Å—Å—ã** ‚Äî `deficitPct >= 10`

### üîó API Reference

```javascript
// –†–∞—Å—á—ë—Ç –≤–æ–ª–Ω—ã
const waveData = HEYS.InsulinWave.calculate({
  meals: day.meals,           // –ú–∞—Å—Å–∏–≤ –ø—Ä–∏—ë–º–æ–≤
  pIndex: buildProductIndex(), // –ò–Ω–¥–µ–∫—Å –ø—Ä–æ–¥—É–∫—Ç–æ–≤
  getProductFromItem: fn,     // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
  baseWaveHours: prof?.insulinWaveHours || 3,
  trainings: day.trainings || [],
  dayData: day
});

// –†–µ–∑—É–ª—å—Ç–∞—Ç
waveData = {
  status: 'active' | 'almost' | 'soon' | 'lipolysis',
  remaining: 45,              // –ú–∏–Ω—É—Ç –¥–æ –∫–æ–Ω—Ü–∞ –≤–æ–ª–Ω—ã
  endTime: '17:45',           // –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
  endTimeDisplay: '17:45',    // –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  lastMealTimeDisplay: '14:30',
  foodAdvice: { good: [...], avoid: [...], reason: '...' },
  ...
}

// –†–µ–Ω–¥–µ—Ä –≤–∏–¥–∂–µ—Ç–∞ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –º–æ–¥–∞–ª–∫—É)
const progressBarElement = HEYS.InsulinWave.renderProgressBar(waveData);
// ‚Üí React element —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º, –≤—Ä–µ–º–µ–Ω–µ–º, —Å—Ç–∞—Ç—É—Å–æ–º

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–∏ (–Ω–∞–±–æ—Ä –º–∞—Å—Å—ã)
const deficitPct = day.deficitPct ?? prof?.deficitPctTarget ?? 0;
const isBulkMode = deficitPct >= 10;
if (isBulkMode) { /* –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ */ }
```

---

## üìù Notes

- **Priority**: high
- **Complexity**: M (~60-90 –º–∏–Ω —Å —É—á—ë—Ç–æ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
- **Blockers**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ (Phase 0)
- **Related**: `insulin_too_fast` —Å–æ–≤–µ—Ç (POST-factum), –∏–Ω—Å—É–ª–∏–Ω–æ–≤—ã–π –≤–∏–¥–∂–µ—Ç
- **Created**: 2025-12-07

---

## üöÄ Usage

1. –í—ã–ø–æ–ª–Ω–∏—Ç—å Phase 0 (–±–ª–æ–∫–µ—Ä—ã)
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Phase 1 (MVP)
3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ Phase 2-3 (—É–ª—É—á—à–µ–Ω–∏—è)
4. –í PR —É–∫–∞–∑–∞—Ç—å: `Task prompt: docs/tasks/2025-12-07-insulin-wave-meal-warning.md`
5. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è ‚Üí `docs/tasks/archive/` + `done.md`
