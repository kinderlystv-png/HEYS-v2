# ะัะพะผะฟั: ะะพะดะฐะปะบะฐ ะฒะฒะพะดะฐ ะณัะฐะผะผะพะฒ ั ะดะฒัะผั ัะฟะพัะพะฑะฐะผะธ

**ะะฐัะฐ**: 2025-11-29  
**ะัะธะพัะธัะตั**: ๐ด ะััะพะบะธะน (UX ะบัะธัะธัะตะฝ ะดะปั mobile)  
**ะัะตะผั**: ~60 ะผะธะฝัั (ะฑะฐะทะพะฒัะน) + 45 ะผะธะฝัั (WOW-ัะธัะธ)  
**ะกัะฐััั**: โ **100% ะะซะะะะะะะ** โ ะฒัะต WOW-ัะธัะธ ะณะพัะพะฒั!

---

## โ ะคะะะะะฌะะซะ ะะฃะะะข (2025-11-29, v3)

### โ ะะกะ ะะะะะะะะะะะ (100%):

| # | ะคะธัะฐ | ะกัะฐััั | ะคะฐะนะป/ะกััะพะบะธ |
|---|------|--------|-------------|
| 1 | State management | โ | `gramsModalProduct`, `gramsValue`, refs (393-450) |
| 2 | Mobile flow | โ | `handleProductSelect()` โ `if (isMobile)` |
| 3 | Portal modal | โ | `ReactDOM.createPortal(...)` |
| 4 | ะกะปะฐะนะดะตั | โ | `handleGramsDrag()` ั touch + haptic |
| 5 | ะะฐะปะพัะธะธ preview | โ | ะะฑะฝะพะฒะปััััั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ |
| 6 | ะกัะธะปะธ + dark mode | โ | `.grams-modal` + `.closing` ะฐะฝะธะผะฐัะธั |
| 7 | ะะฐะฟะพะผะธะฝะฐะฝะธะต | โ | `U.lsSet('heys_last_grams_${productId}')` |
| 8 | Keyboard | โ | Enter โ confirm, Escape โ cancel |
| 9 | Haptic | โ | ะัะธ ะฟัะตัะตัะต ะธ ัะฒะฐะนะฟะต |
| 10 | **๐ Swipe-to-close** | โ | `handleGramsSheetTouchStart/Move/End` |
| 11 | **๐ CountUp ะฐะฝะธะผะฐัะธั** | โ | `animatedKcal` + requestAnimationFrame |
| 12 | **๐ ะฃะผะฝัะต ะฟัะตัะตัั** | โ | `smartGramsPresets` + `heys_grams_history` |

### ๐ ะงัะพ ะดะพะฑะฐะฒะปะตะฝะพ (WOW-ัะธัะธ):

1. **Swipe-to-close** (ัััะพะบะธ 637-670):
   - ะกะฒะฐะนะฟ ะฒะฝะธะท ะฟะพ ัััะบะต โ ะผะพะดะฐะปะบะฐ ะทะฐะบััะฒะฐะตััั
   - ะะพัะพะณ 100px, haptic ะฟัะธ ะทะฐะบัััะธะธ
   - CSS ะฐะฝะธะผะฐัะธั `.grams-modal.closing`

2. **CountUp ะฐะฝะธะผะฐัะธั** (ัััะพะบะธ 407-448):
   - `animatedKcal` state + `requestAnimationFrame`
   - Ease-out cubic, 120ms ะดะปะธัะตะปัะฝะพััั
   - ะะปะฐะฒะฝะพะต ะธะทะผะตะฝะตะฝะธะต ัะธัะปะฐ ะบะฐะปะพัะธะน

3. **ะฃะผะฝัะต ะฟัะตัะตัั** (ัััะพะบะธ 672-712):
   - ะััะพัะธั ะฒ `heys_grams_history` (ะดะพ 20 ะทะฝะฐัะตะฝะธะน/ะฟัะพะดัะบั)
   - ะงะฐััะพัะฝัะน ะฐะฝะฐะปะธะท โ ัะพะฟ-5 ะทะฝะฐัะตะฝะธะน
   - Fallback ะฝะฐ [50, 100, 150, 200, 250]

### ๐ ะะทะผะตะฝัะฝะฝัะต ัะฐะนะปั:

| ะคะฐะนะป | ะะทะผะตะฝะตะฝะธั |
|------|-----------|
| `heys_day_v12.js` | +90 ัััะพะบ (swipe, animation, smart presets) |
| `main.css` | +10 ัััะพะบ (closing animation) |

---

## โ ะงะตะบะปะธัั ะณะพัะพะฒะฝะพััะธ

- [x] ะะฐ mobile: ะผะพะดะฐะปะบะฐ ะพัะบััะฒะฐะตััั ะฟะพัะปะต ะฒัะฑะพัะฐ ะฟัะพะดัะบัะฐ โ
- [x] ะะฐ desktop: ััะฐัะพะต ะฟะพะฒะตะดะตะฝะธะต (100ะณ + ัะพะบัั ะฝะฐ ะฟะพะปะต) โ
- [x] ะะฒัะพัะพะบัั ะฝะฐ ะฟะพะปะต ะฒะฒะพะดะฐ, ัะธััะพะฒะฐั ะบะปะฐะฒะธะฐัััะฐ โ
- [x] ะฃะผะฝัะต ะฟัะตัะตัั ะธะท ะธััะพัะธะธ โ
- [x] ะกะปะฐะนะดะตั ัะธะฝััะพะฝะธะทะธัะพะฒะฐะฝ ั ะฟะพะปะตะผ โ
- [x] ะะฐะปะพัะธะธ ั ะฟะปะฐะฒะฝะพะน ะฐะฝะธะผะฐัะธะตะน โ
- [x] **Swipe down ะทะฐะบััะฒะฐะตั ะผะพะดะฐะปะบั** โ
- [x] Enter ะธะปะธ "ะะพะฑะฐะฒะธัั" ะฟะพะดัะฒะตัะถะดะฐะตั โ
- [x] Escape ะธะปะธ "ะัะผะตะฝะฐ" ะทะฐะบััะฒะฐะตั โ
- [x] ะะพัะปะตะดะฝะธะต ะณัะฐะผะผั ะทะฐะฟะพะผะธะฝะฐัััั โ
- [x] ะััะพัะธั ะณัะฐะผะผะพะฒ ะดะปั smart presets โ
- [x] `pnpm type-check && pnpm build` ะฟัะพัะพะดัั โ

---

## ๐ฏ ะะตะบะพะผะตะฝะดะฐัะธั

**ะะฐะดะฐัั ะผะพะถะฝะพ ะฟะตัะตะฝะพัะธัั ะฒ `done.md`!**
2. ะกะบะพะฟะธัะพะฒะฐัั `sheetDragY`, `sheetStartY`, `isSheetDragging` refs
3. ะะพะฑะฐะฒะธัั `handleGramsSheetTouchStart/Move/End` handlers (ะฐะดะฐะฟัะธัะพะฒะฐัั ะธะท 1764-1798)
4. ะัะธะฒัะทะฐัั ะบ `.grams-modal`: `ref: gramsModalRef`, `onTouchStart/Move/End`
5. ะะพะฑะฐะฒะธัั ะบ `.bottom-sheet-handle`: `onTouchStart: handleGramsSheetTouchStart`

### ะจะฐะณ 2: CountUp ะฐะฝะธะผะฐัะธั (10 ะผะธะฝ)
**ะะฐัะธะฐะฝั A (CSS)**: 
```css
.grams-preview-kcal {
  transition: transform 0.15s ease-out;
}
.grams-preview-kcal.changed {
  transform: scale(1.1);
}
```
+ useEffect ั debounce ะดะปั ะดะพะฑะฐะฒะปะตะฝะธั/ัะดะฐะปะตะฝะธั ะบะปะฐััะฐ

**ะะฐัะธะฐะฝั B (JS โ ะฟัะตะดะฟะพััะธัะตะปัะฝะตะต ะดะปั ัะธัะตะป)**:
```javascript
// ะะฝะธะผะธัะพะฒะฐัั ะพั prevValue ะบ newValue ะทะฐ 150ms
const animatedKcal = useAnimatedNumber(targetKcal, 150);
```

### ะจะฐะณ 3: ะฃะผะฝัะต ะฟัะตัะตัั (15 ะผะธะฝ)
1. ะัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ะฟัะพะดัะบัะฐ โ ัะพััะฐะฝััั ะฒ history:
   ```javascript
   const history = U.lsGet('heys_grams_history', {});
   history[productId] = history[productId] || [];
   history[productId].push(grams);
   if (history[productId].length > 20) history[productId].shift();
   U.lsSet('heys_grams_history', history);
   ```

2. ะัะธ ะพัะบัััะธะธ ะผะพะดะฐะปะบะธ โ ะฒััะธัะปััั ัะผะฝัะต ะฟัะตัะตัั:
   ```javascript
   const smartPresets = useMemo(() => {
     const history = U.lsGet('heys_grams_history', {})[productId] || [];
     if (history.length < 3) return [50, 100, 150, 200, 250]; // fallback
     
     // ะงะฐััะพัะฝัะน ะฐะฝะฐะปะธะท
     const freq = {};
     history.forEach(v => freq[v] = (freq[v] || 0) + 1);
     return Object.entries(freq)
       .sort((a, b) => b[1] - a[1])
       .slice(0, 5)
       .map(([v]) => +v)
       .sort((a, b) => a - b);
   }, [productId]);
   ```

---

## โ๏ธ ะะะะะะะะ-ะะะะะะะะ

| ะะดะตั | ะะตัะดะธะบั | ะัะธัะธะฝะฐ |
|------|---------|---------|
| Voice Input | โ ะะฒะตัะบะธะปะป | Web Speech API ะฝะตััะฐะฑะธะปะตะฝ, 2+ ัะฐัะฐ ัะฐะฑะพัั, <1% ะธัะฟะพะปัะทะพะฒะฐะฝะธั |
| AI-ะฟัะตะดะปะพะถะตะฝะธั | โ ะะฒะตัะบะธะปะป | ะขัะตะฑัะตั backend, ML ะผะพะดะตะปั โ ะฝะต MVP |
| Photo estimation | โ ะะฒะตัะบะธะปะป | ะกะปะพะถะฝัะน ML, ะฝะต ะดะปั nutrition tracker |
| Progress ring | ๐ก Maybe | ะะพะฑะฐะฒะปัะตั ะฒะธะทัะฐะปัะฝัะน ััะผ, ะผะพะถะฝะพ ะฟะพะทะถะต |
| ะะพััะธะธ ะฟัะพะดัะบัะฐ | ๐ก Later | ะขัะตะฑัะตั ะธะทะผะตะฝะตะฝะธั Product ะผะพะดะตะปะธ โ ะพัะดะตะปัะฝะฐั ะทะฐะดะฐัะฐ |

**ะัะพะณะพ**: ะะตะฐะปะธะทัะตะผ ะขะะะฌะะ 3 ัะธัะธ (swipe, countUp, smart presets) โ ััะพ ะดะฐัั WOW ะฑะตะท ะพะฒะตัะบะธะปะปะฐ.

---

## ๐ด ะะะะะะะะะฌะะซะ ะะฃะะะข ะะะะะะขะ (ัะพััะฐะฝัะฝ ะดะปั ะธััะพัะธะธ)

### โ ะงัะพ ัะพัะพัะพ
- ะงััะบะฐั ัะตะปั ะธ UX ะพะฟะธัะฐะฝะธะต
- ะะธะทัะฐะปัะฝัะน ัะตัะตัะตะฝั ะฟะพะฝััะตะฝ

### ๐ด ะัะธัะธัะตัะบะธะต ะฝะฐัะพะดะบะธ

1. **WheelColumn ะฃะะ ะกะฃะฉะะกะขะะฃะะข!** (`heys_wheel_picker.js`)
   - ะะพะปะฝะพัััั ะณะพัะพะฒัะน iOS-style ะบะพะผะฟะพะฝะตะฝั ั momentum, haptic, ะทะฒัะบะพะผ
   - ะััั preset `grams: ['10', '25', '50', '75', '100', ...]` โ ะฝะพ ััะพ ัะธะบัะธัะพะฒะฐะฝะฝัะต ะทะฝะฐัะตะฝะธั, ะะ ัะธััั!
   - โก๏ธ ะัะถะฝะพ ะดะพะฑะฐะฒะธัั preset `digits: ['0'-'9']` ะดะปั ะบะพะปััะธะบะพะฒ ัะธัั (ะตัะปะธ ะฟะพะฝะฐะดะพะฑัััั)

2. **ะขัะธ ะบะพะปะตัะฐ = ะพะฒะตัะบะธะปะป ะดะปั ะฑะพะปััะธะฝััะฒะฐ ะบะตะนัะพะฒ**
   - 80% ะฟัะพะดัะบัะพะฒ: 50-300ะณ
   - UX ั ััะตะผั ะบะพะปััะฐะผะธ ะผะตะดะปะตะฝะฝะตะต ัะตะผ ะฒะฒะพะด ั ะบะปะฐะฒะธะฐัััั
   - โก๏ธ ะัััะต: ะฟะพะปะต ะฒะฒะพะดะฐ + ัะปะฐะนะดะตั + ะฟัะตัะตัั (50, 100, 150, 200, 250)

3. **ะะพะฝัะปะธะบั ั ะดะตัะบัะพะฟะพะผ**
   - ะะฐ ะดะตัะบัะพะฟะต ะผะพะดะฐะปะบะฐ โ ะพะฒะตัะบะธะปะป, ัะฐะผ ะบะปะฐะฒะธะฐัััะฐ ัะดะพะฑะฝะตะต
   - โก๏ธ ะะพะดะฐะปะบะฐ ัะพะปัะบะพ ะดะปั `isMobile`

4. **ะะพัะตัั ัะพะบััะฐ ะฟัะธ ะพัะบัััะธะธ ะผะพะดะฐะปะบะธ**
   - ะัะบััะฒะฐะตะผ ะผะพะดะฐะปะบั โ keyboard-spacer ัะดะฐะปัะตััั (onBlur) โ layout jump
   - โก๏ธ ะะต ัะดะฐะปััั spacer ะฟะพะบะฐ ะผะพะดะฐะปะบะฐ ะพัะบัััะฐ

### ๐ก ะะฐะถะฝัะต ัะปัััะตะฝะธั

1. **ะัะตัะตัั ะฑััััะพะณะพ ะฒัะฑะพัะฐ** โ ะบะฝะพะฟะบะธ 50ะณ, 100ะณ, 150ะณ, 200ะณ, 250ะณ
2. **ะะพะบะฐะทะฐัั ะบะบะฐะป ะดะปั ะฒัะฑัะฐะฝะฝัั ะณัะฐะผะผ** โ `{grams}ะณ = {kcal} ะบะบะฐะป`
3. **ะะฐะฟะพะผะธะฝะฐัั ะฟะพัะปะตะดะฝะธะต ะณัะฐะผะผั** ะดะปั ััะพะณะพ ะฟัะพะดัะบัะฐ (localStorage)
4. **Swipe down** ะดะปั ะทะฐะบัััะธั (ะบะฐะบ ะฒ time-picker โ ัะถะต ะตััั `bottom-sheet-handle`)

### ๐ข Nice to have (WOW-ัััะตะบั)

1. **Haptic feedback** ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ะทะฝะฐัะตะฝะธั (ัะถะต ะตััั ะฒ WheelColumn!)
2. **ะะฝะธะผะฐัะธั ะบะฐะปะพัะธะน** ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ะณัะฐะผะผะพะฒ (ะฟะปะฐะฒะฝัะน counter)
3. **ะฃะผะฝัะต ะฟัะตัะตัั** ะฝะฐ ะพัะฝะพะฒะต ะธััะพัะธะธ (ะตัะปะธ ะพะฑััะฝะพ ะตัั 150ะณ ัะฒะพัะพะณะฐ โ ะฟะพะบะฐะทะฐัั 150)

---

## ๐ง ะคะฐะทะฐ 0: ะะพะดะณะพัะพะฒะบะฐ (ะะะะะะะซ)

### 0.1. ะะพะฑะฐะฒะธัั preset `digits` ะฒ WheelColumn (ะพะฟัะธะพะฝะฐะปัะฝะพ)

**ะคะฐะนะป**: `apps/web/heys_wheel_picker.js`

```javascript
WheelColumn.presets = {
  // ... existing
  digits: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']
};
```

### 0.2. ะัะพะฒะตัะธัั keyboard-spacer ะปะพะณะธะบั

**ะคะฐะนะป**: `apps/web/heys_day_v12.js` (MealAddProduct)

ะฃะฑะตะดะธัััั ััะพ spacer ะฝะต ัะดะฐะปัะตััั ะฟัะธ ะพัะบัััะธะธ ะผะพะดะฐะปะบะธ ะณัะฐะผะผะพะฒ (onBlur ะฒัะทะพะฒะตััั).

### 0.3. ะะทััะธัั ัััะตััะฒัััะธะต ะผะพะดะฐะปะบะธ

- `showTimePicker` โ time-picker-modal ั WheelColumn
- `showWeightPicker` โ weight-picker-modal ั WheelColumn
- โก๏ธ ะัะฟะพะปัะทะพะฒะฐัั ัะพั ะถะต ะฟะฐััะตัะฝ: ReactDOM.createPortal + bottom-sheet-handle

---

## ๐ ะะฟะธัะฐะฝะธะต ะทะฐะดะฐัะธ (ะพะฑะฝะพะฒะปะตะฝะพ)

ะะพัะปะต ะฒัะฑะพัะฐ ะฟัะพะดัะบัะฐ ะธะท ัะฟะธัะบะฐ ะฝะฐ **ะผะพะฑะธะปัะฝัั** ะพัะบััะฒะฐะตััั bottom-sheet ะผะพะดะฐะปะบะฐ ะดะปั ะฒะฒะพะดะฐ ะณัะฐะผะผะพะฒ:

1. **ะะพะปะต ะฒะฒะพะดะฐ** โ ะณะปะฐะฒะฝัะน ัะฟะพัะพะฑ, ะฐะฒัะพัะพะบัั, ะบะปะฐะฒะธะฐัััะฐ ััะฐะทั
2. **ะัะตัะตัั** โ ะบะฝะพะฟะบะธ ะฑััััะพะณะพ ะฒัะฑะพัะฐ (50, 100, 150, 200, 250ะณ)
3. **ะกะปะฐะนะดะตั** โ ะฒะธะทัะฐะปัะฝัะน ัะฟะพัะพะฑ ะฒัะฑะพัะฐ (10-500ะณ)
4. **ะะฐะปะพัะธะธ** โ ะฟะพะบะฐะทัะฒะฐะตะผ ัะฐัััั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ

ะะฐ **ะดะตัะบัะพะฟะต** โ ััะฐัะพะต ะฟะพะฒะตะดะตะฝะธะต (ะดะพะฑะฐะฒะปัะตััั ั 100ะณ, ัะพะบัั ะฝะฐ ะฟะพะปะต ะณัะฐะผะผะพะฒ ะฒ ัะฐะฑะปะธัะต).

---

## ๐ฏ ะขัะตะฑะพะฒะฐะฝะธั

### ะะพะดะฐะปะบะฐ (ัะพะปัะบะพ mobile)
- Bottom-sheet ััะธะปั (ะบะฐะบ time-picker)
- Swipe down ะดะปั ะทะฐะบัััะธั
- Backdrop ะดะปั ะทะฐะบัััะธั ะฟะพ ะบะปะธะบั ะฒะฝะต
- Portal ะฒ body

### ะะพะปะต ะฒะฒะพะดะฐ
- `type="number" inputmode="numeric"` โ ัะธััะพะฒะฐั ะบะปะฐะฒะธะฐัััะฐ ะฝะฐ ะผะพะฑะธะปัะฝัั
- ะะฒัะพัะพะบัั ะฟัะธ ะพัะบัััะธะธ
- Placeholder: ะฟัะตะดัะดััะตะต ะทะฝะฐัะตะฝะธะต ะธะปะธ "100"
- Enter ะฟะพะดัะฒะตัะถะดะฐะตั

### ะัะตัะตัั (ะบะฝะพะฟะบะธ)
- 50, 100, 150, 200, 250ะณ
- ะะปะธะบ = ะฒัะฑะพั ะธ ะทะฐะบัััะธะต (ะฑัััััะน ะฟััั)
- ะะบัะธะฒะฝัะน ะฟัะตัะตั ะฟะพะดัะฒะตัะตะฝ

### ะกะปะฐะนะดะตั
- Range 10-500ะณ, step 10
- ะกะธะฝััะพะฝะธะทะธัะพะฒะฐะฝ ั ะฟะพะปะตะผ ะฒะฒะพะดะฐ
- Tick marks ะฝะฐ ะฟัะตัะตัะฐั

### ะะฐะปะพัะธะธ preview
- `{grams}ะณ = {kcal} ะบะบะฐะป` 
- ะะฑะฝะพะฒะปัะตััั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- ะะฝะธะผะฐัะธั ัะธัะปะฐ (countUp ัััะตะบั)

---

## ๐ง ะะปััะตะฒัะต ัะฐะนะปั

| ะคะฐะนะป | ะงัะพ ะดะตะปะฐัั |
|------|-----------|
| `apps/web/heys_day_v12.js` | ะะพะผะฟะพะฝะตะฝั `GramsInputModal`, ะธะฝัะตะณัะฐัะธั ะฒ `MealAddProduct` |
| `apps/web/styles/main.css` | ะกัะธะปะธ (ะฟะตัะตะธัะฟะพะปัะทะพะฒะฐัั time-picker ััะธะปะธ) |
| `apps/web/heys_wheel_picker.js` | ะะพะฑะฐะฒะธัั preset `digits` (ะตัะปะธ ะฝัะถะฝั ะบะพะปััะธะบะธ) |

---

## ๐ ะจะฐะณะธ ัะตะฐะปะธะทะฐัะธะธ

### ะจะฐะณ 1: State ะฒ MealAddProduct

```javascript
const [gramsModalProduct, setGramsModalProduct] = React.useState(null);
// null = ะทะฐะบัััะพ, {id, name, kcal100} = ะพัะบัััะพ ะดะปั ััะพะณะพ ะฟัะพะดัะบัะฐ
```

### ะจะฐะณ 2: ะะทะผะตะฝะธัั flow ะฒัะฑะพัะฐ ะฟัะพะดัะบัะฐ

```javascript
// ะัะปะพ:
onMouseDown: () => addProductAndFocusGrams(p)

// ะกัะฐะปะพ (mobile):
onMouseDown: () => {
  if (isMobile) {
    setGramsModalProduct(p);
    setSearch('');
    setOpen(false);
  } else {
    addProductAndFocusGrams(p);
  }
}
```

### ะจะฐะณ 3: ะะพะผะฟะพะฝะตะฝั GramsInputModal

```
ะะฐัะฟะพะปะพะถะตะฝะธะต: ะพัะดะตะปัะฝะฐั ััะฝะบัะธั ะฟะตัะตะด MealAddProduct

Props:
- product: {id, name, kcal100}
- onConfirm: (grams: number) => void
- onCancel: () => void

State:
- grams: number (ะฝะฐัะฐะปัะฝะพะต: ะธะท localStorage ะธะปะธ 100)

UI:
- ะะฐะทะฒะฐะฝะธะต ะฟัะพะดัะบัะฐ
- ะะฐะปะพัะธะธ preview: "{grams}ะณ = {Math.round(product.kcal100 * grams / 100)} ะบะบะฐะป"
- ะะพะปะต ะฒะฒะพะดะฐ (ะฐะฒัะพัะพะบัั)
- ะัะตัะตัั: 50, 100, 150, 200, 250
- ะกะปะฐะนะดะตั: 10-500
- ะะฝะพะฟะบะธ: ะัะผะตะฝะฐ / ะะพะฑะฐะฒะธัั
```

### ะจะฐะณ 4: ะะพะฑะฐะฒะธัั ะฟัะพะดัะบั ั ะณัะฐะผะผะฐะผะธ

```javascript
const addProductWithGrams = (product, grams) => {
  const newItem = {id: uid('it_'), product_id: product.id, name: product.name, grams};
  // ... ะดะพะฑะฐะฒะปะตะฝะธะต ะฒ meals
  // ะกะพััะฐะฝะธัั grams ะฒ localStorage ะดะปั ััะพะณะพ ะฟัะพะดัะบัะฐ
  U.lsSet(`heys_last_grams_${product.id}`, grams);
};
```

### ะจะฐะณ 5: ะกัะธะปะธ

ะะตัะตะธัะฟะพะปัะทะพะฒะฐัั `.time-picker-modal`, `.time-picker-header`, `.time-picker-backdrop`.
ะะพะฑะฐะฒะธัั:
- `.grams-presets` โ flex row ะดะปั ะบะฝะพะฟะพะบ
- `.grams-slider` โ ััะธะปะธะทะพะฒะฐะฝะฝัะน range input
- `.grams-preview` โ ะบะฐะปะพัะธะธ

---

## โ ะัะธัะตัะธะธ ะณะพัะพะฒะฝะพััะธ (ะะะะะะะะะ)

- [x] ะะฐ mobile: ะผะพะดะฐะปะบะฐ ะพัะบััะฒะฐะตััั ะฟะพัะปะต ะฒัะฑะพัะฐ ะฟัะพะดัะบัะฐ โ
- [x] ะะฐ desktop: ััะฐัะพะต ะฟะพะฒะตะดะตะฝะธะต (100ะณ + ัะพะบัั ะฝะฐ ะฟะพะปะต) โ
- [x] ะะฒัะพัะพะบัั ะฝะฐ ะฟะพะปะต ะฒะฒะพะดะฐ, ัะธััะพะฒะฐั ะบะปะฐะฒะธะฐัััะฐ โ
- [x] ะัะตัะตัั ัะฐะฑะพัะฐัั (ะบะปะธะบ = ะฒัะฑะพั, ะะ ะฝะต ะทะฐะบััะฒะฐะตั โ ะฝัะถะตะฝ ะฒัะพัะพะน ะบะปะธะบ ะฝะฐ "ะะพะฑะฐะฒะธัั")
- [x] ะกะปะฐะนะดะตั ัะธะฝััะพะฝะธะทะธัะพะฒะฐะฝ ั ะฟะพะปะตะผ โ
- [x] ะะฐะปะพัะธะธ ะพะฑะฝะพะฒะปััััั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ โ
- [ ] Swipe down ะทะฐะบััะฒะฐะตั ะผะพะดะฐะปะบั โ (bottom-sheet-handle ะตััั, ะฝะพ drag ะฝะต ัะตะฐะปะธะทะพะฒะฐะฝ)
- [x] Enter ะธะปะธ "ะะพะฑะฐะฒะธัั" ะฟะพะดัะฒะตัะถะดะฐะตั โ
- [x] Escape ะธะปะธ "ะัะผะตะฝะฐ" ะทะฐะบััะฒะฐะตั โ
- [x] ะะพัะปะตะดะฝะธะต ะณัะฐะผะผั ะทะฐะฟะพะผะธะฝะฐัััั ะดะปั ะฟัะพะดัะบัะฐ โ
- [x] `pnpm type-check && pnpm build` ะฟัะพัะพะดัั โ

---

## ๐จ ะะธะทัะฐะปัะฝัะน ัะตัะตัะตะฝั (ะพะฑะฝะพะฒะปะตะฝะพ)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            โโโโโโโ              โ  โ swipe handle
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ๐ง ะขะฒะพัะพะณ 5%                   โ
โ                                 โ
โ  150ะณ = 159 ะบะบะฐะป                โ  โ ะบะฐะปะพัะธะธ preview
โ                                 โ
โ  ะัะฐะผะผั: [ 150 ]                โ  โ ะฐะฒัะพัะพะบัั, ัะธัั. ะบะปะฐะฒะฐ
โ                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโ    โ  โ ัะปะฐะนะดะตั
โ  10      150              500   โ
โ                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ 50 โโ100 โโ150 โโ200 โโ250 โโ โ ะฟัะตัะตัั
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                 โ
โ  [ ะัะผะตะฝะฐ ]     [ ะะพะฑะฐะฒะธัั โ ] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## โ๏ธ ะะฐะถะฝะพ

- **ะะ ะปะพะผะฐัั ะดะตัะบัะพะฟ** โ ะผะพะดะฐะปะบะฐ ัะพะปัะบะพ ะดะปั isMobile
- **ะะตัะตะธัะฟะพะปัะทะพะฒะฐัั** ััะธะปะธ time-picker (ะฝะต ะดัะฑะปะธัะพะฒะฐัั)
- **Keyboard spacer** โ ะฝะต ัะดะฐะปััั ะฟัะธ ะพัะบัััะธะธ ะผะพะดะฐะปะบะธ
- **Haptic** โ ะดะพะฑะฐะฒะธัั ะฟัะธ ะฒัะฑะพัะต ะฟัะตัะตัะฐ ะธ ะฟะพะดัะฒะตัะถะดะตะฝะธะธ

---

## ๐ก WOW-ะธะดะตะธ (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะฝะฐ ะฑัะดััะตะต)

1. **ะะพะปะพัะพะฒะพะน ะฒะฒะพะด** โ "ััะพ ะฟัััะดะตััั ะณัะฐะผะผ" ัะตัะตะท Web Speech API
2. **ะะตััั** โ ัะฒะฐะนะฟ ะฒะปะตะฒะพ/ะฒะฟัะฐะฒะพ ะฟะพ ะฟัะตัะตัะฐะผ  
3. **ะะฝะธะผะฐัะธั ะบะฐะปะพัะธะน** โ countUp ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ
4. **ะฃะผะฝัะต ะฟัะตัะตัั** โ ะฟะพะบะฐะทัะฒะฐัั ะฟะพัะปะตะดะฝะธะต 3 ะธัะฟะพะปัะทะพะฒะฐะฝะฝัั ะทะฝะฐัะตะฝะธั ะดะปั ะฟัะพะดัะบัะฐ
5. **ะะพััะธะธ** โ "1 ัะนัะพ = 60ะณ", "1 ะปะพะถะบะฐ = 15ะณ" (ััะตะฑัะตั ะดะฐะฝะฝัะต ะฒ Product)

---

## ๐ ะะะะะะะะขะะะฌะะซะ WOW-ะฃะะฃะงะจะะะะฏ (ัะตะบะพะผะตะฝะดะฐัะธะธ ะฐัะดะธัะฐ)

### ะฃัะพะฒะตะฝั 1: Quick Wins (15 ะผะธะฝ ะบะฐะถะดัะน)

1. **๐ฏ Swipe-to-close** โ ะดะพะฑะฐะฒะธัั drag handler ะฝะฐ `.bottom-sheet-handle`
   - ะะฐััะตัะฝ ัะถะต ะตััั ะฒ time-picker, ะฝะพ ะดะปั grams-modal ะฝะต ัะตะฐะปะธะทะพะฒะฐะฝ
   - ะกะพะฒัะตะผะตะฝะฝัะน UX: native bottom-sheet feel

2. **โจ CountUp ะฐะฝะธะผะฐัะธั ะบะฐะปะพัะธะน** โ ะฟะปะฐะฒะฝะพะต ะธะทะผะตะฝะตะฝะธะต ัะธัะปะฐ
   ```javascript
   // ะัะธะผะตัะฝัะน ะฟะพะดัะพะด (ะฝะต ะบะพะด ะดะปั ะบะพะฟะธัะพะฒะฐะฝะธั):
   // ะัะธ ะธะทะผะตะฝะตะฝะธะธ gramsValue โ ะฐะฝะธะผะธัะพะฒะฐัั .grams-preview-kcal
   // CSS: transition: transform 0.15s, opacity 0.15s
   // + scale(1.05) ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ
   ```

3. **๐ Progress ring ะฒะพะบััะณ ะบะฐะปะพัะธะน** โ ะฟะพะบะฐะทะฐัั % ะพั ะดะฝะตะฒะฝะพะน ะฝะพัะผั
   - ะะธะทัะฐะปัะฝะพ: ะบะพะปััะพ ะฒะพะบััะณ preview ะบะฐะปะพัะธะน
   - "150ะณ = 159 ะบะบะฐะป (8% ะดะฝั)"

### ะฃัะพะฒะตะฝั 2: ะกัะตะดะฝัั ัะปะพะถะฝะพััั (30 ะผะธะฝ ะบะฐะถะดัะน)

4. **๐ง ะฃะผะฝัะต ะฟัะตัะตัั** โ history-based
   - ะฅัะฐะฝะธัั ะฟะพัะปะตะดะฝะธะต 5 ะทะฝะฐัะตะฝะธะน ะดะปั ะบะฐะถะดะพะณะพ ะฟัะพะดัะบัะฐ
   - ะะพะบะฐะทัะฒะฐัั ะบะฐะบ chips: "ะะพัะปะตะดะฝะธะต: 125ะณ, 200ะณ, 75ะณ"

5. **๐ณ ะะพััะธะธ ะฟัะพะดัะบัะฐ** โ "1 ัะนัะพ = 60ะณ"
   - ะะพะฑะฐะฒะธัั ะฟะพะปะต `portions` ะฒ Product ะผะพะดะตะปั
   - UI: ะบะฝะพะฟะบะธ "+1 ัะนัะพ", "+2 ัะนัะฐ" ััะดะพะผ ั ะณัะฐะผะผะฐะผะธ

6. **๐ฑ Vibration pattern** โ ัะฐะทะฝัะน haptic ะดะปั ัะฐะทะฝัั ะดะตะนััะฒะธะน
   - ะัะณะบะธะน tick ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ัะปะฐะนะดะตัะฐ
   - ะกัะตะดะฝะธะน ะฟัะธ ะฒัะฑะพัะต ะฟัะตัะตัะฐ
   - ะฃัะฟะตัะฝัะน ะฟัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ะฟัะพะดัะบัะฐ

### ะฃัะพะฒะตะฝั 3: WOW-ัััะตะบั (1+ ัะฐั)

7. **๐ค Voice Input** โ Web Speech API
   - ะะฝะพะฟะบะฐ ะผะธะบัะพัะพะฝะฐ: "ััะพ ะฟัััะดะตััั ะณัะฐะผะผ" โ 150
   - ะะพะดะดะตัะถะบะฐ: "ะฟะพะปัะพัั ะฟะพััะธะธ", "ะฟะพะป-ััะฐะบะฐะฝะฐ"

8. **๐ฎ AI-ะฟัะตะดะปะพะถะตะฝะธั** โ ะฝะฐ ะพัะฝะพะฒะต ะฟะฐััะตัะฝะพะฒ
   - "ะะฑััะฝะพ ะฒ ััะพ ะฒัะตะผั ะฒั ะตะดะธัะต ~200ะณ ัะฒะพัะพะณะฐ"
   - "ะะพัะปะต ััะตะฝะธัะพะฒะบะธ ัะตะบะพะผะตะฝะดัะตะผ +50ะณ ะฑะตะปะบะฐ"

9. **๐ธ Photo portion estimation** โ ะฑัะดััะตะต
   - ะกัะพัะพะณัะฐัะธัะพะฒะฐัั ัะฐัะตะปะบั โ ะพัะตะฝะบะฐ ะฟะพััะธะธ
   - ะะฝัะตะณัะฐัะธั ั ML-ะผะพะดะตะปัั

---

## ๐ ะัะตะฝะบะฐ ัะปะพะถะฝะพััะธ (ะพัะธะณะธะฝะฐะป)

| ะะพะผะฟะพะฝะตะฝั | ะกะปะพะถะฝะพััั | ะัะตะผั |
|-----------|-----------|-------|
| State + flow ะธะทะผะตะฝะตะฝะธะต | ๐ข ะะธะทะบะฐั | 10 ะผะธะฝ |
| GramsInputModal ะบะพะผะฟะพะฝะตะฝั | ๐ก ะกัะตะดะฝัั | 25 ะผะธะฝ |
| ะกัะธะปะธ (ะฝะฐ ะฑะฐะทะต time-picker) | ๐ข ะะธะทะบะฐั | 10 ะผะธะฝ |
| ะกะธะฝััะพะฝะธะทะฐัะธั input/slider | ๐ข ะะธะทะบะฐั | 5 ะผะธะฝ |
| ะะฐะฟะพะผะธะฝะฐะฝะธะต ะณัะฐะผะผะพะฒ | ๐ข ะะธะทะบะฐั | 5 ะผะธะฝ |
| ะขะตััะธัะพะฒะฐะฝะธะต | ๐ข ะะธะทะบะฐั | 5 ะผะธะฝ |
| **ะะขะะะ (ะฑะฐะทะพะฒัะน)** | | **60 ะผะธะฝ** |

### ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะปัััะตะฝะธั:
| ะฃะปัััะตะฝะธะต | ะกะปะพะถะฝะพััั | ะัะตะผั |
|-----------|-----------|-------|
| Swipe-to-close | ๐ข ะะธะทะบะฐั | 15 ะผะธะฝ |
| CountUp ะฐะฝะธะผะฐัะธั | ๐ข ะะธะทะบะฐั | 15 ะผะธะฝ |
| ะฃะผะฝัะต ะฟัะตัะตัั | ๐ก ะกัะตะดะฝัั | 30 ะผะธะฝ |
| ะะพััะธะธ ะฟัะพะดัะบัะฐ | ๐ก ะกัะตะดะฝัั | 45 ะผะธะฝ |
| Voice Input | ๐ด ะััะพะบะฐั | 2+ ัะฐัะฐ |
