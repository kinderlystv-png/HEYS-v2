---
template-version: 3.3.0
created: 2025-11-29
priority: medium
complexity: L (~3-4 —á–∞—Å–∞)
---

# Task: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–¥—É–ª—è —Å–æ–≤–µ—Ç–æ–≤ ‚Äî 12+ –Ω–æ–≤—ã—Ö advice —Ç–∏–ø–æ–≤

## üéØ WHY (–ë–∏–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç)

**Problem**: –í –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö HEYS –µ—Å—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è (`dayScore`, `training.type`, `weightMorning`), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –¥–∞–≤–∞—Ç—å —Ü–µ–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –¢–∞–∫–∂–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª smart timing –∏ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã—Ö –¥–Ω–µ–π.

**Impact**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç feedback –ø–æ –≤–∞–∂–Ω—ã–º –º–µ—Ç—Ä–∏–∫–∞–º ‚Äî –æ—Ü–µ–Ω–∫–∞ –¥–Ω—è, —Ç–∏–ø —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –¥–∏–Ω–∞–º–∏–∫–∞ –≤–µ—Å–∞, –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏—ë–º–∞.

**Value**: +10 –Ω–æ–≤—ã—Ö —Å–æ–≤–µ—Ç–æ–≤ ‚Üí –±–æ–ª–µ–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–ø—ã—Ç, gamification —ç–ª–µ–º–µ–Ω—Ç—ã, –≤—ã—à–µ –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å –∏ retention.

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–∞ –∫–æ–¥–∞

### üî¥ `Product.category` –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!
- –í `heys_models_v1.js` typedef –¥–ª—è Product –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `category`
- **–°–æ–≤–µ—Ç `category_variety_low` –£–ë–†–ê–ù –∏–∑ Phase 1**
- –î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (–æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞)

### üü° `training.type` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ID, –Ω–µ –Ω–∞–∑–≤–∞–Ω–∏—è!
- –¢–∏–ø—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: `'cardio'`, `'strength'`, `'hobby'` (–ù–ï '–°–∏–ª–æ–≤–∞—è', '–ô–æ–≥–∞')
- –í UI: `trainingTypes = [{id: 'cardio', label: '–ö–∞—Ä–¥–∏–æ'}, {id: 'strength', label: '–°–∏–ª–æ–≤–∞—è'}, {id: 'hobby', label: '–ê–∫—Ç–∏–≤–Ω–æ–µ —Ö–æ–±–±–∏'}]`
- **–¢–∏–ø '–ô–æ–≥–∞' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º `'hobby'` –∫–∞–∫ –∑–∞–º–µ–Ω—É

### üü° –î–æ—Å—Ç—É–ø –∫ localStorage
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: `window.HEYS.dayUtils.lsGet('heys_dayv2_' + iso, {})`
- Fallback: `U.lsGet` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ advice module

### üü° –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ª–æ–≤—É—à–∫–∏

1. **Silent mode –±–ª–æ–∫–∏—Ä—É–µ—Ç –í–°–ï —Å–æ–≤–µ—Ç—ã –Ω–æ—á—å—é (23:00-06:00)**
   - –í `generateAdvices()` —Å—Ç—Ä–æ–∫–∞ 261: `if (tone === 'silent') { return []; }`
   - –ò—Å–∫–ª—é—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ü–ï–†–ï–î —ç—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π (–∫–∞–∫ `young_sleep`)
   - **–ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç**: `night_owl_warning`

2. **`proteinPct` –æ–±—ä—è–≤–ª—è–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã**
   - –ì–ª–æ–±–∞–ª—å–Ω–æ (—Å—Ç—Ä–æ–∫–∞ 283) –∏ –ª–æ–∫–∞–ª—å–Ω–æ –≤–Ω—É—Ç—Ä–∏ `if (todayTraining)` (—Å—Ç—Ä–æ–∫–∞ 832)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π `proteinPct` –∏–∑ –Ω–∞—á–∞–ª–∞ —Ñ—É–Ω–∫—Ü–∏–∏

3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≤–µ—Ç–æ–≤**
   - `empty_stomach_late` –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –≤–º–µ—Å—Ç–µ —Å `morning_breakfast`
   - `late_heavy_meal` –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –≤–º–µ—Å—Ç–µ —Å `late_dinner_warning`
   - `training_type_strength` –ø–æ—Ö–æ–∂ –Ω–∞ `post_training_protein` –∏ `hard_workout_recovery`
   - **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –≤–∑–∞–∏–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ sessionStorage

4. **`best_day_recall` —Ç—Ä–µ–±—É–µ—Ç `optimum`**
   - –î–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è ratio –Ω—É–∂–µ–Ω `optimum` 
   - –í `getRecentDays()` –Ω–µ—Ç `optimum`, —Ç–æ–ª—å–∫–æ `dayData`
   - **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π `ctx.optimum` (–æ–Ω —Å—Ç–∞–±–∏–ª–µ–Ω)

5. **`todayTraining` –æ–±—ä—è–≤–ª–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ!**
   - –û–ø—Ä–µ–¥–µ–ª—ë–Ω –≤ —Å–µ–∫—Ü–∏–∏ "TRAINING TIPS" (—Å—Ç—Ä–æ–∫–∞ 826)
   - –°–æ–≤–µ—Ç—ã `training_type_strength` –∏ `training_type_hobby` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏**
   - –ò–ª–∏ –ø–µ—Ä–µ–æ–±—ä—è–≤–∏—Ç—å `todayTraining` —Ä—è–¥–æ–º —Å –Ω–æ–≤—ã–º–∏ —Å–æ–≤–µ—Ç–∞–º–∏

6. **–î–æ—Å—Ç—É–ø –∫ `meals` —á–µ—Ä–µ–∑ `day.meals`**
   - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π `day?.meals || []` –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ `meals`
   - –í ctx –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏ `meals` –ù–ï –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è ‚Äî —Ç–æ–ª—å–∫–æ `day`

---

## ü§ñ Output Preferences

**Workflow**: Implement directly

**Code style**: Follow copilot-instructions.md, —Ä—É—Å—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ legacy JS

---

## üìã WHAT (–ß–µ–∫-–ª–∏—Å—Ç –∑–∞–¥–∞—á)

### üîë –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –†–æ–ª—å |
|------|------|
| `apps/web/heys_advice_v1.js` | –ú–æ–¥—É–ª—å —Å–æ–≤–µ—Ç–æ–≤ ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ç–∏–ø—ã |
| `apps/web/heys_day_v12.js` | DayTab ‚Äî –ø–µ—Ä–µ–¥–∞—ë—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ advice engine |
| `docs/DATA_MODEL_REFERENCE.md` | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å–æ–≤–µ—Ç–æ–≤ |

---

### Must Have (9 –Ω–æ–≤—ã—Ö —Å–æ–≤–µ—Ç–æ–≤)

#### –ì—Ä—É–ø–ø–∞ 1: –û—Ü–µ–Ω–∫–∞ –¥–Ω—è (dayScore)

- [ ] **–°–æ–≤–µ—Ç `day_score_low`** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ –ø–ª–æ—Ö–æ–π –æ—Ü–µ–Ω–∫–µ –¥–Ω—è
  - **–£—Å–ª–æ–≤–∏–µ**: `day.dayScore && +day.dayScore > 0 && +day.dayScore < 5 && hour >= 20`
  - **–¢–µ–∫—Å—Ç**: `"–ù–µ –ª—É—á—à–∏–π –¥–µ–Ω—å? –ó–∞–≤—Ç—Ä–∞ –±—É–¥–µ—Ç –ª—É—á—à–µ! üíô"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `emotional`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 27 (—Ä—è–¥–æ–º —Å –¥—Ä—É–≥–∏–º–∏ emotional)
  
- [ ] **–°–æ–≤–µ—Ç `day_score_high`** ‚Äî –ø–æ—Ö–≤–∞–ª–∞ –∑–∞ —Ö–æ—Ä–æ—à–∏–π –¥–µ–Ω—å
  - **–£—Å–ª–æ–≤–∏–µ**: `day.dayScore && +day.dayScore >= 8 && hour >= 20`
  - **–¢–µ–∫—Å—Ç**: `"–û—Ç–ª–∏—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –¥–Ω—è! –ó–∞–ø–æ–º–Ω–∏ —ç—Ç–æ –æ—â—É—â–µ–Ω–∏–µ ‚≠ê"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `achievement`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 8

#### –ì—Ä—É–ø–ø–∞ 2: –¢–∏–ø —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (training.type)

> ‚ö†Ô∏è **–í–ê–ñ–ù–û**: –¢–∏–ø—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ ‚Äî —ç—Ç–æ ID: `'cardio'`, `'strength'`, `'hobby'` (–ù–ï —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è!)

- [ ] **–°–æ–≤–µ—Ç `training_type_strength`** ‚Äî –±–µ–ª–æ–∫ –ø–æ—Å–ª–µ —Å–∏–ª–æ–≤–æ–π
  - **–£—Å–ª–æ–≤–∏–µ**: `todayTraining?.type === 'strength' && proteinPct < 1.0`
  - **Note**: –†–∞—Å—à–∏—Ä—è–µ—Ç `post_training_protein` –¥–æ–±–∞–≤–ª—è—è –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–∞
  - ‚ö†Ô∏è **–†–∞–∑–º–µ—â–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –í–ù–£–¢–†–ò —Å–µ–∫—Ü–∏–∏ "TRAINING TIPS" (–≥–¥–µ –æ–±—ä—è–≤–ª–µ–Ω `todayTraining`)
  - **–¢–µ–∫—Å—Ç**: `"–ü–æ—Å–ª–µ —Å–∏–ª–æ–≤–æ–π –≤–∞–∂–µ–Ω –±–µ–ª–æ–∫ ‚Äî 20-30–≥ –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤ üí™"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `training`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`, `product_added`
  - **Priority**: 31
  
- [ ] **–°–æ–≤–µ—Ç `training_type_hobby`** ‚Äî –ª—ë–≥–∫–∏–π –ø—Ä–∏—ë–º –ø–æ—Å–ª–µ –π–æ–≥–∏/—Ö–æ–±–±–∏
  - **–£—Å–ª–æ–≤–∏–µ**: `todayTraining?.type === 'hobby'`
  - ‚ö†Ô∏è **–†–∞–∑–º–µ—â–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –í–ù–£–¢–†–ò —Å–µ–∫—Ü–∏–∏ "TRAINING TIPS" (–≥–¥–µ –æ–±—ä—è–≤–ª–µ–Ω `todayTraining`)
  - **–¢–µ–∫—Å—Ç**: `"–ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ö–æ–±–±–∏ –∏–¥–µ–∞–ª–µ–Ω –ª—ë–≥–∫–∏–π –ø—Ä–∏—ë–º ‚Äî –æ–≤–æ—â–∏, —Ñ—Ä—É–∫—Ç—ã ü•ó"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `training`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 49
  - **–ü–æ–∫–∞–∑–∞—Ç—å 1 —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é** (sessionStorage flag)

#### –ì—Ä—É–ø–ø–∞ 3: –î–∏–Ω–∞–º–∏–∫–∞ –≤–µ—Å–∞ (weightMorning)

> üí° **–ü–∞—Ç—Ç–µ—Ä–Ω**: –í `heys_day_v12.js` —É–∂–µ –µ—Å—Ç—å `weightTrend` (—Å—Ç—Ä–æ–∫–∏ ~2810-2850) ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–≥–∏–∫—É

- [ ] **–°–æ–≤–µ—Ç `weight_spike_up`** ‚Äî —Ä–µ–∑–∫–∏–π —Ä–æ—Å—Ç –≤–µ—Å–∞
  - **–£—Å–ª–æ–≤–∏–µ**: `|weightToday - weightYesterday| > 1.0`
  - **–õ–æ–≥–∏–∫–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω –∏–∑ `weightTrend` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ `heys_dayv2_{yesterday}`
  - **–¢–µ–∫—Å—Ç**: `"–í–µ—Å +${diff}–∫–≥ ‚Äî —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≤–æ–¥–∞, –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π üíß"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `correlation`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 23
  - **–ü–æ–∫–∞–∑–∞—Ç—å 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å** (sessionStorage flag)

- [ ] **–°–æ–≤–µ—Ç `weight_stable`** ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –≤–µ—Å
  - **–£—Å–ª–æ–≤–∏–µ**: –î–æ—Å—Ç—É–ø –∫ 7 –¥–Ω—è–º –∏—Å—Ç–æ—Ä–∏–∏, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ < 0.5–∫–≥
  - **–õ–æ–≥–∏–∫–∞**: –°–æ–±—Ä–∞—Ç—å `weightMorning` –∑–∞ 7 –¥–Ω–µ–π, –ø–æ—Å—á–∏—Ç–∞—Ç—å œÉ
  - **–¢–µ–∫—Å—Ç**: `"–í–µ—Å —Å—Ç–∞–±–∏–ª–µ–Ω —É–∂–µ –Ω–µ–¥–µ–ª—é ‚Äî –æ—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! üìä"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `achievement`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 9
  - **–ü–æ–∫–∞–∑–∞—Ç—å 1 —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é**

#### –ì—Ä—É–ø–ø–∞ 4: –¢–∞–π–º–∏–Ω–≥ –∏ —Ä–µ–∂–∏–º (–ù–û–í–´–ï)

- [ ] **–°–æ–≤–µ—Ç `caffeine_evening`** ‚Äî –∫–æ—Ñ–µ –≤–µ—á–µ—Ä–æ–º
  - **–£—Å–ª–æ–≤–∏–µ**: –ü—Ä–æ–¥—É–∫—Ç —Å –∫–æ—Ñ–µ-—Å–ª–æ–≤–æ–º –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ—Å–ª–µ 16:00
  - **–õ–æ–≥–∏–∫–∞**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ meals –ø–æ—Å–ª–µ 16:00
  - **Keywords**: `['–∫–æ—Ñ–µ', 'coffee', '–∫–∞–ø—É—á–∏–Ω–æ', '–ª–∞—Ç—Ç–µ', '–ª–∞—Ç–µ', '—Ä–∞—Ñ', '–∞–º–µ—Ä–∏–∫–∞–Ω–æ', '—ç—Å–ø—Ä–µ—Å—Å–æ', '—Ñ–ª—ç—Ç —É–∞–π—Ç', '–º–æ–∫–∫–æ', '–º–∞–∫–∏–∞—Ç–æ']`
  - **–¢–µ–∫—Å—Ç**: `"–ö–æ—Ñ–µ –ø–æ—Å–ª–µ 16:00 –º–æ–∂–µ—Ç —É—Ö—É–¥—à–∏—Ç—å —Å–æ–Ω ‚òï‚Üíüò¥"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `nutrition`, –¢—Ä–∏–≥–≥–µ—Ä: `product_added`
  - **Priority**: 42
  - **–ü–æ–∫–∞–∑–∞—Ç—å 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å** (sessionStorage flag)

- [ ] **–°–æ–≤–µ—Ç `empty_stomach_late`** ‚Äî –Ω–µ—Ç –∑–∞–≤—Ç—Ä–∞–∫–∞ –∫ 11:00
  - **–£—Å–ª–æ–≤–∏–µ**: `hour >= 10 && hour < 12 && mealCount === 0`
  - **Note**: –†–∞—Å—à–∏—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `morning_breakfast` (7-10) –¥–æ 10-12
  - ‚ö†Ô∏è **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –µ—Å–ª–∏ `morning_breakfast` —É–∂–µ –±—ã–ª –ø–æ–∫–∞–∑–∞–Ω
  - **–¢–µ–∫—Å—Ç**: `"–£–∂–µ ${hour}:00, –∞ –∑–∞–≤—Ç—Ä–∞–∫–∞ –Ω–µ—Ç ‚Äî –º–µ—Ç–∞–±–æ–ª–∏–∑–º –∂–¥—ë—Ç —Ç–æ–ø–ª–∏–≤–∞ üç≥"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `lifestyle`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 53

- [ ] **–°–æ–≤–µ—Ç `late_heavy_meal`** ‚Äî —Ç—è–∂—ë–ª—ã–π —É–∂–∏–Ω –ø–æ–∑–¥–Ω–æ
  - **–£—Å–ª–æ–≤–∏–µ**: `lastMealHour >= 21 && lastMealKcal > 500`
  - **–õ–æ–≥–∏–∫–∞**: –í—ã—á–∏—Å–ª–∏—Ç—å kcal –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–∏—ë–º–∞ —á–µ—Ä–µ–∑ `pIndex.byId.get(item.product_id)`
  - **Note**: –†–∞—Å—à–∏—Ä—è–µ—Ç `late_dinner_warning` (>= 22) –¥–æ–±–∞–≤–ª—è—è –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏
  - ‚ö†Ô∏è **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–º–µ—Å—Ç–µ —Å `late_dinner_warning`
  - **–¢–µ–∫—Å—Ç**: `"–ü–ª–æ—Ç–Ω—ã–π —É–∂–∏–Ω (${kcal} –∫–∫–∞–ª) –ø–æ—Å–ª–µ 21:00 ‚Äî —Å–æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å —Ö—É–∂–µ üåô"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `timing`, –¢—Ä–∏–≥–≥–µ—Ä: `product_added`
  - **Priority**: 40

---

### Should Have (—Ö–µ–ª–ø–µ—Ä—ã)

- [ ] **–•–µ–ª–ø–µ—Ä `getRecentDays(n)`** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ N –¥–Ω–µ–π –∏—Å—Ç–æ—Ä–∏–∏
  - **–§–∞–π–ª**: `heys_advice_v1.js` (–≤ —Å–µ–∫—Ü–∏–∏ HELPER FUNCTIONS)
  - **–õ–æ–≥–∏–∫–∞**: —Å–º. AI Context –Ω–∏–∂–µ
  - **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: weight_stable, best_day_recall, workout_consistent, evening_snacker, morning_skipper
  - ‚ö†Ô∏è **NOTE**: –•–µ–ª–ø–µ—Ä–∞ –ø–æ–∫–∞ –ù–ï–¢ –≤ –∫–æ–¥–µ ‚Äî –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å!

- [ ] **–•–µ–ª–ø–µ—Ä `hasCoffeeAfterHour(meals, hour, pIndex)`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ñ–µ
  - **–§–∞–π–ª**: `heys_advice_v1.js` (–≤ —Å–µ–∫—Ü–∏–∏ HELPER FUNCTIONS)
  - **Keywords**: `['–∫–æ—Ñ–µ', 'coffee', '–∫–∞–ø—É—á–∏–Ω–æ', '–ª–∞—Ç—Ç–µ', '–ª–∞—Ç–µ', '—Ä–∞—Ñ', '–∞–º–µ—Ä–∏–∫–∞–Ω–æ', '—ç—Å–ø—Ä–µ—Å—Å–æ', '—Ñ–ª—ç—Ç', '–º–æ–∫–∫–æ', '–º–∞–∫–∏–∞—Ç–æ']`
  - **–õ–æ–≥–∏–∫–∞**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –ø—Ä–∏—ë–º–∞—Ö –ø–æ—Å–ª–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —á–∞—Å–∞

- [ ] **–û–±–Ω–æ–≤–∏—Ç—å DATA_MODEL_REFERENCE.md** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å–æ–≤–µ—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü—É

---

### ‚ùå –£–ë–†–ê–ù–û –∏–∑ Phase 1 (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –º–æ–¥–µ–ª–∏)

- ~~**–°–æ–≤–µ—Ç `category_variety_low`**~~ ‚Äî `Product.category` –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –º–æ–¥–µ–ª–∏
  - **–°—Ç–∞—Ç—É—Å**: –¢—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –∑–∞–¥–∞—á–∏: –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `category` –≤ Product
  - **–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤**: `todo.md` ‚Üí –ò–¥–µ–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

---

## üî• PHASE 2: Smart Timing & Patterns (4 —Å–æ–≤–µ—Ç–∞)

> –≠—Ç–∏ —Å–æ–≤–µ—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç "—É–º–Ω–æ—Å—Ç—å" –∏ gamification —ç–ª–µ–º–µ–Ω—Ç—ã

### Must Have (Phase 2)

#### –ì—Ä—É–ø–ø–∞ 4: Smart Timing

> ‚ö†Ô∏è **–í–ê–ñ–ù–û**: `prof.insulinWaveHours` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ª–∏ –∏–∑ `getProfile()`. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤ `heys_day_utils.js`

- [ ] **–°–æ–≤–µ—Ç `insulin_countdown`** ‚Äî –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –µ—Å—Ç—å
  - **–£—Å–ª–æ–≤–∏–µ**: `lastMealTime` + `insulinWaveHours` > now, —Ä–∞–∑–Ω–∏—Ü–∞ < 1 —á–∞—Å
  - **–õ–æ–≥–∏–∫–∞**: –í—ã—á–∏—Å–ª–∏—Ç—å –≤—Ä–µ–º—è –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–Ω—Å—É–ª–∏–Ω–æ–≤–æ–π –≤–æ–ª–Ω—ã
  - **–¢–µ–∫—Å—Ç**: `"–ß–µ—Ä–µ–∑ ${minutes} –º–∏–Ω –∏–Ω—Å—É–ª–∏–Ω–æ–≤–∞—è –≤–æ–ª–Ω–∞ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è ‚Äî –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫—É—Å–∏—Ç—å ‚è±Ô∏è"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `timing`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 40
  
- [ ] **–°–æ–≤–µ—Ç `bedtime_protein`** ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å –¥–æ–±—Ä–∞—Ç—å –±–µ–ª–æ–∫
  - **–£—Å–ª–æ–≤–∏–µ**: `hour >= 20 && hour <= 22 && proteinPct < 0.8`
  - **–õ–æ–≥–∏–∫–∞**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å prof.sleepHours, –≤—ã—á–∏—Å–ª–∏—Ç—å –≤—Ä–µ–º—è –¥–æ —Å–Ω–∞
  - **–¢–µ–∫—Å—Ç**: `"–î–æ —Å–Ω–∞ ~${hoursLeft}—á ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å –¥–æ–±—Ä–∞—Ç—å –±–µ–ª–æ–∫ ü•õ"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `timing`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 35

#### –ì—Ä—É–ø–ø–∞ 5: –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏

- [ ] **–°–æ–≤–µ—Ç `post_holiday_detox`** ‚Äî –ø–æ—Å–ª–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤
  - **–£—Å–ª–æ–≤–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞—Ç—É: 1-2 —è–Ω–≤–∞—Ä—è, 24 —Ñ–µ–≤—Ä–∞–ª—è, 9 –º–∞—Ä—Ç–∞
  - **–õ–æ–≥–∏–∫–∞**: –ú–∞—Å—Å–∏–≤ `[[1,1], [2,1], [24,2], [9,3], [10,5], [13,6]]` (–¥–µ–Ω—å –ü–û–°–õ–ï –ø—Ä–∞–∑–¥–Ω–∏–∫–∞)
  - **–¢–µ–∫—Å—Ç**: `"–ü–æ—Å–ª–µ –≤—á–µ—Ä–∞—à–Ω–µ–≥–æ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞ ‚Äî –ª—ë–≥–∫–∏–π –¥–µ–Ω—å: –æ–≤–æ—â–∏, –≤–æ–¥–∞, –±–µ–ª–æ–∫ üåø"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `lifestyle`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 15
  - **–ü–æ–∫–∞–∑–∞—Ç—å 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å**

- [ ] **–°–æ–≤–µ—Ç `best_day_recall`** ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ª—É—á—à–µ–º –¥–Ω–µ
  - **–£—Å–ª–æ–≤–∏–µ**: –ù–∞–π—Ç–∏ –¥–µ–Ω—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π —Å –ª—É—á—à–∏–º ratio (closest to 1.0)
  - **–õ–æ–≥–∏–∫–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö–µ–ª–ø–µ—Ä `getRecentDays(7)`, –Ω–∞–π—Ç–∏ min |ratio - 1.0|
  - **–¢–µ–∫—Å—Ç**: `"–¢–≤–æ–π –ª—É—á—à–∏–π –¥–µ–Ω—å –±—ã–ª ${dayName} ‚Äî ${pct}% –Ω–æ—Ä–º—ã. –ü–æ–≤—Ç–æ—Ä–∏! ‚≠ê"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `motivation`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 44
  - **–ü–æ–∫–∞–∑–∞—Ç—å 1 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é** (localStorage flag)

---

## üéÆ PHASE 3: Gamification & Patterns (8 —Å–æ–≤–µ—Ç–æ–≤)

> –ü—Ä–∏–∫–æ–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã —Å gamification –∏ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏

### Must Have (Phase 3)

#### –ì—Ä—É–ø–ø–∞ 6: Gamification / –ü–æ—Ö–≤–∞–ª—ã

- [ ] **–°–æ–≤–µ—Ç `night_owl_warning`** ‚Äî –Ω–æ—á–Ω–æ–π –ø–µ—Ä–µ–∫—É—Å
  - **–£—Å–ª–æ–≤–∏–µ**: `hour >= 1 && hour < 5` –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
  - **–¢–µ–∫—Å—Ç**: `"–ù–æ—á–Ω–æ–π –ø–µ—Ä–µ–∫—É—Å? –ó–∞–ø–∏—Å–∞–ª! –ù–æ —Å–æ–Ω –≤–∞–∂–Ω–µ–µ –µ–¥—ã üò¥"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `lifestyle`, –¢—Ä–∏–≥–≥–µ—Ä: `product_added`
  - **Priority**: 20
  - **–ü–æ–∫–∞–∑–∞—Ç—å 1 —Ä–∞–∑ –∑–∞ –Ω–æ—á—å** (sessionStorage flag)
  - ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û**: –î–æ–±–∞–≤–∏—Ç—å –ü–û–°–õ–ï —Å—Ç—Ä–æ–∫–∏ 258 (–¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è ctx), –ù–û –ü–ï–†–ï–î —Å—Ç—Ä–æ–∫–æ–π 261 (`if (tone === 'silent')`)
  - **–ü–∞—Ç—Ç–µ—Ä–Ω**: –°–º. "–ü–∞—Ç—Ç–µ—Ä–Ω –æ–±—Ö–æ–¥–∞ silent mode" –≤ AI Context

- [ ] **–°–æ–≤–µ—Ç `lunch_time`** ‚Äî –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–± –æ–±–µ–¥–µ
  - **–£—Å–ª–æ–≤–∏–µ**: `hour === 13 && mealCount === 1`
  - **–¢–µ–∫—Å—Ç**: `"–ß–∞—Å –¥–Ω—è ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –æ–±–µ–¥–∞! üçΩÔ∏è"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `lifestyle`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 52

- [ ] **–°–æ–≤–µ—Ç `protein_champion`** ‚Äî –ø–æ—Ö–≤–∞–ª–∞ –∑–∞ –±–µ–ª–æ–∫
  - **–£—Å–ª–æ–≤–∏–µ**: `proteinPct >= 1.2`
  - **–¢–µ–∫—Å—Ç**: `"–ë–µ–ª–∫–æ–≤—ã–π —á–µ–º–ø–∏–æ–Ω! üèÜ –ú—ã—à—Ü—ã —Ç–µ–±—è –±–ª–∞–≥–æ–¥–∞—Ä—è—Ç"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `achievement`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`, `product_added`
  - **Priority**: 10
  - **–ü–æ–∫–∞–∑–∞—Ç—å 1 —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é**

- [ ] **–°–æ–≤–µ—Ç `snack_window`** ‚Äî –≤—Ä–µ–º—è –ø–æ–ª–¥–Ω–∏–∫–∞
  - **–£—Å–ª–æ–≤–∏–µ**: `hour === 16 && kcalPct < 0.6`
  - **–õ–æ–≥–∏–∫–∞**: –í—ã—á–∏—Å–ª–∏—Ç—å remaining –∫–∫–∞–ª
  - **–¢–µ–∫—Å—Ç**: `"16:00 ‚Äî –≤—Ä–µ–º—è –ø–æ–ª–¥–Ω–∏–∫–∞. –û—Å—Ç–∞–ª–æ—Å—å ~${remaining} –∫–∫–∞–ª ü•™"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `lifestyle`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 51

#### –ì—Ä—É–ø–ø–∞ 7: –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã

- [ ] **–°–æ–≤–µ—Ç `mood_improving`** ‚Äî –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —É–ª—É—á—à–∏–ª–æ—Å—å
  - **–£—Å–ª–æ–≤–∏–µ**: `meals.length >= 2 && prevMealMood > 0 && currentMealMood > prevMealMood`
  - **–õ–æ–≥–∏–∫–∞**: –°—Ä–∞–≤–Ω–∏—Ç—å mood –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 2 –ø—Ä–∏—ë–º–æ–≤ (–æ–±–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å > 0)
  - **–¢–µ–∫—Å—Ç**: `"–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —É–ª—É—á—à–∏–ª–æ—Å—å –ø–æ—Å–ª–µ –µ–¥—ã ‚Äî –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω! üìà"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `correlation`, –¢—Ä–∏–≥–≥–µ—Ä: `product_added`
  - **Priority**: 45
  - **–ü–æ–∫–∞–∑–∞—Ç—å 1 —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é**

#### –ì—Ä—É–ø–ø–∞ 8: –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (3 –¥–Ω—è)

> üí° –¢—Ä–µ–±—É—é—Ç —Ö–µ–ª–ø–µ—Ä `getRecentDays(3)` ‚Äî —É–∂–µ –µ—Å—Ç—å

- [ ] **–°–æ–≤–µ—Ç `workout_consistent`** ‚Äî —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
  - **–£—Å–ª–æ–≤–∏–µ**: –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ 3 –¥–Ω—è –ø–æ–¥—Ä—è–¥ (–≤–∫–ª—é—á–∞—è —Å–µ–≥–æ–¥–Ω—è)
  - **–õ–æ–≥–∏–∫–∞**: `getRecentDays(2)` + —Å–µ–≥–æ–¥–Ω—è, –≤—Å–µ –∏–º–µ—é—Ç `trainings.some(t => t.z?.some(m => m > 0))`
  - **Note**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `t.z.some()` ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ `trainings.length > 0`!
  - **–¢–µ–∫—Å—Ç**: `"3 –¥–Ω—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø–æ–¥—Ä—è–¥! –¢—ã –º–∞—à–∏–Ω–∞ üí™üî•"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `achievement`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 7
  - **–ü–æ–∫–∞–∑–∞—Ç—å 1 —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é**

- [ ] **–°–æ–≤–µ—Ç `evening_snacker`** ‚Äî –ø–∞—Ç—Ç–µ—Ä–Ω –ø–æ–∑–¥–Ω–∏—Ö —É–∂–∏–Ω–æ–≤
  - **–£—Å–ª–æ–≤–∏–µ**: –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –¥–Ω—è: `lastMealHour >= 22`
  - **–õ–æ–≥–∏–∫–∞**: `getRecentDays(3)`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å lastMealHour –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
  - **–¢–µ–∫—Å—Ç**: `"–ó–∞–º–µ—Ç–∏–ª —Ç—Ä–µ–Ω–¥ ‚Äî —Ç—ã —á–∞—Å—Ç–æ —É–∂–∏–Ω–∞–µ—à—å –ø–æ–∑–¥–Ω–æ. –ú–æ–∂–µ—Ç, –ø–µ—Ä–µ–∫—É—Å —Ä–∞–Ω—å—à–µ? üåô"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `correlation`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 38
  - **–ü–æ–∫–∞–∑–∞—Ç—å 1 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é** (localStorage flag)

- [ ] **–°–æ–≤–µ—Ç `morning_skipper`** ‚Äî –ø–∞—Ç—Ç–µ—Ä–Ω –±–µ–∑ –∑–∞–≤—Ç—Ä–∞–∫–∞
  - **–£—Å–ª–æ–≤–∏–µ**: –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –¥–Ω—è: –ø–µ—Ä–≤—ã–π –ø—Ä–∏—ë–º –ø–æ—Å–ª–µ 11:00
  - **–õ–æ–≥–∏–∫–∞**: `getRecentDays(3)`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ meal
  - **–¢–µ–∫—Å—Ç**: `"–£–∂–µ 3 –¥–Ω—è –±–µ–∑ —Ä–∞–Ω–Ω–µ–≥–æ –∑–∞–≤—Ç—Ä–∞–∫–∞ ‚Äî —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–µ—à—å —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–º –≥–æ–ª–æ–¥–∞–Ω–∏–µ–º? ü§î"`
  - **–ö–∞—Ç–µ–≥–æ—Ä–∏—è**: `correlation`, –¢—Ä–∏–≥–≥–µ—Ä: `tab_open`
  - **Priority**: 39
  - **–ü–æ–∫–∞–∑–∞—Ç—å 1 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é** (localStorage flag)

---

### ‚ùå –£–ë–†–ê–ù–û –∏–∑ Phase 2 (–æ–≤–µ—Ä–∫–∏–ª/–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)

- ~~**–°–æ–≤–µ—Ç `friday_warning`**~~ ‚Äî —É–∂–µ –µ—Å—Ç—å `friday_reminder` (—Å—Ç—Ä–æ–∫–∞ ~267 –≤ advice)
- ~~**–°–æ–≤–µ—Ç `weekday_pattern`**~~ ‚Äî —Ç—Ä–µ–±—É–µ—Ç 28 –¥–Ω–µ–π –∏—Å—Ç–æ—Ä–∏–∏, —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ –¥–ª—è –ø–µ—Ä–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
  - **–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤**: `todo.md` ‚Üí –ò–¥–µ–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

---

## ‚úÖ DONE (–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏)

### Functional ‚Äî Phase 1 (9 —Å–æ–≤–µ—Ç–æ–≤)

- [ ] **day_score_low**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ `dayScore < 5` –≤–µ—á–µ—Ä–æ–º
- [ ] **day_score_high**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ `dayScore >= 8` –≤–µ—á–µ—Ä–æ–º  
- [ ] **training_type_strength**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–∏–ª–æ–≤–æ–π (`type === 'strength'`) –µ—Å–ª–∏ –º–∞–ª–æ –±–µ–ª–∫–∞
- [ ] **training_type_hobby**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ö–æ–±–±–∏ (`type === 'hobby'`) ‚Äî 1 —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é
- [ ] **weight_spike_up**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–∫–∞—á–∫–µ –≤–µ—Å–∞ ¬±1–∫–≥
- [ ] **weight_stable**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º –≤–µ—Å–µ 7 –¥–Ω–µ–π
- [ ] **caffeine_evening**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ—Ñ–µ –ø–æ—Å–ª–µ 16:00
- [ ] **empty_stomach_late**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –Ω–µ—Ç –∑–∞–≤—Ç—Ä–∞–∫–∞ –∫ 10-12 —á–∞—Å–∞–º
- [ ] **late_heavy_meal**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–ª–æ—Ç–Ω–æ–º —É–∂–∏–Ω–µ (>500 –∫–∫–∞–ª) –ø–æ—Å–ª–µ 21:00

### Functional ‚Äî Phase 2 (4 —Å–æ–≤–µ—Ç–∞)

- [ ] **insulin_countdown**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∏–Ω—É—Ç—ã –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–Ω—Å—É–ª–∏–Ω–æ–≤–æ–π –≤–æ–ª–Ω—ã
- [ ] **bedtime_protein**: –ù–∞–ø–æ–º–∏–Ω–∞–µ—Ç –¥–æ–±—Ä–∞—Ç—å –±–µ–ª–æ–∫ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º
- [ ] **post_holiday_detox**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è 1-2 —è–Ω–≤–∞—Ä—è, –ø–æ—Å–ª–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤
- [ ] **best_day_recall**: –ù–∞–ø–æ–º–∏–Ω–∞–µ—Ç –æ –ª—É—á—à–µ–º –¥–Ω–µ –∑–∞ –Ω–µ–¥–µ–ª—é

### Functional ‚Äî Phase 3 (8 —Å–æ–≤–µ—Ç–æ–≤)

- [ ] **night_owl_warning**: –ù–æ—á–Ω–æ–π –ø–µ—Ä–µ–∫—É—Å (1:00-5:00) ‚Äî –º—è–≥–∫–æ –±–µ–∑ –æ—Å—É–∂–¥–µ–Ω–∏—è
- [ ] **lunch_time**: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–± –æ–±–µ–¥–µ –≤ 13:00
- [ ] **protein_champion**: –ü–æ—Ö–≤–∞–ª–∞ –∑–∞ >120% –±–µ–ª–∫–∞
- [ ] **snack_window**: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–æ–ª–¥–Ω–∏–∫–µ –≤ 16:00
- [ ] **mood_improving**: –ò–Ω—Å–∞–π—Ç –æ —Å–≤—è–∑–∏ –µ–¥–∞‚Üí–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
- [ ] **workout_consistent**: 3 –¥–Ω—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø–æ–¥—Ä—è–¥
- [ ] **evening_snacker**: –ü–∞—Ç—Ç–µ—Ä–Ω –ø–æ–∑–¥–Ω–∏—Ö —É–∂–∏–Ω–æ–≤ –∑–∞ 3 –¥–Ω—è
- [ ] **morning_skipper**: –ü–∞—Ç—Ç–µ—Ä–Ω –±–µ–∑ –∑–∞–≤—Ç—Ä–∞–∫–∞ –∑–∞ 3 –¥–Ω—è

### Edge Cases

- [ ] –ù–µ—Ç `dayScore` (–ø—É—Å—Ç–æ–π –∏–ª–∏ 0) ‚Üí —Å–æ–≤–µ—Ç—ã –ø–æ dayScore –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è
- [ ] –ù–µ—Ç `training.type` ‚Üí —Å–æ–≤–µ—Ç—ã –ø–æ —Ç–∏–ø—É –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è  
- [ ] –ù–µ—Ç –≤–µ—Å–∞ –∑–∞ –≤—á–µ—Ä–∞ ‚Üí weight_spike –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
- [ ] –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞ 7+ –¥–Ω–µ–π ‚Üí weight_stable/best_day –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è
- [ ] –ù–µ—Ç `lastMealTime` ‚Üí insulin_countdown –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
- [ ] –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞ 3 –¥–Ω—è ‚Üí evening_snacker/morning_skipper/workout_consistent –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è
- [ ] `mealCount < 2` ‚Üí mood_improving –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
- [ ] `meal.mood === 0` ‚Üí mood_improving –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö)
- [ ] `empty_stomach_late` + `morning_breakfast` ‚Äî –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–±–∞ (sessionStorage)
- [ ] `late_heavy_meal` + `late_dinner_warning` ‚Äî –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–±–∞ (sessionStorage)
- [ ] `night_owl_warning` —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—á—å—é ‚Äî –æ–±–æ–π—Ç–∏ silent mode!

### Quality Gates

- [ ] `pnpm type-check` PASS
- [ ] `pnpm lint` PASS
- [ ] `pnpm build` PASS
- [ ] –°–æ–≤–µ—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ UI (—Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ localhost:3001)

---

## ü§ñ AI Context (Technical Specs)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ advice –æ–±—ä–µ–∫—Ç–∞

```javascript
{
  id: 'advice_id',           // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
  icon: 'üí™',                // Emoji
  text: '–¢–µ–∫—Å—Ç —Å–æ–≤–µ—Ç–∞',      // –†—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç
  type: 'tip',               // 'tip' | 'warning' | 'achievement' | 'insight' | 'info'
  priority: 30,              // –ú–µ–Ω—å—à–µ = –≤–∞–∂–Ω–µ–µ
  category: 'training',      // –ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
  triggers: ['tab_open'],    // –ö–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
  ttl: 5000,                 // –í—Ä–µ–º—è –ø–æ–∫–∞–∑–∞ (–º—Å)
  onShow: () => {}           // Callback –ø—Ä–∏ –ø–æ–∫–∞–∑–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
}
```

### –î–æ—Å—Ç—É–ø–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ generateAdvices(ctx)

```javascript
const {
  dayTot,        // { kcal, carbs, prot, fat, ... }
  normAbs,       // { kcal, carbs, prot, fat, ... }
  optimum,       // –¶–µ–ª–µ–≤–æ–π –∫–∞–ª–æ—Ä–∞–∂
  day,           // DayRecord: { meals, trainings, dayScore, weightMorning, ... }
  pIndex,        // { byId: Map, byName: Map }
  currentStreak, // –î–Ω–µ–π –ø–æ–¥—Ä—è–¥ –≤ –Ω–æ—Ä–º–µ
  hour,          // –¢–µ–∫—É—â–∏–π —á–∞—Å (0-23)
  mealCount,     // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏—ë–º–æ–≤ —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
  hasTraining,   // –ï—Å—Ç—å –ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞
  kcalPct,       // dayTot.kcal / optimum
  prof,          // –ü—Ä–æ—Ñ–∏–ª—å: { gender, age, sleepHours, ... }
  waterGoal      // –ù–æ—Ä–º–∞ –≤–æ–¥—ã
} = ctx;
```

### –î–æ—Å—Ç—É–ø –∫ localStorage

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô –ø–∞—Ç—Ç–µ—Ä–Ω –¥–æ—Å—Ç—É–ø–∞ –∫ localStorage
// –ò—Å–ø–æ–ª—å–∑—É–µ–º HEYS.dayUtils.lsGet –∫–æ—Ç–æ—Ä—ã–π —É—á–∏—Ç—ã–≤–∞–µ—Ç clientId namespace
const lsGet = (window.HEYS?.dayUtils?.lsGet) || ((k, d) => {
  try { 
    const v = localStorage.getItem(k);
    return v ? JSON.parse(v) : d; 
  } catch { return d; }
});

function getYesterdayISO() {
  const d = new Date();
  d.setDate(d.getDate() - 1);
  return d.toISOString().slice(0, 10);
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤—á–µ—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è
const yesterdayDay = lsGet('heys_dayv2_' + getYesterdayISO(), {});
const yesterdayWeight = yesterdayDay.weightMorning || 0;

// –ó–∞–≥—Ä—É–∑–∫–∞ N –¥–Ω–µ–π –∏—Å—Ç–æ—Ä–∏–∏
function getRecentDays(n) {
  const days = [];
  const today = new Date();
  for (let i = 1; i <= n; i++) {
    const d = new Date(today);
    d.setDate(d.getDate() - i);
    const iso = d.toISOString().slice(0, 10);
    const dayData = lsGet('heys_dayv2_' + iso, null);
    if (dayData && dayData.date) {
      days.push({ date: iso, ...dayData });
    }
  }
  return days;
}
```

### –ü–∞—Ç—Ç–µ—Ä–Ω sessionStorage –¥–ª—è one-time —Å–æ–≤–µ—Ç–æ–≤

```javascript
if (!sessionStorage.getItem('heys_advice_id_shown')) {
  advices.push({
    id: 'advice_id',
    // ...
    onShow: () => { 
      try { sessionStorage.setItem('heys_advice_id_shown', '1'); } catch(e) {} 
    }
  });
}
```

### –ü–∞—Ç—Ç–µ—Ä–Ω –≤—ã—á–∏—Å–ª–µ–Ω–∏—è kcal –ø—Ä–∏—ë–º–∞

```javascript
// –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–∞–ª–æ—Ä–∏–π –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–∏—ë–º–∞
const lastMeal = (day?.meals || []).filter(m => m.items?.length > 0).slice(-1)[0];
let lastMealKcal = 0;
if (lastMeal) {
  for (const item of lastMeal.items) {
    const product = pIndex?.byId?.get(item.product_id);
    if (!product) continue;
    const grams = item.grams || 100;
    lastMealKcal += (product.kcal100 || 0) * grams / 100;
  }
}
```

### –ü–∞—Ç—Ç–µ—Ä–Ω –æ–±—Ö–æ–¥–∞ silent mode

```javascript
// ‚ö†Ô∏è –í–ê–ñ–ù–û: –≠—Ç–∏ —Å–æ–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ü–ï–†–ï–î –ø—Ä–æ–≤–µ—Ä–∫–æ–π `if (tone === 'silent') return [];`
// –ò–Ω–∞—á–µ –æ–Ω–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—á—å—é!

// –ü—Ä–∏–º–µ—Ä: night_owl_warning
if (hour >= 1 && hour < 5 && !sessionStorage.getItem('heys_night_owl_shown')) {
  // –≠—Ç–æ—Ç —Å–æ–≤–µ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –î–û return [], —á—Ç–æ–±—ã —Å—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—á—å—é
  advices.push({
    id: 'night_owl_warning',
    // ...
  });
  // –ù–µ return! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ
}

// –ù–æ—á—å—é ‚Äî –Ω–∏–∫–∞–∫–∏—Ö —Å–æ–≤–µ—Ç–æ–≤ (–∫—Ä–æ–º–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤—ã—à–µ)
if (tone === 'silent') {
  return advices; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–æ—á–Ω—ã–µ —Å–æ–≤–µ—Ç—ã
}
```

---

## üìù Notes

- **Priority**: medium
- **Complexity**: XL (~4.5-5 —á–∞—Å–æ–≤)
  - Phase 1: ~2 —á–∞—Å–∞ (9 —Å–æ–≤–µ—Ç–æ–≤)
  - Phase 2: ~1 —á–∞—Å (4 —Å–æ–≤–µ—Ç–∞, —Ç—Ä–µ–±—É—é—Ç –∏—Å—Ç–æ—Ä–∏—é)
  - Phase 3: ~1.5 —á–∞—Å–∞ (8 —Å–æ–≤–µ—Ç–æ–≤, gamification + –ø–∞—Ç—Ç–µ—Ä–Ω—ã)
- **Blockers**: –ù–µ—Ç
- **Related**: 
  - `docs/DATA_MODEL_REFERENCE.md` ‚Äî —Å–µ–∫—Ü–∏—è "–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã"
  - –ü—Ä–µ–¥—ã–¥—É—â–∞—è –∑–∞–¥–∞—á–∞: 34 —Ç–∏–ø–∞ —Å–æ–≤–µ—Ç–æ–≤ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
  - Gamification –∏–¥–µ–∏ ‚Äî —Å–º. `todo.md` ‚Üí "–ò–¥–µ–∏ –Ω–∞ –±—É–¥—É—â–µ–µ"
- **–£–±—Ä–∞–Ω–æ –ø–æ—Å–ª–µ –∞—É–¥–∏—Ç–∞**:
  - `category_variety_low` ‚Äî `Product.category` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  - `friday_warning` ‚Äî –¥—É–±–ª–∏—Ä—É–µ—Ç `friday_reminder`
  - `weekday_pattern` ‚Äî —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ (28 –¥–Ω–µ–π –∏—Å—Ç–æ—Ä–∏–∏)
- **Created**: 2025-11-29
- **Audited**: 2025-11-29 (Deep audit v3 ‚Äî final)

---

## üìä Summary

| Phase | –°–æ–≤–µ—Ç—ã | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è |
|-------|--------|-----------|-------|
| Phase 1 | 9 —Å–æ–≤–µ—Ç–æ–≤ (dayScore, training.type, weight, timing) | S-M | ~2—á |
| Phase 2 | 4 —Å–æ–≤–µ—Ç–∞ (timing, holidays, best_day) | M | ~1—á |
| Phase 3 | 8 —Å–æ–≤–µ—Ç–æ–≤ (gamification, patterns) | M | ~1.5—á |

**–ò—Ç–æ–≥–æ**: 21 –Ω–æ–≤—ã–π —Å–æ–≤–µ—Ç, ~4.5-5 —á–∞—Å–æ–≤

---

## üöÄ –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ `docs/tasks/archive/`
2. –û–±–Ω–æ–≤–∏—Ç—å `todo.md` ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º
3. –û–±–Ω–æ–≤–∏—Ç—å `DATA_MODEL_REFERENCE.md`:
   - –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –∏–∑ "–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ" –≤ "–í—Å–µ —Ç–∏–ø—ã —Å–æ–≤–µ—Ç–æ–≤"
   - –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é –Ω–∞ 1.4.0
