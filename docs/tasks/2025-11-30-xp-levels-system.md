# Task: XP, ะฃัะพะฒะฝะธ ะธ ะะพััะธะถะตะฝะธั โ ะะพะปะฝะฐั ัะธััะตะผะฐ ะณะตะนะผะธัะธะบะฐัะธะธ

> **Gamification 2.0**: ะััะธะฒะบะธ, ััะพะฒะฝะธ, flying coins, ััะฐััั-ะฑะฐั ะฒ ัะฐะฟะบะต  
> **Audit Version**: 4.0 | **Last Review**: 2025-11-30 (ะณะปัะฑะพะบะธะน ะฐัะดะธั)

## ๐ฏ WHY (ะะธะทะฝะตั-ะบะพะฝัะตะบัั)

**Problem**: ะะพะปัะทะพะฒะฐัะตะปะธ ัะตัััั ะผะพัะธะฒะฐัะธั ะฟะพัะปะต ะฟะตัะฒัั ะดะฝะตะน ััะตะบะธะฝะณะฐ, ะฝะตั ะพัััะตะฝะธั ะฟัะพะณัะตััะฐ

**Impact**: Retention ะฟะฐะดะฐะตั โ users ะฑัะพัะฐัั ะฟัะธะปะพะถะตะฝะธะต ัะตัะตะท 1-2 ะฝะตะดะตะปะธ

**Value**: ะะพะปะฝะพัะตะฝะฝะฐั ัะธััะตะผะฐ ะณะตะนะผะธัะธะบะฐัะธะธ ัะพะทะดะฐัั ะฟะตัะปั ะฒะพะฒะปะตัะตะฝะธั: ะดะตะนััะฒะธะต โ ะฝะฐะณัะฐะดะฐ โ ะฒะธะทัะฐะปัะฝัะน feedback โ ะฟัะพะณัะตัั โ ะถะตะปะฐะฝะธะต ะฟัะพะดะพะปะถะธัั

---

## ๐ฌ ะะะฃะะะะะ ะะฃะะะข (v4.0)

### โ ะงัะพ ะธะดะตะฐะปัะฝะพ ะฒ ะฟัะพะผะฟัะต:

| ะัะฟะตะบั | ะัะตะฝะบะฐ | ะะพะผะผะตะฝัะฐัะธะน |
|--------|--------|-------------|
| ะะธะทะฝะตั-ะพะฑะพัะฝะพะฒะฐะฝะธะต | โญโญโญโญโญ | ะงััะบะธะน WHY, ะฟะพะฝััะฝัะน value |
| UI ะฐััะธัะตะบัััะฐ | โญโญโญโญ | ะะธะทัะฐะปัะฝัะต ะดะธะฐะณัะฐะผะผั, ะฝะพะฒัะน layout |
| ะขะพัะบะธ ะธะฝัะตะณัะฐัะธะธ | โญโญโญโญ | ะะพะฝะบัะตัะฝัะต ัััะพะบะธ ะบะพะดะฐ |
| XP ัะฐะฑะปะธัะฐ | โญโญโญโญโญ | ะัะพะดัะผะฐะฝะฝัะน ะฑะฐะปะฐะฝั |
| ะฃัะพะฒะฝะธ ะธ ะฟะพัะพะณะธ | โญโญโญโญ | ะฅะพัะพัะฐั ะฟัะพะณัะตััะธั |
| ะะปะพะบะตัั | โญโญโญ | ะะฐะทะพะฒัะต, ะฝัะถะฝะพ ะดะพะฟะพะปะฝะธัั |

### ๐ด ะะะะขะะงะะกะะะ ะะะะะะะซ (ะฝะฐะนะดะตะฝะพ ะฟัะธ ะฐัะดะธัะต):

| # | ะัะพะฑะปะตะผะฐ | ะะพัะตะผั ะบัะธัะธัะฝะพ | ะะตัะตะฝะธะต |
|---|----------|-----------------|---------|
| C1 | **ะะตั onboarding XP** | ะะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั ะฑะตะท XP = 0 ะผะพัะธะฒะฐัะธะธ | ะะฐัั 50 XP ะฟัะธ ะฟะตัะฒะพะผ ะฒัะพะดะต + "ะะตัะฒัะน ัะฐะณ" achievement |
| C2 | **ะกะผะตะฝะฐ ะบะปะธะตะฝัะฐ = ะฟะพัะตัั XP?** | Multi-client ะฐััะธัะตะบัััะฐ โ XP per client ะธะปะธ global? | XP ะฟัะธะฒัะทะฐะฝ ะบ clientId ัะตัะตะท `U.lsSet` |
| C3 | **currentStreak ะฒััะธัะปัะตััั ะฒ useMemo** | ะัะถะตะฝ ะดะพัััะฟ ะฒ `heys_gamification_v1.js` ะฑะตะท React | ะญะบัะฟะพััะธัะพะฒะฐัั `calcStreak()` ะฒ `HEYS.utils` ะธะปะธ `HEYS.Day` |
| C4 | **ะะตั rollback ะฟัะธ ะพัะธะฑะบะต** | ะัะปะธ addXP() crashed โ UI ะฟะพะบะฐะทัะฒะฐะตั ััะฐัะพะต | try-catch + graceful degradation |
| C5 | **event?.target ะฝะต ะฒัะตะณะดะฐ ะตััั** | addWater ะฒัะทัะฒะฐะตััั ะธะท UI ะฑะตะท event | Fallback: ะธัะบะฐัั `.water-btn` ะธะปะธ header ะฝะฐะฟััะผัั |
| C6 | **Haptic ัะถะต ะตััั ะฒ ะฟัะพะตะบัะต** | `HEYS.utils.haptic()` ะฒ `heys_day_utils.js` | ะะตัะตะธัะฟะพะปัะทะพะฒะฐัั, ะฝะต ะดัะฑะปะธัะพะฒะฐัั |

### ๐ก ะะะขะะะฆะะะะฌะะซะ ะะะะคะะะะขะซ:

| # | ะะพะฝัะปะธะบั | ะะธัะบ | ะะตัะตะฝะธะต |
|---|----------|------|---------|
| K1 | **advice vs achievements** | ะะฑะฐ ะฟะพะบะฐะทัะฒะฐัั streak-ัะฒะตะดะพะผะปะตะฝะธั | ะัะธะพัะธัะตั: achievement popup > advice (ะฑะปะพะบะธัะพะฒะฐัั advice ะฟัะธ popup) |
| K2 | **confetti ะดัะฑะปะธัะพะฒะฐะฝะธะต** | 3+ ะผะตััะฐ ะฒัะทัะฒะฐัั confetti | ะฆะตะฝััะฐะปะธะทะพะฒะฐัั ะฒ `HEYS.game.celebrate()` |
| K3 | **Modal z-index ะฒะพะนะฝะฐ** | gramsModal, achievement popup, FAB | FAB: 1000, modals: 1050, achievement: 1100, confetti: 1200 |
| K4 | **Tab switch ะฟัะธ popup** | ะะพะปัะทะพะฒะฐัะตะปั ัะฒะฐะนะฟะฝัะป ะฒะบะปะฐะดะบั ะฒะพ ะฒัะตะผั popup | ะะปะพะบะธัะพะฒะฐัั swipe ะฟัะธ ะพัะบัััะพะผ achievement popup |
| K5 | **day_completed timing** | ะะพะณะดะฐ ะธะผะตะฝะฝะพ ะทะฐััะธััะฒะฐัั "ะดะตะฝั ะฒัะฟะพะปะฝะตะฝ"? | ะะพัะปะต 21:00 ะตัะปะธ ratio 0.75-1.1, ะธะปะธ ะฝะฐ ัะปะตะดัััะธะน ะดะตะฝั |

### ๐ต ะฃะะฃะฉะะะะซะ ะะะะะะะะะกะขะ:

| # | ะะดะตั | WOW-ัะฐะบัะพั | ะกะปะพะถะฝะพััั |
|---|------|------------|-----------|
| U1 | **Daily login bonus** | โญโญโญ | S โ +20 XP ะทะฐ ะฟะตัะฒัะน ะฒัะพะด/ะดะตะฝั |
| U2 | **Combo system** | โญโญโญโญ | M โ 3 ะดะตะนััะฒะธั ะทะฐ ะผะธะฝััั = x2 XP |
| U3 | **XP decay warning** | โญโญ | S โ "3 ะดะฝั ะฑะตะท ะฐะบัะธะฒะฝะพััะธ โ ะฝะต ัะตััะน ะฟัะพะณัะตัั!" |
| U4 | **Level color theme** | โญโญโญ | S โ UI ะฐะบัะตะฝัั ะผะตะฝััััั ั ััะพะฒะฝะตะผ |
| U5 | **Milestone sharing** | โญโญโญ | M โ "ะะพะดะตะปะธัััั" streak/level ะฒ stories |
| U6 | **ะะตััะพะฝะฐะปัะฝัะน best streak** | โญโญโญโญ | S โ ะฃะถะต ะตััั ะฒ advice! ะะตัะตะธัะฟะพะปัะทะพะฒะฐัั |

---

## ๐จ ะะะะะฏ ะะะฅะะขะะะขะฃะะ UI

### ะะปะฐะฒะฝัะน ะฟัะธะฝัะธะฟ: ะะกะฏ ัะฐะฟะบะฐ = ะณะตะนะผะธัะธะบะฐัะธั

```
ะะะะะะะขะะซะ ะะะ (ะฒัะตะณะดะฐ ะฒะธะดะฝะพ):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ฑ ะฃั.7  โโโโโโโโโโ  450/600    ๐ฅ5    [โผ]         โ โ hdr-top = gamification bar
โ  ะะพะฒะธัะพะบ              75%                            โ   [โผ] = ะบะฝะพะฟะบะฐ ัะฐัะบัััะธั
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ะะะะะะะะฃะขะซะ ะะะ (ะฟะพ ะบะปะธะบั ะฝะฐ [โผ]):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ฑ ะฃั.7  โโโโโโโโโโ  450/600    ๐ฅ5    [โฒ]         โ
โ  ะะพะฒะธัะพะบ              75%                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                      โ
โ   ๐ ะกะขะะขะะกะขะะะ                                      โ
โ   โโโโโโโโโโโโโโฌโโโโโโโโโโโโโฌโโโโโโโโโโโโโ          โ
โ   โ ะัะตะณะพ XP   โ Streak     โ ะะฝะตะน       โ          โ
โ   โ   1,250    โ  ๐ฅ 5      โ   23       โ          โ
โ   โโโโโโโโโโโโโโดโโโโโโโโโโโโโดโโโโโโโโโโโโโ          โ
โ                                                      โ
โ   ๐ ะะะกะขะะะะะะฏ (3/13)                              โ
โ   [๐ฏ โ] [๐ฅ โ] [๐ โ] [โญ โ] [๐ โ] ...           โ
โ                                                      โ
โ   ๐ ะะ ะกะะะะฃะฎะฉะะะ ะฃะะะะะฏ                           โ
โ   ะัั 150 XP (~30 ะดะตะนััะฒะธะน)                         โ
โ   โโโโโโโโโโโโโโโโโโโโโโโโ 75%                      โ
โ                                                      โ
โ   ๐ ะะถะตะดะฝะตะฒะฝัะน ะฑะพะฝัั: ะะตะฝั 3 (+20 XP)              โ
โ                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ [ะะ] ะะฝัะพะฝ ะะพะฟะปะฐะฒัะบะธะน  [๐ 30] [< ะะพัะฑัั 2025 >]    โ โ hdr-bottom
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะพะผะฟะพะฝะตะฝัั hdr-top (ะบะพะผะฟะฐะบัะฝัะน):

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ [ะขะธััะป+ะฃั] [โโโProgressโโโ] [XP/Max] [Streak] [Expand]     โ
โ  ๐ฑ ะฃั.7    โโโโโโโโโโโโโโ   450/600   ๐ฅ5      [โผ]        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

| ะญะปะตะผะตะฝั | ะจะธัะธะฝะฐ | ะะฟะธัะฐะฝะธะต |
|---------|--------|----------|
| ะขะธััะป+ะฃัะพะฒะตะฝั | auto | `๐ฑ ะฃั.7` ะธะปะธ `๐ ะฃั.23` |
| Progress bar | flex-grow | ะะธะทัะฐะปัะฝัะน ะฟัะพะณัะตัั ะดะพ ัะปะตะด. ััะพะฒะฝั |
| XP counter | auto | `450/600` (ัะตะบััะธะน/ะดะพ ัะปะตะด. ััะพะฒะฝั) |
| Streak | auto | `๐ฅ5` (ะดะฝะตะน ะฟะพะดััะด) |
| Expand btn | 32px | `โผ` / `โฒ` toggle |

### ะะฐะทะฒััะฝััะฐั ะฟะฐะฝะตะปั (GamePanel):

```javascript
// ะกะพะดะตัะถะธะผะพะต ัะฐะทะฒััะฝััะพะน ะฟะฐะฝะตะปะธ
const GamePanel = {
  stats: {
    totalXP: 1250,
    currentStreak: 5,
    bestStreak: 12,
    totalDays: 23,
    perfectDays: 8
  },
  achievements: {
    unlocked: ['first_meal', 'streak_3', 'streak_7'],
    total: 13,
    progress: { streak_14: '7/14', water_master: '3/7' }
  },
  nextLevel: {
    current: 7,
    xpNeeded: 150,
    estimatedActions: 30
  },
  dailyBonus: {
    day: 3,
    xp: 20,
    claimed: false
  }
};
```

### ะะฐะทะดะตะปะตะฝะธะต ะทะพะฝ ัะฒะตะดะพะผะปะตะฝะธะน:

| ะขะธะฟ ัะฒะตะดะพะผะปะตะฝะธั | ะะพะทะธัะธั | Z-index | ะขัะธะณะณะตั |
|-----------------|---------|---------|---------|
| **ะกะพะฒะตัั (advice)** | ะะธะท ัะบัะฐะฝะฐ | 900 | tab_open, product_added |
| **XP gain (+5)** | Flying animation โ header | 1150 | ะะฐะถะดะพะต ะดะตะนััะฒะธะต |
| **Level up popup** | ะะพะด hdr-top, ะฟะพะฒะตัั hdr-bottom | 1100 | ะัะธ ะฟะพะฒััะตะฝะธะธ ััะพะฒะฝั |
| **Achievement popup** | ะะพะด hdr-top, ะฟะพะฒะตัั hdr-bottom | 1100 | ะัะธ ะดะพััะธะถะตะฝะธะธ |
| **Confetti** | ะะตัั ัะบัะฐะฝ | 1200 | Level % 5, streak 7+ |

### ะฃะดะฐะปัะตะผัะต ัะปะตะผะตะฝัั:

| ะญะปะตะผะตะฝั | ะัะปะพ | ะกัะฐะปะพ |
|---------|------|-------|
| "๐ฅ HEYS" ะปะพะณะพัะธะฟ | hdr-top | โ ะฃะฑัะฐัั |
| "ะะฐะฝะตะปั ะบััะฐัะพัะฐ" | hdr-top | โ ะฃะฑัะฐัั |
| "ะะฝะปะฐะนะฝ/ะัะปะฐะนะฝ" ััะฐััั | hdr-top | โ ะฃะฑัะฐัั |
| "โป ะกะผะตะฝะธัั" ะบะฝะพะฟะบะฐ | hdr-top | โ Long-press ะฝะฐ ะฐะฒะฐัะฐั |
| Theme toggle โ๏ธ/๐ | hdr-top | โ FAB ะฒ ัะณะปั (fixed) |
| Analytics button | hdr-top | โ ะ ะัะพัะธะปั |

---

## โจ Flying Coins / XP Animation

**ะะพะฝัะตะฟัะธั**: ะัะธ ะดะพััะธะถะตะฝะธะธ XP โ ะผะพะฝะตัะบะฐ/ะทะฒะตะทะดะฐ ะฒัะปะตัะฐะตั ะธะท ะผะตััะฐ ะดะตะนััะฒะธั ะธ ะปะตัะธั ะฒ ััะฐััั-ะฑะฐั

```
[ะัะพะดัะบั ะดะพะฑะฐะฒะปะตะฝ]
       โ
      โญ โโโ ะฟะพัะฒะปัะตััั ะทะดะตัั
       \
        \   โโโ ะปะตัะธั ะฟะพ ะดัะณะต
         \
          โ [โโโโ 455XP] โโโ ะฟัะธะทะตะผะปัะตััั ััะดะฐ, ะฑะฐั ะฟัะปััะธััะตั
```

### ะขะตัะฝะธัะตัะบะฐั ัะตะฐะปะธะทะฐัะธั:
```javascript
// 1. ะะพะปััะฐะตะผ ะบะพะพัะดะธะฝะฐัั ะธััะพัะฝะธะบะฐ (ะบะฝะพะฟะบะฐ ะดะพะฑะฐะฒะปะตะฝะธั)
const sourceEl = event.target.getBoundingClientRect();

// 2. ะะพะปััะฐะตะผ ะบะพะพัะดะธะฝะฐัั ัะตะปะธ (XP bar ะฒ header)
const targetEl = document.querySelector('.xp-bar').getBoundingClientRect();

// 3. ะกะพะทะดะฐัะผ flying element
const coin = document.createElement('div');
coin.className = 'flying-xp';
coin.textContent = '+5';
coin.style.cssText = `
  position: fixed;
  left: ${sourceEl.x}px;
  top: ${sourceEl.y}px;
  z-index: 9999;
  font-size: 16px;
  font-weight: bold;
  color: #eab308;
`;
document.body.appendChild(coin);

// 4. ะะฝะธะผะฐัะธั ะฟะพะปััะฐ (CSS transition ะธะปะธ FLIP)
requestAnimationFrame(() => {
  coin.style.transform = `translate(${targetEl.x - sourceEl.x}px, ${targetEl.y - sourceEl.y}px)`;
  coin.style.opacity = '0';
  coin.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
});

// 5. ะฃะดะฐะปะตะฝะธะต ะฟะพัะปะต ะฐะฝะธะผะฐัะธะธ
setTimeout(() => coin.remove(), 700);
```

---

## ๐ด ะะฃะะะข: ะะพัะตะฝัะธะฐะปัะฝัะต ะฟัะพะฑะปะตะผั

### ๐ซ ะะปะพะบะตัั (ะธัะฟัะฐะฒะธัั ะะ ัะตะฐะปะธะทะฐัะธะธ โ Phase 0)

| # | ะัะพะฑะปะตะผะฐ | ะะธัะบ | ะะตัะตะฝะธะต |
|---|----------|------|---------|
| B1 | **Layout shift**: ะะพะฑะฐะฒะปะตะฝะธะต XP bar ะฒ header ะผะพะถะตั ัะปะพะผะฐัั responsive | ๐ด ะััะพะบะธะน | ะัะฟะพะปัะทะพะฒะฐัั flex ั `flex-shrink`, ัะตััะธัะพะฒะฐัั ะฝะฐ 320px |
| B2 | **Popup vs hdr-bottom**: Popup ะดะพะปะถะตะฝ ะบัะฐัะธะฒะพ ะฝะฐะบะปะฐะดัะฒะฐัััั | ๐ก ะกัะตะดะฝะธะน | CSS: popup `position: absolute; top: 100%`, slideDown animation |
| B3 | **Advice vs Game notifications**: ะะพะฝัะปะธะบั ะฒะฝะธะผะฐะฝะธั | ๐ข ะะตัะตะฝะพ | Advice = ะฝะธะท, Game = ะฒะตัั (ะฟะพะด hdr-top) |
| B4 | **Confetti ะดัะฑะปะธัะพะฒะฐะฝะธะต** | ๐ก | ะฆะตะฝััะฐะปะธะทะพะฒะฐัั: `HEYS.game.celebrate()` โ ะฒัะทัะฒะฐะตั `setShowConfetti` |
| B5 | **Client namespace** | ๐ด | XP ะดะฐะฝะฝัะต ัะตัะตะท `U.lsSet('heys_game', ...)` โ ะฐะฒัะพะผะฐัะธัะตัะบะธ ั clientId |
| B6 | **currentStreak ะฝะตะดะพัััะฟะตะฝ ะฒะฝะต React** | ๐ด | ะญะบัะฟะพััะธัะพะฒะฐัั `HEYS.Day.getStreak()` ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฒ gamification |
| B7 | **event.target ะพััััััะฒัะตั** | ๐ก | Fallback: `document.querySelector('.xp-bar')` ะดะปั ะฐะฝะธะผะฐัะธะธ |
| B8 | **z-index ะบะพะฝัะปะธะบัั** | ๐ก | Advice=900, Game popup=1100, Flying XP=1150, Confetti=1200 |

### โ๏ธ ะะฐะผะตัะฐะฝะธั

| # | ะัะพะฑะปะตะผะฐ | ะะตัะตะฝะธะต |
|---|----------|---------|
| W1 | **FAB theme toggle** ะผะพะถะตั ะผะตัะฐัั ะบะพะฝัะตะฝัั | z-index: 1000, position: fixed, top: 8px right: 8px. **ะะ ะฟะตัะตะบััะฒะฐัั** XP bar |
| W2 | **"ะกะผะตะฝะธัั ะบะปะธะตะฝัะฐ"** | Long-press ะฝะฐ ะฐะฒะฐัะฐั ะบะปะธะตะฝัะฐ ะฒ hdr-bottom |
| W3 | **XP bar ะฝะฐ ัะทะบะธั ัะบัะฐะฝะฐั** | Mobile: ัะพะปัะบะพ `โญ7 โโโโ` (ะฑะตะท ัะตะบััะฐ "XP"), desktop: ะฟะพะปะฝัะน |
| W4 | **day_completed timing** | ะัะพะฒะตัััั ะฒ 23:00 ะธะปะธ ะฟัะธ ะฟะตัะฒะพะผ ะฒัะพะดะต ะฝะฐ ัะปะตะดัััะธะน ะดะตะฝั |
| W5 | **Game popup auto-hide** | ะะฒัะพะผะฐัะธัะตัะบะธ ัะบััะฒะฐัั ัะตัะตะท 4 ัะตะบ ะธะปะธ ะฟะพ tap |

### ๐ ะัะตะฒะตะฝัะธะฒะฝัะต ะฟัะพะฒะตัะบะธ (ะดะพะฑะฐะฒะธัั ะฒ Phase 0)

| # | ะงัะพ ะฟัะพะฒะตัะธัั | ะะฐะบ | ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั |
|---|---------------|-----|---------------------|
| P1 | 5 ัะฐะฑะพะฒ ะฒะปะตะทะฐัั ะฝะฐ 320px? | DevTools โ iPhone SE | ะัะต ัะฐะฑั ะฒะธะดะฝั ะฑะตะท ัะบัะพะปะปะฐ |
| P2 | `HEYS.utils.haptic` ัะฐะฑะพัะฐะตั? | Console: `HEYS.utils.haptic('success')` | ะะธะฑัะฐัะธั ะฝะฐ ัะตะปะตัะพะฝะต |
| P3 | `U.lsSet` ั clientId? | Console: `U.lsSet('test', {a:1}); localStorage` | ะะปัั `heys_test_clientXXX` |
| P4 | confetti ัะฐะฑะพัะฐะตั? | ะขัะธะณะณะตั: ะดะพััะธัั 100% ะบะฐะปะพัะธะน | ะะพะฝัะตััะธ ะฟะพัะฒะปัะตััั |
| P5 | currentStreak ะดะพัััะฟะตะฝ? | Console: ะฟะพัะผะพััะตัั `HEYS.Day` | ะัะถะฝะพ ัะบัะฟะพััะธัะพะฒะฐัั |

---

## ๐ค Output Preferences

**Workflow**: Implement directly โ ะบะพะด ัะถะต ัะฟัะพะตะบัะธัะพะฒะฐะฝ ะฒ ััะพะผ ะฟัะพะผะฟัะต

**Code style**: Follow copilot-instructions.md, ะผะธะฝะธะผะฐะปัะฝัะต ะบะพะผะผะตะฝัะฐัะธะธ, Legacy JS ะฟะฐััะตัะฝั

---

## ๐๏ธ Phase 0: ะะพะดะณะพัะพะฒะบะฐ ััะฝะดะฐะผะตะฝัะฐ (ะะะะขะะงะะ!) โ ะะซะะะะะะะ

> **ะฆะตะปั**: ะะพะปะฝะพัััั ะฟะตัะตัััะพะธัั hdr-top ะฟะพะด ะณะตะนะผะธัะธะบะฐัะธั

### 0.1 ะฃะดะฐะปะธัั ััะฐััะต ัะปะตะผะตะฝัั ะธะท hdr-top

- [x] **ะฃะดะฐะปะธัั ะปะพะณะพัะธะฟ "๐ฅ HEYS"** โ
- [x] **ะฃะดะฐะปะธัั "ะะฐะฝะตะปั ะบััะฐัะพัะฐ"** โ
- [x] **ะฃะดะฐะปะธัั ััะฐััั "ะะฝะปะฐะนะฝ/ะัะปะฐะนะฝ"** โ
- [x] **ะฃะดะฐะปะธัั ะบะฝะพะฟะบั "โป ะกะผะตะฝะธัั"** โ Long-press ะฝะฐ ะฐะฒะฐัะฐั โ
- [x] **Theme toggle โ FAB** (fixed, top: 12px, right: 12px, z-index: 1000) โ
- [x] **Analytics button โ ะัะพัะธะปั** โ

### 0.2 ะัะพะฒะตัะบะธ

- [x] **hdr-top = gamification placeholder** โ `๐ฑ ะฃั.1 | โโโโโโ | 0/100 | ๐ฅ0`
- [x] **FAB ัะฐะฑะพัะฐะตั** โ theme toggle ะฒ ัะณะปั
- [x] **Long-press ะฝะฐ ะฐะฒะฐัะฐั** โ 600ms โ confirm โ ัะผะตะฝะฐ ะบะปะธะตะฝัะฐ
- [x] **HEYS.Day.getStreak()** โ ัะบัะฟะพััะธัะพะฒะฐะฝ ะดะปั gamification ะผะพะดัะปั
- [x] **CSS ะดะพะฑะฐะฒะปะตะฝ** โ `.theme-fab`, `.game-bar-placeholder`, `.game-*`

### 0.3 z-index ะธะตัะฐััะธั (ะดะพะฑะฐะฒะปะตะฝะพ ะฒ CSS)

```css
.theme-fab { z-index: 1000; }
.game-panel-expanded { z-index: 1050; }
.game-popup { z-index: 1100; }
.flying-xp { z-index: 1150; }
.confetti-container { z-index: 1200; }
/* Advice toasts ัะถะต z-index: 900 โ ะฝะธะถะต ะฒัะตะณะพ */
```

---

## ๐๏ธ Phase 1: Core XP Module

### Must Have (ะบัะธัะธัะฝะพ ะดะปั ัะตะปะธะทะฐ)

- [ ] **ะกะพะทะดะฐัั heys_gamification_v1.js** โ ะฏะดัะพ XP/ััะพะฒะฝะตะน/coins
  - **ะคะฐะนะป**: `apps/web/heys_gamification_v1.js`
  - **Why**: ะฆะตะฝััะฐะปะธะทะพะฒะฐะฝะฝะฐั ะปะพะณะธะบะฐ ะณะตะนะผะธัะธะบะฐัะธะธ โ ะพะดะธะฝ ะธััะพัะฝะธะบ ะฟัะฐะฒะดั
  - **Acceptance**: `HEYS.game.addXP(amount, reason, sourceEl)` ัะฐะฑะพัะฐะตั
  - **ะกะพะดะตัะถะธะผะพะต**:
    ```javascript
    HEYS.game = {
      // XP
      addXP(amount, reason, sourceEl) { ... },
      getLevel() { ... },
      getProgress() { ... },
      
      // Coins (ะพะฟัะธะพะฝะฐะปัะฝะพ, Phase 2)
      addCoins(amount) { ... },
      getCoins() { ... },
      
      // Achievements
      checkAchievement(id) { ... },
      getAchievements() { ... },
      
      // Stats
      getStats() { ... },
      
      // Flying animation
      flyToBar(sourceEl, type) { ... }
    };
    ```
  - **localStorage ะบะปัั**: `heys_game` (ัะตัะตะท `U.lsSet`)

- [ ] **GamificationBar ะบะพะผะฟะพะฝะตะฝั** โ ะัะพะฑัะฐะถะตะฝะธะต ะฒ header
  - **ะคะฐะนะป**: `apps/web/heys_app_v12.js` (ะฝะพะฒัะน ะบะพะผะฟะพะฝะตะฝั)
  - **Where**: hdr-top ัะฟัะฐะฒะฐ
  - **Acceptance**: ะะพะบะฐะทัะฒะฐะตั ััะพะฒะตะฝั, ะฟัะพะณัะตัั, streak, coins
  - **Mobile UI**: `โญ7 โโโ ๐ฅ5` (ะบะพะผะฟะฐะบัะฝะพ)
  - **Desktop UI**: `โญ ะฃั.7 โโโโโโ 450XP | ๐ฅ5 ะดะฝะตะน | ๐ฐ230`

- [ ] **Flying XP Animation** โ ะะธะทัะฐะปัะฝัะน feedback
  - **ะคะฐะนะป**: `apps/web/heys_gamification_v1.js`
  - **Trigger**: ะัะธ ะปัะฑะพะผ addXP() ั sourceEl
  - **ะะฝะธะผะฐัะธั**: ะะฒะตะทะดะฐ/ะผะพะฝะตัะฐ ะปะตัะธั ะธะท sourceEl ะฒ GamificationBar
  - **CSS**: `@keyframes flyToBar { ... }`

- [ ] **ะะพะดะบะปััะธัั ะฒ index.html**
  - **ะคะฐะนะป**: `apps/web/index.html`
  - **After**: `heys_ratio_zones_v1.js`
  - **Acceptance**: `HEYS.game` ะดะพัััะฟะตะฝ ะฒ ะบะพะฝัะพะปะธ

- [ ] **ะะฝัะตะณัะฐัะธั ั ะดะตะนััะฒะธัะผะธ** โ ะัะทะพะฒั addXP ะฒ ะฝัะถะฝัั ะผะตััะฐั
  - **ะคะฐะนะป**: `apps/web/heys_day_v12.js`
  - **Why**: XP ะฝะฐัะธัะปัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ะดะตะนััะฒะธัั ะฟะพะปัะทะพะฒะฐัะตะปั
  - **ะขะพัะบะธ ะธะฝัะตะณัะฐัะธะธ** (ั ะฟะตัะตะดะฐัะตะน sourceEl ะดะปั flying animation):
    ```javascript
    // addProductToMeal():2500
    function addProductToMeal(mi, p) {
      // ... existing code ...
      if (HEYS.game) HEYS.game.addXP(5, 'product_added', event?.target);
    }
    
    // addWater():1873
    function addWater(ml) {
      // ... existing code ...
      if (HEYS.game) HEYS.game.addXP(2, 'water_added', event?.target);
    }
    
    // confirmTrainingPicker():~2085
    function confirmTrainingPicker() {
      // ... existing code ...
      if (HEYS.game) HEYS.game.addXP(15, 'training_added');
    }
    ```
  - **Acceptance**: ะะฐะถะดะพะต ะดะตะนััะฒะธะต โ ะทะฒะตะทะดะฐ ะปะตัะธั ะฒ XP bar

---

## ๐๏ธ Phase 2: ะกะธััะตะผะฐ ะดะพััะธะถะตะฝะธะน (Achievements)

### Achievements Library

| ID | ะะฐะทะฒะฐะฝะธะต | ะฃัะปะพะฒะธะต | ะะฐะณัะฐะดะฐ | ะะบะพะฝะบะฐ |
|----|----------|---------|---------|--------|
| `first_meal` | ะะตัะฒัะน ัะฐะณ | ะะพะฑะฐะฒะธัั ะฟะตัะฒัะน ะฟัะพะดัะบั | +50 XP | ๐ฏ |
| `streak_3` | ะขัะธ ะดะฝั ะฟะพะดััะด | Streak โฅ 3 | +30 XP | ๐ฅ |
| `streak_7` | ะะตะดะตะปั ััะฟะตัะฐ | Streak โฅ 7 | +100 XP | ๐ |
| `streak_14` | ะะฒะต ะฝะตะดะตะปะธ | Streak โฅ 14 | +200 XP | โญ |
| `streak_30` | ะะตััั ัะธะปั | Streak โฅ 30 | +500 XP | ๐ |
| `perfect_day` | ะะดะตะฐะปัะฝัะน ะดะตะฝั | ratio 0.95-1.05 | +25 XP | ๐ |
| `water_master` | ะะพะดะฝัะน ะฑะฐะปะฐะฝั | ะะพัะผะฐ ะฒะพะดั 7 ะดะฝะตะน | +100 XP | ๐ง |
| `training_week` | ะกะฟะพัััะผะตะฝ | 5 ััะตะฝะธัะพะฒะพะบ/ะฝะตะดะตะปั | +150 XP | ๐ช |
| `early_bird` | ะะฐะฝะฝัั ะฟัะฐัะบะฐ | ะะฐะฒััะฐะบ ะดะพ 9:00 7 ะดะฝะตะน | +100 XP | ๐ |
| `night_owl` | ะะตะท ะฝะพัะฝัั ะฟะตัะตะบััะพะฒ | ะะตั ะตะดั ะฟะพัะปะต 22:00 7 ะดะฝะตะน | +100 XP | ๐ |
| `level_5` | ะฃัะตะฝะธะบ | ะะพััะธัั 5 ััะพะฒะฝั | +50 XP | ๐ |
| `level_10` | ะัะฐะบัะธะบ | ะะพััะธัั 10 ััะพะฒะฝั | +100 XP | ๐ช |
| `level_20` | ะะฐััะตั | ะะพััะธัั 20 ััะพะฒะฝั | +200 XP | ๐ |

### Achievement Popup

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ ะะะกะขะะะะะะ ะะะะะะะะะะะะะะ! โ
โ                                 โ
โ       โญ ะะตะดะตะปั ััะฟะตัะฐ โญ       โ
โ     7 ะดะฝะตะน ะฟะพะดััะด ะฒ ะฝะพัะผะต!     โ
โ                                 โ
โ         +100 XP ๐ซ              โ
โ                                 โ
โ        [๐ ะัะปะธัะฝะพ!]            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

- **ะะพะบะฐะท**: Modal ั ะฐะฝะธะผะฐัะธะตะน ะฟะพัะฒะปะตะฝะธั (scale + fade)
- **Confetti**: ะะฐ, ะฟัะธ milestone ะดะพััะธะถะตะฝะธัั (streak 7+)
- **Sound**: ะะฟัะธะพะฝะฐะปัะฝะพ (Web Audio API)
- **Dismiss**: Tap anywhere ะธะปะธ ะบะฝะพะฟะบะฐ

---

## ๐๏ธ Phase 3: Notifications & Polish

### Must Have

- [ ] **Level Up notification** โ Popup ะฟะพะด hdr-top
  - **Where**: ะะฐะทะฒะพัะฐัะธะฒะฐะตััั ะฟะพะด gamification bar, ะฟะพะฒะตัั hdr-bottom
  - **Animation**: slideDown + scale, auto-hide ัะตัะตะท 4 ัะตะบ
  - **Acceptance**: ะัะธ level up ะฟะพะบะฐะทัะฒะฐะตััั "๐ ะฃัะพะฒะตะฝั 8! ะขั ัะตะฟะตัั ะัะฐะบัะธะบ"
  - **Bonus**: Confetti ะฟัะธ ััะพะฒะฝัั ะบัะฐัะฝัั 5

- [ ] **Achievement popup** โ Popup ะฟะพะด hdr-top
  - **UI**: ะะฝะฐะปะพะณะธัะฝะพ level up, ะฝะพ ั ะธะบะพะฝะบะพะน ะดะพััะธะถะตะฝะธั
  - **Animation**: slideDown + confetti ะฟัะธ milestone ะดะพััะธะถะตะฝะธัั
  - **Auto-hide**: 5 ัะตะบ ะธะปะธ tap anywhere

- [ ] **Game Popup ะบะพะผะฟะพะฝะตะฝั**
  - **ะคะฐะนะป**: `apps/web/heys_gamification_v1.js`
  - **ะะพะทะธัะธั**: `position: absolute; top: 100%; left: 0; right: 0`
  - **CSS**: Rounded bottom corners, gradient background, shadow
  - **States**: hidden โ visible (slideDown) โ hidden (slideUp)

```javascript
// Game Popup API
HEYS.game.showPopup({
  type: 'level_up', // 'level_up' | 'achievement' | 'daily_bonus'
  title: '๐ ะฃัะพะฒะตะฝั 8!',
  subtitle: 'ะขั ัะตะฟะตัั ะัะฐะบัะธะบ ๐ช',
  xp: '+100 XP',
  confetti: true,
  duration: 4000 // auto-hide
});
```

### Could Have (nice to have)

- [ ] **Achievements gallery** โ ะัะพัะผะพัั ะฒัะตั ะดะพััะธะถะตะฝะธะน
  - **Where**: ะ ะฟัะพัะธะปะต, ะฝะพะฒะฐั ัะตะบัะธั "๐ ะะพััะธะถะตะฝะธั"
  - **UI**: Grid ะบะฐััะพัะตะบ (locked/unlocked)

- [ ] **Weekly XP Report** โ ะ advice ะผะพะดัะปะต
  - **Trigger**: ะะพัะบัะตัะตะฝัะต ะฒะตัะตั
  - **Text**: "ะะฐ ััะพะน ะฝะตะดะตะปะต: 450 XP, 2 ะดะพััะธะถะตะฝะธั! ๐"

---

## ๐๏ธ Phase 4: Coins & Rewards (Future)

> **ะัะธะผะตัะฐะฝะธะต**: Coins ะดะพะฑะฐะฒะปัะตะผ ะะะกะะ ััะฐะฑะธะปะธะทะฐัะธะธ XP/Achievements

| ะะตะนััะฒะธะต | Coins | ะัะธะผะตัะฐะฝะธะต |
|----------|------:|------------|
| Streak 7 ะดะฝะตะน | +50 | Weekly bonus |
| Level up | +20 | ะะฐ ะบะฐะถะดัะน ััะพะฒะตะฝั |
| ะะพััะธะถะตะฝะธะต | +10-50 | ะะฐะฒะธัะธั ะพั ัะปะพะถะฝะพััะธ |

**ะัะดััะตะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต coins**:
- ะะฐััะพะผะธะทะฐัะธั UI (ัะตะผั, ะธะบะพะฝะบะธ)
- Premium features unlock
- Streak freeze (ะฟัะพะฟัััะธัั 1 ะดะตะฝั ะฑะตะท ะฟะพัะตัะธ streak)

---

## ๐ XP ะขะฐะฑะปะธัะฐ (ะบะพะฝัะธะณััะฐัะธั)

| ะะตะนััะฒะธะต | XP | Reason ID | ะฃัะปะพะฒะธะต |
|----------|---:|-----------|---------|
| ะะพะฑะฐะฒะธัั ะฟัะพะดัะบั | +5 | `product_added` | ะะฐะถะดัะน ัะฐะท |
| ะะพะฑะฐะฒะธัั ะฒะพะดั | +2 | `water_added` | ะะฐะบั 10 ัะฐะท/ะดะตะฝั |
| ะะพะฑะฐะฒะธัั ััะตะฝะธัะพะฒะบั | +15 | `training_added` | ะะพ 3 ะฒ ะดะตะฝั |
| ะะฐะฟะพะปะฝะธัั ัะพะฝ | +5 | `sleep_logged` | ะะดะธะฝ ัะฐะท/ะดะตะฝั |
| ะะฐะฟะพะปะฝะธัั ะฒะตั | +5 | `weight_logged` | ะะดะธะฝ ัะฐะท/ะดะตะฝั |
| ะัะฟะพะปะฝะธัั ะฝะพัะผั ะบะฐะปะพัะธะน | +50 | `day_completed` | ratio 0.75-1.1, ะพะดะธะฝ ัะฐะท/ะดะตะฝั |
| Streak 3 ะดะฝั | +30 | `streak_3` | ะัะธ ะดะพััะธะถะตะฝะธะธ |
| Streak 7 ะดะฝะตะน | +100 | `streak_7` | ะัะธ ะดะพััะธะถะตะฝะธะธ |
| Streak 14 ะดะฝะตะน | +200 | `streak_14` | ะัะธ ะดะพััะธะถะตะฝะธะธ |
| Streak 30 ะดะฝะตะน | +500 | `streak_30` | ะัะธ ะดะพััะธะถะตะฝะธะธ |
| Perfect day (ratio 0.95-1.05) | +25 | `perfect_day` | ะะพะฝัั ะบ day_completed |

**ะะฐัะธัะฐ ะพั ัะฟะฐะผะฐ**: ะัะฟะพะปัะทะพะฒะฐัั `sessionStorage` ะธะปะธ `heys_xp_daily_{date}` ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั ัะถะต ะฝะฐัะธัะปะตะฝะฝัั "ัะฐะทะพะฒัั" ะฑะพะฝััะพะฒ.

---

## ๐ ะฃัะพะฒะฝะธ ะธ ะฟะพัะพะณะธ

```javascript
const LEVEL_THRESHOLDS = [
  0,      // ะฃัะพะฒะตะฝั 1: 0 XP
  100,    // ะฃัะพะฒะตะฝั 2: 100 XP
  300,    // ะฃัะพะฒะตะฝั 3: 300 XP
  600,    // ะฃัะพะฒะตะฝั 4: 600 XP
  1000,   // ะฃัะพะฒะตะฝั 5: 1000 XP
  1500,   // ะฃัะพะฒะตะฝั 6: 1500 XP
  2200,   // ะฃัะพะฒะตะฝั 7: 2200 XP
  3000,   // ะฃัะพะฒะตะฝั 8: 3000 XP
  4000,   // ะฃัะพะฒะตะฝั 9: 4000 XP
  5200,   // ะฃัะพะฒะตะฝั 10: 5200 XP
  6500,   // ...ะธ ั.ะด. ั ัะฒะตะปะธัะตะฝะธะตะผ ัะฐะณะฐ
  8000,
  10000,
  12500,
  15500,
  19000,
  23000,
  27500,
  32500,
  38000,  // ะฃัะพะฒะตะฝั 20
];
```

**ะะฐัััั**: 
- ะฃั. 1โ2: ~20 ะดะตะนััะฒะธะน (2-3 ะดะฝั ะฐะบัะธะฒะฝะพะณะพ ััะตะบะธะฝะณะฐ)
- ะฃั. 10: ~2-3 ะฝะตะดะตะปะธ ะฐะบัะธะฒะฝะพะณะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั
- ะฃั. 20: ~2-3 ะผะตัััะฐ

---

## ๐ ะะปััะตะฒัะต ัะฐะนะปั (ะฐัะดะธั)

| ะคะฐะนะป | ะงัะพ ัะผะพััะตัั | ะกััะพะบะธ |
|------|--------------|--------|
| `heys_day_v12.js` | `addProductToMeal()` โ ัะพัะบะฐ ะธะฝัะตะณัะฐัะธะธ | ~2483-2500 |
| `heys_day_v12.js` | `addWater()` โ ะฒะพะดะฐ | ~1873-1890 |
| `heys_day_v12.js` | Training save โ ััะตะฝะธัะพะฒะบะธ | ~2080-2120 |
| `heys_day_v12.js` | `currentStreak` โ ัะฐัััั streak | ~2545-2580 |
| `heys_ratio_zones_v1.js` | `isSuccess()` โ ะพะฟัะตะดะตะปะตะฝะธะต ััะฟะตัะฝะพะณะพ ะดะฝั | ~120-125 |
| `heys_storage_layer_v1.js` | `Store.set/get` โ ะฟะฐััะตัะฝ ััะฐะฝะตะฝะธั | ~1-100 |
| `archive/legacy-v12/gaming/heys_gaming_system_v1.js` | Legacy XP ัะธััะตะผะฐ (ัะตัะตัะตะฝั) | ะฒัั |

---

## โ DONE (ะัะธัะตัะธะธ ะฟัะธัะผะบะธ)

### Functional

- [ ] XP ะฝะฐัะธัะปัะตััั ะฟัะธ ะดะพะฑะฐะฒะปะตะฝะธะธ ะฟัะพะดัะบัะฐ, ะฒะพะดั, ััะตะฝะธัะพะฒะบะธ
- [ ] XP ะฟะพะบะฐะทัะฒะฐะตััั ะฒ UI (ััะพะฒะตะฝั + ะฟัะพะณัะตัั-ะฑะฐั)
- [ ] Level up notification ัะฐะฑะพัะฐะตั
- [ ] ะะฐะฝะฝัะต ัะพััะฐะฝััััั ะผะตะถะดั ัะตััะธัะผะธ (localStorage)
- [ ] ะะฐัะธัะฐ ะพั ะฟะพะฒัะพัะฝัั ะฝะฐัะธัะปะตะฝะธะน ัะฐะฑะพัะฐะตั

### Quality Gates

- [ ] `pnpm type-check` PASS
- [ ] `pnpm lint` PASS
- [ ] `pnpm build` PASS
- [ ] Manual test: ะดะพะฑะฐะฒะธัั ะฟัะพะดัะบั โ ะฒะธะดะตัั +5 XP

### UI Testing

**Mobile (Chrome DevTools โ iPhone SE):**
- [ ] XP bar ะฒะธะดะตะฝ ะธ ะฝะต ะฟะตัะตะบััะฒะฐะตั ะบะพะฝัะตะฝั
- [ ] Toast "+5 XP" ะฟะพัะฒะปัะตััั ะธ ะธััะตะทะฐะตั
- [ ] ะะฝะธะผะฐัะธั ะฟัะพะณัะตัั-ะฑะฐัะฐ ะฟะปะฐะฒะฝะฐั

**Desktop:**
- [ ] XP bar ะฐะดะฐะฟัะธััะตััั ะบ ัะธัะธะฝะต

---

## ๐ค AI Context

### ะะฐััะตัะฝั ะดะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

```javascript
// Storage (Legacy) โ ะธัะฟะพะปัะทัะน ััะพั ะฟะฐััะตัะฝ
const U = HEYS.utils || {};
U.lsSet('heys_game', { totalXP: 100, level: 1, lastUpdate: Date.now() });
const gameData = U.lsGet('heys_game', { totalXP: 0, level: 1 });

// โ๏ธ ะะะะะ: U.lsSet ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะพะฑะฐะฒะปัะตั clientId prefix!
// ะญัะพ ะทะฝะฐัะธั XP data ะพัะดะตะปัะฝะฐั ะดะปั ะบะฐะถะดะพะณะพ ะบะปะธะตะฝัะฐ

// Events โ ะดะปั ะพะฟะพะฒะตัะตะฝะธั UI
window.dispatchEvent(new CustomEvent('heysXPGained', { 
  detail: { amount: 5, reason: 'product_added', newTotal: 105 } 
}));
window.dispatchEvent(new CustomEvent('heysLevelUp', { 
  detail: { newLevel: 8, title: 'ะัะฐะบัะธะบ' } 
}));

// Haptic feedback โ ะฃะะ ะะกะขะฌ ะฒ ะฟัะพะตะบัะต!
if (HEYS.utils && HEYS.utils.haptic) {
  HEYS.utils.haptic('light');   // +5 XP
  HEYS.utils.haptic('success'); // level up
}

// Confetti โ ะฃะะ ะะกะขะฌ, ะฝะพ ะฝัะถะฝะพ ัะตะฝััะฐะปะธะทะพะฒะฐัั
// ะะผะตััะพ ะฟััะผะพะณะพ setShowConfetti โ ะธัะฟะพะปัะทะพะฒะฐัั HEYS.game.celebrate()
```

### ะะตัะตัะตะฝั ะธะท legacy gaming

ะคะฐะนะป `archive/legacy-v12/gaming/heys_gaming_system_v1.js` ัะพะดะตัะถะธั:
- `GAME_CONFIG.XP_MULTIPLIER = 1.2` โ ะผะฝะพะถะธัะตะปั ะพะฟััะฐ
- `ExperienceSystem.calculateLevel(totalXP)` โ ัะฐัััั ััะพะฒะฝั
- `addExperience(amount, reason)` โ ะดะพะฑะฐะฒะปะตะฝะธะต ะพะฟััะฐ

**ะฃะฟัะพััะธัั**: ะะต ะฝัะถะฝั ะฒะฐะปััั (coins, energy), challenges. ะขะพะปัะบะพ XP + ััะพะฒะฝะธ + achievements.

### ะกััะตััะฒัััะธะต ะทะฐะฒะธัะธะผะพััะธ

| ะงัะพ | ะะดะต | ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั |
|-----|-----|------------------|
| `currentStreak` | `heys_day_v12.js:2574` | ะัะถะฝะพ ัะบัะฟะพััะธัะพะฒะฐัั ะฒ `HEYS.Day.getStreak()` |
| `setShowConfetti` | `heys_day_v12.js:1554` | ะัะทัะฒะฐัั ัะตัะตะท event ะธะปะธ prop |
| `haptic()` | `heys_day_utils.js:19` | `HEYS.utils.haptic(type)` |
| `ratioZones.isSuccess()` | `heys_ratio_zones_v1.js:120` | ะัะพะฒะตัะบะฐ ััะฟะตัะฝะพะณะพ ะดะฝั |
| `U.lsSet/lsGet` | `heys_core_v12.js` | Storage ั clientId |

---

## ๐ Notes

- **Priority**: high (retention ะบัะธัะธัะตะฝ)
- **Complexity**: M (~2.5-3 ัะฐัะฐ)
- **Created**: 2025-11-30
- **Audit Version**: 4.0

---

## โจ WOW-ัััะตะบัั ะธ ัะพะฒัะตะผะตะฝะฝัะต ะฟัะฐะบัะธะบะธ

> **ะฆะตะปั**: ะกะดะตะปะฐัั ัะธััะตะผั ะฝะต ะฟัะพััะพ ััะฝะบัะธะพะฝะฐะปัะฝะพะน, ะฐ ะะะะฏะขะะะ ะธ ัะพะฒัะตะผะตะฝะฝะพะน

### ๐จ Micro-animations (ะพะฑัะทะฐัะตะปัะฝะพ)

| ะญะปะตะผะตะฝั | ะะฝะธะผะฐัะธั | ะะตะฐะปะธะทะฐัะธั |
|---------|----------|------------|
| **XP gain** | ะงะธัะปะพ ะฒัะปะตัะฐะตั ะฒะฒะตัั ะธ ะธััะตะทะฐะตั | CSS `@keyframes flyUp { 0% { opacity:1; transform:translateY(0) } 100% { opacity:0; transform:translateY(-20px) } }` |
| **Progress bar** | ะะปะฐะฒะฝะพะต ะทะฐะฟะพะปะฝะตะฝะธะต ั glow | `transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)` + `box-shadow: 0 0 10px currentColor` |
| **Level up** | ะงะธัะปะพ ะฟัะปััะธััะตั 3 ัะฐะทะฐ | `@keyframes pulse { 0%,100% { transform:scale(1) } 50% { transform:scale(1.2) } }` |
| **Milestone confetti** | ะฃะถะต ะตััั ะฒ ะฟัะพะตะบัะต | ะะตัะตะธัะฟะพะปัะทะพะฒะฐัั `setShowConfetti(true)` |
| **Flying star** | ะeะทัะต-ะดัะณะฐ ะพั source ะบ target | `cubic-bezier(0.25, 0.1, 0.25, 1)` + scale down |

### ๐ Sound Effects (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะฝะพ ะฒะฐั)

```javascript
// ะัะพัััะต ะทะฒัะบะธ ัะตัะตะท Web Audio API (ะฑะตะท ัะฐะนะปะพะฒ!)
const audioCtx = new AudioContext();
function playXPSound() {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain).connect(audioCtx.destination);
  osc.frequency.setValueAtTime(880, audioCtx.currentTime); // A5
  osc.frequency.exponentialRampToValueAtTime(1760, audioCtx.currentTime + 0.1); // A6
  gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
  osc.start(); osc.stop(audioCtx.currentTime + 0.2);
}
// ะัะฟะพะปัะทะพะฒะฐะฝะธะต: playXPSound() ะฟัะธ level up
// ะะฐัััะพะนะบะฐ: localStorage 'heys_sounds' = 'on'|'off'
```

### ๐ ะะธะทัะฐะปัะฝัะต ััะพะฒะฝะธ (ัะธััะปั)

| ะฃัะพะฒะฝะธ | ะขะธััะป | ะะบะพะฝะบะฐ | ะฆะฒะตั | CSS Variable |
|--------|-------|--------|------|--------------|
| 1-4 | ะะพะฒะธัะพะบ | ๐ฑ | #94a3b8 (ัะตััะน) | `--level-color` |
| 5-9 | ะฃัะตะฝะธะบ | ๐ | #3b82f6 (ัะธะฝะธะน) | `--level-color` |
| 10-14 | ะัะฐะบัะธะบ | ๐ช | #22c55e (ะทะตะปัะฝัะน) | `--level-color` |
| 15-19 | ะญะบัะฟะตัั | โญ | #eab308 (ะทะพะปะพัะพะน) | `--level-color` |
| 20+ | ะะฐััะตั | ๐ | #a855f7 (ัะธะพะปะตัะพะฒัะน) | `--level-color` |

**UI**: `๐ ะะฐััะตั ยท ะฃั. 23` โ ัะธััะป ะฟะพะบะฐะทัะฒะฐะตััั ะฒ ะฟัะพัะธะปะต
**Bonus**: XP bar ะผะตะฝัะตั ัะฒะตั ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ััะพะฒะฝั!

### ๐ Streak ะฒะธะทัะฐะปะธะทะฐัะธั (ัะถะต ะตััั ะดะฐะฝะฝัะต!)

```
ะขะตะบััะธะน streak: ๐ฅ๐ฅ๐ฅ๐ฅ๐ฅ 5 ะดะฝะตะน
                โฒ
          ัะตะณะพะดะฝั ะฒ ะฝะพัะผะต โ ะพะณะพะฝั ะณะพัะธั!
```

**ะะดะตั**: ะ XP bar ะดะพะฑะฐะฒะธัั ะผะธะฝะธ-ะธะฝะดะธะบะฐัะพั streak ััะดะพะผ ั ััะพะฒะฝะตะผ:
`โญ ะฃั.7 | ๐ฅ5 | โโโโโโโโโโ 450/600`

### ๐ Daily Login Bonus (ะะะะะะะะะฃะฎ!)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ ะะถะตะดะฝะตะฒะฝัะน ะฑะพะฝัั!        โ
โ                              โ
โ  ะะตะฝั 1: +10 XP  โ           โ
โ  ะะตะฝั 2: +15 XP  โ           โ
โ  ะะตะฝั 3: +20 XP  โ ัะตะณะพะดะฝั   โ
โ  ะะตะฝั 4: +25 XP              โ
โ  ะะตะฝั 5: +30 XP              โ
โ  ะะตะฝั 6: +40 XP              โ
โ  ะะตะฝั 7: +50 XP ๐           โ
โ                              โ
โ      [ะะฐะฑัะฐัั +20 XP]        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะตัะฐะฝะธะบะฐ**: 
- ะัะธ ะฟะตัะฒะพะผ ะฒัะพะดะต ะทะฐ ะดะตะฝั โ ะฟะพะบะฐะทะฐัั popup
- ะัะพะณัะตััะธะฒะฝัะน ะฑะพะฝัั: 10โ15โ20โ25โ30โ40โ50 XP
- ะกะฑัะพั ะฟัะธ ะฟัะพะฟััะบะต ะดะฝั (ะฝะพ ะฝะต streak!)
- **Storage**: `heys_login_streak` (ะพัะดะตะปัะฝะพ ะพั ะพัะฝะพะฒะฝะพะณะพ streak)

### โก Combo System (WOW!)

```javascript
// 3+ ะดะตะนััะฒะธั ะทะฐ 60 ัะตะบัะฝะด = COMBO!
let comboCount = 0;
let comboTimer = null;

function triggerCombo() {
  comboCount++;
  clearTimeout(comboTimer);
  comboTimer = setTimeout(() => { comboCount = 0; }, 60000);
  
  if (comboCount >= 3) {
    const multiplier = Math.min(2, 1 + comboCount * 0.1); // x1.3, x1.4, x1.5... max x2
    showComboPopup(`COMBO x${multiplier.toFixed(1)}! ๐ฅ`);
    return multiplier;
  }
  return 1;
}
```

**UI**: ะัะธ combo ะฟะพะบะฐะทะฐัั `โก COMBO x1.5` ะฝะฐะด XP bar

### ๐ก ะัะธัะพะปะพะณะธัะตัะบะธะต ััะธะณะณะตัั

1. **Loss aversion**: "ะะต ะฟะพัะตััะน streak! ะััะฐะปะพัั 3 ัะฐัะฐ ะดะพ ะฟะพะปัะฝะพัะธ" (ะฒ advice)
2. **Progress illusion**: XP bar ะฝะฐัะธะฝะฐะตััั ั 5% ะทะฐะฟะพะปะฝะตะฝะฝะพััะธ (ะฐ ะฝะต ั 0)
3. **Random rewards**: 5% ัะฐะฝั x2 XP ะทะฐ ัะปััะฐะนะฝะพะต ะดะตะนััะฒะธะต ("๐ฒ ะะพะฝัั! +10 XP ะฒะผะตััะพ +5")
4. **Near-miss**: "ะัั 50 XP ะดะพ ััะพะฒะฝั 8!" (ะฟะพะบะฐะทัะฒะฐัั ะบะพะณะดะฐ <10% ะพััะฐะปะพัั)
5. **Endowed progress**: ะะตัะฒัะน ััะพะฒะตะฝั ะดะฐัััั ะฑะตัะฟะปะฐัะฝะพ (ะฝะฐัะธะฝะฐะตะผ ั ะฃั.1, ะฝะต ะฃั.0)

### ๐ Modern UI Touches

| ะญััะตะบั | ะะดะต | ะะฐะบ |
|--------|-----|-----|
| **Glassmorphism** | XP bar background | `backdrop-filter: blur(10px); background: rgba(255,255,255,0.1)` |
| **Gradient shimmer** | Progress bar ะฟัะธ level up | `background: linear-gradient(90deg, ...)` + animation |
| **Particle burst** | ะัะธ achievement | 5-10 ะทะฒัะทะดะพัะตะบ ัะฐะทะปะตัะฐัััั ะธะท ัะตะฝััะฐ |
| **Haptic feedback** | ะัะธ XP gain | `HEYS.utils.haptic('light')` โ ัะถะต ะตััั! |
| **Reduced motion** | ะัะต ะฐะฝะธะผะฐัะธะธ | `@media (prefers-reduced-motion: reduce)` โ ะพัะบะปััะธัั |

---

## ๐ Future Ideas (ะฟะพัะปะต MVP)

| ะะดะตั | ะกะปะพะถะฝะพััั | ะะฐั-ัะฐะบัะพั |
|------|-----------|------------|
| **Combo system** | M | โญโญโญโญ โ 3 ะดะตะนััะฒะธั ะทะฐ ะผะธะฝััั = x1.5 XP |
| **Sound effects** | S | โญโญ โ ะฟัะธััะฝัะต ะทะฒัะบะธ level up |
| **Random x2 rewards** | S | โญโญโญ โ 5% ัะฐะฝั ัะดะฒะพะตะฝะธั |
| **Weekly challenges** | L | โญโญโญ โ ะฟะตััะพะฝะฐะปัะฝัะต ัะตะปะธ |
| **ะกะตะทะพะฝะฝัะต ัะพะฑััะธั** | M | โญโญโญ โ ะะพะฒัะน ะณะพะด: x2 XP ะฝะตะดะตะปั |

---

## ๐ ะะพััะดะพะบ ะฒัะฟะพะปะฝะตะฝะธั

### Phase 0: ะะพะดะณะพัะพะฒะบะฐ ััะฝะดะฐะผะตะฝัะฐ (25 ะผะธะฝ) โ๏ธ ะะะะขะะงะะ!
1. ะัะพะฒะตัะธัั 5 ัะฐะฑะพะฒ ะฝะฐ 320px (DevTools)
2. ะญะบัะฟะพััะธัะพะฒะฐัั `HEYS.Day.getStreak()` ะธะท useMemo
3. ะัะพะฒะตัะธัั `U.lsSet` ั clientId
4. ะะฟัะตะดะตะปะธัั z-index ะธะตัะฐััะธั ะฒ CSS
5. ะฃะฑัะฐัั "ะะฐะฝะตะปั ะบััะฐัะพัะฐ" ะธะท hdr-top
6. Theme toggle โ FAB (fixed, top-right)
7. "ะกะผะตะฝะธัั ะบะปะธะตะฝัะฐ" โ long-press ะฝะฐ ะฐะฒะฐัะฐั (ะธะปะธ ะฒ ะัะพัะธะปั)
8. Analytics button โ ะฒ ะัะพัะธะปั
9. Placeholder ะดะปั XP bar (ะฟัะพะฒะตัะธัั layout)

### Phase 1: Core Module (45 ะผะธะฝ)
10. ะกะพะทะดะฐัั `heys_gamification_v1.js`:
    - `HEYS.game.addXP(amount, reason, sourceEl)`
    - `HEYS.game.getLevel()`, `getProgress()`, `getStats()`
    - `HEYS.game.flyToBar(sourceEl)` โ flying animation
    - `HEYS.game.celebrate()` โ centralized confetti
11. GamificationBar ะบะพะผะฟะพะฝะตะฝั ะฒ hdr-top
12. Daily login bonus popup (onboarding XP)
13. ะะพะดะบะปััะธัั ะฒ `index.html`
14. ะขะตัั ะฒ ะบะพะฝัะพะปะธ: `HEYS.game.addXP(50, 'test')`

### Phase 2: ะะฝัะตะณัะฐัะธั (30 ะผะธะฝ)
15. addXP ะฒ `addProductToMeal()` + flying star
16. addXP ะฒ `addWater()` + flying star
17. addXP ะฒ `confirmTrainingPicker()`
18. addXP ะฟัะธ ะทะฐะฟะพะปะฝะตะฝะธะธ ัะฝะฐ/ะฒะตัะฐ (ะฒ user tab)
19. day_completed check (ะฒะตัะตัะพะผ ะธะปะธ ะฝะฐ ัะปะตะดัััะธะน ะดะตะฝั)

### Phase 3: Achievements (30 ะผะธะฝ)
20. Achievements library (13 ัััะบ ะธะท ัะฐะฑะปะธัั)
21. Achievement popup (modal ั confetti)
22. Streak achievements (ะฐะฒัะพะฟัะพะฒะตัะบะฐ)
23. Level achievements (ะฟัะธ level up)

### Phase 4: Polish & Notifications (25 ะผะธะฝ)
24. Level up notification + confetti (levels % 5)
25. Micro-animations (pulse, glow, flying)
26. Haptic feedback (ะธัะฟะพะปัะทะพะฒะฐัั `HEYS.utils.haptic`)
27. `prefers-reduced-motion` support

### Phase 5: Testing & QA (15 ะผะธะฝ)
28. `pnpm type-check && pnpm lint && pnpm build`
29. Mobile test (iPhone SE ะฒ DevTools)
30. Edge cases: 0 XP, level up boundary, multi-client switch
31. Performance: no layout shifts, smooth animations

**ะะฑัะตะต ะฒัะตะผั**: ~2.5-3 ัะฐัะฐ

---

## โ๏ธ ะะฒะตัะบะธะปะป-ัะตะบะปะธัั (ะะ ะดะตะปะฐัั ะฒ MVP)

> ะญัะธ ัะธัะธ ะฒัะณะปัะดัั ะบัััะพ, ะฝะพ ััะปะพะถะฝัั ัะตะฐะปะธะทะฐัะธั ะฑะตะท ะฟะพะปัะทั ะดะปั MVP:

### โ ะขะพัะฝะพ ะะะข (ัะปะธัะบะพะผ ัะปะพะถะฝะพ):
- **ะะฐะปััั** (coins, gems) โ ัะพะปัะบะพ XP, coins ะผะพะถะฝะพ ะฒ Phase 2+
- **Shop** ั ะฟะพะบัะฟะบะฐะผะธ โ ะฝะต ะฝัะถะตะฝ
- **Leaderboard** โ ััะตะฑัะตั ะฑัะบะตะฝะดะฐ
- **Achievements ั 50 ัะธะฟะฐะผะธ** โ 13 ะดะพััะฐัะพัะฝะพ
- **Avatar customization** โ ัะปะพะถะฝะพ, ะฝะธะทะบะธะน ROI
- **Prestige/Rebirth** โ ัะพะปัะบะพ ะตัะปะธ ะดะพะนะดัะผ ะดะพ max level ะฟัะพะฑะปะตะผั
- **Weekly challenges** โ ััะตะฑัะตั ะผะฝะพะณะพ ะปะพะณะธะบะธ

### โณ ะัะปะพะถะธัั ะฝะฐ Phase 2 (ะฟะพัะปะต ััะฐะฑะธะปะธะทะฐัะธะธ):
- **Sound effects** โ ะฟัะธััะฝะพ, ะฝะพ ะฝะต ะบัะธัะธัะฝะพ
- **Combo system** โ WOW, ะฝะพ ะผะพะถะฝะพ ะฟะพะทะถะต
- **Random rewards (x2 XP)** โ ะผะพะถะฝะพ ะฟะพะทะถะต
- **ะกะตะทะพะฝะฝัะต ัะพะฑััะธั** โ ะฟะพัะปะต product-market fit

### โ ะะบะปััะธัั ะฒ MVP (ะฒััะพะบะธะน impact/effort):
- Daily login bonus (+10-50 XP) โ ะพัะปะธัะฝัะน retention hook
- Flying XP animation โ ะฒะธะทัะฐะปัะฝัะน WOW ั ะผะธะฝะธะผะฐะปัะฝัะผ ะบะพะดะพะผ
- Level up confetti โ ะฟะตัะตะธัะฟะพะปัะทัะตะผ ัััะตััะฒัััะธะน
- ะขะธััะปั ััะพะฒะฝะตะน โ ะฟัะพััะพ lookup table, ะฑะตัะฟะปะฐัะฝัะน wow

---

## ๐ฏ ะัะธัะตัะธะธ ััะฟะตัะฐ MVP

| ะะตััะธะบะฐ | ะฆะตะปั | ะะฐะบ ะฟัะพะฒะตัะธัั |
|---------|------|---------------|
| **XP ัะฐะฑะพัะฐะตั** | 100% | ะะพะฑะฐะฒะธัั ะฟัะพะดัะบั โ XP ัะฒะตะปะธัะธะปัั |
| **Flying animation** | 80% ะฒัะตะผะตะฝะธ | ะะฒะตะทะดะฐ ะปะตัะธั ะบ bar (ะฝะต ะฒัะตะณะดะฐ ะตััั sourceEl) |
| **Level up** | ะะพะบะฐะทัะฒะฐะตั popup | ะะฐะฑัะฐัั 100 XP โ ะฃัะพะฒะตะฝั 2 |
| **Streak ะฒ bar** | ะะพะบะฐะทัะฒะฐะตั ัะธัะปะพ | ๐ฅN ะณะดะต N = currentStreak |
| **Mobile OK** | ะะฐะฑะพัะฐะตั ะฝะฐ 320px | ะัะต ัะปะตะผะตะฝัั ะฒะธะดะฝั |
| **Performance** | <100ms ะฝะฐ ะดะตะนััะฒะธะต | ะะตั ะปะฐะณะพะฒ ะฟัะธ addXP |
| **Persistence** | ะะฐะฝะฝัะต ัะพััะฐะฝะตะฝั | ะะฑะฝะพะฒะธัั ัััะฐะฝะธัั โ XP ะฝะฐ ะผะตััะต |
