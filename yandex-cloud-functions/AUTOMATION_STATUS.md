# ‚úÖ –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

## GitHub Actions ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

**1. API Health Monitor**
([.github/workflows/api-health-monitor.yml](../.github/workflows/api-health-monitor.yml))

```yaml
on:
  schedule:
    - cron: '*/5 6-20 * * *' # –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç, MSK 09:00-23:00
  push:
    paths:
      - 'yandex-cloud-functions/**'
```

‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç API –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è.

**Telegram –∞–ª–µ—Ä—Ç—ã**: ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ secrets (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

### ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

**2. Auto-deploy Cloud Functions**
([.github/workflows/cloud-functions-deploy.yml](../.github/workflows/cloud-functions-deploy.yml))

```yaml
if: github.event_name == 'workflow_dispatch' # –ü–æ–∫–∞ —Ç–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
```

‚ö†Ô∏è **Manual —Ä–µ–∂–∏–º** ‚Äî —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub Secrets:

- `YC_TOKEN`
- `YC_FOLDER_ID`
- `PG_PASSWORD`
- `JWT_SECRET`
- –∏ –¥—Ä.

**–ö–∞–∫ –≤–∫–ª—é—á–∏—Ç—å auto-deploy**:

1. Settings ‚Üí Secrets and variables ‚Üí Actions
2. –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ `.env`
3. –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É `if: github.event_name == 'workflow_dispatch'` –∏–∑ workflow

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç              | –°—Ç–∞—Ç—É—Å           | –†–∞–±–æ—Ç–∞–µ—Ç —Å–∞–º–æ?                |
| ---------------------- | ---------------- | ----------------------------- |
| **health-check.sh**    | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω     | –õ–æ–∫–∞–ª—å–Ω–æ (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫)      |
| **validate-env.sh**    | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç      | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ deploy-all.sh |
| **API Health Monitor** | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω       | ‚úÖ **–î–ê** (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)    |
| **Auto-deploy**        | ‚ö†Ô∏è Manual        | ‚ùå –¢—Ä–µ–±—É–µ—Ç GitHub Secrets     |
| **Telegram –∞–ª–µ—Ä—Ç—ã**    | ‚ö†Ô∏è –ù—É–∂–Ω—ã secrets | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ                   |

---

## üéØ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

GitHub Actions **–£–ñ–ï –∞–∫—Ç–∏–≤–µ–Ω** –∏ –±—É–¥–µ—Ç:

- –ü—Ä–æ–≤–µ—Ä—è—Ç—å API –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (—Å 09:00 –¥–æ 23:00 MSK)
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ `yandex-cloud-functions/`
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å: https://github.com/kinderlystv-png/HEYS-v2/actions

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- ‚úÖ RPC endpoint: 500 ‚Üí **200 OK**
- ‚úÖ REST endpoint: —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Auth endpoint: —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è Health endpoint: 503 (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î)

### ‚úÖ Health check —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
‚úÖ RPC ‚Äî HTTP 200
‚úÖ REST ‚Äî HTTP 200
‚úÖ Auth Login ‚Äî HTTP 401
‚úÖ SMS ‚Äî HTTP 400
‚úÖ Leads ‚Äî HTTP 400
‚ùå Health ‚Äî HTTP 503 (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Å–º. –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –Ω–∏–∂–µ)
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: Health endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 503 –∏–∑-–∑–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
—Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –ø–∞—Ä–æ–ª–µ–º. –≠—Ç–æ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ
endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## üöÄ –î–ª—è –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram –∞–ª–µ—Ä—Ç—ã (5 –º–∏–Ω—É—Ç)

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ –≤ @BotFather ‚Üí –ø–æ–ª—É—á–∏—Ç—å TOKEN
# 2. –î–æ–±–∞–≤–∏—Ç—å –≤ GitHub Secrets:
#    - TELEGRAM_BOT_TOKEN
#    - TELEGRAM_CHAT_ID
```

### –®–∞–≥ 2: –í–∫–ª—é—á–∏—Ç—å auto-deploy (10 –º–∏–Ω—É—Ç)

```bash
# 1. –î–æ–±–∞–≤–∏—Ç—å –≤ GitHub Secrets –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env
# 2. –ò–∑–º–µ–Ω–∏—Ç—å cloud-functions-deploy.yml:
#    - –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É: if: github.event_name == 'workflow_dispatch'
```

---

## üìà –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ push:

**–°–µ–π—á–∞—Å**:

```
git push ‚Üí API Health Monitor –ø—Ä–æ–≤–µ—Ä–∏—Ç —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç ‚Üí
–ü–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ Actions
```

**–° Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**:

```
git push ‚Üí API Health Monitor ‚Üí
–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–µ ‚Üí Telegram –∞–ª–µ—Ä—Ç üö®
```

**–° auto-deploy (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**:

```
git push ‚Üí Auto-deploy ‚Üí –î–µ–ø–ª–æ–π functions ‚Üí
Verifying ‚Üí Success/Fail ‚Üí Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
```

---

## ‚úÖ –ò—Ç–æ–≥–æ:

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (–∞–∫—Ç–∏–≤–Ω–∞ –°–ï–ô–ß–ê–°)**:

- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ push
- ‚úÖ –°—Ç–∞—Ç—É—Å –≤ GitHub Actions

**–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (—Ç—Ä–µ–±—É–µ—Ç secrets)**:

- ‚úÖ –í—Å—ë –≤—ã—à–µ +
- üìß Telegram –∞–ª–µ—Ä—Ç—ã
- üöÄ Auto-deploy –ø—Ä–∏ push
- üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–µ–ø–ª–æ–µ

---

## üé¨ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞)

- GitHub Actions –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç API –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –î–µ–ø–ª–æ–π –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ `./deploy-all.sh`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ `./health-check.sh`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–±–∞–≤–∏—Ç—å Telegram (5 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã)

- –ü–æ–ª—É—á–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ API
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–µ–ø–ª–æ–µ

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (15 –º–∏–Ω—É—Ç)

- Auto-deploy –ø—Ä–∏ push
- Telegram –∞–ª–µ—Ä—Ç—ã
- Zero-touch operations

---

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ù–∞—á–Ω–∏—Ç–µ —Å –í–∞—Ä–∏–∞–Ω—Ç–∞ 1, —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é –æ—Ü–µ–Ω–∏—Ç–µ, –Ω—É–∂–Ω—ã –ª–∏ Telegram
–∞–ª–µ—Ä—Ç—ã.
