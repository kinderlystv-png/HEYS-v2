# üîê –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –¥–ª—è Cloud Functions

## –ü—Ä–æ–±–ª–µ–º–∞

- –ü–∞—Ä–æ–ª–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ —Ä–∞–∑–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤—Ä—É—á–Ω—É—é
- –†–∏—Å–∫ –æ–ø–µ—á–∞—Ç–æ–∫ –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤
- –°–ª–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å, –≥–¥–µ –∫–∞–∫–æ–π –ø–∞—Ä–æ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

## –†–µ—à–µ–Ω–∏–µ

‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π `.env` —Ñ–∞–π–ª** + deployment —Å–∫—Ä–∏–ø—Ç

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ (–û–î–ò–ù –†–ê–ó)

```bash
cd yandex-cloud-functions

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env ‚Äî –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
nano .env
```

### 2. –î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–π

```bash
# üöÄ –î–µ–ø–ª–æ–π –í–°–ï–• —Ñ—É–Ω–∫—Ü–∏–π —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Å–µ–∫—Ä–µ—Ç–∞–º–∏
./deploy-all.sh

# üéØ –î–µ–ø–ª–æ–π –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
./deploy-all.sh heys-api-leads
./deploy-all.sh heys-api-rpc
./deploy-all.sh heys-api-auth
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
yandex-cloud-functions/
‚îú‚îÄ‚îÄ .env                    # ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã (–ù–ï –≤ git!)
‚îú‚îÄ‚îÄ .env.example            # üìù –®–∞–±–ª–æ–Ω –¥–ª—è –∫–æ–º–∞–Ω–¥—ã
‚îú‚îÄ‚îÄ deploy-all.sh           # üöÄ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π deployment
‚îú‚îÄ‚îÄ heys-api-rpc/
‚îú‚îÄ‚îÄ heys-api-rest/
‚îú‚îÄ‚îÄ heys-api-auth/
‚îú‚îÄ‚îÄ heys-api-leads/
‚îú‚îÄ‚îÄ heys-api-sms/
‚îî‚îÄ‚îÄ heys-api-health/
```

---

## üîê –ß—Ç–æ –≤ .env

```bash
# PostgreSQL (–≥–ª–∞–≤–Ω–∞—è –ë–î)
PG_PASSWORD=heys007670

# JWT / Session (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è RPC/Auth)
JWT_SECRET=your_jwt_secret_here
SESSION_SECRET=your_session_secret_here

# Telegram (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
TELEGRAM_BOT_TOKEN=xxx
TELEGRAM_CHAT_ID=xxx

# SMS (sms.ru)
SMS_API_KEY=xxx
```

---

## ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. ‚úÖ `.env` **–£–ñ–ï –í .gitignore** ‚Äî –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ø–∞–¥–µ—Ç –≤ git
2. ‚úÖ –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
3. ‚úÖ –ü–∞—Ä–æ–ª—å –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è –≤ –≤—ã–≤–æ–¥–µ: `heys...7670`
4. ‚ùå **–ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—å** `.env` —Ñ–∞–π–ª
5. ‚ùå **–ù–ï –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å** `.env` —á–µ—Ä–µ–∑ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ secure channels)

---

## üîÑ –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å –ë–î

**–°–¢–ê–†–´–ô –°–ü–û–°–û–ë** (‚ùå –º–Ω–æ–≥–æ —à–∞–≥–æ–≤, risk of errors):

```bash
# 1. Deploy heys-api-rpc —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º
yc serverless function version create --function-name heys-api-rpc --environment PG_PASSWORD=NEW_PASSWORD ...

# 2. Deploy heys-api-rest —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º
yc serverless function version create --function-name heys-api-rest --environment PG_PASSWORD=NEW_PASSWORD ...

# 3. Deploy heys-api-auth... (–∑–∞–±—ã–ª–∏?)
# 4. Deploy heys-api-leads... (–æ–ø–µ—á–∞—Ç–∫–∞ –≤ –ø–∞—Ä–æ–ª–µ?)
```

**–ù–û–í–´–ô –°–ü–û–°–û–ë** (‚úÖ –æ–¥–∏–Ω –∫–æ–º–∞–Ω–¥a):

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ .env
nano .env
# PG_PASSWORD=NEW_PASSWORD

# 2. –î–µ–ø–ª–æ–π –í–°–ï–• —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞–∑–æ–º
./deploy-all.sh

# ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—è: –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–ª—É—á–∞—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø–∞—Ä–æ–ª—å!
```

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–µ–ø–ª–æ–π –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –ë–î

```bash
# 1. –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ .env
echo 'PG_PASSWORD=new_secure_password' >> .env

# 2. –î–µ–ø–ª–æ–π –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –ë–î
./deploy-all.sh heys-api-rpc
./deploy-all.sh heys-api-rest
./deploy-all.sh heys-api-auth
./deploy-all.sh heys-api-leads

# –ò–ª–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:
./deploy-all.sh
```

### –î–µ–ø–ª–æ–π –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Telegram —Ç–æ–∫–µ–Ω–∞

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ .env
nano .env  # TELEGRAM_BOT_TOKEN=new_token

# 2. –î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö Telegram
./deploy-all.sh heys-api-leads
./deploy-all.sh heys-api-auth
```

---

## üìä –ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞–∫–∏–µ —Å–µ–∫—Ä–µ—Ç—ã

| –§—É–Ω–∫—Ü–∏—è         | PG  | JWT/Session | Telegram | SMS |
| --------------- | --- | ----------- | -------- | --- |
| heys-api-rpc    | ‚úÖ  | ‚úÖ          | ‚ùå       | ‚ùå  |
| heys-api-rest   | ‚úÖ  | ‚ùå          | ‚ùå       | ‚ùå  |
| heys-api-auth   | ‚úÖ  | ‚úÖ          | ‚úÖ       | ‚ùå  |
| heys-api-leads  | ‚úÖ  | ‚ùå          | ‚úÖ       | ‚ùå  |
| heys-api-sms    | ‚ùå  | ‚ùå          | ‚ùå       | ‚úÖ  |
| heys-api-health | ‚ùå  | ‚ùå          | ‚ùå       | ‚ùå  |

---

## üîÆ –ë—É–¥—É—â–µ–µ: Yandex Lockbox

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Yandex Lockbox (managed secrets service)

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π –ë–ï–ó redeploy
- ‚úÖ Audit trail –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ Granular access control —á–µ—Ä–µ–∑ IAM
- ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤

üìñ –°–º. [LOCKBOX_MIGRATION_GUIDE.md](LOCKBOX_MIGRATION_GUIDE.md)

---

## üÜò Troubleshooting

### –û—à–∏–±–∫–∞: `.env file not found`

```bash
cp .env.example .env
nano .env  # –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
```

### –û—à–∏–±–∫–∞: `PG_PASSWORD is not set`

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env
cat .env | grep PG_PASSWORD

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# PG_PASSWORD=heys007670
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø–∞—Ä–æ–ª–∏ –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö

```bash
for func in heys-api-rpc heys-api-rest heys-api-auth heys-api-leads; do
  echo "=== $func ==="
  version_id=$(yc serverless function version list --function-name $func --limit 1 --format json | jq -r '.[0].id')
  yc serverless function version get $version_id --format json | jq -r '.environment.PG_PASSWORD'
done
```

---

## ‚úÖ Checklist: –ü–µ—Ä–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `.env.example` ‚Üí `.env`
- [ ] –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `.env` –≤ `.gitignore`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å: `./deploy-all.sh heys-api-health`
- [ ] –ï—Å–ª–∏ OK ‚Äî –¥–µ–ø–ª–æ–π –æ—Å—Ç–∞–ª—å–Ω—ã—Ö: `./deploy-all.sh`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É: —Ñ–æ—Ä–º–∞ –∑–∞—è–≤–∫–∏ –Ω–∞ https://heyslab.ru/#trial

---

**–°–æ–∑–¥–∞–Ω–æ**: 10 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–ê–≤—Ç–æ—Ä**: GitHub Copilot + Anton  
**–¶–µ–ª—å**: –°—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –¥–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Lockbox
