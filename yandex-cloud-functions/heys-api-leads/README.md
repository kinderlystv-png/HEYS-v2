-# HEYS Leads API ‚Äî Yandex Cloud Function

> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏–¥–æ–≤ —Å –ª–µ–Ω–¥–∏–Ω–≥–∞ + Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è + –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –ü—Ä–∏—ë–º –∑–∞—è–≤–æ–∫ —Å –ª–µ–Ω–¥–∏–Ω–≥–∞ (`POST /leads`)
- ‚úÖ **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É** (30-–º–∏–Ω—É—Ç–Ω–æ–µ –æ–∫–Ω–æ)
- ‚úÖ **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞** –∫ —Ñ–æ—Ä–º–∞—Ç—É `+7XXXXXXXXXX`
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ª–∏–¥–æ–≤)
- ‚úÖ 152-–§–ó compliance (–º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ü–î–Ω –≤ Telegram)

## üîß API Endpoint

```
POST https://api.heyslab.ru/leads
```

### Request Body

```json
{
  "name": "–ò–≤–∞–Ω",
  "phone": "79991234567",
  "messenger": "telegram",
  "utm_source": "google",
  "utm_medium": "cpc",
  "utm_campaign": "spring_2026",
  "referrer": "https://google.com",
  "landing_page": "/"
}
```

### Response (—É—Å–ø–µ—Ö)

```json
{
  "success": true,
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "duplicate": false
}
```

–ï—Å–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω (—Ç–æ—Ç –∂–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –º–∏–Ω—É—Ç):

```json
{
  "success": true,
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "duplicate": true
}
```

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (v2.0)

**–î–æ:**

- –ö–∞–∂–¥—ã–π POST —Å–æ–∑–¥–∞–≤–∞–ª –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
- –ù–æ–º–µ—Ä `+79991234567` –æ—Ç–ª–∏—á–∞–ª—Å—è –æ—Ç `79991234567`
- –û–¥–Ω–∞ –∑–∞—è–≤–∫–∞ —Å –ª–µ–Ω–¥–∏–Ω–≥–∞ –º–æ–≥–ª–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ

**–ü–æ—Å–ª–µ:**

- –¢–µ–ª–µ—Ñ–æ–Ω –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –∫ `+7XXXXXXXXXX` —Ñ–æ—Ä–º–∞—Ç—É
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ **30 –º–∏–Ω—É—Ç**
- Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ **—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö** –ª–∏–¥–æ–≤
- –î—É–±–ª–∏–∫–∞—Ç–∞–º –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `id` –ø–µ—Ä–≤–æ–π –∑–∞—è–≤–∫–∏ + —Ñ–ª–∞–≥ `duplicate: true`

### –ü—Ä–∏–º–µ—Ä—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

| –í—Ö–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç       | –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π |
| -------------------- | --------------- |
| `79991234567`        | `+79991234567`  |
| `+7 (999) 123-45-67` | `+79991234567`  |
| `89991234567`        | `+79991234567`  |
| `9991234567`         | `+79991234567`  |

### –û–∫–Ω–æ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `DEDUPLICATION_WINDOW_MINUTES` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30
–º–∏–Ω—É—Ç).

**–°—Ü–µ–Ω–∞—Ä–∏–π:**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞—è–≤–∫—É –≤ 10:00 ‚Üí —Å–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å A
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ª—É—á–∞–π–Ω–æ –Ω–∞–∂–∞–ª –µ—â—ë —Ä–∞–∑ –≤ 10:05 ‚Üí –≤–æ–∑–≤—Ä–∞—â—ë–Ω ID –∑–∞–ø–∏—Å–∏ A
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ–±—Ä–∞—Ç–∏–ª—Å—è –≤ 10:35 ‚Üí —Å–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å B (–æ–∫–Ω–æ
   –∏—Å—Ç–µ–∫–ª–æ)

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ù–æ–≤—ã–π –ª–∏–¥
[Leads] New lead saved: 550e8400-e29b-41d4-a716-446655440000

# –î—É–±–ª–∏–∫–∞—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω
[Leads] Duplicate detected: 550e8400-e29b-41d4-a716-446655440000 within 30 minutes
[Leads] Duplicate lead ignored: 550e8400-e29b-41d4-a716-446655440000

# Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
[Telegram] Notification sent: true
```

## üöÄ –î–µ–ø–ª–æ–π

```bash
cd yandex-cloud-functions/heys-api-leads

# –î–µ–ø–ª–æ–π –≤ Yandex Cloud
yc serverless function version create \
  --function-name heys-api-leads \
  --runtime nodejs18 \
  --entrypoint index.handler \
  --memory 128m \
  --execution-timeout 10s \
  --source-path .
```

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è           | –û–ø–∏—Å–∞–Ω–∏–µ                | –ü—Ä–∏–º–µ—Ä                         |
| -------------------- | ----------------------- | ------------------------------ |
| `PG_HOST`            | PostgreSQL —Ö–æ—Å—Ç         | `rc1b-xxx.mdb.yandexcloud.net` |
| `PG_PORT`            | PostgreSQL –ø–æ—Ä—Ç         | `6432`                         |
| `PG_DATABASE`        | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö         | `heys_production`              |
| `PG_USER`            | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î         | `heys_admin`                   |
| `PG_PASSWORD`        | –ü–∞—Ä–æ–ª—å –ë–î               | `***`                          |
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞     | `1234567890:ABCDEF...`         |
| `TELEGRAM_CHAT_ID`   | ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π | `-1001234567890`               |

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –ø–∞—Ä–æ–ª—è–º–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ YC Console**,
–Ω–µ —á–µ—Ä–µ–∑ CLI (CLI –≤—ã–≤–æ–¥–∏—Ç –∏—Ö –≤ stdout).

## üìù Changelog

### v2.0.0 (2026-02-10)

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É (–æ–∫–Ω–æ 30 –º–∏–Ω—É—Ç)
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫ —Ñ–æ—Ä–º–∞—Ç—É `+7XXXXXXXXXX`
- ‚úÖ –§–ª–∞–≥ `duplicate` –≤ response
- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ª–∏–¥–æ–≤

### v1.0.0 (2025-12-20)

- ‚úÖ –ù–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏–¥–æ–≤ –≤ PostgreSQL
- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ UTM tracking
