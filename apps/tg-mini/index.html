<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#2B5278" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>HEYS Curator Panel v2</title>
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Telegram WebApp styles -->
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background-color: var(--tg-theme-bg-color, #ffffff);
        color: var(--tg-theme-text-color, #000000);
        padding: 16px;
        min-height: 100vh;
      }
      
      .container {
        max-width: 600px;
        margin: 0 auto;
      }
      
      h1 {
        color: var(--tg-theme-text-color, #000000);
        margin-bottom: 24px;
        font-size: 24px;
      }
      
      .status {
        background: var(--tg-theme-secondary-bg-color, #f0f0f0);
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 16px;
      }
      
      .status-item {
        margin: 8px 0;
        font-size: 14px;
      }
      
      .label {
        font-weight: 600;
        color: var(--tg-theme-hint-color, #999999);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üçè HEYS mini‚Äëapp —Ä–∞–±–æ—Ç–∞–µ—Ç</h1>
      
      <div class="status">
        <div class="status-item">
          <span class="label">–í–µ—Ä—Å–∏—è:</span> v2.0 (no-cache)
        </div>
        <div class="status-item">
          <span class="label">–°—Ç–∞—Ç—É—Å:</span> Cache-busting –∞–∫—Ç–∏–≤–µ–Ω ‚úÖ
        </div>
        <div class="status-item">
          <span class="label">Entry‚Äëpoint:</span> apps/tg-mini/
        </div>
        <div class="status-item">
          <span class="label">Timestamp:</span> <span id="timestamp"></span>
        </div>
      </div>
      
      <script>
        document.getElementById('timestamp').textContent = new Date().toLocaleTimeString('ru-RU');
        
        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º Service Worker –¢–û–õ–¨–ö–û –≤ production –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫—ç—à–∞
        // –í dev –æ–Ω –º–µ—à–∞–µ—Ç HMR –∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥—É–ª–µ–π Vite
        if ('serviceWorker' in navigator && location.hostname !== 'localhost') {
          navigator.serviceWorker.register('/sw.js')
            .then(reg => console.log('[SW] Registered:', reg.scope))
            .catch(err => console.error('[SW] Registration failed:', err));
        } else if ('serviceWorker' in navigator) {
          // –í dev —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π SW –µ—Å–ª–∏ –æ–Ω –±—ã–ª
          navigator.serviceWorker.getRegistrations().then(registrations => {
            registrations.forEach(reg => {
              console.log('[SW] Unregistering old worker:', reg.scope);
              reg.unregister();
            });
          });
        }
      </script>
      
      <div id="root"></div>
    </div>

    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
