/* === Emoji styles === */
/* Twemoji loaded via JS when 'twemoji' style is selected */

:root {
  --bg: #ffffff;
  --card: #ffffff;
  --text: #111827;
  --muted: #6b7280;
  --border: #e5e7eb;
  --acc: #2563eb;
  --acc-contrast: #ffffff;
  
  /* Emoji style: 'android' | 'apple' | 'system' */
  --emoji-style: 'android';
  
  /* Stats block (голубой) */
  --stats-bg: #f0f9ff;
  --stats-border: #bae6fd;
  
  /* Activity block (жёлтый) */
  --activity-bg: #fffef5;
  --activity-border: #f5e6a3;
  
  /* Sleep/Day block (суперсветло-розовый) */
  --sleep-bg: #fef7f9;
  --sleep-border: #fce7f3;
  
  /* Progress colors */
  --success: #22c55e;
  --success-dark: #16a34a;
  --warning: #f59e0b;
  --danger: #ef4444;
  --info: #0ea5e9;
  
  /* Macro rings */
  --protein: #ef4444;
  --fat: #f59e0b;
  --carbs: #22c55e;
}

/* === MODERN POLISH === */

html {
  scroll-behavior: smooth;
}

@media (prefers-reduced-motion: reduce) {
  html {
    scroll-behavior: auto;
  }
}

/* Focus states для accessibility */
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
.btn:focus-visible {
  outline: 2px solid var(--acc);
  outline-offset: 2px;
}

/* Брендированный selection */
::selection {
  background: var(--acc);
  color: white;
}

html,
body {
  overscroll-behavior-y: none;
  -webkit-tap-highlight-color: transparent;
}

/* === common.css === */
body {
  margin: 0;
  font-family:
    ui-sans-serif,
    system-ui,
    -apple-system,
    Segoe UI,
    Roboto,
    Helvetica,
    Arial,
    'Noto Color Emoji';
  background: var(--bg);
  color: var(--text);
  font-size: 13px;
  line-height: 1.35;
}

/* Emoji font override - Android style */
.emoji, [data-emoji] {
  font-family: 'Noto Color Emoji', sans-serif;
}

/* Emoji style switcher classes */

/* Twemoji (Twitter emoji = Android-like) */
body.emoji-twemoji img.emoji {
  height: 1.2em;
  width: 1.2em;
  margin: 0 0.05em 0 0.1em;
  vertical-align: -0.2em;
  display: inline;
}

/* System default - use whatever OS provides (Windows = Segoe, Mac = Apple) */
body.emoji-system {
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}

.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px;
  box-sizing: border-box;
}
.btn {
  min-height: 44px;
  padding: 10px 16px;
  border: 1px solid var(--border);
  border-radius: 10px;
  cursor: pointer;
  font-size: 14px;
  touch-action: manipulation;
  user-select: none;
}
.btn.acc {
  background: var(--acc);
  color: var(--acc-contrast);
  border-color: var(--acc);
  font-weight: 600;
}
.btn.ghost {
  background: transparent;
}
.btn:active {
  transform: scale(0.98);
  opacity: 0.8;
}
.tab:active {
  transform: scale(0.98);
}
input:active,
textarea:active,
select:active {
  border-color: var(--acc);
}
.card.clickable:active {
  transform: scale(0.99);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.section-title {
  font-weight: 600;
  margin-bottom: 6px;
}
label {
  display: block;
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 4px;
}
input,
textarea,
select {
  width: 100%;
  background: #fff;
  border: 1px solid var(--border);
  color: var(--text);
  min-height: 44px;
  padding: 10px 12px;
  border-radius: 10px;
  outline: none;
  font-size: 16px;
  touch-action: manipulation;
}
input:focus,
textarea:focus,
select:focus {
  border-color: #cbd5e1;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.12);
}
textarea {
  min-height: 90px;
  resize: vertical;
}
.row {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
}
.muted {
  color: var(--muted);
  font-size: 12px;
}
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 12.5px;
}
th,
td {
  padding: 6px 8px;
  border-bottom: 1px solid var(--border);
  text-align: left;
  white-space: nowrap;
  border-right: 1px solid rgba(0, 0, 0, 0.06);
}
th:last-child,
td:last-child {
  border-right: none;
}
td input {
  width: 100%;
  min-width: 80px;
  padding: 5px 6px;
  font-size: 12.5px;
  text-align: center;
}
td:first-child input {
  min-width: 220px;
  text-align: left;
}
.readOnly {
  opacity: 0.9;
  background: #f8fafc;
}

/* Column width adjustments per request: cols 2-4 = 1.5cm, first column minimal */
.tbl th:first-child,
.tbl td:first-child {
  width: 1%;
}
.tbl th:nth-child(2),
.tbl th:nth-child(3),
.tbl th:nth-child(4),
.tbl td:nth-child(2),
.tbl td:nth-child(3),
.tbl td:nth-child(4) {
  width: 1.5cm;
}

/* === day-stats.css === */
.card.tone-violet.main-violet {
  --tb-b: #dad5ff;
  --tb-cell-h: 32px;
  position: relative;
  background: #f3f1ff;
  border: 1px solid #e6e1ff;
  border-radius: 12px;
  padding: 0;
  overflow: hidden;
}
.card.tone-violet.main-violet .main-stats-grid {
  display: flex;
  flex-direction: column;
  gap: 0;
  margin: 14px 0 0;
  border-top: 1px solid var(--tb-b);
  border-left: 1px solid var(--tb-b);
}
.card.tone-violet.main-violet .stat {
  display: grid;
  grid-template-columns: 1fr 100px;
  align-items: center;
  min-height: var(--tb-cell-h);
  border-right: 1px solid var(--tb-b);
  border-bottom: 1px solid var(--tb-b);
  background: rgba(255, 255, 255, 0.35);
}
.card.tone-violet.main-violet .stat > label {
  padding: 6px 10px;
  margin: 0;
  font-size: 14px;
  color: #374151;
}
.card.tone-violet.main-violet .stat > input,
.card.tone-violet.main-violet .stat > select {
  justify-self: center;
  width: 90px;
  height: 26px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  background: #fff;
  padding: 3px 6px;
  font-size: 12px;
}
.card.tone-violet.main-violet .stat::after {
  content: '';
  justify-self: center;
  color: #6b7280;
  font-size: 12px;
}
.card.tone-violet.main-violet .stat:nth-of-type(3)::after {
  content: 'вес на утро';
}
.card.tone-violet.main-violet .stat:nth-of-type(4)::after {
  content: 'шагов';
}
.card.tone-violet.main-violet .stat:nth-of-type(6)::after {
  content: 'мин';
}
.card.tone-violet.main-violet .stat:nth-of-type(8)::after {
  content: 'дефицит';
}
.card.tone-violet.main-violet .pill {
  margin: 4px 0 8px 10px;
}
.card.tone-violet.main-violet .delta.good {
  color: #16a34a;
}
.card.tone-violet.main-violet .delta.bad {
  color: #dc2626;
}
.card.tone-violet.main-violet .violet-table {
  border-collapse: collapse;
  table-layout: fixed;
}
.card.tone-violet.main-violet {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}
.card.tone-violet.main-violet .violet-table th,
.card.tone-violet.main-violet .violet-table td {
  border: 1px solid #ddd6fe;
  padding: 4px 6px;
  height: 26px;
  font-size: 12px;
}
.card.tone-violet.main-violet .violet-table thead th {
  background: #f0ecff;
  color: #4b5563;
  text-align: center;
  font-size: 12px;
}
.card.tone-violet.main-violet .violet-table thead th:first-child {
  background: transparent;
  border-top-color: transparent;
}
.card.tone-violet.main-violet .violet-table td:first-child {
  font-size: 14px;
  font-weight: 600;
  color: #1f2937;
  text-align: right;
  padding-right: 20px;
}
.card.tone-violet.main-violet .violet-table td:nth-child(2),
.card.tone-violet.main-violet .violet-table td:nth-child(3) {
  text-align: center;
}
/* 4-й столбец (последний) выравниваем влево с отступом */
.card.tone-violet.main-violet .violet-table td:last-child {
  text-align: left;
  padding-left: 8px;
  color: #374151;
  font-size: 13px;
}
.card.tone-violet.main-violet .violet-table input {
  width: 50px;
  max-width: 50px;
  height: 25px;
  border: 1px solid #c4c6d8;
  border-radius: 5px;
  padding: 1px 4px;
  text-align: center;
  background: #fff;
  font-size: 11px;
}
.card.tone-violet.main-violet .violet-table input.readOnly {
  background: #fff;
}
.card.tone-violet.main-violet .violet-table .delta {
  display: inline-block;
  min-width: 58px;
  padding: 3px 6px;
  border-radius: 5px;
  font-weight: 700;
  text-align: center;
  background: #eef2ff;
  font-size: 11px;
}
.card.tone-violet.main-violet .violet-table .delta.good {
  color: #059669;
  background: #e7f8ef;
}
.card.tone-violet.main-violet .violet-table .delta.bad {
  color: #dc2626;
  background: #fee2e2;
}
/* Emphasis rows */
.card.tone-violet.main-violet .violet-table tr.vio-row.total-kcal td:first-child,
.card.tone-violet.main-violet .violet-table tr.vio-row.need-kcal td:first-child,
.card.tone-violet.main-violet .violet-table tr.vio-row.eaten-kcal td:first-child {
  font-size: 14px;
  font-weight: 700;
}
.card.tone-violet.main-violet .violet-table tr.vio-row.total-kcal input,
.card.tone-violet.main-violet .violet-table tr.vio-row.need-kcal input,
.card.tone-violet.main-violet .violet-table tr.vio-row.eaten-kcal input {
  font-size: 12px;
  font-weight: 600;
  height: 25px;
}

/* === side-blocks.css === */
.side-row {
  display: flex;
  flex-direction: row;
  gap: 8px;
  margin-bottom: 8px;
}
.side-col {
  flex: 1 1 0;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 0;
}

/* === COMPACT CARDS (SaaS style) === */
.compact-card {
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  padding: 14px 16px;
  margin-bottom: 10px;
  width: 100%;
  box-sizing: border-box;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  transition: all 0.2s ease;
}

.compact-card:active {
  transform: scale(0.99);
}

/* Отключаем scale для карточки статистики — мешает позиционированию popup'ов */
.compact-stats.compact-card:active,
.compact-water.compact-card:active {
  transform: none;
}

.compact-card-header {
  font-size: 13px;
  font-weight: 600;
  color: #374151;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* Header с badge статуса справа */
.compact-card-header.stats-header-with-badge {
  justify-content: space-between;
}

.ratio-status-badge {
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.3px;
  animation: badgeFadeIn 0.4s ease-out;
}

.ratio-status-badge.perfect {
  animation: badgeFadeIn 0.4s ease-out, perfectPulse 2s ease-in-out infinite;
}

@keyframes badgeFadeIn {
  from { opacity: 0; transform: translateX(10px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes perfectPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; transform: scale(1.05); }
}

.compact-row {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 8px;
}

.compact-row:last-child {
  margin-bottom: 0;
}

.compact-label {
  font-size: 13px;
  color: #6b7280;
  font-weight: 500;
}

.compact-input {
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 8px 12px;
  font-size: 14px;
  transition: all 0.2s ease;
  background: #f9fafb;
}

.compact-input:focus {
  outline: none;
  border-color: #6366f1;
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
  background: #fff;
}

.compact-input.time {
  width: 90px;
  text-align: center;
  font-weight: 500;
}

.compact-input.tiny {
  width: 50px;
  text-align: center;
  font-weight: 500;
}

.compact-badge {
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: white;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
  min-width: 45px;
  text-align: center;
  box-shadow: 0 2px 4px rgba(99, 102, 241, 0.25);
}

.compact-stat {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 6px 10px;
  background: #f3f4f6;
  border-radius: 10px;
  font-size: 13px;
  color: #374151;
  font-weight: 500;
}

.compact-stat span {
  font-weight: 600;
  color: #334155;
}

.compact-note {
  width: 100%;
  margin-top: 10px;
  border: 1px solid #e5e7eb;
  border-radius: 10px;
  padding: 10px 12px;
  font-size: 14px;
  background: #f9fafb;
  transition: all 0.2s ease;
}

.compact-note:focus {
  outline: none;
  border-color: #6366f1;
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
  background: #fff;
}

.compact-note::placeholder {
  color: #9ca3af;
}

/* === COMPACT TRAININGS === */
.compact-trainings {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* Пустое состояние тренировок */
.empty-trainings {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 12px 16px;
  color: #94a3b8;
  font-size: 13px;
}

.empty-trainings-icon {
  font-size: 18px;
}

.empty-trainings-text {
  font-weight: 500;
}

.compact-train {
  padding: 10px 14px !important;
  animation: slideIn 0.25s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.compact-train-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  font-weight: 600;
  color: #334155;
  margin-bottom: 8px;
}

.compact-train-icon {
  font-size: 16px;
}

.compact-badge.train {
  margin-left: auto;
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  font-size: 11px;
  padding: 3px 8px;
}

.compact-train-zones {
  display: flex;
  gap: 6px;
  width: 100%;
}

.compact-zone {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
  gap: 2px;
}

.compact-zone-label {
  font-size: 10px;
  font-weight: 600;
  color: #94a3b8;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

/* Ккал под значением зоны */
.compact-zone-kcal {
  font-size: 9px;
  color: #f97316;
  font-weight: 500;
  margin-top: 2px;
}

/* Кнопка удаления тренировки */
.compact-train-remove {
  margin-left: auto;
  width: 20px;
  height: 20px;
  border: none;
  background: #fee2e2;
  color: #dc2626;
  border-radius: 50%;
  font-size: 14px;
  line-height: 1;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s ease;
}

.compact-train-remove:hover {
  background: #fecaca;
  transform: scale(1.1);
}

/* Кнопка добавления тренировки */
.compact-train-add {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  border: 1px dashed #cbd5e1;
  background: transparent;
  color: #64748b;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s ease;
}

.compact-train-add:hover {
  border-color: #667eea;
  color: #667eea;
  background: #f8fafc;
}

/* === TABS WITH ICONS === */
.tab {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}

.tab-icon {
  font-size: 18px;
  line-height: 1;
}

.tab-text {
  font-size: 11px;
  white-space: nowrap;
}

@media (max-width: 500px) {
  .tab-text {
    display: none;
  }
  .tab-icon {
    font-size: 22px;
  }
  .tab {
    padding: 10px 12px;
  }
}

/* === COMPACT BACKUP INFO === */
.hdr-backup-info.compact {
  padding: 4px 8px;
  font-size: 11px;
  gap: 4px;
}

.hdr-backup-time {
  color: #64748b;
}

/* === calendar.css === */
/* .area-cal placeholder removed (no styles needed yet) */
.cal-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
}
/* Добавьте сюда остальные стили календаря по мере необходимости */

/* === restored base layout & navigation === */
.wrap {
  max-width: 1600px;
  margin: 0 auto;
  padding: 12px 18px 80px;
  box-sizing: border-box;
  /* Отступ сверху для fixed шапки */
  padding-top: 110px;
  /* Плавное появление после загрузки */
  animation: wrapFadeIn 0.4s ease-out;
}

@keyframes wrapFadeIn {
  from { 
    opacity: 0;
    transform: translateY(8px);
  }
  to { 
    opacity: 1;
    transform: translateY(0);
  }
}

/* === MODERN HEADER === */
.hdr {
  display: flex;
  flex-direction: column;
  gap: 0;
  box-sizing: border-box;
  
  /* Fixed header — всегда виден при прокрутке */
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  background: var(--bg-primary, #f8f9fa);
  
  /* Padding как у карточек */
  padding: 12px 18px 0;
  max-width: 100%;
}

/* Верхняя линия: Gamification */
.hdr-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 16px 16px 0 0;
  border: 1px solid #667eea;
  border-bottom: none;
  color: white;
}

.hdr-logo {
  display: flex;
  align-items: center;
  gap: 12px;
}

.hdr-logo-icon {
  width: 40px;
  height: 40px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.hdr-logo-text {
  font-size: 20px;
  font-weight: 700;
  letter-spacing: -0.5px;
}

.hdr-logo-sub {
  font-size: 12px;
  opacity: 0.8;
  font-weight: 400;
}

.hdr-status {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* Кнопка смены клиента в верхней панели */
.hdr-switch-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 8px;
  color: white;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  backdrop-filter: blur(4px);
}

.hdr-switch-btn:hover {
  background: rgba(255, 255, 255, 0.25);
  border-color: rgba(255, 255, 255, 0.4);
  transform: translateY(-1px);
}

.hdr-switch-btn:active {
  transform: translateY(0);
}

/* Кнопка темы в шапке */
.hdr-theme-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  background: rgba(255, 255, 255, 0.95);
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  flex-shrink: 0;
}

.hdr-theme-btn:hover {
  background: #fff;
  border-color: rgba(0, 0, 0, 0.25);
  transform: translateY(-1px);
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
}

.hdr-theme-btn:active {
  transform: translateY(0);
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
}

/* Dark mode */
[data-theme="dark"] .hdr-theme-btn {
  background: rgba(50, 50, 60, 0.95);
  border-color: rgba(255, 255, 255, 0.2);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .hdr-theme-btn:hover {
  background: rgba(60, 60, 70, 1);
  border-color: rgba(255, 255, 255, 0.35);
}

/* === Theme FAB (Phase 0 Gamification) === */
.theme-fab {
  position: fixed;
  top: 12px;
  right: 12px;
  z-index: 1000;
  width: 40px;
  height: 40px;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  backdrop-filter: blur(10px);
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.theme-fab:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.theme-fab:active {
  transform: scale(0.95);
}

/* Dark theme FAB */
:root[data-theme="dark"] .theme-fab,
[data-theme="dark"] .theme-fab {
  background: rgba(30, 30, 30, 0.9);
  border-color: rgba(255, 255, 255, 0.1);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

/* === Gamification Bar (Phase 1 Live) === */
.hdr-gamification {
  padding: 10px 16px;
  position: relative;
}

.game-bar-container {
  position: relative;
  width: 100%;
}

.game-bar {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 10px;
  width: 100%;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

/* Legacy row layout — kept for compatibility */
.game-row {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
}

.game-row-main {
  gap: 10px;
}

.game-row-stats {
  gap: 6px;
  font-size: 11px;
  opacity: 0.9;
  flex-wrap: wrap;
}

/* Level group — горизонтальный компактный */
.game-level-group {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 4px;
  flex-shrink: 0;
  position: relative;
}

.game-level-text {
  font-weight: 600;
  font-size: 13px;
  white-space: nowrap;
  line-height: 1.1;
}

/* Inline indicators — компактные значки в строке */

.game-level {
  font-weight: 600;
  font-size: 14px;
  white-space: nowrap;
  transition: color 0.3s ease;
}

.game-progress {
  flex: 1;
  height: 8px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
  overflow: hidden;
  min-width: 60px;
  position: relative;
}

.game-progress.glowing {
  box-shadow: 0 0 12px rgba(255, 215, 0, 0.6);
}

/* Shimmer при >80% */
.game-progress.shimmer .game-progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent 0%,
    rgba(255, 255, 255, 0.4) 50%,
    transparent 100%
  );
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% { left: -100%; }
  100% { left: 200%; }
}

/* Pulse при >90% (приближение к level-up) */
.game-progress.pulse .game-progress-fill {
  animation: progressPulse 1.5s ease-in-out infinite;
}

@keyframes progressPulse {
  0%, 100% { 
    box-shadow: 0 0 4px rgba(255, 215, 0, 0.4);
    filter: brightness(1);
  }
  50% { 
    box-shadow: 0 0 16px rgba(255, 215, 0, 0.8);
    filter: brightness(1.2);
  }
}

.game-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #10b981 0%, #22c55e 100%);
  border-radius: 4px;
  transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
  position: relative;
  overflow: hidden;
}

.game-xp {
  font-size: 12px;
  opacity: 0.9;
  white-space: nowrap;
  transition: transform 0.3s ease, color 0.3s ease;
  position: relative;
}

/* XP counting animation */
.game-xp.counting {
  animation: xpPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  color: #fbbf24;
}

@keyframes xpPop {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}

/* Level up rainbow flash */
.game-bar-container.level-up-flash {
  animation: rainbowFlash 1s ease-out;
}

@keyframes rainbowFlash {
  0% { 
    background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcb77, #4d96ff, #9b59b6);
    background-size: 400% 100%;
  }
  50% { 
    background-position: 100% 0;
  }
  100% { 
    background: transparent;
  }
}

/* Ripple effect on progress bar tap */
.game-progress {
  position: relative;
  overflow: hidden;
}

.game-progress .ripple {
  position: absolute;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.5);
  transform: scale(0);
  animation: rippleEffect 0.6s ease-out;
  pointer-events: none;
}

@keyframes rippleEffect {
  to {
    transform: scale(4);
    opacity: 0;
  }
}

/* Progress bar tooltip */
.game-progress-tooltip {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: rgba(15, 23, 42, 0.95);
  color: white;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 11px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
  z-index: 100;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.game-progress-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 5px solid transparent;
  border-top-color: rgba(15, 23, 42, 0.95);
}

.game-progress:hover .game-progress-tooltip,
.game-progress:active .game-progress-tooltip {
  opacity: 1;
}

.game-streak {
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  display: inline-flex;
  align-items: center;
  gap: 1px;
}

/* Streak уровни анимации */
.game-streak.streak-low {
  animation: none;
}

.game-streak.streak-mid {
  animation: flicker 1.5s ease-in-out infinite;
}

.game-streak.streak-high {
  animation: flicker 1s ease-in-out infinite;
  filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.6));
}

.game-streak.streak-epic {
  animation: flicker 0.8s ease-in-out infinite, goldGlow 2s ease-in-out infinite;
  filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.8));
}

.game-streak.streak-legendary {
  animation: flicker 0.6s ease-in-out infinite, rainbowGlow 3s linear infinite;
  filter: drop-shadow(0 0 10px rgba(255, 100, 100, 0.8));
}

@keyframes flicker {
  0%, 100% { transform: scale(1); opacity: 1; }
  25% { transform: scale(1.05); opacity: 0.9; }
  50% { transform: scale(1.1); opacity: 1; }
  75% { transform: scale(1.03); opacity: 0.95; }
}

@keyframes goldGlow {
  0%, 100% { filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6)); }
  50% { filter: drop-shadow(0 0 16px rgba(255, 215, 0, 1)); }
}

@keyframes rainbowGlow {
  0% { filter: drop-shadow(0 0 10px #ff6b6b); }
  25% { filter: drop-shadow(0 0 10px #ffd93d); }
  50% { filter: drop-shadow(0 0 10px #6bcb77); }
  75% { filter: drop-shadow(0 0 10px #4d96ff); }
  100% { filter: drop-shadow(0 0 10px #ff6b6b); }
}

.game-streak:hover {
  animation: bounce 0.5s ease;
}

@keyframes bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.15); }
}

/* === Rank Badge === */
.game-rank-badge {
  font-size: 9px;
  padding: 1px 5px;
  border-radius: 8px;
  font-weight: 600;
  animation: badgeShine 3s ease-in-out infinite;
  text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  align-self: flex-start;
}

@keyframes badgeShine {
  0%, 100% { filter: brightness(1); }
  50% { filter: brightness(1.2); }
}

/* === XP Multiplier Badge === */
.game-multiplier {
  font-size: 10px;
  font-weight: 700;
  color: #fbbf24;
  background: rgba(251, 191, 36, 0.2);
  padding: 2px 5px;
  border-radius: 6px;
  animation: multiplierPulse 1.5s ease-in-out infinite;
}

@keyframes multiplierPulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.1); opacity: 0.9; }
}

/* === Daily Bonus Button === */
.game-daily-bonus {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  border: none;
  border-radius: 6px;
  color: white;
  font-size: 12px;
  font-weight: 600;
  padding: 2px 6px;
  cursor: pointer;
  animation: bonusGlow 2s ease-in-out infinite;
  white-space: nowrap;
}

.game-daily-bonus:hover {
  transform: scale(1.05);
}

.game-daily-bonus.claimed {
  background: rgba(255, 255, 255, 0.1);
  animation: none;
  opacity: 0.5;
  cursor: default;
}

@keyframes bonusGlow {
  0%, 100% { box-shadow: 0 0 6px rgba(245, 158, 11, 0.4); }
  50% { box-shadow: 0 0 12px rgba(245, 158, 11, 0.8); }
}

/* === Level Preview Tooltip === */
.game-level-group {
  position: relative;
  cursor: help;
}

.game-level-preview {
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  transform: none;
  background: rgba(15, 23, 42, 0.95);
  color: white;
  padding: 8px 12px;
  border-radius: 8px;
  font-size: 11px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
  z-index: 100;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  text-align: left;
}

/* Level Roadmap — карта всех званий */
.game-level-roadmap {
  position: absolute;
  top: calc(100% + 10px);
  left: 0;
  background: linear-gradient(180deg, rgba(20, 30, 50, 0.99) 0%, rgba(15, 23, 42, 0.99) 100%);
  color: white;
  padding: 14px 16px;
  border-radius: 14px;
  font-size: 12px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease, transform 0.25s ease;
  transform: translateY(-6px);
  z-index: 100;
  box-shadow: 
    0 10px 30px rgba(0, 0, 0, 0.5),
    0 0 0 1px rgba(255, 255, 255, 0.08),
    inset 0 1px 0 rgba(255, 255, 255, 0.05);
  min-width: 200px;
  max-height: 320px;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
}

.game-level-roadmap::-webkit-scrollbar {
  width: 4px;
}

.game-level-roadmap::-webkit-scrollbar-track {
  background: transparent;
}

.game-level-roadmap::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 2px;
}

.game-level-roadmap::before {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 18px;
  border: 8px solid transparent;
  border-bottom-color: rgba(20, 30, 50, 0.99);
  filter: drop-shadow(0 -2px 2px rgba(0, 0, 0, 0.1));
}

.game-level-group:hover .game-level-roadmap {
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
}

.roadmap-title {
  font-weight: 600;
  font-size: 13px;
  margin-bottom: 10px;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  text-align: center;
}

.roadmap-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 0;
  opacity: 0.5;
  transition: opacity 0.2s, transform 0.2s;
}

.roadmap-item.achieved {
  opacity: 0.4;
}

.roadmap-item.current {
  opacity: 1;
  background: rgba(255, 215, 0, 0.15);
  margin: 0 -10px;
  padding: 8px 10px;
  border-radius: 8px;
}

.roadmap-item.future {
  opacity: 0.6;
}

.roadmap-icon {
  font-size: 16px;
  width: 24px;
  text-align: center;
}

.roadmap-name {
  flex: 1;
  font-weight: 500;
}

.roadmap-levels {
  font-size: 10px;
  font-weight: 600;
}

.roadmap-you {
  font-size: 10px;
  color: #fbbf24;
  font-weight: 600;
  animation: youPulse 1.5s ease-in-out infinite;
}

@keyframes youPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.roadmap-check {
  color: #22c55e;
  font-size: 12px;
}

.game-level-preview::after {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 16px;
  transform: none;
  border: 5px solid transparent;
  border-bottom-color: rgba(15, 23, 42, 0.95);
}

/* === Floating XP Text === */
@keyframes floatUp {
  0% {
    opacity: 1;
    transform: translateX(-50%) translateY(0) scale(1);
  }
  50% {
    opacity: 1;
    transform: translateX(-50%) translateY(-30px) scale(1.2);
  }
  100% {
    opacity: 0;
    transform: translateX(-50%) translateY(-60px) scale(0.8);
  }
}

.floating-xp-text {
  font-family: system-ui, -apple-system, sans-serif;
}

.floating-xp-text.combo {
  animation: floatUpCombo 1.5s ease-out forwards;
}

.floating-xp-text .combo-text {
  display: block;
  font-size: 12px;
  color: #ef4444;
  animation: comboPop 0.3s ease-out;
}

@keyframes floatUpCombo {
  0% {
    opacity: 1;
    transform: translateX(-50%) translateY(0) scale(1) rotate(0deg);
  }
  25% {
    transform: translateX(-50%) translateY(-20px) scale(1.4) rotate(-5deg);
  }
  50% {
    opacity: 1;
    transform: translateX(-50%) translateY(-40px) scale(1.2) rotate(5deg);
  }
  100% {
    opacity: 0;
    transform: translateX(-50%) translateY(-80px) scale(0.8) rotate(0deg);
  }
}

@keyframes comboPop {
  0% { transform: scale(0); }
  50% { transform: scale(1.5); }
  100% { transform: scale(1); }
}

/* === Daily Action Multiplier === */
.game-daily-mult {
  display: flex;
  align-items: center;
  gap: 3px;
  font-size: 11px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.7);
  padding: 2px 6px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  transition: all 0.3s ease;
}

.game-daily-mult.active {
  color: #fbbf24;
  background: rgba(251, 191, 36, 0.2);
  animation: dailyMultPulse 2s ease-in-out infinite;
}

.game-daily-mult.high {
  color: #f97316;
  background: linear-gradient(135deg, rgba(249, 115, 22, 0.3) 0%, rgba(234, 88, 12, 0.3) 100%);
  animation: dailyMultGlow 1.5s ease-in-out infinite;
  text-shadow: 0 0 8px rgba(249, 115, 22, 0.5);
}

.game-daily-mult-value {
  font-size: 10px;
  font-weight: 700;
  color: inherit;
  opacity: 0.9;
}

@keyframes dailyMultPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes dailyMultGlow {
  0%, 100% { box-shadow: 0 0 6px rgba(249, 115, 22, 0.3); }
  50% { box-shadow: 0 0 12px rgba(249, 115, 22, 0.6); }
}

/* === Weekly Challenge Card (в expanded панели) === */
.game-weekly-card {
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%);
  border: 1px solid rgba(99, 102, 241, 0.3);
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 16px;
  position: relative;
  overflow: hidden;
}

.game-weekly-card::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 60%);
  animation: weeklyCardShimmer 8s linear infinite;
}

@keyframes weeklyCardShimmer {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.game-weekly-card.completed {
  background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(16, 185, 129, 0.15) 100%);
  border-color: rgba(34, 197, 94, 0.4);
}

.game-weekly-card.completed::before {
  background: radial-gradient(circle, rgba(34, 197, 94, 0.15) 0%, transparent 60%);
}

.weekly-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 14px;
  position: relative;
  z-index: 1;
}

.weekly-icon {
  font-size: 28px;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.weekly-title-group {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.weekly-title {
  font-size: 14px;
  font-weight: 700;
  color: rgba(255, 255, 255, 0.95);
}

.weekly-subtitle {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.6);
}

.game-weekly-card.completed .weekly-subtitle {
  color: #22c55e;
  font-weight: 600;
}

.weekly-progress-container {
  position: relative;
  z-index: 1;
}

.weekly-progress-bar {
  height: 10px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 5px;
  overflow: hidden;
  position: relative;
}

.weekly-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
  border-radius: 5px;
  transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  position: relative;
}

.weekly-progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.3) 50%, transparent 100%);
  animation: weeklyProgressShine 2s ease-in-out infinite;
}

@keyframes weeklyProgressShine {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.game-weekly-card.completed .weekly-progress-fill {
  background: linear-gradient(90deg, #22c55e 0%, #10b981 50%, #059669 100%);
}

.weekly-progress-glow {
  position: absolute;
  top: 50%;
  right: 0;
  width: 20px;
  height: 20px;
  background: radial-gradient(circle, rgba(139, 92, 246, 0.6) 0%, transparent 70%);
  transform: translateY(-50%);
  animation: weeklyGlowPulse 1.5s ease-in-out infinite;
  pointer-events: none;
}

@keyframes weeklyGlowPulse {
  0%, 100% { opacity: 0.5; transform: translateY(-50%) scale(1); }
  50% { opacity: 1; transform: translateY(-50%) scale(1.3); }
}

.game-weekly-card.completed .weekly-progress-glow {
  background: radial-gradient(circle, rgba(34, 197, 94, 0.6) 0%, transparent 70%);
}

.weekly-progress-labels {
  display: flex;
  justify-content: space-between;
  margin-top: 6px;
  font-size: 11px;
}

.weekly-earned {
  color: rgba(255, 255, 255, 0.8);
  font-weight: 600;
}

.weekly-target {
  color: rgba(255, 255, 255, 0.5);
}

.weekly-percent {
  position: absolute;
  top: 16px;
  right: 16px;
  font-size: 24px;
  font-weight: 800;
  color: rgba(139, 92, 246, 0.9);
  text-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
}

.game-weekly-card.completed .weekly-percent {
  color: #22c55e;
  text-shadow: 0 2px 8px rgba(34, 197, 94, 0.4);
}

/* === XP History Chart === */
.xp-history-section {
  margin-top: 12px;
  margin-bottom: 12px;
  padding: 12px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 12px;
}

.xp-history-title {
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 10px;
  opacity: 0.9;
}

.xp-history-chart {
  display: flex;
  align-items: flex-end;
  gap: 4px;
  height: 60px;
}

.xp-history-bar {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100%;
  position: relative;
}

.xp-bar-fill {
  width: 100%;
  background: linear-gradient(180deg, #fbbf24 0%, #f59e0b 100%);
  border-radius: 4px 4px 0 0;
  min-height: 2px;
  transition: height 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  position: absolute;
  bottom: 18px;
}

.xp-history-bar.today .xp-bar-fill {
  background: linear-gradient(180deg, #22c55e 0%, #16a34a 100%);
  box-shadow: 0 0 8px rgba(34, 197, 94, 0.5);
}

.xp-bar-day {
  font-size: 9px;
  opacity: 0.6;
  position: absolute;
  bottom: 0;
  text-transform: capitalize;
}

.xp-history-bar.today .xp-bar-day {
  opacity: 1;
  font-weight: 600;
  color: #22c55e;
}

.xp-bar-value {
  font-size: 8px;
  font-weight: 600;
  position: absolute;
  bottom: 22px;
  color: #fbbf24;
  opacity: 0;
  transition: opacity 0.2s;
}

.xp-history-bar:hover .xp-bar-value {
  opacity: 1;
}

.xp-history-bar.today .xp-bar-value {
  color: #22c55e;
  opacity: 1;
}

/* === Trophy Animation === */
.game-personal-best {
  font-size: 11px;
  color: #fbbf24;
  font-weight: 600;
  animation: trophyBounce 2s ease-in-out infinite;
}

@keyframes trophyBounce {
  0%, 100% { 
    transform: translateY(0) rotate(0deg); 
  }
  25% { 
    transform: translateY(-3px) rotate(-5deg); 
  }
  75% { 
    transform: translateY(-3px) rotate(5deg); 
  }
}

/* Trophy появление */
.game-personal-best.just-appeared {
  animation: trophyAppear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes trophyAppear {
  0% { 
    transform: scale(0) rotate(-180deg);
    opacity: 0;
  }
  50% {
    transform: scale(1.5) rotate(10deg);
  }
  100% { 
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }
}

/* === Daily Goal Pulse === */
.game-progress.near-goal .game-progress-fill {
  animation: goalPulse 1.2s ease-in-out infinite;
}

@keyframes goalPulse {
  0%, 100% {
    box-shadow: 0 0 4px rgba(34, 197, 94, 0.4);
  }
  50% {
    box-shadow: 0 0 16px rgba(34, 197, 94, 0.8), 0 0 24px rgba(34, 197, 94, 0.4);
  }
}

/* === XP Counter Spin Animation === */
.game-xp.counting {
  animation: xpCountSpin 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes xpCountSpin {
  0% { 
    transform: scale(1) rotateX(0deg);
    color: inherit;
  }
  30% { 
    transform: scale(1.3) rotateX(180deg);
    color: #fbbf24;
  }
  100% { 
    transform: scale(1) rotateX(360deg);
    color: inherit;
  }
}

/* === Rare Badge Showcase === */
.achievement-badge.rarity-rare {
  animation: rareBadgeShine 3s ease-in-out infinite;
}

.achievement-badge.rarity-epic {
  animation: epicBadgeGlow 2s ease-in-out infinite;
  box-shadow: 0 0 10px rgba(168, 85, 247, 0.4);
}

.achievement-badge.rarity-legendary {
  animation: legendaryBadgePulse 1.5s ease-in-out infinite;
  box-shadow: 0 0 15px rgba(234, 179, 8, 0.6);
}

.achievement-badge.rarity-mythic {
  animation: mythicBadgeRainbow 3s linear infinite;
  box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
}

@keyframes rareBadgeShine {
  0%, 100% { filter: brightness(1); }
  50% { filter: brightness(1.2); }
}

@keyframes epicBadgeGlow {
  0%, 100% { 
    box-shadow: 0 0 10px rgba(168, 85, 247, 0.4);
    transform: scale(1);
  }
  50% { 
    box-shadow: 0 0 20px rgba(168, 85, 247, 0.8);
    transform: scale(1.05);
  }
}

@keyframes legendaryBadgePulse {
  0%, 100% { 
    box-shadow: 0 0 15px rgba(234, 179, 8, 0.4);
    filter: brightness(1);
  }
  50% { 
    box-shadow: 0 0 25px rgba(234, 179, 8, 1);
    filter: brightness(1.3);
  }
}

@keyframes mythicBadgeRainbow {
  0% { box-shadow: 0 0 20px #ff6b6b; }
  25% { box-shadow: 0 0 20px #ffd93d; }
  50% { box-shadow: 0 0 20px #6bcb77; }
  75% { box-shadow: 0 0 20px #4d96ff; }
  100% { box-shadow: 0 0 20px #ff6b6b; }
}

/* === Achievement Unlock Animation === */
.achievement-badge.just-unlocked {
  animation: achievementUnlock 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes achievementUnlock {
  0% { transform: scale(0) rotate(-180deg); opacity: 0; }
  50% { transform: scale(1.3) rotate(10deg); }
  70% { transform: scale(0.9) rotate(-5deg); }
  100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

.achievement-badge.just-unlocked .badge-icon {
  animation: iconBurst 0.6s ease-out 0.2s;
}

@keyframes iconBurst {
  0% { transform: scale(1); }
  50% { transform: scale(1.5); filter: brightness(1.5); }
  100% { transform: scale(1); }
}

.game-expand-btn {
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 6px;
  color: white;
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 12px;
  transition: all 0.2s ease;
}

.game-expand-btn:hover {
  background: rgba(255, 255, 255, 0.25);
}

.game-expand-btn.expanded {
  background: rgba(255, 255, 255, 0.3);
  transform: rotate(180deg);
}

/* === Gamification Notification (Level Up / Achievement) === */
.game-notification {
  position: absolute;
  top: 100%;
  left: 8px;
  right: 8px;
  background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
  border-radius: 12px;
  padding: 12px 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  z-index: 1100;
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.4);
  animation: gameNotifSlideDown 0.3s ease-out forwards;
  cursor: pointer;
}

@keyframes gameNotifSlideDown {
  from { 
    opacity: 0; 
    transform: translateY(-8px); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0); 
  }
}

.game-notification.level_up {
  background: linear-gradient(135deg, #065f46 0%, #047857 100%);
  border: 1px solid rgba(52, 211, 153, 0.3);
}

.game-notification.achievement {
  background: linear-gradient(135deg, #4c1d95 0%, #6d28d9 100%);
  border: 1px solid rgba(167, 139, 250, 0.3);
}

.game-notification.daily_bonus {
  background: linear-gradient(135deg, #b45309 0%, #d97706 100%);
  border: 1px solid rgba(251, 191, 36, 0.3);
}

.game-notification.weekly_complete {
  background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
  border: 1px solid rgba(139, 92, 246, 0.3);
}

.game-notification.streak_shield {
  background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
  border: 1px solid rgba(103, 232, 249, 0.3);
}

/* Achievement rarity styles */
.game-notification.rarity-common {
  border-left: 4px solid #94a3b8;
}
.game-notification.rarity-rare {
  border-left: 4px solid #3b82f6;
  box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.3);
}
.game-notification.rarity-epic {
  border-left: 4px solid #a855f7;
  box-shadow: 0 10px 25px -5px rgba(168, 85, 247, 0.3);
}
.game-notification.rarity-legendary {
  border-left: 4px solid #eab308;
  box-shadow: 0 10px 25px -5px rgba(234, 179, 8, 0.4);
  animation: gameNotifSlideDown 0.3s ease-out forwards, legendaryNotifGlow 2s ease-in-out infinite;
}
.game-notification.rarity-mythic {
  border-left: 4px solid #ef4444;
  box-shadow: 0 10px 25px -5px rgba(239, 68, 68, 0.4);
  animation: gameNotifSlideDown 0.3s ease-out forwards, mythicNotifPulse 1.5s ease-in-out infinite;
}

@keyframes legendaryNotifGlow {
  0%, 100% { box-shadow: 0 10px 25px -5px rgba(234, 179, 8, 0.3); }
  50% { box-shadow: 0 10px 30px -5px rgba(234, 179, 8, 0.6); }
}

@keyframes mythicNotifPulse {
  0%, 100% { box-shadow: 0 10px 25px -5px rgba(239, 68, 68, 0.3); }
  50% { box-shadow: 0 10px 30px -5px rgba(239, 68, 68, 0.6); }
}

.game-notification .notif-icon {
  font-size: 28px;
  animation: pulse 0.5s ease 2;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}

.game-notification .notif-content {
  flex: 1;
}

.game-notification .notif-title {
  font-weight: 600;
  font-size: 15px;
  color: white;
}

.game-notification .notif-subtitle {
  font-size: 13px;
  opacity: 0.85;
  color: white;
}

/* === Gamification Expanded Panel === */
.game-panel-expanded {
  position: absolute;
  top: calc(100% + 16px);
  left: -16px;
  right: -16px;
  background: linear-gradient(180deg, #2d3a4f 0%, #1e293b 15%, #334155 100%);
  border-radius: 16px;
  padding: 12px 16px 16px;
  z-index: 1050;
  max-height: 70vh;
  overflow-y: auto;
  box-shadow: 
    0 12px 30px -5px rgba(0, 0, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.08);
  animation: gamePanelSlideDown 0.3s ease-out forwards;
}

.game-panel-expanded::before {
  content: '';
  position: absolute;
  top: 8px;
  left: 50%;
  transform: translateX(-50%);
  width: 36px;
  height: 4px;
  background: rgba(255, 255, 255, 0.25);
  border-radius: 2px;
}

@keyframes gamePanelSlideDown {
  from { 
    opacity: 0; 
    transform: translateY(-8px);
  }
  to { 
    opacity: 1; 
    transform: translateY(0);
  }
}

.game-panel-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.3);
  z-index: 1040;
}

/* Stats section in expanded panel */
.game-stats-section {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  margin-bottom: 16px;
}

.game-stat {
  text-align: center;
  padding: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 8px;
}

.game-stat .stat-value {
  display: block;
  font-size: 18px;
  font-weight: 700;
  color: white;
}

.game-stat .stat-label {
  display: block;
  font-size: 10px;
  opacity: 0.7;
  color: white;
  margin-top: 2px;
}

/* Title section */
.game-title-section {
  text-align: center;
  padding: 12px 0;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  margin-bottom: 16px;
}

.game-title-section .current-title {
  font-size: 20px;
  font-weight: 700;
}

.game-title-section .next-level-hint {
  font-size: 12px;
  opacity: 0.7;
  color: white;
  margin-top: 4px;
}

/* Achievements section */
.game-achievements-section h4 {
  font-size: 14px;
  font-weight: 600;
  color: white;
  margin: 0 0 12px 0;
}

.achievement-category {
  margin-bottom: 12px;
}

.achievement-category .category-name {
  font-size: 11px;
  opacity: 0.7;
  color: white;
  margin-bottom: 6px;
}

.achievements-row {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.achievement-badge {
  width: 48px;
  height: 48px;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 255, 255, 0.2);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.achievement-badge.locked {
  opacity: 0.5;
  filter: grayscale(100%);
}

.achievement-badge.unlocked {
  background: rgba(255, 255, 255, 0.15);
  box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
}

.achievement-badge .badge-icon {
  font-size: 20px;
}

.achievement-badge .badge-xp {
  font-size: 9px;
  opacity: 0.8;
  color: white;
  margin-top: 2px;
}

/* Flying XP animation */
.flying-xp {
  position: fixed;
  z-index: 1150;
  font-size: 16px;
  font-weight: bold;
  color: #eab308;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  pointer-events: none;
  animation: flyToBar 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}

@keyframes flyToBar {
  0% { opacity: 1; transform: scale(1); }
  100% { opacity: 0; transform: scale(0.5); }
}

/* Floating +XP indicator */
.floating-xp {
  position: absolute;
  top: -20px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 14px;
  font-weight: bold;
  color: #22c55e;
  animation: floatUp 0.8s ease-out forwards;
  pointer-events: none;
}

@keyframes floatUp {
  0% { opacity: 1; transform: translateX(-50%) translateY(0); }
  100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
}

/* z-index hierarchy (Phase 0.5) */
.theme-fab { z-index: 1000; }
.game-panel-backdrop { z-index: 1040; }
.game-panel-expanded { z-index: 1050; }
.game-notification { z-index: 1100; }
.flying-xp { z-index: 1150; }
.confetti-container { z-index: 1200; }

/* Mobile: compact gamification bar */
@media (max-width: 400px) {
  .game-bar {
    gap: 8px;
  }
  .game-xp {
    display: none; /* Скрыть XP счётчик на очень узких экранах */
  }
  .game-level {
    font-size: 13px;
  }
  .game-stats-section {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* Нижняя линия: клиент + действия */
.hdr-bottom {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  padding: 6px 16px;
  background: #f0f0f0;
  border: 1px solid #667eea;
  border-top: none;
  border-radius: 0 0 16px 16px;
  flex-wrap: nowrap;
  overflow: visible;
  position: relative;
  z-index: 10;
  min-height: 40px;
  /* Тень снизу как у нижнего меню */
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.06);
}

/* Информация о клиенте */
.hdr-client {
  display: flex;
  align-items: center;
  gap: 6px;
  flex: 1;
  overflow: visible;
}

/* Группа кнопок даты в header */
.hdr-date-group {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-left: auto;
}

.hdr-client-avatar {
  width: 32px;
  height: 32px;
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 700;
  font-size: 13px;
  cursor: pointer;
  user-select: none;
  -webkit-user-select: none;
  transition: transform 0.2s ease;
  flex-shrink: 0;
}

.hdr-client-avatar:active {
  transform: scale(0.95);
}

.hdr-client-info {
  display: flex;
  flex-direction: column;
  gap: 0;
  line-height: 1.1;
}

.hdr-client-name {
  font-size: 13px;
  font-weight: 600;
  color: #1f2937;
}

.hdr-client-firstname {
  font-size: 13px;
  font-weight: 600;
  color: #1f2937;
  line-height: 1.1;
}

.hdr-client-lastname {
  font-size: 10px;
  font-weight: 400;
  color: #6b7280;
  line-height: 1.1;
}

/* Cloud sync indicator */
.cloud-sync-indicator {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  min-width: 28px;
  height: 28px;
  border-radius: 8px;
  background: rgba(107, 114, 128, 0.1);
  color: #6b7280;
  transition: all 0.3s ease;
  cursor: default;
}

/* Не использовать эмодзи, только обычные символы для offline-безопасности */
.cloud-sync-indicator .cloud-icon {
  font-family: system-ui, -apple-system, sans-serif;
  font-style: normal;
}

.cloud-sync-indicator.syncing {
  background: rgba(59, 130, 246, 0.15);
  color: #3b82f6;
}

/* Крутящийся spinner для syncing */
.sync-spinner {
  width: 14px;
  height: 14px;
  border: 2px solid rgba(59, 130, 246, 0.3);
  border-top-color: #3b82f6;
  border-radius: 50%;
  animation: syncSpin 0.8s linear infinite;
}

/* SVG иконки */
.cloud-sync-indicator svg.cloud-icon {
  display: block;
}

@keyframes syncSpin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.cloud-sync-indicator.synced {
  background: rgba(16, 185, 129, 0.15);
  color: #10b981;
  font-size: 12px;
  animation: syncPop 0.3s ease;
}

@keyframes syncPop {
  0% { transform: scale(1); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

.cloud-sync-indicator.offline {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
  position: relative;
}

/* Бейдж с количеством pending изменений */
.cloud-sync-indicator .pending-badge {
  position: absolute;
  top: -4px;
  right: -4px;
  background: #ef4444;
  color: white;
  font-size: 9px;
  font-weight: 600;
  min-width: 14px;
  height: 14px;
  border-radius: 7px;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 3px;
  line-height: 1;
  box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

/* Прогресс синхронизации (3/5) рядом со spinner */
.cloud-sync-indicator .sync-progress {
  font-size: 10px;
  font-weight: 600;
  margin-left: 4px;
  color: #3b82f6;
}

/* Countdown до retry (5) рядом с ошибкой */
.cloud-sync-indicator .retry-countdown {
  position: absolute;
  top: -4px;
  right: -4px;
  background: #f59e0b;
  color: white;
  font-size: 9px;
  font-weight: 600;
  min-width: 14px;
  height: 14px;
  border-radius: 7px;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 3px;
  line-height: 1;
  box-shadow: 0 1px 2px rgba(0,0,0,0.2);
  animation: countdown-pulse 1s infinite;
}

@keyframes countdown-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

/* Error state */
.cloud-sync-indicator.error {
  background: rgba(239, 68, 68, 0.15);
  color: #ef4444;
  position: relative;
}

/* ═══════════════════════════════════════════════════════════════════
   OFFLINE BANNER — полоска вверху при отсутствии сети
   ═══════════════════════════════════════════════════════════════════ */

.offline-banner {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 9999;
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  color: white;
  padding: 8px 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: 13px;
  font-weight: 500;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from { transform: translateY(-100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.offline-banner-icon {
  font-size: 16px;
}

.offline-banner-text {
  flex: 1;
  text-align: center;
}

.offline-banner-retry {
  background: rgba(255,255,255,0.2);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 4px 12px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.offline-banner-retry:hover {
  background: rgba(255,255,255,0.3);
}

.offline-banner-retry:active {
  transform: scale(0.95);
}

/* Online banner — сеть восстановлена */
.online-banner {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 9999;
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: white;
  padding: 8px 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: 13px;
  font-weight: 500;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  animation: slideDown 0.3s ease;
}

.online-banner-icon {
  font-size: 16px;
}

.online-banner-text {
  text-align: center;
}

/* ═══════════════════════════════════════════════════════════════════
   SYNC TOAST — уведомление о синхронизации
   ═══════════════════════════════════════════════════════════════════ */

.sync-toast {
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 9998;
  padding: 10px 20px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  font-weight: 500;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  animation: toastIn 0.3s ease;
}

@keyframes toastIn {
  from { transform: translateX(-50%) translateY(20px); opacity: 0; }
  to { transform: translateX(-50%) translateY(0); opacity: 1; }
}

.sync-toast.syncing {
  background: #3b82f6;
  color: white;
}

.sync-toast.restored {
  background: #10b981;
  color: white;
}

.sync-toast.error {
  background: #ef4444;
  color: white;
}

.sync-toast-icon {
  font-size: 16px;
}

.sync-toast-icon.spin {
  animation: syncSpin 1s linear infinite;
}

/* Сдвиг контента при показе offline banner */
body:has(.offline-banner) .wrap {
  padding-top: 40px;
}

.cloud-sync-indicator.error {
  background: rgba(245, 158, 11, 0.15);
  color: #f59e0b;
}

.cloud-sync-indicator.idle {
  background: rgba(59, 130, 246, 0.15);
  color: #3b82f6;
  opacity: 1;
}

.cloud-sync-indicator.idle svg.cloud-icon {
  display: block;
}

.hdr-client-label {
  font-size: 11px;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Кнопки действий */
.hdr-actions {
  display: flex;
  align-items: center;
  gap: 2px;
  flex: 1;
  min-width: 0;
}

.hdr-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  padding: 6px 10px;
  font-size: 12px;
  font-weight: 500;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
  background: white;
  color: #374151;
  cursor: pointer;
  transition: all 0.15s ease;
  white-space: normal;
  text-align: center;
  line-height: 1.2;
  flex: 1 1 auto;
  min-width: 0;
  min-height: 36px;
}

.hdr-btn:hover {
  background: #f1f5f9;
  border-color: #cbd5e1;
}

.hdr-btn.primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
}

.hdr-btn.primary:hover {
  opacity: 0.9;
  transform: translateY(-1px);
}

.hdr-btn.ghost {
  background: transparent;
  border: none;
  color: #6b7280;
  padding: 6px 8px;
  flex: 0 0 auto;
}

.hdr-btn.ghost:hover {
  background: #f1f5f9;
  color: #374151;
}

.hdr-btn-icon {
  font-size: 14px;
  flex-shrink: 0;
}

/* Дивайдер между группами кнопок */
.hdr-divider {
  width: 1px;
  height: 24px;
  background: #e2e8f0;
  margin: 0 2px;
  flex-shrink: 0;
}

/* Backup info badge */
.hdr-backup-info {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  font-size: 10px;
  color: #6b7280;
  background: #f1f5f9;
  border-radius: 6px;
  white-space: nowrap;
  flex-shrink: 0;
}

.hdr-backup-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #10b981;
  flex-shrink: 0;
}

/* === MODERN DATE PICKER === */
.date-picker {
  position: relative;
  flex-shrink: 0;
}

.date-picker-trigger {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 9px 13px;
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
  min-width: 140px;
}

.date-picker-trigger:hover {
  border-color: #cbd5e1;
  background: #f8fafc;
}

.date-picker-trigger.open {
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
}

.date-picker-icon {
  font-size: 16px;
}

.date-picker-text {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 1px;
  flex: 1;
}

.date-picker-main {
  font-size: 14px;
  font-weight: 600;
  color: #1f2937;
  line-height: 1.2;
}

.date-picker-sub {
  font-size: 11px;
  color: #6b7280;
  line-height: 1.2;
}

.date-picker-arrow {
  font-size: 10px;
  color: #9ca3af;
  transition: transform 0.15s;
}

/* Dropdown */
.date-picker-dropdown {
  position: fixed;
  z-index: 101;
  background: white;
  border: 1px solid #e2e8f0;
  border-radius: 14px;
  padding: 12px;
  min-width: 280px;
  max-width: calc(100vw - 32px);
  box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.2), 0 4px 12px -2px rgba(0, 0, 0, 0.1);
  animation: datePickerSlide 0.2s ease;
}

/* Backdrop для календаря */
.date-picker-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: 100;
  animation: fadeIn 0.15s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes datePickerSlide {
  from {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

.date-picker-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
}

.date-picker-nav {
  width: 32px;
  height: 32px;
  border: none;
  background: #f1f5f9;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  color: #374151;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s;
}

.date-picker-nav:hover {
  background: #e2e8f0;
}

.date-picker-title {
  font-size: 15px;
  font-weight: 600;
  color: #1f2937;
  text-transform: capitalize;
}

.date-picker-weekdays {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 2px;
  margin-bottom: 4px;
}

.date-picker-weekday {
  text-align: center;
  font-size: 11px;
  font-weight: 600;
  color: #9ca3af;
  padding: 4px;
  text-transform: uppercase;
}

.date-picker-days {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 2px;
}

.date-picker-day {
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  color: #374151;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.1s;
}

.date-picker-day:hover:not(.empty):not(.selected) {
  background: #f1f5f9;
}

.date-picker-day.empty {
  cursor: default;
}

.date-picker-day.today {
  font-weight: 700;
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: white;
  border: none;
}

.date-picker-day.selected {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  font-weight: 600;
}

.date-picker-day.selected.today {
  border-color: transparent;
}

.date-picker-footer {
  display: flex;
  gap: 8px;
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid #e5e7eb;
}

.date-picker-btn {
  flex: 1;
  padding: 8px 12px;
  border: none;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
}

.date-picker-btn.today-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.date-picker-btn.today-btn:hover {
  opacity: 0.9;
}

.date-picker-btn.delete-btn {
  background: #f1f5f9;
  color: #6b7280;
}

.date-picker-btn.delete-btn:hover {
  background: #fee2e2;
  color: #dc2626;
}

/* Tooltip */
.date-picker-tooltip {
  position: fixed;
  transform: translateX(-50%) translateY(-100%);
  background: #1f2937;
  color: white;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 11px;
  white-space: nowrap;
  z-index: 10002;
  pointer-events: none;
  animation: tooltipFade 0.15s ease-out;
}

.date-picker-tooltip::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 5px solid transparent;
  border-top-color: #1f2937;
}

@keyframes tooltipFade {
  from { opacity: 0; transform: translateX(-50%) translateY(-90%); }
  to { opacity: 1; transform: translateX(-50%) translateY(-100%); }
}

/* Кнопка "Вернуться к сегодня" */
.date-picker-goto-today {
  width: 100%;
  padding: 6px 12px;
  margin-bottom: 8px;
  background: #f0f9ff;
  border: 1px dashed #667eea;
  border-radius: 6px;
  color: #667eea;
  font-size: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s;
}

.date-picker-goto-today:hover {
  background: #e0e7ff;
}

/* Статус-индикатор на дне */
.date-picker-day {
  position: relative;
  flex-direction: column;
  gap: 1px;
}

.day-number {
  font-size: 13px;
}

.day-status {
  font-size: 8px;
  line-height: 1;
  opacity: 0.8;
}

/* Streak индикатор */
.date-picker-streak {
  padding: 8px 12px;
  margin: 8px 0;
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border-radius: 8px;
  font-size: 12px;
  font-weight: 600;
  color: #92400e;
  text-align: center;
}

/* Легенда цветов */
.date-picker-legend {
  display: flex;
  justify-content: center;
  gap: 12px;
  padding: 8px 0;
  margin-bottom: 4px;
  font-size: 10px;
  color: #6b7280;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 3px;
}

.legend-item.good { color: #22c55e; }
.legend-item.warn { color: #eab308; }
.legend-item.bad { color: #ef4444; }

/* Сегодняшний день - синий как в навигации */
.date-picker-day.today {
  font-weight: 700;
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: white;
  border: none;
  animation: todayPulse 2s ease-in-out infinite;
}

@keyframes todayPulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5); }
  50% { box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2); }
}

/* Mobile responsive */
@media (max-width: 640px) {
  .date-picker-trigger {
    padding: 4px 6px;
    min-width: 90px;
    gap: 4px;
  }
  
  .date-picker-icon {
    font-size: 14px;
  }
  
  .date-picker-main {
    font-size: 12px;
  }
  
  .date-picker-sub {
    font-size: 9px;
  }
  
  .date-picker-arrow {
    font-size: 10px;
  }
  
  /* Компактная кнопка быстрого перехода */
  .today-quick-btn {
    width: 32px;
    height: 32px;
    font-size: 13px;
  }
  
  /* Компактная кнопка темы */
  .hdr-theme-btn {
    width: 32px;
    height: 32px;
    font-size: 16px;
  }
  
  .date-picker-dropdown {
    min-width: 260px;
    padding: 10px;
    left: 50%;
    transform: translateX(-50%);
  }
  
  @keyframes datePickerSlide {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(-8px);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }
}

/* Адаптивное уменьшение кнопок шапки */
@media (max-width: 900px) {
  .hdr-actions {
    gap: 4px;
  }
  .hdr-btn {
    padding: 5px 8px;
    font-size: 11px;
    min-height: 32px;
  }
  .hdr-btn-icon {
    font-size: 12px;
  }
}

@media (max-width: 700px) {
  .hdr-actions {
    gap: 3px;
  }
  .hdr-btn {
    padding: 4px 6px;
    font-size: 10px;
    min-height: 30px;
    border-radius: 6px;
  }
  .hdr-btn-icon {
    font-size: 11px;
  }
  .hdr-divider {
    height: 20px;
  }
}

@media (max-width: 500px) {
  .hdr-actions {
    gap: 2px;
  }
  .hdr-btn {
    padding: 4px 4px;
    font-size: 9px;
    min-height: 28px;
    gap: 2px;
  }
  .hdr-btn-icon {
    font-size: 10px;
  }
  .hdr-backup-info {
    display: none;
  }
}

/* Status badge refined */
.status {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  padding: 6px 12px;
  border-radius: 20px;
  font-weight: 600;
  text-transform: capitalize;
}

.status::before {
  content: '';
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: currentColor;
}

.status.ok {
  background: rgba(16, 185, 129, 0.15);
  color: #059669;
}

.status.err {
  background: rgba(239, 68, 68, 0.15);
  color: #dc2626;
}

/* Legacy login fallback */
.hdr .login {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

/* Mobile responsive header */
@media (max-width: 768px) {
  .hdr {
    padding: 10px 16px 0;
  }

  .hdr-top {
    padding: 12px 16px;
    border-radius: 12px 12px 0 0;
  }
  
  .hdr-logo-icon {
    width: 36px;
    height: 36px;
    font-size: 18px;
  }
  
  .hdr-logo-text {
    font-size: 18px;
  }
  
  .hdr-bottom {
    padding: 6px 16px;
    flex-direction: row;
    align-items: center;
    gap: 10px;
    border-radius: 0 0 12px 12px;
  }
  
  .hdr-client {
    justify-content: flex-start;
  }
  
  .hdr-actions {
    justify-content: flex-start;
    gap: 6px;
  }
  
  .hdr-btn {
    padding: 8px 12px;
    font-size: 12px;
  }
  
  .hdr-divider {
    display: none;
  }
  
  .hdr-backup-info {
    width: 100%;
    justify-content: center;
  }
}
/* ═══════════════════════════════════════════════════════════════
   Bottom Navigation Bar — компактный светлый tab bar
   ═══════════════════════════════════════════════════════════════ */
/* === SWIPE NAVIGATION === */
.tab-content-swipeable {
  touch-action: pan-y pinch-zoom;
  min-height: calc(100vh - 180px);
  padding-bottom: 100px; /* Отступ под fixed tabs */
  position: relative;
  overflow: hidden;
}

/* Slide animations */
.tab-content-swipeable.slide-out-left {
  animation: slideOutLeft 0.15s ease-out forwards;
}

.tab-content-swipeable.slide-out-right {
  animation: slideOutRight 0.15s ease-out forwards;
}

@keyframes slideOutLeft {
  0% { transform: translateX(0); opacity: 1; }
  100% { transform: translateX(-30px); opacity: 0.3; }
}

@keyframes slideOutRight {
  0% { transform: translateX(0); opacity: 1; }
  100% { transform: translateX(30px); opacity: 0.3; }
}

/* Edge bounce effect */
.tab-content-swipeable.edge-bounce-left {
  animation: bounceLeft 0.3s ease-out;
}

.tab-content-swipeable.edge-bounce-right {
  animation: bounceRight 0.3s ease-out;
}

@keyframes bounceLeft {
  0% { transform: translateX(0); }
  30% { transform: translateX(15px); }
  60% { transform: translateX(-5px); }
  100% { transform: translateX(0); }
}

@keyframes bounceRight {
  0% { transform: translateX(0); }
  30% { transform: translateX(-15px); }
  60% { transform: translateX(5px); }
  100% { transform: translateX(0); }
}

/* Edge indicator (glowing bar) */
.edge-indicator {
  position: fixed;
  top: 50%;
  transform: translateY(-50%);
  width: 4px;
  height: 80px;
  border-radius: 2px;
  z-index: 999;
  pointer-events: none;
  animation: edgeGlow 0.3s ease-out forwards;
}

.edge-indicator.left {
  left: 0;
  background: linear-gradient(to right, var(--acc), transparent);
}

.edge-indicator.right {
  right: 0;
  background: linear-gradient(to left, var(--acc), transparent);
}

@keyframes edgeGlow {
  0% { opacity: 0; height: 40px; }
  30% { opacity: 0.8; height: 100px; }
  100% { opacity: 0; height: 60px; }
}

/* Reduce motion for accessibility */
@media (prefers-reduced-motion: reduce) {
  .tab-content-swipeable.slide-out-left,
  .tab-content-swipeable.slide-out-right,
  .tab-content-swipeable.edge-bounce-left,
  .tab-content-swipeable.edge-bounce-right {
    animation: none;
  }
  .edge-indicator {
    display: none;
  }
}

.tabs {
  display: flex;
  justify-content: space-around;
  align-items: center;
  gap: 0;
  padding: 0 16px;
  margin: 0;
  background: #ffffff;
  border-top: 1px solid #e0e0e0;
  border-radius: 0;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  box-shadow: 0 -2px 12px rgba(0, 0, 0, 0.08), 0 -1px 4px rgba(0, 0, 0, 0.04);
  padding-bottom: max(4px, env(safe-area-inset-bottom));
  padding-top: 4px;
  min-height: 46px;
}

/* Скрыть технические вкладки на мобилке */
@media (max-width: 768px) {
  .tab.tab-desktop-only {
    display: none;
  }
}

.tab {
  cursor: pointer;
  padding: 4px 12px;
  min-height: 48px;
  border-radius: 0;
  font-weight: 500;
  font-size: 10px;
  color: #8e8e93;
  user-select: none;
  touch-action: manipulation;
  transition: color 0.15s ease;
  white-space: nowrap;
  text-align: center;
  line-height: 1.2;
  border: none;
  background: transparent;
  flex: 1;
  min-width: 60px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
  -webkit-tap-highlight-color: transparent;
}

.tab .tab-icon {
  font-size: 24px;
  line-height: 1;
  transition: transform 0.12s ease;
}

.tab .tab-text {
  font-size: 10px;
  font-weight: 500;
  letter-spacing: 0.02em;
}

.tab:hover {
  color: #888;
}

.tab:active {
  transform: scale(0.96);
}

.tab.active {
  color: #667eea;
}

.tab.active .tab-icon {
  transform: scale(1.05);
}

.tab.active .tab-text {
  font-weight: 600;
}

/* === iOS Switch стиль для stats/diary вкладок === */
.tab-switch-group {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #e5e5ea;
  border-radius: 8px;
  padding: 2px;
  gap: 0;
  height: 40px;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  flex: 1;
  max-width: 140px;
}

.tab.tab-switch {
  flex: 1;
  min-width: 60px;
  min-height: 36px;
  padding: 6px 10px;
  border-radius: 0;
  background: transparent;
  color: #666;
  transition: all 0.2s ease;
  gap: 2px;
}

/* Скругление только на внешних краях */
.tab.tab-switch:first-child {
  border-radius: 6px 0 0 6px;
}

.tab.tab-switch:last-child {
  border-radius: 0 6px 6px 0;
}

.tab.tab-switch .tab-icon {
  font-size: 16px;
}

.tab.tab-switch .tab-text {
  font-size: 9px;
  font-weight: 500;
}

.tab.tab-switch.active {
  background: #007aff;
  color: #fff;
  box-shadow: 0 1px 3px rgba(0, 122, 255, 0.3);
}

.tab.tab-switch.active .tab-icon {
  transform: none;
}

.tab.tab-switch:active {
  transform: scale(0.95);
}

/* Dark theme */
[data-theme="dark"] .tab-switch-group {
  background: #3a3a3c;
}

[data-theme="dark"] .tab.tab-switch {
  color: #8e8e93;
}

[data-theme="dark"] .tab.tab-switch.active {
  background: #0a84ff;
  color: #fff;
}

/* Отступ для контента страницы */
.page {
  padding:
    max(0px, env(safe-area-inset-top))
    0
    calc(80px + max(8px, env(safe-area-inset-bottom)))
    0;
  /* Плавное появление контента */
  animation: pageFadeIn 0.2s ease-out;
}

@keyframes pageFadeIn {
  from { opacity: 0.7; }
  to { opacity: 1; }
}

/* Day header with DatePicker and trainings */
.day-header {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  margin-bottom: 8px;
  flex-wrap: wrap;
}

.day-header .date-picker {
  flex-shrink: 0;
}

.day-header .trainings-wrap {
  flex: 1;
  min-width: 0;
  margin-top: 0;
}

.area-cal,
.area-main,
.area-side {
  min-width: 0;
}
.area-side .side-row:last-child {
  margin-bottom: 0;
}

/* === color tone cards === */
.card[class*='tone-'] {
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
}
.tone-blue {
  background: #dbeafe;
  border: 1px solid #93c5fd;
}
.tone-green {
  background: #ecfdf5;
  border: 1px solid #a7f3d0;
  padding: 8px;
}
.tone-amber {
  background: #fffbeb;
  border: 1px solid #fde68a;
}
.tone-violet {
  background: #f5f3ff;
  border: 1px solid #ddd6fe;
}
.tone-slate {
  background: #fafbfc;
  border: 1px solid #93c5fd;
}

/* badges / pills */
.pill {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 999px;
  background: #e2e8f0;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

/* delta generic */
.delta {
  font-weight: 600;
}
.delta.good {
  color: #059669;
}
.delta.bad {
  color: #dc2626;
}

/* generic grids */
.grid {
  display: grid;
  gap: 6px 10px;
}
.grid-2 {
  grid-template-columns: repeat(2, 1fr);
}
.grid-3 {
  grid-template-columns: repeat(3, 1fr);
}
.grid-4 {
  grid-template-columns: repeat(4, 1fr);
}

/* user tab cards 3-column layout */
.user-cards-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 14px;
  align-items: start;
  margin-bottom: 10px;
}
/* inline vertical lists inside cards */
.field-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.inline-field {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 6px;
  font-size: 13px;
}
.inline-field label {
  font-weight: 500;
  min-width: 140px;
}
.inline-field .sep {
  opacity: 0.5;
}
.inline-field input,
.inline-field select {
  flex: 1;
  min-width: 120px;
  max-width: 220px;
}
@media (max-width: 780px) {
  .inline-field {
    flex-direction: column;
    align-items: stretch;
  }
  .inline-field .sep {
    display: none;
  }
  .inline-field input,
  .inline-field select {
    max-width: 100%;
    width: 100%;
  }
}
@media (max-width: 1400px) {
  .user-cards-grid {
    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
  }
}
@media (max-width: 780px) {
  .user-cards-grid {
    grid-template-columns: 1fr;
  }
}

/* compact inputs and labels for green cards */
.tone-green label {
  font-size: 11px;
  margin-bottom: 2px;
  color: #065f46;
}
.tone-green input,
.tone-green textarea,
.tone-green select {
  font-size: 12px;
  padding: 4px 6px;
  height: auto;
  min-height: 24px;
}
.tone-green textarea {
  min-height: 50px;
  resize: vertical;
  width: 100%;
  box-sizing: border-box;
}
.tone-green .grid > div {
  min-width: 0;
}
/* narrower inputs for day & sleep evaluation */
.tone-green .grid input[type='number'],
.tone-green .grid input[disabled] {
  width: 34px;
  min-width: 34px;
  height: 20px;
  font-size: 11px;
  padding: 1px 3px;
  text-align: center;
  border-radius: 5px;
  border: 1px solid #f9c58d; /* same as training inputs */
  background: #fff;
}
.tone-green .grid input[type='time'] {
  width: 86px;
  min-width: 86px;
}

/* tables generic */
.tbl th {
  background: #f1f5f9;
  font-weight: 600;
  font-size: 12px;
}
.tbl tr:nth-child(even) td {
  background: #fafafa;
}
.tbl .tr-sum td {
  background: #f0f9ff;
  font-weight: 600;
}
.tbl input.readOnly {
  background: #f8fafc;
}

/* Meals table grouping: per-100g product characteristic columns */
.meals-table th.per100-col {
  background: #ececec;
  color: #555;
}
.meals-table th {
  white-space: normal;
  line-height: 1.1;
  padding: 4px 6px;
}
.meals-table td {
  padding: 2px 4px;
  line-height: 1;
  height: 20px;
  min-height: 20px;
}
.meals-table tr {
  height: 20px;
  min-height: 20px;
}
.daily-summary td,
.daily-summary tr {
  height: 20px;
  min-height: 20px;
}
/* Центровка и фиксированная ширина для всех колонок параметров (кроме названия) */
.meals-table th:not(:first-child),
.meals-table td:not(:first-child) {
  text-align: center;
  min-width: 40px;
  max-width: 40px;
  width: 40px;
}
.meals-table td input[type='number'] {
  height: 16px;
  min-height: 16px;
  padding: 1px 2px;
  font-size: 11px;
  width: 42px;
  min-width: 42px;
  line-height: 14px;
}
.meals-table tr {
  height: 18px;
}
.meals-table td {
  height: 18px;
}

/* === MICRO-ANIMATION: New product fly-in === */
@keyframes productFlyIn {
  0% {
    opacity: 0;
    transform: translateX(-20px) scale(0.95);
  }
  60% {
    opacity: 1;
    transform: translateX(4px) scale(1.02);
  }
  100% {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}

.meals-table tr[data-new="true"] {
  animation: productFlyIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

.meals-table tr[data-new="true"] td {
  background: rgba(34, 197, 94, 0.08);
  transition: background 0.5s ease;
}

/* Remove highlight after animation */
.meals-table tr[data-new="false"] td {
  background: transparent;
  transition: background 0.3s ease;
}

@media (prefers-reduced-motion: reduce) {
  .meals-table tr[data-new="true"] {
    animation: none;
  }
}

/* Кнопка удаления под высоту строки */
.meals-table td button.btn.secondary {
  padding: 0 6px;
  height: 16px;
  min-height: 16px;
  line-height: 16px;
  font-size: 11px;
  border-radius: 6px;
}
.daily-summary td,
.daily-summary tr {
  height: 18px;
}
.meal-sep {
  margin-top: 14px;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 1px;
  color: #334155;
  opacity: 0.9;
  text-transform: uppercase;
  display: flex;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
}

/* Dropdown для выбора типа приёма */
.meal-type-wrapper {
  position: relative;
  display: inline-flex;
  align-items: center;
}

.meal-type-select {
  position: absolute;
  opacity: 0;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  cursor: pointer;
  font-size: 16px; /* предотвращает zoom на iOS */
}

.meal-type-label {
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  padding: 4px 10px;
  border-radius: 8px;
  transition: background 0.15s;
  background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
  font-weight: 600;
  font-size: 13px;
  color: #1e40af;
}

.meal-type-arrow {
  font-size: 8px;
  opacity: 0.6;
  margin-left: 2px;
}

.meal-type-label:hover {
  background: linear-gradient(135deg, #bfdbfe 0%, #c7d2fe 100%);
}

.meal-type-wrapper:hover .meal-type-arrow {
  opacity: 1;
}

/* Время приёма — ВЫДЕЛЕННОЕ */
.meal-time-badge {
  background: #fef3c7;
  color: #92400e;
  font-weight: 700;
  font-size: 13px;
  padding: 4px 10px;
  border-radius: 8px;
  margin-left: 8px;
}

/* Калории приёма */
.meal-kcal-badge {
  background: #f1f5f9;
  color: #475569;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 10px;
  font-weight: 600;
  margin-left: auto;
}

/* Стили для разных типов приёмов пищи */
.meal-sep.meal-type-breakfast { color: #c2410c; } /* оранжевый — завтрак */
.meal-sep.meal-type-breakfast .meal-kcal-badge { background: #fff7ed; color: #c2410c; }

.meal-sep.meal-type-lunch { color: #15803d; } /* зелёный — обед */
.meal-sep.meal-type-lunch .meal-kcal-badge { background: #f0fdf4; color: #15803d; }

.meal-sep.meal-type-dinner { color: #1d4ed8; } /* синий — ужин */
.meal-sep.meal-type-dinner .meal-kcal-badge { background: #eff6ff; color: #1d4ed8; }

.meal-sep.meal-type-snack1,
.meal-sep.meal-type-snack2,
.meal-sep.meal-type-snack3 { color: #6b7280; } /* серый — перекус */
.meal-sep.meal-type-snack1 .meal-kcal-badge,
.meal-sep.meal-type-snack2 .meal-kcal-badge,
.meal-sep.meal-type-snack3 .meal-kcal-badge { background: #f3f4f6; color: #6b7280; }

.meal-sep.meal-type-night { color: #6366f1; } /* фиолетовый — ночной */
.meal-sep.meal-type-night .meal-kcal-badge { background: #eef2ff; color: #6366f1; }

/* Подсказка "изменить" рядом с типом приёма */
.meal-type-hint {
  font-size: 9px;
  color: #94a3b8;
  font-weight: 400;
  margin-left: 4px;
  text-transform: none;
}

/* Предпросмотр типа приёма в модалке создания */
.meal-type-preview {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-top: 16px;
  padding: 12px 16px;
  background: #f8fafc;
  border-radius: 12px;
}

.meal-type-preview-label {
  font-size: 13px;
  color: #64748b;
}

.meal-type-preview-value {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 14px;
  font-weight: 600;
  padding: 4px 8px;
  border-radius: 6px;
  cursor: pointer;
}

.meal-type-preview-value.meal-type-breakfast { color: #c2410c; background: #fff7ed; }
.meal-type-preview-value.meal-type-lunch { color: #15803d; background: #f0fdf4; }
.meal-type-preview-value.meal-type-dinner { color: #1d4ed8; background: #eff6ff; }
.meal-type-preview-value.meal-type-snack1,
.meal-type-preview-value.meal-type-snack2,
.meal-type-preview-value.meal-type-snack3 { color: #6b7280; background: #f3f4f6; }
.meal-type-preview-value.meal-type-night { color: #6366f1; background: #eef2ff; }

.meal-type-preview-icon {
  font-size: 16px;
}

.meal-type-preview-name {
  margin-right: 2px;
}

.meal-type-preview-select {
  position: absolute;
  opacity: 0;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  cursor: pointer;
  font-size: 16px;
}

.meal-type-preview .meal-type-hint {
  font-size: 10px;
}

.meal-card {
  padding-top: 6px;
  padding-bottom: 6px;
  overflow: visible;
}
/* Название продукта: фиксированная ширина с переносами */
.meals-table td:first-child,
.meals-table th:first-child {
  max-width: 220px;
  min-width: 180px;
  width: 200px;
  white-space: normal;
  word-break: break-word;
}

/* Daily summary specific */
.daily-summary .tr-sum td {
  background: #e0f2fe;
}
.daily-summary tbody tr:nth-child(1) td {
  background: #f8fafc;
  font-weight: 600;
}
.daily-summary tbody tr:nth-child(2) td {
  background: #eef2ff;
}
.daily-summary tbody tr.daily-dev-row td {
  background: #f1f5f9;
  border-top: 2px solid #cbd5e1;
}

/* suggest (autocomplete) */
.suggest-wrap {
  position: relative;
}
.suggest-list {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  z-index: 1000;
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 4px;
  max-height: 280px;
  overflow: auto;
  box-shadow:
    0 8px 24px -4px rgba(0, 0, 0, 0.1),
    0 4px 12px -2px rgba(0, 0, 0, 0.06);
}
/* Portal версия — рендерится в body, вне ограничений карточки */
.suggest-list-portal {
  position: fixed !important;
  z-index: 9999 !important;
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 4px;
  max-height: 280px;
  overflow: auto;
  box-shadow:
    0 8px 24px -4px rgba(0, 0, 0, 0.15),
    0 4px 12px -2px rgba(0, 0, 0, 0.1);
}
.suggest-item {
  padding: 6px 8px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
}

/* Заголовок секции в dropdown */
.suggest-header {
  padding: 8px 10px 6px;
  font-size: 11px;
  font-weight: 600;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid #f1f5f9;
  margin-bottom: 4px;
}

.suggest-item:hover {
  background: #f1f5f9;
}
.suggest-item.selected {
  background: var(--acc);
  color: var(--acc-contrast);
  font-weight: 500;
}
.suggest-item.selected small {
  color: rgba(255, 255, 255, 0.8) !important;
}

/* modal — glassmorphism style */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(17, 24, 39, 0.4);
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 60px 20px;
  z-index: 200;
}
.modal {
  background: rgba(255, 255, 255, 0.85);
  -webkit-backdrop-filter: blur(20px);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 20px;
  padding: 20px;
  max-width: 760px;
  width: 100%;
  box-shadow:
    0 24px 48px -12px rgba(0, 0, 0, 0.2),
    0 8px 16px -6px rgba(0, 0, 0, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.5);
  animation: pop 0.25s ease;
}

/* === Login Modal === */
.login-modal {
  background: rgba(255, 255, 255, 0.95) !important;
}

.login-modal input:focus {
  border-color: #667eea !important;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15) !important;
}

.login-modal button:hover:not(:disabled) {
  transform: translateY(-1px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5) !important;
}

.login-modal button:active:not(:disabled) {
  transform: translateY(0);
}

[data-theme="dark"] .login-modal {
  background: rgba(30, 30, 35, 0.95) !important;
}

[data-theme="dark"] .login-modal input {
  background: rgba(255, 255, 255, 0.05);
  border-color: rgba(255, 255, 255, 0.1);
  color: var(--text);
}

[data-theme="dark"] .login-modal input::placeholder {
  color: var(--muted);
}

/* === Client Select Modal === */
.client-select-modal {
  background: rgba(255, 255, 255, 0.95) !important;
}

.client-select-modal input:focus {
  border-color: #667eea !important;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15) !important;
}

.client-card:hover {
  border-color: #667eea !important;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%) !important;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
}

.client-card .btn-icon:hover {
  transform: scale(1.1);
}

[data-theme="dark"] .client-select-modal {
  background: rgba(30, 30, 35, 0.95) !important;
}

[data-theme="dark"] .client-select-modal input {
  background: rgba(255, 255, 255, 0.05);
  border-color: rgba(255, 255, 255, 0.1);
  color: var(--text);
}

[data-theme="dark"] .client-card {
  background: rgba(255, 255, 255, 0.03) !important;
  border-color: rgba(255, 255, 255, 0.1) !important;
}

[data-theme="dark"] .client-card:hover {
  background: rgba(102, 126, 234, 0.1) !important;
  border-color: rgba(102, 126, 234, 0.3) !important;
}

/* === Client Card Animation === */
@keyframes fadeSlideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* === Client Dropdown (header) === */
.hdr-client-clickable:hover {
  background: rgba(0, 0, 0, 0.05);
}

.hdr-client-clickable:hover .hdr-client-avatar {
  transform: scale(1.08);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.hdr-client-avatar {
  transition: transform 0.2s, box-shadow 0.2s;
}

[data-theme="dark"] .hdr-client-clickable:hover {
  background: rgba(255, 255, 255, 0.05);
}

.client-dropdown-item:hover {
  background: rgba(102, 126, 234, 0.08) !important;
}

[data-theme="dark"] .client-dropdown {
  background: var(--card) !important;
  border-color: rgba(255, 255, 255, 0.1) !important;
}

@keyframes pop {
  from {
    transform: translateY(12px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* calendar refinements */
.calendar {
  padding: 10px;
}
.cal-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 6px;
  font-weight: 600;
}
.cal-nav {
  border: none;
  background: #e2e8f0;
  width: 28px;
  height: 28px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.cal-nav:hover {
  background: #cbd5e1;
}

/* Кнопка быстрого перехода на вчера (в header рядом с DatePicker) */
.yesterday-quick-btn {
  border: 1px solid #e2e8f0;
  background: white;
  color: #374151;
  min-width: 33px;
  height: 33px;
  padding: 0 8px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.15s, transform 0.1s, box-shadow 0.15s, border-color 0.15s;
}
.yesterday-quick-btn:hover {
  background: #f8fafc;
  border-color: #cbd5e1;
}
.yesterday-quick-btn:active {
  transform: scale(0.95);
}
.yesterday-quick-btn.active {
  background: #10b981;
  border-color: #10b981;
  color: white;
  box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
}

/* Кнопка быстрого перехода на сегодня (в header рядом с DatePicker) */
.today-quick-btn {
  border: 1px solid #3b82f6;
  background: #3b82f6;
  color: white;
  min-width: 34px;
  height: 34px;
  padding: 0 8px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
  box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
}
.today-quick-btn:hover {
  background: #2563eb;
  box-shadow: 0 3px 8px rgba(59, 130, 246, 0.4);
}
.today-quick-btn:active {
  transform: scale(0.95);
}
.today-quick-btn.active {
  background: #10b981;
  box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
}

.cal-today-btn {
  border: none;
  background: #3b82f6;
  color: white;
  width: 28px;
  height: 28px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-left: 8px;
  transition: background 0.15s, transform 0.1s;
}
.cal-today-btn:hover {
  background: #2563eb;
}
.cal-today-btn:active {
  transform: scale(0.95);
}
.cal-title {
  text-transform: capitalize;
  font-size: 14px;
}
.cal-grid {
  margin-bottom: 4px;
}
.cal-dow div {
  font-size: 11px;
  font-weight: 600;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.cal-cell {
  cursor: pointer;
  padding: 6px 0;
  font-size: 12px;
  text-align: center;
  border-radius: 8px;
  position: relative;
  transition: background 0.15s ease;
}
.cal-cell.today {
  outline: 2px solid #94a3b8;
  outline-offset: 0;
  font-weight: 600;
}
.cal-cell.sel {
  background: var(--acc);
  color: var(--acc-contrast);
  font-weight: 600;
}
.cal-cell.has-data {
  font-weight: 600;
}
.cal-cell:hover:not(.sel) {
  filter: brightness(0.92);
}

/* === STREAK визуализация === */
.cal-cell {
  position: relative;
}

.cal-cell.streak-start,
.cal-cell.streak-middle,
.cal-cell.streak-end {
  z-index: 1;
}

/* Соединительные линии между streak днями */
.cal-cell.streak-start::after,
.cal-cell.streak-middle::after {
  content: '';
  position: absolute;
  right: -2px;
  top: 50%;
  width: 4px;
  height: 4px;
  background: rgba(34, 197, 94, 0.6);
  border-radius: 50%;
  transform: translateY(-50%);
  z-index: 2;
}

.cal-cell.streak-middle::before {
  content: '';
  position: absolute;
  left: -2px;
  top: 50%;
  width: 4px;
  height: 4px;
  background: rgba(34, 197, 94, 0.6);
  border-radius: 50%;
  transform: translateY(-50%);
  z-index: 2;
}

.cal-cell.streak-end::before {
  content: '';
  position: absolute;
  left: -2px;
  top: 50%;
  width: 4px;
  height: 4px;
  background: rgba(34, 197, 94, 0.6);
  border-radius: 50%;
  transform: translateY(-50%);
  z-index: 2;
}

/* Иконка огня для streak */
.streak-fire {
  position: absolute;
  top: -4px;
  right: -2px;
  font-size: 10px;
  line-height: 1;
  z-index: 3;
  filter: drop-shadow(0 1px 1px rgba(0,0,0,0.2));
}

/* Анимация огня */
@keyframes streak-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.cal-cell.streak-middle .streak-fire,
.cal-cell.streak-end .streak-fire {
  animation: streak-pulse 1.5s ease-in-out infinite;
}

.cal-foot {
  display: flex;
  gap: 6px;
  margin-top: 4px;
}

/* responsive tweaks */
@media (max-width: 1200px) {
  .area-side {
    grid-column: 1 / -1;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
    gap: 14px;
  }
  .area-side .side-row {
    flex-direction: row;
  }
}
@media (max-width: 840px) {
  .page {
    padding-left: 0;
    padding-right: 0;
  }
  .day-header {
    flex-direction: column;
    gap: 10px;
  }
  .day-header .trainings-wrap {
    width: 100%;
  }
  .area-cal {
    order: 1;
  }
  .area-main {
    order: 2;
  }
  .area-side {
    order: 3;
  }
  .wrap {
    padding: 12px 14px 80px;
    /* Отступ сверху для fixed шапки на мобильных */
    padding-top: 125px;
  }
}

/* utilities */
.flex {
  display: flex;
}
.flex-col {
  display: flex;
  flex-direction: column;
}
.gap-4 {
  gap: 4px;
}
.gap-8 {
  gap: 8px;
}
.text-center {
  text-align: center;
}

/* scrollbars subtle */
* {
  scrollbar-width: thin;
  scrollbar-color: #cbd5e1 transparent;
}
*::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}
*::-webkit-scrollbar-track {
  background: transparent;
}
*::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 20px;
}
*::-webkit-scrollbar-thumb:hover {
  background: #94a3b8;
}

/* Принудительная высота для строк отклонений в отчетах */
.tr-dev {
  height: 15px;
  min-height: 15px;
}
.tr-dev td {
  height: 15px;
  min-height: 15px;
  line-height: 15px;
}

/* Высота для обычных строк данных в таблицах отчетов */
.tbl tr {
  height: 15px;
  min-height: 15px;
}
.tbl td {
  height: 15px;
  min-height: 15px;
  line-height: 15px;
}

/* === MOBILE OPTIMIZATION === */
@media (max-width: 640px) {
  /* === СОВРЕМЕННАЯ ШАПКА НА МОБИЛЬНЫХ === */
  .hdr {
    padding: 8px 14px 0;
    margin-bottom: 0;
  }

  .hdr-top {
    padding: 12px 14px;
    border-radius: 12px 12px 0 0;
  }

  .hdr-logo-icon {
    width: 32px;
    height: 32px;
    font-size: 16px;
    border-radius: 10px;
  }

  .hdr-logo-text {
    font-size: 16px;
  }

  .hdr-logo-sub {
    font-size: 10px;
  }

  .hdr-bottom {
    padding: 6px 14px;
    gap: 8px;
    border-radius: 0 0 12px 12px;
  }

  .hdr-client {
    flex: 1;
    min-width: 0;
  }

  .hdr-client-avatar {
    width: 36px;
    height: 36px;
    font-size: 13px;
    border-radius: 10px;
  }

  .hdr-client-name {
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 140px;
  }

  .hdr-client-label {
    font-size: 10px;
  }

  .hdr-actions {
    width: 100%;
    justify-content: flex-start;
    gap: 2px;
  }

  .hdr-btn {
    padding: 4px 4px;
    font-size: 9px;
    border-radius: 6px;
    min-height: 28px;
    gap: 2px;
  }

  .hdr-btn-icon {
    font-size: 10px;
  }

  .hdr-divider {
    display: none;
  }

  .hdr-backup-info {
    display: none;
  }

  .status {
    font-size: 11px;
    padding: 4px 10px;
  }

  .status::before {
    width: 6px;
    height: 6px;
  }

  .card {
    padding: 12px;
  }

  th,
  td {
    padding: 8px 6px;
    font-size: 13px;
  }

  input,
  select,
  textarea {
    font-size: 16px;
  }

  .modal-backdrop {
    padding: 40px 12px;
    align-items: flex-start;
  }

  .modal {
    width: 90%;
    max-width: none;
    max-height: none;
  }

  /* Ensure suggest dropdown is visible in meal cards */
  .meal-card,
  .card {
    overflow: visible !important;
  }

  /* === MOBILE MEAL CARDS (compact v2.8) === */

  /* Hide table on mobile, show cards */
  .meals-table {
    display: none !important;
  }

  .mobile-products-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-top: 6px;
  }

  /* === Swipeable Row Component === */
  .swipeable-container {
    position: relative;
    overflow: hidden;
    margin-bottom: 6px;
    border-radius: 6px;
  }
  
  .swipeable-background {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    width: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #ef4444;
    border-radius: 6px;
  }
  
  .swipeable-delete-btn {
    color: white;
    font-weight: 600;
    font-size: 13px;
    background: transparent;
    border: none;
    padding: 8px 16px;
    cursor: pointer;
  }
  
  .swipeable-content {
    position: relative;
    background: #fff;
    will-change: transform;
  }
  
  .swipeable-content.deleting {
    opacity: 0.5;
  }

  /* Product card - 2 rows only */
  .mpc {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    padding: 6px 8px;
  }

  /* Row 1: name + grams + kcal + delete */
  .mpc-row1 {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .mpc-name {
    flex: 1;
    font-size: 13px;
    font-weight: 500;
    color: #1a1a1a;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .mpc-grams {
    width: 50px;
    height: 28px;
    padding: 4px 6px;
    font-size: 13px;
    font-weight: 500;
    text-align: center;
    border: 1px solid #d1d5db;
    border-radius: 4px;
    background: #f9fafb;
    color: #1a1a1a;
    -webkit-appearance: none;
    -moz-appearance: textfield;
  }
  
  /* Кнопка граммов (мобильные) — открывает wheel picker */
  .mpc-grams-btn {
    min-width: 55px;
    height: 32px;
    padding: 4px 10px;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    background: #f3f4f6;
    color: #1a1a1a;
    cursor: pointer;
    transition: background 0.15s, border-color 0.15s, color 0.15s;
  }
  
  .mpc-grams-btn:active {
    background: #e5e7eb;
  }
  
  /* Цветовые подсказки для больших порций */
  .mpc-grams-btn.grams-warn {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border-color: #f59e0b;
    color: #92400e;
  }
  
  .mpc-grams-btn.grams-danger {
    background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
    border-color: #ef4444;
    color: #991b1b;
  }
  
  /* Иконка категории */
  .mpc-category-icon {
    font-size: 14px;
    flex-shrink: 0;
    margin-right: 4px;
  }
  
  /* Бейдж полезности/вредности */
  .mpc-badge {
    font-size: 12px;
    flex-shrink: 0;
    margin-left: 4px;
  }
  
  /* Альтернатива */
  .mpc-alternative {
    margin-top: 6px;
    padding: 6px 8px;
    background: #f0f9ff;
    border-radius: 4px;
    font-size: 11px;
    color: #0369a1;
    line-height: 1.3;
  }
  
  .mpc-alternative strong {
    color: #0c4a6e;
  }
  
  /* Grams Picker стили */
  .grams-picker-modal {
    max-width: 240px;
  }
  
  .grams-wheels {
    justify-content: center;
  }
  
  /* Input для ручного ввода граммов */
  .grams-input-row {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 12px 16px 8px;
    gap: 4px;
  }
  
  .grams-manual-input {
    width: 80px;
    height: 44px;
    font-size: 24px;
    font-weight: 600;
    text-align: center;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    background: #f9fafb;
    color: #111827;
    outline: none;
    -webkit-appearance: none;
    -moz-appearance: textfield;
  }
  
  .grams-manual-input:focus {
    border-color: #3b82f6;
    background: #fff;
  }
  
  .grams-input-suffix {
    font-size: 20px;
    font-weight: 500;
    color: #6b7280;
  }

  .mpc-grams::-webkit-inner-spin-button,
  .mpc-grams::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .mpc-grams:focus {
    border-color: #3b82f6;
    outline: none;
    background: #fff;
  }

  .mpc-kcal {
    font-weight: 600;
    font-size: 13px;
    color: #1a1a1a;
    min-width: 36px;
    text-align: right;
  }

  .mpc-delete {
    width: 28px;
    height: 28px;
    padding: 0;
    border: none;
    background: transparent;
    color: #9ca3af;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    -webkit-tap-highlight-color: transparent;
  }

  .mpc-delete:active {
    background: #fee2e2;
    color: #dc2626;
  }

  /* Grid for macros: header + values */
  .mpc-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1.3fr 1fr 1fr 1.5fr 1fr 1fr 1fr;
    gap: 2px;
    text-align: center;
    font-size: 10px;
    color: #6b7280;
  }

  .mpc-header {
    font-weight: 600;
    color: #9ca3af;
    margin-top: 4px;
  }

  .mpc-values {
    font-weight: 500;
    color: #374151;
  }

  .mpc-grid .mpc-dim {
    color: #9ca3af;
    white-space: nowrap;
  }

  /* Legacy row2 - keep for compatibility */
  .mpc-row2 {
    display: flex;
    gap: 6px;
    font-size: 10px;
    color: #6b7280;
    margin-top: 3px;
    flex-wrap: wrap;
  }

  .mpc-row2 .mpc-dim {
    color: #9ca3af;
  }

  /* Meal totals - grid layout */
  .mpc-totals-wrap {
    background: #dbeafe;
    border-radius: 6px;
    padding: 6px 8px;
    margin-top: 6px;
  }

  /* Серый фон для прошедших приёмов */
  .tone-slate .mpc-totals-wrap {
    background: #f8fafc;
  }
  .tone-slate .mpc-totals-wrap .mpc-header,
  .tone-slate .mpc-totals-wrap .mpc-totals-values {
    color: #64748b;
  }

  .mpc-totals-wrap .mpc-header {
    color: #0369a1;
    font-size: 9px;
    margin-top: 0;
  }

  .mpc-totals-values {
    font-weight: 600;
    color: #0369a1;
  }

  /* Products expand/collapse toggle */
  .mpc-products-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 10px;
    background: #f8fafc;
    border: 1px dashed #cbd5e1;
    border-radius: 6px;
    font-size: 12px;
    color: #64748b;
    cursor: pointer;
    transition: all 0.2s ease;
    -webkit-tap-highlight-color: transparent;
  }

  .mpc-products-toggle:active {
    background: #f1f5f9;
  }

  .mpc-products-toggle.expanded {
    background: #e0f2fe;
    border-color: #7dd3fc;
    color: #0369a1;
    margin-bottom: 6px;
  }

  .mpc-products-toggle .toggle-arrow {
    font-size: 16px;
    font-weight: 300;
    display: inline-block;
    transition: transform 0.3s ease;
    transform: rotate(0deg);
  }
  
  .mpc-products-toggle.expanded .toggle-arrow {
    transform: rotate(90deg);
  }

  /* Show mobile-only elements */
  .mobile-only {
    display: block;
  }

  /* Legacy - keep for compatibility */
  .mpc-totals {
    display: flex;
    gap: 10px;
    padding: 8px 10px;
    background: #dbeafe;
    border-radius: 6px;
    font-weight: 600;
    font-size: 12px;
    color: #0369a1;
  }

  /* Серый фон для прошедших приёмов (legacy) */
  .tone-slate .mpc-totals {
    background: #f8fafc;
    color: #64748b;
  }

  /* Meal meta row - SaaS compact style */
  .meal-meta-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 0;
    margin-top: 4px;
    border-top: 1px solid #f3f4f6;
  }

  .meal-meta-field {
    display: flex;
    align-items: center;
    gap: 2px;
    font-size: 14px;
  }

  .meal-meta-field .compact-input.tiny {
    width: 32px;
  }
  
  /* Мобильная кнопка редактирования времени */
  .mobile-time-btn {
    background: #f3f4f6;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 15px;
    font-weight: 500;
    color: #374151;
    cursor: pointer;
    min-width: 65px;
    text-align: center;
  }
  
  .mobile-time-btn:active {
    background: #e5e7eb;
  }
  
  /* Мобильная кнопка редактирования оценок */
  .mobile-mood-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background: transparent;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    padding: 4px 10px;
    cursor: pointer;
  }
  
  .mobile-mood-btn:active {
    background: #f3f4f6;
  }
  
  /* Отображение метрик на мобильных (без input) */
  .meal-meta-display {
    display: flex;
    align-items: center;
    gap: 3px;
    font-size: 14px;
  }
  
  .meal-meta-display .meta-value {
    font-weight: 500;
    min-width: 18px;
    text-align: center;
    color: #4b5563;
  }

  .meal-delete-btn {
    margin-left: auto;
    padding: 4px 8px;
    border: none;
    background: transparent;
    font-size: 16px;
    color: #9ca3af;
    cursor: pointer;
    border-radius: 4px;
  }

  .meal-delete-btn:active {
    background: #fee2e2;
    color: #dc2626;
  }

  /* === ФИОЛЕТОВАЯ ТАБЛИЦА СТАТИСТИКИ === */
  .area-main.card.tone-violet,
  .card.tone-violet {
    width: 100% !important;
    max-width: 100% !important;
    overflow: hidden !important;
  }

  .tone-violet table,
  .violet-table {
    width: 100% !important;
    table-layout: fixed !important;
  }

  .tone-violet td,
  .tone-violet th {
    padding: 6px 4px !important;
    font-size: 12px !important;
    word-break: break-word !important;
  }

  .tone-violet input {
    width: 100% !important;
    max-width: 70px !important;
    padding: 6px !important;
    font-size: 14px !important;
  }

  /* === УБИРАЕМ ГОРИЗОНТАЛЬНЫЙ СКРОЛЛ ВЕЗДЕ === */
  .page,
  .page-day,
  .day-layout,
  .card {
    max-width: 100% !important;
    overflow-x: hidden !important;
  }

  /* Все div с inline overflow:auto */
  div[style*="overflow"] {
    overflow-x: hidden !important;
    overflow-y: auto !important;
  }

  /* === СУТОЧНАЯ СВОДКА (daily-summary) === */
  .daily-summary {
    display: block !important;
    width: 100% !important;
  }

  .daily-summary thead {
    display: none !important;
  }

  .daily-summary tbody {
    display: block !important;
  }

  .daily-summary tbody tr {
    display: grid !important;
    grid-template-columns: repeat(4, 1fr) !important;
    gap: 4px !important;
    padding: 8px !important;
    border-bottom: 1px solid #e5e7eb !important;
  }

  .daily-summary tbody tr td {
    display: block !important;
    text-align: center !important;
    font-size: 12px !important;
    padding: 4px !important;
  }

  /* Скрываем лишние колонки в сводке */
  .daily-summary tbody tr td:nth-child(n+5) {
    display: none !important;
  }

  /* Первые 4 оставляем: Label, Ккал, Б, Ж, У */
  .daily-summary tbody tr td:nth-child(1),
  .daily-summary tbody tr td:nth-child(2),
  .daily-summary tbody tr td:nth-child(3),
  .daily-summary tbody tr td:nth-child(4) {
    display: block !important;
  }

  /* === ПРАВАЯ КОЛОНКА (сон, оценка, тренировки) === */
  .area-side {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
    grid-template-columns: 1fr !important;
  }

  .side-row {
    flex-direction: column !important;
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
  }

  .side-col {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    flex: none !important;
  }

  /* Зелёные карточки и grid */
  .tone-green .grid {
    width: 100% !important;
    max-width: 100% !important;
    grid-template-columns: 1fr !important;
  }

  /* Все grid-2 — одна колонка на mobile */
  .grid-2 {
    grid-template-columns: 1fr !important;
  }

  .tone-green .grid > div {
    min-width: 0 !important;
    max-width: 100% !important;
  }

  .tone-green label {
    max-width: 100% !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  .tone-green textarea {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
  }

  .tone-green input {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
  }

  /* Тренировки — в колонку на mobile */
  .trainings-wrap {
    flex-direction: column !important;
    width: 100% !important;
    max-width: 100% !important;
    overflow: hidden !important;
  }

  .trainings-wrap .card,
  .card.tone-amber {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    flex: none !important;
    box-sizing: border-box !important;
  }

  .card.tone-amber .section-title,
  .card.tone-amber .train-grid,
  .card.tone-amber .train-row,
  .card.tone-amber .train-total {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
  }

  .train-row {
    flex-wrap: wrap !important;
  }

  /* ========================================
     КРИТИЧНО: Принудительное ограничение ВСЕХ элементов
     ======================================== */
  
  /* Все карточки — максимум ширина экрана */
  .card {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
  }

  /* Все таблицы — ужимаются */
  table {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    table-layout: fixed !important;
  }

  /* Все ячейки таблиц — без min-width */
  td, th {
    min-width: 0 !important;
    max-width: none !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
  }

  /* Все input'ы — гибкие */
  input, select, textarea {
    min-width: 0 !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }

  /* Таблицы зон (Зона 1-4) — уменьшаем input'ы */
  .train-grid input {
    width: 28px !important;
    min-width: 0 !important;
    padding: 1px 2px !important;
    font-size: 10px !important;
  }

  /* Grid-контейнеры — в одну колонку или сжатые */
  .grid, .grid-2, .grid-3, .grid-4,
  .train-grid, .main-stats-grid {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
  }

  /* Суточные итоги — violet table */
  .violet-table {
    width: 100% !important;
    max-width: 100% !important;
    font-size: 11px !important;
  }

  .violet-table td:first-child {
    max-width: 80px !important;
    font-size: 10px !important;
    word-wrap: break-word !important;
  }

  .violet-table input {
    width: 40px !important;
    min-width: 0 !important;
    font-size: 11px !important;
    padding: 2px !important;
  }

  /* Фиксируем ширину контейнеров страницы */
  .page, .page-day, .wrap {
    width: 100% !important;
    max-width: 100vw !important;
    min-width: 0 !important;
    overflow-x: hidden !important;
    box-sizing: border-box !important;
  }

  /* Убираем padding от body если есть */
  body {
    overflow-x: hidden !important;
  }

  /* ===========================================
     ФАЗА 2: КОМПАКТНОСТЬ
     =========================================== */
  
  /* Компактные карточки */
  .card {
    padding: 8px !important;
  }
  
  .day-layout {
    gap: 6px;
  }
  
  .section-title {
    margin-bottom: 4px !important;
    font-size: 13px !important;
  }
  
  /* Компактные поля ввода */
  input,
  select,
  textarea {
    min-height: 36px !important;
    padding: 6px 10px !important;
    font-size: 14px !important;
  }
  
  /* Кнопки — чуть компактнее */
  .btn {
    min-height: 40px !important;
    padding: 8px 12px !important;
  }
  
  /* Зоны тренировок — компактнее */
  .train-row {
    gap: 4px !important;
    margin-bottom: 2px !important;
  }
  
  .train-grid input {
    width: 36px !important;
    height: 28px !important;
    font-size: 12px !important;
    padding: 2px 4px !important;
    min-height: 28px !important;
  }
  
  .card.tone-amber {
    padding: 6px 8px !important;
  }
  
  .card.tone-amber .section-title {
    font-size: 12px !important;
    margin-bottom: 4px !important;
  }
  
  /* Суточные итоги — компактнее */
  .violet-table td,
  .violet-table th {
    padding: 4px 3px !important;
    font-size: 11px !important;
  }
  
  .violet-table input {
    width: 45px !important;
    height: 24px !important;
    font-size: 12px !important;
    padding: 2px 4px !important;
    min-height: 24px !important;
  }
  
  /* Зелёные карточки — меньше gap */
  .card.tone-green {
    padding: 8px !important;
  }
  
  .tone-green .grid {
    gap: 6px !important;
  }
  
  .tone-green label {
    font-size: 11px !important;
    margin-bottom: 2px !important;
  }
  
  .tone-green input,
  .tone-green textarea {
    min-height: 32px !important;
    font-size: 13px !important;
  }
  
  .tone-green textarea {
    min-height: 50px !important;
  }
}

/* === METRICS CARDS (Hero Cards) === */
.metrics-cards {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  margin-top: 8px;
  margin-bottom: 8px;
}

.metrics-card {
  min-width: 0;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  padding: 8px 4px;
  text-align: center;
  transition: transform 0.15s, box-shadow 0.15s;
}

/* Анимация "прыжка" для значений при изменении */
.metrics-value {
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.metrics-card.value-changed .metrics-value {
  animation: valueBounce 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes valueBounce {
  0% { transform: scale(1); }
  50% { transform: scale(1.15); }
  100% { transform: scale(1); }
}

/* Вздрагивание карточки при сохранении */
.metrics-card.saved {
  animation: cardPulse 0.4s ease;
}

@keyframes cardPulse {
  0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
  50% { transform: scale(1.02); box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.2); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
}

/* 🔔 Shake при превышении нормы */
.metrics-card.shake-excess {
  animation: shakeCard 0.5s ease-in-out;
}

@keyframes shakeCard {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
  20%, 40%, 60%, 80% { transform: translateX(3px); }
}

/* === KCAL SPARKLINE — график калорий (стиль как вес) === */
.kcal-sparkline-container {
  grid-column: 1 / -1;
  display: block;
  background: linear-gradient(135deg, #ecfdf5 0%, #dcfce7 100%);
  border: 1px solid #bbf7d0;
  border-radius: 12px;
  padding: 12px 12px 14px;
  padding-top: 24px; /* место для аннотаций сверху */
  margin-top: 4px;
  overflow: visible; /* чтобы аннотации не обрезались */
}

.kcal-sparkline-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.kcal-sparkline-title {
  font-size: 13px;
  font-weight: 600;
  color: #166534;
}

/* Header right: badge + pills */
.kcal-header-right {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* Inline badge в header */
.kcal-goal-badge-inline {
  position: static !important;
  top: auto !important;
  right: auto !important;
  font-size: 10px;
  padding: 3px 8px;
}

.kcal-period-pills {
  display: flex;
  gap: 2px;
  background: rgba(34, 197, 94, 0.15);
  border-radius: 6px;
  padding: 2px;
}

.kcal-period-pill {
  font-size: 10px;
  font-weight: 600;
  padding: 3px 8px;
  border: none;
  border-radius: 5px;
  background: transparent;
  color: #166534;
  cursor: pointer;
  transition: all 0.2s ease;
}

.kcal-period-pill:active {
  transform: scale(0.95);
}

.kcal-period-pill.active {
  background: #ffffff;
  color: #166534;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* === SPARKLINE — мини-график калорий === */
.sparkline-container {
  display: block;
  position: relative; /* для позиционирования тултипа */
  padding: 0;
  overflow: visible; /* чтобы тултип не обрезался */
}

.sparkline-label {
  font-size: 11px;
  font-weight: 500;
  color: #64748b;
  white-space: nowrap;
}

.sparkline-svg {
  display: block;
  width: 100%;
  height: auto; /* адаптируется к inline style */
  min-height: 100px;
  overflow: visible; /* чтобы аннотации не обрезались */
}

.sparkline-area {
  opacity: 0.15;
}

.sparkline-line {
  fill: none;
  stroke: #22c55e;
  stroke-width: 3;
  stroke-linecap: round;
  stroke-linejoin: round;
  /* Анимация рисования линии — dasharray/offset задаётся inline для точной длины */
  animation: drawSparkline 3s linear forwards;
  transition: stroke-width 0.2s ease;
}

/* Hover-эффект — утолщение линии при наведении */
.sparkline-svg:hover .sparkline-line {
  stroke-width: 4;
}

/* Transition между периодами — плавная смена данных */
.sparkline-svg {
  transition: opacity 0.3s ease;
}

.sparkline-svg.transitioning {
  opacity: 0.5;
}

/* Transition между периодами */
.sparkline-transitioning {
  opacity: 0.3;
  transform: scale(0.97);
  transition: opacity 0.2s ease-out, transform 0.2s ease-out;
}

@keyframes drawSparkline {
  to {
    stroke-dashoffset: 0;
  }
}

/* Анимация заливки — появляется вместе с линией */
.sparkline-area-animated {
  opacity: 0;
  animation: fadeInArea 5s ease-in-out forwards;
}

@keyframes fadeInArea {
  0% { opacity: 0; }
  50% { opacity: 0.15; }
  100% { opacity: 1; }
}

/* Анимация точек — появляются мгновенно когда линия доходит */
.sparkline-dot {
  transition: r 0.1s ease, fill 0.1s ease;
  opacity: 0;
  transform: scale(0);
  transform-box: fill-box;
  transform-origin: center center;
  animation: dotAppear 0.08s ease-out forwards;
  animation-delay: var(--delay, 0s);
}

@keyframes dotAppear {
  0% { opacity: 0; transform: scale(0); }
  100% { opacity: 1; transform: scale(1); }
}

/* Skeleton loader для графиков */
.sparkline-skeleton {
  height: 60px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 8px;
  padding: 8px 16px;
}

.sparkline-skeleton-line {
  height: 2px;
  background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 2px;
}

.sparkline-skeleton-dots {
  display: flex;
  justify-content: space-between;
}

.sparkline-skeleton-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

@keyframes fadeInDot {
  0% { opacity: 0; transform: scale(0); }
  70% { opacity: 1; transform: scale(1.3); }
  100% { opacity: 1; transform: scale(1); }
}

.sparkline-goal {
  stroke: #94a3b8;
  stroke-dasharray: 3, 3;
  stroke-width: 1;
}

.sparkline-dot:hover {
  r: 5;
}

.sparkline-dot-ok {
  fill: #22c55e; /* зелёный — в норме */
}

.sparkline-dot-warn {
  fill: #f59e0b; /* жёлтый — немного превышено */
}

.sparkline-dot-over {
  fill: #ef4444; /* красный — сильно превышено */
}

.sparkline-dot-today {
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.15));
  animation: dotAppear 0.08s ease-out forwards, pulseDot 2s ease-in-out infinite;
  animation-delay: var(--delay, 0s), calc(var(--delay, 0s) + 0.1s);
  transform-box: fill-box;
  transform-origin: center center;
}

/* Weekend shading background */
.sparkline-weekend-bg {
  opacity: 1;
  pointer-events: none;
}

/* Goal achievement badge */
.sparkline-goal-badge {
  position: absolute;
  top: 4px;
  right: 8px;
  font-size: 10px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 8px;
  background: var(--goal-badge-bg, rgba(34, 197, 94, 0.15));
  color: var(--goal-badge-color, #22c55e);
  display: flex;
  align-items: center;
  gap: 3px;
  z-index: 5;
}

.sparkline-goal-badge.goal-low {
  --goal-badge-bg: rgba(234, 179, 8, 0.15);
  --goal-badge-color: #ca8a04;
}

.sparkline-goal-badge.goal-critical {
  --goal-badge-bg: rgba(239, 68, 68, 0.15);
  --goal-badge-color: #ef4444;
}

@keyframes pulseDot {
  0%, 100% { 
    transform: scale(1);
    filter: drop-shadow(0 0 0 rgba(34, 197, 94, 0));
  }
  50% { 
    transform: scale(1.2);
    filter: drop-shadow(0 0 6px rgba(34, 197, 94, 0.5));
  }
}

.sparkline-day-label {
  font-size: 7px;
  fill: #94a3b8;
  font-weight: 500;
}

.sparkline-day-today {
  fill: #22c55e;
  font-weight: 600;
}

/* === SPARKLINE POPUP — компактные детали при тапе на точку === */
/* Базовые стили переопределяются в v2 */
.sparkline-popup {
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  z-index: 9999;
  animation: sparklinePopupFadeIn 0.15s ease-out;
  will-change: opacity;
}

@keyframes sparklinePopupFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* === SPARKLINE POPUP V2 — консистентный с metric-popup === */
.sparkline-popup.sparkline-popup-v2 {
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15), 0 0 0 1px rgba(0,0,0,0.05);
  overflow: visible;
}

/* Скрываем старую стрелку ::after для v2 (у него своя .sparkline-popup-arrow) */
.sparkline-popup.sparkline-popup-v2::after {
  display: none;
}

.sparkline-popup-v2 .sparkline-popup-stripe {
  height: 4px;
  border-radius: 16px 16px 0 0;
}

.sparkline-popup-v2 .sparkline-popup-content {
  padding: 12px 14px 14px;
  position: relative;
}

.sparkline-popup-v2 .sparkline-popup-swipe {
  width: 32px;
  height: 4px;
  background: #e2e8f0;
  border-radius: 2px;
  margin: 0 auto 8px;
}

.sparkline-popup-v2 .sparkline-popup-header-v2 {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  padding-right: 24px;
}

.sparkline-popup-v2 .sparkline-popup-date {
  font-size: 14px;
  font-weight: 700;
  color: #1e293b;
}

.sparkline-popup-v2 .sparkline-popup-pct {
  font-size: 15px;
  font-weight: 800;
}

.sparkline-popup-v2 .sparkline-popup-perfect-title {
  font-size: 14px;
  font-weight: 700;
  color: #b45309;
}

.sparkline-popup-v2 .sparkline-popup-progress {
  height: 6px;
  background: #e2e8f0;
  border-radius: 3px;
  overflow: hidden;
  margin-bottom: 10px;
}

.sparkline-popup-v2 .sparkline-popup-progress-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.sparkline-popup-v2 .sparkline-popup-value-row {
  font-size: 15px;
  margin-bottom: 8px;
  display: flex;
  align-items: baseline;
  gap: 2px;
  flex-wrap: wrap;
}

.sparkline-popup-v2 .sparkline-popup-target {
  color: #94a3b8;
  font-weight: 400;
  font-size: 13px;
}

.sparkline-popup-v2 .sparkline-popup-compare {
  font-size: 11px;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 6px;
  background: #f1f5f9;
  color: #64748b;
  white-space: nowrap;
}

.sparkline-popup-v2 .sparkline-popup-compare.up {
  background: #dcfce7;
  color: #166534;
}

.sparkline-popup-v2 .sparkline-popup-compare.down {
  background: #fee2e2;
  color: #991b1b;
}

.sparkline-popup-v2 .sparkline-popup-motivation-v2 {
  font-size: 12px;
  color: #b45309;
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border: 1px solid #fcd34d;
  border-radius: 6px;
  padding: 6px 8px;
  margin-bottom: 8px;
  text-align: center;
}

.sparkline-popup-v2 .sparkline-popup-tags-v2 {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-bottom: 8px;
}

.sparkline-popup-v2 .sparkline-popup-tag-v2 {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  font-size: 11px;
  font-weight: 500;
  padding: 3px 6px;
  border-radius: 4px;
  background: #f1f5f9;
  color: #475569;
}

.sparkline-popup-v2 .sparkline-popup-tag-v2.good {
  background: #dcfce7;
  color: #16a34a;
}

.sparkline-popup-v2 .sparkline-popup-tag-v2.bad {
  background: #fee2e2;
  color: #dc2626;
}

.sparkline-popup-v2 .sparkline-popup-tag-v2.perfect {
  background: linear-gradient(135deg, #fef3c7, #fde68a);
  color: #92400e;
  border: 1px solid #f59e0b;
}

.sparkline-popup-v2 .sparkline-popup-btn-v2 {
  width: 100%;
  padding: 8px;
  background: #f1f5f9;
  border: none;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 500;
  color: #475569;
  cursor: pointer;
  transition: all 0.15s;
}

.sparkline-popup-v2 .sparkline-popup-btn-v2:hover {
  background: #e2e8f0;
}

.sparkline-popup-v2 .sparkline-popup-btn-v2.perfect {
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  color: #92400e;
  border: 1px solid #fcd34d;
}

.sparkline-popup-v2 .sparkline-popup-btn-v2.perfect:hover {
  background: linear-gradient(135deg, #fde68a 0%, #fcd34d 100%);
}

.sparkline-popup-v2 .sparkline-popup-close {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0, 0, 0, 0.05);
  border: none;
  font-size: 12px;
  color: #64748b;
  cursor: pointer;
  padding: 4px 6px;
  line-height: 1;
  border-radius: 6px;
  transition: all 0.15s;
}

.sparkline-popup-v2 .sparkline-popup-close:hover {
  background: rgba(0, 0, 0, 0.1);
  color: #334155;
}

.sparkline-popup-v2 .sparkline-popup-close.perfect {
  color: #92400e;
}

.sparkline-popup-v2 .sparkline-popup-arrow {
  position: absolute;
  top: -8px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-bottom: 8px solid #fff;
  filter: drop-shadow(0 -2px 2px rgba(0,0,0,0.1));
}

.sparkline-popup-v2 .sparkline-popup-arrow.left {
  left: 24px;
  transform: none;
}

.sparkline-popup-v2 .sparkline-popup-arrow.right {
  left: auto;
  right: 24px;
  transform: none;
}

.sparkline-popup-v2 .sparkline-popup-arrow.perfect {
  border-bottom-color: #fde68a;
}

/* Золотой фон для perfect popup */
.sparkline-popup-v2.sparkline-popup-perfect-v2 {
  background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
  border: 1px solid #fcd34d;
}

.sparkline-popup-v2.sparkline-popup-perfect-v2 .sparkline-popup-swipe {
  background: #fcd34d;
}

.sparkline-popup-v2.sparkline-popup-perfect-v2 .sparkline-popup-progress {
  background: #fef3c7;
}

/* Стрелка-указатель снизу попапа (для legacy, не v2) */
.sparkline-popup::after {
  content: '';
  position: absolute;
  bottom: -6px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 6px solid white;
  filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.1));
}

@keyframes popupFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.sparkline-popup-header {
  font-size: 12px;
  font-weight: 600;
  color: #1e293b;
  margin-bottom: 6px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.sparkline-popup-header .popup-pct {
  font-size: 11px;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 4px;
}
.sparkline-popup-header .popup-pct.good { background: #dcfce7; color: #16a34a; }
.sparkline-popup-header .popup-pct.warn { background: #fef3c7; color: #d97706; }
.sparkline-popup-header .popup-pct.bad { background: #fee2e2; color: #dc2626; }

/* Главная строка — калории */
.sparkline-popup-main {
  font-size: 14px;
  font-weight: 600;
  color: #1e293b;
  margin-bottom: 6px;
  letter-spacing: -0.3px;
}
.sparkline-popup-main small {
  font-size: 11px;
  font-weight: 400;
  color: #94a3b8;
}

/* Разделитель */
.sparkline-popup-divider {
  height: 1px;
  background: #f1f5f9;
  margin: 6px 0;
}

/* Секция тегов — БЖУ, сон, тренировка */
.sparkline-popup-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-bottom: 6px;
}

.sparkline-popup-tag {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  font-size: 10px;
  font-weight: 500;
  padding: 2px 5px;
  border-radius: 4px;
  background: #f1f5f9;
  color: #475569;
}
.sparkline-popup-tag.good { background: #dcfce7; color: #16a34a; }
.sparkline-popup-tag.warn { background: #fef3c7; color: #d97706; }
.sparkline-popup-tag.bad { background: #fee2e2; color: #dc2626; }

/* Золотой стиль для идеальных дней */
.sparkline-popup-tags.perfect {
  margin-top: 8px;
}
.sparkline-popup-tag.perfect { 
  background: linear-gradient(135deg, #fef3c7, #fde68a); 
  color: #92400e; 
  border: 1px solid #f59e0b;
  font-weight: 500;
}

/* Строка данных (устарело, но сохраним для perfect popup) */
.sparkline-popup-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 11px;
  padding: 2px 0;
}

.sparkline-popup-label {
  color: #64748b;
}

.sparkline-popup-value {
  font-weight: 600;
  color: #1e293b;
}

.sparkline-popup-value.good { color: #22c55e; }
.sparkline-popup-value.warn { color: #f59e0b; }
.sparkline-popup-value.bad { color: #ef4444; }

.sparkline-popup-btn {
  margin-top: 6px;
  width: 100%;
  padding: 6px;
  background: #f1f5f9;
  border: none;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 500;
  color: #475569;
  cursor: pointer;
  transition: background 0.15s;
}

.sparkline-popup-btn:hover {
  background: #e2e8f0;
}

/* Popup для идеального дня */
.sparkline-popup-perfect {
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border-color: #f59e0b;
  text-align: center;
}

.sparkline-popup-header.perfect {
  color: #b45309;
  font-size: 13px;
  justify-content: center;
}

.sparkline-popup-motivation {
  font-size: 11px;
  color: #78350f;
  margin: 4px 0;
}

.sparkline-popup-subtitle {
  font-size: 10px;
  color: #92400e;
  opacity: 0.8;
}

.sparkline-popup-hint {
  font-size: 9px;
  color: var(--text-tertiary, #71717a);
  margin-top: 4px;
  text-align: center;
  font-style: italic;
}

.sparkline-popup-forecast {
  border: 1px dashed var(--border-color, #3f3f46);
}

/* Dark mode */
[data-theme="dark"] .sparkline-popup {
  background: #1e293b;
  border-color: #334155;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
}
[data-theme="dark"] .sparkline-popup-header { color: #f1f5f9; }
[data-theme="dark"] .sparkline-popup-main { color: #f1f5f9; }
[data-theme="dark"] .sparkline-popup-main small { color: #64748b; }
[data-theme="dark"] .sparkline-popup-divider { background: #334155; }
[data-theme="dark"] .sparkline-popup-tag { background: #334155; color: #94a3b8; }
[data-theme="dark"] .sparkline-popup-btn { background: #334155; color: #94a3b8; }
[data-theme="dark"] .sparkline-popup-btn:hover { background: #475569; }

/* Dark mode: sparkline-popup-v2 */
[data-theme="dark"] .sparkline-popup-v2 {
  background: #1e293b;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-swipe {
  background: #475569;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-date {
  color: #f1f5f9;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-progress {
  background: #334155;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-target {
  color: #64748b;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-compare {
  background: #334155;
  color: #94a3b8;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-compare.up {
  background: #14532d;
  color: #4ade80;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-compare.down {
  background: #450a0a;
  color: #f87171;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-tag-v2 {
  background: #334155;
  color: #94a3b8;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-tag-v2.good {
  background: #14532d;
  color: #4ade80;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-tag-v2.bad {
  background: #450a0a;
  color: #f87171;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-tag-v2.perfect {
  background: linear-gradient(135deg, #451a03 0%, #78350f 100%);
  border-color: #92400e;
  color: #fbbf24;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-btn-v2 {
  background: #334155;
  color: #94a3b8;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-btn-v2:hover {
  background: #475569;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-btn-v2.perfect {
  background: linear-gradient(135deg, #451a03 0%, #78350f 100%);
  border-color: #92400e;
  color: #fbbf24;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-close {
  background: rgba(255, 255, 255, 0.1);
  color: #94a3b8;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-close:hover {
  background: rgba(255, 255, 255, 0.2);
  color: #f1f5f9;
}

[data-theme="dark"] .sparkline-popup-v2 .sparkline-popup-arrow {
  border-bottom-color: #1e293b;
}

[data-theme="dark"] .sparkline-popup-v2.sparkline-popup-perfect-v2 {
  background: linear-gradient(135deg, #451a03 0%, #78350f 100%);
  border-color: #92400e;
}

[data-theme="dark"] .sparkline-popup-v2.sparkline-popup-perfect-v2 .sparkline-popup-swipe {
  background: #92400e;
}

[data-theme="dark"] .sparkline-popup-v2.sparkline-popup-perfect-v2 .sparkline-popup-perfect-title {
  color: #fbbf24;
}

[data-theme="dark"] .sparkline-popup-v2.sparkline-popup-perfect-v2 .sparkline-popup-motivation-v2 {
  background: linear-gradient(135deg, #78350f 0%, #92400e 100%);
  border-color: #b45309;
  color: #fbbf24;
}

[data-theme="dark"] .sparkline-popup-v2.sparkline-popup-perfect-v2 .sparkline-popup-progress {
  background: #78350f;
}

[data-theme="dark"] .sparkline-popup-v2.sparkline-popup-perfect-v2 .sparkline-popup-arrow {
  border-bottom-color: #78350f;
}

/* === HEATMAP — мини полоска под графиком === */
.sparkline-heatmap {
  display: flex;
  gap: 2px;
  padding: 4px 16px 0;
  justify-content: space-between;
}

.sparkline-heatmap-day {
  flex: 1;
  height: 4px;
  border-radius: 2px;
  transition: transform 0.15s, opacity 0.15s;
}

.sparkline-heatmap-day:hover {
  transform: scaleY(1.5);
}

.sparkline-heatmap-day.level-0 { background: #f1f5f9; } /* нет данных */
.sparkline-heatmap-day.level-1 { background: #bbf7d0; } /* <80% */
.sparkline-heatmap-day.level-2 { background: #4ade80; } /* 80-95% */
.sparkline-heatmap-day.level-3 { background: #22c55e; } /* 95-105% - идеал */
.sparkline-heatmap-day.level-4 { background: #fde047; } /* 105-115% */
.sparkline-heatmap-day.level-5 { background: #f97316; } /* 115-130% */
.sparkline-heatmap-day.level-6 { background: #ef4444; } /* >130% */

/* === MOOD-ПОЛОСА — градиентная полоса настроения === */
.sparkline-mood-container {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  padding: 12px 4px 4px; /* уменьшили боковые отступы */
  margin-top: 4px;
  margin-left: -4px;
  margin-right: -4px;
}

.sparkline-mood-bar {
  flex: 1;
  min-width: 0; /* для корректного flex */
  height: 6px;
  border-radius: 3px;
  overflow: visible;
}

/* Современный бар оценки дня — CSS градиент вместо SVG */
.sparkline-mood-bar-modern {
  height: 8px;
  border-radius: 4px; /* pill shape */
  box-shadow: 
    inset 0 1px 2px rgba(255, 255, 255, 0.3),
    0 1px 3px rgba(0, 0, 0, 0.1);
  position: relative;
}

/* Глянцевый блик сверху */
.sparkline-mood-bar-modern::before {
  content: '';
  position: absolute;
  top: 1px;
  left: 4px;
  right: 4px;
  height: 3px;
  background: linear-gradient(to bottom, rgba(255,255,255,0.4), transparent);
  border-radius: 2px;
  pointer-events: none;
}

.sparkline-mood-label {
  font-size: 10px;
  color: #64748b;
  white-space: nowrap;
}

/* Ряд индикаторов сна под mood-bar */
.sparkline-sleep-row {
  position: relative;
  width: 100%;
  height: 14px;
  margin-top: 2px;
}

.sparkline-sleep-row .sparkline-sleep-indicator {
  position: absolute;
  transform: translateX(-50%);
  font-size: 9px;
  opacity: 0;
  animation: fadeInSleep 0.3s ease forwards;
  animation-delay: var(--delay, 0s);
}

@keyframes fadeInSleep {
  from { opacity: 0; transform: translateX(-50%) scale(0.5); }
  to { opacity: 1; transform: translateX(-50%) scale(1); }
}

/* Цвета индикаторов сна по длительности */
.sparkline-sleep-indicator.sleep-critical { 
  filter: grayscale(0) brightness(1); /* 😴 <5ч — красный оттенок */
  text-shadow: 0 0 4px rgba(239, 68, 68, 0.5);
}
.sparkline-sleep-indicator.sleep-bad { 
  filter: hue-rotate(-15deg); /* 😴 5-6ч — оранжевый оттенок */
  text-shadow: 0 0 4px rgba(249, 115, 22, 0.4);
}
.sparkline-sleep-indicator.sleep-low { 
  /* 😴 6-7ч — нормальный */
  opacity: 0.8;
}
.sparkline-sleep-indicator.sleep-good { 
  /* 💤 7-8.5ч — хорошо */
  opacity: 1;
}
.sparkline-sleep-indicator.sleep-over { 
  filter: hue-rotate(40deg); /* 😪 8.5+ч — синий оттенок (пересып) */
  text-shadow: 0 0 4px rgba(59, 130, 246, 0.4);
}

/* === Slider Elements === */
.sparkline-slider-line {
  stroke: #3b82f6;
  stroke-width: 1.5;
  stroke-dasharray: 4 2;
  opacity: 0.8;
  pointer-events: none;
}

.sparkline-slider-point {
  fill: #3b82f6;
  stroke: white;
  stroke-width: 2;
  pointer-events: none;
  filter: drop-shadow(0 2px 4px rgba(59, 130, 246, 0.4));
}

/* === TODAY LINE — вертикальная линия на текущий день === */
.sparkline-today-line {
  pointer-events: none;
  animation: sparkline-today-pulse 2s ease-in-out infinite;
}

.sparkline-today-label {
  pointer-events: none;
  animation: sparkline-today-bounce 2s ease-in-out infinite;
}

@keyframes sparkline-today-pulse {
  0%, 100% { opacity: 0.15; }
  50% { opacity: 0.25; }
}

@keyframes sparkline-today-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(2px); }
}

/* === BRUSH SELECTION — выделение диапазона === */
.sparkline-brush-overlay {
  pointer-events: none;
  animation: sparkline-brush-appear 0.15s ease-out;
}

@keyframes sparkline-brush-appear {
  from {
    opacity: 0;
    transform: scaleX(0.8);
  }
  to {
    opacity: 1;
    transform: scaleX(1);
  }
}

/* Brush Stats Badge */
.sparkline-brush-stats {
  position: absolute;
  top: 4px;
  right: 4px;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 5px 10px;
  background: rgba(59, 130, 246, 0.15);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-radius: 8px;
  font-size: 11px;
  font-weight: 500;
  color: #3b82f6;
  animation: sparkline-brush-stats-appear 0.2s ease-out;
  z-index: 5;
  cursor: pointer;
  transition: background-color 0.15s;
}

.sparkline-brush-stats:hover {
  background: rgba(59, 130, 246, 0.25);
}

.sparkline-brush-stats span {
  white-space: nowrap;
}

.sparkline-brush-stats .brush-days {
  opacity: 0.8;
}

.sparkline-brush-stats .brush-ratio {
  padding: 2px 5px;
  border-radius: 4px;
  color: white;
  font-size: 10px;
}

.sparkline-brush-stats .brush-close {
  margin-left: 2px;
  opacity: 0.6;
  transition: opacity 0.15s;
}

.sparkline-brush-stats:hover .brush-close {
  opacity: 1;
}

@keyframes sparkline-brush-stats-appear {
  from {
    opacity: 0;
    transform: translateY(-4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Zoom Indicator */
.sparkline-zoom-indicator {
  position: absolute;
  bottom: 4px;
  right: 4px;
  padding: 3px 6px;
  background: rgba(0, 0, 0, 0.5);
  border-radius: 4px;
  font-size: 10px;
  color: white;
  cursor: pointer;
  opacity: 0.8;
  transition: opacity 0.15s;
  z-index: 5;
}

.sparkline-zoom-indicator:hover {
  opacity: 1;
}

/* Zoomed state — overflow hidden */
.sparkline-container.sparkline-zoomed {
  overflow: hidden;
}

.sparkline-slider-tooltip {
  position: absolute;
  bottom: calc(100% + 6px);
  padding: 6px 10px;
  background: rgba(255, 255, 255, 0.92);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-radius: 8px;
  box-shadow: 0 3px 12px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(255, 255, 255, 0.5);
  pointer-events: none;
  z-index: 10;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  animation: sparkline-tooltip-appear 0.12s ease-out;
  min-width: 80px;
}

@keyframes sparkline-tooltip-appear {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(3px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

/* Header row: дата + badge процент */
.sparkline-slider-tooltip-header {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  width: 100%;
}

.sparkline-slider-tooltip-date {
  font-size: 10px;
  font-weight: 600;
  color: #1e293b;
}

.sparkline-slider-tooltip-ratio {
  font-size: 9px;
  font-weight: 700;
  padding: 1px 5px;
  border-radius: 3px;
}

.sparkline-slider-tooltip-ratio.ratio-ok {
  background: #dcfce7;
  color: #16a34a;
}

.sparkline-slider-tooltip-ratio.ratio-warn {
  background: #fef3c7;
  color: #d97706;
}

.sparkline-slider-tooltip-ratio.ratio-over {
  background: #fee2e2;
  color: #dc2626;
}

/* Main row: калории */
.sparkline-slider-tooltip-kcal {
  font-size: 11px;
  font-weight: 600;
  color: #1e293b;
  letter-spacing: -0.3px;
}
.sparkline-slider-tooltip-kcal small {
  font-size: 9px;
  font-weight: 400;
  color: #94a3b8;
}

/* Tags row: компактные теги */
.sparkline-slider-tooltip-tags {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 3px;
}

.sparkline-slider-tooltip-tag {
  display: inline-flex;
  align-items: center;
  gap: 1px;
  font-size: 9px;
  font-weight: 500;
  padding: 1px 4px;
  border-radius: 3px;
  background: #f1f5f9;
  color: #475569;
}
.sparkline-slider-tooltip-tag.good { background: #dcfce7; color: #16a34a; }
.sparkline-slider-tooltip-tag.warn { background: #fef3c7; color: #d97706; }
.sparkline-slider-tooltip-tag.bad { background: #fee2e2; color: #dc2626; }

/* Weekly Rhythm — вертикальные сепараторы недель */
.sparkline-week-separator {
  stroke: #e2e8f0;
  stroke-width: 1;
  stroke-dasharray: 2 2;
  opacity: 0.6;
}

/* Burn Glow — свечение тренировок */
.sparkline-burn-glow {
  fill: #f97316;
  filter: blur(4px);
  pointer-events: none;
}

/* 😴 Sleep Warning */
.sparkline-sleep-warning {
  font-size: 8px;
  opacity: 0.7;
  pointer-events: none;
}

/* === SPARKLINE ANNOTATIONS — иконки событий на графике === */
.sparkline-annotation {
  font-size: 11px;
  text-anchor: middle;
  pointer-events: none;
  opacity: 0;
  animation: fadeInAnnotation 0.25s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
  animation-delay: 4.5s; /* после рисования линии 5s */
  dominant-baseline: auto; /* рендерим корректно */
}

@keyframes fadeInAnnotation {
  0% { opacity: 0; transform: translateY(4px) scale(0.8); }
  70% { opacity: 1; transform: translateY(-1px) scale(1.05); }
  100% { opacity: 1; transform: translateY(0) scale(1); }
}

.sparkline-annotation-training {
  font-size: 10px;
  fill: #8b5cf6; /* фиолетовый для тренировок */
  opacity: 0;
  animation: fadeInSimple 0.3s ease-out forwards;
  animation-delay: var(--delay, 0s);
}

@keyframes fadeInSimple {
  0% { opacity: 0; }
  100% { opacity: 1; }
}

/* Пунктирная линия от эмодзи тренировки к точке — синхронизирована с точкой */
.sparkline-training-line {
  stroke: #a78bfa; /* светло-фиолетовый */
  stroke-width: 1;
  stroke-dasharray: 2 2;
  opacity: 0;
  animation: fadeInLine 0.3s ease-out forwards;
  animation-delay: var(--delay, 0s);
}

/* Пунктирная линия от точки к дню — синхронизирована с точкой */
.sparkline-point-line {
  stroke: #94a3b8; /* slate-400 — ярче */
  stroke-width: 1;
  stroke-dasharray: 2 2;
  opacity: 0;
  animation: fadeInPointLine 0.3s ease-out forwards;
  animation-delay: var(--delay, 0s);
}

.weight-sparkline-point-line {
  stroke: #c084fc; /* purple-400 — для веса, ярче */
}

@keyframes fadeInPointLine {
  0% { opacity: 0; }
  100% { opacity: 0.5; }
}

@keyframes fadeInLine {
  0% { opacity: 0; }
  100% { opacity: 0.5; }
}

.sparkline-annotation-holiday {
  fill: #f59e0b; /* оранжевый для праздников */
}

/* Прогнозная линия */
.sparkline-forecast-line {
  stroke: #94a3b8 !important;
  stroke-width: 1.5 !important;
  animation: none !important;
}

.sparkline-forecast-dot {
  fill: #94a3b8 !important;
  opacity: 0.5;
}

/* Золотая streak-линия между 🔥 днями */
.sparkline-streak-line {
  stroke: #f59e0b;
  stroke-width: 3;
  fill: none;
  filter: drop-shadow(0 0 4px rgba(245, 158, 11, 0.6));
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* Анимированная streak-линия — рисуется синхронно с основной */
.sparkline-streak-animated {
  animation: drawSparkline linear forwards;
  /* animationDelay и animationDuration задаются inline */
}

/* Прогнозная линия — маска для анимации пунктира */
.sparkline-forecast-mask {
  animation: drawSparkline 0.6s linear forwards;
  animation-delay: 2.9s;
}

/* Прогнозная линия веса — маска для анимации */
.weight-sparkline-forecast-mask {
  animation: drawSparkline 0.5s linear forwards;
  animation-delay: 3s; /* после основной линии веса */
}

/* Точки прогноза — появляются синхронно с прогнозной линией */
.sparkline-forecast-dot {
  animation: dotAppear 0.15s ease-out forwards;
  animation-delay: var(--delay, 3s);
}

/* Прогнозные дни — тонкий шрифт */
.sparkline-day-forecast {
  font-weight: 300 !important;
  opacity: 0.5;
  font-style: italic;
}

/* Выходные и праздники — красный */
.sparkline-day-weekend {
  fill: #ef4444 !important;
}

/* Дельта (отклонение от нормы) под каждым днём — синхронизирована с точкой */
.sparkline-delta-label {
  font-size: 10px;
  font-weight: 700;
  opacity: 0;
  animation: fadeInSimple 0.3s ease-out forwards;
  animation-delay: var(--delay, 0s);
}

/* Min/Max метки (deprecated, используется delta) */
.sparkline-minmax-label {
  font-size: 9px;
  font-weight: 600;
  fill: #64748b;
  opacity: 0;
  animation: fadeInAnnotation 0.3s ease forwards;
  animation-delay: 3.5s;
}

.sparkline-min-label {
  fill: #ef4444;
}

.sparkline-max-label {
  fill: #22c55e;
}

/* Золотые пульсирующие точки для идеальных дней */
.sparkline-dot-gold {
  fill: #fbbf24; /* золотой */
  stroke: #f59e0b;
  stroke-width: 1.5;
  opacity: 0;
  transform: scale(0);
  animation: dotAppear 0.15s ease-out forwards, pulseGold 2s ease-in-out infinite;
  animation-delay: var(--delay, 0s), calc(var(--delay, 0s) + 0.2s);
  filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.6));
  transform-box: fill-box;
  transform-origin: center center;
}

.sparkline-dot-gold-today {
  fill: #fbbf24;
  stroke: #f59e0b;
  stroke-width: 2;
  opacity: 0;
  transform: scale(0);
  animation: dotAppear 0.15s ease-out forwards, pulseGoldToday 1.5s ease-in-out infinite;
  animation-delay: var(--delay, 0s), calc(var(--delay, 0s) + 0.2s);
  filter: drop-shadow(0 0 6px rgba(251, 191, 36, 0.8));
  transform-box: fill-box;
  transform-origin: center center;
}

@keyframes popIn {
  0% { opacity: 0; transform: scale(0); }
  60% { opacity: 1; transform: scale(1.4); }
  80% { transform: scale(0.9); }
  100% { opacity: 1; transform: scale(1); }
}

@keyframes pulseGold {
  0%, 100% { 
    transform: scale(1);
    filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.5));
  }
  50% { 
    transform: scale(1.15);
    filter: drop-shadow(0 0 8px rgba(251, 191, 36, 0.8));
  }
}

@keyframes pulseGoldToday {
  0%, 100% { 
    transform: scale(1);
    filter: drop-shadow(0 0 6px rgba(251, 191, 36, 0.6));
  }
  50% { 
    transform: scale(1.25);
    filter: drop-shadow(0 0 12px rgba(251, 191, 36, 1));
  }
}

/* === CORRELATION BLOCK — связь калорий и веса === */
.correlation-block {
  grid-column: 1 / -1;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  margin-top: 4px;
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  transition: all 0.3s ease;
}

.correlation-block.positive {
  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
  border-color: #a7f3d0;
}

.correlation-block.warning {
  background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
  border-color: #fed7aa;
}

.correlation-block.mixed {
  background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%);
  border-color: #fde047;
}

.correlation-icon {
  font-size: 16px;
}

.correlation-text {
  font-size: 12px;
  font-weight: 500;
  color: #334155;
  line-height: 1.3;
}

/* Кликабельный блок корреляции */
.correlation-clickable {
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.correlation-clickable:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.correlation-clickable:active {
  transform: scale(0.98);
}

/* Анимация пульсации при обновлении данных */
@keyframes correlationPulse {
  0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
  50% { transform: scale(1.02); box-shadow: 0 0 0 8px rgba(59, 130, 246, 0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
}

.correlation-block.pulse {
  animation: correlationPulse 0.6s ease-out;
}

/* === Week Heatmap (compact) === */
.week-heatmap {
  grid-column: 1 / -1;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  padding: 8px 12px;
  margin-top: 4px;
}

.week-heatmap-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 6px;
}

.week-heatmap-title {
  font-size: 12px;
  font-weight: 600;
  color: #1e293b;
}

.week-heatmap-streak {
  font-size: 11px;
  font-weight: 600;
  color: #f59e0b;
  background: #fef3c7;
  padding: 1px 5px;
  border-radius: 6px;
}

.week-heatmap-stat {
  font-size: 11px;
  color: #64748b;
  margin-left: auto;
}

.week-heatmap-grid {
  display: flex;
  justify-content: center;
  gap: 6px;
}

.week-heatmap-day {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  cursor: pointer;
  transition: transform 0.15s ease;
}

.week-heatmap-day:hover {
  transform: translateY(-1px);
}

.week-heatmap-day:active {
  transform: scale(0.95);
}

.week-heatmap-name {
  font-size: 9px;
  color: #64748b;
  font-weight: 500;
}

.week-heatmap-day.weekend .week-heatmap-name {
  color: #94a3b8;
}

.week-heatmap-day.today .week-heatmap-name {
  color: #3b82f6;
  font-weight: 700;
}

.week-heatmap-cell {
  width: 34px;
  height: 34px;
  border-radius: 8px;
  background: #e2e8f0;
  transition: background 0.2s ease, transform 0.15s ease;
}

/* Hover эффект на ячейке */
.week-heatmap-day:not(.empty) .week-heatmap-cell:hover {
  transform: scale(1.08);
}

/* Статусы — fallback если нет inline градиента */
.week-heatmap-day.low .week-heatmap-cell:not([style*="background"]) {
  background: #eab308; /* жёлтый для low */
}

.week-heatmap-day.green .week-heatmap-cell:not([style*="background"]) {
  background: #22c55e;
}

.week-heatmap-day.perfect .week-heatmap-cell:not([style*="background"]) {
  background: #10b981;
}

.week-heatmap-day.yellow .week-heatmap-cell:not([style*="background"]) {
  background: #eab308;
}

.week-heatmap-day.red .week-heatmap-cell:not([style*="background"]) {
  background: #ef4444;
}

.week-heatmap-day.empty .week-heatmap-cell {
  background: #e2e8f0;
  opacity: 0.5;
}

/* Today ring с анимацией */
.week-heatmap-day.today .week-heatmap-cell {
  box-shadow: 0 0 0 2px #3b82f6;
  animation: todayPulse 2s ease-in-out infinite;
}

@keyframes todayPulse {
  0%, 100% { box-shadow: 0 0 0 2px #3b82f6; }
  50% { box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); }
}

/* Паттерн-инсайт */
.week-heatmap-pattern {
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid #e2e8f0;
  font-size: 11px;
  color: #64748b;
  text-align: center;
}

/* Empty state для week heatmap */
.week-heatmap-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 16px 8px;
  text-align: center;
  font-size: 13px;
  color: #64748b;
}

.week-heatmap-empty-hint {
  font-size: 11px;
  color: #94a3b8;
  margin-top: 4px;
}

/* Hover на всём блоке */
.week-heatmap:hover {
  border-color: #cbd5e1;
}

/* === WEIGHT SPARKLINE — график веса с трендом === */
.weight-sparkline-container {
  grid-column: 1 / -1;
  display: block;
  background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
  border: 1px solid #e9d5ff;
  border-radius: 12px;
  padding: 12px 12px 8px;
  margin-top: 4px;
  overflow: hidden;
  transition: background 0.4s ease, border-color 0.4s ease;
}

/* Цветовые зоны фона по тренду */
.weight-sparkline-container.trend-down {
  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
  border-color: #a7f3d0;
}

.weight-sparkline-container.trend-up {
  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
  border-color: #fecaca;
}

.weight-sparkline-container.trend-same {
  background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
  border-color: #e9d5ff;
}

/* Single point weight display (когда только 1 точка) */
.weight-single-point {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px 16px;
  text-align: center;
}

.weight-single-value {
  display: flex;
  align-items: baseline;
  gap: 4px;
}

.weight-single-number {
  font-size: 36px;
  font-weight: 700;
  color: #7c3aed;
  line-height: 1;
}

.weight-single-unit {
  font-size: 16px;
  font-weight: 500;
  color: #a78bfa;
}

.weight-single-hint {
  margin-top: 8px;
  font-size: 12px;
  color: #8b5cf6;
  opacity: 0.8;
}

.weight-sparkline-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.weight-sparkline-title {
  font-size: 13px;
  font-weight: 600;
  color: #6b21a8;
}

.weight-trend-badge {
  font-size: 12px;
  font-weight: 600;
  padding: 3px 8px;
  border-radius: 8px;
  transition: background 0.3s ease, color 0.3s ease;
}

.weight-trend-badge.down {
  background: #d1fae5;
  color: #059669;
}

.weight-trend-badge.up {
  background: #fee2e2;
  color: #dc2626;
}

.weight-trend-badge.same {
  background: #f3e8ff;
  color: #7c3aed;
}

.weight-sparkline-badges {
  display: flex;
  gap: 6px;
  align-items: center;
}

.weight-forecast-badge {
  font-size: 10px;
  font-weight: 500;
  padding: 2px 6px;
  border-radius: 6px;
  background: #f1f5f9;
  color: #64748b;
}

.weight-forecast-badge.down {
  background: #dcfce7;
  color: #15803d;
}

.weight-forecast-badge.up {
  background: #fee2e2;
  color: #b91c1c;
}

.weight-sparkline-svg {
  display: block;
  width: 100%;
  height: auto; /* адаптируется к inline style */
  min-height: 100px;
}

.weight-sparkline-area {
  opacity: 0.2;
}

.weight-sparkline-line {
  fill: none;
  stroke-width: 3;
  stroke-linecap: round;
  stroke-linejoin: round;
  transition: stroke-width 0.2s ease;
}

/* Hover-эффект для весового графика */
.weight-sparkline-svg:hover .weight-sparkline-line {
  stroke-width: 4;
}

.weight-sparkline-svg {
  transition: opacity 0.3s ease;
}

.weight-sparkline-svg.transitioning {
  opacity: 0.5;
}

/* Анимация рисования линии веса */
.weight-sparkline-line-animated {
  stroke-dasharray: 500;
  stroke-dashoffset: 500;
  animation: drawSparkline 3s linear forwards;
}

/* Цвет линии по тренду (fallback) */
.weight-sparkline-container.trend-down .weight-sparkline-line {
  stroke: #10b981;
}

.weight-sparkline-container.trend-up .weight-sparkline-line {
  stroke: #ef4444;
}

.weight-sparkline-container.trend-same .weight-sparkline-line {
  stroke: #8b5cf6;
}

.weight-sparkline-dot {
  transition: r 0.15s ease, fill 0.15s ease;
  /* Цвет задаётся inline через style */
}

.weight-sparkline-dot:hover {
  r: 5;
  filter: brightness(1.1);
}

.weight-sparkline-dot-today {
  stroke: white;
  stroke-width: 1.5;
  animation: dotAppear 0.08s ease-out forwards, pulseDotWeight 2s ease-in-out infinite;
  animation-delay: var(--delay, 0s), calc(var(--delay, 0s) + 0.1s);
  transform-box: fill-box;
  transform-origin: center center;
}

@keyframes pulseDotWeight {
  0%, 100% { 
    transform: scale(1);
    filter: drop-shadow(0 0 0 rgba(139, 92, 246, 0));
  }
  50% { 
    transform: scale(1.2);
    filter: drop-shadow(0 0 6px rgba(139, 92, 246, 0.5));
  }
}

.weight-sparkline-day-label {
  font-size: 8px;
  fill: #94a3b8;
  font-weight: 400;
}

.weight-sparkline-weight-label {
  font-size: 8px;
  fill: #94a3b8;
  font-weight: 400;
}

.weight-sparkline-day-today {
  fill: #64748b;
  font-weight: 500;
}

.weight-sparkline-label {
  font-size: 9px;
  fill: #a78bfa;
  font-weight: 500;
}

.weight-sparkline-label-today {
  fill: #7c3aed;
  font-weight: 600;
}

/* === GOAL PROGRESS BAR (современный статус-бар) === */
.goal-progress-bar {
  grid-column: 1 / -1;
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  padding: 12px 16px;
  margin-top: 4px;
  position: relative;
  transition: box-shadow 0.3s ease, transform 0.1s ease;
}

/* ⭐ Pulse на "Идеально" (ratio 0.9-1.1) */
.goal-progress-bar.pulse-perfect {
  animation: pulsePerfect 2s ease-in-out infinite;
  border-color: #10b981;
  box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4);
}

@keyframes pulsePerfect {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4);
    border-color: #10b981;
  }
  50% {
    box-shadow: 0 0 0 8px rgba(16, 185, 129, 0), 0 0 20px rgba(16, 185, 129, 0.3);
    border-color: #34d399;
  }
}

/* 🔔 Shake на превышение (ratio > 1.25) */
.goal-progress-bar.shake-excess {
  animation: shakeExcess 0.5s ease-in-out;
  border-color: #ef4444;
  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
}

@keyframes shakeExcess {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
  20%, 40%, 60%, 80% { transform: translateX(3px); }
}

.goal-progress-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.goal-progress-title {
  font-size: 13px;
  font-weight: 600;
  color: #334155;
}

.goal-progress-stats {
  display: flex;
  align-items: baseline;
  gap: 2px;
}

.goal-eaten {
  font-size: 16px;
  font-weight: 700;
  color: #0ea5e9;
}

.goal-divider {
  font-size: 14px;
  color: #94a3b8;
  margin: 0 2px;
}

.goal-target {
  font-size: 14px;
  font-weight: 500;
  color: #64748b;
}

.goal-unit {
  font-size: 11px;
  color: #94a3b8;
  margin-left: 4px;
}

.goal-progress-track {
  position: relative;
  height: 10px;
  border-radius: 5px;
}

/* Серый фон только до маркера при переборе */
.goal-progress-track::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 100%;
  background: #e2e8f0;
  border-radius: 5px;
  z-index: 0;
}

.goal-progress-fill {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
  border-radius: 5px 0 0 5px;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 1;
}

@keyframes progressFillIn {
  from {
    transform: scaleX(0);
    opacity: 0.5;
  }
  to {
    transform: scaleX(1);
    opacity: 1;
  }
}

.goal-progress-fill.over {
  background: linear-gradient(90deg, #f97316 0%, #ef4444 100%);
}

/* Красная часть — перебор калорий */
.goal-progress-over {
  position: absolute;
  top: 0;
  height: 100%;
  background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
  border-radius: 0 5px 5px 0;
  z-index: 2;
}

.goal-marker {
  position: absolute;
  right: 0;
  top: -3px;
  width: 3px;
  height: 16px;
  background: #334155;
  border-radius: 2px;
  z-index: 10;
  transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Маркер при переборе — позиционирование через left вместо right */
.goal-marker.over {
  right: auto;
  transform: translateX(-50%);
}

.goal-progress-footer {
  margin-top: 8px;
  font-size: 14px;
  color: #64748b;
  text-align: center;
}

.goal-remaining b {
  color: #22c55e;
  font-weight: 700;
  font-size: 16px;
}

.goal-over b {
  color: #ef4444;
  font-weight: 700;
  font-size: 16px;
}

/* === MACRO + WEIGHT ROW (контейнер для колец и веса) === */
.macro-weight-row {
  display: flex;
  align-items: stretch;
  gap: 8px;
  margin-top: 8px;
  width: 100%;
  grid-column: 1 / -1;
}

/* === MACRO RINGS (БЖУ в стиле Apple Watch) === */
.macro-rings {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 2px;
  padding: 6px 0;
  background: transparent;
  border: none;
  border-radius: 0;
  flex: 1;
}

.macro-ring-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  flex: 1;
  min-width: 0;
  max-width: 70px;
}

.macro-ring {
  position: relative;
  width: 44px;
  height: 44px;
}

.macro-ring-svg {
  transform: rotate(-90deg);
  width: 100%;
  height: 100%;
}

.macro-ring-bg {
  fill: none;
  stroke: #e5e7eb;
  stroke-width: 3;
}

.macro-ring-fill {
  fill: none;
  stroke-width: 3;
  stroke-linecap: round;
  transition: stroke-dasharray 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  animation: ringFillIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes ringFillIn {
  from {
    stroke-dasharray: 0 100;
    opacity: 0.5;
  }
  to {
    opacity: 1;
  }
}

/* Цвета для каждого макроса */
.macro-ring.protein .macro-ring-fill {
  stroke: #ef4444;
}

.macro-ring.fat .macro-ring-fill {
  stroke: #f59e0b;
}

.macro-ring.carbs .macro-ring-fill {
  stroke: #22c55e;
}

.macro-ring-value {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 13px;
  font-weight: 700;
  color: #334155;
  text-align: center;
  white-space: nowrap;
  display: flex;
  align-items: center;
  justify-content: center;
}

.macro-ring-label {
  font-size: 11px;
  font-weight: 600;
  color: #334155;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 2px;
  line-height: 1;
}

.macro-ring-target {
  font-size: 10px;
  color: #94a3b8;
}

.macro-ring-badges {
  display: flex;
  gap: 4px;
  justify-content: center;
  min-height: 16px;
}

.macro-ring-badge {
  font-size: 12px;
  line-height: 1;
  cursor: pointer;
  transition: transform 0.15s ease;
}

.macro-ring-badge:active {
  transform: scale(1.3);
}

/* === MACRO BADGE POPUP === */
.macro-badge-popup {
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18), 0 2px 8px rgba(0, 0, 0, 0.1);
  min-width: 200px;
  max-width: 240px;
  z-index: 1000;
  animation: popupFadeIn 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
  overflow: hidden;
  position: relative;
  touch-action: pan-y;
}

/* Цветная полоса сверху */
.macro-badge-popup-stripe {
  height: 4px;
  width: 100%;
}

/* Контент popup */
.macro-badge-popup-content {
  padding: 10px 14px 14px;
}

/* Стрелка-указатель */
.macro-badge-popup-arrow {
  position: absolute;
  top: -8px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-bottom: 8px solid #fff;
  filter: drop-shadow(0 -2px 2px rgba(0,0,0,0.1));
}

.macro-badge-popup-arrow.left {
  left: 24px;
  transform: none;
}

.macro-badge-popup-arrow.right {
  left: auto;
  right: 24px;
  transform: none;
}

@keyframes popupFadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.macro-badge-popup-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  padding-right: 24px;
}

.macro-badge-popup-title {
  font-size: 14px;
  font-weight: 700;
  color: #1e293b;
}

.macro-badge-popup-pct {
  font-size: 15px;
  font-weight: 800;
}

/* Прогресс-бар */
.macro-badge-popup-progress {
  height: 6px;
  background: #e2e8f0;
  border-radius: 3px;
  overflow: hidden;
  margin-bottom: 10px;
}

.macro-badge-popup-progress-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* 💫 Анимация count-up для чисел */
.macro-badge-popup-animated {
  animation: macroCountUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.macro-badge-popup-animated-bar {
  animation: macroBarFill 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes macroCountUp {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes macroBarFill {
  from {
    width: 0 !important;
  }
}

/* 📊 Мини-sparkline */
.macro-badge-popup-sparkline {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 8px;
  padding: 6px 8px;
  background: #f8fafc;
  border-radius: 6px;
}

.macro-badge-popup-spark-svg {
  width: 70px;
  height: 20px;
  flex-shrink: 0;
}

.macro-badge-popup-spark-label {
  font-size: 10px;
  color: #94a3b8;
  white-space: nowrap;
}

.macro-badge-popup-spark-today {
  animation: sparkPulse 1.5s ease-in-out infinite;
}

@keyframes sparkPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

/* ⏰ Динамическое сообщение по времени */
.macro-badge-popup-time-msg {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  color: #64748b;
  margin-bottom: 8px;
  padding: 4px 0;
}

/* 🏆 Streak макроса */
.macro-badge-popup-streak {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: #d97706;
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border: 1px solid #fcd34d;
  border-radius: 6px;
  padding: 6px 8px;
  margin-bottom: 8px;
  animation: streakGlow 2s ease-in-out infinite;
}

.macro-badge-popup-streak-icon {
  font-size: 14px;
}

@keyframes streakGlow {
  0%, 100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); }
  50% { box-shadow: 0 0 8px 2px rgba(251, 191, 36, 0.3); }
}

.macro-badge-popup-value {
  font-size: 15px;
  margin-bottom: 10px;
  display: flex;
  align-items: baseline;
  gap: 2px;
  flex-wrap: wrap;
}

.macro-badge-popup-norm {
  color: #94a3b8;
  font-weight: 400;
  font-size: 13px;
}

/* 📊 Сравнение со вчера */
.macro-badge-popup-compare {
  font-size: 11px;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 6px;
  background: #f1f5f9;
  color: #64748b;
  white-space: nowrap;
}

.macro-badge-popup-compare.up {
  background: #dcfce7;
  color: #166534;
}

.macro-badge-popup-compare.down {
  background: #fee2e2;
  color: #991b1b;
}

.macro-badge-popup-desc {
  display: flex;
  flex-direction: column;
  gap: 6px;
  border-top: 1px solid #f1f5f9;
  padding-top: 10px;
  margin-top: 2px;
}

.macro-badge-popup-item {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  font-size: 12px;
  color: #475569;
  line-height: 1.4;
}

.macro-badge-popup-emoji {
  font-size: 14px;
  flex-shrink: 0;
}

/* Рекомендация продукта */
.macro-badge-popup-rec {
  background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
  border-radius: 8px;
  padding: 8px 10px;
  margin-top: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: #166534;
  border: 1px solid #bbf7d0;
}

.macro-badge-popup-rec-icon {
  font-size: 16px;
}

.macro-badge-popup-rec-text b {
  font-weight: 600;
}

.macro-badge-popup-close {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0, 0, 0, 0.05);
  border: none;
  font-size: 12px;
  color: #64748b;
  cursor: pointer;
  padding: 4px 6px;
  line-height: 1;
  border-radius: 6px;
  transition: all 0.15s;
}

.macro-badge-popup-close:hover {
  background: rgba(0, 0, 0, 0.1);
  color: #334155;
}

.macro-badge-popup-close:active {
  transform: scale(0.95);
}

/* Swipe indicator */
.macro-badge-popup-swipe {
  width: 32px;
  height: 4px;
  background: #e2e8f0;
  border-radius: 2px;
  margin: 0 auto 8px;
}

/* ====================================
   METRIC POPUP (вода, шаги, калории)
   ==================================== */

.metric-popup {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15), 0 0 0 1px rgba(0,0,0,0.05);
  animation: popupFadeIn 0.2s ease-out;
  overflow: visible;
  z-index: 9999;
}

.metric-popup-stripe {
  height: 4px;
  border-radius: 16px 16px 0 0;
}

.metric-popup-content {
  padding: 12px 14px 14px;
  position: relative;
}

.metric-popup-swipe {
  width: 32px;
  height: 4px;
  background: #e2e8f0;
  border-radius: 2px;
  margin: 0 auto 8px;
}

.metric-popup-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  padding-right: 24px;
}

.metric-popup-title {
  font-size: 14px;
  font-weight: 700;
  color: #1e293b;
}

.metric-popup-pct {
  font-size: 15px;
  font-weight: 800;
}

/* Sparkline */
.metric-popup-sparkline {
  position: relative;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.metric-popup-spark-svg {
  flex: 1;
  height: 20px;
}

.metric-popup-spark-label {
  font-size: 10px;
  color: #94a3b8;
  white-space: nowrap;
}

/* Progress bar */
.metric-popup-progress {
  height: 6px;
  background: #e2e8f0;
  border-radius: 3px;
  overflow: hidden;
  margin-bottom: 10px;
}

.metric-popup-progress-fill {
  height: 100%;
  border-radius: 3px;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Value */
.metric-popup-value {
  font-size: 15px;
  margin-bottom: 8px;
  display: flex;
  align-items: baseline;
  gap: 2px;
  flex-wrap: wrap;
}

.metric-popup-goal {
  color: #94a3b8;
  font-weight: 400;
  font-size: 13px;
}

.metric-popup-compare {
  font-size: 11px;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 6px;
  background: #f1f5f9;
  color: #64748b;
  white-space: nowrap;
}

.metric-popup-compare.up {
  background: #dcfce7;
  color: #166534;
}

.metric-popup-compare.down {
  background: #fee2e2;
  color: #991b1b;
}

/* Extra info */
.metric-popup-extra {
  font-size: 12px;
  color: #64748b;
  margin-bottom: 8px;
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.metric-popup-extra b {
  font-weight: 600;
  color: #1e293b;
}

/* Streak */
.metric-popup-streak {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: #d97706;
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border: 1px solid #fcd34d;
  border-radius: 6px;
  padding: 6px 8px;
  margin-bottom: 8px;
  animation: streakGlow 2s ease-in-out infinite;
}

/* Reminder */
.metric-popup-reminder {
  font-size: 12px;
  color: #ea580c;
  background: #fff7ed;
  border: 1px solid #fed7aa;
  border-radius: 6px;
  padding: 6px 8px;
  margin-top: 4px;
}

/* Close button */
.metric-popup-close {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0, 0, 0, 0.05);
  border: none;
  font-size: 12px;
  color: #64748b;
  cursor: pointer;
  padding: 4px 6px;
  line-height: 1;
  border-radius: 6px;
  transition: all 0.15s;
}

.metric-popup-close:hover {
  background: rgba(0, 0, 0, 0.1);
  color: #334155;
}

.metric-popup-close:active {
  transform: scale(0.95);
}

/* Arrow */
.metric-popup-arrow {
  position: absolute;
  top: -8px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-bottom: 8px solid #fff;
  filter: drop-shadow(0 -2px 2px rgba(0,0,0,0.1));
}

.metric-popup-arrow.left {
  left: 24px;
  transform: none;
}

.metric-popup-arrow.right {
  left: auto;
  right: 24px;
  transform: none;
}

.macro-ring-percent {
  font-size: 10px;
  font-weight: 600;
  color: #64748b;
  background: rgba(100, 116, 139, 0.1);
  padding: 1px 4px;
  border-radius: 4px;
  margin-top: 2px;
}

/* Пульсирующая анимация для критических значений */
.macro-ring-pulse {
  animation: macroPulse 1.5s ease-in-out infinite;
}

@keyframes macroPulse {
  0%, 100% { 
    opacity: 1;
    transform: scale(1);
  }
  50% { 
    opacity: 0.7;
    transform: scale(1.05);
  }
}

/* === MACRO TIP — умная подсказка по БЖУ === */
.macro-tip {
  grid-column: 1 / -1;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  border-radius: 10px;
  font-size: 12px;
  margin-top: 4px;
  animation: fadeInUp 0.3s ease-out;
}

.macro-tip-icon {
  font-size: 14px;
  flex-shrink: 0;
}

.macro-tip-text {
  color: #334155;
  line-height: 1.3;
}

/* Тип: белок */
.macro-tip-protein {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.08) 0%, rgba(248, 113, 113, 0.12) 100%);
  border: 1px solid rgba(239, 68, 68, 0.2);
}

/* Тип: жиры */
.macro-tip-fat {
  background: linear-gradient(135deg, rgba(245, 158, 11, 0.08) 0%, rgba(251, 191, 36, 0.12) 100%);
  border: 1px solid rgba(245, 158, 11, 0.2);
}

/* Тип: углеводы */
.macro-tip-carbs {
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(96, 165, 250, 0.12) 100%);
  border: 1px solid rgba(59, 130, 246, 0.2);
}

/* Тип: успех */
.macro-tip-success {
  background: linear-gradient(135deg, rgba(34, 197, 94, 0.08) 0%, rgba(74, 222, 128, 0.12) 100%);
  border: 1px solid rgba(34, 197, 94, 0.2);
}

/* Тип: пустой день */
.macro-tip-empty {
  background: linear-gradient(135deg, rgba(100, 116, 139, 0.06) 0%, rgba(148, 163, 184, 0.1) 100%);
  border: 1px solid rgba(100, 116, 139, 0.15);
}

/* === WEIGHT CARD MODERN (стиль как у goal progress bar) === */
.weight-card-modern {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
  gap: 2px;
  padding: 6px 8px;
  background: linear-gradient(135deg, rgba(34, 197, 94, 0.08) 0%, rgba(16, 185, 129, 0.12) 100%);
  border: 1px solid rgba(34, 197, 94, 0.2);
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 58px;
  max-width: 58px;
}

.weight-card-modern:hover {
  background: linear-gradient(135deg, rgba(34, 197, 94, 0.12) 0%, rgba(16, 185, 129, 0.18) 100%);
  border-color: rgba(34, 197, 94, 0.3);
}

.weight-card-modern:active {
  transform: scale(0.98);
}

.weight-card-modern.weight-card-empty {
  background: linear-gradient(135deg, rgba(251, 146, 60, 0.08) 0%, rgba(249, 115, 22, 0.12) 100%);
  border-color: rgba(251, 146, 60, 0.3);
  animation: pulse-weight 2s ease-in-out infinite;
}

.weight-card-left {
  display: flex;
  align-items: center;
}

.weight-card-label {
  font-size: 10px;
  font-weight: 600;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.weight-card-row {
  display: flex;
  flex-direction: row;
  align-items: baseline;
  gap: 2px;
}

.weight-card-value {
  display: flex;
  align-items: baseline;
  gap: 2px;
}

.weight-value-number {
  font-size: 18px;
  font-weight: 700;
  color: #166534;
}

.weight-card-empty .weight-value-number {
  color: #c2410c;
  font-size: 16px;
}

.weight-value-unit {
  font-size: 13px;
  font-weight: 600;
  color: #64748b;
  margin-left: 2px;
}

.weight-card-bottom-row {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 2px;
}

.weight-card-trend {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 2px;
  font-size: 11px;
  font-weight: 600;
}

/* Контейнер тренда с DEV кнопкой */
.weight-trend-row {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 6px;
  margin-top: 2px;
}

/* DEV: Мини-кнопка очистки веса */
.dev-clear-weight-mini {
  width: 14px;
  height: 14px;
  min-width: 14px;
  padding: 0;
  border: none;
  border-radius: 50%;
  background: rgba(107, 114, 128, 0.2);
  color: #6b7280;
  font-size: 10px;
  line-height: 1;
  cursor: pointer;
  opacity: 0.5;
  transition: all 0.15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.dev-clear-weight-mini:hover {
  opacity: 1;
  background: rgba(220, 38, 38, 0.2);
  color: #dc2626;
}

.weight-clear-btn-mini {
  width: 14px;
  height: 14px;
  padding: 0;
  border: none;
  border-radius: 50%;
  background: rgba(220, 38, 38, 0.15);
  color: #dc2626;
  font-size: 10px;
  line-height: 1;
  cursor: pointer;
  opacity: 0.5;
  transition: all 0.15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.weight-clear-btn-mini:hover {
  opacity: 1;
  background: rgba(220, 38, 38, 0.25);
}

.trend-arrow {
  font-size: 10px;
}

.weight-card-trend.trend-down {
  color: #16a34a;
}

.weight-card-trend.trend-up {
  color: #dc2626;
}

.weight-card-trend.trend-same {
  color: #64748b;
}

/* === DEFICIT CARD === */
.deficit-card-modern {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
  gap: 2px;
  padding: 6px 8px;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(139, 92, 246, 0.12) 100%);
  border: 1px solid rgba(99, 102, 241, 0.2);
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 58px;
  max-width: 58px;
}

.deficit-card-modern:hover {
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.12) 0%, rgba(139, 92, 246, 0.18) 100%);
  border-color: rgba(99, 102, 241, 0.3);
}

.deficit-card-modern:active {
  transform: scale(0.98);
}

.deficit-value-number {
  font-size: 18px;
  font-weight: 700;
  color: #4f46e5;
}

.deficit-value-number.deficit-negative {
  color: #16a34a;
}

.deficit-value-number.deficit-positive {
  color: #f59e0b;
}

/* Deficit trend (разница от профиля) */
.deficit-card-trend {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 2px;
  font-size: 11px;
  font-weight: 600;
  margin-top: 2px;
}

.deficit-card-trend.trend-down {
  color: #16a34a;
}

.deficit-card-trend.trend-up {
  color: #f59e0b;
}

/* === DEFICIT PICKER MODAL === */
.deficit-picker-modal {
  max-width: 280px;
}

.deficit-picker-hint {
  font-size: 12px;
  color: #64748b;
  text-align: center;
  padding: 12px 16px 8px;
  line-height: 1.4;
}

.deficit-wheels {
  justify-content: center;
  padding-bottom: 16px;
}

/* === HOUSEHOLD (Бытовая активность) PICKER === */
.activity-cards-row {
  display: flex;
  gap: 8px;
  margin-bottom: 8px;
}

/* Правая колонка: быт + кнопка */
.activity-right-col {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.household-activity-card {
  flex: 1;
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 12px 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  display: flex;
  flex-direction: column;
}

.household-activity-card:hover {
  border-color: #22c55e;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15);
}

.household-activity-card:active {
  transform: translateY(0);
}

.household-activity-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 6px;
}

.household-activity-icon {
  font-size: 16px;
}

.household-activity-title {
  font-size: 12px;
  font-weight: 600;
  color: #166534;
}

.household-activity-value {
  display: flex;
  align-items: center;
  gap: 4px;
  flex-wrap: wrap;
}

.household-value-number {
  font-size: 26px;
  font-weight: 700;
  color: #16a34a;
  line-height: 1;
}

.household-value-unit {
  font-size: 13px;
  color: #15803d;
  font-weight: 500;
}

.household-value-kcal {
  font-size: 12px;
  color: #22c55e;
  font-weight: 500;
  margin-top: 2px;
}

.household-activity-hint {
  font-size: 12px;
  color: #94a3b8;
  margin-top: auto;
  padding-top: 8px;
}

/* Кнопка добавления тренировки в правой колонке */
.add-training-btn {
  padding: 14px 12px;
  border: 1px dashed #f97316;
  background: rgba(249, 115, 22, 0.08);
  color: #ea580c;
  border-radius: 10px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s ease;
  white-space: nowrap;
}

.add-training-btn:hover {
  border-color: #ea580c;
  color: #c2410c;
  background: rgba(249, 115, 22, 0.15);
}

.add-training-btn:active {
  transform: scale(0.98);
}

.household-activity-card:active {
  transform: translateY(0);
}

.household-activity-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}

.household-activity-icon {
  font-size: 18px;
}

.household-activity-title {
  font-size: 14px;
  font-weight: 600;
  color: #166534;
}

.household-activity-value {
  display: flex;
  align-items: baseline;
  gap: 4px;
}

.household-value-number {
  font-size: 28px;
  font-weight: 700;
  color: #16a34a;
}

.household-value-unit {
  font-size: 14px;
  color: #15803d;
  font-weight: 500;
}

.household-value-kcal {
  font-size: 12px;
  color: #22c55e;
  margin-left: 8px;
  font-weight: 500;
}

/* === FORMULA CARD (Расчёт калорий) === */
.formula-card {
  flex: 1;
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 12px 16px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.formula-card-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px;
}

.formula-card-icon {
  font-size: 16px;
}

.formula-card-title {
  font-size: 14px;
  font-weight: 600;
  color: #374151;
}

.formula-card-rows {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.formula-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
}

.formula-label {
  color: #6b7280;
}

.formula-value {
  font-weight: 600;
  color: #374151;
}

.formula-row.formula-total {
  margin-top: 6px;
  padding-top: 6px;
  border-top: 1px solid #e5e7eb;
}

.formula-row.formula-total .formula-label {
  font-weight: 600;
  color: #374151;
}

.formula-row.formula-total .formula-value {
  font-size: 16px;
  color: #16a34a;
  font-weight: 700;
}

.formula-row.formula-subtotal {
  margin-top: 4px;
  padding-top: 4px;
  border-top: 1px dashed #e5e7eb;
}

.formula-row.formula-subtotal .formula-label {
  font-weight: 500;
  color: #6b7280;
}

.formula-row.formula-subtotal .formula-value {
  font-weight: 600;
  color: #374151;
}

.formula-row.deficit .formula-label {
  color: #dc2626;
}

.formula-row.deficit .formula-value {
  color: #dc2626;
  font-weight: 600;
}

.formula-row.surplus .formula-label {
  color: #16a34a;
}

.formula-row.surplus .formula-value {
  color: #16a34a;
  font-weight: 600;
}

.household-picker-modal {
  max-width: 300px;
}

.household-picker-hint {
  font-size: 13px;
  color: #64748b;
  text-align: center;
  padding: 12px 16px 8px;
  line-height: 1.5;
}

.household-wheels {
  justify-content: center;
  padding-bottom: 16px;
  gap: 8px;
}

.household-wheel-unit {
  font-size: 20px;
  font-weight: 600;
  color: #16a34a;
  align-self: center;
  margin-left: 8px;
}

/* Zone Minutes Picker */
.zone-picker-modal {
  max-width: 260px;
}

.zone-picker-kcal-hint {
  text-align: center;
  font-size: 18px;
  font-weight: 600;
  color: #f97316;
  padding: 8px 0 4px;
}

.zone-wheels {
  justify-content: center;
  padding-bottom: 16px;
}

/* Training Picker Modal */
.training-picker-modal {
  max-width: 340px;
  width: 95vw;
}

.training-type-section {
  padding: 12px 16px 8px;
}

.training-type-label {
  font-size: 13px;
  font-weight: 500;
  color: #64748b;
  margin-bottom: 8px;
  display: block;
}

.training-type-buttons {
  display: flex;
  gap: 8px;
}

.training-type-btn {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 12px 8px;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  background: #fff;
  cursor: pointer;
  transition: all 0.15s ease;
}

.training-type-btn:active {
  transform: scale(0.95);
}

.training-type-btn.active {
  border-color: #f97316;
  background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
}

.training-type-icon {
  font-size: 24px;
}

.training-type-text {
  font-size: 11px;
  font-weight: 500;
  color: #64748b;
}

.training-type-btn.active .training-type-text {
  color: #ea580c;
  font-weight: 600;
}

.training-time-section {
  padding: 8px 16px 0;
}

.training-time-label {
  font-size: 13px;
  font-weight: 500;
  color: #64748b;
  margin-bottom: 4px;
  display: block;
  text-align: center;
}

.training-time-wheels {
  justify-content: center;
  padding-bottom: 8px;
}

/* Compact train time display */
.compact-train-time {
  font-size: 12px;
  color: #64748b;
  background: #f1f5f9;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 4px;
}

/* Make compact-train-header clickable */
.compact-train-header {
  cursor: pointer;
  transition: background 0.15s;
}

.compact-train-header:active {
  background: #f8fafc;
}

/* Training Zones Section in Modal */
.training-zones-section {
  padding: 12px 8px 16px;
}

.training-zones-label {
  font-size: 14px;
  font-weight: 500;
  color: #64748b;
  margin-bottom: 12px;
  text-align: center;
}

.training-zones-wheels {
  display: flex;
  justify-content: center;
  gap: 2px;
}

.training-zone-column {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 72px;
}

.training-zone-header {
  font-size: 12px;
  font-weight: 600;
  padding: 4px 8px;
  border-radius: 6px;
  margin-bottom: 4px;
}

.training-zone-header.zone-color-1 { background: #dbeafe; color: #2563eb; }
.training-zone-header.zone-color-2 { background: #dcfce7; color: #16a34a; }
.training-zone-header.zone-color-3 { background: #fef3c7; color: #d97706; }
.training-zone-header.zone-color-4 { background: #fee2e2; color: #dc2626; }

.training-zone-column .wheel-column {
  width: 70px;
}

.training-zone-column .wheel-viewport {
  height: 220px;
}

.training-zones-kcal {
  text-align: center;
  font-size: 16px;
  font-weight: 600;
  color: #f97316;
  padding: 8px 0 4px;
}

/* Training zones stats (time + kcal) */
.training-zones-stats {
  display: flex;
  justify-content: center;
  gap: 16px;
  padding: 12px 0 8px;
}

.training-zones-time {
  font-size: 16px;
  font-weight: 600;
  color: #3b82f6;
}

.training-zones-stats .training-zones-kcal {
  padding: 0;
}

/* Training presets */
.training-presets-section {
  padding: 8px 16px 12px;
  border-top: 1px solid #e5e7eb;
}

.training-presets-label {
  font-size: 13px;
  font-weight: 500;
  color: #64748b;
  margin-bottom: 8px;
  text-align: center;
}

.training-presets-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

.training-preset-btn {
  padding: 10px 12px;
  font-size: 13px;
  font-weight: 500;
  color: #374151;
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s;
  text-align: left;
}

.training-preset-btn:active {
  transform: scale(0.97);
  background: #f1f5f9;
}

/* Shake animation for validation */
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-8px); }
  40%, 80% { transform: translateX(8px); }
}

.training-zones-section.shake {
  animation: shake 0.5s ease-in-out;
}

/* === Training Rating Section (Step 3) === */
.training-rating-section {
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.training-rating-row {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.training-rating-header {
  display: flex;
  align-items: center;
  gap: 8px;
}

.training-rating-emoji {
  font-size: 24px;
}

.training-rating-label {
  flex: 1;
  font-size: 14px;
  font-weight: 500;
  color: #374151;
}

.training-rating-value {
  font-size: 16px;
  font-weight: 600;
  min-width: 50px;
  text-align: right;
}

.training-rating-presets {
  display: flex;
  gap: 8px;
}

.training-rating-presets .mood-preset {
  flex: 1;
  font-size: 12px;
  padding: 8px 10px;
}

/* Training Comment Block */
.training-comment-wrapper {
  margin: 0 16px 16px;
  transition: all 0.3s ease;
}

.training-comment-prompt {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 12px 14px;
  border-radius: 14px;
  transition: all 0.3s ease;
}

.training-comment-prompt.neutral {
  background: rgba(156, 163, 175, 0.08);
  border: 1px solid rgba(156, 163, 175, 0.15);
}

.training-comment-prompt.positive {
  background: rgba(16, 185, 129, 0.08);
  border: 1px solid rgba(16, 185, 129, 0.15);
}

.training-comment-prompt.negative {
  background: rgba(239, 68, 68, 0.08);
  border: 1px solid rgba(239, 68, 68, 0.15);
}

.training-comment-prompt .training-comment-icon {
  font-size: 20px;
}

.training-comment-prompt .training-comment-text {
  font-size: 13px;
  font-weight: 500;
  color: #6b7280;
}

.training-comment-prompt.positive .training-comment-text {
  color: #059669;
}

.training-comment-prompt.negative .training-comment-text {
  color: #dc2626;
}

.training-comment-input {
  width: 100%;
  border: none;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 8px;
  padding: 10px 12px;
  font-size: 14px;
  color: #1c1c1e;
  outline: none;
}

.training-comment-input::placeholder {
  color: #9ca3af;
}

.training-comment-input:focus {
  background: #fff;
  box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
}

/* Training Card Rating Display */
.training-card-ratings {
  display: flex;
  gap: 8px;
  margin-top: 8px;
  flex-wrap: wrap;
}

.training-card-rating {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  background: rgba(99, 102, 241, 0.08);
  border-radius: 8px;
  font-size: 12px;
}

.training-card-rating-emoji {
  font-size: 14px;
}

.training-card-rating-value {
  font-weight: 600;
  color: #6366f1;
}

.training-card-comment {
  margin-top: 8px;
  padding: 8px 10px;
  background: rgba(156, 163, 175, 0.08);
  border-radius: 8px;
  font-size: 12px;
  color: #6b7280;
  font-style: italic;
}

/* Clickable zone values */
.zone-clickable {
  cursor: pointer;
  transition: transform 0.1s;
}

.zone-clickable:active {
  transform: scale(0.95);
}

.zone-clickable:active .compact-zone-value {
  background: #f1f5f9;
  border-color: #cbd5e1;
}

.compact-zone-value {
  font-weight: 600;
  font-size: 14px;
  min-width: 36px;
  text-align: center;
  display: inline-block;
  background: #fff;
  border-radius: 6px;
  padding: 4px 8px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.08);
  border: 1px solid #e2e8f0;
}

.weight-card-chevron {
  display: none;
}

/* Компактные колёса в dropdown */
.weight-picker-wheels-inline .wheel-column {
  width: 50px;
}

.weight-picker-wheels-inline .wheel-viewport {
  height: 120px;
}

.weight-picker-wheels-inline .wheel-item {
  font-size: 18px;
}

.weight-picker-wheels-inline .wheel-item.selected {
  font-size: 20px;
}

.weight-picker-wheels-inline .wheel-highlight {
  height: 36px;
}

@keyframes pulse-weight {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* === WEIGHT PICKER MODAL === */
.weight-picker-modal {
  max-width: 320px;
}

/* Step indicator dots */
.picker-steps-indicator {
  display: flex;
  justify-content: center;
  gap: 8px;
  padding: 12px 0 8px;
  border-bottom: 1px solid #e5e7eb;
}

.picker-step-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #d1d5db;
  transition: background 0.2s ease;
}

.picker-step-dot.active {
  background: #6366f1;
}

/* DEV: Clear weight button */
.dev-clear-weight-btn {
  display: block;
  margin: 8px auto;
  padding: 6px 12px;
  font-size: 12px;
  color: #ef4444;
  background: rgba(239, 68, 68, 0.1);
  border: 1px dashed #ef4444;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.dev-clear-weight-btn:hover {
  background: rgba(239, 68, 68, 0.2);
}

.dev-clear-weight-btn:active {
  transform: scale(0.95);
}

/* Weight card bottom row: trend + mini clear button */
.weight-card-bottom-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin-top: 2px;
}

/* DEV: Mini clear weight button */
.dev-clear-weight-btn-mini {
  width: 16px;
  height: 16px;
  padding: 0;
  font-size: 12px;
  line-height: 14px;
  color: #9ca3af;
  background: transparent;
  border: 1px solid #e5e7eb;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.15s ease;
  flex-shrink: 0;
  opacity: 0.6;
}

.dev-clear-weight-btn-mini:hover {
  color: #ef4444;
  border-color: #ef4444;
  background: rgba(239, 68, 68, 0.1);
  opacity: 1;
}

.dev-clear-weight-btn-mini:active {
  transform: scale(0.9);
}

.weight-picker-section {
  padding: 12px 16px;
  border-bottom: 1px solid #e5e7eb;
}

.weight-picker-section:last-child {
  border-bottom: none;
}

.weight-picker-section-label {
  font-size: 13px;
  font-weight: 600;
  color: #64748b;
  margin-bottom: 8px;
  text-align: center;
}

.weight-wheels {
  justify-content: center;
  gap: 0 !important;
}

.weight-picker-dot {
  font-size: 28px;
  font-weight: 600;
  color: #000;
  padding: 0 4px;
  align-self: center;
}

.weight-picker-unit {
  font-size: 20px;
  font-weight: 600;
  color: #000;
  align-self: center;
  margin-left: 4px;
}

/* Steps Goal Section */
.steps-goal-section {
  padding: 12px 16px;
}

.steps-goal-wheels {
  justify-content: center;
  gap: 8px;
}

.steps-goal-wheel-unit {
  font-size: 20px;
  font-weight: 600;
  color: #000;
  align-self: center;
  margin-left: 8px;
}

.steps-goal-input-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-bottom: 8px;
}

.steps-goal-input {
  width: 100px;
  padding: 8px 12px;
  font-size: 18px;
  font-weight: 600;
  text-align: center;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  background: #f8fafc;
  color: #16a34a;
}

.steps-goal-input:focus {
  outline: none;
  border-color: #16a34a;
  background: #fff;
}

.steps-goal-unit {
  font-size: 14px;
  color: #64748b;
}

.steps-goal-presets {
  display: flex;
  justify-content: center;
  gap: 6px;
}

.steps-goal-preset {
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 600;
  color: #64748b;
  background: #f1f5f9;
  border: 1px solid #e2e8f0;
  border-radius: 16px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.steps-goal-preset:active {
  transform: scale(0.95);
}

.steps-goal-preset.active {
  color: #fff;
  background: #16a34a;
  border-color: #16a34a;
}

/* === FAB (Floating Action Button) === */
.fab-add-meal {
  position: fixed;
  bottom: 90px; /* над нижней навигацией */
  right: 20px;
  width: 64px;
  height: 64px;
  border-radius: 50%;
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color: white;
  font-size: 36px;
  font-weight: 300;
  border: none;
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.2s, box-shadow 0.2s;
  z-index: 100;
}

.fab-add-meal:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(37, 99, 235, 0.5);
}

.fab-add-meal:active {
  transform: scale(0.95);
}

/* === MACRO TOAST — подсказка БЖУ снизу === */
.macro-toast {
  position: fixed;
  bottom: 80px; /* над нижней навигацией */
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
  z-index: 1000;
  opacity: 0;
  transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.25s ease;
  width: 80%; /* 4/5 ширины экрана */
  max-width: 400px; /* ограничение на больших экранах */
  cursor: pointer;
}

.macro-toast.visible {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

.macro-toast-icon {
  font-size: 20px;
  flex-shrink: 0;
}

.macro-toast-text {
  font-size: 14px;
  font-weight: 500;
  color: #334155;
  line-height: 1.3;
}

.macro-toast-close {
  width: 24px;
  height: 24px;
  border: none;
  background: #f1f5f9;
  border-radius: 50%;
  font-size: 16px;
  color: #64748b;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  margin-left: 4px;
}

.macro-toast-close:hover {
  background: #e2e8f0;
  color: #334155;
}

/* Цвета по типу */
.macro-toast-protein {
  border-left: 4px solid #ef4444;
}

.macro-toast-fat {
  border-left: 4px solid #f59e0b;
}

.macro-toast-carbs {
  border-left: 4px solid #3b82f6;
}

.macro-toast-warning {
  border-left: 4px solid #f59e0b;
  background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
}

.macro-toast-success {
  border-left: 4px solid #22c55e;
  background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
}

/* Fiber - зелёный (клетчатка) */
.macro-toast-fiber {
  border-left: 4px solid #10b981;
  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
}

/* Tip - синий (подсказки) */
.macro-toast-tip {
  border-left: 4px solid #3b82f6;
  background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
}

/* Achievement - золотой с анимацией */
.macro-toast-achievement {
  border-left: 4px solid #f59e0b;
  background: linear-gradient(135deg, #fffbeb 0%, #fde68a 100%);
  animation: achievementPulse 0.5s ease-out;
}

@keyframes achievementPulse {
  0% { transform: translateX(-50%) scale(0.9); }
  50% { transform: translateX(-50%) scale(1.05); }
  100% { transform: translateX(-50%) scale(1); }
}

/* Progress bar для auto-hide */
.macro-toast-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background: currentColor;
  opacity: 0.3;
  border-radius: 0 0 12px 12px;
  animation: toast-progress 7.5s linear forwards;
}

@keyframes toast-progress {
  from { width: 100%; }
  to { width: 0%; }
}

.macro-toast-achievement .macro-toast-progress {
  animation-duration: 10s;
}

/* Анимации иконок */
.macro-toast-achievement .macro-toast-icon {
  animation: fire-flicker 0.5s ease-in-out infinite alternate;
}

@keyframes fire-flicker {
  0% { transform: scale(1) rotate(-2deg); filter: brightness(1); }
  100% { transform: scale(1.05) rotate(2deg); filter: brightness(1.1); }
}

.macro-toast-warning .macro-toast-icon {
  animation: warning-pulse 1s ease-in-out infinite;
}

@keyframes warning-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.macro-toast-success .macro-toast-icon,
.macro-toast-fiber .macro-toast-icon {
  animation: success-bounce 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@keyframes success-bounce {
  0% { transform: scale(0); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

.macro-toast-tip .macro-toast-icon {
  animation: tip-wobble 0.5s ease-in-out;
}

@keyframes tip-wobble {
  0%, 100% { transform: rotate(0); }
  25% { transform: rotate(-10deg); }
  75% { transform: rotate(10deg); }
}

/* Swipe-to-dismiss */
.macro-toast {
  will-change: transform;
  touch-action: pan-x;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.32, 0.72, 0, 1);
}

/* === EXPANDABLE ADVICE TOAST === */
.macro-toast.expanded {
  bottom: 90px;
  max-height: 300px;
  border-radius: 16px;
}

.macro-toast-main {
  display: flex;
  align-items: center;
  gap: 10px;
}

.macro-toast-badge {
  background: #3b82f6; /* Яркий синий */
  color: #fff;
  padding: 3px 10px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  margin-left: auto;
  animation: badgePulse 2s infinite;
  display: flex;
  align-items: center;
  gap: 4px;
}

.macro-toast-badge::after {
  content: '▼';
  font-size: 8px;
  transition: transform 0.2s;
}

.macro-toast.expanded .macro-toast-badge::after {
  transform: rotate(180deg);
}

@keyframes badgePulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.macro-toast-extras {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid rgba(255, 255, 255, 0.2);
  animation: slideDown 0.2s ease-out;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.macro-toast-extra {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  font-size: 13px;
}

.macro-toast-extra-warning { background: rgba(239, 68, 68, 0.2); }
.macro-toast-extra-achievement { background: rgba(234, 179, 8, 0.2); }
.macro-toast-extra-tip { background: rgba(59, 130, 246, 0.2); }
.macro-toast-extra-fiber { background: rgba(34, 197, 94, 0.2); }

/* Mobile: ограничиваем ширину и высоту */
@media (max-width: 480px) {
  .macro-toast.expanded {
    max-height: 250px;
    overflow-y: auto;
  }
  
  .macro-toast-extras {
    max-height: 150px;
    overflow-y: auto;
  }
  
  .macro-toast-extra {
    font-size: 12px;
    padding: 6px 10px;
  }
}

/* === PULL-TO-REFRESH (Modern Design) === */
.pull-indicator {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 6px;
  overflow: hidden;
  transition: height 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), 
              opacity 0.2s ease;
  margin: -12px -12px 8px -12px;
  padding-top: 12px;
  background: linear-gradient(
    180deg, 
    color-mix(in srgb, var(--acc) 8%, var(--bg)) 0%, 
    transparent 100%
  );
}

.pull-indicator.refreshing {
  height: 56px !important;
}

.pull-indicator.success {
  background: linear-gradient(
    180deg, 
    color-mix(in srgb, var(--success) 15%, var(--bg)) 0%, 
    transparent 100%
  );
}

.pull-spinner {
  position: relative;
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* SVG-based spinner for smooth animation */
.pull-spinner-ring {
  width: 28px;
  height: 28px;
  stroke: var(--acc);
  stroke-width: 3;
  fill: none;
  stroke-linecap: round;
  transform-origin: center;
  transition: stroke-dashoffset 0.15s ease-out;
}

.pull-spinner-ring.ready {
  stroke: var(--success);
}

.pull-spinner-ring.spinning {
  animation: pull-spin 0.8s cubic-bezier(0.4, 0, 0.2, 1) infinite;
}

@keyframes pull-spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Fallback emoji spinner */
.pull-spinner-icon {
  font-size: 22px;
  color: var(--acc);
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1),
              color 0.2s ease;
}

.pull-spinner-icon.ready {
  color: var(--success);
  transform: scale(1.15);
}

.pull-spinner-icon.spinning {
  animation: pull-spin 0.8s cubic-bezier(0.4, 0, 0.2, 1) infinite;
}

.pull-spinner-icon.success {
  color: var(--success);
  animation: pull-success 0.4s ease-out forwards;
}

@keyframes pull-success {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}

.pull-text {
  font-size: 12px;
  color: var(--muted);
  font-weight: 500;
  transition: color 0.2s ease;
  letter-spacing: 0.02em;
}

.pull-text.ready {
  color: var(--success-dark);
  font-weight: 600;
}

.pull-text.syncing {
  color: var(--acc);
}

/* Ripple effect for threshold */
.pull-indicator::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  background: radial-gradient(
    circle,
    color-mix(in srgb, var(--success) 20%, transparent) 0%,
    transparent 70%
  );
  border-radius: 50%;
  transform: translate(-50%, -50%);
  opacity: 0;
  transition: width 0.3s ease, height 0.3s ease, opacity 0.3s ease;
}

.pull-indicator.ready::before {
  width: 120px;
  height: 120px;
  opacity: 1;
}

/* === DARK THEME === */
[data-theme="dark"] {
  --bg: #0f172a;
  --card: #1e293b;
  --text: #f1f5f9;
  --muted: #94a3b8;
  --border: #334155;
  --acc: #3b82f6;
  --acc-contrast: #ffffff;
  
  /* Stats block (тёмно-синий) */
  --stats-bg: #1e3a5f;
  --stats-border: #3b82f6;
  
  /* Activity block (тёмно-жёлтый) */
  --activity-bg: #2d2a1f;
  --activity-border: #b8a04e;
  
  /* Sleep/Day block (тёмно-розовый) */
  --sleep-bg: #3d1f2f;
  --sleep-border: #9d4e6d;
}

/* Dark theme overrides */
[data-theme="dark"] body {
  background: var(--bg);
  color: var(--text);
}

/* Dark theme glassmorphism modals */
[data-theme="dark"] .modal-backdrop {
  background: rgba(0, 0, 0, 0.5);
}

[data-theme="dark"] .modal {
  background: rgba(30, 41, 59, 0.85);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow:
    0 24px 48px -12px rgba(0, 0, 0, 0.4),
    0 8px 16px -6px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .modal-content,
[data-theme="dark"] .modal-overlay .modal-content {
  background: var(--card);
  color: var(--text);
}

[data-theme="dark"] input,
[data-theme="dark"] select,
[data-theme="dark"] textarea {
  background: var(--bg);
  color: var(--text);
  border-color: var(--border);
}

[data-theme="dark"] .macro-toast {
  background: var(--card);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .macro-toast-protein {
  border-left-color: #f87171;
  background: linear-gradient(135deg, #2d1f1f 0%, #3d2525 100%);
}

[data-theme="dark"] .macro-toast-fat {
  border-left-color: #fbbf24;
  background: linear-gradient(135deg, #2d2a1f 0%, #3d3625 100%);
}

[data-theme="dark"] .macro-toast-carbs {
  border-left-color: #4ade80;
  background: linear-gradient(135deg, #1f2d1f 0%, #253d25 100%);
}

[data-theme="dark"] .macro-toast-warning {
  border-left-color: #fbbf24;
  background: linear-gradient(135deg, #2d2a1f 0%, #3d3625 100%);
}

[data-theme="dark"] .macro-toast-success {
  border-left-color: #4ade80;
  background: linear-gradient(135deg, #1f2d1f 0%, #253d25 100%);
}

[data-theme="dark"] .macro-toast-fiber {
  border-left-color: #10b981;
  background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
}

[data-theme="dark"] .macro-toast-tip {
  border-left-color: #3b82f6;
  background: linear-gradient(135deg, #1e3a5f 0%, #1e40af 100%);
}

[data-theme="dark"] .macro-toast-achievement {
  border-left-color: #f59e0b;
  background: linear-gradient(135deg, #78350f 0%, #92400e 100%);
}

/* 🌙 Тёмная тема для popup БЖУ */
[data-theme="dark"] .macro-badge-popup {
  background: #1e293b;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .macro-badge-popup-arrow {
  border-bottom-color: #1e293b;
}

[data-theme="dark"] .macro-badge-popup-swipe {
  background: #475569;
}

[data-theme="dark"] .macro-badge-popup-title {
  color: #f1f5f9;
}

[data-theme="dark"] .macro-badge-popup-sparkline {
  background: #0f172a;
}

[data-theme="dark"] .macro-badge-popup-spark-label {
  color: #64748b;
}

[data-theme="dark"] .macro-badge-popup-progress {
  background: #334155;
}

[data-theme="dark"] .macro-badge-popup-norm {
  color: #64748b;
}

[data-theme="dark"] .macro-badge-popup-compare {
  background: #334155;
  color: #94a3b8;
}

[data-theme="dark"] .macro-badge-popup-compare.up {
  background: #14532d;
  color: #4ade80;
}

[data-theme="dark"] .macro-badge-popup-compare.down {
  background: #450a0a;
  color: #f87171;
}

[data-theme="dark"] .macro-badge-popup-time-msg {
  color: #94a3b8;
}

[data-theme="dark"] .macro-badge-popup-streak {
  background: linear-gradient(135deg, #451a03 0%, #78350f 100%);
  border-color: #92400e;
  color: #fbbf24;
}

[data-theme="dark"] .macro-badge-popup-desc {
  border-top-color: #334155;
}

[data-theme="dark"] .macro-badge-popup-item {
  color: #cbd5e1;
}

[data-theme="dark"] .macro-badge-popup-rec {
  background: linear-gradient(135deg, #14532d 0%, #166534 100%);
  border-color: #22c55e;
  color: #86efac;
}

[data-theme="dark"] .macro-badge-popup-close {
  background: rgba(255, 255, 255, 0.1);
  color: #94a3b8;
}

[data-theme="dark"] .macro-badge-popup-close:hover {
  background: rgba(255, 255, 255, 0.2);
  color: #f1f5f9;
}

/* Dark theme: Metric Popup */
[data-theme="dark"] .metric-popup {
  background: #1e293b;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .metric-popup-arrow {
  border-bottom-color: #1e293b;
}

[data-theme="dark"] .metric-popup-swipe {
  background: #475569;
}

[data-theme="dark"] .metric-popup-title {
  color: #f1f5f9;
}

[data-theme="dark"] .metric-popup-sparkline {
  background: transparent;
}

[data-theme="dark"] .metric-popup-spark-label {
  color: #64748b;
}

[data-theme="dark"] .metric-popup-progress {
  background: #334155;
}

[data-theme="dark"] .metric-popup-goal {
  color: #64748b;
}

[data-theme="dark"] .metric-popup-compare {
  background: #334155;
  color: #94a3b8;
}

[data-theme="dark"] .metric-popup-compare.up {
  background: #14532d;
  color: #4ade80;
}

[data-theme="dark"] .metric-popup-compare.down {
  background: #450a0a;
  color: #f87171;
}

[data-theme="dark"] .metric-popup-extra {
  color: #94a3b8;
}

[data-theme="dark"] .metric-popup-extra b {
  color: #f1f5f9;
}

[data-theme="dark"] .metric-popup-streak {
  background: linear-gradient(135deg, #451a03 0%, #78350f 100%);
  border-color: #92400e;
  color: #fbbf24;
}

[data-theme="dark"] .metric-popup-reminder {
  background: #451a03;
  border-color: #92400e;
  color: #fb923c;
}

[data-theme="dark"] .metric-popup-close {
  background: rgba(255, 255, 255, 0.1);
  color: #94a3b8;
}

[data-theme="dark"] .metric-popup-close:hover {
  background: rgba(255, 255, 255, 0.2);
  color: #f1f5f9;
}

[data-theme="dark"] .skeleton-item {
  background: linear-gradient(90deg, #334155 0%, #475569 50%, #334155 100%);
}

[data-theme="dark"] .meal-card,
[data-theme="dark"] .card {
  background: var(--card);
  border-color: var(--border);
}

/* Стили типов приёмов в тёмной теме */
[data-theme="dark"] .meal-sep { color: #cbd5e1; }
[data-theme="dark"] .meal-sep.meal-type-breakfast { color: #fb923c; }
[data-theme="dark"] .meal-sep.meal-type-lunch { color: #4ade80; }
[data-theme="dark"] .meal-sep.meal-type-dinner { color: #60a5fa; }
[data-theme="dark"] .meal-sep.meal-type-snack1,
[data-theme="dark"] .meal-sep.meal-type-snack2,
[data-theme="dark"] .meal-sep.meal-type-snack3 { color: #9ca3af; }
[data-theme="dark"] .meal-sep.meal-type-night { color: #a78bfa; }

[data-theme="dark"] .meal-time-badge { 
  background: #78350f; 
  color: #fcd34d; 
}
[data-theme="dark"] .meal-type-label { 
  background: linear-gradient(135deg, #1e3a5f 0%, #312e81 100%); 
  color: #93c5fd; 
}
[data-theme="dark"] .meal-type-label:hover { background: linear-gradient(135deg, #1e40af 0%, #4338ca 100%); }
[data-theme="dark"] .meal-type-arrow { color: #94a3b8; }

[data-theme="dark"] .meal-kcal-badge { background: #334155; color: #e2e8f0; }
[data-theme="dark"] .meal-sep.meal-type-breakfast .meal-kcal-badge { background: #431407; color: #fb923c; }
[data-theme="dark"] .meal-sep.meal-type-lunch .meal-kcal-badge { background: #14532d; color: #4ade80; }
[data-theme="dark"] .meal-sep.meal-type-dinner .meal-kcal-badge { background: #1e3a8a; color: #60a5fa; }
[data-theme="dark"] .meal-sep.meal-type-night .meal-kcal-badge { background: #3730a3; color: #a78bfa; }

[data-theme="dark"] .btn {
  background: var(--card);
  color: var(--text);
  border-color: var(--border);
}

[data-theme="dark"] .btn:hover {
  background: var(--border);
}

[data-theme="dark"] .btn-primary {
  background: var(--acc);
  color: var(--acc-contrast);
  border-color: var(--acc);
}

[data-theme="dark"] .nav-link {
  color: var(--muted);
}

[data-theme="dark"] .nav-link.active {
  color: var(--acc);
}

[data-theme="dark"] .fab-add-meal {
  background: var(--acc);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
}

[data-theme="dark"] .empty-state {
  background: var(--card);
  border-color: var(--border);
}

[data-theme="dark"] .sparkline-skeleton-line {
  background: linear-gradient(90deg, #334155 0%, #475569 50%, #334155 100%);
}

[data-theme="dark"] .sparkline-skeleton-dot {
  background: #475569;
}

/* Dark theme for kcal sparkline container */
[data-theme="dark"] .kcal-sparkline-container {
  background: linear-gradient(135deg, #052e16 0%, #064e3b 100%);
  border-color: #166534;
}

[data-theme="dark"] .kcal-sparkline-title {
  color: #86efac;
}

[data-theme="dark"] .kcal-period-pills {
  background: rgba(74, 222, 128, 0.15);
}

[data-theme="dark"] .kcal-period-pill {
  color: #86efac;
}

[data-theme="dark"] .kcal-period-pill.active {
  background: #166534;
  color: #dcfce7;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

/* Dark theme for sparkline chart */
[data-theme="dark"] .sparkline-container {
  background: transparent;
}

[data-theme="dark"] .sparkline-line {
  stroke: #4ade80;
}

[data-theme="dark"] .sparkline-goal {
  stroke: #64748b;
}

[data-theme="dark"] .sparkline-dot-ok {
  fill: #4ade80;
}

[data-theme="dark"] .sparkline-dot-warn {
  fill: #fbbf24;
}

[data-theme="dark"] .sparkline-dot-over {
  fill: #f87171;
}

[data-theme="dark"] .sparkline-day-label {
  fill: #64748b;
}

[data-theme="dark"] .sparkline-day-today {
  fill: #4ade80;
}

/* Dark mode для пунктирных линий от точек к дням */
[data-theme="dark"] .sparkline-point-line {
  stroke: #64748b; /* slate-500 — ярче */
}

[data-theme="dark"] .weight-sparkline-point-line {
  stroke: #a78bfa; /* purple-400 — ярче */
}

/* Dark theme for new sparkline elements */
[data-theme="dark"] .sparkline-streak-line {
  stroke: #fbbf24;
  filter: drop-shadow(0 0 6px rgba(251, 191, 36, 0.5));
}

[data-theme="dark"] .sparkline-day-weekend {
  fill: #f87171;
}

[data-theme="dark"] .sparkline-day-forecast {
  fill: #64748b;
}

[data-theme="dark"] .sparkline-mood-label {
  color: #94a3b8;
}

[data-theme="dark"] .sparkline-slider-line {
  stroke: #60a5fa;
}

[data-theme="dark"] .sparkline-slider-point {
  fill: #60a5fa;
  stroke: #1e293b;
  filter: drop-shadow(0 2px 4px rgba(96, 165, 250, 0.5));
}

/* Dark theme: Today line & Brush */
[data-theme="dark"] .sparkline-today-line {
  fill: rgba(96, 165, 250, 0.15);
}

[data-theme="dark"] .sparkline-today-label {
  fill: rgba(96, 165, 250, 0.8);
}

[data-theme="dark"] .sparkline-brush-overlay {
  fill: rgba(96, 165, 250, 0.15);
  stroke: rgba(96, 165, 250, 0.4);
}

[data-theme="dark"] .sparkline-brush-stats {
  background: rgba(96, 165, 250, 0.2);
  color: #93c5fd;
}

[data-theme="dark"] .sparkline-zoom-indicator {
  background: rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .sparkline-slider-tooltip {
  background: rgba(30, 41, 59, 0.95);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .sparkline-slider-tooltip-date {
  color: #f1f5f9;
}

[data-theme="dark"] .sparkline-slider-tooltip-kcal {
  color: #94a3b8;
}

[data-theme="dark"] .sparkline-slider-tooltip-ratio.ratio-ok {
  background: #064e3b;
  color: #6ee7b7;
}

[data-theme="dark"] .sparkline-slider-tooltip-ratio.ratio-warn {
  background: #713f12;
  color: #fcd34d;
}

[data-theme="dark"] .sparkline-slider-tooltip-ratio.ratio-over {
  background: #7f1d1d;
  color: #fca5a5;
}

/* Dark theme for new sparkline elements */
/* Dark mode slider tooltip tags */
[data-theme="dark"] .sparkline-slider-tooltip-kcal {
  color: #f1f5f9;
}
[data-theme="dark"] .sparkline-slider-tooltip-kcal small {
  color: #64748b;
}
[data-theme="dark"] .sparkline-slider-tooltip-tag {
  background: #334155;
  color: #94a3b8;
}
[data-theme="dark"] .sparkline-slider-tooltip-tag.good {
  background: #064e3b;
  color: #6ee7b7;
}
[data-theme="dark"] .sparkline-slider-tooltip-tag.bad {
  background: #7f1d1d;
  color: #fca5a5;
}

[data-theme="dark"] .sparkline-week-separator {
  stroke: #334155;
}

[data-theme="dark"] .sparkline-burn-glow {
  fill: #fb923c;
}

/* Dark theme for correlation block */
[data-theme="dark"] .correlation-block {
  background: linear-gradient(135deg, #1a1f2e 0%, #151a24 100%);
  border-color: #334155;
}

[data-theme="dark"] .correlation-block.positive {
  background: linear-gradient(135deg, #0d2818 0%, #0a1f14 100%);
  border-color: #166534;
}

[data-theme="dark"] .correlation-block.warning {
  background: linear-gradient(135deg, #2c1f0f 0%, #1f160a 100%);
  border-color: #b45309;
}

[data-theme="dark"] .correlation-block.mixed {
  background: linear-gradient(135deg, #2c2a0f 0%, #1f1d0a 100%);
  border-color: #a16207;
}

[data-theme="dark"] .correlation-text {
  color: #e2e8f0;
}

[data-theme="dark"] .correlation-clickable:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* Dark theme for weight sparkline */
[data-theme="dark"] .weight-sparkline-container {
  background: linear-gradient(135deg, #1e1b2e 0%, #1a1625 100%);
  border-color: #4c3d6e;
}

[data-theme="dark"] .weight-sparkline-container.trend-down {
  background: linear-gradient(135deg, #0d2818 0%, #0a1f14 100%);
  border-color: #166534;
}

[data-theme="dark"] .weight-sparkline-container.trend-up {
  background: linear-gradient(135deg, #2c1616 0%, #1f1010 100%);
  border-color: #991b1b;
}

[data-theme="dark"] .weight-sparkline-container.trend-same {
  background: linear-gradient(135deg, #1e1b2e 0%, #1a1625 100%);
  border-color: #4c3d6e;
}

[data-theme="dark"] .weight-sparkline-title {
  color: #c4b5fd;
}

[data-theme="dark"] .weight-trend-badge.down {
  background: #064e3b;
  color: #34d399;
}

[data-theme="dark"] .weight-trend-badge.up {
  background: #7f1d1d;
  color: #fca5a5;
}

[data-theme="dark"] .weight-trend-badge.same {
  background: #3b2f63;
  color: #c4b5fd;
}

[data-theme="dark"] .weight-forecast-badge {
  background: #334155;
  color: #94a3b8;
}

[data-theme="dark"] .weight-forecast-badge.down {
  background: #064e3b;
  color: #6ee7b7;
}

[data-theme="dark"] .weight-forecast-badge.up {
  background: #7f1d1d;
  color: #fca5a5;
}

[data-theme="dark"] .weight-sparkline-line {
  stroke: #a78bfa;
}

[data-theme="dark"] .weight-sparkline-container.trend-down .weight-sparkline-line {
  stroke: #34d399;
}

[data-theme="dark"] .weight-sparkline-container.trend-up .weight-sparkline-line {
  stroke: #f87171;
}

[data-theme="dark"] .weight-sparkline-container.trend-same .weight-sparkline-line {
  stroke: #a78bfa;
}

[data-theme="dark"] .weight-sparkline-label {
  fill: #7c3aed;
}

[data-theme="dark"] .weight-sparkline-label-today {
  fill: #c4b5fd;
}

[data-theme="dark"] .weight-sparkline-day-label {
  fill: #64748b;
}

[data-theme="dark"] .weight-sparkline-day-today {
  fill: #94a3b8;
}

/* Dark theme for bottom sheets (Glassmorphism) */
[data-theme="dark"] .time-picker-backdrop {
  background: rgba(0, 0, 0, 0.5);
}

[data-theme="dark"] .time-picker-modal {
  background: rgba(28, 28, 30, 0.95);
  box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .time-picker-header {
  border-bottom-color: #38383a;
}

[data-theme="dark"] .time-picker-title {
  color: #f2f2f7;
}

[data-theme="dark"] .mood-hint-first {
  color: #8e8e93;
}

[data-theme="dark"] .mood-hint-change {
  color: #0a84ff;
}

[data-theme="dark"] .mood-label,
[data-theme="dark"] .mood-slider-label {
  color: #f2f2f7;
}

[data-theme="dark"] .mood-slider-value {
  color: #0a84ff;
}

[data-theme="dark"] .mood-preset {
  background: #2c2c2e;
  border-color: #48484a;
  color: #e5e5ea;
}

[data-theme="dark"] .mood-diff.diff-up {
  background: rgba(16, 185, 129, 0.25);
}

[data-theme="dark"] .mood-diff.diff-down {
  background: rgba(239, 68, 68, 0.25);
}

[data-theme="dark"] .mood-diff.diff-same {
  background: rgba(142, 142, 147, 0.25);
  color: #8e8e93;
}

[data-theme="dark"] .mood-slider-footer .mood-hint-change {
  color: #636366;
}

[data-theme="dark"] .mood-slider::-webkit-slider-thumb {
  background: #e5e5ea;
  box-shadow: 0 2px 8px rgba(0,0,0,0.4);
}

[data-theme="dark"] .mood-face-text {
  color: #8e8e93;
}

[data-theme="dark"] .mood-time-hint {
  color: #8e8e93;
}

[data-theme="dark"] .mood-ai-insight {
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(168, 85, 247, 0.2));
  border-color: rgba(99, 102, 241, 0.3);
  color: #a5b4fc;
}

[data-theme="dark"] .yesterday-mark {
  color: #636366;
}

[data-theme="dark"] .mood-journal-prompt {
  background: rgba(239, 68, 68, 0.15);
  border-color: rgba(239, 68, 68, 0.25);
}

[data-theme="dark"] .mood-journal-text {
  color: #a1a1aa;
}

[data-theme="dark"] .bottom-sheet-handle::before {
  background: #48484a;
}

[data-theme="dark"] .wheel-column-item,
[data-theme="dark"] .wheel-item {
  color: #8e8e93;
}

[data-theme="dark"] .wheel-column-item.selected,
[data-theme="dark"] .wheel-item.selected {
  color: #f2f2f7;
}

/* Dark theme for training picker */
[data-theme="dark"] .training-type-label,
[data-theme="dark"] .training-time-label {
  color: #8e8e93;
}

[data-theme="dark"] .training-type-btn {
  background: #2c2c2e;
  border-color: #38383a;
}

[data-theme="dark"] .training-type-btn.active {
  border-color: #f97316;
  background: linear-gradient(135deg, #3d2a1a 0%, #4a3420 100%);
}

[data-theme="dark"] .training-type-text {
  color: #8e8e93;
}

[data-theme="dark"] .training-type-btn.active .training-type-text {
  color: #fb923c;
}

[data-theme="dark"] .compact-train-time {
  background: #2c2c2e;
  color: #8e8e93;
}

[data-theme="dark"] .compact-train-header:active {
  background: #2c2c2e;
}

/* Dark theme for training zones */
[data-theme="dark"] .training-zones-label {
  color: #8e8e93;
}

[data-theme="dark"] .training-zone-header.zone-color-1 { background: #1e3a5f; color: #60a5fa; }
[data-theme="dark"] .training-zone-header.zone-color-2 { background: #14532d; color: #4ade80; }
[data-theme="dark"] .training-zone-header.zone-color-3 { background: #451a03; color: #fbbf24; }
[data-theme="dark"] .training-zone-header.zone-color-4 { background: #450a0a; color: #f87171; }

[data-theme="dark"] .training-zones-kcal {
  color: #fb923c;
}

/* Dark theme for training presets and stats */
[data-theme="dark"] .training-presets-section {
  border-top-color: #38383a;
}

[data-theme="dark"] .training-presets-label {
  color: #8e8e93;
}

[data-theme="dark"] .training-preset-btn {
  background: #2c2c2e;
  border-color: #38383a;
  color: #f2f2f7;
}

[data-theme="dark"] .training-preset-btn:active {
  background: #3a3a3c;
}

[data-theme="dark"] .training-zones-time {
  color: #60a5fa;
}

/* === TONE CARDS - DARK === */
[data-theme="dark"] .tone-violet,
[data-theme="dark"] .card.tone-violet {
  background: #2d2640;
  border-color: #4c3d6e;
}

[data-theme="dark"] .tone-green {
  background: #1a2e1a;
  border-color: #2d4a2d;
}

[data-theme="dark"] .tone-green label {
  color: #86efac;
}

[data-theme="dark"] .tone-amber {
  background: #2e2a1a;
  border-color: #4a4020;
}

[data-theme="dark"] .tone-blue {
  background: #1a2535;
  border-color: #2d4055;
}

[data-theme="dark"] .tone-slate {
  background: #1e2530;
  border-color: #3a4555;
}

/* Серые mpc-totals внутри прошедших приёмов (dark theme) */
[data-theme="dark"] .tone-slate .mpc-totals-wrap {
  background: #2a3040;
}
[data-theme="dark"] .tone-slate .mpc-totals-wrap .mpc-header,
[data-theme="dark"] .tone-slate .mpc-totals-wrap .mpc-totals-values {
  color: #94a3b8;
}
[data-theme="dark"] .tone-slate .mpc-totals {
  background: #2a3040;
  color: #94a3b8;
}

/* Violet main-violet card */
[data-theme="dark"] .card.tone-violet.main-violet {
  background: #1e1a2e;
  border-color: #3d3560;
}

[data-theme="dark"] .card.tone-violet.main-violet .violet-table th {
  background: #2a2445;
  color: #c4b5fd;
}

[data-theme="dark"] .card.tone-violet.main-violet .violet-table td {
  border-color: #4c3d6e;
  color: #e2e8f0;
}

[data-theme="dark"] .card.tone-violet.main-violet .stat {
  background: rgba(45, 38, 64, 0.5);
  border-color: #4c3d6e;
}

[data-theme="dark"] .card.tone-violet.main-violet .stat > label {
  color: #e2e8f0;
}

/* Header bottom */
[data-theme="dark"] .hdr-bottom {
  background: #2a2a2a;
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.2);
}

/* Cloud sync indicator dark */
[data-theme="dark"] .cloud-sync-indicator {
  background: rgba(156, 163, 175, 0.15);
  color: #9ca3af;
}

[data-theme="dark"] .cloud-sync-indicator.idle {
  background: rgba(96, 165, 250, 0.2);
  color: #60a5fa;
}

[data-theme="dark"] .cloud-sync-indicator.syncing {
  background: rgba(96, 165, 250, 0.2);
  color: #60a5fa;
}

[data-theme="dark"] .cloud-sync-indicator.synced {
  background: rgba(52, 211, 153, 0.2);
  color: #34d399;
}

[data-theme="dark"] .cloud-sync-indicator.offline {
  background: rgba(248, 113, 113, 0.15);
  color: #f87171;
}

/* Offline banner dark */
[data-theme="dark"] .offline-banner {
  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
}

/* Sync toast dark */
[data-theme="dark"] .sync-toast {
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

/* Yesterday quick button in header */
[data-theme="dark"] .yesterday-quick-btn {
  background: #2c2c2e;
  border-color: #3c3c3e;
  color: #e5e5e5;
}
[data-theme="dark"] .yesterday-quick-btn:hover {
  background: #3c3c3e;
}
[data-theme="dark"] .yesterday-quick-btn.active {
  background: #34d399;
  border-color: #34d399;
  color: white;
  box-shadow: 0 2px 4px rgba(52, 211, 153, 0.3);
}

/* Today quick button in header */
[data-theme="dark"] .today-quick-btn {
  background: #60a5fa;
  box-shadow: 0 2px 4px rgba(96, 165, 250, 0.3);
}
[data-theme="dark"] .today-quick-btn:hover {
  background: #3b82f6;
}
[data-theme="dark"] .today-quick-btn.active {
  background: #34d399;
  box-shadow: 0 2px 4px rgba(52, 211, 153, 0.3);
}

/* Bottom nav tabs */
[data-theme="dark"] .tabs {
  background: #1c1c1e;
  border-top-color: #3a3a3c;
  box-shadow: 0 -2px 12px rgba(0, 0, 0, 0.3), 0 -1px 4px rgba(0, 0, 0, 0.2);
}

[data-theme="dark"] .tab {
  color: #6c6c70;
}

[data-theme="dark"] .tab:hover {
  background: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .tab.active {
  color: #818cf8;
}

/* Theme toggle button */
.theme-toggle {
  position: fixed;
  top: 12px;
  right: 12px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--card);
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 18px;
  z-index: 100;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.theme-toggle:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.theme-toggle:active {
  transform: scale(0.95);
}

/* === CONFETTI ANIMATION === */
.confetti-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9999;
  overflow: hidden;
}

.confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 2px;
  animation: confetti-fall 3s ease-out forwards;
  transform-origin: center;
}

@keyframes confetti-fall {
  0% {
    top: -10px;
    opacity: 1;
    transform: translateX(0) rotate(0deg) scale(1);
  }
  25% {
    transform: translateX(20px) rotate(180deg) scale(1);
  }
  50% {
    transform: translateX(-15px) rotate(360deg) scale(0.9);
  }
  75% {
    transform: translateX(10px) rotate(540deg) scale(0.8);
  }
  100% {
    top: 100vh;
    opacity: 0;
    transform: translateX(-5px) rotate(720deg) scale(0.6);
  }
}

/* === EMPTY STATE === */
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px 24px;
  text-align: center;
  background: var(--card);
  border: 2px dashed var(--border);
  border-radius: 16px;
  margin: 16px 0;
}

.empty-state-icon {
  font-size: 48px;
  margin-bottom: 16px;
  animation: empty-bounce 2s ease-in-out infinite;
}

@keyframes empty-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

.empty-state-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 8px;
}

.empty-state-text {
  font-size: 14px;
  color: var(--muted);
  margin-bottom: 20px;
  max-width: 260px;
}

.empty-state-btn {
  padding: 12px 24px;
  font-size: 15px;
  font-weight: 600;
}

/* === SPARKLINE EMPTY STATE === */
.sparkline-empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 24px 16px;
  text-align: center;
  min-height: 100px;
}

.sparkline-empty-icon {
  font-size: 32px;
  margin-bottom: 8px;
  opacity: 0.7;
  animation: empty-bounce 2s ease-in-out infinite;
}

.sparkline-empty-text {
  font-size: 14px;
  font-weight: 600;
  color: #166534;
  margin-bottom: 4px;
}

.sparkline-empty-hint {
  font-size: 12px;
  color: #15803d;
  opacity: 0.7;
  margin-bottom: 12px;
}

.sparkline-empty-progress {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  max-width: 160px;
  position: relative;
  background: rgba(34, 197, 94, 0.1);
  border-radius: 3px;
  padding: 2px;
}

.sparkline-empty-progress-bar {
  height: 6px;
  background: linear-gradient(90deg, #22c55e, #4ade80);
  border-radius: 3px;
  transition: width 0.3s ease;
  box-shadow: 0 0 8px rgba(34, 197, 94, 0.3);
}

.sparkline-empty-progress-text {
  font-size: 11px;
  font-weight: 500;
  color: #15803d;
  white-space: nowrap;
}

.sparkline-empty-btn {
  margin-top: 12px;
  padding: 10px 20px;
  font-size: 14px;
  font-weight: 600;
  color: #fff;
  background: linear-gradient(135deg, #22c55e, #16a34a);
  border: none;
  border-radius: 20px;
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
}

.sparkline-empty-btn:hover {
  transform: scale(1.02);
  box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
}

.sparkline-empty-btn:active {
  transform: scale(0.98);
}

/* Weight empty state - фиолетовая тема */
.sparkline-empty-state.weight-empty .sparkline-empty-text {
  color: #7c3aed;
}

.sparkline-empty-state.weight-empty .sparkline-empty-hint {
  color: #8b5cf6;
}

.sparkline-empty-state.weight-empty .sparkline-empty-progress {
  background: rgba(139, 92, 246, 0.1);
}

.sparkline-empty-state.weight-empty .sparkline-empty-progress-bar,
.sparkline-empty-progress-bar.weight {
  background: linear-gradient(90deg, #8b5cf6, #a78bfa);
  box-shadow: 0 0 8px rgba(139, 92, 246, 0.3);
}

.sparkline-empty-state.weight-empty .sparkline-empty-progress-text {
  color: #7c3aed;
}

/* Dark mode */
[data-theme="dark"] .sparkline-empty-text {
  color: #4ade80;
}

[data-theme="dark"] .sparkline-empty-hint {
  color: #86efac;
}

[data-theme="dark"] .sparkline-empty-progress-text {
  color: #86efac;
}

/* === SPARKLINE SKELETON === */
.sparkline-skeleton {
  height: 44px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 8px;
  padding: 4px 12px;
}

.sparkline-skeleton-line {
  height: 2px;
  background: linear-gradient(90deg, var(--border) 0%, var(--muted) 50%, var(--border) 100%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 1px;
}

.sparkline-skeleton-dots {
  display: flex;
  justify-content: space-between;
}

.sparkline-skeleton-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--border);
  animation: pulse 1.5s ease-in-out infinite;
}

.sparkline-skeleton-dot:nth-child(2) { animation-delay: 0.1s; }
.sparkline-skeleton-dot:nth-child(3) { animation-delay: 0.2s; }
.sparkline-skeleton-dot:nth-child(4) { animation-delay: 0.3s; }
.sparkline-skeleton-dot:nth-child(5) { animation-delay: 0.4s; }
.sparkline-skeleton-dot:nth-child(6) { animation-delay: 0.5s; }
.sparkline-skeleton-dot:nth-child(7) { animation-delay: 0.6s; }

@keyframes pulse {
  0%, 100% { opacity: 0.3; transform: scale(0.8); }
  50% { opacity: 1; transform: scale(1); }
}
/* === GOAL PROGRESS ANIMATION === */
.goal-progress-fill {
  transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* Desktop: показываем обычную кнопку */
.desktop-only {
  display: flex;
}

/* Mobile: показываем FAB */
.mobile-only {
  display: none;
}

@media (max-width: 640px) {
  .desktop-only {
    display: none !important;
  }
  
  .mobile-only {
    display: flex !important;
  }
  
  /* mpc-totals-wrap needs block, not flex */
  .mpc-totals-wrap.mobile-only {
    display: block !important;
  }
  
  .fab-add-meal {
    bottom: 80px; /* над нижней навигацией */
    right: 24px;
    width: 52px;
    height: 52px;
    font-size: 28px;
  }
  
  .macro-weight-row {
    gap: 6px;
  }
  
  .macro-rings {
    padding: 10px 4px;
  }
  
  .macro-ring {
    width: 44px;
    height: 44px;
  }
  
  .macro-ring-value {
    font-size: 11px;
  }
  
  .macro-ring-label {
    font-size: 9px;
  }
  
  .macro-ring-target {
    font-size: 9px;
  }
  
  .weight-card {
    min-width: 60px;
    padding: 8px 10px;
  }
  
  .weight-card-icon {
    font-size: 18px;
  }
  
  .weight-card-value {
    font-size: 14px;
  }
  
  .weight-card-placeholder {
    font-size: 10px;
  }
  
  .weight-card-trend {
    font-size: 9px;
  }
  
  .weight-card-inline {
    min-width: 80px;
    padding: 6px 8px;
  }
  
  .weight-wheel-select {
    font-size: 16px;
    min-width: 40px;
    padding: 3px 1px;
  }
  
  .weight-wheel-small {
    min-width: 28px;
  }
  
  .weight-wheel-dot {
    font-size: 18px;
  }
  
  .weight-wheel-unit {
    font-size: 11px;
  }
}

.metrics-card:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.metrics-icon {
  font-size: 16px;
  margin-bottom: 2px;
}

.metrics-value {
  font-size: 18px;
  font-weight: 700;
  line-height: 1.2;
  margin-bottom: 2px;
}

.metrics-label {
  font-size: 9px;
  color: #64748b;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  font-weight: 500;
}

.metrics-progress {
  height: 4px;
  background: #e2e8f0;
  border-radius: 2px;
  margin-top: 8px;
  overflow: hidden;
}

.metrics-progress-bar {
  height: 100%;
  border-radius: 2px;
  transition: width 0.3s ease;
}

/* === DAY SUBTABS (Мобильные под-вкладки) === */
.day-subtabs {
  display: flex;
  gap: 8px;
  padding: 8px 12px;
  background: var(--card);
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  z-index: 50; /* Ниже чем календарь (z-index: 9999) */
  margin: -12px -12px 12px -12px;
}

.day-subtab {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 10px 16px;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: var(--bg);
  color: var(--muted);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  -webkit-tap-highlight-color: transparent;
}

.day-subtab:active {
  transform: scale(0.98);
}

.day-subtab.active {
  background: var(--acc);
  color: white;
  border-color: var(--acc);
  font-weight: 600;
}

.day-subtab-icon {
  font-size: 16px;
}

.day-subtab-text {
  font-size: 13px;
}

/* Desktop: скрываем под-вкладки */
@media (min-width: 769px) {
  .day-subtabs {
    display: none;
  }
}

/* === COMPACT STATS (Статистика) === */
.compact-stats {
  margin-top: 4px;
  margin-bottom: 8px;
  background: var(--stats-bg);
  border-color: var(--stats-border);
}

.compact-stats .goal-progress-bar {
  background: transparent;
  box-shadow: none;
  border: none;
  padding: 0;
  margin-bottom: 12px;
}

/* === COMPACT SLEEP BLOCK (суперсветло-розовый) === */
.compact-sleep {
  margin-bottom: 8px;
  background: var(--sleep-bg);
  border-color: var(--sleep-border);
}

.compact-sleep .compact-card-header {
  color: #be185d;
}

/* Ряд с двумя плашками */
.sleep-cards-row {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* Плашка Сон / Оценка дня */
.sleep-card {
  flex: 1;
  background: #fff;
  border: 1px solid #fce7f3;
  border-radius: 12px;
  padding: 12px 14px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.sleep-card-header {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 10px;
}

.sleep-card-icon {
  font-size: 14px;
}

.sleep-card-title {
  font-size: 13px;
  font-weight: 600;
  color: #be185d;
}

/* Время сна */
.sleep-card-times {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 8px;
}

.sleep-time-input {
  width: 100px;
  padding: 8px 4px;
  border: 1px solid #fce7f3;
  border-radius: 8px;
  font-size: 15px;
  text-align: center;
  background: #fff;
  transition: all 0.2s;
  -webkit-appearance: none;
}

.sleep-time-input:focus {
  outline: none;
  border-color: #ec4899;
  background: #fff;
  box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
}

.sleep-arrow {
  color: #f9a8d4;
  font-size: 14px;
}

/* Качество сна — большой блок как у оценки дня */
.sleep-quality-display {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 4px;
  padding: 12px;
  background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
  border-radius: 12px;
  margin-bottom: 12px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.sleep-quality-display.clickable:active {
  transform: scale(0.98);
  background: linear-gradient(135deg, #ddd6fe 0%, #c4b5fd 100%);
}

.sleep-quality-value-big {
  font-size: 36px;
  font-weight: 700;
  color: #7c3aed;
  line-height: 1;
}

.sleep-quality-max {
  font-size: 16px;
  font-weight: 500;
  color: #9ca3af;
}

.sleep-duration-hint {
  font-size: 11px;
  color: #8b5cf6;
  margin-left: 8px;
  padding: 2px 6px;
  background: rgba(139, 92, 246, 0.1);
  border-radius: 6px;
}

/* Score display enhancements */
.score-main-row {
  display: flex;
  align-items: baseline;
  gap: 4px;
}

.score-emoji {
  font-size: 24px;
  margin-right: 4px;
  animation: scoreEmojiBounce 0.6s ease-out;
}

@keyframes scoreEmojiBounce {
  0% { transform: scale(0.3); opacity: 0; }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); opacity: 1; }
}

.score-compare {
  font-size: 11px;
  font-weight: 600;
  margin-left: 8px;
  padding: 2px 6px;
  background: rgba(0, 0, 0, 0.05);
  border-radius: 6px;
}

/* Pulse animation for high scores (9-10) */
.score-pulse {
  animation: scorePulseGlow 2s ease-in-out infinite;
}

@keyframes scorePulseGlow {
  0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
  50% { box-shadow: 0 0 12px 4px rgba(16, 185, 129, 0.6); }
}

/* Заметка (textarea) */
.sleep-note {
  width: 100%;
  padding: 6px 10px;
  border: 1px solid #fce7f3;
  border-radius: 8px;
  font-size: 12px;
  background: #fff;
  transition: all 0.2s;
  resize: none;
  min-height: 28px;
  line-height: 1.4;
  font-family: inherit;
  white-space: pre-wrap;
}

.sleep-note:focus {
  outline: none;
  border-color: #ec4899;
  background: #fff;
}

.sleep-note::placeholder {
  color: #f9a8d4;
}

/* Оценка дня (автоматическая) */
.day-score-display {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 4px;
  padding: 12px;
  background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
  border-radius: 12px;
  margin-bottom: 12px;
}

.day-score-value-big {
  font-size: 36px;
  font-weight: 700;
  color: #be185d;
  line-height: 1;
}

.day-score-max {
  font-size: 16px;
  font-weight: 500;
  color: #9ca3af;
}

.day-score-auto-hint {
  font-size: 11px;
  color: #a855f7;
  margin-left: 8px;
  padding: 2px 6px;
  background: rgba(168, 85, 247, 0.1);
  border-radius: 6px;
}

.day-score-manual-hint {
  font-size: 11px;
  color: #6b7280;
  margin-left: 8px;
  padding: 2px 6px;
  background: rgba(107, 114, 128, 0.1);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.day-score-manual-hint:active {
  background: rgba(107, 114, 128, 0.2);
  transform: scale(0.95);
}

.day-score-display.clickable {
  cursor: pointer;
  transition: all 0.15s ease;
}

.day-score-display.clickable:active {
  transform: scale(0.98);
  background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
}

/* Day Score Picker Modal (красивый слайдер) */
.day-score-picker-modal {
  padding-bottom: 24px;
}

.day-score-face {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 16px 0;
  gap: 4px;
}

.day-score-face-emoji {
  font-size: 56px;
  line-height: 1;
  animation: mood-face-appear 0.4s ease-out;
}

.day-score-face-text {
  font-size: 16px;
  font-weight: 600;
  color: #6b7280;
  transition: color 0.2s ease;
}

.day-score-big-value {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: 6px;
  padding: 8px 0 20px;
}

.day-score-number {
  font-size: 64px;
  font-weight: 700;
  line-height: 1;
  transition: color 0.2s ease;
}

.day-score-of-ten {
  font-size: 24px;
  font-weight: 500;
  color: #9ca3af;
}

.day-score-presets {
  display: flex;
  gap: 10px;
  padding: 0 16px;
  margin-bottom: 16px;
}

.day-score-preset {
  flex: 1;
  padding: 12px 8px;
  border-radius: 14px;
  border: 2px solid #e5e7eb;
  background: #fff;
  font-size: 14px;
  font-weight: 600;
  color: #374151;
  cursor: pointer;
  transition: all 0.15s ease;
}

.day-score-preset:active {
  transform: scale(0.96);
}

.day-score-preset-bad.active {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
  border-color: #ef4444;
}

.day-score-preset-ok.active {
  background: rgba(234, 179, 8, 0.1);
  color: #ca8a04;
  border-color: #eab308;
}

.day-score-preset-good.active {
  background: rgba(16, 185, 129, 0.1);
  color: #10b981;
  border-color: #10b981;
}

.day-score-slider-container {
  padding: 0 20px;
}

.day-score-slider {
  margin-bottom: 8px;
}

.day-score-slider-labels {
  display: flex;
  justify-content: space-between;
  font-size: 18px;
  padding: 0 4px;
  opacity: 0.7;
}

/* ====================================
   Sleep Quality Picker Modal Styles
   ==================================== */
.sleep-quality-picker-modal {
  padding-bottom: calc(env(safe-area-inset-bottom, 20px) + 40px);
}

.sleep-quality-face {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 16px 0;
  gap: 4px;
}

.sleep-quality-face-emoji {
  font-size: 56px;
  line-height: 1;
  animation: mood-face-appear 0.4s ease-out;
}

.sleep-quality-face-text {
  font-size: 16px;
  font-weight: 600;
  color: #6b7280;
  transition: color 0.2s ease;
}

.sleep-quality-big-value {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: 4px;
  padding: 8px 0 20px;
}

.sleep-quality-number {
  font-size: 56px;
  font-weight: 700;
  line-height: 1;
  transition: color 0.2s ease;
}

.sleep-quality-stars {
  font-size: 20px;
  color: #fbbf24;
  letter-spacing: -2px;
}

.sleep-quality-of-ten {
  font-size: 24px;
  font-weight: 500;
  color: #9ca3af;
}

.sleep-quality-presets {
  display: flex;
  gap: 10px;
  padding: 0 16px;
  margin-bottom: 16px;
}

.sleep-quality-preset {
  flex: 1;
  padding: 12px 8px;
  border-radius: 14px;
  border: 2px solid #e5e7eb;
  background: #fff;
  font-size: 14px;
  font-weight: 600;
  color: #374151;
  cursor: pointer;
  transition: all 0.15s ease;
}

.sleep-quality-preset:active {
  transform: scale(0.96);
}

.sleep-quality-preset-bad.active {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
  border-color: #ef4444;
}

.sleep-quality-preset-ok.active {
  background: rgba(234, 179, 8, 0.1);
  color: #ca8a04;
  border-color: #eab308;
}

.sleep-quality-preset-good.active {
  background: rgba(16, 185, 129, 0.1);
  color: #10b981;
  border-color: #10b981;
}

.sleep-quality-slider-container {
  padding: 0 20px;
  margin-bottom: 16px;
}

.sleep-quality-slider {
  margin-bottom: 8px;
}

.sleep-quality-slider-labels {
  display: flex;
  justify-content: space-between;
  font-size: 18px;
  padding: 0 4px;
  opacity: 0.7;
}

/* Резервируем место для comment-prompt чтобы не прыгало */
.sleep-quality-comment-wrapper {
  min-height: 70px;
  margin: 0 16px 16px;
  transition: all 0.3s ease;
}

.sleep-quality-comment-prompt {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 12px 14px;
  background: rgba(156, 163, 175, 0.08);
  border: 1px solid rgba(156, 163, 175, 0.15);
  border-radius: 14px;
  transition: all 0.3s ease;
}

/* Negative state - плохой сон (1-4) */
.sleep-quality-comment-prompt.negative {
  background: rgba(239, 68, 68, 0.08);
  border-color: rgba(239, 68, 68, 0.15);
}

/* Positive state - хороший сон (8-10) */
.sleep-quality-comment-prompt.positive {
  background: rgba(16, 185, 129, 0.08);
  border-color: rgba(16, 185, 129, 0.15);
}

/* Neutral state */
.sleep-quality-comment-prompt.neutral {
  background: rgba(156, 163, 175, 0.08);
  border-color: rgba(156, 163, 175, 0.15);
}

/* Общие стили для comment prompt header */
.comment-prompt-header {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* История комментариев */
.comment-history {
  font-size: 12px;
  color: #6b7280;
  background: rgba(255, 255, 255, 0.5);
  padding: 8px 10px;
  border-radius: 8px;
  white-space: pre-line;
  line-height: 1.5;
  max-height: 80px;
  overflow-y: auto;
}

.sleep-quality-comment-icon {
  font-size: 20px;
  flex-shrink: 0;
}

.sleep-quality-comment-text {
  font-size: 13px;
  font-weight: 500;
  color: #6b7280;
  white-space: nowrap;
}

.sleep-quality-comment-input {
  width: 100%;
  border: none;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 8px;
  padding: 8px 10px;
  font-size: 14px;
  color: #1c1c1e;
  outline: none;
}

.sleep-quality-comment-input::placeholder {
  color: #9ca3af;
}

.sleep-quality-comment-input:focus {
  background: #fff;
  box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
}

.sleep-quality-hours-info {
  margin-top: 16px;
  padding: 10px 16px;
  text-align: center;
  font-size: 14px;
  color: #6b7280;
}

.sleep-quality-hours-info strong {
  color: #6366f1;
}

/* Dark mode for Sleep Quality */
.dark .sleep-quality-picker-modal {
  background: #1c1c1e;
}

.dark .sleep-quality-face-text {
  color: #9ca3af;
}

.dark .sleep-quality-preset {
  background: #2c2c2e;
  border-color: #3a3a3c;
  color: #f3f4f6;
}

.dark .sleep-quality-preset-bad.active {
  background: rgba(239, 68, 68, 0.2);
}

.dark .sleep-quality-preset-ok.active {
  background: rgba(234, 179, 8, 0.2);
}

.dark .sleep-quality-preset-good.active {
  background: rgba(16, 185, 129, 0.2);
}

.dark .sleep-quality-comment-prompt {
  background: rgba(239, 68, 68, 0.12);
  border-color: rgba(239, 68, 68, 0.25);
}

.dark .comment-history {
  background: rgba(255, 255, 255, 0.08);
  color: #9ca3af;
}

.dark .sleep-quality-comment-input {
  background: rgba(255, 255, 255, 0.08);
  color: #f3f4f6;
}

.dark .sleep-quality-comment-input::placeholder {
  color: #6b7280;
}

.dark .sleep-quality-comment-input:focus {
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3);
}

.dark .sleep-quality-hours-info {
  color: #9ca3af;
}

.day-score-auto-info {
  margin: 20px 16px 0;
  padding: 12px 14px;
  background: linear-gradient(135deg, rgba(168, 85, 247, 0.08), rgba(139, 92, 246, 0.08));
  border-radius: 12px;
  font-size: 13px;
  color: #6b7280;
  text-align: center;
}

.day-score-auto-info strong {
  color: #8b5cf6;
}

/* Wrapper с фиксированной высотой чтобы модалка не прыгала */
.day-score-comment-wrapper {
  min-height: 70px;
  margin: 0 16px 16px;
  transition: all 0.3s ease;
}

/* Prompt для комментария — базовые стили */
.day-score-comment-prompt {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 12px 14px;
  border-radius: 14px;
  transition: all 0.3s ease;
}

/* Негативный стиль (плохая оценка 1-4) — красноватый */
.day-score-comment-prompt.negative {
  background: rgba(239, 68, 68, 0.08);
  border: 1px solid rgba(239, 68, 68, 0.15);
}

/* Позитивный стиль (хорошая оценка 7-10) — зеленый */
.day-score-comment-prompt.positive {
  background: rgba(16, 185, 129, 0.08);
  border: 1px solid rgba(16, 185, 129, 0.15);
}

/* Нейтральный стиль (средняя оценка 5-6) — серый */
.day-score-comment-prompt.neutral {
  background: rgba(107, 114, 128, 0.06);
  border: 1px solid rgba(107, 114, 128, 0.12);
}

@keyframes comment-prompt-appear {
  0% { opacity: 0; transform: translateY(-8px); }
  100% { opacity: 1; transform: translateY(0); }
}

.day-score-comment-icon {
  font-size: 20px;
  flex-shrink: 0;
}

.day-score-comment-text {
  font-size: 13px;
  font-weight: 500;
  color: #6b7280;
  white-space: nowrap;
}

.day-score-comment-input {
  width: 100%;
  border: none;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 8px;
  padding: 8px 10px;
  font-size: 14px;
  color: #1c1c1e;
  outline: none;
}

.day-score-comment-input::placeholder {
  color: #9ca3af;
}

.day-score-comment-input:focus {
  background: #fff;
  box-shadow: 0 0 0 2px rgba(107, 114, 128, 0.2);
}

/* Focus стили для разных состояний */
.day-score-comment-prompt.negative .day-score-comment-input:focus {
  box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
}

.day-score-comment-prompt.positive .day-score-comment-input:focus {
  box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
}

/* Цвет текста для разных состояний */
.day-score-comment-prompt.positive .day-score-comment-text {
  color: #059669;
}

.day-score-comment-prompt.negative .day-score-comment-text {
  color: #dc2626;
}

.day-score-comment-prompt.neutral .day-score-comment-text {
  color: #6b7280;
}

/* Legacy (можно удалить) */
.day-score-btn {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 12px;
  background: #fff;
  border: 1px solid #fce7f3;
  border-radius: 10px;
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.day-score-btn:active {
  transform: scale(0.98);
  background: #fdf2f8;
}

.day-score-label {
  font-size: 13px;
  color: #9ca3af;
}

.day-score-value {
  font-size: 14px;
  font-weight: 600;
  color: #be185d;
}

/* Dark theme for day score */
[data-theme="dark"] .day-score-display {
  background: linear-gradient(135deg, #3d2a35 0%, #4a2a3a 100%);
}

[data-theme="dark"] .day-score-value-big {
  color: #f9a8d4;
}

[data-theme="dark"] .day-score-auto-hint {
  background: rgba(168, 85, 247, 0.2);
  color: #c4b5fd;
}

[data-theme="dark"] .day-score-manual-hint {
  background: rgba(142, 142, 147, 0.2);
  color: #8e8e93;
}

[data-theme="dark"] .day-score-display.clickable:active {
  background: linear-gradient(135deg, #4a2a3a 0%, #5a2a45 100%);
}

/* Dark theme for sleep quality */
[data-theme="dark"] .sleep-quality-display {
  background: linear-gradient(135deg, #2e2a3d 0%, #3a2a4a 100%);
}

[data-theme="dark"] .sleep-quality-value-big {
  color: #c4b5fd;
}

[data-theme="dark"] .sleep-duration-hint {
  background: rgba(139, 92, 246, 0.2);
  color: #a78bfa;
}

[data-theme="dark"] .sleep-quality-display.clickable:active {
  background: linear-gradient(135deg, #3a2a4a 0%, #4a2a5a 100%);
}

[data-theme="dark"] .day-score-face-text {
  color: #a1a1aa;
}

[data-theme="dark"] .day-score-of-ten {
  color: #6b7280;
}

[data-theme="dark"] .day-score-preset {
  background: #2c2c2e;
  border-color: #48484a;
  color: #e5e5ea;
}

[data-theme="dark"] .day-score-auto-info {
  background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(139, 92, 246, 0.15));
  color: #a1a1aa;
}

[data-theme="dark"] .day-score-auto-info strong {
  color: #a78bfa;
}

[data-theme="dark"] .day-score-comment-prompt {
  background: rgba(239, 68, 68, 0.15);
  border-color: rgba(239, 68, 68, 0.25);
}

[data-theme="dark"] .day-score-comment-text {
  color: #a1a1aa;
}

[data-theme="dark"] .day-score-comment-input {
  background: rgba(44, 44, 46, 0.8);
  color: #f2f2f7;
}

[data-theme="dark"] .day-score-comment-input::placeholder {
  color: #636366;
}

[data-theme="dark"] .day-score-comment-input:focus {
  background: #2c2c2e;
  box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3);
}

/* Кнопка качества сна */
.sleep-quality-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 14px;
  background: #fff;
  border: 1px solid #fce7f3;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s;
}

.sleep-quality-btn:active {
  transform: scale(0.98);
  background: #fdf2f8;
}

.sleep-quality-label {
  font-size: 13px;
  color: #6b7280;
}

.sleep-quality-value {
  font-size: 15px;
  font-weight: 600;
  color: #f59e0b;
}

/* Настроение — красивые карточки */
.day-mood-row {
  display: flex;
  gap: 6px;
  margin-bottom: 8px;
}

/* Day insights row (last meal, correlations) */
.day-insights-row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 8px;
  justify-content: center;
}

.day-insight {
  font-size: 11px;
  padding: 4px 8px;
  background: rgba(0, 0, 0, 0.04);
  border-radius: 8px;
  color: #6b7280;
}

.day-insight.correlation {
  background: rgba(99, 102, 241, 0.1);
  color: #4f46e5;
}

/* Smart tips for low scores */
.smart-tip {
  font-size: 12px;
  padding: 8px 12px;
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border-radius: 8px;
  color: #92400e;
  text-align: center;
  margin-bottom: 8px;
  animation: smartTipFade 0.4s ease-out;
}

@keyframes smartTipFade {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}

.mood-card {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 8px 4px;
  background: linear-gradient(135deg, #fef7f9 0%, #fff 100%);
  border: 1px solid #fce7f3;
  border-radius: 10px;
  transition: all 0.2s;
}

.mood-card:active {
  transform: scale(0.97);
}

.mood-card-icon {
  font-size: 22px;
  margin-bottom: 4px;
}

.mood-card-label {
  font-size: 11px;
  color: #374151;
  font-weight: 500;
  margin-bottom: 2px;
}

.mood-card-value {
  font-size: 16px;
  font-weight: 700;
  color: #111827;
}

/* === COMPACT ACTIVITY INPUT === */
.compact-activity {
  margin-bottom: 8px;
  background: var(--activity-bg);
  border-color: var(--activity-border);
}

/* Steps Slider */
.steps-slider-container {
  margin-bottom: 20px;
}

/* Зона без свайпа — увеличенный padding для touch */
.steps-slider-container.no-swipe-zone {
  padding: 50px 0;
  margin: -50px 0 -30px 0; /* Компенсируем padding визуально */
}

.steps-motivation {
  text-align: center;
  font-size: 12px;
  font-weight: 600;
  margin-top: 8px;
  padding: 4px 8px;
  background: rgba(0, 0, 0, 0.03);
  border-radius: 8px;
  animation: fadeInUp 0.3s ease;
}

/* === SKELETON LOADER === */
@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

.skeleton-page {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 8px 0;
}

.skeleton-card {
  background: #fff;
  border-radius: 12px;
  padding: 16px;
  border: 1px solid #e2e8f0;
}

.skeleton-header {
  height: 14px;
  width: 120px;
  background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 4px;
  margin-bottom: 12px;
}

.skeleton-metrics {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  margin-bottom: 12px;
}

.skeleton-metric {
  height: 64px;
  background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
}

.skeleton-sparkline {
  height: 44px;
  background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
  margin-bottom: 12px;
}

.skeleton-progress {
  height: 48px;
  background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
  margin-bottom: 12px;
}

.skeleton-macros {
  display: flex;
  justify-content: space-around;
  gap: 16px;
}

.skeleton-ring {
  width: 56px;
  height: 72px;
  background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
}

.skeleton-slider {
  height: 40px;
  background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
  margin-bottom: 12px;
}

.skeleton-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

.skeleton-block {
  height: 80px;
  background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
}

.skeleton-meal-header {
  height: 20px;
  width: 80px;
  background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 4px;
  margin-bottom: 12px;
}

/* ═══════════════════════════════════════════════════════════════════
   APP LOADER — Красивый полноэкранный прелоадер
   ═══════════════════════════════════════════════════════════════════ */

.app-loader {
  position: fixed;
  inset: 0;
  background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  padding: 24px;
  animation: appLoaderFadeIn 0.3s ease;
}

@keyframes appLoaderFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.app-loader-header {
  text-align: center;
  margin-bottom: 32px;
}

.app-loader-logo {
  font-size: 56px;
  margin-bottom: 16px;
  animation: appLoaderPulse 2s ease-in-out infinite;
}

@keyframes appLoaderPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.app-loader-title {
  font-size: 20px;
  font-weight: 600;
  color: #1e293b;
  margin-bottom: 6px;
}

.app-loader-subtitle {
  font-size: 14px;
  color: #64748b;
}

.app-loader-skeleton {
  width: 100%;
  max-width: 430px;
  background: #fff;
  border-radius: 24px;
  padding: 16px;
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
  overflow: hidden;
}

.app-loader-skeleton .skeleton-header {
  margin-bottom: 16px;
  height: auto;
  width: auto;
}

.app-loader-skeleton .skeleton-bar {
  height: 8px;
  background: linear-gradient(90deg, #e2e8f0 25%, #cbd5e1 50%, #e2e8f0 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 4px;
}

.app-loader-skeleton .skeleton-bar-xp {
  margin-bottom: 12px;
}

.app-loader-skeleton .skeleton-nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.app-loader-skeleton .skeleton-circle {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: linear-gradient(90deg, #e2e8f0 25%, #cbd5e1 50%, #e2e8f0 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  flex-shrink: 0;
}

.app-loader-skeleton .skeleton-rect {
  height: 36px;
  border-radius: 8px;
  background: linear-gradient(90deg, #e2e8f0 25%, #cbd5e1 50%, #e2e8f0 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

.app-loader-skeleton .skeleton-client {
  flex: 1;
}

.app-loader-skeleton .skeleton-content {
  margin: 20px 0;
}

.app-loader-skeleton .skeleton-sparkline {
  height: 80px;
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 4px;
  padding: 12px;
  background: #f8fafc;
  border-radius: 12px;
  margin-bottom: 16px;
}

.app-loader-skeleton .skeleton-dot {
  flex: 1;
  min-width: 6px;
  background: linear-gradient(180deg, #3b82f6 0%, #60a5fa 100%);
  border-radius: 3px 3px 0 0;
  opacity: 0.3;
  animation: skeletonDotPulse 1.5s ease-in-out infinite;
}

@keyframes skeletonDotPulse {
  0%, 100% { opacity: 0.2; }
  50% { opacity: 0.5; }
}

.app-loader-skeleton .skeleton-cards {
  display: flex;
  gap: 8px;
}

.app-loader-skeleton .skeleton-card {
  flex: 1;
  height: 60px;
  background: linear-gradient(90deg, #e2e8f0 25%, #cbd5e1 50%, #e2e8f0 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 12px;
  border: none;
  padding: 0;
}

.app-loader-skeleton .skeleton-card-wide {
  flex: 2;
}

.app-loader-skeleton .skeleton-tabs {
  display: flex;
  justify-content: space-around;
  padding-top: 16px;
  border-top: 1px solid #e2e8f0;
  margin-top: 16px;
}

.app-loader-skeleton .skeleton-tab {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  background: linear-gradient(90deg, #e2e8f0 25%, #cbd5e1 50%, #e2e8f0 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

.app-loader-skeleton .skeleton-tab-active {
  background: linear-gradient(90deg, #dbeafe 25%, #bfdbfe 50%, #dbeafe 75%);
  background-size: 200% 100%;
}

.app-loader-spinner {
  margin-top: 24px;
  width: 24px;
  height: 24px;
  border: 3px solid #e2e8f0;
  border-top-color: #3b82f6;
  border-radius: 50%;
  animation: appLoaderSpin 0.8s linear infinite;
}

@keyframes appLoaderSpin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Dark mode */
[data-theme="dark"] .app-loader {
  background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
}

[data-theme="dark"] .app-loader-title {
  color: #f1f5f9;
}

[data-theme="dark"] .app-loader-subtitle {
  color: #94a3b8;
}

[data-theme="dark"] .app-loader-skeleton {
  background: #1e293b;
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .app-loader-skeleton .skeleton-bar,
[data-theme="dark"] .app-loader-skeleton .skeleton-circle,
[data-theme="dark"] .app-loader-skeleton .skeleton-rect,
[data-theme="dark"] .app-loader-skeleton .skeleton-card,
[data-theme="dark"] .app-loader-skeleton .skeleton-tab {
  background: linear-gradient(90deg, #334155 25%, #475569 50%, #334155 75%);
  background-size: 200% 100%;
}

[data-theme="dark"] .app-loader-skeleton .skeleton-sparkline {
  background: #0f172a;
}

[data-theme="dark"] .app-loader-skeleton .skeleton-tabs {
  border-top-color: #334155;
}

[data-theme="dark"] .app-loader-spinner {
  border-color: #334155;
  border-top-color: #3b82f6;
}

.skeleton-search {
  height: 40px;
  background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
  margin-bottom: 12px;
}

.skeleton-item {
  height: 56px;
  background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 8px;
  margin-bottom: 8px;
}

.skeleton-item:last-child {
  margin-bottom: 0;
}

/* Stagger animation delays */
.skeleton-metric:nth-child(1) { animation-delay: 0s; }
.skeleton-metric:nth-child(2) { animation-delay: 0.1s; }
.skeleton-metric:nth-child(3) { animation-delay: 0.2s; }
.skeleton-metric:nth-child(4) { animation-delay: 0.3s; }

.skeleton-ring:nth-child(1) { animation-delay: 0s; }
.skeleton-ring:nth-child(2) { animation-delay: 0.15s; }
.skeleton-ring:nth-child(3) { animation-delay: 0.3s; }

.skeleton-item:nth-child(1) { animation-delay: 0s; }
.skeleton-item:nth-child(2) { animation-delay: 0.1s; }

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.steps-slider-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.steps-label {
  font-size: 13px;
  font-weight: 600;
  color: #334155;
}

.steps-value {
  font-size: 13px;
  color: #64748b;
}

.steps-value b {
  color: #0ea5e9;
  font-weight: 700;
}

.steps-value .steps-goal {
  color: #16a34a;
  font-weight: 700;
}

.steps-kcal-hint {
  font-size: 11px;
  color: #94a3b8;
  font-weight: 400;
}

.steps-slider {
  position: relative;
  height: 28px;
  cursor: pointer;
  touch-action: none;
  -webkit-tap-highlight-color: transparent;
}

.steps-slider-track {
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 8px;
  transform: translateY(-50%);
  background: #e2e8f0;
  border-radius: 4px;
}

.steps-slider-goal-mark {
  position: absolute;
  top: 50%;
  width: 2px;
  height: 16px;
  transform: translate(-50%, -50%);
  background: #16a34a;
  border-radius: 1px;
  z-index: 1;
  opacity: 0.7;
}

.steps-goal-label {
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  font-size: 9px;
  font-weight: 500;
  color: #94a3b8;
  white-space: nowrap;
  margin-top: 6px;
}

.steps-slider-fill {
  position: absolute;
  top: 50%;
  left: 0;
  height: 8px;
  transform: translateY(-50%);
  border-radius: 4px;
  transition: width 0.05s ease-out, background 0.15s ease;
}

.steps-slider-thumb {
  position: absolute;
  top: 50%;
  width: 24px;
  height: 24px;
  transform: translate(-50%, -50%);
  background: #fff;
  border: 3px solid;
  border-radius: 50%;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  transition: transform 0.1s ease, box-shadow 0.1s ease, border-color 0.15s ease;
}

.steps-slider-thumb:hover,
.steps-slider:active .steps-slider-thumb {
  transform: translate(-50%, -50%) scale(1.15);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.compact-activity-inputs {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
  margin-bottom: 8px;
}

.compact-activity-field {
  display: flex;
  align-items: center;
  gap: 6px;
}

.compact-activity-label {
  font-size: 12px;
  color: #64748b;
  font-weight: 500;
  min-width: 35px;
}

.compact-activity-field .compact-input {
  width: 70px;
  text-align: center;
  min-height: 36px;
  padding: 6px 8px;
}

.compact-activity-unit {
  font-size: 12px;
  color: #94a3b8;
}

.compact-activity-stats {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
  font-size: 12px;
  color: #64748b;
  padding: 6px 0;
  border-top: 1px solid #f1f5f9;
}

.compact-activity-stats b {
  color: #334155;
  font-weight: 600;
}

.compact-activity-stats.secondary {
  padding-top: 6px;
  border-top: 1px dashed #e2e8f0;
  color: #94a3b8;
}

.compact-activity-stats.secondary b {
  color: #64748b;
}

/* Transitions для плавных изменений */
.metrics-card {
  transition: transform 0.15s ease, box-shadow 0.15s ease, background-color 0.3s ease, border-color 0.3s ease;
}

.metrics-value {
  transition: color 0.3s ease;
}

.metrics-progress-bar {
  transition: width 0.3s ease, background 0.3s ease;
}

/* Кликабельные карточки */
.metrics-card-clickable:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
}

.metrics-card-clickable:active {
  transform: translateY(0);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

/* Умная подсказка */
.metrics-hint {
  font-size: 10px;
  color: #64748b;
  margin-top: 4px;
  font-weight: 500;
}

/* Тренд веса */
.metrics-trend {
  font-size: 11px;
  color: #94a3b8;
  margin-top: 2px;
  font-weight: 500;
}

/* Визуальные связи (стрелки между карточками) */
.metrics-card:not(:last-child)::after {
  content: '→';
  position: absolute;
  right: -14px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 14px;
  color: #cbd5e1;
  pointer-events: none;
}

.metrics-card {
  position: relative;
}

/* Убираем стрелку после карточки "Съедено" (перед Осталось группа другая) */
.metrics-card:nth-child(3)::after {
  content: '•';
  font-size: 8px;
  color: #e5e7eb;
}

/* Mobile responsive для metrics cards */
@media (max-width: 640px) {
  .metrics-cards {
    gap: 6px;
  }
  
  .metrics-card {
    flex: 1 1 0;
    min-width: 0;
    padding: 8px 4px;
  }
  
  /* Первые 4 карточки в ряд */
  .metrics-card:not(.metrics-card-wide) {
    flex: 1 1 calc(25% - 5px);
  }
  
  /* Goal progress bar mobile */
  .goal-progress-bar {
    padding: 10px 12px;
  }
  
  .goal-progress-title {
    font-size: 12px;
  }
  
  .goal-eaten {
    font-size: 15px;
  }
  
  .goal-target {
    font-size: 13px;
  }
  
  .goal-progress-footer {
    font-size: 11px;
  }
  
  .metrics-icon {
    font-size: 14px;
  }
  
  .metrics-value {
    font-size: 16px;
  }
  
  .metrics-label {
    font-size: 8px;
    letter-spacing: 0;
  }
  
  /* Убираем стрелки на мобильных */
  .metrics-card::after {
    display: none;
  }
  
  /* Скрываем тренд и подсказки на маленьких экранах */
  .metrics-trend,
  .metrics-hint {
    display: none;
  }
  
  .compact-activity-inputs {
    gap: 12px;
  }
  
  .compact-activity-field {
    flex: 1 1 calc(50% - 6px);
  }
  
  .compact-activity-field .compact-input {
    width: 60px;
  }
  
  .compact-activity-stats {
    gap: 12px;
    font-size: 11px;
  }
}

@media (max-width: 400px) {
  .tab {
    padding: 8px 10px;
    font-size: 12px;
  }

  .btn {
    padding: 8px 12px;
    font-size: 13px;
  }
}

/* Desktop: hide mobile cards */
@media (min-width: 641px) {
  .mobile-products-list {
    display: none !important;
  }
  .mobile-daily-summary {
    display: none !important;
  }
  .mobile-only {
    display: none !important;
  }
}

/* Mobile Daily Summary - table layout для синхронизации ширины столбцов */
.mobile-daily-summary {
  display: none;
  background: #faf5ff;
  border-radius: 8px;
  padding: 4px 2px;
  margin-top: 8px;
  font-size: 11px;
  overflow-x: auto;
}

/* Включаем table display только когда виден */
@media (max-width: 640px) {
  .mobile-daily-summary {
    display: table;
    width: 100%;
    border-collapse: collapse;
  }
}

.mds-header,
.mds-row {
  display: table-row;
}

/* Zebra striping для столбцов */
.mds-header > span,
.mds-row > span {
  display: table-cell;
  padding: 1px 3px;
  text-align: center;
  vertical-align: middle;
  white-space: nowrap;
}

/* Чётные столбцы (2, 4, 6, 8, 10) - затемнённые */
.mds-header > span:nth-child(even),
.mds-row > span:nth-child(even) {
  background: rgba(124, 58, 237, 0.08);
}

/* Нечётные столбцы - светлые (по умолчанию) */
.mds-header > span:nth-child(odd),
.mds-row > span:nth-child(odd) {
  background: transparent;
}

/* Первый столбец (метка) - без фона */
.mds-header > span:first-child,
.mds-row > span:first-child {
  background: transparent !important;
  text-align: left;
  padding-right: 6px;
}

.mds-header {
  font-weight: 600;
  color: #7c3aed;
  font-size: 10px;
}

.mds-label {
  font-weight: 600;
  text-align: left;
  color: #7c3aed;
}

.mds-dim {
  color: #9ca3af;
  font-size: 10px;
}

.mds-dev {
  font-size: 9px;
}

.mds-dev span {
  font-weight: 500;
}

/* Smaller font for slash-separated percentages in dev row */
.mds-dev .mds-dim {
  font-size: 8px;
}

@media (max-width: 640px) {
  .daily-summary {
    display: none !important;
  }
}

/* === iOS-style Bottom Sheet Modal (Glassmorphism) === */
.time-picker-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: 10000;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  animation: fadeIn 0.2s ease;
  -webkit-backdrop-filter: blur(12px);
  backdrop-filter: blur(12px);
}

.time-picker-modal {
  background: rgba(242, 242, 247, 0.95);
  -webkit-backdrop-filter: blur(20px);
  backdrop-filter: blur(20px);
  border-radius: 14px 14px 0 0;
  width: 100%;
  max-width: 500px;
  padding-bottom: env(safe-area-inset-bottom, 20px);
  animation: slideUp 0.3s cubic-bezier(0.32, 0.72, 0, 1);
  touch-action: none;
  will-change: transform;
  box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.15);
}

/* Bottom sheet handle (ручка для свайпа) */
.bottom-sheet-handle {
  display: flex;
  justify-content: center;
  padding: 10px 0 6px;
}

.bottom-sheet-handle::before {
  content: '';
  width: 36px;
  height: 5px;
  background: #d1d1d6;
  border-radius: 3px;
}

/* Анимация закрытия */
.time-picker-modal.closing {
  animation: slideDown 0.25s cubic-bezier(0.32, 0.72, 0, 1) forwards;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

@keyframes slideDown {
  from { transform: translateY(0); }
  to { transform: translateY(100%); }
}

/* Анимации переходов между шагами */
@keyframes slideInFromRight {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideInFromLeft {
  from { transform: translateX(-100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

.time-picker-step {
  animation: slideInFromRight 0.25s ease-out;
}

.time-picker-step.back {
  animation: slideInFromLeft 0.25s ease-out;
}

.time-picker-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  border-bottom: 1px solid #d1d1d6;
}

.time-picker-title {
  font-size: 17px;
  font-weight: 600;
  color: #000;
}

.time-picker-cancel,
.time-picker-confirm {
  background: none;
  border: none;
  font-size: 17px;
  padding: 8px 4px;
  cursor: pointer;
}

.time-picker-cancel {
  color: #007aff;
}

.time-picker-confirm {
  color: #007aff;
  font-weight: 600;
}

.time-picker-confirm.disabled,
.time-picker-confirm:disabled {
  color: #c7c7cc;
  cursor: not-allowed;
  opacity: 0.5;
}

.time-picker-wheels {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  gap: 0;
}

/* Night time hint for meals 00:00-02:59 */
.night-time-hint {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 8px 16px;
  margin: -8px 20px 12px;
  background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
  border-radius: 12px;
  color: #e0e7ff;
  font-size: 13px;
  animation: fadeInHint 0.3s ease-out;
}

.night-time-hint .night-time-icon {
  font-size: 16px;
}

.night-time-hint .night-time-text {
  color: #c7d2fe;
}

.night-time-hint .night-time-text b {
  color: #fff;
  font-weight: 600;
}

@keyframes fadeInHint {
  from { 
    opacity: 0; 
    transform: translateY(-8px); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0); 
  }
}

.time-picker-wheels.mood-wheels {
  gap: 16px;
  padding-bottom: 40px;
}

.time-picker-wheels.mood-wheels .wheel-column {
  width: 70px;
}

.mood-column {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.mood-emoji {
  font-size: 32px;
  line-height: 1;
  margin-bottom: 8px;
}

.mood-label {
  font-size: 12px;
  color: #3c3c43;
  text-align: center;
  margin-top: 12px;
  font-weight: 500;
}

/* Подсказка для первого приёма */
.mood-hint-first {
  text-align: center;
  font-size: 13px;
  color: #8e8e93;
  padding: 8px 20px 16px;
  line-height: 1.4;
}

/* Подсказка "изменилось?" для следующих приёмов */
.mood-hint-change {
  font-size: 11px;
  color: #007aff;
  text-align: center;
  margin-top: 4px;
  font-style: italic;
}

/* === Mood Sliders === */
.mood-sliders {
  display: flex;
  flex-direction: column;
  gap: 24px;
  padding: 16px 24px 32px;
}

.mood-slider-row {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.mood-slider-header {
  display: flex;
  align-items: center;
  gap: 8px;
}

.mood-slider-emoji {
  font-size: 24px;
}

.mood-slider-label {
  font-size: 15px;
  font-weight: 500;
  color: #1c1c1e;
  flex: 1;
}

.mood-slider-value {
  font-size: 20px;
  font-weight: 600;
  min-width: 32px;
  text-align: right;
  color: #007aff;
  transition: color 0.2s ease;
}

/* Dynamic emoji animation */
.mood-emoji-dynamic {
  transition: transform 0.15s ease;
  display: inline-block;
}

.mood-slider-row:active .mood-emoji-dynamic {
  transform: scale(1.2);
}

/* Emoji bounce animation on value change */
@keyframes emoji-bounce {
  0%, 100% { transform: scale(1); }
  25% { transform: scale(1.25) rotate(-5deg); }
  50% { transform: scale(1.15) rotate(5deg); }
  75% { transform: scale(1.2) rotate(-3deg); }
}

@keyframes emoji-shake {
  0%, 100% { transform: translateX(0); }
  20% { transform: translateX(-4px) rotate(-5deg); }
  40% { transform: translateX(4px) rotate(5deg); }
  60% { transform: translateX(-3px) rotate(-3deg); }
  80% { transform: translateX(3px) rotate(3deg); }
}

.mood-emoji-dynamic.animate-bounce {
  animation: emoji-bounce 0.4s ease-out;
}

.mood-emoji-dynamic.animate-shake {
  animation: emoji-shake 0.4s ease-out;
}

/* Progress dots indicator */
.rating-progress-dots {
  display: flex;
  justify-content: center;
  gap: 6px;
  padding: 8px 0 4px;
}

.rating-progress-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #e5e7eb;
  transition: all 0.2s ease;
}

.rating-progress-dot.filled {
  background: #10b981;
  transform: scale(1.1);
}

.rating-progress-dot.partial {
  background: #fbbf24;
}

/* Quick suggestion chips */
.quick-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 8px;
  padding: 0 4px;
}

.quick-chip {
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 500;
  color: #6b7280;
  background: rgba(107, 114, 128, 0.1);
  border: 1px solid rgba(107, 114, 128, 0.15);
  border-radius: 16px;
  cursor: pointer;
  transition: all 0.15s ease;
  white-space: nowrap;
}

.quick-chip:active {
  transform: scale(0.95);
}

.quick-chip.selected {
  background: rgba(16, 185, 129, 0.15);
  border-color: rgba(16, 185, 129, 0.3);
  color: #059669;
}

.quick-chips.negative .quick-chip {
  background: rgba(239, 68, 68, 0.08);
  border-color: rgba(239, 68, 68, 0.15);
  color: #dc2626;
}

.quick-chips.positive .quick-chip {
  background: rgba(16, 185, 129, 0.08);
  border-color: rgba(16, 185, 129, 0.15);
  color: #059669;
}

/* ⏰ Meal timer hint */
.meal-timer-hint {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  margin: 0 16px 8px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 500;
  animation: fade-in-up 0.3s ease;
}

.meal-timer-hint.ok {
  background: rgba(16, 185, 129, 0.1);
  border: 1px solid rgba(16, 185, 129, 0.2);
  color: #059669;
}

.meal-timer-hint.warning {
  background: rgba(245, 158, 11, 0.1);
  border: 1px solid rgba(245, 158, 11, 0.2);
  color: #d97706;
}

.meal-timer-icon {
  font-size: 16px;
}

.meal-timer-text {
  flex: 1;
}

.meal-timer-wave {
  font-size: 11px;
  opacity: 0.8;
}

/* 🎉 Confetti animation */
.confetti-container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 200px;
  overflow: hidden;
  pointer-events: none;
  z-index: 10;
}

.confetti-piece {
  position: absolute;
  width: 10px;
  height: 10px;
  top: -20px;
  border-radius: 2px;
  animation: confetti-fall 2s ease-out forwards;
}

@keyframes confetti-fall {
  0% {
    transform: translateY(0) rotate(0deg) scale(1);
    opacity: 1;
  }
  100% {
    transform: translateY(250px) rotate(720deg) scale(0.5);
    opacity: 0;
  }
}

/* Celebrate emoji animation */
.mood-face-emoji.celebrate {
  animation: celebrate-bounce 0.6s ease-out;
}

@keyframes celebrate-bounce {
  0%, 100% { transform: scale(1); }
  20% { transform: scale(1.3) rotate(-10deg); }
  40% { transform: scale(1.2) rotate(10deg); }
  60% { transform: scale(1.25) rotate(-5deg); }
  80% { transform: scale(1.15) rotate(5deg); }
}

/* Correlation hint */
.correlation-hint {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 12px;
  margin: 8px 16px 0;
  background: rgba(59, 130, 246, 0.08);
  border: 1px solid rgba(59, 130, 246, 0.15);
  border-radius: 12px;
  font-size: 12px;
  color: #3b82f6;
  animation: fade-in-up 0.3s ease;
}

@keyframes fade-in-up {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.correlation-hint-icon {
  font-size: 16px;
}

.correlation-hint-text {
  flex: 1;
  line-height: 1.4;
}

/* Difference indicator */
.mood-diff {
  font-size: 12px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 8px;
  margin-left: 6px;
}

.mood-diff.diff-up {
  background: rgba(16, 185, 129, 0.15);
  color: #10b981;
}

.mood-diff.diff-down {
  background: rgba(239, 68, 68, 0.15);
  color: #ef4444;
}

.mood-diff.diff-same {
  background: rgba(107, 114, 128, 0.15);
  color: #6b7280;
}

/* Quick preset buttons */
.mood-presets {
  display: flex;
  gap: 8px;
  margin-bottom: 8px;
}

.mood-preset {
  flex: 1;
  padding: 8px 4px;
  border-radius: 12px;
  border: 1.5px solid #e5e7eb;
  background: #fff;
  font-size: 12px;
  font-weight: 500;
  color: #374151;
  cursor: pointer;
  transition: all 0.15s ease;
}

.mood-preset:active {
  transform: scale(0.96);
}

.mood-preset.active {
  border-color: transparent;
}

.mood-preset-bad.active {
  background: rgba(239, 68, 68, 0.15);
  color: #ef4444;
  border-color: #ef4444;
}

.mood-preset-ok.active {
  background: rgba(59, 130, 246, 0.15);
  color: #3b82f6;
  border-color: #3b82f6;
}

.mood-preset-good.active {
  background: rgba(16, 185, 129, 0.15);
  color: #10b981;
  border-color: #10b981;
}

/* Mood Face Avatar */
.mood-face-avatar {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 8px 0 12px;
  gap: 4px;
}

.mood-face-emoji {
  font-size: 48px;
  line-height: 1;
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  animation: mood-face-appear 0.4s ease-out;
}

@keyframes mood-face-appear {
  0% { transform: scale(0.5); opacity: 0; }
  60% { transform: scale(1.1); }
  100% { transform: scale(1); opacity: 1; }
}

.mood-face-text {
  font-size: 14px;
  font-weight: 600;
  color: #6b7280;
  transition: color 0.2s ease;
}

/* Time context hint */
.mood-time-hint {
  text-align: center;
  font-size: 14px;
  color: #6b7280;
  padding: 4px 0 8px;
}

/* AI Insight */
.mood-ai-insight {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 14px;
  margin: 0 0 12px;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1));
  border-radius: 12px;
  font-size: 13px;
  color: #6366f1;
  border: 1px solid rgba(99, 102, 241, 0.2);
}

.mood-ai-insight span:first-child {
  font-size: 18px;
}

/* Slider track with yesterday mark */
.mood-slider-track {
  position: relative;
  width: 100%;
}

.yesterday-mark {
  position: absolute;
  top: -14px;
  transform: translateX(-50%);
  font-size: 10px;
  color: #9ca3af;
  opacity: 0.7;
  pointer-events: none;
}

/* Pulse animation for value change */
.mood-slider-value.pulse {
  animation: value-pulse 0.3s ease;
}

@keyframes value-pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}

/* Mood Journal Wrapper - фиксированная высота чтобы не прыгало */
.mood-journal-wrapper {
  min-height: 60px;
  margin: 0 16px 16px;
  transition: all 0.3s ease;
}

/* Mood Journal Prompt — базовые стили */
.mood-journal-prompt {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 14px;
  border-radius: 12px;
  transition: all 0.3s ease;
}

/* Негативный стиль — красноватый */
.mood-journal-prompt.negative {
  background: rgba(239, 68, 68, 0.08);
  border: 1px solid rgba(239, 68, 68, 0.15);
}

/* Позитивный стиль — зеленый */
.mood-journal-prompt.positive {
  background: rgba(16, 185, 129, 0.08);
  border: 1px solid rgba(16, 185, 129, 0.15);
}

/* Нейтральный стиль — серый */
.mood-journal-prompt.neutral {
  background: rgba(156, 163, 175, 0.08);
  border: 1px solid rgba(156, 163, 175, 0.15);
}

.mood-journal-prompt.positive .mood-journal-text {
  color: #059669;
}

.mood-journal-prompt.negative .mood-journal-text {
  color: #dc2626;
}

.mood-journal-prompt.neutral .mood-journal-text {
  color: #6b7280;
}

.mood-journal-icon {
  font-size: 20px;
}

.mood-journal-text {
  flex: 1;
  font-size: 13px;
  color: #6b7280;
}

.mood-journal-btn {
  padding: 6px 14px;
  background: #6b7280;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s ease;
}

.mood-journal-btn.positive {
  background: #10b981;
}

.mood-journal-wrapper.negative .mood-journal-btn {
  background: #ef4444;
}

.mood-journal-btn:active {
  transform: scale(0.95);
}

/* Journal input field */
.mood-journal-input {
  width: 100%;
  border: none;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 8px;
  padding: 10px 12px;
  font-size: 14px;
  color: #1c1c1e;
  outline: none;
  margin-top: 8px;
}

.mood-journal-input::placeholder {
  color: #9ca3af;
}

.mood-journal-input:focus {
  background: #fff;
  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
}

.mood-journal-prompt.positive .mood-journal-input:focus {
  box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
}

.mood-journal-prompt.negative .mood-journal-input:focus {
  box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
}

/* Slider footer with sparkline */
.mood-slider-footer {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 4px;
}

.mood-sparkline {
  opacity: 0.8;
}

.mood-slider-footer .mood-hint-change {
  font-size: 11px;
  color: #9ca3af;
  margin: 0;
}

/* Range slider styling */
.mood-slider {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 8px;
  border-radius: 4px;
  outline: none;
  cursor: pointer;
}

/* Positive gradient: red → blue → green */
.mood-slider-positive {
  background: linear-gradient(to right, 
    #ef4444 0%, 
    #f97316 20%, 
    #eab308 35%,
    #3b82f6 50%, 
    #22c55e 70%,
    #10b981 100%
  );
}

/* Negative gradient (stress): green → blue → red */
.mood-slider-negative {
  background: linear-gradient(to right, 
    #10b981 0%, 
    #22c55e 30%,
    #3b82f6 50%, 
    #eab308 65%,
    #f97316 80%, 
    #ef4444 100%
  );
}

/* Slider thumb */
.mood-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2), 0 0 0 1px rgba(0,0,0,0.1);
  cursor: pointer;
  transition: transform 0.1s ease;
}

.mood-slider::-webkit-slider-thumb:active {
  transform: scale(1.15);
}

.mood-slider::-moz-range-thumb {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2), 0 0 0 1px rgba(0,0,0,0.1);
  cursor: pointer;
  border: none;
}

.mood-slider-labels {
  display: flex;
  justify-content: space-between;
  font-size: 16px;
  padding: 0 4px;
  opacity: 0.7;
}

.mood-slider-row .mood-hint-change {
  text-align: left;
  margin-top: 2px;
}

.time-picker-separator {
  font-size: 28px;
  font-weight: 600;
  color: #000;
  padding: 0 8px;
  align-self: center;
  margin-top: 24px;
}

.wheel-column {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  width: 80px;
}

.wheel-label {
  font-size: 13px;
  color: #8e8e93;
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.wheel-viewport {
  height: 220px;
  overflow: hidden;
  position: relative;
  width: 100%;
  touch-action: none; /* Полный контроль над touch */
  -webkit-overflow-scrolling: auto; /* Отключаем нативный скролл */
}

.wheel-track {
  will-change: transform;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.wheel-item {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  color: #8e8e93;
  cursor: pointer;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  width: 100%;
  flex-shrink: 0;
  will-change: transform, opacity;
}

.wheel-item.selected {
  color: #000;
  font-weight: 600;
  font-size: 24px;
}

.wheel-highlight {
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 44px;
  transform: translateY(-50%);
  background: rgba(120, 120, 128, 0.12);
  border-radius: 8px;
  pointer-events: none;
}

/* === Grams Input Modal === */
.grams-modal {
  padding-bottom: max(env(safe-area-inset-bottom, 20px), 20px);
  transition: transform 0.2s ease-out;
}

.grams-modal.closing {
  transform: translateY(100%);
  opacity: 0.5;
}

.grams-modal-title {
  max-width: 200px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.grams-preview {
  display: flex;
  justify-content: center;
  align-items: baseline;
  padding: 20px 16px 16px;
  font-size: 28px;
  font-weight: 600;
}

.grams-preview-value {
  color: #007aff;
}

.grams-preview-separator {
  color: #8e8e93;
  margin: 0 8px;
  font-weight: 400;
}

.grams-preview-kcal {
  color: #000;
  /* Smooth animation on value change */
  transition: transform 0.15s ease-out, color 0.15s ease;
  display: inline-block;
  font-weight: 500;
}

/* Kcal color coding */
.grams-preview-kcal.kcal-low {
  color: #34c759;
}
.grams-preview-kcal.kcal-mid {
  color: #ff9500;
}
.grams-preview-kcal.kcal-high {
  color: #ff3b30;
}

.grams-preview-kcal.animating {
  animation: kcal-pulse 0.3s ease-out;
}

@keyframes kcal-pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.15); }
  100% { transform: scale(1); }
}

/* "Обычно вы едите" hint */
.grams-hint {
  text-align: center;
  padding: 8px 16px;
  font-size: 14px;
  color: #666;
  cursor: pointer;
  transition: color 0.15s;
}
.grams-hint:hover {
  color: #007aff;
}
.grams-hint:active {
  opacity: 0.7;
}

/* Kcal Calculator */
.kcal-calculator {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 8px 16px;
}
.kcal-calc-toggle {
  font-size: 14px;
  padding: 6px 12px;
  border: 1px solid #e0e0e0;
  border-radius: 16px;
  background: #f8f8f8;
  color: #666;
  cursor: pointer;
  transition: all 0.15s;
}
.kcal-calc-toggle:hover {
  background: #f0f0f0;
}
.kcal-calc-toggle.active {
  background: #007aff;
  border-color: #007aff;
  color: #fff;
}
.kcal-calc-input {
  display: flex;
  align-items: center;
  gap: 8px;
}
.kcal-calc-input input {
  width: 80px;
  padding: 6px 10px;
  font-size: 16px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  text-align: center;
  background: #fff;
}
.kcal-calc-input input:focus {
  outline: none;
  border-color: #007aff;
}
.kcal-calc-result {
  font-size: 14px;
  color: #666;
  font-weight: 500;
}

/* === Portion Buttons === */
.grams-portions {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 8px;
  padding: 0 16px 12px;
}

.grams-portion-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  min-width: 72px;
  padding: 10px 14px;
  border-radius: 12px;
  border: 2px solid #e5e5ea;
  background: #f2f2f7;
  cursor: pointer;
  transition: all 0.15s ease;
  -webkit-tap-highlight-color: transparent;
}

.grams-portion-btn .portion-name {
  font-size: 15px;
  font-weight: 600;
  color: #000;
}

.grams-portion-btn .portion-grams {
  font-size: 12px;
  color: #8e8e93;
  font-weight: 500;
}

.grams-portion-btn:active {
  transform: scale(0.96);
  animation: portion-bounce 0.3s ease;
}

@keyframes portion-bounce {
  0% { transform: scale(0.96); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.grams-portion-btn.active {
  background: #007aff;
  border-color: #007aff;
}

.grams-portion-btn.active .portion-name,
.grams-portion-btn.active .portion-grams {
  color: #fff;
}

/* Рекомендованная порция (последняя выбранная) */
.grams-portion-btn.recommended {
  border-color: #34c759;
  box-shadow: 0 0 0 2px rgba(52, 199, 89, 0.2);
  position: relative;
}

.grams-portion-btn.recommended::after {
  content: '★';
  position: absolute;
  top: -6px;
  right: -6px;
  width: 16px;
  height: 16px;
  background: #34c759;
  color: #fff;
  font-size: 10px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.grams-portion-btn:not(.active):hover {
  background: #e5e5ea;
}

/* Dark mode for portions */
[data-theme="dark"] .grams-portion-btn {
  background: #2c2c2e;
  border-color: #48484a;
}

[data-theme="dark"] .grams-portion-btn .portion-name {
  color: #fff;
}

[data-theme="dark"] .grams-portion-btn .portion-grams {
  color: #8e8e93;
}

[data-theme="dark"] .grams-portion-btn.active {
  background: #0a84ff;
  border-color: #0a84ff;
}

[data-theme="dark"] .grams-portion-btn:not(.active):hover {
  background: #3a3a3c;
}

[data-theme="dark"] .grams-portion-btn.recommended {
  border-color: #30d158;
  box-shadow: 0 0 0 2px rgba(48, 209, 88, 0.2);
}

[data-theme="dark"] .grams-portion-btn.recommended::after {
  background: #30d158;
}

/* Свайп контейнер для порций */
.grams-portions {
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.grams-portions::-webkit-scrollbar {
  display: none;
}

.grams-portion-btn {
  scroll-snap-align: center;
  flex-shrink: 0;
}

.grams-input-container {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 16px 20px;
  gap: 8px;
}

/* Stepper кнопки +/- */
.grams-stepper-btn {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  font-weight: 500;
  color: #007aff;
  background: #f2f2f7;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.15s ease;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}

.grams-stepper-btn:hover {
  background: #e5e5ea;
}

.grams-stepper-btn:active {
  transform: scale(0.95);
  background: #d1d1d6;
}

[data-theme="dark"] .grams-stepper-btn {
  background: #2c2c2e;
  color: #0a84ff;
}

[data-theme="dark"] .grams-stepper-btn:hover {
  background: #3a3a3c;
}

[data-theme="dark"] .grams-stepper-btn:active {
  background: #48484a;
}

.grams-input {
  width: 120px;
  height: 48px;
  font-size: 24px;
  font-weight: 600;
  text-align: center;
  border: 2px solid #d1d1d6;
  border-radius: 12px;
  background: #fff;
  color: #000;
  outline: none;
  -moz-appearance: textfield;
}

.grams-input::-webkit-outer-spin-button,
.grams-input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.grams-input:focus {
  border-color: #007aff;
  box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.15);
}

.grams-input-suffix {
  font-size: 20px;
  color: #8e8e93;
  font-weight: 500;
}

/* Grams Slider (like steps slider) */
.grams-slider-container {
  padding: 0 20px 16px;
}

.grams-slider {
  position: relative;
  height: 44px;
  display: flex;
  align-items: center;
  cursor: pointer;
  touch-action: none;
}

.grams-slider-track {
  position: absolute;
  left: 0;
  right: 0;
  height: 6px;
  background: #e5e5ea;
  border-radius: 3px;
}

.grams-slider-fill {
  position: absolute;
  left: 0;
  height: 6px;
  background: linear-gradient(90deg, #34c759 0%, #007aff 100%);
  border-radius: 3px;
  transition: width 0.15s ease-out;
}

.grams-slider-thumb {
  position: absolute;
  width: 28px;
  height: 28px;
  background: #fff;
  border: 3px solid #007aff;
  border-radius: 50%;
  transform: translateX(-50%);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  transition: left 0.15s ease-out, transform 0.1s ease, box-shadow 0.1s ease;
}

.grams-slider-thumb:active,
.grams-slider:active .grams-slider-thumb {
  transform: translateX(-50%) scale(1.1);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.grams-slider-mark {
  position: absolute;
  width: 2px;
  height: 10px;
  background: #c7c7cc;
  border-radius: 1px;
  transform: translateX(-50%);
  top: 50%;
  margin-top: -5px;
}

.grams-slider-labels {
  display: flex;
  justify-content: space-between;
  padding-top: 4px;
  font-size: 12px;
  color: #8e8e93;
}

/* Grams Presets */
.grams-presets {
  display: flex;
  justify-content: center;
  gap: 8px;
  padding: 0 16px 20px;
  flex-wrap: wrap;
}

.grams-preset {
  padding: 10px 16px;
  font-size: 15px;
  font-weight: 500;
  background: #f2f2f7;
  border: 2px solid transparent;
  border-radius: 20px;
  color: #000;
  cursor: pointer;
  transition: all 0.15s ease;
  min-width: 60px;
}

.grams-preset:active {
  transform: scale(0.95);
}

.grams-preset.active {
  background: #007aff;
  color: #fff;
  border-color: #007aff;
}

.grams-preset:not(.active):hover {
  background: #e5e5ea;
}

/* Dark mode support */
[data-theme="dark"] .grams-modal {
  background: rgba(44, 44, 46, 0.95);
}

[data-theme="dark"] .grams-preview-value {
  color: #0a84ff;
}

[data-theme="dark"] .grams-preview-kcal {
  color: #fff;
}

/* Dark theme kcal colors */
[data-theme="dark"] .grams-preview-kcal.kcal-low {
  color: #30d158;
}
[data-theme="dark"] .grams-preview-kcal.kcal-mid {
  color: #ffd60a;
}
[data-theme="dark"] .grams-preview-kcal.kcal-high {
  color: #ff453a;
}

[data-theme="dark"] .grams-hint {
  color: #98989d;
}
[data-theme="dark"] .grams-hint:hover {
  color: #0a84ff;
}

/* Dark theme kcal calculator */
[data-theme="dark"] .kcal-calc-toggle {
  background: #2c2c2e;
  border-color: #48484a;
  color: #98989d;
}
[data-theme="dark"] .kcal-calc-toggle:hover {
  background: #3a3a3c;
}
[data-theme="dark"] .kcal-calc-toggle.active {
  background: #0a84ff;
  border-color: #0a84ff;
  color: #fff;
}
[data-theme="dark"] .kcal-calc-input input {
  background: #1c1c1e;
  border-color: #48484a;
  color: #fff;
}
[data-theme="dark"] .kcal-calc-input input:focus {
  border-color: #0a84ff;
}
[data-theme="dark"] .kcal-calc-result {
  color: #98989d;
}

[data-theme="dark"] .grams-input {
  background: #1c1c1e;
  border-color: #48484a;
  color: #fff;
}

[data-theme="dark"] .grams-input:focus {
  border-color: #0a84ff;
  box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.2);
}

[data-theme="dark"] .grams-slider-track {
  background: #48484a;
}

[data-theme="dark"] .grams-slider-thumb {
  background: #2c2c2e;
  border-color: #0a84ff;
}

[data-theme="dark"] .grams-preset {
  background: #2c2c2e;
  color: #fff;
}

[data-theme="dark"] .grams-preset.active {
  background: #0a84ff;
}

[data-theme="dark"] .grams-preset:not(.active):hover {
  background: #3a3a3c;
}

/* Pull-to-refresh */
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.pull-refresh-indicator {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px;
}

.pull-refresh-spinner.spinning {
  animation: spin 0.8s linear infinite !important;
}

/* Utility classes для замены inline стилей */
.dev-positive { color: #dc2626; font-weight: 600; }
.dev-negative { color: #059669; font-weight: 600; }
.dev-neutral { color: #6b7280; }
.fw-600 { font-weight: 600; }
.text-right { text-align: right; }
.text-center { text-align: center; }
.mt-4 { margin-top: 4px; }
.mt-8 { margin-top: 8px; }
.mt-16 { margin-top: 16px; }
.mb-4 { margin-bottom: 4px; }
.mb-6 { margin-bottom: 6px; }
.w-100 { width: 100%; }
.overflow-hidden { overflow: hidden; }
.overflow-x-auto { overflow-x: auto; }
.pos-relative { position: relative; }

/* Muted text helper */
.text-muted-small {
  color: var(--muted);
  font-size: 11px;
  margin-left: 8px;
  font-weight: normal;
}

/* Table column widths */
.col-40 { width: 40%; }
.col-20 { width: 20%; }
.col-15 { width: 15%; }

/* Deficit input styling */
.input-deficit {
  width: 60px;
  text-align: center;
  font-weight: 600;
}

/* Result cell styling */
.result-good {
  background: #dcfce7;
  color: #166534;
  font-weight: 700;
  border: 1px solid #86efac;
}

.result-bad {
  background: #fee2e2;
  color: #991b1b;
  font-weight: 700;
  border: 1px solid #fecaca;
}

/* Divider row in table */
.table-divider {
  height: 4px;
  background: #d1d5db;
  border-radius: 6px;
  width: 100%;
}

/* ═══════════════════════════════════════════════════════════════════
   🎬 ANIMATIONS & TRANSITIONS
   ═══════════════════════════════════════════════════════════════════ */

/* --- Keyframes --- */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeInUp {
  from { 
    opacity: 0; 
    transform: translateY(12px); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0); 
  }
}

@keyframes slideInRight {
  from { 
    opacity: 0; 
    transform: translateX(-16px); 
  }
  to { 
    opacity: 1; 
    transform: translateX(0); 
  }
}

@keyframes scaleIn {
  from { 
    opacity: 0; 
    transform: scale(0.95); 
  }
  to { 
    opacity: 1; 
    transform: scale(1); 
  }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes starPop {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}

/* --- Meal Cards Animation --- */
.meal-card {
  animation: fadeInUp 0.25s ease-out;
}

/* Stagger animation for multiple cards */
.meal-card:nth-child(1) { animation-delay: 0ms; }
.meal-card:nth-child(2) { animation-delay: 50ms; }
.meal-card:nth-child(3) { animation-delay: 100ms; }
.meal-card:nth-child(4) { animation-delay: 150ms; }
.meal-card:nth-child(5) { animation-delay: 200ms; }

/* --- Product Row Animation (slide-in when added) --- */
.meals-table tbody tr {
  animation: slideInRight 0.2s ease-out;
}

/* --- Suggest Dropdown Animation --- */
.suggest-list,
.suggest-list-portal {
  animation: scaleIn 0.15s ease-out;
  transform-origin: top center;
}

.suggest-item {
  transition: background-color 0.12s ease, transform 0.1s ease;
}

.suggest-item:active {
  transform: scale(0.98);
}

/* --- Button Micro-interactions --- */
.btn {
  transition: transform 0.1s ease, opacity 0.1s ease, box-shadow 0.15s ease;
}

.btn:hover {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.btn:active {
  transform: scale(0.96);
  opacity: 0.9;
}

.btn.acc:hover {
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
}

/* --- Favorite Star Animation --- */
.favorite-btn {
  transition: opacity 0.15s ease, transform 0.15s ease;
}

.favorite-btn:hover {
  opacity: 1 !important;
  transform: scale(1.15);
}

.favorite-btn:active {
  animation: starPop 0.25s ease-out;
}

/* --- Card Hover Effects (desktop) --- */
@media (hover: hover) {
  .card {
    transition: box-shadow 0.2s ease, transform 0.15s ease;
  }
  
  .card.clickable:hover {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    transform: translateY(-1px);
  }
}

/* --- Input Focus Animation --- */
input, textarea, select {
  transition: border-color 0.15s ease, box-shadow 0.15s ease;
}

/* --- Tab Switching --- */
.tab {
  transition: background-color 0.15s ease, color 0.15s ease, transform 0.1s ease;
}

/* --- Modal Backdrop Animation --- */
.modal-backdrop {
  animation: fadeIn 0.15s ease-out;
}

.modal {
  animation: scaleIn 0.2s ease-out;
}

/* --- Reduce motion for accessibility --- */
/* Исключаем .animate-always — графики всегда анимируются (это часть UX) */
@media (prefers-reduced-motion: reduce) {
  *:not(.animate-always):not(.animate-always *),
  *:not(.animate-always):not(.animate-always *)::before,
  *:not(.animate-always):not(.animate-always *)::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* =========================================
   WATER CARD STYLES
   ========================================= */

/* --- Карточка воды --- */
.compact-water {
  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  border: 1px solid #bae6fd;
  display: grid;
  grid-template-columns: auto 1fr;
  grid-template-rows: auto 1fr;
  gap: 0 12px;
}

.compact-water .compact-card-header {
  color: #0369a1;
  grid-column: 1;
  grid-row: 1;
  margin-bottom: 4px;
}

.water-card-content {
  display: contents;
}

/* Левая часть: большое кольцо */
.water-ring-container {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  min-width: 80px;
  grid-column: 1;
  grid-row: 2;
}

.water-ring-large {
  position: relative;
  width: 72px;
  height: 72px;
}

.water-ring-svg {
  width: 100%;
  height: 100%;
  transform: rotate(-90deg);
}

.water-ring-bg {
  fill: none;
  stroke: #bae6fd;
  stroke-width: 3;
}

.water-ring-fill {
  fill: none;
  stroke: #0ea5e9;
  stroke-width: 3;
  stroke-linecap: round;
  transition: stroke-dasharray 0.3s ease;
}

.water-ring-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  line-height: 1.1;
}

.water-ring-value {
  font-size: 18px;
  font-weight: 700;
  color: #0369a1;
}

.water-ring-unit {
  font-size: 11px;
  color: #0ea5e9;
  font-weight: 500;
}

.water-goal-text {
  font-size: 11px;
  color: #64748b;
}

/* Краткий breakdown под кольцом */
.water-goal-breakdown {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  margin-top: 4px;
}

.water-breakdown-item {
  font-size: 10px;
  color: #64748b;
  line-height: 1.2;
}

.water-breakdown-bonus {
  color: #059669;
  font-weight: 500;
}

/* Напоминание "Давно не пил" */
.water-reminder {
  font-size: 10px;
  color: #f59e0b;
  font-weight: 500;
  margin-top: 4px;
  padding: 3px 8px;
  background: #fffbeb;
  border-radius: 4px;
  animation: reminderPulse 2s ease-in-out infinite;
}

@keyframes reminderPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

[data-theme="dark"] .water-reminder {
  color: #fbbf24;
  background: rgba(245, 158, 11, 0.15);
}

/* Тултип с полной формулой */
.water-formula-tooltip {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%) translateY(-100%);
  margin-top: -8px;
  background: #fff;
  border-radius: 12px;
  padding: 12px 14px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  border: 1px solid #e5e7eb;
  z-index: 1000;
  min-width: 200px;
  max-width: 280px;
  animation: tooltipFadeIn 0.2s ease-out;
}

@keyframes tooltipFadeIn {
  from { opacity: 0; transform: translateX(-50%) translateY(-90%); }
  to { opacity: 1; transform: translateX(-50%) translateY(-100%); }
}

.water-formula-title {
  font-size: 12px;
  font-weight: 600;
  color: #0369a1;
  margin-bottom: 8px;
  padding-bottom: 6px;
  border-bottom: 1px solid #e5e7eb;
}

.water-formula-row {
  font-size: 11px;
  color: #374151;
  padding: 3px 0;
  line-height: 1.4;
}

.water-formula-sub {
  color: #6b7280;
  font-size: 10px;
  padding-left: 8px;
}

.water-formula-total {
  font-size: 13px;
  font-weight: 700;
  color: #0ea5e9;
  margin-top: 8px;
  padding-top: 6px;
  border-top: 1px solid #e5e7eb;
}

.water-formula-hint {
  font-size: 9px;
  color: #9ca3af;
  text-align: center;
  margin-top: 6px;
}

[data-theme="dark"] .water-formula-tooltip {
  background: #1e293b;
  border-color: #334155;
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
}

[data-theme="dark"] .water-formula-title {
  color: #7dd3fc;
  border-color: #334155;
}

[data-theme="dark"] .water-formula-row {
  color: #e2e8f0;
}

[data-theme="dark"] .water-formula-sub {
  color: #94a3b8;
}

[data-theme="dark"] .water-formula-total {
  border-color: #334155;
}

[data-theme="dark"] .water-breakdown-item {
  color: #94a3b8;
}

[data-theme="dark"] .water-breakdown-bonus {
  color: #34d399;
}

/* Анимация добавления на кольце */
.water-card-anim {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 14px;
  font-weight: 700;
  color: #0ea5e9;
  animation: waterCardPop 0.8s ease-out forwards;
  pointer-events: none;
  z-index: 10;
}

@keyframes waterCardPop {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.5);
  }
  20% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.2);
  }
  50% {
    opacity: 1;
    transform: translate(-50%, -70%) scale(1);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -100%) scale(0.9);
  }
}

/* Правая часть */
.water-card-right {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  gap: 6px;
  grid-column: 2;
  grid-row: 1 / 3;
  align-self: start;
}

/* Верхняя строка: мотивация + кнопка удаления */
.water-top-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.water-motivation-inline {
  display: flex;
  align-items: center;
  gap: 6px;
}

.water-motivation-inline .water-motivation-emoji {
  font-size: 16px;
}

.water-motivation-inline .water-motivation-text {
  font-size: 13px;
  font-weight: 600;
  color: #0369a1;
}

/* Кнопка удаления воды (компактная) */
.water-minus-compact {
  padding: 4px 8px;
  font-size: 11px;
  font-weight: 500;
  color: #dc2626;
  background: #fef2f2;
  border: 1px solid #fecaca;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.15s ease;
  flex-shrink: 0;
}

.water-minus-compact:active {
  background: #fee2e2;
}

[data-theme="dark"] .water-minus-compact {
  color: #f87171;
  background: rgba(239, 68, 68, 0.15);
  border-color: rgba(239, 68, 68, 0.3);
}

[data-theme="dark"] .water-minus-compact:active {
  background: rgba(239, 68, 68, 0.25);
}

/* Inline прогресс-бар с волной воды */
.water-progress-inline {
  position: relative;
  height: 14px;
  background: linear-gradient(180deg, #e0f2fe 0%, #bae6fd 100%);
  border-radius: 7px;
  overflow: visible;
  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.15);
}

.water-progress-inline .water-progress-fill {
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  background: linear-gradient(180deg, #38bdf8 0%, #0ea5e9 50%, #0284c7 100%);
  border-radius: 7px;
  transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 0 8px rgba(14, 165, 233, 0.5);
}

/* Волна на краю заливки */
.water-wave-edge {
  position: absolute;
  top: 0;
  width: 8px;
  height: 100%;
  transform: translateX(-4px);
  background: linear-gradient(90deg, #0ea5e9, transparent);
  animation: waveEdge 1s ease-in-out infinite;
  border-radius: 0 7px 7px 0;
}

@keyframes waveEdge {
  0%, 100% {
    transform: translateX(-4px) scaleX(1);
    opacity: 0.8;
  }
  50% {
    transform: translateX(-2px) scaleX(1.3);
    opacity: 1;
  }
}

/* Пузырьки в воде */
.water-bubbles {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.water-bubble {
  position: absolute;
  width: 4px;
  height: 4px;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 50%;
  animation: bubbleRise 1.8s ease-out infinite;
  box-shadow: 0 0 2px rgba(255, 255, 255, 0.5);
}

.water-bubble:nth-child(1) { left: 10%; animation-delay: 0s; animation-duration: 1.5s; }
.water-bubble:nth-child(2) { left: 25%; animation-delay: 0.3s; animation-duration: 1.8s; }
.water-bubble:nth-child(3) { left: 45%; animation-delay: 0.6s; animation-duration: 1.6s; }
.water-bubble:nth-child(4) { left: 65%; animation-delay: 0.9s; animation-duration: 2s; }
.water-bubble:nth-child(5) { left: 85%; animation-delay: 1.2s; animation-duration: 1.7s; }

@keyframes bubbleRise {
  0% {
    bottom: 0;
    opacity: 0;
    transform: scale(0.3) translateX(0);
  }
  20% {
    opacity: 1;
    transform: scale(1) translateX(-2px);
  }
  60% {
    opacity: 0.8;
    transform: scale(0.8) translateX(2px);
  }
  100% {
    bottom: 16px;
    opacity: 0;
    transform: scale(0.2) translateX(0);
  }
}

/* Блик сверху */
.water-shine {
  position: absolute;
  left: 5%;
  top: 2px;
  width: 30%;
  height: 3px;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.7), transparent);
  border-radius: 2px;
  animation: shineMove 2s ease-in-out infinite;
}

@keyframes shineMove {
  0%, 100% {
    opacity: 0.5;
    transform: translateX(0);
  }
  50% {
    opacity: 1;
    transform: translateX(10px);
  }
}

/* 💧 Падающая капля воды */
.water-drop-container {
  position: absolute;
  top: -60px;
  left: 50%;
  transform: translateX(-50%);
  width: 40px;
  height: 80px;
  pointer-events: none;
  z-index: 10;
}

.water-drop {
  position: absolute;
  top: 0;
  left: 50%;
  width: 14px;
  height: 18px;
  background: linear-gradient(180deg, #7dd3fc 0%, #38bdf8 40%, #0ea5e9 100%);
  border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
  transform: translateX(-50%);
  animation: dropFall 0.9s cubic-bezier(0.4, 0, 0.8, 1) forwards;
  box-shadow: 
    0 2px 8px rgba(14, 165, 233, 0.4),
    inset 2px -2px 4px rgba(255, 255, 255, 0.5),
    inset -1px 1px 2px rgba(0, 0, 0, 0.1);
}

.water-drop::after {
  content: '';
  position: absolute;
  top: 3px;
  left: 3px;
  width: 4px;
  height: 5px;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
}

@keyframes dropFall {
  0% {
    top: 0;
    opacity: 1;
    transform: translateX(-50%) scale(1) rotate(0deg);
  }
  20% {
    transform: translateX(-50%) scale(1.1) rotate(-3deg);
  }
  40% {
    transform: translateX(-50%) scale(1) rotate(2deg);
  }
  70% {
    opacity: 1;
    transform: translateX(-50%) scale(0.95) rotate(0deg);
  }
  100% {
    top: 65px;
    opacity: 0;
    transform: translateX(-50%) scale(0.7) rotate(0deg);
  }
}

.water-splash {
  position: absolute;
  bottom: 5px;
  left: 50%;
  width: 30px;
  height: 14px;
  transform: translateX(-50%);
  opacity: 0;
  animation: splashAppear 0.4s ease-out 0.7s forwards;
}

.water-splash::before,
.water-splash::after {
  content: '';
  position: absolute;
  bottom: 0;
  width: 5px;
  height: 5px;
  background: #38bdf8;
  border-radius: 50%;
  box-shadow: 0 0 4px rgba(56, 189, 248, 0.5);
}

.water-splash::before {
  left: 2px;
  animation: splashLeft 0.4s ease-out 0.7s forwards;
}

.water-splash::after {
  right: 2px;
  animation: splashRight 0.4s ease-out 0.75s forwards;
}

@keyframes splashAppear {
  0% { opacity: 0; }
  30% { opacity: 1; }
  100% { opacity: 0; }
}

@keyframes splashLeft {
  0% {
    transform: translate(0, 0) scale(1);
    opacity: 0;
  }
  30% {
    opacity: 1;
    transform: translate(-8px, -12px) scale(1);
  }
  100% {
    opacity: 0;
    transform: translate(-12px, -18px) scale(0.3);
  }
}

@keyframes splashRight {
  0% {
    transform: translate(0, 0) scale(1);
    opacity: 0;
  }
  30% {
    opacity: 1;
    transform: translate(8px, -10px) scale(1);
  }
  100% {
    opacity: 0;
    transform: translate(12px, -16px) scale(0.3);
  }
}

/* Пресеты в ряд */
.water-presets-row {
  display: flex;
  gap: 6px;
}

.water-preset-compact {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  padding: 8px 4px;
  background: #fff;
  border: 1.5px solid #bae6fd;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
  min-height: 52px;
}

.water-preset-compact:active {
  background: #0ea5e9;
  border-color: #0284c7;
  transform: scale(0.95);
}

.water-preset-compact:active .water-preset-ml {
  color: #fff;
}

.water-preset-compact .water-preset-icon {
  font-size: 16px;
}

.water-preset-compact .water-preset-ml {
  font-size: 10px;
  font-weight: 600;
  color: #0369a1;
}

/* === FAB группа: советы + вода === */
.fab-group {
  position: fixed;
  bottom: calc(90px + env(safe-area-inset-bottom, 0px));
  right: 16px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 100;
}

/* === FAB для советов (💡) === */
.advice-fab {
  height: 44px;
  width: 44px;
  border-radius: 22px;
  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  position: relative;
  transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.2s ease;
  box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
  opacity: 0.6;
}

.advice-fab.has-advice {
  opacity: 1;
  animation: advice-pulse 2s ease-in-out infinite;
}

.advice-fab-icon {
  font-size: 20px;
  filter: drop-shadow(0 1px 2px rgba(0,0,0,0.2));
}

.advice-fab-badge {
  position: absolute;
  top: -4px;
  right: -4px;
  min-width: 18px;
  height: 18px;
  padding: 0 5px;
  border-radius: 9px;
  background: #dc2626;
  color: #fff;
  font-size: 11px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.advice-fab:active {
  transform: scale(0.95);
  box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
}

@keyframes advice-pulse {
  0%, 100% { box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4); }
  50% { box-shadow: 0 4px 20px rgba(251, 191, 36, 0.6); }
}

[data-theme="dark"] .advice-fab {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}

/* === Advice List (полноэкранный список советов) === */
.advice-list-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  z-index: 1000;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  padding: 16px;
  padding-bottom: calc(16px + env(safe-area-inset-bottom, 0px));
  animation: fadeIn 0.2s ease;
}

.advice-list-container {
  width: 100%;
  max-width: 500px;
  max-height: 75vh;
  background: var(--surface, #fff);
  border-radius: 20px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  animation: slideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
}

.advice-list-container.shake-warning {
  animation: shakeHorizontal 0.4s ease;
}

@keyframes shakeHorizontal {
  0%, 100% { transform: translateX(0); }
  20% { transform: translateX(-8px); }
  40% { transform: translateX(8px); }
  60% { transform: translateX(-4px); }
  80% { transform: translateX(4px); }
}

@keyframes slideUp {
  from { transform: translateY(100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.advice-list-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 16px 12px;
  border-bottom: 1px solid var(--border, #e5e7eb);
  font-weight: 600;
  font-size: 16px;
  color: var(--text-primary, #1f2937);
}

.advice-list-header-actions {
  display: flex;
  gap: 8px;
  align-items: center;
}

.advice-list-dismiss-all {
  padding: 6px 12px;
  border-radius: 16px;
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  border: none;
  font-size: 12px;
  font-weight: 600;
  color: #fff;
  cursor: pointer;
  transition: transform 0.15s ease, opacity 0.15s ease;
}

.advice-list-dismiss-all:hover {
  transform: scale(1.05);
}

.advice-list-dismiss-all:active {
  transform: scale(0.95);
}

.advice-list-dismiss-all:disabled {
  opacity: 0.5;
  pointer-events: none;
}

.advice-list-close {
  width: 32px;
  height: 32px;
  border-radius: 16px;
  background: var(--bg-secondary, #f3f4f6);
  border: none;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-secondary, #6b7280);
  transition: background 0.15s ease;
}

.advice-list-close:hover {
  background: var(--bg-tertiary, #e5e7eb);
}

.advice-list-items {
  padding: 8px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

/* Группы советов */
.advice-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.advice-group-header {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-tertiary, #9ca3af);
  padding: 8px 12px 4px;
  margin-top: 4px;
}

.advice-group:first-child .advice-group-header {
  margin-top: 0;
}

/* Карточка совета */
.advice-list-item-wrapper {
  position: relative;
  overflow: hidden;
  border-radius: 12px;
  transition: height 0.3s ease, opacity 0.3s ease, margin 0.3s ease, transform 0.3s ease;
  animation: adviceSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
  animation-delay: var(--stagger-delay, 0ms);
}

@keyframes adviceSlideIn {
  from { 
    opacity: 0; 
    transform: translateY(20px) scale(0.95);
  }
  to { 
    opacity: 1; 
    transform: translateY(0) scale(1);
  }
}

.advice-list-item-wrapper.dismissed {
  height: 0 !important;
  opacity: 0;
  margin: 0;
  padding: 0;
  pointer-events: none;
  animation: adviceDismiss 0.3s ease forwards;
}

@keyframes adviceDismiss {
  0% { 
    opacity: 1; 
    transform: translateX(0) scale(1);
  }
  50% { 
    opacity: 0.5;
    transform: translateX(-100px) scale(0.9);
  }
  100% { 
    opacity: 0; 
    transform: translateX(-150px) scale(0.8);
    height: 0;
    margin: 0;
  }
}

/* Undo overlay прогресс-бар (убывает за 3 сек) */
@keyframes undoProgress {
  0% { width: 100%; }
  100% { width: 0%; }
}

/* Фоны при свайпе */
.advice-list-item-bg {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  padding: 0 20px;
  font-weight: 600;
  font-size: 13px;
  border-radius: 12px;
  transition: opacity 0.1s ease;
}

.advice-list-item-bg-left {
  background: linear-gradient(90deg, #10b981 0%, #059669 100%);
  justify-content: flex-end;
  color: #fff;
}

.advice-list-item-bg-right {
  background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
  justify-content: flex-start;
  color: #fff;
}

.advice-list-item {
  position: relative;
  z-index: 1;
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 14px 16px;
  border-radius: 12px;
  background: var(--bg-secondary, #f9fafb);
  border-left: 4px solid #9ca3af;
  touch-action: pan-x;
  transition: transform 0.1s ease, box-shadow 0.2s ease;
}

.advice-list-item.expanded {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.advice-list-item-tip {
  border-left-color: #3b82f6;
  background: linear-gradient(90deg, rgba(59, 130, 246, 0.08) 0%, transparent 100%);
}

.advice-list-item-warning {
  border-left-color: #ef4444;
  background: linear-gradient(90deg, rgba(239, 68, 68, 0.08) 0%, transparent 100%);
}

.advice-list-item-achievement {
  border-left-color: #10b981;
  background: linear-gradient(90deg, rgba(16, 185, 129, 0.08) 0%, transparent 100%);
}

.advice-list-item-insight {
  border-left-color: #8b5cf6;
  background: linear-gradient(90deg, rgba(139, 92, 246, 0.08) 0%, transparent 100%);
}

.advice-list-item-info {
  border-left-color: #6b7280;
  background: linear-gradient(90deg, rgba(107, 114, 128, 0.08) 0%, transparent 100%);
}

.advice-list-icon {
  font-size: 22px;
  flex-shrink: 0;
  line-height: 1;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
  animation: iconGlow 2s ease-in-out infinite alternate;
}

@keyframes iconGlow {
  from { filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1)); }
  to { filter: drop-shadow(0 2px 8px rgba(59, 130, 246, 0.3)); }
}

.advice-list-item-warning .advice-list-icon {
  animation: iconGlowWarning 1.5s ease-in-out infinite alternate;
}

@keyframes iconGlowWarning {
  from { filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1)); }
  to { filter: drop-shadow(0 2px 10px rgba(239, 68, 68, 0.4)); }
}

.advice-list-item-achievement .advice-list-icon {
  animation: iconGlowSuccess 2s ease-in-out infinite alternate;
}

@keyframes iconGlowSuccess {
  from { filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1)); }
  to { filter: drop-shadow(0 2px 10px rgba(16, 185, 129, 0.4)); }
}

.advice-list-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.advice-list-text {
  font-size: 14px;
  line-height: 1.5;
  color: var(--text-primary, #1f2937);
}

.advice-list-details {
  font-size: 12px;
  line-height: 1.5;
  color: var(--text-secondary, #6b7280);
  padding: 8px 12px;
  background: var(--bg-tertiary, #f3f4f6);
  border-radius: 8px;
  animation: detailsSlideIn 0.2s ease;
}

@keyframes detailsSlideIn {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Подсказки снизу */
.advice-list-hints {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  padding: 12px;
  font-size: 11px;
  color: var(--text-tertiary, #9ca3af);
  border-top: 1px solid var(--border, #e5e7eb);
  flex-wrap: wrap;
}

.advice-list-hint-item {
  opacity: 0.8;
}

.advice-list-hint-divider {
  opacity: 0.4;
}

/* === Dark Theme === */
[data-theme="dark"] .advice-list-overlay {
  background: rgba(0, 0, 0, 0.75);
}

[data-theme="dark"] .advice-list-container {
  background: var(--surface, #1f2937);
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
}

[data-theme="dark"] .advice-list-item {
  background: var(--bg-secondary, #374151);
}

[data-theme="dark"] .advice-list-item-tip {
  background: linear-gradient(90deg, rgba(59, 130, 246, 0.15) 0%, transparent 100%);
}

[data-theme="dark"] .advice-list-item-warning {
  background: linear-gradient(90deg, rgba(239, 68, 68, 0.15) 0%, transparent 100%);
}

[data-theme="dark"] .advice-list-item-achievement {
  background: linear-gradient(90deg, rgba(16, 185, 129, 0.15) 0%, transparent 100%);
}

[data-theme="dark"] .advice-list-item-insight {
  background: linear-gradient(90deg, rgba(139, 92, 246, 0.15) 0%, transparent 100%);
}

[data-theme="dark"] .advice-list-details {
  background: var(--bg-primary, #111827);
}

[data-theme="dark"] .advice-list-hints {
  border-top-color: var(--border, #374151);
}

/* === FAB для воды (в группе) === */
.fab-group .water-fab {
  position: static;
}

.water-fab {
  position: fixed;
  bottom: calc(90px + env(safe-area-inset-bottom, 0px));
  right: 16px;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 100;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
  font-size: 22px;
  line-height: 1;
}

.water-fab:active {
  transform: scale(0.95);
  box-shadow: 0 2px 8px rgba(14, 165, 233, 0.3);
}

[data-theme="dark"] .water-fab {
  background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
  box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
}

/* Анимация добавления воды (над кольцом) */
.water-card-anim-above {
  position: absolute;
  top: -8px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 16px;
  font-weight: 700;
  color: #0ea5e9;
  animation: waterFloatUp 0.8s ease-out forwards;
  pointer-events: none;
  z-index: 10;
}

@keyframes waterFloatUp {
  0% { 
    opacity: 1; 
    transform: translateX(-50%) translateY(0) scale(1); 
  }
  100% { 
    opacity: 0; 
    transform: translateX(-50%) translateY(-30px) scale(1.2); 
  }
}

/* Dark theme */
[data-theme="dark"] .compact-water {
  background: linear-gradient(135deg, #0c4a6e 0%, #0369a1 100%);
  border-color: #0ea5e9;
}

[data-theme="dark"] .compact-water .compact-card-header {
  color: #7dd3fc;
}

[data-theme="dark"] .water-ring-bg {
  stroke: #0369a1;
}

[data-theme="dark"] .water-ring-value,
[data-theme="dark"] .water-motivation-inline .water-motivation-text {
  color: #e0f2fe;
}

[data-theme="dark"] .water-ring-unit {
  color: #7dd3fc;
}

[data-theme="dark"] .water-goal-text {
  color: #94a3b8;
}

[data-theme="dark"] .water-progress-inline {
  background: #0369a1;
}

[data-theme="dark"] .water-preset-compact {
  background: #0c4a6e;
  border-color: #0ea5e9;
}

[data-theme="dark"] .water-preset-compact .water-preset-ml {
  color: #7dd3fc;
}

/* ================================================
   DATA OVERVIEW TAB — Таблица заполненности данных
   ================================================ */

.data-overview-tab {
  padding: 12px;
  min-height: 100%;
}

.data-overview-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  padding: 0 4px;
}

.data-overview-title {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-color, #1f2937);
}

.data-overview-total {
  font-size: 13px;
  padding: 4px 10px;
  border-radius: 12px;
  background: #d1fae5;
  color: #059669;
  font-weight: 500;
}

.data-overview-scroll {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  margin: 0 -12px;
  padding: 0 12px;
}

.data-overview-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
  min-width: 520px;
}

.data-overview-table th {
  padding: 8px 4px;
  text-align: center;
  font-weight: 500;
  font-size: 11px;
  position: sticky;
  top: 0;
  background: var(--bg-color, #fff);
  border-bottom: 2px solid #e5e7eb;
  z-index: 2;
}

/* Вертикальный текст в заголовках */
.data-overview-table th.th-vertical {
  vertical-align: bottom;
  padding: 8px 2px 6px;
  min-width: 28px;
  height: 80px;
}

.data-overview-table th.th-vertical .th-text {
  writing-mode: vertical-rl;
  text-orientation: mixed;
  transform: rotate(180deg);
  white-space: nowrap;
  font-size: 11px;
  font-weight: 500;
  color: #6b7280;
  letter-spacing: 0.02em;
}

.data-overview-table th.th-date {
  text-align: left;
  font-size: 12px;
  vertical-align: bottom;
  padding-bottom: 6px;
}

.data-overview-table th:first-child {
  text-align: left;
  position: sticky;
  left: 0;
  z-index: 3;
}

.data-overview-table td {
  padding: 10px 6px;
  text-align: center;
  border-bottom: 1px solid #f3f4f6;
  min-width: 36px;
}

.data-overview-table td:first-child {
  text-align: left;
  font-weight: 500;
  font-size: 12px;
  position: sticky;
  left: 0;
  background: var(--bg-color, #fff);
  z-index: 1;
  white-space: nowrap;
  padding-right: 12px;
}

.data-overview-table tbody tr {
  cursor: pointer;
  transition: background 0.15s ease;
}

.data-overview-table tbody tr:hover {
  background: #f9fafb;
}

.data-overview-table tbody tr:active {
  background: #f3f4f6;
}

/* Cell states */
.cell-filled { 
  color: #059669;
  font-weight: 500;
}

.cell-empty { 
  color: #9ca3af;
  background: #fef2f2;
}

/* Нейтральная ячейка — день почти пустой, не подсвечиваем */
.cell-neutral {
  color: #d1d5db;
  background: transparent;
}

/* Hint */
.data-overview-hint {
  text-align: center;
  font-size: 12px;
  color: #9ca3af;
  margin-top: 12px;
  padding: 8px;
}

/* Empty state */
.data-overview-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px 24px;
  text-align: center;
}

.data-overview-empty-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.data-overview-empty-text {
  font-size: 16px;
  font-weight: 500;
  color: #6b7280;
  margin-bottom: 8px;
}

.data-overview-empty-hint {
  font-size: 13px;
  color: #9ca3af;
}

/* Dark theme */
[data-theme="dark"] .data-overview-title {
  color: #f3f4f6;
}

[data-theme="dark"] .data-overview-total {
  background: #064e3b;
  color: #6ee7b7;
}

[data-theme="dark"] .data-overview-table th {
  background: #1f2937;
  border-color: #374151;
}

[data-theme="dark"] .data-overview-table td {
  border-color: #374151;
}

[data-theme="dark"] .data-overview-table td:first-child {
  background: #1f2937;
}

[data-theme="dark"] .data-overview-table tbody tr:hover {
  background: #374151;
}

[data-theme="dark"] .data-overview-table tbody tr:active {
  background: #4b5563;
}

[data-theme="dark"] .cell-empty { 
  color: #6b7280; 
  background: #451a1a;
}

[data-theme="dark"] .data-overview-hint {
  color: #6b7280;
}

[data-theme="dark"] .data-overview-empty-text {
  color: #9ca3af;
}

[data-theme="dark"] .data-overview-empty-hint {
  color: #6b7280;
}

/* === PWA Install Banner === */
.pwa-install-banner {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  padding: 0 16px calc(16px + env(safe-area-inset-bottom, 0px)) 16px;
  animation: slideUpBanner 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes slideUpBanner {
  from {
    transform: translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.pwa-banner-content {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
  background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
  border-radius: 16px;
  box-shadow: 0 -4px 20px rgba(59, 130, 246, 0.3), 0 4px 12px rgba(0, 0, 0, 0.15);
}

.pwa-banner-icon {
  font-size: 32px;
  flex-shrink: 0;
  animation: bounceIcon 2s ease-in-out infinite;
}

@keyframes bounceIcon {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.pwa-banner-text {
  flex: 1;
  min-width: 0;
}

.pwa-banner-title {
  font-size: 15px;
  font-weight: 700;
  color: #fff;
  margin-bottom: 2px;
}

.pwa-banner-desc {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.85);
}

.pwa-banner-actions {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}

.pwa-banner-install {
  padding: 10px 20px;
  background: #fff;
  color: #1e40af;
  font-size: 13px;
  font-weight: 700;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.pwa-banner-install:active {
  transform: scale(0.95);
  background: #f0f9ff;
}

.pwa-banner-dismiss {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.2);
  color: #fff;
  font-size: 14px;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.15s ease;
}

.pwa-banner-dismiss:active {
  background: rgba(255, 255, 255, 0.3);
  transform: scale(0.9);
}

/* Dark theme */
[data-theme="dark"] .pwa-banner-content {
  background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%);
  box-shadow: 0 -4px 20px rgba(37, 99, 235, 0.4), 0 4px 12px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .pwa-banner-install {
  background: #1e293b;
  color: #60a5fa;
}

[data-theme="dark"] .pwa-banner-install:active {
  background: #334155;
}

/* === iOS Safari PWA Banner === */
.ios-pwa-banner .pwa-banner-content {
  background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
}

.ios-banner-content {
  flex-direction: column;
  align-items: stretch;
  gap: 12px;
}

.ios-banner-content .pwa-banner-icon {
  display: none;
}

.ios-banner-content .pwa-banner-text {
  flex: none;
}

.ios-benefit-hint {
  font-size: 11px;
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 8px;
  letter-spacing: 0.3px;
}

.ios-steps {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 4px;
}

.ios-step {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: rgba(255, 255, 255, 0.9);
}

.ios-step-num {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  font-size: 11px;
  font-weight: 700;
  flex-shrink: 0;
}

.ios-share-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  background: #007AFF;
  border-radius: 6px;
  color: #fff;
  box-shadow: 0 2px 8px rgba(0, 122, 255, 0.4);
  animation: iosPulse 2s ease-in-out infinite;
}

@keyframes iosPulse {
  0%, 100% { transform: scale(1); box-shadow: 0 2px 8px rgba(0, 122, 255, 0.4); }
  50% { transform: scale(1.1); box-shadow: 0 2px 12px rgba(0, 122, 255, 0.6); }
}

.ios-got-it-btn {
  width: 100%;
  padding: 12px;
  background: rgba(255, 255, 255, 0.15);
  color: #fff;
  font-size: 14px;
  font-weight: 600;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.ios-got-it-btn:active {
  background: rgba(255, 255, 255, 0.25);
  transform: scale(0.98);
}

.ios-arrow-hint {
  position: absolute;
  bottom: -20px;
  left: 50%;
  transform: translateX(-50%);
  color: rgba(255, 255, 255, 0.6);
  animation: iosArrowBounce 1s ease-in-out infinite;
}

@keyframes iosArrowBounce {
  0%, 100% { transform: translateX(-50%) translateY(0); }
  50% { transform: translateX(-50%) translateY(4px); }
}

[data-theme="dark"] .ios-pwa-banner .pwa-banner-content {
  background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
}

/* ========================================
   Update Toast (SW Update Available)
   ======================================== */
.update-toast {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10001;
  animation: slideDownToast 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@keyframes slideDownToast {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(-100%);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

.update-toast-content {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: linear-gradient(135deg, #059669 0%, #10b981 100%);
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4), 0 2px 8px rgba(0, 0, 0, 0.1);
  backdrop-filter: blur(10px);
  max-width: 360px;
}

.update-toast-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.update-toast-text {
  flex: 1;
  min-width: 0;
}

.update-toast-title {
  font-size: 14px;
  font-weight: 600;
  color: #fff;
  margin-bottom: 2px;
}

.update-toast-desc {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.85);
}

.update-toast-actions {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}

.update-toast-update {
  padding: 8px 16px;
  background: #fff;
  color: #059669;
  font-size: 13px;
  font-weight: 700;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.update-toast-update:active {
  transform: scale(0.95);
  background: #ecfdf5;
}

.update-toast-dismiss {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.2);
  color: #fff;
  font-size: 12px;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.15s ease;
}

.update-toast-dismiss:active {
  background: rgba(255, 255, 255, 0.3);
  transform: scale(0.9);
}

/* Dark theme */
[data-theme="dark"] .update-toast-content {
  background: linear-gradient(135deg, #047857 0%, #059669 100%);
  box-shadow: 0 4px 20px rgba(5, 150, 105, 0.4), 0 2px 8px rgba(0, 0, 0, 0.3);
}

[data-theme="dark"] .update-toast-update {
  background: #1e293b;
  color: #34d399;
}

[data-theme="dark"] .update-toast-update:active {
  background: #334155;
}

/* ========================================================
   MORNING CHECK-IN MODAL
   ======================================================== */

.mc-backdrop {
  position: fixed;
  inset: 0;
  z-index: 9999;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px;
}

.mc-modal {
  width: 100%;
  max-width: 360px;
  background: linear-gradient(135deg, #fff 0%, #f8fafc 100%);
  border-radius: 24px;
  overflow: hidden;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
}

.mc-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 12px 8px;
  border-bottom: 1px solid rgba(0, 0, 0, 0.05);
}

/* Close button */
.mc-close-btn {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 500;
  color: #dc2626;
  background: #fee2e2;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.15s ease;
  line-height: 1;
}

.mc-close-btn:hover {
  background: #fecaca;
  color: #b91c1c;
}

.mc-close-btn:active {
  transform: scale(0.9);
  background: #fca5a5;
}

.mc-title {
  font-size: 17px;
  font-weight: 700;
  color: #0f172a;
}

.mc-btn-back,
.mc-btn-next {
  padding: 8px 12px;
  font-size: 13px;
  font-weight: 600;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.mc-btn-back {
  background: transparent;
  color: #64748b;
}

.mc-btn-back:active {
  background: rgba(0, 0, 0, 0.05);
}

.mc-btn-next {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: #fff;
  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
}

.mc-btn-next:active {
  transform: scale(0.95);
}

/* Progress dots */
.mc-progress {
  display: flex;
  justify-content: center;
  gap: 8px;
  padding: 12px 0;
}

.mc-progress-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #e2e8f0;
  transition: all 0.3s ease;
}

.mc-progress-dot.active {
  background: #10b981;
}

.mc-progress-dot.current {
  width: 24px;
  border-radius: 4px;
  background: linear-gradient(90deg, #10b981, #059669);
}

/* Content area */
.mc-content {
  padding: 20px 24px 24px;
  min-height: 280px;
}

.mc-step {
  animation: mc-step-in 0.25s ease-out;
}

@keyframes mc-step-in {
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.mc-step-label {
  font-size: 14px;
  color: #64748b;
  text-align: center;
  margin-bottom: 12px;
}

/* Weight display */
.mc-weight-display {
  text-align: center;
  margin-bottom: 24px;
}

.mc-weight-value {
  font-size: 56px;
  font-weight: 800;
  color: #0f172a;
  letter-spacing: -2px;
}

.mc-weight-unit {
  font-size: 20px;
  font-weight: 500;
  color: #64748b;
}

/* Weight pickers */
.mc-weight-pickers {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.mc-picker-group {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.mc-picker-group label {
  font-size: 11px;
  color: #94a3b8;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.mc-picker-separator {
  font-size: 48px;
  font-weight: 300;
  color: #94a3b8;
  margin: 20px 0 0;
}

/* Wheel picker */
.mc-wheel {
  position: relative;
  width: 80px;
  height: 108px;
  overflow: hidden;
}

.mc-wheel-inner {
  position: relative;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.mc-wheel-item {
  position: absolute;
  width: 100%;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  font-weight: 600;
  color: #0f172a;
  transition: all 0.2s ease;
  cursor: pointer;
}

.mc-wheel-item.active {
  font-size: 32px;
  font-weight: 700;
  color: #10b981;
}

.mc-wheel-btn {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  width: 36px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(16, 185, 129, 0.1);
  color: #10b981;
  border: none;
  border-radius: 6px;
  font-size: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.mc-wheel-btn:active {
  background: rgba(16, 185, 129, 0.2);
  transform: translateX(-50%) scale(0.95);
}

.mc-wheel-btn.up {
  top: 0;
}

.mc-wheel-btn.down {
  bottom: 0;
}

/* Sleep step */
.mc-sleep-summary {
  text-align: center;
  margin-bottom: 24px;
}

.mc-sleep-hours {
  font-size: 48px;
  font-weight: 800;
  color: #8b5cf6;
}

.mc-sleep-unit {
  font-size: 18px;
  font-weight: 500;
  color: #64748b;
}

.mc-sleep-times {
  display: flex;
  justify-content: center;
  gap: 32px;
}

.mc-sleep-block {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.mc-sleep-label {
  font-size: 14px;
  font-weight: 600;
  color: #64748b;
}

.mc-sleep-pickers {
  display: flex;
  align-items: center;
  gap: 4px;
}

.mc-time-sep {
  font-size: 28px;
  font-weight: 300;
  color: #94a3b8;
  margin-top: 16px;
}

/* Steps step */
.mc-steps-display {
  text-align: center;
  margin-bottom: 24px;
}

.mc-steps-value {
  font-size: 48px;
  font-weight: 800;
  color: #f59e0b;
}

.mc-steps-unit {
  font-size: 18px;
  font-weight: 500;
  color: #64748b;
}

.mc-steps-picker {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 8px;
  margin-bottom: 16px;
}

.mc-steps-btn {
  padding: 10px 16px;
  font-size: 14px;
  font-weight: 600;
  color: #64748b;
  background: #f1f5f9;
  border: 2px solid transparent;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.mc-steps-btn:active {
  transform: scale(0.95);
}

.mc-steps-btn.active {
  color: #f59e0b;
  background: #fef3c7;
  border-color: #f59e0b;
  box-shadow: 0 2px 8px rgba(245, 158, 11, 0.2);
}

.mc-steps-hint {
  font-size: 12px;
  color: #94a3b8;
  text-align: center;
}

/* ======================== */
/* Deficit Step             */
/* ======================== */

.step-deficit {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  padding: 8px 0;
}

.deficit-display {
  text-align: center;
}

.deficit-value {
  font-size: 64px;
  font-weight: 800;
  letter-spacing: -3px;
  line-height: 1;
  margin-bottom: 4px;
  transition: color 0.2s ease;
}

.deficit-label {
  font-size: 15px;
  font-weight: 600;
  color: #64748b;
}

.deficit-slider-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  height: 140px;
  width: 100%;
  touch-action: none;
}

.deficit-btn {
  width: 48px;
  height: 32px;
  border: none;
  border-radius: 8px;
  background: #f1f5f9;
  color: #64748b;
  font-size: 20px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.deficit-btn:active:not(:disabled) {
  transform: scale(0.95);
  background: #e2e8f0;
}

.deficit-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

.deficit-slider-track {
  position: relative;
  width: 8px;
  height: 80px;
  background: #e2e8f0;
  border-radius: 4px;
  overflow: visible;
}

.deficit-slider-fill {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  border-radius: 4px;
  transition: height 0.1s ease, background 0.2s ease;
}

.deficit-slider-thumb {
  position: absolute;
  left: 50%;
  transform: translateX(-50%) translateY(50%);
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: 3px solid white;
  transition: all 0.15s ease;
  cursor: grab;
}

.deficit-slider-thumb:active {
  cursor: grabbing;
  transform: translateX(-50%) translateY(50%) scale(1.1);
}

.deficit-hint {
  font-size: 12px;
  color: #94a3b8;
  text-align: center;
  line-height: 1.5;
}

.deficit-presets {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 8px;
  margin-top: 4px;
}

.deficit-preset {
  padding: 8px 14px;
  font-size: 13px;
  font-weight: 600;
  color: #64748b;
  background: #f1f5f9;
  border: 2px solid transparent;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.deficit-preset:active {
  transform: scale(0.95);
}

.deficit-preset.active {
  color: #fff;
}

/* Sleep Quality step */
.mc-step-quality {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
}

.mc-quality-display {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: 8px;
}

.mc-quality-emoji {
  font-size: 48px;
  animation: mc-emoji-bounce 0.3s ease;
}

@keyframes mc-emoji-bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}

.mc-quality-value {
  font-size: 56px;
  font-weight: 800;
  color: #8b5cf6;
  letter-spacing: -2px;
}

.mc-quality-max {
  font-size: 20px;
  font-weight: 500;
  color: #94a3b8;
}

.mc-quality-label {
  font-size: 18px;
  font-weight: 600;
  color: #8b5cf6;
  min-height: 24px;
}

.mc-quality-slider-wrap {
  width: 100%;
  padding: 0 8px;
}

.mc-quality-slider {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 8px;
  border-radius: 4px;
  outline: none;
  cursor: pointer;
}

.mc-quality-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
  transition: transform 0.15s ease;
}

.mc-quality-slider::-webkit-slider-thumb:active {
  transform: scale(1.1);
}

.mc-quality-slider::-moz-range-thumb {
  width: 28px;
  height: 28px;
  border: none;
  border-radius: 50%;
  background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
}

.mc-quality-labels {
  display: flex;
  justify-content: space-between;
  font-size: 20px;
  margin-top: 8px;
  padding: 0 4px;
}

.mc-quality-buttons {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: 8px;
}

/* Sleep advice block */
.mc-sleep-advice {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 16px;
  padding: 12px 16px;
  border-radius: 12px;
  border: 1px solid;
  min-height: 56px; /* Фикс для 2 строк текста */
  transition: all 0.3s ease;
  animation: mc-advice-appear 0.3s ease-out;
}

@keyframes mc-advice-appear {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.mc-sleep-advice-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.mc-sleep-advice-text {
  font-size: 14px;
  font-weight: 500;
  line-height: 1.4;
}

[data-theme="dark"] .mc-sleep-advice {
  background-color: #1e293b !important;
  border-color: #334155 !important;
}

[data-theme="dark"] .mc-sleep-advice-text {
  color: #e2e8f0 !important;
}

/* Sleep comment field */
.mc-sleep-comment {
  margin-top: 12px;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #e2e8f0;
  background: #f8fafc;
  transition: all 0.2s ease;
}

.mc-sleep-comment-label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 8px;
}

.mc-sleep-comment-input {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 14px;
  background: #fff;
  transition: all 0.2s ease;
}

.mc-sleep-comment-input:focus {
  outline: none;
  border-color: #10b981;
  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

.mc-sleep-comment-input::placeholder {
  color: #9ca3af;
}

[data-theme="dark"] .mc-sleep-comment {
  background: #1e293b;
  border-color: #334155;
}

[data-theme="dark"] .mc-sleep-comment-label {
  color: #e2e8f0;
}

[data-theme="dark"] .mc-sleep-comment-input {
  background: #0f172a;
  border-color: #334155;
  color: #f1f5f9;
}

[data-theme="dark"] .mc-sleep-comment-input::placeholder {
  color: #64748b;
}

.mc-quality-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 10px 12px;
  background: #f1f5f9;
  border: 2px solid transparent;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.15s ease;
  min-width: 70px;
}

.mc-quality-btn:active {
  transform: scale(0.95);
}

.mc-quality-btn.active {
  background: rgba(139, 92, 246, 0.1);
  border-color: #8b5cf6;
  box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2);
}

.mc-quality-btn-emoji {
  font-size: 24px;
}

.mc-quality-btn-label {
  font-size: 11px;
  font-weight: 600;
  color: #64748b;
}

.mc-quality-btn.active .mc-quality-btn-label {
  color: #8b5cf6;
}

/* Footer */
.mc-footer {
  padding: 12px 24px 20px;
  font-size: 12px;
  color: #94a3b8;
  text-align: center;
  border-top: 1px solid rgba(0, 0, 0, 0.05);
}

/* Dark mode */
[data-theme="dark"] .mc-modal {
  background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
}

[data-theme="dark"] .mc-title {
  color: #f1f5f9;
}

[data-theme="dark"] .mc-btn-back {
  color: #94a3b8;
}

[data-theme="dark"] .mc-btn-back:active {
  background: rgba(255, 255, 255, 0.1);
}

[data-theme="dark"] .mc-progress-dot {
  background: #334155;
}

[data-theme="dark"] .mc-step-label {
  color: #94a3b8;
}

[data-theme="dark"] .mc-weight-value,
[data-theme="dark"] .mc-wheel-item {
  color: #f1f5f9;
}

[data-theme="dark"] .mc-weight-unit,
[data-theme="dark"] .mc-sleep-unit,
[data-theme="dark"] .mc-steps-unit,
[data-theme="dark"] .mc-sleep-label {
  color: #94a3b8;
}

[data-theme="dark"] .mc-picker-separator,
[data-theme="dark"] .mc-time-sep {
  color: #475569;
}

[data-theme="dark"] .mc-wheel-btn {
  background: rgba(16, 185, 129, 0.15);
}

[data-theme="dark"] .mc-steps-btn {
  background: #334155;
  color: #94a3b8;
}

[data-theme="dark"] .mc-steps-btn.active {
  background: rgba(245, 158, 11, 0.15);
  color: #fbbf24;
  border-color: #f59e0b;
}

[data-theme="dark"] .mc-footer {
  color: #64748b;
  border-color: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .mc-header {
  border-color: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .mc-close-btn {
  color: #fca5a5;
  background: #7f1d1d;
}

[data-theme="dark"] .mc-close-btn:hover {
  background: #991b1b;
  color: #fecaca;
}

/* Dark mode - Sleep Quality */
[data-theme="dark"] .mc-quality-value {
  color: #a78bfa;
}

[data-theme="dark"] .mc-quality-label {
  color: #a78bfa;
}

[data-theme="dark"] .mc-quality-slider {
  background: linear-gradient(to right, #8b5cf6 0%, #8b5cf6 var(--progress, 66%), #334155 var(--progress, 66%), #334155 100%) !important;
}

[data-theme="dark"] .mc-quality-btn {
  background: #334155;
}

[data-theme="dark"] .mc-quality-btn.active {
  background: rgba(139, 92, 246, 0.2);
  border-color: #a78bfa;
}

[data-theme="dark"] .mc-quality-btn-label {
  color: #94a3b8;
}

[data-theme="dark"] .mc-quality-btn.active .mc-quality-btn-label {
  color: #a78bfa;
}

/* Dark mode - Deficit Step */
[data-theme="dark"] .deficit-label {
  color: #94a3b8;
}

[data-theme="dark"] .deficit-btn {
  background: #334155;
  color: #94a3b8;
}

[data-theme="dark"] .deficit-btn:active:not(:disabled) {
  background: #475569;
}

[data-theme="dark"] .deficit-slider-track {
  background: #334155;
}

[data-theme="dark"] .deficit-hint {
  color: #64748b;
}

[data-theme="dark"] .deficit-preset {
  background: #334155;
  color: #94a3b8;
}

[data-theme="dark"] .deficit-preset:hover {
  background: #475569;
}

/* === Morning Check-in v2 Enhancements === */

/* Skip button */
.mc-skip-btn {
  padding: 6px 12px;
  font-size: 13px;
  font-weight: 500;
  color: #94a3b8;
  background: transparent;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.mc-skip-btn:active {
  background: rgba(0, 0, 0, 0.05);
}

/* DEV: Clear button */
.mc-dev-btn {
  padding: 6px 10px;
  font-size: 16px;
  background: rgba(239, 68, 68, 0.1);
  border: 1px dashed #ef4444;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.15s ease;
  margin-right: 4px;
}

.mc-dev-btn:hover {
  background: rgba(239, 68, 68, 0.2);
}

.mc-dev-btn:active {
  transform: scale(0.95);
}

/* Greeting */
.mc-greeting {
  font-size: 17px;
  font-weight: 700;
  color: #0f172a;
  flex: 1;
}

[data-theme="dark"] .mc-greeting {
  color: #f1f5f9;
}

/* Streak badge */
.mc-streak-badge {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  padding: 4px 10px;
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border-radius: 12px;
  font-size: 13px;
  font-weight: 600;
  margin-right: 8px;
}

.mc-streak-fire {
  font-size: 14px;
}

.mc-streak-count {
  color: #b45309;
}

.mc-streak-text {
  color: #d97706;
  font-weight: 500;
}

[data-theme="dark"] .mc-streak-badge {
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.15) 100%);
}

[data-theme="dark"] .mc-streak-count,
[data-theme="dark"] .mc-streak-text {
  color: #fbbf24;
}

/* Progress dots (renamed from mc-progress-dot) */
.mc-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #e2e8f0;
  transition: all 0.3s ease;
  cursor: pointer;
}

.mc-dot--active {
  background: linear-gradient(135deg, #10b981, #059669);
}

[data-theme="dark"] .mc-dot {
  background: #334155;
}

/* Step header */
.mc-step-header {
  text-align: center;
  padding: 0 16px 16px;
}

.mc-step-title {
  font-size: 20px;
  font-weight: 700;
  color: #0f172a;
  margin: 0 0 4px;
}

.mc-step-hint {
  font-size: 14px;
  color: #64748b;
  margin: 0;
}

[data-theme="dark"] .mc-step-title {
  color: #f1f5f9;
}

[data-theme="dark"] .mc-step-hint {
  color: #94a3b8;
}

/* Step content with slide animations */
.mc-step-content {
  padding: 0 24px 24px;
  min-height: 420px; /* Под самый высокий шаг (качество сна) */
}

.mc-slide-left {
  animation: mc-slide-out-left 0.2s ease forwards;
}

.mc-slide-right {
  animation: mc-slide-out-right 0.2s ease forwards;
}

@keyframes mc-slide-out-left {
  from { opacity: 1; transform: translateX(0); }
  to { opacity: 0; transform: translateX(-30px); }
}

@keyframes mc-slide-out-right {
  from { opacity: 1; transform: translateX(0); }
  to { opacity: 0; transform: translateX(30px); }
}

/* Weight delta */
.mc-weight-delta {
  font-size: 14px;
  font-weight: 600;
  margin-top: 8px;
  padding: 4px 12px;
  border-radius: 8px;
  display: inline-block;
}

.mc-delta-up {
  color: #dc2626;
  background: rgba(220, 38, 38, 0.1);
}

.mc-delta-down {
  color: #16a34a;
  background: rgba(22, 163, 74, 0.1);
}

.mc-delta-same {
  color: #64748b;
  background: rgba(100, 116, 139, 0.1);
}

/* Weight forecast */
.mc-weight-forecast {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin-top: 16px;
  padding: 8px 16px;
  background: rgba(59, 130, 246, 0.1);
  border-radius: 10px;
  font-size: 13px;
  color: #3b82f6;
}

.mc-forecast-icon {
  font-size: 16px;
}

[data-theme="dark"] .mc-weight-forecast {
  background: rgba(59, 130, 246, 0.15);
  color: #60a5fa;
}

/* Weight dot separator */
.mc-weight-dot {
  font-size: 48px;
  font-weight: 300;
  color: #94a3b8;
  margin: 0 4px;
}

/* Wheel picker v2 */
.mc-wheel-picker {
  display: flex;
  flex-direction: column;
  align-items: center;
  touch-action: none;
}

.mc-wheel-label {
  font-size: 11px;
  color: #94a3b8;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 4px;
}

.mc-wheel-values {
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 160px;
  justify-content: center;
  gap: 0;
}

.mc-wheel-value {
  font-size: 24px;
  font-weight: 600;
  color: #0f172a;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s ease;
  cursor: pointer;
  min-width: 60px;
}

.mc-wheel-value--far {
  font-size: 14px;
  color: #cbd5e1;
  opacity: 0.4;
}

.mc-wheel-value--far:hover {
  opacity: 0.7;
}

.mc-wheel-value--prev,
.mc-wheel-value--next {
  font-size: 18px;
  color: #94a3b8;
  opacity: 0.6;
}

.mc-wheel-value--prev:hover,
.mc-wheel-value--next:hover {
  opacity: 1;
}

.mc-wheel-value--current {
  font-size: 32px;
  font-weight: 700;
  color: #10b981;
}

[data-theme="dark"] .mc-wheel-value {
  color: #f1f5f9;
}

[data-theme="dark"] .mc-wheel-value--far {
  color: #475569;
}

[data-theme="dark"] .mc-wheel-value--prev,
[data-theme="dark"] .mc-wheel-value--next {
  color: #64748b;
}

/* Sleep display v2 */
.mc-sleep-display {
  text-align: center;
  margin-bottom: 24px;
}

.mc-sleep-value {
  font-size: 48px;
  font-weight: 800;
  color: #8b5cf6;
}

/* Time pickers */
.mc-time-pickers {
  display: flex;
  align-items: center;
  gap: 0;
}

/* Steps grid */
.mc-steps-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  margin-top: 16px;
}

.mc-steps-btn--active {
  color: #f59e0b !important;
  background: #fef3c7 !important;
  border-color: #f59e0b !important;
  box-shadow: 0 2px 8px rgba(245, 158, 11, 0.2);
}

[data-theme="dark"] .mc-steps-btn--active {
  background: rgba(245, 158, 11, 0.15) !important;
  color: #fbbf24 !important;
}

/* Steps stats block */
.mc-steps-stats {
  text-align: center;
  margin-top: 16px;
  padding: 12px 16px;
  background: #f0fdf4;
  border-radius: 12px;
  border: 1px solid #bbf7d0;
}

[data-theme="dark"] .mc-steps-stats {
  background: rgba(34, 197, 94, 0.1);
  border-color: rgba(34, 197, 94, 0.3);
}

.mc-steps-avg {
  font-size: 14px;
  color: #374151;
}

[data-theme="dark"] .mc-steps-avg {
  color: #d1d5db;
}

.mc-steps-avg-value {
  font-weight: 600;
  color: #059669;
}

[data-theme="dark"] .mc-steps-avg-value {
  color: #34d399;
}

.mc-steps-bonus {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  margin-top: 8px;
  font-size: 15px;
  font-weight: 600;
  color: #ea580c;
}

[data-theme="dark"] .mc-steps-bonus {
  color: #fb923c;
}

.mc-steps-bonus-icon {
  font-size: 18px;
}

/* Steps slider */
.mc-steps-slider-container {
  margin: 16px 0;
  padding: 0 4px;
}

.mc-steps-slider {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 8px;
  border-radius: 4px;
  outline: none;
  cursor: pointer;
}

.mc-steps-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: white;
  border: 3px solid #3b82f6;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
  transition: transform 0.15s ease;
}

.mc-steps-slider::-webkit-slider-thumb:active {
  transform: scale(1.15);
}

.mc-steps-slider::-moz-range-thumb {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: white;
  border: 3px solid #3b82f6;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
}

.mc-steps-slider-labels {
  display: flex;
  justify-content: space-between;
  margin-top: 6px;
  font-size: 11px;
  color: #9ca3af;
}

.mc-steps-slider-label-health {
  color: #ef4444;
  font-weight: 600;
}

[data-theme="dark"] .mc-steps-slider {
  background: #374151 !important;
}

[data-theme="dark"] .mc-steps-slider-labels {
  color: #6b7280;
}

.mc-steps-recommendation {
  text-align: center;
  margin-top: 12px;
  font-size: 13px;
  color: #6b7280;
  font-style: italic;
  min-height: 36px; /* Фикс для 2 строк текста */
  display: flex;
  align-items: center;
  justify-content: center;
}

[data-theme="dark"] .mc-steps-recommendation {
  color: #9ca3af;
}

/* Recommended steps button */
.mc-steps-btn--recommended {
  position: relative;
}

.mc-steps-btn--recommended::after {
  content: '✨';
  position: absolute;
  top: -6px;
  right: -6px;
  font-size: 12px;
}

/* Quality display v2 */
.mc-quality-display {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  margin-bottom: 16px;
}

.mc-quality-emoji {
  font-size: 64px;
  transition: all 0.3s ease;
}

/* Quality button active state */
.mc-quality-btn--active {
  transform: scale(1.05);
}

/* Buttons v2 */
.mc-buttons {
  display: flex;
  justify-content: space-between;
  padding: 0 24px 20px;
  gap: 12px;
}

.mc-btn {
  flex: 1;
  padding: 14px 20px;
  font-size: 15px;
  font-weight: 600;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.mc-btn:active {
  transform: scale(0.97);
}

.mc-btn--primary {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: #fff;
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.mc-btn--secondary {
  background: #f1f5f9;
  color: #64748b;
}

[data-theme="dark"] .mc-btn--secondary {
  background: #334155;
  color: #94a3b8;
}

/* Daily tip */
.mc-tip {
  padding: 12px 24px 20px;
  font-size: 13px;
  color: #64748b;
  text-align: center;
  border-top: 1px solid rgba(0, 0, 0, 0.05);
}

[data-theme="dark"] .mc-tip {
  color: #94a3b8;
  border-color: rgba(255, 255, 255, 0.05);
}

/* ======================== */
/* Meal Step (Time + Mood)  */
/* ======================== */

/* Step 1: Время и тип */
.meal-time-step {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  padding: 8px 0;
}

.meal-time-display {
  text-align: center;
}

.meal-time-value {
  font-size: 48px;
  font-weight: 800;
  color: #3b82f6;
  letter-spacing: -2px;
}

.meal-time-pickers {
  display: flex;
  align-items: center;
  gap: 8px;
}

.meal-time-separator {
  font-size: 32px;
  font-weight: 600;
  color: #94a3b8;
}

/* Night hour hint */
.meal-night-hint {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  background: rgba(139, 92, 246, 0.1);
  border-radius: 10px;
  font-size: 13px;
  color: #7c3aed;
}

.meal-night-hint b {
  font-weight: 700;
}

[data-theme="dark"] .meal-night-hint {
  background: rgba(139, 92, 246, 0.15);
  color: #a78bfa;
}

/* Meal type selection */
.meal-type-section {
  width: 100%;
  padding: 0 8px;
}

.meal-type-label {
  font-size: 13px;
  font-weight: 600;
  color: #64748b;
  margin-bottom: 10px;
  text-align: center;
}

.meal-type-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 6px;
}

.meal-type-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  padding: 8px 4px;
  background: #f1f5f9;
  border: 2px solid transparent;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.meal-type-btn:active {
  transform: scale(0.95);
}

.meal-type-btn.active {
  background: #dbeafe;
  border-color: #3b82f6;
}

.meal-type-btn-icon {
  font-size: 20px;
}

.meal-type-btn-name {
  font-size: 10px;
  font-weight: 600;
  color: #64748b;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}

.meal-type-btn.active .meal-type-btn-name {
  color: #2563eb;
}

[data-theme="dark"] .meal-type-btn {
  background: #334155;
}

[data-theme="dark"] .meal-type-btn-name {
  color: #94a3b8;
}

[data-theme="dark"] .meal-type-btn.active {
  background: #1e3a8a;
  border-color: #3b82f6;
}

[data-theme="dark"] .meal-type-btn.active .meal-type-btn-name {
  color: #93c5fd;
}

/* Step 2: Оценки — в стиле оценки дня */
.meal-mood-step {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 0;
  position: relative;
}

/* Grid из трёх карточек — компактный */
/* Общий индикатор состояния */
.meal-overall-status {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 8px 12px;
  margin-bottom: 12px;
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(16, 185, 129, 0.08));
  border-radius: 10px;
}

.meal-overall-emoji {
  font-size: 24px;
}

.meal-overall-text {
  font-size: 14px;
  font-weight: 600;
  color: #374151;
}

[data-theme="dark"] .meal-overall-text {
  color: #d1d5db;
}

/* Grid из трёх карточек */
.meal-ratings-grid {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* Карточка оценки — новый layout с градиентом */
.meal-rating-card {
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  padding: 10px 12px 8px;
  transition: background 0.3s ease;
}

[data-theme="dark"] .meal-rating-card {
  border-color: #334155;
}

/* Главная строка: emoji | info | presets */
.meal-rating-row-main {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 6px;
}

/* Большой emoji слева */
.meal-rating-emoji-lg {
  font-size: 28px;
  width: 34px;
  height: 34px;
  min-width: 34px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.meal-rating-emoji-lg.bounce {
  animation: meal-emoji-bounce 0.4s ease;
}

.meal-rating-emoji-lg.shake {
  animation: meal-emoji-shake 0.4s ease;
}

/* Инфо блок: название + значение */
.meal-rating-info {
  flex: 1;
  min-width: 0;
}

.meal-rating-title {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  color: #9ca3af;
  margin-bottom: 2px;
}

.meal-rating-value-row {
  display: flex;
  align-items: baseline;
  gap: 3px;
}

.meal-rating-num {
  font-size: 22px;
  font-weight: 700;
  line-height: 1;
  transition: color 0.2s ease, transform 0.2s ease;
}

.meal-rating-num.num-bounce {
  animation: num-bounce 0.2s ease;
}

@keyframes num-bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.15); }
}

.meal-rating-max {
  font-size: 12px;
  color: #9ca3af;
}

.meal-rating-text {
  font-size: 12px;
  color: #6b7280;
  margin-left: 6px;
}

[data-theme="dark"] .meal-rating-text {
  color: #9ca3af;
}

/* Пресеты справа */
.meal-rating-presets {
  display: flex;
  gap: 4px;
}

.meal-preset-btn {
  width: 32px;
  height: 32px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  background: white;
  font-size: 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s ease;
}

.meal-preset-btn:active {
  transform: scale(0.92);
}

.meal-preset-btn.active {
  background: #dbeafe;
  border-color: #3b82f6;
}

[data-theme="dark"] .meal-preset-btn {
  background: #374151;
  border-color: #4b5563;
}

[data-theme="dark"] .meal-preset-btn.active {
  background: #1e40af;
  border-color: #3b82f6;
}

/* Слайдер внизу карточки */
.meal-rating-card > .mood-slider {
  width: 100%;
  margin: 0;
}

/* Анимации */
@keyframes meal-emoji-bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}

@keyframes meal-emoji-shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-3px); }
  75% { transform: translateX(3px); }
}

/* Старые стили для совместимости — можно удалить позже */
.meal-rating-row {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0 8px;
}

.meal-rating-label {
  display: flex;
  align-items: center;
  gap: 6px;
  min-width: 110px;
}

.meal-rating-emoji {
  font-size: 24px;
  transition: transform 0.3s ease, filter 0.3s ease;
}

.meal-rating-name {
  font-size: 13px;
  font-weight: 600;
  color: #374151;
}

[data-theme="dark"] .meal-rating-name {
  color: #d1d5db;
}

/* Comment section */
.meal-comment-section {
  margin-top: 8px;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
  background: #fafafa;
  transition: all 0.2s ease;
}

.meal-comment-negative {
  background: #fef2f2;
  border-color: #fecaca;
}

.meal-comment-positive {
  background: #f0fdf4;
  border-color: #bbf7d0;
}

.meal-comment-neutral {
  background: #f8fafc;
  border-color: #e2e8f0;
}

[data-theme="dark"] .meal-comment-section {
  background: #1e293b;
  border-color: #334155;
}

[data-theme="dark"] .meal-comment-negative {
  background: rgba(239, 68, 68, 0.1);
  border-color: rgba(239, 68, 68, 0.3);
}

[data-theme="dark"] .meal-comment-positive {
  background: rgba(34, 197, 94, 0.1);
  border-color: rgba(34, 197, 94, 0.3);
}

.meal-comment-header {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  margin-bottom: 10px;
  min-height: 36px;
}

.meal-comment-icon {
  font-size: 18px;
  flex-shrink: 0;
}

.meal-comment-title {
  font-size: 13px;
  font-weight: 600;
  color: #374151;
  line-height: 1.4;
  min-height: 36px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.meal-comment-negative .meal-comment-title {
  color: #991b1b;
}

.meal-comment-positive .meal-comment-title {
  color: #166534;
}

[data-theme="dark"] .meal-comment-title {
  color: #d1d5db;
}

[data-theme="dark"] .meal-comment-negative .meal-comment-title {
  color: #fca5a5;
}

[data-theme="dark"] .meal-comment-positive .meal-comment-title {
  color: #86efac;
}

/* Quick chips — одна строка, скролл, фиксированная высота */
.meal-comment-chips {
  display: flex;
  flex-wrap: nowrap;
  gap: 6px;
  margin-bottom: 8px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  -ms-overflow-style: none;
  min-height: 28px;
}

.meal-comment-chips::-webkit-scrollbar {
  display: none;
}

/* Пустые chips — резервируем место */
.meal-comment-chips:empty {
  min-height: 28px;
}

.meal-comment-chip {
  padding: 5px 10px;
  font-size: 12px;
  font-weight: 500;
  color: #64748b;
  background: white;
  border: 1px solid #d1d5db;
  border-radius: 16px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.meal-comment-chip:active {
  transform: scale(0.95);
}

.meal-comment-negative .meal-comment-chip {
  color: #991b1b;
  border-color: #fca5a5;
  background: #fff1f2;
}

.meal-comment-positive .meal-comment-chip {
  color: #166534;
  border-color: #86efac;
  background: #f0fdf4;
}

[data-theme="dark"] .meal-comment-chip {
  background: #374151;
  border-color: #4b5563;
  color: #d1d5db;
}

/* Comment input */
.meal-comment-input {
  width: 100%;
  padding: 10px 12px;
  font-size: 14px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  background: white;
  color: #374151;
  resize: none;
  transition: border-color 0.2s ease;
}

.meal-comment-input:focus {
  outline: none;
  border-color: #3b82f6;
}

.meal-comment-input::placeholder {
  color: #9ca3af;
}

[data-theme="dark"] .meal-comment-input {
  background: #1e293b;
  border-color: #475569;
  color: #f1f5f9;
}

[data-theme="dark"] .meal-comment-input::placeholder {
  color: #64748b;
}

/* Confetti */
.confetti-container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  overflow: hidden;
  z-index: 100;
}

.confetti-piece {
  position: absolute;
  width: 8px;
  height: 8px;
  border-radius: 2px;
  animation: confetti-fall 2s ease-out forwards;
}

@keyframes confetti-fall {
  0% {
    transform: translateY(-20px) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(300px) rotate(720deg);
    opacity: 0;
  }
}

/* === ADD PRODUCT STEP === */

/* === APS (Add Product Step) Modal Override === */
/* Компактная модалка для добавления продукта */
.mc-modal:has(.aps-search-step),
.mc-modal:has(.aps-grams-step) {
  max-width: 340px;
}

.mc-modal:has(.aps-search-step) .mc-step-content,
.mc-modal:has(.aps-grams-step) .mc-step-content {
  padding: 0 12px 12px;
  min-height: auto;
}

.aps-search-step {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 0;
  height: 540px;
  max-height: 540px;
  overflow-y: auto;
  overscroll-behavior: contain;
}

/* Кнопка "Новый продукт" */
.aps-new-product-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 12px;
  background: linear-gradient(135deg, #dbeafe 0%, #ede9fe 100%);
  border: 1.5px dashed #93c5fd;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 13px;
  font-weight: 600;
  color: #2563eb;
}

.aps-new-product-btn:hover {
  background: linear-gradient(135deg, #bfdbfe 0%, #ddd6fe 100%);
  border-color: #60a5fa;
}

.aps-new-product-btn:active {
  transform: scale(0.98);
}

.aps-new-icon {
  width: 22px;
  height: 22px;
  background: #2563eb;
  color: #fff;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  font-weight: 700;
}

.aps-new-hint {
  margin-left: auto;
  font-size: 12px;
  font-weight: 400;
  color: #6b7280;
}

[data-theme="dark"] .aps-new-product-btn {
  background: linear-gradient(135deg, #1e3a5f 0%, #312e81 100%);
  border-color: #3b82f6;
  color: #93c5fd;
}

[data-theme="dark"] .aps-new-icon {
  background: #3b82f6;
}

[data-theme="dark"] .aps-new-hint {
  color: #9ca3af;
}

/* Поле поиска */
.aps-search-container {
  position: relative;
  display: flex;
  align-items: center;
}

.aps-search-icon {
  position: absolute;
  left: 12px;
  font-size: 14px;
  pointer-events: none;
  opacity: 0.5;
  z-index: 1;
}

.aps-search-input {
  width: 100%;
  padding: 10px 36px 10px 12px;
  padding-left: 38px !important;
  font-size: 15px;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: var(--card);
  color: var(--text);
  transition: border-color 0.2s;
  box-sizing: border-box;
}

.aps-search-input:focus {
  outline: none;
  border-color: var(--acc);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.aps-search-clear {
  position: absolute;
  right: 12px;
  width: 24px;
  height: 24px;
  border: none;
  background: #e5e7eb;
  color: #6b7280;
  border-radius: 50%;
  cursor: pointer;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
}

[data-theme="dark"] .aps-search-clear {
  background: #4b5563;
  color: #d1d5db;
}

/* Секции */
.aps-section {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.aps-section-title {
  font-size: 11px;
  font-weight: 600;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding-left: 2px;
}

/* Список продуктов */
.aps-products-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* Карточка продукта */
.aps-product-card {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.aps-product-card:hover {
  background: #f8fafc;
  border-color: var(--acc);
}

.aps-product-card:active {
  transform: scale(0.98);
  background: #f1f5f9;
}

[data-theme="dark"] .aps-product-card:hover {
  background: #1e293b;
}

[data-theme="dark"] .aps-product-card:active {
  background: #0f172a;
}

.aps-product-icon {
  font-size: 20px;
  min-width: 26px;
  text-align: center;
}

.aps-product-info {
  flex: 1;
  min-width: 0;
}

.aps-product-name {
  font-size: 14px;
  font-weight: 500;
  color: var(--text);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.aps-product-meta {
  font-size: 12px;
  color: var(--muted);
  display: flex;
  gap: 4px;
  margin-top: 1px;
}

.aps-product-meta-sep {
  opacity: 0.5;
}

/* Контейнер кнопок действий */
.aps-product-actions {
  display: flex;
  align-items: center;
  gap: 2px;
  flex-shrink: 0;
}

/* Кнопка удаления — маленькая */
.aps-delete-btn {
  width: 28px;
  height: 28px;
  border: none;
  background: transparent;
  color: #9ca3af;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.15s;
  border-radius: 6px;
  opacity: 0.4;
}

.aps-delete-btn:hover {
  background: #fee2e2;
  color: #ef4444;
  opacity: 1;
}

.aps-delete-btn:active {
  transform: scale(0.9);
}

.aps-fav-btn {
  width: 36px;
  height: 36px;
  border: none;
  background: transparent;
  color: #d1d5db;
  font-size: 20px;
  cursor: pointer;
  transition: all 0.15s;
  border-radius: 8px;
}

.aps-fav-btn:hover {
  background: #fef3c7;
  color: #f59e0b;
}

.aps-fav-btn.active {
  color: #f59e0b;
}

/* Пустое состояние */
.aps-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 24px;
  color: var(--muted);
}

.aps-empty span:first-child {
  font-size: 32px;
}

.aps-add-new-btn {
  margin-top: 8px;
  padding: 10px 20px;
  background: var(--acc);
  color: #fff;
  border: none;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.15s;
}

.aps-add-new-btn:hover {
  opacity: 0.9;
}

/* === GRAMS STEP === */

.aps-grams-step {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  padding: 0;
  height: 520px;
  max-height: 520px;
  overflow-y: auto;
}

.aps-product-header {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  padding: 10px 12px;
  background: var(--stats-bg);
  border: 1px solid var(--stats-border);
  border-radius: 10px;
}

.aps-product-icon-lg {
  font-size: 26px;
}

.aps-product-title {
  font-size: 15px;
  font-weight: 600;
  color: var(--text);
}

/* Дисплей калорий — компактный */
.aps-kcal-display {
  display: flex;
  align-items: baseline;
  justify-content: center;
  padding: 8px 0;
}

.aps-kcal-value {
  font-size: 42px;
  font-weight: 700;
  color: var(--text);
  line-height: 1;
}

.aps-kcal-unit {
  font-size: 16px;
  font-weight: 500;
  color: var(--muted);
  margin-left: 3px;
}

/* БЖУ — компактный */
.aps-macros {
  display: flex;
  justify-content: center;
  gap: 16px;
}

.aps-macro {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}

.aps-macro-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--muted);
}

.aps-macro-value {
  font-size: 14px;
  font-weight: 600;
  color: var(--text);
}

/* Поле ввода граммов — компактный */
.aps-grams-input-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-top: 4px;
}

.aps-grams-btn {
  width: 40px;
  height: 40px;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--text);
  font-size: 16px;
  font-weight: 600;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.15s;
}

.aps-grams-btn:hover {
  background: #f1f5f9;
  border-color: var(--acc);
}

.aps-grams-btn:active {
  transform: scale(0.95);
}

.aps-grams-input {
  width: 80px;
  padding: 8px 6px;
  font-size: 22px;
  font-weight: 700;
  text-align: center;
  border: 2px solid var(--border);
  border-radius: 10px;
  background: var(--card);
  color: var(--text);
}

.aps-grams-input:focus {
  outline: none;
  border-color: var(--acc);
}

.aps-grams-unit {
  font-size: 15px;
  color: var(--muted);
}

/* Слайдер */
.aps-grams-slider {
  width: 100%;
  height: 8px;
  -webkit-appearance: none;
  appearance: none;
  background: linear-gradient(to right, #22c55e, #eab308, #ef4444);
  border-radius: 4px;
  outline: none;
  margin: 8px 0;
}

.aps-grams-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 24px;
  height: 24px;
  background: #fff;
  border: 2px solid var(--acc);
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

.aps-grams-slider::-moz-range-thumb {
  width: 24px;
  height: 24px;
  background: #fff;
  border: 2px solid var(--acc);
  border-radius: 50%;
  cursor: pointer;
}

/* Быстрые кнопки */
.aps-quick-grams {
  display: flex;
  justify-content: center;
  gap: 4px;
  flex-wrap: nowrap;
  overflow: hidden;
}

.aps-quick-btn {
  padding: 6px 10px;
  font-size: 13px;
  font-weight: 500;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--text);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.15s;
  flex-shrink: 1;
  min-width: 0;
}

.aps-quick-btn:hover {
  border-color: var(--acc);
}

.aps-quick-btn.active {
  background: var(--acc);
  color: #fff;
  border-color: var(--acc);
}

/* Порции продукта */
.aps-portions {
  width: 100%;
  margin-top: 6px;
}

.aps-portions-title {
  font-size: 11px;
  font-weight: 600;
  color: var(--muted);
  margin-bottom: 4px;
  text-align: center;
}

.aps-portions-list {
  display: flex;
  flex-wrap: nowrap;
  justify-content: center;
  gap: 3px;
  overflow: hidden;
}

.aps-portion-btn {
  padding: 4px 6px;
  font-size: 11px;
  border: 1px solid #d1fae5;
  background: #ecfdf5;
  color: #059669;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
  flex-shrink: 1;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
}

.aps-portion-btn:hover {
  border-color: #10b981;
}

.aps-portion-btn.active {
  background: #10b981;
  color: #fff;
  border-color: #10b981;
}

[data-theme="dark"] .aps-portion-btn {
  background: #064e3b;
  border-color: #065f46;
  color: #34d399;
}

[data-theme="dark"] .aps-portion-btn.active {
  background: #10b981;
  color: #fff;
}

.aps-no-product {
  text-align: center;
  padding: 40px;
  color: var(--muted);
  font-size: 16px;
}

/* === APS OPEN BUTTON (Кнопка вызова модалки) === */

.aps-open-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 10px 16px;
  background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
  border: 1px solid #93c5fd;
  border-radius: 10px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  color: #2563eb;
  transition: all 0.2s ease;
  white-space: nowrap;
}

.aps-open-btn:hover {
  background: linear-gradient(135deg, #bfdbfe 0%, #c7d2fe 100%);
  border-color: #60a5fa;
  transform: translateY(-1px);
}

.aps-open-btn:active {
  transform: scale(0.97);
}

.aps-open-icon {
  font-size: 16px;
}

.aps-open-text {
  font-weight: 600;
}

[data-theme="dark"] .aps-open-btn {
  background: linear-gradient(135deg, #1e3a5f 0%, #312e81 100%);
  border-color: #3b82f6;
  color: #93c5fd;
}

[data-theme="dark"] .aps-open-btn:hover {
  background: linear-gradient(135deg, #1e40af 0%, #4338ca 100%);
}

/* На мобильных — более компактная */
@media (max-width: 768px) {
  .aps-open-btn {
    padding: 12px 20px;
    font-size: 15px;
    border-radius: 12px;
    width: 100%;
    justify-content: center;
  }
  
  .aps-open-icon {
    font-size: 18px;
  }
}

/* === Категории-чипы === */
.aps-categories {
  display: flex;
  gap: 5px;
  padding: 4px 0;
  overflow-x: auto;
  scrollbar-width: none;
  -webkit-overflow-scrolling: touch;
}

.aps-categories::-webkit-scrollbar {
  display: none;
}

.aps-category-chip {
  flex-shrink: 0;
  padding: 4px 10px;
  font-size: 12px;
  border: 1px solid #e5e7eb;
  background: #f9fafb;
  color: #374151;
  border-radius: 14px;
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
}

.aps-category-chip:hover {
  background: #f3f4f6;
  border-color: #d1d5db;
}

.aps-category-chip.active {
  background: var(--acc);
  color: #fff;
  border-color: var(--acc);
}

[data-theme="dark"] .aps-category-chip {
  background: #374151;
  border-color: #4b5563;
  color: #d1d5db;
}

[data-theme="dark"] .aps-category-chip.active {
  background: var(--acc);
  border-color: var(--acc);
  color: #fff;
}

/* === Умные рекомендации === */
.aps-smart-rec {
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border-radius: 10px;
  padding: 8px !important;
  margin-bottom: 8px;
}

[data-theme="dark"] .aps-smart-rec {
  background: linear-gradient(135deg, #78350f 0%, #92400e 100%);
}

.aps-rec-hint {
  font-size: 12px;
  color: #92400e;
  margin-left: 8px;
  font-weight: 400;
}

[data-theme="dark"] .aps-rec-hint {
  color: #fcd34d;
}

.aps-products-horizontal {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  padding-bottom: 4px;
  scrollbar-width: none;
}

.aps-products-horizontal::-webkit-scrollbar {
  display: none;
}

.aps-products-horizontal .aps-product-card {
  flex-shrink: 0;
  min-width: 140px;
  max-width: 160px;
}

/* === Подсказка про последние граммы === */
.aps-last-grams-hint {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 8px 12px;
  background: #dbeafe;
  border-radius: 8px;
  font-size: 13px;
  color: #1e40af;
  margin-bottom: 8px;
}

[data-theme="dark"] .aps-last-grams-hint {
  background: #1e3a5f;
  color: #93c5fd;
}

.aps-last-grams-btn {
  padding: 4px 10px;
  background: #2563eb;
  color: #fff;
  border: none;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
}

.aps-last-grams-btn:hover {
  background: #1d4ed8;
}

.aps-last-grams-btn:active {
  transform: scale(0.95);
}

/* === Slide-анимация между шагами === */
/* Анимации слайда между шагами — временно выключены */
/*
.mc-step-content {
  transition: transform 0.25s ease, opacity 0.2s ease;
}

.mc-slide-left {
  animation: slideFromRight 0.25s ease forwards;
}

.mc-slide-right {
  animation: slideFromLeft 0.25s ease forwards;
}
*/

@keyframes slideFromRight {
  from {
    transform: translateX(30px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideFromLeft {
  from {
    transform: translateX(-30px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* === Переключатель граммы/ккал === */
.aps-input-mode-toggle {
  display: flex;
  gap: 6px;
  margin-bottom: 8px;
}

.aps-mode-btn {
  flex: 1;
  padding: 6px 10px;
  font-size: 12px;
  border: 1px solid #e5e7eb;
  background: #f9fafb;
  color: #6b7280;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s;
}

.aps-mode-btn.active {
  background: var(--acc);
  color: #fff;
  border-color: var(--acc);
}

/* === Ввод ккал === */
.aps-kcal-input-row {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 10px;
  background: #fef3c7;
  border-radius: 10px;
  margin-bottom: 8px;
}

.aps-kcal-label {
  font-size: 13px;
  color: #92400e;
}

.aps-kcal-input {
  width: 70px;
  padding: 6px 10px;
  font-size: 16px;
  font-weight: 600;
  text-align: center;
  border: 2px solid #f59e0b;
  border-radius: 6px;
  background: #fff;
}

.aps-kcal-input:focus {
  outline: none;
  border-color: #d97706;
}

.aps-calc-result {
  font-size: 16px;
  font-weight: 600;
  color: #059669;
}

[data-theme="dark"] .aps-kcal-input-row {
  background: #78350f;
}

[data-theme="dark"] .aps-kcal-label {
  color: #fcd34d;
}

[data-theme="dark"] .aps-kcal-input {
  background: #1f2937;
  border-color: #f59e0b;
  color: #fff;
}

/* === Итог дня === */
.aps-day-total {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  padding: 8px;
  background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
  border-radius: 10px;
  font-size: 13px;
  margin-top: 10px;
}

.aps-day-plus {
  font-weight: 700;
  color: #059669;
}

.aps-day-arrow {
  color: #6b7280;
}

.aps-day-sum {
  font-weight: 600;
  color: #1e40af;
}

.aps-day-pct {
  color: #6b7280;
}

[data-theme="dark"] .aps-day-total {
  background: linear-gradient(135deg, #1e3a5f 0%, #312e81 100%);
}

/* === CREATE PRODUCT STEP (Создание нового продукта) === */

.mc-modal:has(.aps-create-step) {
  max-width: 360px;
}

.mc-modal:has(.aps-create-step) .mc-step-content {
  padding: 0 12px 12px;
  min-height: auto;
}

.aps-create-step {
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 0;
  min-height: 400px;
}

.aps-create-header {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px;
  background: linear-gradient(135deg, #dbeafe 0%, #e0e7ff 100%);
  border-radius: 12px;
}

.aps-create-icon {
  font-size: 28px;
}

.aps-create-title {
  font-size: 16px;
  font-weight: 700;
  color: #1e40af;
}

[data-theme="dark"] .aps-create-header {
  background: linear-gradient(135deg, #1e3a5f 0%, #312e81 100%);
}

[data-theme="dark"] .aps-create-title {
  color: #93c5fd;
}

.aps-create-hint {
  font-size: 13px;
  color: var(--muted);
  line-height: 1.4;
}

.aps-create-format {
  font-size: 11px;
  color: #6b7280;
  font-family: monospace;
  background: #f3f4f6;
  padding: 4px 8px;
  border-radius: 4px;
  display: inline-block;
  margin-top: 4px;
}

[data-theme="dark"] .aps-create-format {
  background: #374151;
  color: #9ca3af;
}

.aps-create-textarea {
  width: 100%;
  min-height: 80px;
  padding: 12px;
  font-size: 14px;
  font-family: inherit;
  border: 2px solid var(--border);
  border-radius: 10px;
  background: var(--card);
  color: var(--text);
  resize: vertical;
  transition: border-color 0.2s;
  box-sizing: border-box;
}

.aps-create-textarea:focus {
  outline: none;
  border-color: var(--acc);
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.aps-create-textarea::placeholder {
  color: #9ca3af;
  font-size: 12px;
}

.aps-create-error {
  padding: 10px 12px;
  background: #fee2e2;
  border: 1px solid #fecaca;
  border-radius: 8px;
  color: #dc2626;
  font-size: 13px;
}

[data-theme="dark"] .aps-create-error {
  background: #7f1d1d;
  border-color: #991b1b;
  color: #fca5a5;
}

.aps-create-preview {
  padding: 12px;
  background: #ecfdf5;
  border: 1px solid #a7f3d0;
  border-radius: 10px;
}

[data-theme="dark"] .aps-create-preview {
  background: #064e3b;
  border-color: #065f46;
}

.aps-preview-title {
  font-size: 12px;
  font-weight: 600;
  color: #059669;
  margin-bottom: 6px;
}

[data-theme="dark"] .aps-preview-title {
  color: #34d399;
}

.aps-preview-name {
  font-size: 15px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 4px;
}

.aps-preview-macros {
  display: flex;
  gap: 10px;
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 4px;
}

.aps-preview-kcal {
  font-weight: 700;
  color: #059669;
}

[data-theme="dark"] .aps-preview-kcal {
  color: #34d399;
}

.aps-preview-extra {
  font-size: 12px;
  color: #6b7280;
}

[data-theme="dark"] .aps-preview-extra {
  color: #9ca3af;
}

/* Детальная таблица параметров */
.aps-preview-details {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 4px 12px;
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid #d1fae5;
}

[data-theme="dark"] .aps-preview-details {
  border-top-color: #065f46;
}

.aps-preview-row {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
}

.aps-preview-label {
  color: #6b7280;
}

[data-theme="dark"] .aps-preview-label {
  color: #9ca3af;
}

.aps-preview-value {
  font-weight: 600;
  color: var(--text);
}

.aps-create-btn {
  width: 100%;
  padding: 14px 20px;
  font-size: 15px;
  font-weight: 600;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
  background: #e5e7eb;
  color: #9ca3af;
}

.aps-create-btn.active {
  background: linear-gradient(135deg, #22c55e 0%, #10b981 100%);
  color: #fff;
  box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
}

.aps-create-btn.active:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
}

.aps-create-btn.active:active {
  transform: scale(0.98);
}

.aps-create-btn:disabled {
  cursor: not-allowed;
  opacity: 0.6;
}

[data-theme="dark"] .aps-create-btn {
  background: #374151;
  color: #6b7280;
}

[data-theme="dark"] .aps-create-btn.active {
  background: linear-gradient(135deg, #059669 0%, #047857 100%);
}

.aps-create-tip {
  font-size: 12px;
  color: #6b7280;
  text-align: center;
  padding: 8px;
  background: #f9fafb;
  border-radius: 8px;
}

[data-theme="dark"] .aps-create-tip {
  background: #1f2937;
  color: #9ca3af;
}

/* Подсказка о поисковом запросе */
.aps-create-search-hint {
  padding: 8px 12px;
  background: #dbeafe;
  border: 1px solid #93c5fd;
  border-radius: 8px;
  font-size: 13px;
  color: #1e40af;
}

.aps-create-search-hint strong {
  color: #1d4ed8;
}

[data-theme="dark"] .aps-create-search-hint {
  background: #1e3a5f;
  border-color: #3b82f6;
  color: #93c5fd;
}

[data-theme="dark"] .aps-create-search-hint strong {
  color: #60a5fa;
}

[data-theme="dark"] .aps-day-sum {
  color: #93c5fd;
}

/* Кнопка закрытия — используется базовый стиль из .mc-close-btn выше */


