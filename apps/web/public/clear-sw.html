<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–û—á–∏—Å—Ç–∫–∞ Service Workers –∏ –∫–µ—à–∞</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .status {
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
      background: white;
      border-left: 4px solid #4CAF50;
    }
    .error {
      border-left-color: #f44336;
    }
    button {
      background: #2196F3;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #0d8bf2;
    }
    pre {
      background: #263238;
      color: #aed581;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>üßπ –û—á–∏—Å—Ç–∫–∞ Service Workers –∏ –∫–µ—à–∞</h1>
  
  <button onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
  <button onclick="location.reload()">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
  <button onclick="location.href='/'">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</button>
  
  <div id="log"></div>

  <script>
    const log = document.getElementById('log');

    function addLog(message, isError = false) {
      const div = document.createElement('div');
      div.className = `status ${isError ? 'error' : ''}`;
      div.textContent = message;
      log.appendChild(div);
    }

    async function clearAll() {
      log.innerHTML = '';
      addLog('üöÄ –ù–∞—á–∞–ª–æ –æ—á–∏—Å—Ç–∫–∏...');

      try {
        // 1. –û—Ç–º–µ–Ω—è–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤—Å–µ—Ö Service Workers
        if ('serviceWorker' in navigator) {
          const registrations = await navigator.serviceWorker.getRegistrations();
          addLog(`üìã –ù–∞–π–¥–µ–Ω–æ Service Workers: ${registrations.length}`);
          
          for (const registration of registrations) {
            await registration.unregister();
            addLog(`‚úÖ Service Worker —É–¥–∞–ª—ë–Ω: ${registration.scope}`);
          }
        }

        // 2. –û—á–∏—â–∞–µ–º –≤—Å–µ –∫–µ—à–∏
        if ('caches' in window) {
          const cacheNames = await caches.keys();
          addLog(`üìã –ù–∞–π–¥–µ–Ω–æ –∫–µ—à–µ–π: ${cacheNames.length}`);
          
          for (const cacheName of cacheNames) {
            await caches.delete(cacheName);
            addLog(`‚úÖ –ö–µ—à —É–¥–∞–ª—ë–Ω: ${cacheName}`);
          }
        }

        // 3. –û—á–∏—â–∞–µ–º localStorage
        localStorage.clear();
        addLog('‚úÖ localStorage –æ—á–∏—â–µ–Ω');

        // 4. –û—á–∏—â–∞–µ–º sessionStorage
        sessionStorage.clear();
        addLog('‚úÖ sessionStorage –æ—á–∏—â–µ–Ω');

        // 5. –û—á–∏—â–∞–µ–º IndexedDB (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        if (window.indexedDB) {
          const databases = await indexedDB.databases();
          for (const db of databases) {
            if (db.name) {
              indexedDB.deleteDatabase(db.name);
              addLog(`‚úÖ IndexedDB —É–¥–∞–ª–µ–Ω–∞: ${db.name}`);
            }
          }
        }

        addLog('üéâ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
          window.location.reload(true);
        }, 2000);

      } catch (error) {
        addLog(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, true);
        console.error(error);
      }
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', () => {
      addLog('‚ÑπÔ∏è –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë" –¥–ª—è –Ω–∞—á–∞–ª–∞.');
    });
  </script>
</body>
</html>
