// heys_meal_optimizer_v1.js â€” Ð£Ð¼Ð½Ñ‹Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ñ€Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ð¸ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð²
// v1.0.0 | 2025-12-10
// ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð½Ñ‹Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ñ 50+ Ð½Ð°ÑƒÑ‡Ð½Ñ‹Ð¼Ð¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°Ð¼Ð¸

(function(global) {
  'use strict';
  const HEYS = global.HEYS = global.HEYS || {};
  const U = HEYS.utils || {};
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // NUTRIENT_KEYWORDS â€” Ð”ÐµÑ‚ÐµÐºÑ†Ð¸Ñ Ð¼Ð¸ÐºÑ€Ð¾Ð½ÑƒÑ‚Ñ€Ð¸ÐµÐ½Ñ‚Ð¾Ð² Ð¿Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑŽ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const NUTRIENT_KEYWORDS = {
    iron: {
      keywords: ['Ð¿ÐµÑ‡ÐµÐ½ÑŒ', 'Ð¿ÐµÑ‡Ñ‘Ð½ÐºÐ°', 'Ð³Ð¾Ð²ÑÐ´Ð¸Ð½Ð°', 'Ñ‚ÐµÐ»ÑÑ‚Ð¸Ð½Ð°', 'Ð³Ñ€ÐµÑ‡ÐºÐ°', 'Ñ‡ÐµÑ‡ÐµÐ²Ð¸Ñ†Ð°', 'ÑˆÐ¿Ð¸Ð½Ð°Ñ‚', 'Ñ„Ð°ÑÐ¾Ð»ÑŒ', 'Ð³Ð¾Ñ€Ð¾Ñ…', 'Ñ‚Ð¾Ñ„Ñƒ', 'ÐºÑƒÐ½Ð¶ÑƒÑ‚', 'ÐºÐ°ÐºÐ°Ð¾', 'ÐºÑ€Ð¾Ð²ÑÐ½ÐºÐ°'],
      icon: 'ðŸ©¸',
      name: 'Ð–ÐµÐ»ÐµÐ·Ð¾'
    },
    vitaminC: {
      keywords: ['Ð»Ð¸Ð¼Ð¾Ð½', 'Ð°Ð¿ÐµÐ»ÑŒÑÐ¸Ð½', 'Ð³Ñ€ÐµÐ¹Ð¿Ñ„Ñ€ÑƒÑ‚', 'ÐºÐ¸Ð²Ð¸', 'Ð¿ÐµÑ€ÐµÑ† Ð±Ð¾Ð»Ð³Ð°Ñ€ÑÐºÐ¸Ð¹', 'Ð¿ÐµÑ€ÐµÑ† ÑÐ»Ð°Ð´ÐºÐ¸Ð¹', 'ÑˆÐ¸Ð¿Ð¾Ð²Ð½Ð¸Ðº', 'ÑÐ¼Ð¾Ñ€Ð¾Ð´Ð¸Ð½Ð°', 'ÐºÐ»ÑƒÐ±Ð½Ð¸ÐºÐ°', 'Ð±Ñ€Ð¾ÐºÐºÐ¾Ð»Ð¸', 'ÐºÐ°Ð¿ÑƒÑÑ‚Ð°', 'Ð¿ÐµÑ‚Ñ€ÑƒÑˆÐºÐ°', 'ÑƒÐºÑ€Ð¾Ð¿'],
      icon: 'ðŸ‹',
      name: 'Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ C'
    },
    omega3: {
      keywords: ['Ð»Ð¾ÑÐ¾ÑÑŒ', 'ÑÑ‘Ð¼Ð³Ð°', 'ÑÐºÑƒÐ¼Ð±Ñ€Ð¸Ñ', 'ÑÐµÐ»ÑŒÐ´ÑŒ', 'Ñ„Ð¾Ñ€ÐµÐ»ÑŒ', 'ÑÐ°Ñ€Ð´Ð¸Ð½Ð°', 'Ð°Ð½Ñ‡Ð¾ÑƒÑ', 'Ñ‚ÑƒÐ½ÐµÑ†', 'Ð»ÑŒÐ½ÑÐ½Ð¾Ðµ', 'Ñ‡Ð¸Ð°', 'Ð³Ñ€ÐµÑ†Ðº', 'Ñ€Ñ‹Ð±Ð¸Ð¹ Ð¶Ð¸Ñ€'],
      icon: 'ðŸŸ',
      name: 'ÐžÐ¼ÐµÐ³Ð°-3'
    },
    calcium: {
      keywords: ['Ð¼Ð¾Ð»Ð¾ÐºÐ¾', 'Ñ‚Ð²Ð¾Ñ€Ð¾Ð³', 'ÑÑ‹Ñ€', 'Ð¹Ð¾Ð³ÑƒÑ€Ñ‚', 'ÐºÐµÑ„Ð¸Ñ€', 'Ð±Ñ€Ñ‹Ð½Ð·Ð°', 'Ð¿Ð°Ñ€Ð¼ÐµÐ·Ð°Ð½', 'ÑÐ¼ÐµÑ‚Ð°Ð½Ð°', 'ÑÐ»Ð¸Ð²ÐºÐ¸', 'ÐºÑƒÐ½Ð¶ÑƒÑ‚', 'Ð¼Ð¸Ð½Ð´Ð°Ð»ÑŒ', 'ÑÐ°Ñ€Ð´Ð¸Ð½Ð°'],
      icon: 'ðŸ¦´',
      name: 'ÐšÐ°Ð»ÑŒÑ†Ð¸Ð¹'
    },
    vitaminD: {
      keywords: ['Ð»Ð¾ÑÐ¾ÑÑŒ', 'ÑÑ‘Ð¼Ð³Ð°', 'ÑÐºÑƒÐ¼Ð±Ñ€Ð¸Ñ', 'ÑÐµÐ»ÑŒÐ´ÑŒ', 'ÑÐ¹Ñ†Ð¾', 'ÑÐ¸Ñ‡Ð½Ñ‹Ð¹ Ð¶ÐµÐ»Ñ‚Ð¾Ðº', 'Ð¿ÐµÑ‡ÐµÐ½ÑŒ Ñ‚Ñ€ÐµÑÐºÐ¸', 'Ñ€Ñ‹Ð±Ð¸Ð¹ Ð¶Ð¸Ñ€', 'Ð³Ñ€Ð¸Ð±Ñ‹'],
      icon: 'â˜€ï¸',
      name: 'Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ D'
    },
    magnesium: {
      keywords: ['Ð¼Ð¸Ð½Ð´Ð°Ð»ÑŒ', 'ÐºÐµÑˆÑŒÑŽ', 'Ð°Ñ€Ð°Ñ…Ð¸Ñ', 'ÑˆÐ¿Ð¸Ð½Ð°Ñ‚', 'Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾', 'Ð±Ð°Ð½Ð°Ð½', 'Ð³Ñ€ÐµÑ‡ÐºÐ°', 'Ð¾Ð²ÑÑÐ½ÐºÐ°', 'Ñ‚Ñ‘Ð¼Ð½Ñ‹Ð¹ ÑˆÐ¾ÐºÐ¾Ð»Ð°Ð´', 'ÐºÐ°ÐºÐ°Ð¾', 'Ñ‚Ñ‹ÐºÐ²ÐµÐ½Ð½', 'ÑÐµÐ¼ÐµÑ‡Ðº'],
      icon: 'ðŸ’ª',
      name: 'ÐœÐ°Ð³Ð½Ð¸Ð¹'
    },
    zinc: {
      keywords: ['Ð³Ð¾Ð²ÑÐ´Ð¸Ð½Ð°', 'Ð±Ð°Ñ€Ð°Ð½Ð¸Ð½Ð°', 'ÑÐ²Ð¸Ð½Ð¸Ð½Ð°', 'ÑƒÑÑ‚Ñ€Ð¸Ñ†', 'ÐºÑ€Ð°Ð±', 'ÐºÑƒÑ€Ð¸Ñ†Ð°', 'Ð¸Ð½Ð´ÐµÐ¹ÐºÐ°', 'Ñ‚Ñ‹ÐºÐ²ÐµÐ½Ð½', 'ÐºÑƒÐ½Ð¶ÑƒÑ‚', 'Ñ‡ÐµÑ‡ÐµÐ²Ð¸Ñ†Ð°', 'Ð½ÑƒÑ‚'],
      icon: 'ðŸ›¡ï¸',
      name: 'Ð¦Ð¸Ð½Ðº'
    },
    potassium: {
      keywords: ['Ð±Ð°Ð½Ð°Ð½', 'ÐºÐ°Ñ€Ñ‚Ð¾Ñ„ÐµÐ»ÑŒ', 'Ð±Ð°Ñ‚Ð°Ñ‚', 'Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾', 'ÑˆÐ¿Ð¸Ð½Ð°Ñ‚', 'Ñ„Ð°ÑÐ¾Ð»ÑŒ', 'Ñ‡ÐµÑ‡ÐµÐ²Ð¸Ñ†Ð°', 'ÐºÑƒÑ€Ð°Ð³Ð°', 'Ð¸Ð·ÑŽÐ¼', 'Ð°Ð¿ÐµÐ»ÑŒÑÐ¸Ð½'],
      icon: 'âš¡',
      name: 'ÐšÐ°Ð»Ð¸Ð¹'
    },
    fiber: {
      keywords: ['Ð¾Ñ‚Ñ€ÑƒÐ±Ð¸', 'Ñ‡ÐµÑ‡ÐµÐ²Ð¸Ñ†Ð°', 'Ñ„Ð°ÑÐ¾Ð»ÑŒ', 'Ð³Ð¾Ñ€Ð¾Ñ…', 'Ð½ÑƒÑ‚', 'Ð¾Ð²ÑÑÐ½ÐºÐ°', 'Ð±Ñ€Ð¾ÐºÐºÐ¾Ð»Ð¸', 'Ð¼Ð°Ð»Ð¸Ð½Ð°', 'Ð³Ñ€ÑƒÑˆÐ°', 'ÑÐ±Ð»Ð¾ÐºÐ¾', 'Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾', 'Ð°Ñ€Ñ‚Ð¸ÑˆÐ¾Ðº'],
      icon: 'ðŸŒ¾',
      name: 'ÐšÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÐ°'
    },
    vitaminB12: {
      keywords: ['Ð¿ÐµÑ‡ÐµÐ½ÑŒ', 'Ð³Ð¾Ð²ÑÐ´Ð¸Ð½Ð°', 'Ð±Ð°Ñ€Ð°Ð½Ð¸Ð½Ð°', 'Ð»Ð¾ÑÐ¾ÑÑŒ', 'Ñ„Ð¾Ñ€ÐµÐ»ÑŒ', 'Ñ‚ÑƒÐ½ÐµÑ†', 'ÑÐ°Ñ€Ð´Ð¸Ð½Ð°', 'ÑÐ¹Ñ†Ð¾', 'Ð¼Ð¾Ð»Ð¾ÐºÐ¾', 'ÑÑ‹Ñ€'],
      icon: 'ðŸ”´',
      name: 'Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ B12'
    },
    vitaminA: {
      keywords: ['Ð¿ÐµÑ‡ÐµÐ½ÑŒ', 'Ð¼Ð¾Ñ€ÐºÐ¾Ð²ÑŒ', 'Ð±Ð°Ñ‚Ð°Ñ‚', 'Ñ‚Ñ‹ÐºÐ²Ð°', 'ÑˆÐ¿Ð¸Ð½Ð°Ñ‚', 'ÐºÐ°Ð¿ÑƒÑÑ‚Ð°', 'Ð¼Ð°Ð½Ð³Ð¾', 'Ð°Ð±Ñ€Ð¸ÐºÐ¾Ñ', 'Ð´Ñ‹Ð½Ñ', 'ÑÐ¹Ñ†Ð¾'],
      icon: 'ðŸ¥•',
      name: 'Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ A'
    },
    folate: {
      keywords: ['ÑˆÐ¿Ð¸Ð½Ð°Ñ‚', 'ÑÐ¿Ð°Ñ€Ð¶Ð°', 'Ð±Ñ€Ð¾ÐºÐºÐ¾Ð»Ð¸', 'Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾', 'Ñ‡ÐµÑ‡ÐµÐ²Ð¸Ñ†Ð°', 'Ñ„Ð°ÑÐ¾Ð»ÑŒ', 'Ð½ÑƒÑ‚', 'ÑÐ²Ñ‘ÐºÐ»Ð°', 'Ð°Ð¿ÐµÐ»ÑŒÑÐ¸Ð½', 'Ð¿ÐµÑ‡ÐµÐ½ÑŒ'],
      icon: 'ðŸŒ¿',
      name: 'Ð¤Ð¾Ð»Ð°Ñ‚'
    }
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RECOMMENDED_PORTIONS â€” ÐžÐ¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ñ€Ñ†Ð¸Ð¸ Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð°
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const RECOMMENDED_PORTIONS = {
    // Ð‘ÐµÐ»ÐºÐ¾Ð²Ñ‹Ðµ â€” Ð¿Ð¾Ð»Ð½Ð¾Ñ†ÐµÐ½Ð½Ð°Ñ Ð¿Ð¾Ñ€Ñ†Ð¸Ñ
    protein: { grams: 150, label: '150Ð³ â€” Ð¿Ð¾Ñ€Ñ†Ð¸Ñ' },
    // ÐœÐ¾Ð»Ð¾Ñ‡Ð½Ñ‹Ðµ â€” ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð°Ñ Ð¿Ð¾Ñ€Ñ†Ð¸Ñ
    dairy: { grams: 200, label: '200Ð³ â€” ÑÑ‚Ð°ÐºÐ°Ð½' },
    // ÐžÐ²Ð¾Ñ‰Ð¸ â€” Ñ‰ÐµÐ´Ñ€Ð°Ñ Ð¿Ð¾Ñ€Ñ†Ð¸Ñ
    vegetables: { grams: 150, label: '150Ð³ â€” Ð³Ð°Ñ€Ð½Ð¸Ñ€' },
    // Ð¤Ñ€ÑƒÐºÑ‚Ñ‹ â€” 1 ÑÑ€ÐµÐ´Ð½Ð¸Ð¹
    fruits: { grams: 150, label: '150Ð³ â€” 1 ÑˆÑ‚' },
    // Ð—ÐµÑ€Ð½Ð¾Ð²Ñ‹Ðµ â€” Ð¿Ð¾Ñ€Ñ†Ð¸Ñ Ð³Ð°Ñ€Ð½Ð¸Ñ€Ð°
    grains: { grams: 100, label: '100Ð³ â€” Ð¿Ð¾Ñ€Ñ†Ð¸Ñ' },
    // ÐžÑ€ÐµÑ…Ð¸ â€” Ð³Ð¾Ñ€ÑÑ‚ÑŒ
    nuts: { grams: 30, label: '30Ð³ â€” Ð³Ð¾Ñ€ÑÑ‚ÑŒ' },
    // ÐœÐ°ÑÐ»Ð¾ â€” ÑÑ‚Ð¾Ð»Ð¾Ð²Ð°Ñ Ð»Ð¾Ð¶ÐºÐ°
    oil: { grams: 15, label: '15Ð³ â€” 1 ÑÑ‚.Ð».' },
    // Ð—ÐµÐ»ÐµÐ½ÑŒ â€” Ð¿ÑƒÑ‡Ð¾Ðº
    greens: { grams: 30, label: '30Ð³ â€” Ð¿ÑƒÑ‡Ð¾Ðº' },
    // Ð¯Ð¹Ñ†Ð° â€” 2 ÑˆÑ‚ÑƒÐºÐ¸
    eggs: { grams: 120, label: '2 ÑÐ¹Ñ†Ð°' },
    // Ð¡Ñ‹Ñ€ â€” Ð»Ð¾Ð¼Ñ‚Ð¸Ðº
    cheese: { grams: 30, label: '30Ð³ â€” Ð»Ð¾Ð¼Ñ‚Ð¸Ðº' },
    // Ð¡Ð¾ÑƒÑ â€” Ð¿Ð¾Ñ€Ñ†Ð¸Ñ
    sauce: { grams: 30, label: '30Ð³ â€” Ð¿Ð¾Ñ€Ñ†Ð¸Ñ' },
    // ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
    default: { grams: 100, label: '100Ð³' }
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SYNERGY_RULES â€” 50+ Ð½Ð°ÑƒÑ‡Ð½Ñ‹Ñ… Ð¿Ñ€Ð°Ð²Ð¸Ð» ÑÐ¸Ð½ÐµÑ€Ð³Ð¸Ð¹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const SYNERGY_RULES = [
    // === IRON + VITAMIN C (ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ Ð¶ÐµÐ»ÐµÐ·Ð°) ===
    {
      id: 'iron_vitc',
      trigger: { has: 'iron', missing: 'vitaminC' },
      priority: 95,
      icon: 'ðŸ‹',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ C Ðº Ð¶ÐµÐ»ÐµÐ·Ñƒ',
      reason: 'Ð£ÑÐ²Ð°Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð² 6 Ñ€Ð°Ð· Ð»ÑƒÑ‡ÑˆÐµ',
      science: 'ÐÑÐºÐ¾Ñ€Ð±Ð¸Ð½Ð¾Ð²Ð°Ñ ÐºÐ¸ÑÐ»Ð¾Ñ‚Ð° Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÑ‚ FeÂ³âº â†’ FeÂ²âº',
      recommend: { categories: ['vitaminC'], keywords: ['Ð»Ð¸Ð¼Ð¾Ð½', 'Ð¿ÐµÑ€ÐµÑ†', 'Ð°Ð¿ÐµÐ»ÑŒÑÐ¸Ð½'] }
    },
    
    // === CALCIUM + VITAMIN D (ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ ÐºÐ°Ð»ÑŒÑ†Ð¸Ñ) ===
    {
      id: 'calcium_vitd',
      trigger: { has: 'calcium', missing: 'vitaminD' },
      priority: 90,
      icon: 'â˜€ï¸',
      title: 'Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ D Ð´Ð»Ñ ÐºÐ°Ð»ÑŒÑ†Ð¸Ñ',
      reason: 'ÐšÐ°Ð»ÑŒÑ†Ð¸Ð¹ Ð»ÑƒÑ‡ÑˆÐµ ÑƒÑÐ²Ð°Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ñ Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½Ð¾Ð¼ D',
      science: 'Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ D Ñ€ÐµÐ³ÑƒÐ»Ð¸Ñ€ÑƒÐµÑ‚ Ñ‚Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚ CaÂ²âº Ð² ÐºÐ¸ÑˆÐµÑ‡Ð½Ð¸ÐºÐµ',
      recommend: { categories: ['vitaminD'], keywords: ['ÑÐ¹Ñ†Ð¾', 'Ð»Ð¾ÑÐ¾ÑÑŒ', 'Ð³Ñ€Ð¸Ð±Ñ‹'] }
    },
    
    // === FAT + FAT-SOLUBLE VITAMINS (A, D, E, K) ===
    {
      id: 'fat_vitamins',
      trigger: { hasCategory: 'vegetables', missingMacro: 'fat', minGrams: 100 },
      priority: 85,
      icon: 'ðŸ«’',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð¼Ð°ÑÐ»Ð¾ Ðº Ð¾Ð²Ð¾Ñ‰Ð°Ð¼',
      reason: 'ÐšÐ°Ñ€Ð¾Ñ‚Ð¸Ð½Ñ‹ ÑƒÑÐ²Ð°Ð¸Ð²Ð°ÑŽÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ Ð¶Ð¸Ñ€Ð°Ð¼Ð¸',
      science: 'Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½Ñ‹ A, D, E, K â€” Ð¶Ð¸Ñ€Ð¾Ñ€Ð°ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð¼Ñ‹Ðµ',
      recommend: { keywords: ['Ð¼Ð°ÑÐ»Ð¾ Ð¾Ð»Ð¸Ð²ÐºÐ¾Ð²Ð¾Ðµ', 'Ð¼Ð°ÑÐ»Ð¾', 'Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾', 'Ð¾Ñ€ÐµÑ…'] }
    },
    
    // === PROTEIN COMPLETENESS (Ñ€Ð°ÑÑ‚Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð±ÐµÐ»Ð¾Ðº) ===
    {
      id: 'plant_protein',
      trigger: { hasCategory: 'grains', missingCategory: 'legumes', mealProtLow: true },
      priority: 80,
      icon: 'ðŸ«˜',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð±Ð¾Ð±Ð¾Ð²Ñ‹Ðµ Ðº ÐºÑ€ÑƒÐ¿Ðµ',
      reason: 'ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð°Ð¼Ð¸Ð½Ð¾ÐºÐ¸ÑÐ»Ð¾Ñ‚Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»ÑŒ',
      science: 'Ð—Ð»Ð°ÐºÐ¸ + Ð±Ð¾Ð±Ð¾Ð²Ñ‹Ðµ = Ð²ÑÐµ Ð½ÐµÐ·Ð°Ð¼ÐµÐ½Ð¸Ð¼Ñ‹Ðµ Ð°Ð¼Ð¸Ð½Ð¾ÐºÐ¸ÑÐ»Ð¾Ñ‚Ñ‹',
      recommend: { keywords: ['Ñ„Ð°ÑÐ¾Ð»ÑŒ', 'Ñ‡ÐµÑ‡ÐµÐ²Ð¸Ñ†Ð°', 'Ð½ÑƒÑ‚', 'Ð³Ð¾Ñ€Ð¾Ñ…'] }
    },
    
    // === TURMERIC + BLACK PEPPER (ÐºÑƒÑ€ÐºÑƒÐ¼Ð¸Ð½) ===
    {
      id: 'turmeric_pepper',
      trigger: { hasKeyword: ['ÐºÑƒÑ€ÐºÑƒÐ¼'], missingKeyword: ['Ð¿ÐµÑ€ÐµÑ† Ñ‡Ñ‘Ñ€Ð½'] },
      priority: 75,
      icon: 'ðŸŒ¶ï¸',
      title: 'Ð§Ñ‘Ñ€Ð½Ñ‹Ð¹ Ð¿ÐµÑ€ÐµÑ† Ðº ÐºÑƒÑ€ÐºÑƒÐ¼Ðµ',
      reason: 'Ð£ÑÐ²Ð¾ÐµÐ½Ð¸Ðµ ÐºÑƒÑ€ÐºÑƒÐ¼Ð¸Ð½Ð° +2000%',
      science: 'ÐŸÐ¸Ð¿ÐµÑ€Ð¸Ð½ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ Ð¼ÐµÑ‚Ð°Ð±Ð¾Ð»Ð¸Ð·Ð¼ ÐºÑƒÑ€ÐºÑƒÐ¼Ð¸Ð½Ð° Ð² Ð¿ÐµÑ‡ÐµÐ½Ð¸',
      recommend: { keywords: ['Ð¿ÐµÑ€ÐµÑ† Ñ‡Ñ‘Ñ€Ð½Ñ‹Ð¹'] }
    },
    
    // === TOMATO + FAT (Ð»Ð¸ÐºÐ¾Ð¿Ð¸Ð½) ===
    {
      id: 'tomato_fat',
      trigger: { hasKeyword: ['Ð¿Ð¾Ð¼Ð¸Ð´Ð¾Ñ€', 'Ñ‚Ð¾Ð¼Ð°Ñ‚'], missingMacro: 'fat' },
      priority: 70,
      icon: 'ðŸ…',
      title: 'ÐœÐ°ÑÐ»Ð¾ Ðº Ñ‚Ð¾Ð¼Ð°Ñ‚Ð°Ð¼',
      reason: 'Ð›Ð¸ÐºÐ¾Ð¿Ð¸Ð½ ÑƒÑÐ²Ð°Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð² 4 Ñ€Ð°Ð·Ð° Ð»ÑƒÑ‡ÑˆÐµ',
      science: 'Ð›Ð¸ÐºÐ¾Ð¿Ð¸Ð½ â€” Ð¶Ð¸Ñ€Ð¾Ñ€Ð°ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð¼Ñ‹Ð¹ ÐºÐ°Ñ€Ð¾Ñ‚Ð¸Ð½Ð¾Ð¸Ð´',
      recommend: { keywords: ['Ð¼Ð°ÑÐ»Ð¾ Ð¾Ð»Ð¸Ð²ÐºÐ¾Ð²Ð¾Ðµ', 'Ð¼Ð°ÑÐ»Ð¾', 'Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾'] }
    },
    
    // === TEA + MILK BLOCKS ANTIOXIDANTS ===
    {
      id: 'tea_no_milk',
      trigger: { hasKeyword: ['Ñ‡Ð°Ð¹ Ð·ÐµÐ»Ñ‘Ð½Ñ‹Ð¹', 'Ñ‡Ð°Ð¹ Ñ‡Ñ‘Ñ€Ð½Ñ‹Ð¹'], hasKeyword2: ['Ð¼Ð¾Ð»Ð¾ÐºÐ¾'] },
      priority: 65,
      icon: 'âš ï¸',
      title: 'ÐœÐ¾Ð»Ð¾ÐºÐ¾ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ Ð°Ð½Ñ‚Ð¸Ð¾ÐºÑÐ¸Ð´Ð°Ð½Ñ‚Ñ‹ Ñ‡Ð°Ñ',
      reason: 'ÐšÐ°Ð·ÐµÐ¸Ð½ ÑÐ²ÑÐ·Ñ‹Ð²Ð°ÐµÑ‚ ÐºÐ°Ñ‚ÐµÑ…Ð¸Ð½Ñ‹',
      science: 'Ð˜ÑÑÐ»ÐµÐ´Ð¾Ð²Ð°Ð½Ð¸Ðµ European Heart Journal 2007',
      isWarning: true
    },
    
    // === COFFEE BLOCKS IRON ===
    {
      id: 'coffee_iron',
      trigger: { hasKeyword: ['ÐºÐ¾Ñ„Ðµ'], has: 'iron' },
      priority: 85,
      icon: 'âš ï¸',
      title: 'ÐšÐ¾Ñ„Ðµ ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ Ð¶ÐµÐ»ÐµÐ·Ð° Ð½Ð° 80%',
      reason: 'ÐŸÐµÐ¹ ÐºÐ¾Ñ„Ðµ Ñ‡ÐµÑ€ÐµÐ· 1-2 Ñ‡Ð°ÑÐ° Ð¿Ð¾ÑÐ»Ðµ ÐµÐ´Ñ‹',
      science: 'Ð¢Ð°Ð½Ð¸Ð½Ñ‹ ÑÐ²ÑÐ·Ñ‹Ð²Ð°ÑŽÑ‚ Ð¶ÐµÐ»ÐµÐ·Ð¾ Ð² Ð½ÐµÑ€Ð°ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð¼Ñ‹Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ',
      isWarning: true
    },
    
    // === FIBER + MINERALS ===
    {
      id: 'fiber_minerals',
      trigger: { highFiber: true, has: 'zinc' },
      priority: 60,
      icon: 'ðŸ’¡',
      title: 'ÐœÐ½Ð¾Ð³Ð¾ ÐºÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÐ¸ ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ Ñ†Ð¸Ð½ÐºÐ°',
      reason: 'Ð¤Ð¸Ñ‚Ð°Ñ‚Ñ‹ ÑÐ²ÑÐ·Ñ‹Ð²Ð°ÑŽÑ‚ Ð¼Ð¸Ð½ÐµÑ€Ð°Ð»Ñ‹',
      science: 'ÐÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾ Ð¿Ñ€Ð¸ >35Ð³ ÐºÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÐ¸/Ð´ÐµÐ½ÑŒ',
      isWarning: true,
      mild: true
    },
    
    // === PROTEIN + LEUCINE TRIGGER ===
    {
      id: 'protein_leucine',
      trigger: { mealProtein: { min: 20, max: 25 } },
      priority: 70,
      icon: 'ðŸ’ª',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ ÐµÑ‰Ñ‘ Ð±ÐµÐ»ÐºÐ° Ð´Ð¾ 30Ð³',
      reason: 'Ð›ÐµÐ¹Ñ†Ð¸Ð½Ð¾Ð²Ñ‹Ð¹ Ð¿Ð¾Ñ€Ð¾Ð³ Ð´Ð»Ñ ÑÐ¸Ð½Ñ‚ÐµÐ·Ð° Ð¼Ñ‹ÑˆÑ†',
      science: '~3Ð³ Ð»ÐµÐ¹Ñ†Ð¸Ð½Ð° = Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð°Ð½Ð°Ð±Ð¾Ð»Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚',
      recommend: { categories: ['protein'], keywords: ['ÑÐ¹Ñ†Ð¾', 'Ñ‚Ð²Ð¾Ñ€Ð¾Ð³', 'ÐºÑƒÑ€Ð¸Ñ†Ð°'] }
    },
    
    // === LOW GI + HIGH GI BALANCING ===
    {
      id: 'gi_balance',
      trigger: { mealGI: { min: 70 } },
      priority: 75,
      icon: 'ðŸ“‰',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ ÐºÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÑƒ Ð´Ð»Ñ ÑÐ½Ð¸Ð¶ÐµÐ½Ð¸Ñ Ð“Ð˜',
      reason: 'Ð¡Ð³Ð»Ð°Ð´Ð¸Ñ‚ ÑÐºÐ°Ñ‡Ð¾Ðº ÑÐ°Ñ…Ð°Ñ€Ð°',
      science: 'ÐšÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÐ° Ð·Ð°Ð¼ÐµÐ´Ð»ÑÐµÑ‚ Ð²ÑÐ°ÑÑ‹Ð²Ð°Ð½Ð¸Ðµ Ð³Ð»ÑŽÐºÐ¾Ð·Ñ‹',
      recommend: { categories: ['fiber'], keywords: ['Ð¾Ð²Ð¾Ñ‰Ð¸', 'ÑÐ°Ð»Ð°Ñ‚', 'Ð¾Ð³ÑƒÑ€ÐµÑ†'] }
    },
    
    // === EVENING PROTEIN ===
    {
      id: 'evening_protein',
      trigger: { time: { after: '20:00' }, mealProtLow: true },
      priority: 80,
      icon: 'ðŸŒ™',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ ÐºÐ°Ð·ÐµÐ¸Ð½ Ð½Ð° Ð½Ð¾Ñ‡ÑŒ',
      reason: 'ÐœÐµÐ´Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ð±ÐµÐ»Ð¾Ðº = Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²Ð¾ ÑÐ½Ðµ',
      science: 'ÐšÐ°Ð·ÐµÐ¸Ð½ Ð¿ÐµÑ€ÐµÐ²Ð°Ñ€Ð¸Ð²Ð°ÐµÑ‚ÑÑ 6-8 Ñ‡Ð°ÑÐ¾Ð²',
      recommend: { keywords: ['Ñ‚Ð²Ð¾Ñ€Ð¾Ð³', 'ÐºÐ°Ð·ÐµÐ¸Ð½', 'ÑÑ‹Ñ€'] }
    },
    
    // === PRE-WORKOUT CARBS ===
    {
      id: 'preworkout_carbs',
      trigger: { hasTrainingAfterMeal: true, mealCarbsLow: true },
      priority: 75,
      icon: 'âš¡',
      title: 'Ð£Ð³Ð»ÐµÐ²Ð¾Ð´Ñ‹ Ð¿ÐµÑ€ÐµÐ´ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¾Ð¹',
      reason: 'Ð­Ð½ÐµÑ€Ð³Ð¸Ñ Ð´Ð»Ñ Ð¸Ð½Ñ‚ÐµÐ½ÑÐ¸Ð²Ð½Ð¾Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹',
      science: 'Ð“Ð»Ð¸ÐºÐ¾Ð³ÐµÐ½ = Ñ‚Ð¾Ð¿Ð»Ð¸Ð²Ð¾ Ð´Ð»Ñ Ð¼Ñ‹ÑˆÑ†',
      recommend: { categories: ['grains'], keywords: ['Ð±Ð°Ð½Ð°Ð½', 'Ð¾Ð²ÑÑÐ½ÐºÐ°', 'Ñ€Ð¸Ñ'] }
    },
    
    // === POST-WORKOUT PROTEIN ===
    {
      id: 'postworkout_protein',
      trigger: { hadTrainingRecently: true, mealProtLow: true },
      priority: 90,
      icon: 'ðŸ‹ï¸',
      title: 'Ð‘ÐµÐ»Ð¾Ðº Ð¿Ð¾ÑÐ»Ðµ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸',
      reason: 'ÐžÐºÐ½Ð¾ Ð°Ð½Ð°Ð±Ð¾Ð»Ð¸Ð·Ð¼Ð° â€” 2 Ñ‡Ð°ÑÐ°',
      science: 'Ð¡Ð¸Ð½Ñ‚ÐµÐ· Ð¼Ñ‹ÑˆÐµÑ‡Ð½Ð¾Ð³Ð¾ Ð±ÐµÐ»ÐºÐ° Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÐµÐ½ Ð¿Ð¾ÑÐ»Ðµ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸',
      recommend: { categories: ['protein'], keywords: ['ÐºÑƒÑ€Ð¸Ñ†Ð°', 'ÑÐ¹Ñ†Ð¾', 'Ñ‚Ð²Ð¾Ñ€Ð¾Ð³', 'Ð¿Ñ€Ð¾Ñ‚ÐµÐ¸Ð½'] }
    },
    
    // === CARBS + PROTEIN COMBO ===
    {
      id: 'carbs_protein_combo',
      trigger: { hasOnlyCarbs: true, mealKcal: { min: 300 } },
      priority: 70,
      icon: 'ðŸ¥—',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð±ÐµÐ»Ð¾Ðº Ðº ÑƒÐ³Ð»ÐµÐ²Ð¾Ð´Ð°Ð¼',
      reason: 'Ð”Ð¾Ð»ÑŒÑˆÐµ Ð½Ð°ÑÑ‹Ñ‰Ð°ÐµÑ‚ + ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ°Ñ…Ð°Ñ€',
      science: 'Ð‘ÐµÐ»Ð¾Ðº Ð·Ð°Ð¼ÐµÐ´Ð»ÑÐµÑ‚ Ð¾Ð¿Ð¾Ñ€Ð¾Ð¶Ð½ÐµÐ½Ð¸Ðµ Ð¶ÐµÐ»ÑƒÐ´ÐºÐ°',
      recommend: { categories: ['protein'], keywords: ['ÑÐ¹Ñ†Ð¾', 'Ñ‚Ð²Ð¾Ñ€Ð¾Ð³', 'ÐºÑƒÑ€Ð¸Ñ†Ð°', 'Ñ€Ñ‹Ð±Ð°'] }
    },
    
    // === SIMPLE CARBS WARNING ===
    {
      id: 'simple_carbs_high',
      trigger: { mealSimpleCarbs: { min: 30 } },
      priority: 65,
      icon: 'ðŸ¬',
      title: 'ÐœÐ½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ñ… ÑƒÐ³Ð»ÐµÐ²Ð¾Ð´Ð¾Ð²',
      reason: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð±ÐµÐ»Ð¾Ðº Ð¸Ð»Ð¸ ÐºÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÑƒ',
      science: 'Ð—Ð°Ð¼ÐµÐ´Ð»Ð¸Ñ‚ ÑÐºÐ°Ñ‡Ð¾Ðº Ð¸Ð½ÑÑƒÐ»Ð¸Ð½Ð°',
      recommend: { categories: ['protein', 'fiber'], keywords: ['Ð¾Ñ€ÐµÑ…', 'Ñ‚Ð²Ð¾Ñ€Ð¾Ð³', 'Ð¾Ð²Ð¾Ñ‰Ð¸'] }
    },
    
    // === BREAKFAST PROTEIN ===
    {
      id: 'breakfast_protein',
      trigger: { time: { before: '10:00' }, mealProtLow: true, mealKcal: { min: 200 } },
      priority: 80,
      icon: 'ðŸ³',
      title: 'Ð‘ÐµÐ»Ð¾Ðº Ð½Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð°Ðº',
      reason: 'Ð¡Ñ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð°Ñ ÑÐ½ÐµÑ€Ð³Ð¸Ñ Ð´Ð¾ Ð¾Ð±ÐµÐ´Ð°',
      science: 'Ð‘ÐµÐ»Ð¾Ðº Ð¿Ð¾Ð²Ñ‹ÑˆÐ°ÐµÑ‚ PYY Ð¸ ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ Ð³Ñ€ÐµÐ»Ð¸Ð½',
      recommend: { keywords: ['ÑÐ¹Ñ†Ð¾', 'Ñ‚Ð²Ð¾Ñ€Ð¾Ð³', 'Ð¹Ð¾Ð³ÑƒÑ€Ñ‚ Ð³Ñ€ÐµÑ‡ÐµÑÐºÐ¸Ð¹', 'ÑÑ‹Ñ€'] }
    },
    
    // === OMEGA-3 + WORKOUT ===
    {
      id: 'omega3_recovery',
      trigger: { hasTrainingToday: true, missing: 'omega3' },
      priority: 65,
      icon: 'ðŸŸ',
      title: 'ÐžÐ¼ÐµÐ³Ð°-3 Ð´Ð»Ñ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ',
      reason: 'Ð¡Ð½Ð¸Ð¶Ð°ÐµÑ‚ Ð²Ð¾ÑÐ¿Ð°Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾ÑÐ»Ðµ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸',
      science: 'EPA/DHA â€” Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²Ð¾Ð²Ð¾ÑÐ¿Ð°Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¼ÐµÐ´Ð¸Ð°Ñ‚Ð¾Ñ€Ñ‹',
      recommend: { categories: ['omega3'], keywords: ['Ð»Ð¾ÑÐ¾ÑÑŒ', 'ÑÐºÑƒÐ¼Ð±Ñ€Ð¸Ñ', 'Ð»ÑŒÐ½ÑÐ½Ð¾Ðµ Ð¼Ð°ÑÐ»Ð¾'] }
    },
    
    // === MAGNESIUM + STRESS ===
    {
      id: 'magnesium_stress',
      trigger: { dayStressHigh: true, missing: 'magnesium' },
      priority: 70,
      icon: 'ðŸ˜Œ',
      title: 'ÐœÐ°Ð³Ð½Ð¸Ð¹ Ð¿Ñ€Ð¸ ÑÑ‚Ñ€ÐµÑÑÐµ',
      reason: 'Ð¡Ð½Ð¸Ð¶Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ñ‚Ð¸Ð·Ð¾Ð», Ñ€Ð°ÑÑÐ»Ð°Ð±Ð»ÑÐµÑ‚',
      science: 'MgÂ²âº Ñ€ÐµÐ³ÑƒÐ»Ð¸Ñ€ÑƒÐµÑ‚ HPA Ð¾ÑÑŒ',
      recommend: { categories: ['magnesium'], keywords: ['Ð¼Ð¸Ð½Ð´Ð°Ð»ÑŒ', 'Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾', 'ÑˆÐ¾ÐºÐ¾Ð»Ð°Ð´ Ñ‚Ñ‘Ð¼Ð½Ñ‹Ð¹', 'Ð±Ð°Ð½Ð°Ð½'] }
    },
    
    // === VITAMIN K + FAT ===
    {
      id: 'leafy_greens_fat',
      trigger: { hasKeyword: ['ÑˆÐ¿Ð¸Ð½Ð°Ñ‚', 'ÐºÐ°Ð¿ÑƒÑÑ‚Ð°', 'Ð±Ñ€Ð¾ÐºÐºÐ¾Ð»Ð¸', 'ÑÐ°Ð»Ð°Ñ‚'], missingMacro: 'fat' },
      priority: 70,
      icon: 'ðŸ¥¬',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð¶Ð¸Ñ€Ñ‹ Ðº Ð·ÐµÐ»ÐµÐ½Ð¸',
      reason: 'Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ K â€” Ð¶Ð¸Ñ€Ð¾Ñ€Ð°ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð¼Ñ‹Ð¹',
      science: 'Ð”Ð»Ñ ÑÐ²Ñ‘Ñ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ ÐºÑ€Ð¾Ð²Ð¸ Ð¸ ÐºÐ¾ÑÑ‚ÐµÐ¹',
      recommend: { keywords: ['Ð¼Ð°ÑÐ»Ð¾', 'Ð¾Ñ€ÐµÑ…', 'Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾', 'ÑÑ‹Ñ€'] }
    },
    
    // === ALCOHOL WARNING ===
    {
      id: 'alcohol_nutrients',
      trigger: { hasKeyword: ['Ð²Ð¸Ð½Ð¾', 'Ð¿Ð¸Ð²Ð¾', 'Ð²Ð¾Ð´ÐºÐ°', 'Ð²Ð¸ÑÐºÐ¸', 'ÐºÐ¾Ð½ÑŒÑÐº', 'Ð°Ð»ÐºÐ¾Ð³Ð¾Ð»ÑŒ'] },
      priority: 90,
      icon: 'âš ï¸',
      title: 'ÐÐ»ÐºÐ¾Ð³Ð¾Ð»ÑŒ ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ B-Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½Ð¾Ð²',
      reason: 'B1, B6, B12, Ñ„Ð¾Ð»Ð°Ñ‚ â€” Ð¿Ð¾Ð´ ÑƒÐ´Ð°Ñ€Ð¾Ð¼',
      science: 'Ð­Ñ‚Ð°Ð½Ð¾Ð» Ð½Ð°Ñ€ÑƒÑˆÐ°ÐµÑ‚ Ð²ÑÐ°ÑÑ‹Ð²Ð°Ð½Ð¸Ðµ Ð¸ Ð¼ÐµÑ‚Ð°Ð±Ð¾Ð»Ð¸Ð·Ð¼',
      isWarning: true
    },
    
    // === CITRUS + MEDICATION (general awareness) ===
    {
      id: 'grapefruit_caution',
      trigger: { hasKeyword: ['Ð³Ñ€ÐµÐ¹Ð¿Ñ„Ñ€ÑƒÑ‚', 'Ð¿Ð¾Ð¼ÐµÐ»Ð¾'] },
      priority: 50,
      icon: 'ðŸ’Š',
      title: 'ÐžÑÑ‚Ð¾Ñ€Ð¾Ð¶Ð½Ð¾ Ñ Ð»ÐµÐºÐ°Ñ€ÑÑ‚Ð²Ð°Ð¼Ð¸',
      reason: 'Ð“Ñ€ÐµÐ¹Ð¿Ñ„Ñ€ÑƒÑ‚ Ð²Ð»Ð¸ÑÐµÑ‚ Ð½Ð° Ð¼ÐµÑ‚Ð°Ð±Ð¾Ð»Ð¸Ð·Ð¼ Ð¿Ñ€ÐµÐ¿Ð°Ñ€Ð°Ñ‚Ð¾Ð²',
      science: 'Ð˜Ð½Ð³Ð¸Ð±Ð¸Ñ€ÑƒÐµÑ‚ CYP3A4 Ð² ÐºÐ¸ÑˆÐµÑ‡Ð½Ð¸ÐºÐµ',
      isWarning: true,
      mild: true
    },
    
    // === PROTEIN VARIETY ===
    {
      id: 'protein_variety',
      trigger: { sameProteinSource3Days: true },
      priority: 60,
      icon: 'ðŸ”„',
      title: 'Ð Ð°Ð·Ð½Ð¾Ð¾Ð±Ñ€Ð°Ð·ÑŒ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¸ Ð±ÐµÐ»ÐºÐ°',
      reason: 'Ð Ð°Ð·Ð½Ñ‹Ðµ Ð°Ð¼Ð¸Ð½Ð¾ÐºÐ¸ÑÐ»Ð¾Ñ‚Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ð¸',
      science: 'ÐšÑƒÑ€Ð¸Ñ†Ð°, Ñ€Ñ‹Ð±Ð°, ÑÐ¹Ñ†Ð°, Ð¼Ð¾Ð»Ð¾Ñ‡ÐºÐ° â€” Ñ‡ÐµÑ€ÐµÐ´ÑƒÐ¹',
      recommend: { categories: ['protein'] }
    },
    
    // === HYDRATION WITH FIBER ===
    {
      id: 'fiber_water',
      trigger: { highFiber: true, dayWaterLow: true },
      priority: 75,
      icon: 'ðŸ’§',
      title: 'ÐŸÐµÐ¹ Ð²Ð¾Ð´Ñƒ Ñ ÐºÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÐ¾Ð¹!',
      reason: 'Ð‘ÐµÐ· Ð²Ð¾Ð´Ñ‹ ÐºÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÐ° = Ð·Ð°Ð¿Ð¾Ñ€Ñ‹',
      science: 'ÐšÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÐ° Ð²Ð¿Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð²Ð¾Ð´Ñƒ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ',
      isWarning: true
    },
    
    // === RESISTANT STARCH ===
    {
      id: 'resistant_starch',
      trigger: { hasKeyword: ['ÐºÐ°Ñ€Ñ‚Ð¾Ñ„ÐµÐ»ÑŒ', 'Ñ€Ð¸Ñ', 'Ð¼Ð°ÐºÐ°Ñ€Ð¾Ð½'], isCookedCold: true },
      priority: 60,
      icon: 'â„ï¸',
      title: 'ÐžÑ…Ð»Ð°Ð¶Ð´Ñ‘Ð½Ð½Ñ‹Ð¹ ÐºÑ€Ð°Ñ…Ð¼Ð°Ð» â€” Ñ€ÐµÐ·Ð¸ÑÑ‚ÐµÐ½Ñ‚Ð½Ñ‹Ð¹',
      reason: 'Ð“Ð˜ Ð½Ð¸Ð¶Ðµ, Ð¿Ð¸Ñ‚Ð°ÐµÑ‚ Ð¼Ð¸ÐºÑ€Ð¾Ð±Ð¸Ð¾Ñ‚Ñƒ',
      science: 'Ð ÐµÑ‚Ñ€Ð¾Ð³Ñ€Ð°Ð´Ð°Ñ†Ð¸Ñ ÐºÑ€Ð°Ñ…Ð¼Ð°Ð»Ð° Ð¿Ñ€Ð¸ Ð¾Ñ…Ð»Ð°Ð¶Ð´ÐµÐ½Ð¸Ð¸',
      isInfo: true
    },
    
    // === PROBIOTICS + PREBIOTICS ===
    {
      id: 'probiotics_prebiotics',
      trigger: { hasKeyword: ['Ð¹Ð¾Ð³ÑƒÑ€Ñ‚', 'ÐºÐµÑ„Ð¸Ñ€', 'ÐºÐ²Ð°ÑˆÐµÐ½', 'ÐºÐ¸Ð¼Ñ‡Ð¸'], missingKeyword: ['Ð»ÑƒÐº', 'Ñ‡ÐµÑÐ½Ð¾Ðº', 'Ð±Ð°Ð½Ð°Ð½', 'Ð¾Ð²Ñ‘Ñ'] },
      priority: 65,
      icon: 'ðŸ¦ ',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð¿Ñ€ÐµÐ±Ð¸Ð¾Ñ‚Ð¸ÐºÐ¸ Ðº Ð¿Ñ€Ð¾Ð±Ð¸Ð¾Ñ‚Ð¸ÐºÐ°Ð¼',
      reason: 'ÐŸÐ¸Ñ‚Ð°Ð½Ð¸Ðµ Ð´Ð»Ñ Ð¿Ð¾Ð»ÐµÐ·Ð½Ñ‹Ñ… Ð±Ð°ÐºÑ‚ÐµÑ€Ð¸Ð¹',
      science: 'Ð˜Ð½ÑƒÐ»Ð¸Ð½, FOS â€” ÑÑƒÐ±ÑÑ‚Ñ€Ð°Ñ‚ Ð´Ð»Ñ Ð¼Ð¸ÐºÑ€Ð¾Ð±Ð¸Ð¾Ñ‚Ñ‹',
      recommend: { keywords: ['Ð»ÑƒÐº', 'Ñ‡ÐµÑÐ½Ð¾Ðº', 'Ð±Ð°Ð½Ð°Ð½', 'Ð¾Ð²ÑÑÐ½ÐºÐ°'] }
    },
    
    // === COLLAGEN + VITAMIN C ===
    {
      id: 'collagen_vitc',
      trigger: { hasKeyword: ['ÐºÐ¾Ð»Ð»Ð°Ð³ÐµÐ½', 'Ð¶ÐµÐ»Ð°Ñ‚Ð¸Ð½', 'Ñ…Ð¾Ð»Ð¾Ð´ÐµÑ†', 'Ð·Ð°Ð»Ð¸Ð²Ð½Ð¾Ðµ'], missing: 'vitaminC' },
      priority: 80,
      icon: 'âœ¨',
      title: 'Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ C Ð´Ð»Ñ ÑÐ¸Ð½Ñ‚ÐµÐ·Ð° ÐºÐ¾Ð»Ð»Ð°Ð³ÐµÐ½Ð°',
      reason: 'Ð‘ÐµÐ· Ð½ÐµÐ³Ð¾ ÐºÐ¾Ð»Ð»Ð°Ð³ÐµÐ½ Ð½Ðµ ÑƒÑÐ²Ð°Ð¸Ð²Ð°ÐµÑ‚ÑÑ',
      science: 'ÐÑÐºÐ¾Ñ€Ð±Ð°Ñ‚ â€” ÐºÐ¾Ñ„Ð°ÐºÑ‚Ð¾Ñ€ Ð¿Ñ€Ð¾Ð»Ð¸Ð»-Ð³Ð¸Ð´Ñ€Ð¾ÐºÑÐ¸Ð»Ð°Ð·Ñ‹',
      recommend: { categories: ['vitaminC'], keywords: ['Ð»Ð¸Ð¼Ð¾Ð½', 'ÐºÐ¸Ð²Ð¸', 'Ð¿ÐµÑ€ÐµÑ†'] }
    },
    
    // === BETA-CAROTENE + FAT ===
    {
      id: 'beta_carotene',
      trigger: { hasKeyword: ['Ð¼Ð¾Ñ€ÐºÐ¾Ð²ÑŒ', 'Ñ‚Ñ‹ÐºÐ²Ð°', 'Ð±Ð°Ñ‚Ð°Ñ‚', 'Ð¼Ð°Ð½Ð³Ð¾', 'Ð°Ð±Ñ€Ð¸ÐºÐ¾Ñ'], missingMacro: 'fat' },
      priority: 70,
      icon: 'ðŸ¥•',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð¶Ð¸Ñ€Ñ‹ Ðº Ð¼Ð¾Ñ€ÐºÐ¾Ð²Ð¸/Ñ‚Ñ‹ÐºÐ²Ðµ',
      reason: 'Ð‘ÐµÑ‚Ð°-ÐºÐ°Ñ€Ð¾Ñ‚Ð¸Ð½ â€” Ð¶Ð¸Ñ€Ð¾Ñ€Ð°ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð¼Ñ‹Ð¹',
      science: 'ÐšÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð² Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ A',
      recommend: { keywords: ['Ð¼Ð°ÑÐ»Ð¾', 'ÑÐ¼ÐµÑ‚Ð°Ð½Ð°', 'Ð¾Ñ€ÐµÑ…'] }
    },
    
    // === QUERCETIN + FAT ===
    {
      id: 'quercetin_fat',
      trigger: { hasKeyword: ['Ð»ÑƒÐº', 'ÑÐ±Ð»Ð¾ÐºÐ¾', 'Ð±Ñ€Ð¾ÐºÐºÐ¾Ð»Ð¸', 'Ñ‡Ð°Ð¹'], missingMacro: 'fat' },
      priority: 55,
      icon: 'ðŸ§…',
      title: 'ÐšÐ²ÐµÑ€Ñ†ÐµÑ‚Ð¸Ð½ Ð»ÑƒÑ‡ÑˆÐµ Ñ Ð¶Ð¸Ñ€Ð°Ð¼Ð¸',
      reason: 'ÐÐ½Ñ‚Ð¸Ð¾ÐºÑÐ¸Ð´Ð°Ð½Ñ‚ Ð´Ð»Ñ ÑÐ¾ÑÑƒÐ´Ð¾Ð²',
      science: 'Ð‘Ð¸Ð¾Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Ã—5 Ñ Ð»Ð¸Ð¿Ð¸Ð´Ð°Ð¼Ð¸',
      recommend: { keywords: ['Ð¼Ð°ÑÐ»Ð¾', 'Ð¾Ñ€ÐµÑ…'] }
    },
    
    // === CRUCIFEROUS + IODINE ===
    {
      id: 'cruciferous_iodine',
      trigger: { hasKeyword: ['ÐºÐ°Ð¿ÑƒÑÑ‚Ð°', 'Ð±Ñ€Ð¾ÐºÐºÐ¾Ð»Ð¸', 'Ñ†Ð²ÐµÑ‚Ð½Ð°Ñ', 'Ð±Ñ€ÑŽÑÑÐµÐ»ÑŒÑÐºÐ°Ñ', 'Ñ€ÐµÐ´Ð¸Ñ', 'Ñ€ÐµÐ´ÑŒÐºÐ°'] },
      priority: 45,
      icon: 'ðŸ§‚',
      title: 'ÐšÑ€ÐµÑÑ‚Ð¾Ñ†Ð²ÐµÑ‚Ð½Ñ‹Ðµ + Ð¹Ð¾Ð´',
      reason: 'Ð“Ð¾Ð¹Ñ‚Ñ€Ð¾Ð³ÐµÐ½Ñ‹ Ð¼Ð¾Ð³ÑƒÑ‚ Ð²Ð»Ð¸ÑÑ‚ÑŒ Ð½Ð° Ñ‰Ð¸Ñ‚Ð¾Ð²Ð¸Ð´ÐºÑƒ',
      science: 'ÐŸÑ€Ð¸ Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐµ Ð³Ð¾Ð¹Ñ‚Ñ€Ð¾Ð³ÐµÐ½Ñ‹ Ñ€Ð°Ð·Ñ€ÑƒÑˆÐ°ÑŽÑ‚ÑÑ',
      isInfo: true,
      mild: true
    },
    
    // === PHYTATES IN LEGUMES ===
    {
      id: 'legumes_soaking',
      trigger: { hasKeyword: ['Ñ„Ð°ÑÐ¾Ð»ÑŒ', 'Ñ‡ÐµÑ‡ÐµÐ²Ð¸Ñ†Ð°', 'Ð½ÑƒÑ‚', 'Ð³Ð¾Ñ€Ð¾Ñ…'] },
      priority: 40,
      icon: 'ðŸ’¡',
      title: 'Ð—Ð°Ð¼Ð°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ Ñ„Ð¸Ñ‚Ð°Ñ‚Ñ‹',
      reason: 'Ð›ÑƒÑ‡ÑˆÐµ ÑƒÑÐ²Ð¾ÑÑ‚ÑÑ Ð¼Ð¸Ð½ÐµÑ€Ð°Ð»Ñ‹',
      science: '8-12Ñ‡ Ð·Ð°Ð¼Ð°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ñ â€” Ð¾Ð¿Ñ‚Ð¸Ð¼ÑƒÐ¼',
      isInfo: true,
      mild: true
    },
    
    // === SULFORAPHANE ACTIVATION ===
    {
      id: 'sulforaphane',
      trigger: { hasKeyword: ['Ð±Ñ€Ð¾ÐºÐºÐ¾Ð»Ð¸'] },
      priority: 50,
      icon: 'ðŸ¥¦',
      title: 'ÐÐ°Ñ€ÐµÐ¶ÑŒ Ð±Ñ€Ð¾ÐºÐºÐ¾Ð»Ð¸ Ð¸ Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð¸ 40Ð¼Ð¸Ð½',
      reason: 'ÐÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÑ‚ÑÑ ÑÑƒÐ»ÑŒÑ„Ð¾Ñ€Ð°Ñ„Ð°Ð½',
      science: 'ÐœÐ¸Ñ€Ð¾Ð·Ð¸Ð½Ð°Ð·Ð° ÐºÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ Ð³Ð»ÑŽÐºÐ¾Ñ€Ð°Ñ„Ð°Ð½Ð¸Ð½',
      isInfo: true
    },
    
    // === LYCOPENE COOKING ===
    {
      id: 'lycopene_cooking',
      trigger: { hasKeyword: ['Ð¿Ð¾Ð¼Ð¸Ð´Ð¾Ñ€', 'Ñ‚Ð¾Ð¼Ð°Ñ‚'], isCookedOrProcessed: false },
      priority: 45,
      icon: 'ðŸ…',
      title: 'Ð“Ð¾Ñ‚Ð¾Ð²ÑŒ Ñ‚Ð¾Ð¼Ð°Ñ‚Ñ‹ â€” Ð±Ð¾Ð»ÑŒÑˆÐµ Ð»Ð¸ÐºÐ¾Ð¿Ð¸Ð½Ð°',
      reason: 'Ð¢ÐµÑ€Ð¼Ð¾Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¿Ð¾Ð²Ñ‹ÑˆÐ°ÐµÑ‚ Ð±Ð¸Ð¾Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ',
      science: '+2.5x Ð¿Ð¾ÑÐ»Ðµ 30Ð¼Ð¸Ð½ Ð¿Ñ€Ð¸ 100Â°C',
      isInfo: true
    },
    
    // === PROTEIN TIMING (Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ) ===
    {
      id: 'protein_distribution',
      trigger: { dayProteinUneven: true },
      priority: 65,
      icon: 'â°',
      title: 'Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸ Ð±ÐµÐ»Ð¾Ðº Ñ€Ð°Ð²Ð½Ð¾Ð¼ÐµÑ€Ð½Ð¾',
      reason: '20-40Ð³ Ð·Ð° Ð¿Ñ€Ð¸Ñ‘Ð¼ â€” Ð¾Ð¿Ñ‚Ð¸Ð¼ÑƒÐ¼',
      science: 'Muscle full effect Ð¿Ñ€Ð¸ Ð¸Ð·Ð±Ñ‹Ñ‚ÐºÐµ Ð·Ð° Ñ€Ð°Ð·',
      isInfo: true
    },
    
    // === ANTI-NUTRIENTS GENERAL ===
    {
      id: 'antinutrients_cooking',
      trigger: { hasCategory: 'legumes' },
      priority: 35,
      icon: 'ðŸ”¥',
      title: 'Ð“Ð¾Ñ‚Ð¾Ð²ÐºÐ° ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ Ð°Ð½Ñ‚Ð¸Ð½ÑƒÑ‚Ñ€Ð¸ÐµÐ½Ñ‚Ñ‹',
      reason: 'Ð›ÐµÐºÑ‚Ð¸Ð½Ñ‹, Ð¾ÐºÑÐ°Ð»Ð°Ñ‚Ñ‹ Ñ€Ð°Ð·Ñ€ÑƒÑˆÐ°ÑŽÑ‚ÑÑ',
      science: 'Ð’Ð°Ñ€ÐºÐ° 15+ Ð¼Ð¸Ð½ Ð½ÐµÐ¹Ñ‚Ñ€Ð°Ð»Ð¸Ð·ÑƒÐµÑ‚ Ð»ÐµÐºÑ‚Ð¸Ð½Ñ‹',
      isInfo: true,
      mild: true
    },
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ÐÐžÐ’Ð«Ð• ÐÐÐ£Ð§ÐÐ«Ð• ÐŸÐ ÐÐ’Ð˜Ð›Ð (2025-12-10)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // === VITAMIN D + FAT (Ð¶Ð¸Ñ€Ð½Ð°Ñ ÐµÐ´Ð° = Ð²Ñ€ÐµÐ¼Ñ D3) ===
    {
      id: 'fat_meal_vitd',
      trigger: { mealFat: { min: 15 } },
      priority: 78,
      icon: 'â˜€ï¸',
      title: 'Ð’Ñ‹Ð¿ÐµÐ¹ Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ D Ñ ÑÑ‚Ð¸Ð¼ Ð¿Ñ€Ð¸Ñ‘Ð¼Ð¾Ð¼',
      reason: 'Ð–Ð¸Ñ€Ñ‹ Ð¿Ð¾Ð²Ñ‹ÑˆÐ°ÑŽÑ‚ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ D3 Ð½Ð° 32%',
      science: 'Dawson-Hughes 2015: D3 Ñ Ð¶Ð¸Ñ€Ð½Ð¾Ð¹ ÐµÐ´Ð¾Ð¹ ÑƒÑÐ²Ð°Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð½Ð° 32% Ð»ÑƒÑ‡ÑˆÐµ',
      isSupplement: true,
      supplementType: 'vitaminD'
    },
    
    // === EVENING MAGNESIUM ===
    {
      id: 'evening_magnesium',
      trigger: { time: { after: '19:00' } },
      priority: 75,
      icon: 'ðŸ’Š',
      title: 'Ð¥Ð¾Ñ€Ð¾ÑˆÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ Ð¼Ð°Ð³Ð½Ð¸Ñ',
      reason: 'Ð Ð°ÑÑÐ»Ð°Ð±Ð»ÑÐµÑ‚ Ð¼Ñ‹ÑˆÑ†Ñ‹, ÑƒÐ»ÑƒÑ‡ÑˆÐ°ÐµÑ‚ ÑÐ¾Ð½',
      science: 'MgÂ²âº Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÑ‚ Ð“ÐÐœÐš-Ñ€ÐµÑ†ÐµÐ¿Ñ‚Ð¾Ñ€Ñ‹, ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ñ‚Ð¸Ð·Ð¾Ð»',
      isSupplement: true,
      supplementType: 'magnesium'
    },
    
    // === CALCIUM vs IRON CONFLICT ===
    {
      id: 'calcium_iron_conflict',
      trigger: { has: 'calcium', has2: 'iron' },
      priority: 88,
      icon: 'âš ï¸',
      title: 'ÐšÐ°Ð»ÑŒÑ†Ð¸Ð¹ Ð¸ Ð¶ÐµÐ»ÐµÐ·Ð¾ â€” Ð½Ðµ Ð²Ð¼ÐµÑÑ‚Ðµ!',
      reason: 'ÐšÐ°Ð»ÑŒÑ†Ð¸Ð¹ ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ Ð¶ÐµÐ»ÐµÐ·Ð° Ð½Ð° 50%',
      science: 'Hallberg 1991: CaÂ²âº ÐºÐ¾Ð½ÐºÑƒÑ€Ð¸Ñ€ÑƒÐµÑ‚ Ñ FeÂ²âº Ð·Ð° DMT1 Ñ‚Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚Ñ‘Ñ€',
      isWarning: true
    },
    
    // === COFFEE vs CALCIUM ===
    {
      id: 'coffee_calcium_timing',
      trigger: { hasKeyword: ['ÐºÐ¾Ñ„Ðµ', 'ÑÑÐ¿Ñ€ÐµÑÑÐ¾'], has: 'calcium' },
      priority: 82,
      icon: 'â˜•',
      title: 'ÐšÐ¾Ñ„Ðµ + Ð¼Ð¾Ð»Ð¾Ñ‡ÐºÐ° â€” Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð¸ 2 Ñ‡Ð°ÑÐ°',
      reason: 'ÐšÐ¾Ñ„ÐµÐ¸Ð½ Ð²Ñ‹Ð¼Ñ‹Ð²Ð°ÐµÑ‚ ÐºÐ°Ð»ÑŒÑ†Ð¸Ð¹',
      science: 'Massey 1993: 6Ð¼Ð³ Ca Ñ‚ÐµÑ€ÑÐµÑ‚ÑÑ Ð½Ð° ÐºÐ°Ð¶Ð´Ñ‹Ðµ 100Ð¼Ð³ ÐºÐ¾Ñ„ÐµÐ¸Ð½Ð°',
      isWarning: true
    },
    
    // === MAGNESIUM + B6 SYNERGY ===
    {
      id: 'magnesium_b6',
      trigger: { has: 'magnesium' },
      priority: 65,
      icon: 'ðŸ”—',
      title: 'ÐœÐ°Ð³Ð½Ð¸Ð¹ Ð»ÑƒÑ‡ÑˆÐµ Ñ B6',
      reason: 'B6 Ð¿Ð¾Ð²Ñ‹ÑˆÐ°ÐµÑ‚ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ Mg Ð½Ð° 20%',
      science: 'Pouteau 2018: Ð¿Ð¸Ñ€Ð¸Ð´Ð¾ÐºÑÐ¸Ð½ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÐµÑ‚ ÐºÐ»ÐµÑ‚Ð¾Ñ‡Ð½Ñ‹Ð¹ Ð·Ð°Ñ…Ð²Ð°Ñ‚ MgÂ²âº',
      recommend: { keywords: ['ÐºÑƒÑ€Ð¸Ñ†Ð°', 'Ñ€Ñ‹Ð±Ð°', 'Ð±Ð°Ð½Ð°Ð½', 'ÐºÐ°Ñ€Ñ‚Ð¾Ñ„ÐµÐ»ÑŒ'] }
    },
    
    // === ZINC + EMPTY STOMACH ===
    {
      id: 'zinc_empty_stomach',
      trigger: { has: 'zinc', mealKcal: { max: 150 } },
      priority: 70,
      icon: 'ðŸ’¡',
      title: 'Ð¦Ð¸Ð½Ðº Ð½Ð°Ñ‚Ð¾Ñ‰Ð°Ðº Ð¼Ð¾Ð¶ÐµÑ‚ Ð²Ñ‹Ð·Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾ÑˆÐ½Ð¾Ñ‚Ñƒ',
      reason: 'Ð›ÑƒÑ‡ÑˆÐµ Ñ Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð¿Ð¾Ñ€Ñ†Ð¸ÐµÐ¹ ÐµÐ´Ñ‹',
      science: 'ZnÂ²âº Ñ€Ð°Ð·Ð´Ñ€Ð°Ð¶Ð°ÐµÑ‚ ÑÐ»Ð¸Ð·Ð¸ÑÑ‚ÑƒÑŽ Ð¶ÐµÐ»ÑƒÐ´ÐºÐ°',
      isWarning: true,
      mild: true
    },
    
    // === FISH OIL + FATTY MEAL ===
    {
      id: 'omega3_with_fat',
      trigger: { mealFat: { min: 10 }, missing: 'omega3' },
      priority: 72,
      icon: 'ðŸŸ',
      title: 'ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ ÐžÐ¼ÐµÐ³Ð°-3',
      reason: 'Ð¡ Ð¶Ð¸Ñ€Ð½Ð¾Ð¹ ÐµÐ´Ð¾Ð¹ ÑƒÑÐ²Ð°Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð² 3 Ñ€Ð°Ð·Ð° Ð»ÑƒÑ‡ÑˆÐµ',
      science: 'Lawson 1988: EPA/DHA Ð°Ð±ÑÐ¾Ñ€Ð±Ñ†Ð¸Ñ Ã—3 Ñ Ð¶Ð¸Ñ€Ð°Ð¼Ð¸',
      isSupplement: true,
      supplementType: 'omega3'
    },
    
    // === IRON + MORNING ===
    {
      id: 'iron_morning_best',
      trigger: { has: 'iron', time: { before: '11:00' } },
      priority: 60,
      icon: 'ðŸŒ…',
      title: 'Ð£Ñ‚Ñ€Ð¾ â€” Ð»ÑƒÑ‡ÑˆÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ Ð¶ÐµÐ»ÐµÐ·Ð°',
      reason: 'Ð£ÑÐ²Ð¾ÐµÐ½Ð¸Ðµ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾ Ð½Ð°Ñ‚Ð¾Ñ‰Ð°Ðº/Ñ Ð»Ñ‘Ð³ÐºÐ¾Ð¹ ÐµÐ´Ð¾Ð¹',
      science: 'Ð“ÐµÐ¿ÑÐ¸Ð´Ð¸Ð½ (Ð±Ð»Ð¾ÐºÐ°Ñ‚Ð¾Ñ€ Fe) Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÐµÐ½ ÑƒÑ‚Ñ€Ð¾Ð¼',
      isInfo: true
    },
    
    // === LATE NIGHT PROTEIN vs FAT ===
    {
      id: 'late_night_fat',
      trigger: { time: { after: '22:00' }, mealFat: { min: 20 } },
      priority: 68,
      icon: 'ðŸŒ™',
      title: 'ÐœÐ½Ð¾Ð³Ð¾ Ð¶Ð¸Ñ€Ð° Ð¿ÐµÑ€ÐµÐ´ ÑÐ½Ð¾Ð¼',
      reason: 'Ð—Ð°Ð¼ÐµÐ´Ð»Ð¸Ñ‚ Ð¿Ð¸Ñ‰ÐµÐ²Ð°Ñ€ÐµÐ½Ð¸Ðµ, ÑƒÑ…ÑƒÐ´ÑˆÐ¸Ñ‚ ÑÐ¾Ð½',
      science: 'Ð–Ð¸Ñ€Ñ‹ Ð·Ð°Ð¼ÐµÐ´Ð»ÑÑŽÑ‚ Ð¾Ð¿Ð¾Ñ€Ð¾Ð¶Ð½ÐµÐ½Ð¸Ðµ Ð¶ÐµÐ»ÑƒÐ´ÐºÐ° Ð½Ð° 2-4Ñ‡',
      isWarning: true
    },
    
    // === VITAMIN C + TIMING ===
    {
      id: 'vitc_with_meal',
      trigger: { has: 'vitaminC', mealKcal: { max: 100 } },
      priority: 55,
      icon: 'ðŸ‹',
      title: 'Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ C Ð»ÑƒÑ‡ÑˆÐµ Ñ ÐµÐ´Ð¾Ð¹',
      reason: 'Ð¡Ð½Ð¸Ð¶Ð°ÐµÑ‚ Ñ€Ð°Ð·Ð´Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð¶ÐµÐ»ÑƒÐ´ÐºÐ°',
      science: 'ÐÑÐºÐ¾Ñ€Ð±Ð¸Ð½Ð¾Ð²Ð°Ñ ÐºÐ¸ÑÐ»Ð¾Ñ‚Ð° = ÐºÐ¸ÑÐ»Ð¾Ñ‚Ð° â†’ Ð»ÑƒÑ‡ÑˆÐµ Ñ Ð±ÑƒÑ„ÐµÑ€Ð¾Ð¼',
      isInfo: true,
      mild: true
    },
    
    // === PROTEIN + CREATINE ===
    {
      id: 'protein_creatine_timing',
      trigger: { mealProtein: { min: 25 }, hasTrainingToday: true },
      priority: 65,
      icon: 'ðŸ’ª',
      title: 'Ð‘ÐµÐ»Ð¾Ðº + Ð¸Ð½ÑÑƒÐ»Ð¸Ð½ = Ð»ÑƒÑ‡ÑˆÐµ Ð´Ð»Ñ ÐºÑ€ÐµÐ°Ñ‚Ð¸Ð½Ð°',
      reason: 'Ð•ÑÐ»Ð¸ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑˆÑŒ ÐºÑ€ÐµÐ°Ñ‚Ð¸Ð½ â€” ÑÐµÐ¹Ñ‡Ð°Ñ!',
      science: 'Green 1996: Ð¸Ð½ÑÑƒÐ»Ð¸Ð½ ÑƒÑÐ¸Ð»Ð¸Ð²Ð°ÐµÑ‚ Ð·Ð°Ñ…Ð²Ð°Ñ‚ ÐºÑ€ÐµÐ°Ñ‚Ð¸Ð½Ð° Ð¼Ñ‹ÑˆÑ†Ð°Ð¼Ð¸ Ð½Ð° 60%',
      isSupplement: true,
      supplementType: 'creatine'
    },
    
    // === TRYPTOPHAN + CARBS (Ð´Ð»Ñ ÑÐ½Ð°) ===
    {
      id: 'tryptophan_carbs',
      trigger: { hasKeyword: ['Ð¸Ð½Ð´ÐµÐ¹ÐºÐ°', 'ÐºÑƒÑ€Ð¸Ñ†Ð°', 'Ð¼Ð¾Ð»Ð¾ÐºÐ¾', 'Ñ‚Ð²Ð¾Ñ€Ð¾Ð³', 'ÑÑ‹Ñ€'], time: { after: '19:00' }, mealCarbs: { min: 30 } },
      priority: 62,
      icon: 'ðŸ˜´',
      title: 'Ð¢Ñ€Ð¸Ð¿Ñ‚Ð¾Ñ„Ð°Ð½ + ÑƒÐ³Ð»ÐµÐ²Ð¾Ð´Ñ‹ = Ð¼ÐµÐ»Ð°Ñ‚Ð¾Ð½Ð¸Ð½',
      reason: 'Ð¥Ð¾Ñ€Ð¾ÑˆÐ°Ñ ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ ÑÐ½Ð°',
      science: 'Ð£Ð³Ð»ÐµÐ²Ð¾Ð´Ñ‹ â†’ Ð¸Ð½ÑÑƒÐ»Ð¸Ð½ â†’ LNAA Ð¸Ð· ÐºÑ€Ð¾Ð²Ð¸ â†’ Ñ‚Ñ€Ð¸Ð¿Ñ‚Ð¾Ñ„Ð°Ð½ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´Ð¸Ñ‚ Ð“Ð­Ð‘',
      isInfo: true
    },
    
    // === COLLAGEN + GLYCINE TIMING ===
    {
      id: 'collagen_sleep',
      trigger: { hasKeyword: ['ÐºÐ¾Ð»Ð»Ð°Ð³ÐµÐ½', 'Ð¶ÐµÐ»Ð°Ñ‚Ð¸Ð½'], time: { after: '20:00' } },
      priority: 58,
      icon: 'âœ¨',
      title: 'ÐšÐ¾Ð»Ð»Ð°Ð³ÐµÐ½ Ð²ÐµÑ‡ÐµÑ€Ð¾Ð¼ â€” Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ð¾!',
      reason: 'Ð“Ð»Ð¸Ñ†Ð¸Ð½ ÑƒÐ»ÑƒÑ‡ÑˆÐ°ÐµÑ‚ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ½Ð°',
      science: 'Bannai 2012: 3Ð³ Ð³Ð»Ð¸Ñ†Ð¸Ð½Ð° Ð¿ÐµÑ€ÐµÐ´ ÑÐ½Ð¾Ð¼ ÑƒÐ»ÑƒÑ‡ÑˆÐ°ÐµÑ‚ ÑÐ¾Ð½',
      isInfo: true
    },
    
    // === PROBIOTICS + PREBIOTICS ===
    {
      id: 'probiotic_empty',
      trigger: { hasKeyword: ['Ð¿Ñ€Ð¾Ð±Ð¸Ð¾Ñ‚Ð¸Ðº', 'Ð±Ð¸Ñ„Ð¸Ð´Ð¾', 'Ð»Ð°ÐºÑ‚Ð¾'], mealKcal: { min: 200 } },
      priority: 60,
      icon: 'ðŸ¦ ',
      title: 'ÐŸÑ€Ð¾Ð±Ð¸Ð¾Ñ‚Ð¸ÐºÐ¸ Ð»ÑƒÑ‡ÑˆÐµ Ð½Ð°Ñ‚Ð¾Ñ‰Ð°Ðº',
      reason: 'Ð˜Ð»Ð¸ Ñ‡ÐµÑ€ÐµÐ· 2Ñ‡ Ð¿Ð¾ÑÐ»Ðµ ÐµÐ´Ñ‹',
      science: 'Ð–ÐµÐ»ÑƒÐ´Ð¾Ñ‡Ð½Ñ‹Ð¹ ÑÐ¾Ðº ÑƒÐ±Ð¸Ð²Ð°ÐµÑ‚ Ð±Ð°ÐºÑ‚ÐµÑ€Ð¸Ð¸, Ð½Ð°Ñ‚Ð¾Ñ‰Ð°Ðº pH Ð²Ñ‹ÑˆÐµ',
      isInfo: true,
      mild: true
    },
    
    // === GREEN TEA + IRON BLOCK ===
    {
      id: 'green_tea_iron',
      trigger: { hasKeyword: ['Ñ‡Ð°Ð¹ Ð·ÐµÐ»Ñ‘Ð½Ñ‹Ð¹', 'Ð·ÐµÐ»Ñ‘Ð½Ñ‹Ð¹ Ñ‡Ð°Ð¹', 'Ð¼Ð°Ñ‚Ñ‡Ð°'], has: 'iron' },
      priority: 80,
      icon: 'ðŸµ',
      title: 'Ð—ÐµÐ»Ñ‘Ð½Ñ‹Ð¹ Ñ‡Ð°Ð¹ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ Ð¶ÐµÐ»ÐµÐ·Ð¾',
      reason: 'Ð¢Ð°Ð½Ð¸Ð½Ñ‹ ÑÐ²ÑÐ·Ñ‹Ð²Ð°ÑŽÑ‚ Fe â€” Ð¿ÐµÐ¹ Ñ‡ÐµÑ€ÐµÐ· 1Ñ‡',
      science: 'Hurrell 1999: Ñ‚Ð°Ð½Ð¸Ð½Ñ‹ ÑÐ½Ð¸Ð¶Ð°ÑŽÑ‚ Ð°Ð±ÑÐ¾Ñ€Ð±Ñ†Ð¸ÑŽ Fe Ð½Ð° 70%',
      isWarning: true
    },
    
    // === EGGS + CHOLINE FOR BRAIN ===
    {
      id: 'eggs_morning_brain',
      trigger: { hasKeyword: ['ÑÐ¹Ñ†Ð¾', 'ÑÐ¸Ñ‡Ð½', 'Ð¾Ð¼Ð»ÐµÑ‚'], time: { before: '12:00' } },
      priority: 55,
      icon: 'ðŸ§ ',
      title: 'Ð¥Ð¾Ð»Ð¸Ð½ Ð½Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð°Ðº â€” Ð´Ð»Ñ Ð¼Ð¾Ð·Ð³Ð°',
      reason: 'Ð¯Ð¹Ñ†Ð° = Ð»ÑƒÑ‡ÑˆÐ¸Ð¹ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº Ñ…Ð¾Ð»Ð¸Ð½Ð°',
      science: 'Ð¥Ð¾Ð»Ð¸Ð½ â†’ Ð°Ñ†ÐµÑ‚Ð¸Ð»Ñ…Ð¾Ð»Ð¸Ð½ â†’ Ð¿Ð°Ð¼ÑÑ‚ÑŒ Ð¸ Ñ„Ð¾ÐºÑƒÑ',
      isInfo: true
    },
    
    // === SPINACH + LEMON ===
    {
      id: 'spinach_lemon',
      trigger: { hasKeyword: ['ÑˆÐ¿Ð¸Ð½Ð°Ñ‚'], missingKeyword: ['Ð»Ð¸Ð¼Ð¾Ð½', 'Ð°Ð¿ÐµÐ»ÑŒÑÐ¸Ð½', 'Ð¿ÐµÑ€ÐµÑ†'] },
      priority: 75,
      icon: 'ðŸ¥¬',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð»Ð¸Ð¼Ð¾Ð½ Ðº ÑˆÐ¿Ð¸Ð½Ð°Ñ‚Ñƒ',
      reason: 'ÐžÐºÑÐ°Ð»Ð°Ñ‚Ñ‹ ÑÐ²ÑÐ·Ñ‹Ð²Ð°ÑŽÑ‚ Ð¶ÐµÐ»ÐµÐ·Ð¾ â€” Ð²Ð¸Ñ‚ C Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÑ‚',
      science: 'Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ C ÐºÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ FeÂ³âº â†’ FeÂ²âº Ð´Ð»Ñ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ñ',
      recommend: { keywords: ['Ð»Ð¸Ð¼Ð¾Ð½', 'Ð¿ÐµÑ€ÐµÑ† Ð±Ð¾Ð»Ð³Ð°Ñ€ÑÐºÐ¸Ð¹'] }
    },
    
    // === BERRIES + CREAM ===
    {
      id: 'berries_fat',
      trigger: { hasKeyword: ['ÑÐ³Ð¾Ð´', 'Ð¼Ð°Ð»Ð¸Ð½', 'Ñ‡ÐµÑ€Ð½Ð¸Ðº', 'ÐºÐ»ÑƒÐ±Ð½Ð¸Ðº', 'Ð³Ð¾Ð»ÑƒÐ±Ð¸Ðº', 'ÑÐ¼Ð¾Ñ€Ð¾Ð´Ð¸Ð½'], missingMacro: 'fat' },
      priority: 65,
      icon: 'ðŸ«',
      title: 'Ð¯Ð³Ð¾Ð´Ñ‹ Ð»ÑƒÑ‡ÑˆÐµ Ñ Ð¶Ð¸Ñ€Ð°Ð¼Ð¸',
      reason: 'ÐÐ½Ñ‚Ð¾Ñ†Ð¸Ð°Ð½Ñ‹ = Ð¶Ð¸Ñ€Ð¾Ñ€Ð°ÑÑ‚Ð²Ð¾Ñ€Ð¸Ð¼Ñ‹Ðµ',
      science: 'Lipophilic polyphenols Ð»ÑƒÑ‡ÑˆÐµ Ñ Ð»Ð¸Ð¿Ð¸Ð´Ð°Ð¼Ð¸',
      recommend: { keywords: ['ÑÐ»Ð¸Ð²ÐºÐ¸', 'ÑÐ¼ÐµÑ‚Ð°Ð½Ð°', 'Ð¹Ð¾Ð³ÑƒÑ€Ñ‚', 'Ð¾Ñ€ÐµÑ…'] }
    },
    
    // === LIVER + AVOID EXCESS ===
    {
      id: 'liver_vita_excess',
      trigger: { hasKeyword: ['Ð¿ÐµÑ‡ÐµÐ½ÑŒ', 'Ð¿ÐµÑ‡Ñ‘Ð½ÐºÐ°'] },
      priority: 70,
      icon: 'âš ï¸',
      title: 'ÐŸÐµÑ‡ÐµÐ½ÑŒ 1-2 Ñ€Ð°Ð·Ð° Ð² Ð½ÐµÐ´ÐµÐ»ÑŽ',
      reason: 'Ð˜Ð·Ð±Ñ‹Ñ‚Ð¾Ðº Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½Ð° A Ñ‚Ð¾ÐºÑÐ¸Ñ‡ÐµÐ½',
      science: 'Ð“Ð¸Ð¿ÐµÑ€Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½Ð¾Ð· A Ð¿Ñ€Ð¸ >10000 IU/Ð´ÐµÐ½ÑŒ Ð´Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾',
      isWarning: true,
      mild: true
    },
    
    // === AVOCADO + SALAD ===
    {
      id: 'avocado_salad',
      trigger: { hasKeyword: ['Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾'], hasCategory: 'vegetables' },
      priority: 68,
      icon: 'ðŸ¥‘',
      title: 'Ð˜Ð´ÐµÐ°Ð»ÑŒÐ½Ð°Ñ ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸Ñ!',
      reason: 'ÐÐ²Ð¾ÐºÐ°Ð´Ð¾ Ã—4 ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ ÐºÐ°Ñ€Ð¾Ñ‚Ð¸Ð½Ð¾Ð¸Ð´Ð¾Ð² Ð¸Ð· ÑÐ°Ð»Ð°Ñ‚Ð°',
      science: 'Unlu 2005: Ð¶Ð¸Ñ€Ñ‹ Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÑŽÑ‚ Ð°Ð±ÑÐ¾Ñ€Ð±Ñ†Ð¸ÑŽ ÐºÐ°Ñ€Ð¾Ñ‚Ð¸Ð½Ð¾Ð¸Ð´Ð¾Ð²',
      isInfo: true
    },
    
    // === BREAKFAST CORTISOL SPIKE ===
    {
      id: 'morning_cortisol',
      trigger: { time: { before: '09:00' }, mealSimpleCarbs: { min: 25 } },
      priority: 72,
      icon: 'âš¡',
      title: 'Ð£Ñ‚Ñ€Ð¾Ð¼ ÐºÐ¾Ñ€Ñ‚Ð¸Ð·Ð¾Ð» Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¹ â€” Ð¼ÐµÐ½ÑŒÑˆÐµ ÑÐ°Ñ…Ð°Ñ€Ð°',
      reason: 'ÐŸÑ€Ð¾ÑÑ‚Ñ‹Ðµ ÑƒÐ³Ð»ÐµÐ²Ð¾Ð´Ñ‹ ÑƒÑÐ¸Ð»ÑÑ‚ ÑÑ‚Ñ€ÐµÑÑ-Ð¾Ñ‚Ð²ÐµÑ‚',
      science: 'Cortisol awakening response + ÑÐ°Ñ…Ð°Ñ€ = Ð¸Ð½ÑÑƒÐ»Ð¸Ð½Ð¾Ð²Ñ‹Ðµ ÐºÐ°Ñ‡ÐµÐ»Ð¸',
      isWarning: true
    },
    
    // === NUTS + PHYTATES ===
    {
      id: 'nuts_soaking',
      trigger: { hasKeyword: ['Ð¼Ð¸Ð½Ð´Ð°Ð»ÑŒ', 'Ð³Ñ€ÐµÑ†Ðº', 'Ñ„ÑƒÐ½Ð´ÑƒÐº', 'ÐºÐµÑˆÑŒÑŽ', 'Ð¾Ñ€ÐµÑ…'] },
      priority: 40,
      icon: 'ðŸ’¡',
      title: 'Ð—Ð°Ð¼Ð°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð¾Ñ€ÐµÑ…Ð¾Ð² = Ð»ÑƒÑ‡ÑˆÐµ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ',
      reason: 'ÐÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÑ‚ Ñ„ÐµÑ€Ð¼ÐµÐ½Ñ‚Ñ‹, ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ Ñ„Ð¸Ñ‚Ð°Ñ‚Ñ‹',
      science: '8-12Ñ‡ Ð² Ð²Ð¾Ð´Ðµ â€” Ð¾Ð¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾',
      isInfo: true,
      mild: true
    }
  ];

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // BALANCE_RULES â€” ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° Ð±Ð°Ð»Ð°Ð½ÑÐ¸Ñ€Ð¾Ð²ÐºÐ¸ Ð¼Ð°ÐºÑ€Ð¾Ð½ÑƒÑ‚Ñ€Ð¸ÐµÐ½Ñ‚Ð¾Ð²
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const BALANCE_RULES = [
    {
      id: 'need_protein',
      trigger: { mealProtPct: { max: 15 }, mealKcal: { min: 300 } },
      priority: 85,
      icon: 'ðŸ¥©',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð±ÐµÐ»Ð¾Ðº',
      reason: 'Ð¢Ð¾Ð»ÑŒÐºÐ¾ ' + '{protPct}%' + ' ÐºÐ°Ð»Ð¾Ñ€Ð¸Ð¹ Ð¸Ð· Ð±ÐµÐ»ÐºÐ°',
      recommend: { categories: ['protein'], keywords: ['ÐºÑƒÑ€Ð¸Ñ†Ð°', 'Ñ€Ñ‹Ð±Ð°', 'ÑÐ¹Ñ†Ð¾', 'Ñ‚Ð²Ð¾Ñ€Ð¾Ð³'] }
    },
    {
      id: 'need_fiber',
      trigger: { mealFiber: { max: 3 }, mealKcal: { min: 300 } },
      priority: 75,
      icon: 'ðŸ¥—',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ ÐºÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÑƒ',
      reason: 'Ð’ÑÐµÐ³Ð¾ {fiber}Ð³ ÐºÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÐ¸ Ð² Ð¿Ñ€Ð¸Ñ‘Ð¼Ðµ',
      recommend: { categories: ['vegetables', 'fiber'], keywords: ['ÑÐ°Ð»Ð°Ñ‚', 'Ð¾Ð³ÑƒÑ€ÐµÑ†', 'ÐºÐ°Ð¿ÑƒÑÑ‚Ð°', 'Ð±Ñ€Ð¾ÐºÐºÐ¾Ð»Ð¸'] }
    },
    {
      id: 'need_healthy_fat',
      trigger: { mealGoodFatPct: { max: 30 }, mealFat: { min: 10 } },
      priority: 65,
      icon: 'ðŸ¥‘',
      title: 'Ð£Ð»ÑƒÑ‡ÑˆÐ¸ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¶Ð¸Ñ€Ð¾Ð²',
      reason: 'ÐœÐ°Ð»Ð¾ Ð¿Ð¾Ð»ÐµÐ·Ð½Ñ‹Ñ… Ð¶Ð¸Ñ€Ð¾Ð²',
      recommend: { keywords: ['Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾', 'Ð¾Ð»Ð¸Ð²ÐºÐ¾Ð²Ð¾Ðµ', 'Ð¾Ñ€ÐµÑ…', 'Ð»Ð¾ÑÐ¾ÑÑŒ'] }
    },
    {
      id: 'too_much_simple',
      trigger: { mealSimplePct: { min: 50 }, mealCarbs: { min: 30 } },
      priority: 80,
      icon: 'âš ï¸',
      title: 'ÐœÐ½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ñ… ÑƒÐ³Ð»ÐµÐ²Ð¾Ð´Ð¾Ð²',
      reason: '{simplePct}% ÑƒÐ³Ð»ÐµÐ²Ð¾Ð´Ð¾Ð² â€” Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ðµ',
      recommend: { categories: ['protein', 'fiber'], keywords: ['Ð¾Ñ€ÐµÑ…', 'Ð±ÐµÐ»Ð¾Ðº', 'Ð¾Ð²Ð¾Ñ‰Ð¸'] },
      isWarning: true
    }
  ];

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // TIMING_RULES â€” ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ ÑÑƒÑ‚Ð¾Ðº
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const TIMING_RULES = [
    {
      id: 'late_carbs',
      trigger: { time: { after: '21:00' }, mealCarbsPct: { min: 50 } },
      priority: 70,
      icon: 'ðŸŒ™',
      title: 'ÐŸÐ¾Ð·Ð´Ð½Ð¸Ðµ ÑƒÐ³Ð»ÐµÐ²Ð¾Ð´Ñ‹',
      reason: 'Ð’ÐµÑ‡ÐµÑ€Ð¾Ð¼ Ð»ÑƒÑ‡ÑˆÐµ Ð±ÐµÐ»Ð¾Ðº + Ð¶Ð¸Ñ€Ñ‹',
      science: 'Ð˜Ð½ÑÑƒÐ»Ð¸Ð½Ð¾Ð²Ð°Ñ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ ÑÐ½Ð¸Ð¶ÐµÐ½Ð°',
      isWarning: true
    },
    {
      id: 'morning_fat',
      trigger: { time: { before: '09:00' }, mealFatPct: { max: 15 }, mealKcal: { min: 200 } },
      priority: 60,
      icon: 'ðŸŒ…',
      title: 'Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð¶Ð¸Ñ€Ñ‹ Ð½Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð°Ðº',
      reason: 'Ð¡Ñ‹Ñ‚Ð¾ÑÑ‚ÑŒ + ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð°Ñ ÑÐ½ÐµÑ€Ð³Ð¸Ñ',
      recommend: { keywords: ['Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾', 'Ð¾Ñ€ÐµÑ…', 'Ð¼Ð°ÑÐ»Ð¾', 'ÑÑ‹Ñ€'] }
    },
    {
      id: 'afternoon_slump',
      trigger: { time: { after: '14:00', before: '16:00' }, mealGI: { min: 70 } },
      priority: 65,
      icon: 'ðŸ˜´',
      title: 'Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð“Ð˜ Ð¿Ð¾ÑÐ»Ðµ Ð¾Ð±ÐµÐ´Ð°',
      reason: 'Ð Ð¸ÑÐº ÑÐ¾Ð½Ð»Ð¸Ð²Ð¾ÑÑ‚Ð¸',
      recommend: { keywords: ['Ð¾Ñ€ÐµÑ…', 'Ð±ÐµÐ»Ð¾Ðº', 'ÑÐ°Ð»Ð°Ñ‚'] }
    }
  ];

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // HELPER FUNCTIONS â€” Ð£Ñ‚Ð¸Ð»Ð¸Ñ‚Ñ‹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Ð”ÐµÑ‚ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð½ÑƒÑ‚Ñ€Ð¸ÐµÐ½Ñ‚Ñ‹ Ð¿Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑŽ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°
   */
  function detectNutrients(productName) {
    if (!productName) return [];
    const name = productName.toLowerCase();
    const found = [];
    
    for (const [nutrientId, config] of Object.entries(NUTRIENT_KEYWORDS)) {
      for (const keyword of config.keywords) {
        if (name.includes(keyword.toLowerCase())) {
          found.push(nutrientId);
          break;
        }
      }
    }
    
    return found;
  }

  /**
   * Ð”ÐµÑ‚ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð¿Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑŽ Ð¸ Ð½ÑƒÑ‚Ñ€Ð¸ÐµÐ½Ñ‚Ð°Ð¼ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°
   */
  function detectCategories(product, existingCategories) {
    // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð¸Ð· heys_advice ÐµÑÐ»Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹
    const adviceCategories = HEYS.advice?.PRODUCT_CATEGORIES || existingCategories || {};
    
    if (!product?.name) return [];
    const name = product.name.toLowerCase();
    const found = [];
    
    for (const [catId, config] of Object.entries(adviceCategories)) {
      if (!config.keywords) continue;
      for (const keyword of config.keywords) {
        if (name.includes(keyword.toLowerCase())) {
          found.push(catId);
          break;
        }
      }
    }
    
    return found;
  }

  /**
   * ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑƒÑÐ»Ð¾Ð²Ð¸Ðµ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð°
   */
  function checkTrigger(trigger, context) {
    const { meal, mealTotals, dayData, profile, products, time } = context;
    
    // has: nutrient
    if (trigger.has) {
      const allNutrients = (context.mealNutrients || []);
      if (!allNutrients.includes(trigger.has)) return false;
    }
    
    // has2: second nutrient (Ð´Ð»Ñ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ð¾Ð²)
    if (trigger.has2) {
      const allNutrients = (context.mealNutrients || []);
      if (!allNutrients.includes(trigger.has2)) return false;
    }
    
    // missing: nutrient
    if (trigger.missing) {
      const allNutrients = (context.mealNutrients || []);
      if (allNutrients.includes(trigger.missing)) return false;
    }
    
    // hasCategory
    if (trigger.hasCategory) {
      const cats = context.mealCategories || [];
      if (!cats.includes(trigger.hasCategory)) return false;
    }
    
    // missingCategory
    if (trigger.missingCategory) {
      const cats = context.mealCategories || [];
      if (cats.includes(trigger.missingCategory)) return false;
    }
    
    // hasKeyword
    if (trigger.hasKeyword) {
      const keywords = Array.isArray(trigger.hasKeyword) ? trigger.hasKeyword : [trigger.hasKeyword];
      const mealText = (meal?.items || []).map(it => (it.name || '').toLowerCase()).join(' ');
      const hasAny = keywords.some(kw => mealText.includes(kw.toLowerCase()));
      if (!hasAny) return false;
    }
    
    // missingKeyword
    if (trigger.missingKeyword) {
      const keywords = Array.isArray(trigger.missingKeyword) ? trigger.missingKeyword : [trigger.missingKeyword];
      const mealText = (meal?.items || []).map(it => (it.name || '').toLowerCase()).join(' ');
      const hasAny = keywords.some(kw => mealText.includes(kw.toLowerCase()));
      if (hasAny) return false;
    }
    
    // hasKeyword2 â€” Ð²Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð½Ð°Ð±Ð¾Ñ€ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ñ… ÑÐ»Ð¾Ð² (Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ð¾Ð²)
    if (trigger.hasKeyword2) {
      const keywords = Array.isArray(trigger.hasKeyword2) ? trigger.hasKeyword2 : [trigger.hasKeyword2];
      const mealText = (meal?.items || []).map(it => (it.name || '').toLowerCase()).join(' ');
      const hasAny = keywords.some(kw => mealText.includes(kw.toLowerCase()));
      if (!hasAny) return false;
    }
    
    // missingMacro: 'fat' | 'protein' | 'carbs'
    if (trigger.missingMacro) {
      const t = mealTotals || {};
      if (trigger.missingMacro === 'fat' && t.fat > 5) return false;
      if (trigger.missingMacro === 'protein' && t.prot > 10) return false;
      if (trigger.missingMacro === 'carbs' && t.carbs > 10) return false;
    }
    
    // minGrams
    if (trigger.minGrams && (mealTotals?.grams || 0) < trigger.minGrams) return false;
    
    // mealProtLow
    if (trigger.mealProtLow && (mealTotals?.prot || 0) >= 15) return false;
    
    // mealCarbsLow
    if (trigger.mealCarbsLow && (mealTotals?.carbs || 0) >= 30) return false;
    
    // mealProtein: { min, max }
    if (trigger.mealProtein) {
      const prot = mealTotals?.prot || 0;
      if (trigger.mealProtein.min !== undefined && prot < trigger.mealProtein.min) return false;
      if (trigger.mealProtein.max !== undefined && prot > trigger.mealProtein.max) return false;
    }
    
    // mealKcal: { min, max }
    if (trigger.mealKcal) {
      const kcal = mealTotals?.kcal || 0;
      if (trigger.mealKcal.min !== undefined && kcal < trigger.mealKcal.min) return false;
      if (trigger.mealKcal.max !== undefined && kcal > trigger.mealKcal.max) return false;
    }
    
    // mealGI: { min, max }
    if (trigger.mealGI) {
      const gi = context.avgGI || 50;
      if (trigger.mealGI.min !== undefined && gi < trigger.mealGI.min) return false;
      if (trigger.mealGI.max !== undefined && gi > trigger.mealGI.max) return false;
    }
    
    // mealSimpleCarbs: { min }
    if (trigger.mealSimpleCarbs) {
      const simple = mealTotals?.simple || 0;
      if (trigger.mealSimpleCarbs.min !== undefined && simple < trigger.mealSimpleCarbs.min) return false;
    }
    
    // mealProtPct: { max }
    if (trigger.mealProtPct) {
      const kcal = mealTotals?.kcal || 0;
      const prot = mealTotals?.prot || 0;
      const protPct = kcal > 0 ? (prot * 4 / kcal * 100) : 0;
      if (trigger.mealProtPct.max !== undefined && protPct > trigger.mealProtPct.max) return false;
    }
    
    // mealFiber: { max }
    if (trigger.mealFiber) {
      const fiber = mealTotals?.fiber || 0;
      if (trigger.mealFiber.max !== undefined && fiber > trigger.mealFiber.max) return false;
    }
    
    // mealGoodFatPct: { max }
    if (trigger.mealGoodFatPct) {
      const fat = mealTotals?.fat || 0;
      const good = mealTotals?.good || 0;
      const goodPct = fat > 0 ? (good / fat * 100) : 0;
      if (trigger.mealGoodFatPct.max !== undefined && goodPct > trigger.mealGoodFatPct.max) return false;
    }
    
    // mealSimplePct: { min }
    if (trigger.mealSimplePct) {
      const carbs = mealTotals?.carbs || 0;
      const simple = mealTotals?.simple || 0;
      const simplePct = carbs > 0 ? (simple / carbs * 100) : 0;
      if (trigger.mealSimplePct.min !== undefined && simplePct < trigger.mealSimplePct.min) return false;
    }
    
    // mealCarbs: { min }
    if (trigger.mealCarbs) {
      const carbs = mealTotals?.carbs || 0;
      if (trigger.mealCarbs.min !== undefined && carbs < trigger.mealCarbs.min) return false;
    }
    
    // mealFat: { min }
    if (trigger.mealFat) {
      const fat = mealTotals?.fat || 0;
      if (trigger.mealFat.min !== undefined && fat < trigger.mealFat.min) return false;
    }
    
    // mealCarbsPct: { min }
    if (trigger.mealCarbsPct) {
      const kcal = mealTotals?.kcal || 0;
      const carbs = mealTotals?.carbs || 0;
      const carbsPct = kcal > 0 ? (carbs * 4 / kcal * 100) : 0;
      if (trigger.mealCarbsPct.min !== undefined && carbsPct < trigger.mealCarbsPct.min) return false;
    }
    
    // mealFatPct: { max }
    if (trigger.mealFatPct) {
      const kcal = mealTotals?.kcal || 0;
      const fat = mealTotals?.fat || 0;
      const fatPct = kcal > 0 ? (fat * 9 / kcal * 100) : 0;
      if (trigger.mealFatPct.max !== undefined && fatPct > trigger.mealFatPct.max) return false;
    }
    
    // time: { before, after }
    if (trigger.time) {
      const mealTime = time || meal?.time || '12:00';
      const [h, m] = mealTime.split(':').map(Number);
      const mealMinutes = h * 60 + m;
      
      if (trigger.time.before) {
        const [bh, bm] = trigger.time.before.split(':').map(Number);
        if (mealMinutes >= bh * 60 + bm) return false;
      }
      if (trigger.time.after) {
        const [ah, am] = trigger.time.after.split(':').map(Number);
        if (mealMinutes < ah * 60 + am) return false;
      }
    }
    
    // hasTrainingToday â€” ÐµÑÑ‚ÑŒ Ð»Ð¸ Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ/Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð½Ð°Ñ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ° ÑÐµÐ³Ð¾Ð´Ð½Ñ
    if (trigger.hasTrainingToday) {
      const trainings = dayData?.trainings || [];
      if (trainings.length === 0) return false;
    }
    
    // hadTrainingRecently â€” Ð±Ñ‹Ð»Ð° Ð»Ð¸ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð² Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 2 Ñ‡Ð°ÑÐ°
    if (trigger.hadTrainingRecently) {
      const trainings = dayData?.trainings || [];
      if (trainings.length === 0) return false;
      
      // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð²Ñ€ÐµÐ¼Ñ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸ â€” Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð² Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 2 Ñ‡Ð°ÑÐ°
      const mealTime = time || meal?.time || '12:00';
      const [mealH, mealM] = mealTime.split(':').map(Number);
      const mealMinutes = mealH * 60 + mealM;
      
      let hasRecentTraining = false;
      for (const tr of trainings) {
        if (!tr.time) continue;
        const [trH, trM] = tr.time.split(':').map(Number);
        const trMinutes = trH * 60 + trM;
        // Ð¢Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð”Ðž Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¿Ð¸Ñ‰Ð¸ Ð¸ Ð½Ðµ Ð±Ð¾Ð»ÐµÐµ 2 Ñ‡Ð°ÑÐ¾Ð² Ð½Ð°Ð·Ð°Ð´
        const diffMinutes = mealMinutes - trMinutes;
        if (diffMinutes >= 0 && diffMinutes <= 120) {
          hasRecentTraining = true;
          break;
        }
      }
      if (!hasRecentTraining) return false;
    }
    
    // hasTrainingAfterMeal â€” Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° ÐŸÐžÐ¡Ð›Ð• Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° (1-4 Ñ‡Ð°ÑÐ°)
    if (trigger.hasTrainingAfterMeal) {
      const trainings = dayData?.trainings || [];
      if (trainings.length === 0) return false;
      
      const mealTime = time || meal?.time || '12:00';
      const [mealH, mealM] = mealTime.split(':').map(Number);
      const mealMinutes = mealH * 60 + mealM;
      
      let hasUpcomingTraining = false;
      for (const tr of trainings) {
        if (!tr.time) continue;
        const [trH, trM] = tr.time.split(':').map(Number);
        const trMinutes = trH * 60 + trM;
        // Ð¢Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ ÐŸÐžÐ¡Ð›Ð• Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¿Ð¸Ñ‰Ð¸ (Ñ‡ÐµÑ€ÐµÐ· 1-4 Ñ‡Ð°ÑÐ°)
        const diffMinutes = trMinutes - mealMinutes;
        if (diffMinutes >= 60 && diffMinutes <= 240) {
          hasUpcomingTraining = true;
          break;
        }
      }
      if (!hasUpcomingTraining) return false;
    }
    
    // highFiber (Ð´Ð½ÐµÐ²Ð½Ð¾Ð¹ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒ)
    if (trigger.highFiber) {
      const dayFiber = dayData?.dayTot?.fiber || 0;
      if (dayFiber < 25) return false;
    }
    
    // dayWaterLow
    if (trigger.dayWaterLow) {
      const waterMl = dayData?.waterMl || 0;
      const waterGoal = dayData?.waterGoal || 2000;
      if (waterMl >= waterGoal * 0.5) return false;
    }
    
    // dayStressHigh
    if (trigger.dayStressHigh) {
      const stress = dayData?.stressAvg || 0;
      if (stress < 6) return false;
    }
    
    // hasOnlyCarbs
    if (trigger.hasOnlyCarbs) {
      const t = mealTotals || {};
      if (t.prot > 5 || t.fat > 5) return false;
      if (t.carbs < 20) return false;
    }
    
    return true;
  }

  /**
   * ÐÐ°Ð¹Ñ‚Ð¸ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹ Ð´Ð»Ñ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸
   */
  function findRecommendedProducts(recommend, products, currentItems, limit = 3) {
    if (!recommend || !products || products.length === 0) return [];
    
    const currentIds = new Set((currentItems || []).map(it => it.product_id || it.id));
    const candidates = [];
    
    // ÐŸÐ¾ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼ ÑÐ»Ð¾Ð²Ð°Ð¼
    if (recommend.keywords) {
      for (const product of products) {
        if (currentIds.has(product.id)) continue;
        const name = (product.name || '').toLowerCase();
        for (const keyword of recommend.keywords) {
          if (name.includes(keyword.toLowerCase())) {
            candidates.push({ product, score: 10 });
            break;
          }
        }
      }
    }
    
    // ÐŸÐ¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼ (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ PRODUCT_CATEGORIES)
    if (recommend.categories) {
      const adviceCategories = HEYS.advice?.PRODUCT_CATEGORIES || {};
      for (const product of products) {
        if (currentIds.has(product.id)) continue;
        const name = (product.name || '').toLowerCase();
        
        for (const catId of recommend.categories) {
          const cat = adviceCategories[catId] || NUTRIENT_KEYWORDS[catId];
          if (!cat?.keywords) continue;
          
          for (const keyword of cat.keywords) {
            if (name.includes(keyword.toLowerCase())) {
              candidates.push({ product, score: 5 });
              break;
            }
          }
        }
      }
    }
    
    // Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð´ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ‚Ñ‹ Ð¸ ÑÐ¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ð¾ score
    const seen = new Set();
    const unique = candidates.filter(c => {
      if (seen.has(c.product.id)) return false;
      seen.add(c.product.id);
      return true;
    });
    
    unique.sort((a, b) => b.score - a.score);
    return unique.slice(0, limit).map(c => c.product);
  }

  /**
   * ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½ÑƒÑŽ Ð¿Ð¾Ñ€Ñ†Ð¸ÑŽ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°
   */
  function getSmartPortion(product) {
    if (!product) return RECOMMENDED_PORTIONS.default;
    
    const name = (product.name || '').toLowerCase();
    
    // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ð¾ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼ ÑÐ»Ð¾Ð²Ð°Ð¼
    if (/ÑÐ¹Ñ†|Ð¾Ð¼Ð»ÐµÑ‚|ÑÐ¸Ñ‡Ð½/.test(name)) return RECOMMENDED_PORTIONS.eggs;
    if (/ÑÑ‹Ñ€|Ð¿Ð°Ñ€Ð¼ÐµÐ·Ð°Ð½|Ð¼Ð¾Ñ†Ð°Ñ€ÐµÐ»Ð»Ð°|Ð±Ñ€Ñ‹Ð½Ð·Ð°/.test(name)) return RECOMMENDED_PORTIONS.cheese;
    if (/Ð¼Ð°ÑÐ»Ð¾/.test(name)) return RECOMMENDED_PORTIONS.oil;
    if (/Ð¼Ð¾Ð»Ð¾ÐºÐ¾|ÐºÐµÑ„Ð¸Ñ€|Ð¹Ð¾Ð³ÑƒÑ€Ñ‚|Ñ€ÑÐ¶ÐµÐ½ÐºÐ°/.test(name)) return RECOMMENDED_PORTIONS.dairy;
    if (/ÐºÑƒÑ€Ð¸Ñ†Ð°|Ð³Ð¾Ð²ÑÐ´Ð¸Ð½Ð°|ÑÐ²Ð¸Ð½Ð¸Ð½Ð°|Ð¸Ð½Ð´ÐµÐ¹ÐºÐ°|Ñ€Ñ‹Ð±Ð°|Ð»Ð¾ÑÐ¾ÑÑŒ|Ñ‚ÑƒÐ½ÐµÑ†|Ð¼Ð¸Ð½Ñ‚Ð°Ð¹/.test(name)) return RECOMMENDED_PORTIONS.protein;
    if (/Ð¾Ñ€ÐµÑ…|Ð¼Ð¸Ð½Ð´Ð°Ð»ÑŒ|ÐºÐµÑˆÑŒÑŽ|Ñ„ÑƒÐ½Ð´ÑƒÐº|Ð³Ñ€ÐµÑ†Ðº/.test(name)) return RECOMMENDED_PORTIONS.nuts;
    if (/Ð³Ñ€ÐµÑ‡ÐºÐ°|Ñ€Ð¸Ñ|Ð¾Ð²ÑÑÐ½ÐºÐ°|Ð¼Ð°ÐºÐ°Ñ€Ð¾Ð½|Ð¿Ð°ÑÑ‚Ð°/.test(name)) return RECOMMENDED_PORTIONS.grains;
    if (/Ð±Ð°Ð½Ð°Ð½|ÑÐ±Ð»Ð¾ÐºÐ¾|Ð°Ð¿ÐµÐ»ÑŒÑÐ¸Ð½|Ð³Ñ€ÑƒÑˆÐ°|Ð¿ÐµÑ€ÑÐ¸Ðº/.test(name)) return RECOMMENDED_PORTIONS.fruits;
    if (/ÑÐ°Ð»Ð°Ñ‚|Ð¾Ð³ÑƒÑ€ÐµÑ†|Ð¿Ð¾Ð¼Ð¸Ð´Ð¾Ñ€|ÐºÐ°Ð¿ÑƒÑÑ‚Ð°|Ð±Ñ€Ð¾ÐºÐºÐ¾Ð»Ð¸|ÑˆÐ¿Ð¸Ð½Ð°Ñ‚/.test(name)) return RECOMMENDED_PORTIONS.vegetables;
    if (/ÑƒÐºÑ€Ð¾Ð¿|Ð¿ÐµÑ‚Ñ€ÑƒÑˆÐºÐ°|Ð±Ð°Ð·Ð¸Ð»Ð¸Ðº|ÐºÐ¸Ð½Ð·Ð°|Ð·ÐµÐ»ÐµÐ½ÑŒ/.test(name)) return RECOMMENDED_PORTIONS.greens;
    if (/ÑÐ¾ÑƒÑ|ÐºÐµÑ‚Ñ‡ÑƒÐ¿|Ð¼Ð°Ð¹Ð¾Ð½ÐµÐ·/.test(name)) return RECOMMENDED_PORTIONS.sauce;
    
    return RECOMMENDED_PORTIONS.default;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONTEXTUAL RECOMMENDATIONS â€” ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð½Ñ‹Ðµ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²ÐºÐ¸
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸ÑŽ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð½Ð¾Ð¹ â€” Ñ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸ÐµÐ¼ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð²
   */
  function makeContextualRecommendation(rule, context, recommendedProducts) {
    const { meal, mealTotals, mealNutrients } = context;
    const items = meal?.items || [];
    
    // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð² Ð² Ð¿Ñ€Ð¸Ñ‘Ð¼Ðµ (Ð¿ÐµÑ€Ð²Ñ‹Ðµ 2 Ð´Ð»Ñ ÐºÑ€Ð°Ñ‚ÐºÐ¾ÑÑ‚Ð¸)
    const productNames = items.slice(0, 2).map(it => {
      const name = it.name || '';
      // Ð¡Ð¾ÐºÑ€Ð°Ñ‰Ð°ÐµÐ¼ Ð´Ð»Ð¸Ð½Ð½Ñ‹Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ
      return name.length > 20 ? name.substring(0, 18) + '...' : name;
    });
    const mainProduct = productNames[0] || 'Ð¿Ñ€Ð¸Ñ‘Ð¼';
    const hasMultiple = items.length > 1;
    
    // ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð°
    const recProduct = recommendedProducts[0]?.name || '';
    const recShort = recProduct.length > 15 ? recProduct.substring(0, 13) + '...' : recProduct;
    
    // ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð½Ñ‹Ðµ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñ‹ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°
    const contextTemplates = {
      // SYNERGY
      'iron_vitc': {
        title: `Ðš ${mainProduct} Ð´Ð¾Ð±Ð°Ð²ÑŒ Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ C`,
        reason: `${recShort || 'Ð›Ð¸Ð¼Ð¾Ð½/Ð¿ÐµÑ€ÐµÑ†'} â€” Ð¶ÐµÐ»ÐµÐ·Ð¾ ÑƒÑÐ²Ð¾Ð¸Ñ‚ÑÑ Ð² 6 Ñ€Ð°Ð· Ð»ÑƒÑ‡ÑˆÐµ`
      },
      'calcium_vitd': {
        title: `Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ D Ðº ${mainProduct}`,
        reason: `${recShort || 'Ð¯Ð¹Ñ†Ð¾/Ñ€Ñ‹Ð±Ð°'} ÑƒÑÐ¸Ð»Ð¸Ñ‚ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ ÐºÐ°Ð»ÑŒÑ†Ð¸Ñ`
      },
      'fat_vitamins': {
        title: `ÐœÐ°ÑÐ»Ð¾ Ðº ${mainProduct}`,
        reason: `ÐšÐ°Ñ€Ð¾Ñ‚Ð¸Ð½Ñ‹ Ð¸Ð· Ð¾Ð²Ð¾Ñ‰ÐµÐ¹ ÑƒÑÐ²Ð°Ð¸Ð²Ð°ÑŽÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ Ð¶Ð¸Ñ€Ð°Ð¼Ð¸`
      },
      'plant_protein': {
        title: `Ð‘Ð¾Ð±Ð¾Ð²Ñ‹Ðµ Ðº ${mainProduct}`,
        reason: `${recShort || 'Ð¤Ð°ÑÐ¾Ð»ÑŒ/Ñ‡ÐµÑ‡ÐµÐ²Ð¸Ñ†Ð°'} â€” Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð±ÐµÐ»Ð¾Ðº Ð²Ð¼ÐµÑÑ‚Ðµ Ñ ÐºÑ€ÑƒÐ¿Ð¾Ð¹`
      },
      'turmeric_pepper': {
        title: `Ð§Ñ‘Ñ€Ð½Ñ‹Ð¹ Ð¿ÐµÑ€ÐµÑ† Ðº ÐºÑƒÑ€ÐºÑƒÐ¼Ðµ`,
        reason: `Ð£ÑÐ²Ð¾ÐµÐ½Ð¸Ðµ ÐºÑƒÑ€ÐºÑƒÐ¼Ð¸Ð½Ð° Ð²Ñ‹Ñ€Ð°ÑÑ‚ÐµÑ‚ Ð² 20 Ñ€Ð°Ð·`
      },
      'tomato_fat': {
        title: `ÐœÐ°ÑÐ»Ð¾ Ðº Ñ‚Ð¾Ð¼Ð°Ñ‚Ð°Ð¼`,
        reason: `Ð›Ð¸ÐºÐ¾Ð¿Ð¸Ð½ ÑƒÑÐ²Ð¾Ð¸Ñ‚ÑÑ Ð² 4 Ñ€Ð°Ð·Ð° Ð»ÑƒÑ‡ÑˆÐµ Ñ Ð¶Ð¸Ñ€Ð°Ð¼Ð¸`
      },
      'tea_no_milk': {
        title: `ÐœÐ¾Ð»Ð¾ÐºÐ¾ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ Ñ‡Ð°Ð¹`,
        reason: `ÐšÐ°Ð·ÐµÐ¸Ð½ ÑÐ²ÑÐ·Ñ‹Ð²Ð°ÐµÑ‚ Ð°Ð½Ñ‚Ð¸Ð¾ÐºÑÐ¸Ð´Ð°Ð½Ñ‚Ñ‹ â€” Ð¿ÐµÐ¹ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾`
      },
      'coffee_iron': {
        title: `ÐšÐ¾Ñ„Ðµ ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ Ð¶ÐµÐ»ÐµÐ·Ð°`,
        reason: `ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð¸ 1-2 Ñ‡Ð°ÑÐ° Ð¿Ð¾ÑÐ»Ðµ ${mainProduct}`
      },
      'fiber_minerals': {
        title: `ÐœÐ½Ð¾Ð³Ð¾ ÐºÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÐ¸ = Ð¼ÐµÐ½ÑŒÑˆÐµ Ñ†Ð¸Ð½ÐºÐ°`,
        reason: `Ð¤Ð¸Ñ‚Ð°Ñ‚Ñ‹ ÑÐ²ÑÐ·Ñ‹Ð²Ð°ÑŽÑ‚ Ð¼Ð¸Ð½ÐµÑ€Ð°Ð»Ñ‹`
      },
      
      // BALANCE
      'need_protein': {
        title: `ÐœÐ°Ð»Ð¾ Ð±ÐµÐ»ÐºÐ° Ð² ${mainProduct}`,
        reason: `Ð¢Ð¾Ð»ÑŒÐºÐ¾ ${Math.round((mealTotals?.prot || 0) * 4 / (mealTotals?.kcal || 1) * 100)}% ÐºÐ°Ð»Ð¾Ñ€Ð¸Ð¹ Ð¸Ð· Ð±ÐµÐ»ÐºÐ° â€” Ð´Ð¾Ð±Ð°Ð²ÑŒ ${recShort || 'ÑÐ¹Ñ†Ð¾/Ñ‚Ð²Ð¾Ñ€Ð¾Ð³'}`
      },
      'need_fiber': {
        title: `Ð”Ð¾Ð±Ð°Ð²ÑŒ ÐºÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÑƒ Ðº ${mainProduct}`,
        reason: `Ð’ÑÐµÐ³Ð¾ ${Math.round(mealTotals?.fiber || 0)}Ð³ â€” Ð½ÑƒÐ¶Ð½Ð¾ ${recShort || 'Ð¾Ð²Ð¾Ñ‰Ð¸/ÑÐ°Ð»Ð°Ñ‚'}`
      },
      'need_healthy_fat': {
        title: `Ð£Ð»ÑƒÑ‡ÑˆÐ¸ Ð¶Ð¸Ñ€Ñ‹ Ð² ${mainProduct}`,
        reason: `Ð—Ð°Ð¼ÐµÐ½Ð¸ Ð½Ð° ${recShort || 'Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾/Ð¾Ñ€ÐµÑ…Ð¸/Ð¾Ð»Ð¸Ð²ÐºÐ¾Ð²Ð¾Ðµ'}`
      },
      'too_much_simple': {
        title: `${Math.round((mealTotals?.simple || 0) / (mealTotals?.carbs || 1) * 100)}% â€” Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ðµ ÑƒÐ³Ð»ÐµÐ²Ð¾Ð´Ñ‹`,
        reason: `Ð”Ð¾Ð±Ð°Ð²ÑŒ ${recShort || 'Ð±ÐµÐ»Ð¾Ðº/ÐºÐ»ÐµÑ‚Ñ‡Ð°Ñ‚ÐºÑƒ'} â€” ÑÐ³Ð»Ð°Ð´Ð¸Ñ‚ ÑÐºÐ°Ñ‡Ð¾Ðº ÑÐ°Ñ…Ð°Ñ€Ð°`
      },
      
      // TIMING
      'protein_leucine': {
        title: `Ð•Ñ‰Ñ‘ ${30 - Math.round(mealTotals?.prot || 0)}Ð³ Ð±ÐµÐ»ÐºÐ° Ð´Ð¾ Ð¾Ð¿Ñ‚Ð¸Ð¼ÑƒÐ¼Ð°`,
        reason: `${recShort || 'Ð¯Ð¹Ñ†Ð¾/Ñ‚Ð²Ð¾Ñ€Ð¾Ð³'} â€” Ð´Ð¾ÑÑ‚Ð¸Ð³Ð½ÐµÑˆÑŒ Ð»ÐµÐ¹Ñ†Ð¸Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ñ€Ð¾Ð³Ð°`
      },
      'gi_balance': {
        title: `Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð“Ð˜ (${Math.round(context.avgGI || 0)}) Ð² ${mainProduct}`,
        reason: `${recShort || 'ÐžÐ²Ð¾Ñ‰Ð¸/ÑÐ°Ð»Ð°Ñ‚'} ÑÐ½Ð¸Ð·ÑÑ‚ ÑÐºÐ°Ñ‡Ð¾Ðº ÑÐ°Ñ…Ð°Ñ€Ð°`
      },
      'evening_protein': {
        title: `Ð”Ð¾Ð±Ð°Ð²ÑŒ ÐºÐ°Ð·ÐµÐ¸Ð½ Ð½Ð° Ð½Ð¾Ñ‡ÑŒ`,
        reason: `${recShort || 'Ð¢Ð²Ð¾Ñ€Ð¾Ð³'} â€” Ð¼ÐµÐ´Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ð±ÐµÐ»Ð¾Ðº Ð´Ð»Ñ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ`
      },
      'preworkout_carbs': {
        title: `Ð£Ð³Ð»ÐµÐ²Ð¾Ð´Ñ‹ Ð¿ÐµÑ€ÐµÐ´ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¾Ð¹`,
        reason: `${recShort || 'Ð‘Ð°Ð½Ð°Ð½/Ð¾Ð²ÑÑÐ½ÐºÐ°'} â€” Ñ‚Ð¾Ð¿Ð»Ð¸Ð²Ð¾ Ð´Ð»Ñ Ð¼Ñ‹ÑˆÑ†`
      },
      'postworkout_protein': {
        title: `Ð‘ÐµÐ»Ð¾Ðº Ð¿Ð¾ÑÐ»Ðµ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸ Ð²Ð°Ð¶ÐµÐ½`,
        reason: `${recShort || 'ÐšÑƒÑ€Ð¸Ñ†Ð°/ÑÐ¹Ñ†Ð¾'} â€” Ð¾ÐºÐ½Ð¾ Ð°Ð½Ð°Ð±Ð¾Ð»Ð¸Ð·Ð¼Ð° 2 Ñ‡Ð°ÑÐ°`
      },
      'carbs_protein_combo': {
        title: `Ðš ${mainProduct} Ð´Ð¾Ð±Ð°Ð²ÑŒ Ð±ÐµÐ»Ð¾Ðº`,
        reason: `${recShort || 'Ð¯Ð¹Ñ†Ð¾/Ñ‚Ð²Ð¾Ñ€Ð¾Ð³'} â€” Ð´Ð¾Ð»ÑŒÑˆÐµ Ð½Ð°ÑÑ‹Ñ‚Ð¸Ñ‚`
      },
      'simple_carbs_high': {
        title: `ÐœÐ½Ð¾Ð³Ð¾ ÑÐ°Ñ…Ð°Ñ€Ð° (${Math.round(mealTotals?.simple || 0)}Ð³)`,
        reason: `${recShort || 'ÐžÑ€ÐµÑ…Ð¸/Ð±ÐµÐ»Ð¾Ðº'} Ð·Ð°Ð¼ÐµÐ´Ð»ÑÑ‚ Ð²ÑÐ°ÑÑ‹Ð²Ð°Ð½Ð¸Ðµ`
      },
      'breakfast_protein': {
        title: `Ð‘ÐµÐ»Ð¾Ðº Ð½Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð°Ðº`,
        reason: `${recShort || 'Ð¯Ð¹Ñ†Ð¾/Ñ‚Ð²Ð¾Ñ€Ð¾Ð³'} â€” ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð°Ñ ÑÐ½ÐµÑ€Ð³Ð¸Ñ Ð´Ð¾ Ð¾Ð±ÐµÐ´Ð°`
      },
      'omega3_recovery': {
        title: `ÐžÐ¼ÐµÐ³Ð°-3 Ð´Ð»Ñ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ`,
        reason: `${recShort || 'Ð›Ð¾ÑÐ¾ÑÑŒ/Ð»ÑŒÐ½ÑÐ½Ð¾Ðµ'} â€” ÑÐ½Ð¸Ð·Ð¸Ñ‚ Ð²Ð¾ÑÐ¿Ð°Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾ÑÐ»Ðµ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸`
      },
      'magnesium_stress': {
        title: `ÐœÐ°Ð³Ð½Ð¸Ð¹ Ð¿Ñ€Ð¸ ÑÑ‚Ñ€ÐµÑÑÐµ`,
        reason: `${recShort || 'ÐœÐ¸Ð½Ð´Ð°Ð»ÑŒ/Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾'} â€” ÑÐ½Ð¸Ð·Ð¸Ñ‚ ÐºÐ¾Ñ€Ñ‚Ð¸Ð·Ð¾Ð»`
      },
      'late_carbs': {
        title: `ÐŸÐ¾Ð·Ð´Ð½Ð¸Ðµ ÑƒÐ³Ð»ÐµÐ²Ð¾Ð´Ñ‹ (${Math.round(mealTotals?.carbs || 0)}Ð³)`,
        reason: `Ð’ÐµÑ‡ÐµÑ€Ð¾Ð¼ Ð»ÑƒÑ‡ÑˆÐµ Ð±ÐµÐ»Ð¾Ðº + Ð¶Ð¸Ñ€Ñ‹ â€” Ð¸Ð½ÑÑƒÐ»Ð¸Ð½ ÑÐ½Ð¸Ð¶ÐµÐ½`
      },
      'morning_fat': {
        title: `Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð¶Ð¸Ñ€Ñ‹ Ð½Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð°Ðº`,
        reason: `${recShort || 'ÐÐ²Ð¾ÐºÐ°Ð´Ð¾/Ð¾Ñ€ÐµÑ…Ð¸'} â€” ÑÑ‹Ñ‚Ð¾ÑÑ‚ÑŒ Ð´Ð¾ Ð¾Ð±ÐµÐ´Ð°`
      },
      'afternoon_slump': {
        title: `Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð“Ð˜ Ð¿Ð¾ÑÐ»Ðµ Ð¾Ð±ÐµÐ´Ð°`,
        reason: `${recShort || 'ÐžÑ€ÐµÑ…Ð¸/Ð±ÐµÐ»Ð¾Ðº'} â€” Ð¸Ð·Ð±ÐµÐ¶Ð¸ÑˆÑŒ ÑÐ¾Ð½Ð»Ð¸Ð²Ð¾ÑÑ‚Ð¸`
      },
      
      // Ð ÐÐ¡ÐŸÐ Ð•Ð”Ð•Ð›Ð•ÐÐ˜Ð• Ð‘Ð•Ð›ÐšÐ
      'protein_distribution': {
        title: `Ð Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸ Ð±ÐµÐ»Ð¾Ðº Ñ€Ð°Ð²Ð½Ð¾Ð¼ÐµÑ€Ð½Ð¾`,
        reason: `${Math.round(mealTotals?.prot || 0)}Ð³ â€” Ð¼Ð½Ð¾Ð³Ð¾ Ð´Ð»Ñ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¸Ñ‘Ð¼Ð°, Ð¾Ð¿Ñ‚Ð¸Ð¼ÑƒÐ¼ 20-40Ð³`
      },
      'protein_variety': {
        title: `Ð Ð°Ð·Ð½Ð¾Ð¾Ð±Ñ€Ð°Ð·ÑŒ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¸ Ð±ÐµÐ»ÐºÐ°`,
        reason: `${recShort || 'Ð Ñ‹Ð±Ð°/ÑÐ¹Ñ†Ð°/Ð¼Ð¾Ð»Ð¾Ñ‡ÐºÐ°'} â€” Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ð°Ð¼Ð¸Ð½Ð¾ÐºÐ¸ÑÐ»Ð¾Ñ‚Ñ‹`
      },
      
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // ÐÐžÐ’Ð«Ð• ÐÐÐ£Ð§ÐÐ«Ð• ÐŸÐ ÐÐ’Ð˜Ð›Ð (2025-12-10)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      // Ð”ÐžÐ‘ÐÐ’ÐšÐ˜ Ð˜ Ð’Ð˜Ð¢ÐÐœÐ˜ÐÐ«
      'fat_meal_vitd': {
        title: `Ð’Ñ‹Ð¿ÐµÐ¹ Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ D Ñ ÑÑ‚Ð¸Ð¼ Ð¿Ñ€Ð¸Ñ‘Ð¼Ð¾Ð¼`,
        reason: `${Math.round(mealTotals?.fat || 0)}Ð³ Ð¶Ð¸Ñ€Ð¾Ð² â€” D3 ÑƒÑÐ²Ð¾Ð¸Ñ‚ÑÑ Ð½Ð° 32% Ð»ÑƒÑ‡ÑˆÐµ`
      },
      'evening_magnesium': {
        title: `Ð¥Ð¾Ñ€Ð¾ÑˆÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ Ð¼Ð°Ð³Ð½Ð¸Ñ`,
        reason: `Ð’ÐµÑ‡ÐµÑ€ â€” Mg Ñ€Ð°ÑÑÐ»Ð°Ð±Ð¸Ñ‚ Ð¼Ñ‹ÑˆÑ†Ñ‹ Ð¸ ÑƒÐ»ÑƒÑ‡ÑˆÐ¸Ñ‚ ÑÐ¾Ð½`
      },
      'omega3_with_fat': {
        title: `ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ ÐžÐ¼ÐµÐ³Ð°-3`,
        reason: `Ð¡ ${Math.round(mealTotals?.fat || 0)}Ð³ Ð¶Ð¸Ñ€Ð¾Ð² ÑƒÑÐ²Ð¾Ð¸Ñ‚ÑÑ Ð² 3Ã— Ð»ÑƒÑ‡ÑˆÐµ`
      },
      'protein_creatine_timing': {
        title: `Ð˜Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ ÐºÑ€ÐµÐ°Ñ‚Ð¸Ð½Ð°`,
        reason: `${Math.round(mealTotals?.prot || 0)}Ð³ Ð±ÐµÐ»ÐºÐ° + Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ° â€” ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ +60%`
      },
      
      // ÐšÐžÐÐ¤Ð›Ð˜ÐšÐ¢Ð«
      'calcium_iron_conflict': {
        title: `âš ï¸ ÐšÐ°Ð»ÑŒÑ†Ð¸Ð¹ + Ð¶ÐµÐ»ÐµÐ·Ð¾ â€” ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚!`,
        reason: `Ð’ ${mainProduct} Ð¾Ð±Ð° Ð¼Ð¸Ð½ÐµÑ€Ð°Ð»Ð° â€” ÐºÐ°Ð»ÑŒÑ†Ð¸Ð¹ ÑÐ½Ð¸Ð·Ð¸Ñ‚ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ Fe Ð½Ð° 50%`
      },
      'coffee_calcium_timing': {
        title: `ÐšÐ¾Ñ„Ðµ + Ð¼Ð¾Ð»Ð¾Ñ‡ÐºÐ° â€” Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð¸ 2 Ñ‡Ð°ÑÐ°`,
        reason: `ÐšÐ¾Ñ„ÐµÐ¸Ð½ Ð²Ñ‹Ð¼Ñ‹Ð²Ð°ÐµÑ‚ ÐºÐ°Ð»ÑŒÑ†Ð¸Ð¹ â€” 6Ð¼Ð³ Ca Ð½Ð° 100Ð¼Ð³ ÐºÐ¾Ñ„ÐµÐ¸Ð½Ð°`
      },
      'green_tea_iron': {
        title: `Ð—ÐµÐ»Ñ‘Ð½Ñ‹Ð¹ Ñ‡Ð°Ð¹ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ Ð¶ÐµÐ»ÐµÐ·Ð¾`,
        reason: `Ð¢Ð°Ð½Ð¸Ð½Ñ‹ ÑÐ½Ð¸Ð¶Ð°ÑŽÑ‚ Fe Ð½Ð° 70% â€” Ð¿ÐµÐ¹ Ñ‡ÐµÑ€ÐµÐ· 1Ñ‡ Ð¿Ð¾ÑÐ»Ðµ ${mainProduct}`
      },
      
      // Ð’Ð Ð•ÐœÐ¯ Ð¡Ð£Ð¢ÐžÐš
      'iron_morning_best': {
        title: `Ð£Ñ‚Ñ€Ð¾ â€” Ð»ÑƒÑ‡ÑˆÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð»Ñ Ð¶ÐµÐ»ÐµÐ·Ð°`,
        reason: `Ð“ÐµÐ¿ÑÐ¸Ð´Ð¸Ð½ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÐµÐ½ â€” Fe Ð¸Ð· ${mainProduct} ÑƒÑÐ²Ð¾Ð¸Ñ‚ÑÑ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾`
      },
      'late_night_fat': {
        title: `ÐœÐ½Ð¾Ð³Ð¾ Ð¶Ð¸Ñ€Ð¾Ð² Ð¿ÐµÑ€ÐµÐ´ ÑÐ½Ð¾Ð¼`,
        reason: `${Math.round(mealTotals?.fat || 0)}Ð³ â€” Ð·Ð°Ð¼ÐµÐ´Ð»Ð¸Ñ‚ Ð¿Ð¸Ñ‰ÐµÐ²Ð°Ñ€ÐµÐ½Ð¸Ðµ Ð½Ð° 2-4Ñ‡`
      },
      'morning_cortisol': {
        title: `Ð£Ñ‚Ñ€Ð¾Ð¼ Ð¼ÐµÐ½ÑŒÑˆÐµ ÑÐ°Ñ…Ð°Ñ€Ð°`,
        reason: `${Math.round(mealTotals?.simple || 0)}Ð³ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ñ… + ÐºÐ¾Ñ€Ñ‚Ð¸Ð·Ð¾Ð» = Ð¸Ð½ÑÑƒÐ»Ð¸Ð½Ð¾Ð²Ñ‹Ðµ ÐºÐ°Ñ‡ÐµÐ»Ð¸`
      },
      
      // Ð¡Ð˜ÐÐ•Ð Ð“Ð˜Ð˜ ÐœÐ˜ÐšÐ ÐžÐÐ£Ð¢Ð Ð˜Ð•ÐÐ¢ÐžÐ’
      'magnesium_b6': {
        title: `ÐœÐ°Ð³Ð½Ð¸Ð¹ + B6 â€” ÑÐ¸Ð½ÐµÑ€Ð³Ð¸Ñ`,
        reason: `${recShort || 'ÐšÑƒÑ€Ð¸Ñ†Ð°/Ð±Ð°Ð½Ð°Ð½'} â€” B6 ÑƒÑÐ¸Ð»Ð¸Ñ‚ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ Mg Ð½Ð° 20%`
      },
      'spinach_lemon': {
        title: `Ð”Ð¾Ð±Ð°Ð²ÑŒ Ð»Ð¸Ð¼Ð¾Ð½ Ðº ÑˆÐ¿Ð¸Ð½Ð°Ñ‚Ñƒ`,
        reason: `Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ C Ð½ÐµÐ¹Ñ‚Ñ€Ð°Ð»Ð¸Ð·ÑƒÐµÑ‚ Ð¾ÐºÑÐ°Ð»Ð°Ñ‚Ñ‹ â€” Ð¶ÐµÐ»ÐµÐ·Ð¾ ÑƒÑÐ²Ð¾Ð¸Ñ‚ÑÑ`
      },
      'berries_fat': {
        title: `Ðš ÑÐ³Ð¾Ð´Ð°Ð¼ â€” Ð¶Ð¸Ñ€Ñ‹`,
        reason: `${recShort || 'Ð¡Ð»Ð¸Ð²ÐºÐ¸/ÑÐ¼ÐµÑ‚Ð°Ð½Ð°'} â€” Ð°Ð½Ñ‚Ð¾Ñ†Ð¸Ð°Ð½Ñ‹ ÑƒÑÐ²Ð¾ÑÑ‚ÑÑ Ð»ÑƒÑ‡ÑˆÐµ`
      },
      
      // Ð¡ÐŸÐ•Ð¦Ð˜Ð¤Ð˜Ð§ÐÐ«Ð• ÐŸÐ ÐžÐ”Ð£ÐšÐ¢Ð«
      'tryptophan_carbs': {
        title: `Ð¢Ñ€Ð¸Ð¿Ñ‚Ð¾Ñ„Ð°Ð½ + ÑƒÐ³Ð»ÐµÐ²Ð¾Ð´Ñ‹ = Ð¼ÐµÐ»Ð°Ñ‚Ð¾Ð½Ð¸Ð½`,
        reason: `${mainProduct} + ${Math.round(mealTotals?.carbs || 0)}Ð³ ÑƒÐ³Ð»ÐµÐ²Ð¾Ð´Ð¾Ð² â€” Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ð¾ Ð´Ð»Ñ ÑÐ½Ð°`
      },
      'collagen_sleep': {
        title: `ÐšÐ¾Ð»Ð»Ð°Ð³ÐµÐ½ Ð²ÐµÑ‡ÐµÑ€Ð¾Ð¼ â€” Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ð¾!`,
        reason: `Ð“Ð»Ð¸Ñ†Ð¸Ð½ Ð² ÐºÐ¾Ð»Ð»Ð°Ð³ÐµÐ½Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐ°ÐµÑ‚ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ½Ð°`
      },
      'eggs_morning_brain': {
        title: `Ð¥Ð¾Ð»Ð¸Ð½ Ð½Ð° Ð·Ð°Ð²Ñ‚Ñ€Ð°Ðº â€” Ð´Ð»Ñ Ð¼Ð¾Ð·Ð³Ð°`,
        reason: `Ð¯Ð¹Ñ†Ð° â†’ Ð°Ñ†ÐµÑ‚Ð¸Ð»Ñ…Ð¾Ð»Ð¸Ð½ â†’ Ð¿Ð°Ð¼ÑÑ‚ÑŒ Ð¸ Ñ„Ð¾ÐºÑƒÑ Ð²ÐµÑÑŒ Ð´ÐµÐ½ÑŒ`
      },
      'avocado_salad': {
        title: `Ð˜Ð´ÐµÐ°Ð»ÑŒÐ½Ð°Ñ ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸Ñ!`,
        reason: `Ð–Ð¸Ñ€Ñ‹ Ð°Ð²Ð¾ÐºÐ°Ð´Ð¾ Ã—4 ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ ÐºÐ°Ñ€Ð¾Ñ‚Ð¸Ð½Ð¾Ð¸Ð´Ð¾Ð² Ð¸Ð· Ð¾Ð²Ð¾Ñ‰ÐµÐ¹`
      },
      
      // ÐŸÐ Ð•Ð”Ð£ÐŸÐ Ð•Ð–Ð”Ð•ÐÐ˜Ð¯
      'zinc_empty_stomach': {
        title: `Ð¦Ð¸Ð½Ðº Ñ ÐµÐ´Ð¾Ð¹, Ð½Ðµ Ð½Ð°Ñ‚Ð¾Ñ‰Ð°Ðº`,
        reason: `${Math.round(mealTotals?.kcal || 0)} ÐºÐºÐ°Ð» â€” Ð¼Ð°Ð»Ð¾Ð²Ð°Ñ‚Ð¾, Zn Ð¼Ð¾Ð¶ÐµÑ‚ Ð²Ñ‹Ð·Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¾ÑˆÐ½Ð¾Ñ‚Ñƒ`
      },
      'liver_vita_excess': {
        title: `ÐŸÐµÑ‡ÐµÐ½ÑŒ 1-2 Ñ€Ð°Ð·Ð° Ð² Ð½ÐµÐ´ÐµÐ»ÑŽ`,
        reason: `Ð˜Ð·Ð±Ñ‹Ñ‚Ð¾Ðº Ð²Ð¸Ñ‚Ð°Ð¼Ð¸Ð½Ð° A Ñ‚Ð¾ÐºÑÐ¸Ñ‡ÐµÐ½ Ð¿Ñ€Ð¸ Ð¿Ð¾ÑÑ‚Ð¾ÑÐ½Ð½Ð¾Ð¼ ÑƒÐ¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÐµÐ½Ð¸Ð¸`
      },
      
      // INFO
      'nuts_soaking': {
        title: `Ð—Ð°Ð¼Ð°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð¾Ñ€ÐµÑ…Ð¾Ð² ÑƒÐ»ÑƒÑ‡ÑˆÐ°ÐµÑ‚ ÑƒÑÐ²Ð¾ÐµÐ½Ð¸Ðµ`,
        reason: `8-12Ñ‡ Ð² Ð²Ð¾Ð´Ðµ â€” Ñ„Ð¸Ñ‚Ð°Ñ‚Ñ‹ ÑÐ½Ð¸Ð¶Ð°ÑŽÑ‚ÑÑ, Ð¼Ð¸Ð½ÐµÑ€Ð°Ð»Ñ‹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½ÐµÐµ`
      },
      'probiotic_empty': {
        title: `ÐŸÑ€Ð¾Ð±Ð¸Ð¾Ñ‚Ð¸ÐºÐ¸ Ð»ÑƒÑ‡ÑˆÐµ Ð½Ð°Ñ‚Ð¾Ñ‰Ð°Ðº`,
        reason: `Ð˜Ð»Ð¸ Ñ‡ÐµÑ€ÐµÐ· 2Ñ‡ Ð¿Ð¾ÑÐ»Ðµ ÐµÐ´Ñ‹ â€” Ð¶ÐµÐ»ÑƒÐ´Ð¾Ñ‡Ð½Ñ‹Ð¹ ÑÐ¾Ðº ÑƒÐ±Ð¸Ð²Ð°ÐµÑ‚ Ð±Ð°ÐºÑ‚ÐµÑ€Ð¸Ð¸`
      },
      'vitc_with_meal': {
        title: `Ð’Ð¸Ñ‚Ð°Ð¼Ð¸Ð½ C Ð»ÑƒÑ‡ÑˆÐµ Ñ ÐµÐ´Ð¾Ð¹`,
        reason: `ÐÑÐºÐ¾Ñ€Ð±Ð¸Ð½Ð¾Ð²Ð°Ñ ÐºÐ¸ÑÐ»Ð¾Ñ‚Ð° â€” ÑÐ½Ð¸Ð·Ð¸Ñ‚ÑÑ Ñ€Ð°Ð·Ð´Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð¶ÐµÐ»ÑƒÐ´ÐºÐ°`
      }
    };
    
    // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð½Ñ‹Ð¹ ÑˆÐ°Ð±Ð»Ð¾Ð½ Ð¸Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð»
    const template = contextTemplates[rule.id];
    
    if (template) {
      return {
        title: template.title,
        reason: template.reason
      };
    }
    
    // Fallback â€” Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ñ‚ÐµÐºÑÑ‚Ñ‹ Ñ Ð¿Ð¾Ð´ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¾Ð¹ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
    let title = rule.title || '';
    let reason = rule.reason || '';
    
    // ÐŸÐ¾Ð´ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…
    reason = reason.replace('{protPct}', Math.round((mealTotals?.prot || 0) * 4 / (mealTotals?.kcal || 1) * 100));
    reason = reason.replace('{fiber}', Math.round(mealTotals?.fiber || 0));
    reason = reason.replace('{simplePct}', Math.round((mealTotals?.simple || 0) / (mealTotals?.carbs || 1) * 100));
    
    return { title, reason };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // MAIN API â€” getMealOptimization
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ñ‘Ð¼Ð° Ð¿Ð¸Ñ‰Ð¸
   * @param {Object} params
   * @param {Object} params.meal - ÐŸÑ€Ð¸Ñ‘Ð¼ Ð¿Ð¸Ñ‰Ð¸ { items: [...], time: 'HH:MM' }
   * @param {Object} params.mealTotals - Ð¡ÑƒÐ¼Ð¼Ñ‹ Ð½ÑƒÑ‚Ñ€Ð¸ÐµÐ½Ñ‚Ð¾Ð² { kcal, prot, carbs, ... }
   * @param {Object} params.dayData - Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð½Ñ { dayTot, trainings, waterMl, ... }
   * @param {Object} params.profile - ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ { age, gender, ... }
   * @param {Array} params.products - ÐœÐ°ÑÑÐ¸Ð² Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð² Ð¸Ð· Ð±Ð°Ð·Ñ‹
   * @param {Object} params.pIndex - Ð˜Ð½Ð´ÐµÐºÑ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð²
   * @returns {Array} ÐœÐ°ÑÑÐ¸Ð² Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¹
   */
  function getMealOptimization(params) {
    const { meal, mealTotals, dayData, profile, products, pIndex, avgGI } = params;
    
    if (!meal?.items || meal.items.length === 0) return [];
    
    // Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð½ÑƒÑ‚Ñ€Ð¸ÐµÐ½Ñ‚Ñ‹ Ð¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð¸Ð· Ð²ÑÐµÑ… Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð² Ð² Ð¿Ñ€Ð¸Ñ‘Ð¼Ðµ
    const mealNutrients = new Set();
    const mealCategories = new Set();
    
    for (const item of meal.items) {
      const name = item.name || '';
      
      // ÐÑƒÑ‚Ñ€Ð¸ÐµÐ½Ñ‚Ñ‹
      const nutrients = detectNutrients(name);
      nutrients.forEach(n => mealNutrients.add(n));
      
      // ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸
      const cats = detectCategories({ name });
      cats.forEach(c => mealCategories.add(c));
    }
    
    const context = {
      meal,
      mealTotals: mealTotals || {},
      mealNutrients: Array.from(mealNutrients),
      mealCategories: Array.from(mealCategories),
      dayData: dayData || {},
      profile: profile || {},
      products: products || [],
      pIndex,
      avgGI: avgGI || 50,
      time: meal.time
    };
    
    const recommendations = [];
    
    // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð²ÑÐµ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°
    const allRules = [...SYNERGY_RULES, ...BALANCE_RULES, ...TIMING_RULES];
    
    for (const rule of allRules) {
      if (checkTrigger(rule.trigger, context)) {
        // Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð½Ð°Ñ…Ð¾Ð´Ð¸Ð¼ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹ Ð´Ð»Ñ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸
        let recProducts = [];
        if (rule.recommend && products && products.length > 0) {
          recProducts = findRecommendedProducts(
            rule.recommend, 
            products, 
            meal.items, 
            3
          );
          
          // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ smart portion Ðº ÐºÐ°Ð¶Ð´Ð¾Ð¼Ñƒ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ñƒ
          recProducts = recProducts.map(p => ({
            ...p,
            smartPortion: getSmartPortion(p)
          }));
        }
        
        // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð½Ñ‹Ðµ Ñ‚ÐµÐºÑÑ‚Ñ‹
        const contextual = makeContextualRecommendation(rule, context, recProducts);
        
        const rec = {
          id: rule.id,
          priority: rule.priority || 50,
          icon: rule.icon,
          title: contextual.title,
          reason: contextual.reason,
          science: rule.science,
          isWarning: rule.isWarning || false,
          isInfo: rule.isInfo || false,
          mild: rule.mild || false,
          products: recProducts
        };
        
        recommendations.push(rec);
      }
    }
    
    // Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ð¾ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚Ñƒ (Ð²Ñ‹ÑˆÐµ = Ð²Ð°Ð¶Ð½ÐµÐµ)
    recommendations.sort((a, b) => b.priority - a.priority);
    
    // ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð²Ð°ÐµÐ¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ (max 5 Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¹)
    return recommendations.slice(0, 5);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // USER ACTIONS TRACKING â€” ÐŸÐµÑ€ÑÐ¾Ð½Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const ACTIONS_KEY = 'heys_meal_optimizer_actions';
  const MAX_ACTIONS = 1000; // Ð›Ð¸Ð¼Ð¸Ñ‚ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹
  const MAX_AGE_DAYS = 30; // Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð·Ð°Ð¿Ð¸ÑÐ¸ ÑÑ‚Ð°Ñ€ÑˆÐµ 30 Ð´Ð½ÐµÐ¹
  
  /**
   * Ð—Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
   */
  function trackUserAction(action) {
    try {
      let actions = U.lsGet ? U.lsGet(ACTIONS_KEY, []) : JSON.parse(localStorage.getItem(ACTIONS_KEY) || '[]');
      
      // ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÑÑ‚Ð°Ñ€Ñ‹Ñ… Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ (ÑÑ‚Ð°Ñ€ÑˆÐµ 30 Ð´Ð½ÐµÐ¹)
      const cutoff = Date.now() - (MAX_AGE_DAYS * 24 * 60 * 60 * 1000);
      actions = actions.filter(a => (a.timestamp || 0) > cutoff);
      
      actions.push({
        ...action,
        timestamp: Date.now()
      });
      
      // Ð¥Ñ€Ð°Ð½Ð¸Ð¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ MAX_ACTIONS Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹
      const trimmed = actions.slice(-MAX_ACTIONS);
      
      if (U.lsSet) {
        U.lsSet(ACTIONS_KEY, trimmed);
      } else {
        localStorage.setItem(ACTIONS_KEY, JSON.stringify(trimmed));
      }
    } catch (e) {
      console.warn('[MealOptimizer] Failed to track action:', e);
    }
  }

  /**
   * ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð´Ð»Ñ Ð¿ÐµÑ€ÑÐ¾Ð½Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸
   */
  function getActionStats() {
    try {
      const actions = U.lsGet ? U.lsGet(ACTIONS_KEY, []) : JSON.parse(localStorage.getItem(ACTIONS_KEY) || '[]');
      
      const stats = {
        acceptedRules: {},
        dismissedRules: {},
        addedProducts: {},
        totalAccepted: 0,
        totalDismissed: 0
      };
      
      for (const action of actions) {
        if (action.type === 'accept') {
          stats.acceptedRules[action.ruleId] = (stats.acceptedRules[action.ruleId] || 0) + 1;
          stats.totalAccepted++;
          if (action.productId) {
            stats.addedProducts[action.productId] = (stats.addedProducts[action.productId] || 0) + 1;
          }
        } else if (action.type === 'dismiss') {
          stats.dismissedRules[action.ruleId] = (stats.dismissedRules[action.ruleId] || 0) + 1;
          stats.totalDismissed++;
        }
      }
      
      return stats;
    } catch (e) {
      return { acceptedRules: {}, dismissedRules: {}, addedProducts: {}, totalAccepted: 0, totalDismissed: 0 };
    }
  }

  /**
   * ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ð½ÑƒÐ¶Ð½Ð¾ Ð»Ð¸ ÑÐºÑ€Ñ‹Ñ‚ÑŒ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸ÑŽ (ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ñ‡Ð°ÑÑ‚Ð¾ Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÑÐµÑ‚ÑÑ)
   */
  function shouldHideRecommendation(ruleId) {
    const stats = getActionStats();
    const dismissed = stats.dismissedRules[ruleId] || 0;
    const accepted = stats.acceptedRules[ruleId] || 0;
    
    // Ð•ÑÐ»Ð¸ Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÐµÐ½Ð¾ 5+ Ñ€Ð°Ð· Ð¸ Ð¿Ñ€Ð¸Ð½ÑÑ‚Ð¾ Ð¼ÐµÐ½ÑŒÑˆÐµ 20% â€” ÑÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼
    if (dismissed >= 5 && accepted / (dismissed + accepted) < 0.2) {
      return true;
    }
    
    return false;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EXPORT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  HEYS.MealOptimizer = {
    // Main API
    getMealOptimization,
    
    // Helpers
    detectNutrients,
    detectCategories,
    getSmartPortion,
    findRecommendedProducts,
    
    // Tracking
    trackUserAction,
    getActionStats,
    shouldHideRecommendation,
    
    // Constants (for debugging/extension)
    NUTRIENT_KEYWORDS,
    RECOMMENDED_PORTIONS,
    SYNERGY_RULES,
    BALANCE_RULES,
    TIMING_RULES,
    
    // Version
    VERSION: '1.0.0'
  };

  console.log('[MealOptimizer] âœ… Module loaded v1.0.0 |', 
    SYNERGY_RULES.length, 'synergy rules,',
    BALANCE_RULES.length, 'balance rules,',
    TIMING_RULES.length, 'timing rules');

})(typeof window !== 'undefined' ? window : global);
