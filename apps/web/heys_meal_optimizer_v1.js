// heys_meal_optimizer_v1.js ‚Äî –£–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
// v1.0.0 | 2025-12-10
// –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å 50+ –Ω–∞—É—á–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏

(function (global) {
  'use strict';
  const HEYS = global.HEYS = global.HEYS || {};
  const U = HEYS.utils || {};

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // NUTRIENT_KEYWORDS ‚Äî –î–µ—Ç–µ–∫—Ü–∏—è –º–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–æ–¥—É–∫—Ç–∞
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  const NUTRIENT_KEYWORDS = {
    iron: {
      keywords: ['–ø–µ—á–µ–Ω—å', '–ø–µ—á—ë–Ω–∫–∞', '–≥–æ–≤—è–¥–∏–Ω–∞', '—Ç–µ–ª—è—Ç–∏–Ω–∞', '–≥—Ä–µ—á–∫–∞', '—á–µ—á–µ–≤–∏—Ü–∞', '—à–ø–∏–Ω–∞—Ç', '—Ñ–∞—Å–æ–ª—å', '–≥–æ—Ä–æ—Ö', '—Ç–æ—Ñ—É', '–∫—É–Ω–∂—É—Ç', '–∫–∞–∫–∞–æ', '–∫—Ä–æ–≤—è–Ω–∫–∞'],
      icon: 'ü©∏',
      name: '–ñ–µ–ª–µ–∑–æ'
    },
    vitaminC: {
      keywords: ['–ª–∏–º–æ–Ω', '–∞–ø–µ–ª—å—Å–∏–Ω', '–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç', '–∫–∏–≤–∏', '–ø–µ—Ä–µ—Ü –±–æ–ª–≥–∞—Ä—Å–∫–∏–π', '–ø–µ—Ä–µ—Ü —Å–ª–∞–¥–∫–∏–π', '—à–∏–ø–æ–≤–Ω–∏–∫', '—Å–º–æ—Ä–æ–¥–∏–Ω–∞', '–∫–ª—É–±–Ω–∏–∫–∞', '–±—Ä–æ–∫–∫–æ–ª–∏', '–∫–∞–ø—É—Å—Ç–∞', '–ø–µ—Ç—Ä—É—à–∫–∞', '—É–∫—Ä–æ–ø'],
      icon: 'üçã',
      name: '–í–∏—Ç–∞–º–∏–Ω C'
    },
    omega3: {
      keywords: ['–ª–æ—Å–æ—Å—å', '—Å—ë–º–≥–∞', '—Å–∫—É–º–±—Ä–∏—è', '—Å–µ–ª—å–¥—å', '—Ñ–æ—Ä–µ–ª—å', '—Å–∞—Ä–¥–∏–Ω–∞', '–∞–Ω—á–æ—É—Å', '—Ç—É–Ω–µ—Ü', '–ª—å–Ω—è–Ω–æ–µ', '—á–∏–∞', '–≥—Ä–µ—Ü–∫', '—Ä—ã–±–∏–π –∂–∏—Ä'],
      icon: 'üêü',
      name: '–û–º–µ–≥–∞-3'
    },
    calcium: {
      keywords: ['–º–æ–ª–æ–∫–æ', '—Ç–≤–æ—Ä–æ–≥', '—Å—ã—Ä', '–π–æ–≥—É—Ä—Ç', '–∫–µ—Ñ–∏—Ä', '–±—Ä—ã–Ω–∑–∞', '–ø–∞—Ä–º–µ–∑–∞–Ω', '—Å–º–µ—Ç–∞–Ω–∞', '—Å–ª–∏–≤–∫–∏', '–∫—É–Ω–∂—É—Ç', '–º–∏–Ω–¥–∞–ª—å', '—Å–∞—Ä–¥–∏–Ω–∞'],
      icon: 'ü¶¥',
      name: '–ö–∞–ª—å—Ü–∏–π'
    },
    vitaminD: {
      keywords: ['–ª–æ—Å–æ—Å—å', '—Å—ë–º–≥–∞', '—Å–∫—É–º–±—Ä–∏—è', '—Å–µ–ª—å–¥—å', '—è–π—Ü–æ', '—è–∏—á–Ω—ã–π –∂–µ–ª—Ç–æ–∫', '–ø–µ—á–µ–Ω—å —Ç—Ä–µ—Å–∫–∏', '—Ä—ã–±–∏–π –∂–∏—Ä', '–≥—Ä–∏–±—ã'],
      icon: '‚òÄÔ∏è',
      name: '–í–∏—Ç–∞–º–∏–Ω D'
    },
    magnesium: {
      keywords: ['–º–∏–Ω–¥–∞–ª—å', '–∫–µ—à—å—é', '–∞—Ä–∞—Ö–∏—Å', '—à–ø–∏–Ω–∞—Ç', '–∞–≤–æ–∫–∞–¥–æ', '–±–∞–Ω–∞–Ω', '–≥—Ä–µ—á–∫–∞', '–æ–≤—Å—è–Ω–∫–∞', '—Ç—ë–º–Ω—ã–π —à–æ–∫–æ–ª–∞–¥', '–∫–∞–∫–∞–æ', '—Ç—ã–∫–≤–µ–Ω–Ω', '—Å–µ–º–µ—á–∫'],
      icon: 'üí™',
      name: '–ú–∞–≥–Ω–∏–π'
    },
    zinc: {
      keywords: ['–≥–æ–≤—è–¥–∏–Ω–∞', '–±–∞—Ä–∞–Ω–∏–Ω–∞', '—Å–≤–∏–Ω–∏–Ω–∞', '—É—Å—Ç—Ä–∏—Ü', '–∫—Ä–∞–±', '–∫—É—Ä–∏—Ü–∞', '–∏–Ω–¥–µ–π–∫–∞', '—Ç—ã–∫–≤–µ–Ω–Ω', '–∫—É–Ω–∂—É—Ç', '—á–µ—á–µ–≤–∏—Ü–∞', '–Ω—É—Ç'],
      icon: 'üõ°Ô∏è',
      name: '–¶–∏–Ω–∫'
    },
    potassium: {
      keywords: ['–±–∞–Ω–∞–Ω', '–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å', '–±–∞—Ç–∞—Ç', '–∞–≤–æ–∫–∞–¥–æ', '—à–ø–∏–Ω–∞—Ç', '—Ñ–∞—Å–æ–ª—å', '—á–µ—á–µ–≤–∏—Ü–∞', '–∫—É—Ä–∞–≥–∞', '–∏–∑—é–º', '–∞–ø–µ–ª—å—Å–∏–Ω'],
      icon: '‚ö°',
      name: '–ö–∞–ª–∏–π'
    },
    fiber: {
      keywords: ['–æ—Ç—Ä—É–±–∏', '—á–µ—á–µ–≤–∏—Ü–∞', '—Ñ–∞—Å–æ–ª—å', '–≥–æ—Ä–æ—Ö', '–Ω—É—Ç', '–æ–≤—Å—è–Ω–∫–∞', '–±—Ä–æ–∫–∫–æ–ª–∏', '–º–∞–ª–∏–Ω–∞', '–≥—Ä—É—à–∞', '—è–±–ª–æ–∫–æ', '–∞–≤–æ–∫–∞–¥–æ', '–∞—Ä—Ç–∏—à–æ–∫'],
      icon: 'üåæ',
      name: '–ö–ª–µ—Ç—á–∞—Ç–∫–∞'
    },
    vitaminB12: {
      keywords: ['–ø–µ—á–µ–Ω—å', '–≥–æ–≤—è–¥–∏–Ω–∞', '–±–∞—Ä–∞–Ω–∏–Ω–∞', '–ª–æ—Å–æ—Å—å', '—Ñ–æ—Ä–µ–ª—å', '—Ç—É–Ω–µ—Ü', '—Å–∞—Ä–¥–∏–Ω–∞', '—è–π—Ü–æ', '–º–æ–ª–æ–∫–æ', '—Å—ã—Ä'],
      icon: 'üî¥',
      name: '–í–∏—Ç–∞–º–∏–Ω B12'
    },
    vitaminA: {
      keywords: ['–ø–µ—á–µ–Ω—å', '–º–æ—Ä–∫–æ–≤—å', '–±–∞—Ç–∞—Ç', '—Ç—ã–∫–≤–∞', '—à–ø–∏–Ω–∞—Ç', '–∫–∞–ø—É—Å—Ç–∞', '–º–∞–Ω–≥–æ', '–∞–±—Ä–∏–∫–æ—Å', '–¥—ã–Ω—è', '—è–π—Ü–æ'],
      icon: 'ü•ï',
      name: '–í–∏—Ç–∞–º–∏–Ω A'
    },
    folate: {
      keywords: ['—à–ø–∏–Ω–∞—Ç', '—Å–ø–∞—Ä–∂–∞', '–±—Ä–æ–∫–∫–æ–ª–∏', '–∞–≤–æ–∫–∞–¥–æ', '—á–µ—á–µ–≤–∏—Ü–∞', '—Ñ–∞—Å–æ–ª—å', '–Ω—É—Ç', '—Å–≤—ë–∫–ª–∞', '–∞–ø–µ–ª—å—Å–∏–Ω', '–ø–µ—á–µ–Ω—å'],
      icon: 'üåø',
      name: '–§–æ–ª–∞—Ç'
    }
  };

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // RECOMMENDED_PORTIONS ‚Äî –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ä—Ü–∏–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  const RECOMMENDED_PORTIONS = {
    // –ë–µ–ª–∫–æ–≤—ã–µ ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –ø–æ—Ä—Ü–∏—è
    protein: { grams: 150, label: '150–≥ ‚Äî –ø–æ—Ä—Ü–∏—è' },
    // –ú–æ–ª–æ—á–Ω—ã–µ ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–æ—Ä—Ü–∏—è
    dairy: { grams: 200, label: '200–≥ ‚Äî —Å—Ç–∞–∫–∞–Ω' },
    // –û–≤–æ—â–∏ ‚Äî —â–µ–¥—Ä–∞—è –ø–æ—Ä—Ü–∏—è
    vegetables: { grams: 150, label: '150–≥ ‚Äî –≥–∞—Ä–Ω–∏—Ä' },
    // –§—Ä—É–∫—Ç—ã ‚Äî 1 —Å—Ä–µ–¥–Ω–∏–π
    fruits: { grams: 150, label: '150–≥ ‚Äî 1 —à—Ç' },
    // –ó–µ—Ä–Ω–æ–≤—ã–µ ‚Äî –ø–æ—Ä—Ü–∏—è –≥–∞—Ä–Ω–∏—Ä–∞
    grains: { grams: 100, label: '100–≥ ‚Äî –ø–æ—Ä—Ü–∏—è' },
    // –û—Ä–µ—Ö–∏ ‚Äî –≥–æ—Ä—Å—Ç—å
    nuts: { grams: 30, label: '30–≥ ‚Äî –≥–æ—Ä—Å—Ç—å' },
    // –ú–∞—Å–ª–æ ‚Äî —Å—Ç–æ–ª–æ–≤–∞—è –ª–æ–∂–∫–∞
    oil: { grams: 15, label: '15–≥ ‚Äî 1 —Å—Ç.–ª.' },
    // –ó–µ–ª–µ–Ω—å ‚Äî –ø—É—á–æ–∫
    greens: { grams: 30, label: '30–≥ ‚Äî –ø—É—á–æ–∫' },
    // –Ø–π—Ü–∞ ‚Äî 2 —à—Ç—É–∫–∏
    eggs: { grams: 120, label: '2 —è–π—Ü–∞' },
    // –°—ã—Ä ‚Äî –ª–æ–º—Ç–∏–∫
    cheese: { grams: 30, label: '30–≥ ‚Äî –ª–æ–º—Ç–∏–∫' },
    // –°–æ—É—Å ‚Äî –ø–æ—Ä—Ü–∏—è
    sauce: { grams: 30, label: '30–≥ ‚Äî –ø–æ—Ä—Ü–∏—è' },
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
    default: { grams: 100, label: '100–≥' }
  };

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // SYNERGY_RULES ‚Äî 50+ –Ω–∞—É—á–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª —Å–∏–Ω–µ—Ä–≥–∏–π
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  const SYNERGY_RULES = [
    // === IRON + VITAMIN C (—É—Å–≤–æ–µ–Ω–∏–µ –∂–µ–ª–µ–∑–∞) ===
    {
      id: 'iron_vitc',
      trigger: { has: 'iron', missing: 'vitaminC' },
      priority: 95,
      icon: 'üçã',
      title: '–î–æ–±–∞–≤—å –≤–∏—Ç–∞–º–∏–Ω C –∫ –∂–µ–ª–µ–∑—É',
      reason: '–£—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –≤ 6 —Ä–∞–∑ –ª—É—á—à–µ',
      science: '–ê—Å–∫–æ—Ä–±–∏–Ω–æ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Fe¬≥‚Å∫ ‚Üí Fe¬≤‚Å∫',
      recommend: { categories: ['vitaminC'], keywords: ['–ª–∏–º–æ–Ω', '–ø–µ—Ä–µ—Ü', '–∞–ø–µ–ª—å—Å–∏–Ω'] }
    },

    // === CALCIUM + VITAMIN D (—É—Å–≤–æ–µ–Ω–∏–µ –∫–∞–ª—å—Ü–∏—è) ===
    {
      id: 'calcium_vitd',
      trigger: { has: 'calcium', missing: 'vitaminD' },
      priority: 90,
      icon: '‚òÄÔ∏è',
      title: '–í–∏—Ç–∞–º–∏–Ω D –¥–ª—è –∫–∞–ª—å—Ü–∏—è',
      reason: '–ö–∞–ª—å—Ü–∏–π –ª—É—á—à–µ —É—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è —Å –≤–∏—Ç–∞–º–∏–Ω–æ–º D',
      science: '–í–∏—Ç–∞–º–∏–Ω D —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç Ca¬≤‚Å∫ –≤ –∫–∏—à–µ—á–Ω–∏–∫–µ',
      recommend: { categories: ['vitaminD'], keywords: ['—è–π—Ü–æ', '–ª–æ—Å–æ—Å—å', '–≥—Ä–∏–±—ã'] }
    },

    // === FAT + FAT-SOLUBLE VITAMINS (A, D, E, K) ===
    {
      id: 'fat_vitamins',
      trigger: { hasCategory: 'vegetables', missingMacro: 'fat', minGrams: 100 },
      priority: 85,
      icon: 'ü´í',
      title: '–î–æ–±–∞–≤—å –º–∞—Å–ª–æ –∫ –æ–≤–æ—â–∞–º',
      reason: '–ö–∞—Ä–æ—Ç–∏–Ω—ã —É—Å–≤–∞–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å –∂–∏—Ä–∞–º–∏',
      science: '–í–∏—Ç–∞–º–∏–Ω—ã A, D, E, K ‚Äî –∂–∏—Ä–æ—Ä–∞—Å—Ç–≤–æ—Ä–∏–º—ã–µ',
      recommend: { keywords: ['–º–∞—Å–ª–æ –æ–ª–∏–≤–∫–æ–≤–æ–µ', '–º–∞—Å–ª–æ', '–∞–≤–æ–∫–∞–¥–æ', '–æ—Ä–µ—Ö'] }
    },

    // === PROTEIN COMPLETENESS (—Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–π –±–µ–ª–æ–∫) ===
    {
      id: 'plant_protein',
      trigger: { hasCategory: 'grains', missingCategory: 'legumes', mealProtLow: true },
      priority: 80,
      icon: 'ü´ò',
      title: '–î–æ–±–∞–≤—å –±–æ–±–æ–≤—ã–µ –∫ –∫—Ä—É–ø–µ',
      reason: '–ü–æ–ª–Ω—ã–π –∞–º–∏–Ω–æ–∫–∏—Å–ª–æ—Ç–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å',
      science: '–ó–ª–∞–∫–∏ + –±–æ–±–æ–≤—ã–µ = –≤—Å–µ –Ω–µ–∑–∞–º–µ–Ω–∏–º—ã–µ –∞–º–∏–Ω–æ–∫–∏—Å–ª–æ—Ç—ã',
      recommend: { keywords: ['—Ñ–∞—Å–æ–ª—å', '—á–µ—á–µ–≤–∏—Ü–∞', '–Ω—É—Ç', '–≥–æ—Ä–æ—Ö'] }
    },

    // === TURMERIC + BLACK PEPPER (–∫—É—Ä–∫—É–º–∏–Ω) ===
    {
      id: 'turmeric_pepper',
      trigger: { hasKeyword: ['–∫—É—Ä–∫—É–º'], missingKeyword: ['–ø–µ—Ä–µ—Ü —á—ë—Ä–Ω'] },
      priority: 75,
      icon: 'üå∂Ô∏è',
      title: '–ß—ë—Ä–Ω—ã–π –ø–µ—Ä–µ—Ü –∫ –∫—É—Ä–∫—É–º–µ',
      reason: '–£—Å–≤–æ–µ–Ω–∏–µ –∫—É—Ä–∫—É–º–∏–Ω–∞ +2000%',
      science: '–ü–∏–ø–µ—Ä–∏–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç –º–µ—Ç–∞–±–æ–ª–∏–∑–º –∫—É—Ä–∫—É–º–∏–Ω–∞ –≤ –ø–µ—á–µ–Ω–∏',
      recommend: { keywords: ['–ø–µ—Ä–µ—Ü —á—ë—Ä–Ω—ã–π'] }
    },

    // === TOMATO + FAT (–ª–∏–∫–æ–ø–∏–Ω) ===
    {
      id: 'tomato_fat',
      trigger: { hasKeyword: ['–ø–æ–º–∏–¥–æ—Ä', '—Ç–æ–º–∞—Ç'], missingMacro: 'fat' },
      priority: 70,
      icon: 'üçÖ',
      title: '–ú–∞—Å–ª–æ –∫ —Ç–æ–º–∞—Ç–∞–º',
      reason: '–õ–∏–∫–æ–ø–∏–Ω —É—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –≤ 4 —Ä–∞–∑–∞ –ª—É—á—à–µ',
      science: '–õ–∏–∫–æ–ø–∏–Ω ‚Äî –∂–∏—Ä–æ—Ä–∞—Å—Ç–≤–æ—Ä–∏–º—ã–π –∫–∞—Ä–æ—Ç–∏–Ω–æ–∏–¥',
      recommend: { keywords: ['–º–∞—Å–ª–æ –æ–ª–∏–≤–∫–æ–≤–æ–µ', '–º–∞—Å–ª–æ', '–∞–≤–æ–∫–∞–¥–æ'] }
    },

    // === TEA + MILK BLOCKS ANTIOXIDANTS ===
    {
      id: 'tea_no_milk',
      trigger: { hasKeyword: ['—á–∞–π –∑–µ–ª—ë–Ω—ã–π', '—á–∞–π —á—ë—Ä–Ω—ã–π'], hasKeyword2: ['–º–æ–ª–æ–∫–æ'] },
      priority: 65,
      icon: '‚ö†Ô∏è',
      title: '–ú–æ–ª–æ–∫–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç—ã —á–∞—è',
      reason: '–ö–∞–∑–µ–∏–Ω —Å–≤—è–∑—ã–≤–∞–µ—Ç –∫–∞—Ç–µ—Ö–∏–Ω—ã',
      science: '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ European Heart Journal 2007',
      isWarning: true
    },

    // === COFFEE BLOCKS IRON ===
    {
      id: 'coffee_iron',
      trigger: { hasKeyword: ['–∫–æ—Ñ–µ'], has: 'iron' },
      priority: 85,
      icon: '‚ö†Ô∏è',
      title: '–ö–æ—Ñ–µ —Å–Ω–∏–∂–∞–µ—Ç —É—Å–≤–æ–µ–Ω–∏–µ –∂–µ–ª–µ–∑–∞ –Ω–∞ 80%',
      reason: '–ü–µ–π –∫–æ—Ñ–µ —á–µ—Ä–µ–∑ 1-2 —á–∞—Å–∞ –ø–æ—Å–ª–µ –µ–¥—ã',
      science: '–¢–∞–Ω–∏–Ω—ã —Å–≤—è–∑—ã–≤–∞—é—Ç –∂–µ–ª–µ–∑–æ –≤ –Ω–µ—Ä–∞—Å—Ç–≤–æ—Ä–∏–º—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è',
      isWarning: true
    },

    // === FIBER + MINERALS ===
    {
      id: 'fiber_minerals',
      trigger: { highFiber: true, has: 'zinc' },
      priority: 60,
      icon: 'üí°',
      title: '–ú–Ω–æ–≥–æ –∫–ª–µ—Ç—á–∞—Ç–∫–∏ —Å–Ω–∏–∂–∞–µ—Ç —É—Å–≤–æ–µ–Ω–∏–µ —Ü–∏–Ω–∫–∞',
      reason: '–§–∏—Ç–∞—Ç—ã —Å–≤—è–∑—ã–≤–∞—é—Ç –º–∏–Ω–µ—Ä–∞–ª—ã',
      science: '–ê–∫—Ç—É–∞–ª—å–Ω–æ –ø—Ä–∏ >35–≥ –∫–ª–µ—Ç—á–∞—Ç–∫–∏/–¥–µ–Ω—å',
      isWarning: true,
      mild: true
    },

    // === PROTEIN + LEUCINE TRIGGER ===
    {
      id: 'protein_leucine',
      trigger: { mealProtein: { min: 20, max: 25 } },
      priority: 70,
      icon: 'üí™',
      title: '–î–æ–±–∞–≤—å –µ—â—ë –±–µ–ª–∫–∞ –¥–æ 30–≥',
      reason: '–õ–µ–π—Ü–∏–Ω–æ–≤—ã–π –ø–æ—Ä–æ–≥ –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ –º—ã—à—Ü',
      science: '~3–≥ –ª–µ–π—Ü–∏–Ω–∞ = –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∞–Ω–∞–±–æ–ª–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç',
      recommend: { categories: ['protein'], keywords: ['—è–π—Ü–æ', '—Ç–≤–æ—Ä–æ–≥', '–∫—É—Ä–∏—Ü–∞'] }
    },

    // === LOW GI + HIGH GI BALANCING ===
    {
      id: 'gi_balance',
      trigger: { mealGI: { min: 70 } },
      priority: 75,
      icon: 'üìâ',
      title: '–î–æ–±–∞–≤—å –∫–ª–µ—Ç—á–∞—Ç–∫—É –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –ì–ò',
      reason: '–°–≥–ª–∞–¥–∏—Ç —Å–∫–∞—á–æ–∫ —Å–∞—Ö–∞—Ä–∞',
      science: '–ö–ª–µ—Ç—á–∞—Ç–∫–∞ –∑–∞–º–µ–¥–ª—è–µ—Ç –≤—Å–∞—Å—ã–≤–∞–Ω–∏–µ –≥–ª—é–∫–æ–∑—ã',
      recommend: { categories: ['fiber'], keywords: ['–æ–≤–æ—â–∏', '—Å–∞–ª–∞—Ç', '–æ–≥—É—Ä–µ—Ü'] }
    },

    // === EVENING PROTEIN ===
    {
      id: 'evening_protein',
      trigger: { time: { after: '20:00' }, mealProtLow: true },
      priority: 80,
      icon: 'üåô',
      title: '–î–æ–±–∞–≤—å –∫–∞–∑–µ–∏–Ω –Ω–∞ –Ω–æ—á—å',
      reason: '–ú–µ–¥–ª–µ–Ω–Ω—ã–π –±–µ–ª–æ–∫ = –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–æ —Å–Ω–µ',
      science: '–ö–∞–∑–µ–∏–Ω –ø–µ—Ä–µ–≤–∞—Ä–∏–≤–∞–µ—Ç—Å—è 6-8 —á–∞—Å–æ–≤',
      recommend: { keywords: ['—Ç–≤–æ—Ä–æ–≥', '–∫–∞–∑–µ–∏–Ω', '—Å—ã—Ä'] }
    },

    // === PRE-WORKOUT CARBS ===
    {
      id: 'preworkout_carbs',
      trigger: { hasTrainingAfterMeal: true, mealCarbsLow: true },
      priority: 75,
      icon: '‚ö°',
      title: '–£–≥–ª–µ–≤–æ–¥—ã –ø–µ—Ä–µ–¥ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–æ–π',
      reason: '–≠–Ω–µ—Ä–≥–∏—è –¥–ª—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã',
      science: '–ì–ª–∏–∫–æ–≥–µ–Ω = —Ç–æ–ø–ª–∏–≤–æ –¥–ª—è –º—ã—à—Ü',
      recommend: { categories: ['grains'], keywords: ['–±–∞–Ω–∞–Ω', '–æ–≤—Å—è–Ω–∫–∞', '—Ä–∏—Å'] }
    },

    // === POST-WORKOUT PROTEIN ===
    {
      id: 'postworkout_protein',
      trigger: { hadTrainingRecently: true, mealProtLow: true },
      priority: 90,
      icon: 'üèãÔ∏è',
      title: '–ë–µ–ª–æ–∫ –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',
      reason: '–û–∫–Ω–æ –∞–Ω–∞–±–æ–ª–∏–∑–º–∞ ‚Äî 2 —á–∞—Å–∞',
      science: '–°–∏–Ω—Ç–µ–∑ –º—ã—à–µ—á–Ω–æ–≥–æ –±–µ–ª–∫–∞ –º–∞–∫—Å–∏–º–∞–ª–µ–Ω –ø–æ—Å–ª–µ –Ω–∞–≥—Ä—É–∑–∫–∏',
      recommend: { categories: ['protein'], keywords: ['–∫—É—Ä–∏—Ü–∞', '—è–π—Ü–æ', '—Ç–≤–æ—Ä–æ–≥', '–ø—Ä–æ—Ç–µ–∏–Ω'] }
    },

    // === CARBS + PROTEIN COMBO ===
    {
      id: 'carbs_protein_combo',
      trigger: { hasOnlyCarbs: true, mealKcal: { min: 300 } },
      priority: 70,
      icon: 'ü•ó',
      title: '–î–æ–±–∞–≤—å –±–µ–ª–æ–∫ –∫ —É–≥–ª–µ–≤–æ–¥–∞–º',
      reason: '–î–æ–ª—å—à–µ –Ω–∞—Å—ã—â–∞–µ—Ç + —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Å–∞—Ö–∞—Ä',
      science: '–ë–µ–ª–æ–∫ –∑–∞–º–µ–¥–ª—è–µ—Ç –æ–ø–æ—Ä–æ–∂–Ω–µ–Ω–∏–µ –∂–µ–ª—É–¥–∫–∞',
      recommend: { categories: ['protein'], keywords: ['—è–π—Ü–æ', '—Ç–≤–æ—Ä–æ–≥', '–∫—É—Ä–∏—Ü–∞', '—Ä—ã–±–∞'] }
    },

    // === SIMPLE CARBS WARNING ===
    {
      id: 'simple_carbs_high',
      trigger: { mealSimpleCarbs: { min: 30 } },
      priority: 65,
      icon: 'üç¨',
      title: '–ú–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—ã—Ö —É–≥–ª–µ–≤–æ–¥–æ–≤',
      reason: '–î–æ–±–∞–≤—å –±–µ–ª–æ–∫ –∏–ª–∏ –∫–ª–µ—Ç—á–∞—Ç–∫—É',
      science: '–ó–∞–º–µ–¥–ª–∏—Ç —Å–∫–∞—á–æ–∫ –∏–Ω—Å—É–ª–∏–Ω–∞',
      recommend: { categories: ['protein', 'fiber'], keywords: ['–æ—Ä–µ—Ö', '—Ç–≤–æ—Ä–æ–≥', '–æ–≤–æ—â–∏'] }
    },

    // === BREAKFAST PROTEIN ===
    {
      id: 'breakfast_protein',
      trigger: { time: { before: '10:00' }, mealProtLow: true, mealKcal: { min: 200 } },
      priority: 80,
      icon: 'üç≥',
      title: '–ë–µ–ª–æ–∫ –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫',
      reason: '–°—Ç–∞–±–∏–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –¥–æ –æ–±–µ–¥–∞',
      science: '–ë–µ–ª–æ–∫ –ø–æ–≤—ã—à–∞–µ—Ç PYY –∏ —Å–Ω–∏–∂–∞–µ—Ç –≥—Ä–µ–ª–∏–Ω',
      recommend: { keywords: ['—è–π—Ü–æ', '—Ç–≤–æ—Ä–æ–≥', '–π–æ–≥—É—Ä—Ç –≥—Ä–µ—á–µ—Å–∫–∏–π', '—Å—ã—Ä'] }
    },

    // === OMEGA-3 + WORKOUT ===
    {
      id: 'omega3_recovery',
      trigger: { hasTrainingToday: true, missing: 'omega3' },
      priority: 65,
      icon: 'üêü',
      title: '–û–º–µ–≥–∞-3 –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è',
      reason: '–°–Ω–∏–∂–∞–µ—Ç –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',
      science: 'EPA/DHA ‚Äî –ø—Ä–æ—Ç–∏–≤–æ–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ–¥–∏–∞—Ç–æ—Ä—ã',
      recommend: { categories: ['omega3'], keywords: ['–ª–æ—Å–æ—Å—å', '—Å–∫—É–º–±—Ä–∏—è', '–ª—å–Ω—è–Ω–æ–µ –º–∞—Å–ª–æ'] }
    },

    // === MAGNESIUM + STRESS ===
    {
      id: 'magnesium_stress',
      trigger: { dayStressHigh: true, missing: 'magnesium' },
      priority: 70,
      icon: 'üòå',
      title: '–ú–∞–≥–Ω–∏–π –ø—Ä–∏ —Å—Ç—Ä–µ—Å—Å–µ',
      reason: '–°–Ω–∏–∂–∞–µ—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª, —Ä–∞—Å—Å–ª–∞–±–ª—è–µ—Ç',
      science: 'Mg¬≤‚Å∫ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç HPA –æ—Å—å',
      recommend: { categories: ['magnesium'], keywords: ['–º–∏–Ω–¥–∞–ª—å', '–∞–≤–æ–∫–∞–¥–æ', '—à–æ–∫–æ–ª–∞–¥ —Ç—ë–º–Ω—ã–π', '–±–∞–Ω–∞–Ω'] }
    },

    // === VITAMIN K + FAT ===
    {
      id: 'leafy_greens_fat',
      trigger: { hasKeyword: ['—à–ø–∏–Ω–∞—Ç', '–∫–∞–ø—É—Å—Ç–∞', '–±—Ä–æ–∫–∫–æ–ª–∏', '—Å–∞–ª–∞—Ç'], missingMacro: 'fat' },
      priority: 70,
      icon: 'ü•¨',
      title: '–î–æ–±–∞–≤—å –∂–∏—Ä—ã –∫ –∑–µ–ª–µ–Ω–∏',
      reason: '–í–∏—Ç–∞–º–∏–Ω K ‚Äî –∂–∏—Ä–æ—Ä–∞—Å—Ç–≤–æ—Ä–∏–º—ã–π',
      science: '–î–ª—è —Å–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –∫—Ä–æ–≤–∏ –∏ –∫–æ—Å—Ç–µ–π',
      recommend: { keywords: ['–º–∞—Å–ª–æ', '–æ—Ä–µ—Ö', '–∞–≤–æ–∫–∞–¥–æ', '—Å—ã—Ä'] }
    },

    // === ALCOHOL WARNING ===
    {
      id: 'alcohol_nutrients',
      trigger: { hasKeyword: ['–≤–∏–Ω–æ', '–ø–∏–≤–æ', '–≤–æ–¥–∫–∞', '–≤–∏—Å–∫–∏', '–∫–æ–Ω—å—è–∫', '–∞–ª–∫–æ–≥–æ–ª—å'] },
      priority: 90,
      icon: '‚ö†Ô∏è',
      title: '–ê–ª–∫–æ–≥–æ–ª—å —Å–Ω–∏–∂–∞–µ—Ç —É—Å–≤–æ–µ–Ω–∏–µ B-–≤–∏—Ç–∞–º–∏–Ω–æ–≤',
      reason: 'B1, B6, B12, —Ñ–æ–ª–∞—Ç ‚Äî –ø–æ–¥ —É–¥–∞—Ä–æ–º',
      science: '–≠—Ç–∞–Ω–æ–ª –Ω–∞—Ä—É—à–∞–µ—Ç –≤—Å–∞—Å—ã–≤–∞–Ω–∏–µ –∏ –º–µ—Ç–∞–±–æ–ª–∏–∑–º',
      isWarning: true
    },

    // === CITRUS + MEDICATION (general awareness) ===
    {
      id: 'grapefruit_caution',
      trigger: { hasKeyword: ['–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç', '–ø–æ–º–µ–ª–æ'] },
      priority: 50,
      icon: 'üíä',
      title: '–û—Å—Ç–æ—Ä–æ–∂–Ω–æ —Å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞–º–∏',
      reason: '–ì—Ä–µ–π–ø—Ñ—Ä—É—Ç –≤–ª–∏—è–µ—Ç –Ω–∞ –º–µ—Ç–∞–±–æ–ª–∏–∑–º –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤',
      science: '–ò–Ω–≥–∏–±–∏—Ä—É–µ—Ç CYP3A4 –≤ –∫–∏—à–µ—á–Ω–∏–∫–µ',
      isWarning: true,
      mild: true
    },

    // === PROTEIN VARIETY ===
    {
      id: 'protein_variety',
      trigger: { sameProteinSource3Days: true },
      priority: 60,
      icon: 'üîÑ',
      title: '–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –±–µ–ª–∫–∞',
      reason: '–†–∞–∑–Ω—ã–µ –∞–º–∏–Ω–æ–∫–∏—Å–ª–æ—Ç–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏',
      science: '–ö—É—Ä–∏—Ü–∞, —Ä—ã–±–∞, —è–π—Ü–∞, –º–æ–ª–æ—á–∫–∞ ‚Äî —á–µ—Ä–µ–¥—É–π',
      recommend: { categories: ['protein'] }
    },

    // === HYDRATION WITH FIBER ===
    {
      id: 'fiber_water',
      trigger: { highFiber: true, dayWaterLow: true },
      priority: 75,
      icon: 'üíß',
      title: '–ü–µ–π –≤–æ–¥—É —Å –∫–ª–µ—Ç—á–∞—Ç–∫–æ–π!',
      reason: '–ë–µ–∑ –≤–æ–¥—ã –∫–ª–µ—Ç—á–∞—Ç–∫–∞ = –∑–∞–ø–æ—Ä—ã',
      science: '–ö–ª–µ—Ç—á–∞—Ç–∫–∞ –≤–ø–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–¥—É –¥–ª—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è',
      isWarning: true
    },

    // === RESISTANT STARCH ===
    {
      id: 'resistant_starch',
      trigger: { hasKeyword: ['–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å', '—Ä–∏—Å', '–º–∞–∫–∞—Ä–æ–Ω'], isCookedCold: true },
      priority: 60,
      icon: '‚ùÑÔ∏è',
      title: '–û—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π –∫—Ä–∞—Ö–º–∞–ª ‚Äî —Ä–µ–∑–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π',
      reason: '–ì–ò –Ω–∏–∂–µ, –ø–∏—Ç–∞–µ—Ç –º–∏–∫—Ä–æ–±–∏–æ—Ç—É',
      science: '–†–µ—Ç—Ä–æ–≥—Ä–∞–¥–∞—Ü–∏—è –∫—Ä–∞—Ö–º–∞–ª–∞ –ø—Ä–∏ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏–∏',
      isInfo: true
    },

    // === PROBIOTICS + PREBIOTICS ===
    {
      id: 'probiotics_prebiotics',
      trigger: { hasKeyword: ['–π–æ–≥—É—Ä—Ç', '–∫–µ—Ñ–∏—Ä', '–∫–≤–∞—à–µ–Ω', '–∫–∏–º—á–∏'], missingKeyword: ['–ª—É–∫', '—á–µ—Å–Ω–æ–∫', '–±–∞–Ω–∞–Ω', '–æ–≤—ë—Å'] },
      priority: 65,
      icon: 'ü¶†',
      title: '–î–æ–±–∞–≤—å –ø—Ä–µ–±–∏–æ—Ç–∏–∫–∏ –∫ –ø—Ä–æ–±–∏–æ—Ç–∏–∫–∞–º',
      reason: '–ü–∏—Ç–∞–Ω–∏–µ –¥–ª—è –ø–æ–ª–µ–∑–Ω—ã—Ö –±–∞–∫—Ç–µ—Ä–∏–π',
      science: '–ò–Ω—É–ª–∏–Ω, FOS ‚Äî —Å—É–±—Å—Ç—Ä–∞—Ç –¥–ª—è –º–∏–∫—Ä–æ–±–∏–æ—Ç—ã',
      recommend: { keywords: ['–ª—É–∫', '—á–µ—Å–Ω–æ–∫', '–±–∞–Ω–∞–Ω', '–æ–≤—Å—è–Ω–∫–∞'] }
    },

    // === COLLAGEN + VITAMIN C ===
    {
      id: 'collagen_vitc',
      trigger: { hasKeyword: ['–∫–æ–ª–ª–∞–≥–µ–Ω', '–∂–µ–ª–∞—Ç–∏–Ω', '—Ö–æ–ª–æ–¥–µ—Ü', '–∑–∞–ª–∏–≤–Ω–æ–µ'], missing: 'vitaminC' },
      priority: 80,
      icon: '‚ú®',
      title: '–í–∏—Ç–∞–º–∏–Ω C –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ –∫–æ–ª–ª–∞–≥–µ–Ω–∞',
      reason: '–ë–µ–∑ –Ω–µ–≥–æ –∫–æ–ª–ª–∞–≥–µ–Ω –Ω–µ —É—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è',
      science: '–ê—Å–∫–æ—Ä–±–∞—Ç ‚Äî –∫–æ—Ñ–∞–∫—Ç–æ—Ä –ø—Ä–æ–ª–∏–ª-–≥–∏–¥—Ä–æ–∫—Å–∏–ª–∞–∑—ã',
      recommend: { categories: ['vitaminC'], keywords: ['–ª–∏–º–æ–Ω', '–∫–∏–≤–∏', '–ø–µ—Ä–µ—Ü'] }
    },

    // === BETA-CAROTENE + FAT ===
    {
      id: 'beta_carotene',
      trigger: { hasKeyword: ['–º–æ—Ä–∫–æ–≤—å', '—Ç—ã–∫–≤–∞', '–±–∞—Ç–∞—Ç', '–º–∞–Ω–≥–æ', '–∞–±—Ä–∏–∫–æ—Å'], missingMacro: 'fat' },
      priority: 70,
      icon: 'ü•ï',
      title: '–î–æ–±–∞–≤—å –∂–∏—Ä—ã –∫ –º–æ—Ä–∫–æ–≤–∏/—Ç—ã–∫–≤–µ',
      reason: '–ë–µ—Ç–∞-–∫–∞—Ä–æ—Ç–∏–Ω ‚Äî –∂–∏—Ä–æ—Ä–∞—Å—Ç–≤–æ—Ä–∏–º—ã–π',
      science: '–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –≤–∏—Ç–∞–º–∏–Ω A',
      recommend: { keywords: ['–º–∞—Å–ª–æ', '—Å–º–µ—Ç–∞–Ω–∞', '–æ—Ä–µ—Ö'] }
    },

    // === QUERCETIN + FAT ===
    {
      id: 'quercetin_fat',
      trigger: { hasKeyword: ['–ª—É–∫', '—è–±–ª–æ–∫–æ', '–±—Ä–æ–∫–∫–æ–ª–∏', '—á–∞–π'], missingMacro: 'fat' },
      priority: 55,
      icon: 'üßÖ',
      title: '–ö–≤–µ—Ä—Ü–µ—Ç–∏–Ω –ª—É—á—à–µ —Å –∂–∏—Ä–∞–º–∏',
      reason: '–ê–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç –¥–ª—è —Å–æ—Å—É–¥–æ–≤',
      science: '–ë–∏–æ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å √ó5 —Å –ª–∏–ø–∏–¥–∞–º–∏',
      recommend: { keywords: ['–º–∞—Å–ª–æ', '–æ—Ä–µ—Ö'] }
    },

    // === CRUCIFEROUS + IODINE ===
    {
      id: 'cruciferous_iodine',
      trigger: { hasKeyword: ['–∫–∞–ø—É—Å—Ç–∞', '–±—Ä–æ–∫–∫–æ–ª–∏', '—Ü–≤–µ—Ç–Ω–∞—è', '–±—Ä—é—Å—Å–µ–ª—å—Å–∫–∞—è', '—Ä–µ–¥–∏—Å', '—Ä–µ–¥—å–∫–∞'] },
      priority: 45,
      icon: 'üßÇ',
      title: '–ö—Ä–µ—Å—Ç–æ—Ü–≤–µ—Ç–Ω—ã–µ + –π–æ–¥',
      reason: '–ì–æ–π—Ç—Ä–æ–≥–µ–Ω—ã –º–æ–≥—É—Ç –≤–ª–∏—è—Ç—å –Ω–∞ —â–∏—Ç–æ–≤–∏–¥–∫—É',
      science: '–ü—Ä–∏ –≥–æ—Ç–æ–≤–∫–µ –≥–æ–π—Ç—Ä–æ–≥–µ–Ω—ã —Ä–∞–∑—Ä—É—à–∞—é—Ç—Å—è',
      isInfo: true,
      mild: true
    },

    // === PHYTATES IN LEGUMES ===
    {
      id: 'legumes_soaking',
      trigger: { hasKeyword: ['—Ñ–∞—Å–æ–ª—å', '—á–µ—á–µ–≤–∏—Ü–∞', '–Ω—É—Ç', '–≥–æ—Ä–æ—Ö'] },
      priority: 40,
      icon: 'üí°',
      title: '–ó–∞–º–∞—á–∏–≤–∞–Ω–∏–µ —Å–Ω–∏–∂–∞–µ—Ç —Ñ–∏—Ç–∞—Ç—ã',
      reason: '–õ—É—á—à–µ —É—Å–≤–æ—è—Ç—Å—è –º–∏–Ω–µ—Ä–∞–ª—ã',
      science: '8-12—á –∑–∞–º–∞—á–∏–≤–∞–Ω–∏—è ‚Äî –æ–ø—Ç–∏–º—É–º',
      isInfo: true,
      mild: true
    },

    // === SULFORAPHANE ACTIVATION ===
    {
      id: 'sulforaphane',
      trigger: { hasKeyword: ['–±—Ä–æ–∫–∫–æ–ª–∏'] },
      priority: 50,
      icon: 'ü•¶',
      title: '–ù–∞—Ä–µ–∂—å –±—Ä–æ–∫–∫–æ–ª–∏ –∏ –ø–æ–¥–æ–∂–¥–∏ 40–º–∏–Ω',
      reason: '–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Å—É–ª—å—Ñ–æ—Ä–∞—Ñ–∞–Ω',
      science: '–ú–∏—Ä–æ–∑–∏–Ω–∞–∑–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≥–ª—é–∫–æ—Ä–∞—Ñ–∞–Ω–∏–Ω',
      isInfo: true
    },

    // === LYCOPENE COOKING ===
    {
      id: 'lycopene_cooking',
      trigger: { hasKeyword: ['–ø–æ–º–∏–¥–æ—Ä', '—Ç–æ–º–∞—Ç'], isCookedOrProcessed: false },
      priority: 45,
      icon: 'üçÖ',
      title: '–ì–æ—Ç–æ–≤—å —Ç–æ–º–∞—Ç—ã ‚Äî –±–æ–ª—å—à–µ –ª–∏–∫–æ–ø–∏–Ω–∞',
      reason: '–¢–µ—Ä–º–æ–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤—ã—à–∞–µ—Ç –±–∏–æ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å',
      science: '+2.5x –ø–æ—Å–ª–µ 30–º–∏–Ω –ø—Ä–∏ 100¬∞C',
      isInfo: true
    },

    // === PROTEIN TIMING (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ) ===
    {
      id: 'protein_distribution',
      trigger: { dayProteinUneven: true },
      priority: 65,
      icon: '‚è∞',
      title: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏ –±–µ–ª–æ–∫ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ',
      reason: '20-40–≥ –∑–∞ –ø—Ä–∏—ë–º ‚Äî –æ–ø—Ç–∏–º—É–º',
      science: 'Muscle full effect –ø—Ä–∏ –∏–∑–±—ã—Ç–∫–µ –∑–∞ —Ä–∞–∑',
      isInfo: true
    },

    // === ANTI-NUTRIENTS GENERAL ===
    {
      id: 'antinutrients_cooking',
      trigger: { hasCategory: 'legumes' },
      priority: 35,
      icon: 'üî•',
      title: '–ì–æ—Ç–æ–≤–∫–∞ —Å–Ω–∏–∂–∞–µ—Ç –∞–Ω—Ç–∏–Ω—É—Ç—Ä–∏–µ–Ω—Ç—ã',
      reason: '–õ–µ–∫—Ç–∏–Ω—ã, –æ–∫—Å–∞–ª–∞—Ç—ã —Ä–∞–∑—Ä—É—à–∞—é—Ç—Å—è',
      science: '–í–∞—Ä–∫–∞ 15+ –º–∏–Ω –Ω–µ–π—Ç—Ä–∞–ª–∏–∑—É–µ—Ç –ª–µ–∫—Ç–∏–Ω—ã',
      isInfo: true,
      mild: true
    },

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –ù–û–í–´–ï –ù–ê–£–ß–ù–´–ï –ü–†–ê–í–ò–õ–ê (2025-12-10)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // === VITAMIN D + FAT (–∂–∏—Ä–Ω–∞—è –µ–¥–∞ = –≤—Ä–µ–º—è D3) ===
    {
      id: 'fat_meal_vitd',
      trigger: { mealFat: { min: 15 } },
      priority: 78,
      icon: '‚òÄÔ∏è',
      title: '–í—ã–ø–µ–π –≤–∏—Ç–∞–º–∏–Ω D —Å —ç—Ç–∏–º –ø—Ä–∏—ë–º–æ–º',
      reason: '–ñ–∏—Ä—ã –ø–æ–≤—ã—à–∞—é—Ç —É—Å–≤–æ–µ–Ω–∏–µ D3 –Ω–∞ 32%',
      science: 'Dawson-Hughes 2015: D3 —Å –∂–∏—Ä–Ω–æ–π –µ–¥–æ–π —É—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 32% –ª—É—á—à–µ',
      isSupplement: true,
      supplementType: 'vitaminD'
    },

    // === EVENING MAGNESIUM ===
    {
      id: 'evening_magnesium',
      trigger: { time: { after: '19:00' } },
      priority: 75,
      icon: 'üíä',
      title: '–•–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –º–∞–≥–Ω–∏—è',
      reason: '–†–∞—Å—Å–ª–∞–±–ª—è–µ—Ç –º—ã—à—Ü—ã, —É–ª—É—á—à–∞–µ—Ç —Å–æ–Ω',
      science: 'Mg¬≤‚Å∫ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ì–ê–ú–ö-—Ä–µ—Ü–µ–ø—Ç–æ—Ä—ã, —Å–Ω–∏–∂–∞–µ—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª',
      isSupplement: true,
      supplementType: 'magnesium'
    },

    // === CALCIUM vs IRON CONFLICT ===
    {
      id: 'calcium_iron_conflict',
      trigger: { has: 'calcium', has2: 'iron' },
      priority: 88,
      icon: '‚ö†Ô∏è',
      title: '–ö–∞–ª—å—Ü–∏–π –∏ –∂–µ–ª–µ–∑–æ ‚Äî –Ω–µ –≤–º–µ—Å—Ç–µ!',
      reason: '–ö–∞–ª—å—Ü–∏–π —Å–Ω–∏–∂–∞–µ—Ç —É—Å–≤–æ–µ–Ω–∏–µ –∂–µ–ª–µ–∑–∞ –Ω–∞ 50%',
      science: 'Hallberg 1991: Ca¬≤‚Å∫ –∫–æ–Ω–∫—É—Ä–∏—Ä—É–µ—Ç —Å Fe¬≤‚Å∫ –∑–∞ DMT1 —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—ë—Ä',
      isWarning: true
    },

    // === COFFEE vs CALCIUM ===
    {
      id: 'coffee_calcium_timing',
      trigger: { hasKeyword: ['–∫–æ—Ñ–µ', '—ç—Å–ø—Ä–µ—Å—Å–æ'], has: 'calcium' },
      priority: 82,
      icon: '‚òï',
      title: '–ö–æ—Ñ–µ + –º–æ–ª–æ—á–∫–∞ ‚Äî –ø–æ–¥–æ–∂–¥–∏ 2 —á–∞—Å–∞',
      reason: '–ö–æ—Ñ–µ–∏–Ω –≤—ã–º—ã–≤–∞–µ—Ç –∫–∞–ª—å—Ü–∏–π',
      science: 'Massey 1993: 6–º–≥ Ca —Ç–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—ã–µ 100–º–≥ –∫–æ—Ñ–µ–∏–Ω–∞',
      isWarning: true
    },

    // === MAGNESIUM + B6 SYNERGY ===
    {
      id: 'magnesium_b6',
      trigger: { has: 'magnesium' },
      priority: 65,
      icon: 'üîó',
      title: '–ú–∞–≥–Ω–∏–π –ª—É—á—à–µ —Å B6',
      reason: 'B6 –ø–æ–≤—ã—à–∞–µ—Ç —É—Å–≤–æ–µ–Ω–∏–µ Mg –Ω–∞ 20%',
      science: 'Pouteau 2018: –ø–∏—Ä–∏–¥–æ–∫—Å–∏–Ω —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–ª–µ—Ç–æ—á–Ω—ã–π –∑–∞—Ö–≤–∞—Ç Mg¬≤‚Å∫',
      recommend: { keywords: ['–∫—É—Ä–∏—Ü–∞', '—Ä—ã–±–∞', '–±–∞–Ω–∞–Ω', '–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å'] }
    },

    // === ZINC + EMPTY STOMACH ===
    {
      id: 'zinc_empty_stomach',
      trigger: { has: 'zinc', mealKcal: { max: 150 } },
      priority: 70,
      icon: 'üí°',
      title: '–¶–∏–Ω–∫ –Ω–∞—Ç–æ—â–∞–∫ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ç–æ—à–Ω–æ—Ç—É',
      reason: '–õ—É—á—à–µ —Å –Ω–µ–±–æ–ª—å—à–æ–π –ø–æ—Ä—Ü–∏–µ–π –µ–¥—ã',
      science: 'Zn¬≤‚Å∫ —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç —Å–ª–∏–∑–∏—Å—Ç—É—é –∂–µ–ª—É–¥–∫–∞',
      isWarning: true,
      mild: true
    },

    // === FISH OIL + FATTY MEAL ===
    {
      id: 'omega3_with_fat',
      trigger: { mealFat: { min: 10 }, missing: 'omega3' },
      priority: 72,
      icon: 'üêü',
      title: '–û—Ç–ª–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –û–º–µ–≥–∞-3',
      reason: '–° –∂–∏—Ä–Ω–æ–π –µ–¥–æ–π —É—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –≤ 3 —Ä–∞–∑–∞ –ª—É—á—à–µ',
      science: 'Lawson 1988: EPA/DHA –∞–±—Å–æ—Ä–±—Ü–∏—è √ó3 —Å –∂–∏—Ä–∞–º–∏',
      isSupplement: true,
      supplementType: 'omega3'
    },

    // === IRON + MORNING ===
    {
      id: 'iron_morning_best',
      trigger: { has: 'iron', time: { before: '11:00' } },
      priority: 60,
      icon: 'üåÖ',
      title: '–£—Ç—Ä–æ ‚Äî –ª—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –∂–µ–ª–µ–∑–∞',
      reason: '–£—Å–≤–æ–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–∞—Ç–æ—â–∞–∫/—Å –ª—ë–≥–∫–æ–π –µ–¥–æ–π',
      science: '–ì–µ–ø—Å–∏–¥–∏–Ω (–±–ª–æ–∫–∞—Ç–æ—Ä Fe) –º–∏–Ω–∏–º–∞–ª–µ–Ω —É—Ç—Ä–æ–º',
      isInfo: true
    },

    // === LATE NIGHT PROTEIN vs FAT ===
    {
      id: 'late_night_fat',
      trigger: { time: { after: '22:00' }, mealFat: { min: 20 } },
      priority: 68,
      icon: 'üåô',
      title: '–ú–Ω–æ–≥–æ –∂–∏—Ä–∞ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º',
      reason: '–ó–∞–º–µ–¥–ª–∏—Ç –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ, —É—Ö—É–¥—à–∏—Ç —Å–æ–Ω',
      science: '–ñ–∏—Ä—ã –∑–∞–º–µ–¥–ª—è—é—Ç –æ–ø–æ—Ä–æ–∂–Ω–µ–Ω–∏–µ –∂–µ–ª—É–¥–∫–∞ –Ω–∞ 2-4—á',
      isWarning: true
    },

    // === VITAMIN C + TIMING ===
    {
      id: 'vitc_with_meal',
      trigger: { has: 'vitaminC', mealKcal: { max: 100 } },
      priority: 55,
      icon: 'üçã',
      title: '–í–∏—Ç–∞–º–∏–Ω C –ª—É—á—à–µ —Å –µ–¥–æ–π',
      reason: '–°–Ω–∏–∂–∞–µ—Ç —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ –∂–µ–ª—É–¥–∫–∞',
      science: '–ê—Å–∫–æ—Ä–±–∏–Ω–æ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞ = –∫–∏—Å–ª–æ—Ç–∞ ‚Üí –ª—É—á—à–µ —Å –±—É—Ñ–µ—Ä–æ–º',
      isInfo: true,
      mild: true
    },

    // === PROTEIN + CREATINE ===
    {
      id: 'protein_creatine_timing',
      trigger: { mealProtein: { min: 25 }, hasTrainingToday: true },
      priority: 65,
      icon: 'üí™',
      title: '–ë–µ–ª–æ–∫ + –∏–Ω—Å—É–ª–∏–Ω = –ª—É—á—à–µ –¥–ª—è –∫—Ä–µ–∞—Ç–∏–Ω–∞',
      reason: '–ï—Å–ª–∏ –ø—Ä–∏–Ω–∏–º–∞–µ—à—å –∫—Ä–µ–∞—Ç–∏–Ω ‚Äî —Å–µ–π—á–∞—Å!',
      science: 'Green 1996: –∏–Ω—Å—É–ª–∏–Ω —É—Å–∏–ª–∏–≤–∞–µ—Ç –∑–∞—Ö–≤–∞—Ç –∫—Ä–µ–∞—Ç–∏–Ω–∞ –º—ã—à—Ü–∞–º–∏ –Ω–∞ 60%',
      isSupplement: true,
      supplementType: 'creatine'
    },

    // === TRYPTOPHAN + CARBS (–¥–ª—è —Å–Ω–∞) ===
    {
      id: 'tryptophan_carbs',
      trigger: { hasKeyword: ['–∏–Ω–¥–µ–π–∫–∞', '–∫—É—Ä–∏—Ü–∞', '–º–æ–ª–æ–∫–æ', '—Ç–≤–æ—Ä–æ–≥', '—Å—ã—Ä'], time: { after: '19:00' }, mealCarbs: { min: 30 } },
      priority: 62,
      icon: 'üò¥',
      title: '–¢—Ä–∏–ø—Ç–æ—Ñ–∞–Ω + —É–≥–ª–µ–≤–æ–¥—ã = –º–µ–ª–∞—Ç–æ–Ω–∏–Ω',
      reason: '–•–æ—Ä–æ—à–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –¥–ª—è —Å–Ω–∞',
      science: '–£–≥–ª–µ–≤–æ–¥—ã ‚Üí –∏–Ω—Å—É–ª–∏–Ω ‚Üí LNAA –∏–∑ –∫—Ä–æ–≤–∏ ‚Üí —Ç—Ä–∏–ø—Ç–æ—Ñ–∞–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç –ì–≠–ë',
      isInfo: true
    },

    // === COLLAGEN + GLYCINE TIMING ===
    {
      id: 'collagen_sleep',
      trigger: { hasKeyword: ['–∫–æ–ª–ª–∞–≥–µ–Ω', '–∂–µ–ª–∞—Ç–∏–Ω'], time: { after: '20:00' } },
      priority: 58,
      icon: '‚ú®',
      title: '–ö–æ–ª–ª–∞–≥–µ–Ω –≤–µ—á–µ—Ä–æ–º ‚Äî –æ—Ç–ª–∏—á–Ω–æ!',
      reason: '–ì–ª–∏—Ü–∏–Ω —É–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞',
      science: 'Bannai 2012: 3–≥ –≥–ª–∏—Ü–∏–Ω–∞ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º —É–ª—É—á—à–∞–µ—Ç —Å–æ–Ω',
      isInfo: true
    },

    // === PROBIOTICS + PREBIOTICS ===
    {
      id: 'probiotic_empty',
      trigger: { hasKeyword: ['–ø—Ä–æ–±–∏–æ—Ç–∏–∫', '–±–∏—Ñ–∏–¥–æ', '–ª–∞–∫—Ç–æ'], mealKcal: { min: 200 } },
      priority: 60,
      icon: 'ü¶†',
      title: '–ü—Ä–æ–±–∏–æ—Ç–∏–∫–∏ –ª—É—á—à–µ –Ω–∞—Ç–æ—â–∞–∫',
      reason: '–ò–ª–∏ —á–µ—Ä–µ–∑ 2—á –ø–æ—Å–ª–µ –µ–¥—ã',
      science: '–ñ–µ–ª—É–¥–æ—á–Ω—ã–π —Å–æ–∫ —É–±–∏–≤–∞–µ—Ç –±–∞–∫—Ç–µ—Ä–∏–∏, –Ω–∞—Ç–æ—â–∞–∫ pH –≤—ã—à–µ',
      isInfo: true,
      mild: true
    },

    // === GREEN TEA + IRON BLOCK ===
    {
      id: 'green_tea_iron',
      trigger: { hasKeyword: ['—á–∞–π –∑–µ–ª—ë–Ω—ã–π', '–∑–µ–ª—ë–Ω—ã–π —á–∞–π', '–º–∞—Ç—á–∞'], has: 'iron' },
      priority: 80,
      icon: 'üçµ',
      title: '–ó–µ–ª—ë–Ω—ã–π —á–∞–π –±–ª–æ–∫–∏—Ä—É–µ—Ç –∂–µ–ª–µ–∑–æ',
      reason: '–¢–∞–Ω–∏–Ω—ã —Å–≤—è–∑—ã–≤–∞—é—Ç Fe ‚Äî –ø–µ–π —á–µ—Ä–µ–∑ 1—á',
      science: 'Hurrell 1999: —Ç–∞–Ω–∏–Ω—ã —Å–Ω–∏–∂–∞—é—Ç –∞–±—Å–æ—Ä–±—Ü–∏—é Fe –Ω–∞ 70%',
      isWarning: true
    },

    // === EGGS + CHOLINE FOR BRAIN ===
    {
      id: 'eggs_morning_brain',
      trigger: { hasKeyword: ['—è–π—Ü–æ', '—è–∏—á–Ω', '–æ–º–ª–µ—Ç'], time: { before: '12:00' } },
      priority: 55,
      icon: 'üß†',
      title: '–•–æ–ª–∏–Ω –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫ ‚Äî –¥–ª—è –º–æ–∑–≥–∞',
      reason: '–Ø–π—Ü–∞ = –ª—É—á—à–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ö–æ–ª–∏–Ω–∞',
      science: '–•–æ–ª–∏–Ω ‚Üí –∞—Ü–µ—Ç–∏–ª—Ö–æ–ª–∏–Ω ‚Üí –ø–∞–º—è—Ç—å –∏ —Ñ–æ–∫—É—Å',
      isInfo: true
    },

    // === SPINACH + LEMON ===
    {
      id: 'spinach_lemon',
      trigger: { hasKeyword: ['—à–ø–∏–Ω–∞—Ç'], missingKeyword: ['–ª–∏–º–æ–Ω', '–∞–ø–µ–ª—å—Å–∏–Ω', '–ø–µ—Ä–µ—Ü'] },
      priority: 75,
      icon: 'ü•¨',
      title: '–î–æ–±–∞–≤—å –ª–∏–º–æ–Ω –∫ —à–ø–∏–Ω–∞—Ç—É',
      reason: '–û–∫—Å–∞–ª–∞—Ç—ã —Å–≤—è–∑—ã–≤–∞—é—Ç –∂–µ–ª–µ–∑–æ ‚Äî –≤–∏—Ç C –ø–æ–º–æ–∂–µ—Ç',
      science: '–í–∏—Ç–∞–º–∏–Ω C –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç Fe¬≥‚Å∫ ‚Üí Fe¬≤‚Å∫ –¥–ª—è —É—Å–≤–æ–µ–Ω–∏—è',
      recommend: { keywords: ['–ª–∏–º–æ–Ω', '–ø–µ—Ä–µ—Ü –±–æ–ª–≥–∞—Ä—Å–∫–∏–π'] }
    },

    // === BERRIES + CREAM ===
    {
      id: 'berries_fat',
      trigger: { hasKeyword: ['—è–≥–æ–¥', '–º–∞–ª–∏–Ω', '—á–µ—Ä–Ω–∏–∫', '–∫–ª—É–±–Ω–∏–∫', '–≥–æ–ª—É–±–∏–∫', '—Å–º–æ—Ä–æ–¥–∏–Ω'], missingMacro: 'fat' },
      priority: 65,
      icon: 'ü´ê',
      title: '–Ø–≥–æ–¥—ã –ª—É—á—à–µ —Å –∂–∏—Ä–∞–º–∏',
      reason: '–ê–Ω—Ç–æ—Ü–∏–∞–Ω—ã = –∂–∏—Ä–æ—Ä–∞—Å—Ç–≤–æ—Ä–∏–º—ã–µ',
      science: 'Lipophilic polyphenols –ª—É—á—à–µ —Å –ª–∏–ø–∏–¥–∞–º–∏',
      recommend: { keywords: ['—Å–ª–∏–≤–∫–∏', '—Å–º–µ—Ç–∞–Ω–∞', '–π–æ–≥—É—Ä—Ç', '–æ—Ä–µ—Ö'] }
    },

    // === LIVER + AVOID EXCESS ===
    {
      id: 'liver_vita_excess',
      trigger: { hasKeyword: ['–ø–µ—á–µ–Ω—å', '–ø–µ—á—ë–Ω–∫–∞'] },
      priority: 70,
      icon: '‚ö†Ô∏è',
      title: '–ü–µ—á–µ–Ω—å 1-2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é',
      reason: '–ò–∑–±—ã—Ç–æ–∫ –≤–∏—Ç–∞–º–∏–Ω–∞ A —Ç–æ–∫—Å–∏—á–µ–Ω',
      science: '–ì–∏–ø–µ—Ä–≤–∏—Ç–∞–º–∏–Ω–æ–∑ A –ø—Ä–∏ >10000 IU/–¥–µ–Ω—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ',
      isWarning: true,
      mild: true
    },

    // === AVOCADO + SALAD ===
    {
      id: 'avocado_salad',
      trigger: { hasKeyword: ['–∞–≤–æ–∫–∞–¥–æ'], hasCategory: 'vegetables' },
      priority: 68,
      icon: 'ü•ë',
      title: '–ò–¥–µ–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è!',
      reason: '–ê–≤–æ–∫–∞–¥–æ √ó4 —É—Å–≤–æ–µ–Ω–∏–µ –∫–∞—Ä–æ—Ç–∏–Ω–æ–∏–¥–æ–≤ –∏–∑ —Å–∞–ª–∞—Ç–∞',
      science: 'Unlu 2005: –∂–∏—Ä—ã –∞–≤–æ–∫–∞–¥–æ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –∞–±—Å–æ—Ä–±—Ü–∏—é –∫–∞—Ä–æ—Ç–∏–Ω–æ–∏–¥–æ–≤',
      isInfo: true
    },

    // === BREAKFAST CORTISOL SPIKE ===
    {
      id: 'morning_cortisol',
      trigger: { time: { before: '09:00' }, mealSimpleCarbs: { min: 25 } },
      priority: 72,
      icon: '‚ö°',
      title: '–£—Ç—Ä–æ–º –∫–æ—Ä—Ç–∏–∑–æ–ª –≤—ã—Å–æ–∫–∏–π ‚Äî –º–µ–Ω—å—à–µ —Å–∞—Ö–∞—Ä–∞',
      reason: '–ü—Ä–æ—Å—Ç—ã–µ —É–≥–ª–µ–≤–æ–¥—ã —É—Å–∏–ª—è—Ç —Å—Ç—Ä–µ—Å—Å-–æ—Ç–≤–µ—Ç',
      science: 'Cortisol awakening response + —Å–∞—Ö–∞—Ä = –∏–Ω—Å—É–ª–∏–Ω–æ–≤—ã–µ –∫–∞—á–µ–ª–∏',
      isWarning: true
    },

    // === NUTS + PHYTATES ===
    {
      id: 'nuts_soaking',
      trigger: { hasKeyword: ['–º–∏–Ω–¥–∞–ª—å', '–≥—Ä–µ—Ü–∫', '—Ñ—É–Ω–¥—É–∫', '–∫–µ—à—å—é', '–æ—Ä–µ—Ö'] },
      priority: 40,
      icon: 'üí°',
      title: '–ó–∞–º–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ä–µ—Ö–æ–≤ = –ª—É—á—à–µ —É—Å–≤–æ–µ–Ω–∏–µ',
      reason: '–ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ñ–µ—Ä–º–µ–Ω—Ç—ã, —Å–Ω–∏–∂–∞–µ—Ç —Ñ–∏—Ç–∞—Ç—ã',
      science: '8-12—á –≤ –≤–æ–¥–µ ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ',
      isInfo: true,
      mild: true
    }
  ];

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // BALANCE_RULES ‚Äî –ü—Ä–∞–≤–∏–ª–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –º–∞–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  const BALANCE_RULES = [
    {
      id: 'need_protein',
      trigger: { mealProtPct: { max: 15 }, mealKcal: { min: 300 } },
      priority: 85,
      icon: 'ü•©',
      title: '–î–æ–±–∞–≤—å –±–µ–ª–æ–∫',
      reason: '–¢–æ–ª—å–∫–æ ' + '{protPct}%' + ' –∫–∞–ª–æ—Ä–∏–π –∏–∑ –±–µ–ª–∫–∞',
      recommend: { categories: ['protein'], keywords: ['–∫—É—Ä–∏—Ü–∞', '—Ä—ã–±–∞', '—è–π—Ü–æ', '—Ç–≤–æ—Ä–æ–≥'] }
    },
    {
      id: 'need_fiber',
      trigger: { mealFiber: { max: 3 }, mealKcal: { min: 300 } },
      priority: 75,
      icon: 'ü•ó',
      title: '–î–æ–±–∞–≤—å –∫–ª–µ—Ç—á–∞—Ç–∫—É',
      reason: '–í—Å–µ–≥–æ {fiber}–≥ –∫–ª–µ—Ç—á–∞—Ç–∫–∏ –≤ –ø—Ä–∏—ë–º–µ',
      recommend: { categories: ['vegetables', 'fiber'], keywords: ['—Å–∞–ª–∞—Ç', '–æ–≥—É—Ä–µ—Ü', '–∫–∞–ø—É—Å—Ç–∞', '–±—Ä–æ–∫–∫–æ–ª–∏'] }
    },
    {
      id: 'need_healthy_fat',
      trigger: { mealGoodFatPct: { max: 30 }, mealFat: { min: 10 } },
      priority: 65,
      icon: 'ü•ë',
      title: '–£–ª—É—á—à–∏ –∫–∞—á–µ—Å—Ç–≤–æ –∂–∏—Ä–æ–≤',
      reason: '–ú–∞–ª–æ –ø–æ–ª–µ–∑–Ω—ã—Ö –∂–∏—Ä–æ–≤',
      recommend: { keywords: ['–∞–≤–æ–∫–∞–¥–æ', '–æ–ª–∏–≤–∫–æ–≤–æ–µ', '–æ—Ä–µ—Ö', '–ª–æ—Å–æ—Å—å'] }
    },
    {
      id: 'too_much_simple',
      trigger: { mealSimplePct: { min: 50 }, mealCarbs: { min: 30 } },
      priority: 80,
      icon: '‚ö†Ô∏è',
      title: '–ú–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—ã—Ö —É–≥–ª–µ–≤–æ–¥–æ–≤',
      reason: '{simplePct}% —É–≥–ª–µ–≤–æ–¥–æ–≤ ‚Äî –ø—Ä–æ—Å—Ç—ã–µ',
      recommend: { categories: ['protein', 'fiber'], keywords: ['–æ—Ä–µ—Ö', '–±–µ–ª–æ–∫', '–æ–≤–æ—â–∏'] },
      isWarning: true
    }
  ];

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // TIMING_RULES ‚Äî –ü—Ä–∞–≤–∏–ª–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  const TIMING_RULES = [
    {
      id: 'late_carbs',
      trigger: { time: { after: '21:00' }, mealCarbsPct: { min: 50 } },
      priority: 70,
      icon: 'üåô',
      title: '–ü–æ–∑–¥–Ω–∏–µ —É–≥–ª–µ–≤–æ–¥—ã',
      reason: '–í–µ—á–µ—Ä–æ–º –ª—É—á—à–µ –±–µ–ª–æ–∫ + –∂–∏—Ä—ã',
      science: '–ò–Ω—Å—É–ª–∏–Ω–æ–≤–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–µ–Ω–∞',
      isWarning: true
    },
    {
      id: 'morning_fat',
      trigger: { time: { before: '09:00' }, mealFatPct: { max: 15 }, mealKcal: { min: 200 } },
      priority: 60,
      icon: 'üåÖ',
      title: '–î–æ–±–∞–≤—å –∂–∏—Ä—ã –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫',
      reason: '–°—ã—Ç–æ—Å—Ç—å + —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è',
      recommend: { keywords: ['–∞–≤–æ–∫–∞–¥–æ', '–æ—Ä–µ—Ö', '–º–∞—Å–ª–æ', '—Å—ã—Ä'] }
    },
    {
      id: 'afternoon_slump',
      trigger: { time: { after: '14:00', before: '16:00' }, mealGI: { min: 70 } },
      priority: 65,
      icon: 'üò¥',
      title: '–í—ã—Å–æ–∫–∏–π –ì–ò –ø–æ—Å–ª–µ –æ–±–µ–¥–∞',
      reason: '–†–∏—Å–∫ —Å–æ–Ω–ª–∏–≤–æ—Å—Ç–∏',
      recommend: { keywords: ['–æ—Ä–µ—Ö', '–±–µ–ª–æ–∫', '—Å–∞–ª–∞—Ç'] }
    }
  ];

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // HELPER FUNCTIONS ‚Äî –£—Ç–∏–ª–∏—Ç—ã
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω—É—Ç—Ä–∏–µ–Ω—Ç—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–æ–¥—É–∫—Ç–∞
   */
  function detectNutrients(productName) {
    if (!productName) return [];
    const name = productName.toLowerCase();
    const found = [];

    for (const [nutrientId, config] of Object.entries(NUTRIENT_KEYWORDS)) {
      for (const keyword of config.keywords) {
        if (name.includes(keyword.toLowerCase())) {
          found.push(nutrientId);
          break;
        }
      }
    }

    return found;
  }

  /**
   * –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –Ω—É—Ç—Ä–∏–µ–Ω—Ç–∞–º –ø—Ä–æ–¥—É–∫—Ç–∞
   */
  function detectCategories(product, existingCategories) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ heys_advice –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
    const adviceCategories = HEYS.advice?.PRODUCT_CATEGORIES || existingCategories || {};

    if (!product?.name) return [];
    const name = product.name.toLowerCase();
    const found = [];

    for (const [catId, config] of Object.entries(adviceCategories)) {
      if (!config.keywords) continue;
      for (const keyword of config.keywords) {
        if (name.includes(keyword.toLowerCase())) {
          found.push(catId);
          break;
        }
      }
    }

    return found;
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞
   */
  function normalizeTextForKeywordMatch(s) {
    return String(s || '')
      .toLowerCase()
      .replace(/—ë/g, '–µ')
      // –ë—É–∫–≤—ã/—Ü–∏—Ñ—Ä—ã (–ª–∞—Ç–∏–Ω–∏—Ü–∞ + –∫–∏—Ä–∏–ª–ª–∏—Ü–∞). –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Üí –ø—Ä–æ–±–µ–ª.
      .replace(/[^a-z0-9–∞-—è–µ]+/gi, ' ')
      .trim()
      .replace(/\s+/g, ' ');
  }

  function tokenizeNormalizedText(sNorm) {
    return sNorm ? sNorm.split(' ') : [];
  }

  /**
   * –ù–∞–¥—ë–∂–Ω—ã–π –º–∞—Ç—á –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –ø–æ —Ç–µ–∫—Å—Ç—É –ø—Ä–∏—ë–º–∞.
   *
   * –í–∞–∂–Ω–æ: –º–Ω–æ–≥–∏–µ keywords –∑–∞–¥–∞–Ω—ã –∫–∞–∫ "–∫–æ—Ä–µ–Ω—å" (–Ω–∞–ø—Ä. "–∫—É—Ä–∫—É–º"), –ø–æ—ç—Ç–æ–º—É
   * –∏—Å–ø–æ–ª—å–∑—É–µ–º startsWith –ø–æ —Ç–æ–∫–µ–Ω–∞–º. –≠—Ç–æ —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ª–æ–∂–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
   * —Ç–∏–ø–∞ "–≤–∏–Ω–æ" –≤–Ω—É—Ç—Ä–∏ "—Å–≤–∏–Ω–æ".
   */
  function textHasKeyword(mealTokens, mealNorm, keyword) {
    const kwNorm = normalizeTextForKeywordMatch(keyword);
    if (!kwNorm) return false;
    const kwTokens = kwNorm.split(' ');
    if (kwTokens.length === 1) {
      const needle = kwTokens[0];
      return mealTokens.some((t) => t.startsWith(needle));
    }

    // Multi-word: –∏—â–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤ (–∫–∞–∂–¥—ã–π —Ç–æ–∫–µ–Ω startsWith –∫–æ—Ä–Ω—è)
    for (let i = 0; i <= mealTokens.length - kwTokens.length; i++) {
      let ok = true;
      for (let j = 0; j < kwTokens.length; j++) {
        if (!mealTokens[i + j].startsWith(kwTokens[j])) {
          ok = false;
          break;
        }
      }
      if (ok) return true;
    }

    // Fallback: –Ω–∞ —Å–ª—É—á–∞–π –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏
    return mealNorm.includes(kwNorm);
  }

  function checkTrigger(trigger, context) {
    const { meal, mealTotals, dayData, profile, products, time } = context;

    // –¢–µ–∫—Å—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–∏—ë–º–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—Ä–∏–≥–≥–µ—Ä–∞—Ö
    const mealTextRaw = (meal?.items || []).map((it) => (it.name || '')).join(' ');
    const mealTextNorm = normalizeTextForKeywordMatch(mealTextRaw);
    const mealTokens = tokenizeNormalizedText(mealTextNorm);

    // has: nutrient
    if (trigger.has) {
      const allNutrients = (context.mealNutrients || []);
      if (!allNutrients.includes(trigger.has)) return false;
    }

    // has2: second nutrient (–¥–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
    if (trigger.has2) {
      const allNutrients = (context.mealNutrients || []);
      if (!allNutrients.includes(trigger.has2)) return false;
    }

    // missing: nutrient
    if (trigger.missing) {
      const allNutrients = (context.mealNutrients || []);
      if (allNutrients.includes(trigger.missing)) return false;
    }

    // hasCategory
    if (trigger.hasCategory) {
      const cats = context.mealCategories || [];
      if (!cats.includes(trigger.hasCategory)) return false;
    }

    // missingCategory
    if (trigger.missingCategory) {
      const cats = context.mealCategories || [];
      if (cats.includes(trigger.missingCategory)) return false;
    }

    // hasKeyword
    if (trigger.hasKeyword) {
      const keywords = Array.isArray(trigger.hasKeyword) ? trigger.hasKeyword : [trigger.hasKeyword];
      const hasAny = keywords.some((kw) => textHasKeyword(mealTokens, mealTextNorm, kw));
      if (!hasAny) return false;
    }

    // missingKeyword
    if (trigger.missingKeyword) {
      const keywords = Array.isArray(trigger.missingKeyword) ? trigger.missingKeyword : [trigger.missingKeyword];
      const hasAny = keywords.some((kw) => textHasKeyword(mealTokens, mealTextNorm, kw));
      if (hasAny) return false;
    }

    // hasKeyword2 ‚Äî –≤—Ç–æ—Ä–æ–π –Ω–∞–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
    if (trigger.hasKeyword2) {
      const keywords = Array.isArray(trigger.hasKeyword2) ? trigger.hasKeyword2 : [trigger.hasKeyword2];
      const hasAny = keywords.some((kw) => textHasKeyword(mealTokens, mealTextNorm, kw));
      if (!hasAny) return false;
    }

    // missingMacro: 'fat' | 'protein' | 'carbs'
    if (trigger.missingMacro) {
      const t = mealTotals || {};
      if (trigger.missingMacro === 'fat' && t.fat > 5) return false;
      if (trigger.missingMacro === 'protein' && t.prot > 10) return false;
      if (trigger.missingMacro === 'carbs' && t.carbs > 10) return false;
    }

    // minGrams
    if (trigger.minGrams && (mealTotals?.grams || 0) < trigger.minGrams) return false;

    // mealProtLow
    if (trigger.mealProtLow && (mealTotals?.prot || 0) >= 15) return false;

    // mealCarbsLow
    if (trigger.mealCarbsLow && (mealTotals?.carbs || 0) >= 30) return false;

    // mealProtein: { min, max }
    if (trigger.mealProtein) {
      const prot = mealTotals?.prot || 0;
      if (trigger.mealProtein.min !== undefined && prot < trigger.mealProtein.min) return false;
      if (trigger.mealProtein.max !== undefined && prot > trigger.mealProtein.max) return false;
    }

    // mealKcal: { min, max }
    if (trigger.mealKcal) {
      const kcal = mealTotals?.kcal || 0;
      if (trigger.mealKcal.min !== undefined && kcal < trigger.mealKcal.min) return false;
      if (trigger.mealKcal.max !== undefined && kcal > trigger.mealKcal.max) return false;
    }

    // mealGI: { min, max }
    if (trigger.mealGI) {
      const gi = context.avgGI || 50;
      if (trigger.mealGI.min !== undefined && gi < trigger.mealGI.min) return false;
      if (trigger.mealGI.max !== undefined && gi > trigger.mealGI.max) return false;
    }

    // mealSimpleCarbs: { min }
    if (trigger.mealSimpleCarbs) {
      const simple = mealTotals?.simple || 0;
      if (trigger.mealSimpleCarbs.min !== undefined && simple < trigger.mealSimpleCarbs.min) return false;
    }

    // mealProtPct: { max }
    if (trigger.mealProtPct) {
      const kcal = mealTotals?.kcal || 0;
      const prot = mealTotals?.prot || 0;
      const protPct = kcal > 0 ? (prot * 3 / kcal * 100) : 0;
      if (trigger.mealProtPct.max !== undefined && protPct > trigger.mealProtPct.max) return false;
    }

    // mealFiber: { max }
    if (trigger.mealFiber) {
      const fiber = mealTotals?.fiber || 0;
      if (trigger.mealFiber.max !== undefined && fiber > trigger.mealFiber.max) return false;
    }

    // mealGoodFatPct: { max }
    if (trigger.mealGoodFatPct) {
      const fat = mealTotals?.fat || 0;
      const good = mealTotals?.good || 0;
      const goodPct = fat > 0 ? (good / fat * 100) : 0;
      if (trigger.mealGoodFatPct.max !== undefined && goodPct > trigger.mealGoodFatPct.max) return false;
    }

    // mealSimplePct: { min }
    if (trigger.mealSimplePct) {
      const carbs = mealTotals?.carbs || 0;
      const simple = mealTotals?.simple || 0;
      const simplePct = carbs > 0 ? (simple / carbs * 100) : 0;
      if (trigger.mealSimplePct.min !== undefined && simplePct < trigger.mealSimplePct.min) return false;
    }

    // mealCarbs: { min }
    if (trigger.mealCarbs) {
      const carbs = mealTotals?.carbs || 0;
      if (trigger.mealCarbs.min !== undefined && carbs < trigger.mealCarbs.min) return false;
    }

    // mealFat: { min }
    if (trigger.mealFat) {
      const fat = mealTotals?.fat || 0;
      if (trigger.mealFat.min !== undefined && fat < trigger.mealFat.min) return false;
    }

    // mealCarbsPct: { min }
    if (trigger.mealCarbsPct) {
      const kcal = mealTotals?.kcal || 0;
      const carbs = mealTotals?.carbs || 0;
      const carbsPct = kcal > 0 ? (carbs * 4 / kcal * 100) : 0;
      if (trigger.mealCarbsPct.min !== undefined && carbsPct < trigger.mealCarbsPct.min) return false;
    }

    // mealFatPct: { max }
    if (trigger.mealFatPct) {
      const kcal = mealTotals?.kcal || 0;
      const fat = mealTotals?.fat || 0;
      const fatPct = kcal > 0 ? (fat * 9 / kcal * 100) : 0;
      if (trigger.mealFatPct.max !== undefined && fatPct > trigger.mealFatPct.max) return false;
    }

    // time: { before, after }
    if (trigger.time) {
      const mealTime = time || meal?.time || '12:00';
      const [h, m] = mealTime.split(':').map(Number);
      const mealMinutes = h * 60 + m;

      if (trigger.time.before) {
        const [bh, bm] = trigger.time.before.split(':').map(Number);
        if (mealMinutes >= bh * 60 + bm) return false;
      }
      if (trigger.time.after) {
        const [ah, am] = trigger.time.after.split(':').map(Number);
        if (mealMinutes < ah * 60 + am) return false;
      }
    }

    // hasTrainingToday ‚Äî –µ—Å—Ç—å –ª–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è/–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–µ–≥–æ–¥–Ω—è
    if (trigger.hasTrainingToday) {
      const trainings = dayData?.trainings || [];
      if (trainings.length === 0) return false;
    }

    // hadTrainingRecently ‚Äî –±—ã–ª–∞ –ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —á–∞—Å–∞
    if (trigger.hadTrainingRecently) {
      const trainings = dayData?.trainings || [];
      if (trainings.length === 0) return false;

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ ‚Äî –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —á–∞—Å–∞
      const mealTime = time || meal?.time || '12:00';
      const [mealH, mealM] = mealTime.split(':').map(Number);
      const mealMinutes = mealH * 60 + mealM;

      let hasRecentTraining = false;
      for (const tr of trainings) {
        if (!tr.time) continue;
        const [trH, trM] = tr.time.split(':').map(Number);
        const trMinutes = trH * 60 + trM;
        // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –î–û –ø—Ä–∏—ë–º–∞ –ø–∏—â–∏ –∏ –Ω–µ –±–æ–ª–µ–µ 2 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥
        const diffMinutes = mealMinutes - trMinutes;
        if (diffMinutes >= 0 && diffMinutes <= 120) {
          hasRecentTraining = true;
          break;
        }
      }
      if (!hasRecentTraining) return false;
    }

    // hasTrainingAfterMeal ‚Äî —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –ü–û–°–õ–ï —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–∏—ë–º–∞ (1-4 —á–∞—Å–∞)
    if (trigger.hasTrainingAfterMeal) {
      const trainings = dayData?.trainings || [];
      if (trainings.length === 0) return false;

      const mealTime = time || meal?.time || '12:00';
      const [mealH, mealM] = mealTime.split(':').map(Number);
      const mealMinutes = mealH * 60 + mealM;

      let hasUpcomingTraining = false;
      for (const tr of trainings) {
        if (!tr.time) continue;
        const [trH, trM] = tr.time.split(':').map(Number);
        const trMinutes = trH * 60 + trM;
        // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ü–û–°–õ–ï –ø—Ä–∏—ë–º–∞ –ø–∏—â–∏ (—á–µ—Ä–µ–∑ 1-4 —á–∞—Å–∞)
        const diffMinutes = trMinutes - mealMinutes;
        if (diffMinutes >= 60 && diffMinutes <= 240) {
          hasUpcomingTraining = true;
          break;
        }
      }
      if (!hasUpcomingTraining) return false;
    }

    // highFiber (–¥–Ω–µ–≤–Ω–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å)
    if (trigger.highFiber) {
      const dayFiber = dayData?.dayTot?.fiber || 0;
      if (dayFiber < 25) return false;
    }

    // dayWaterLow
    if (trigger.dayWaterLow) {
      const waterMl = dayData?.waterMl || 0;
      const waterGoal = dayData?.waterGoal || 2000;
      if (waterMl >= waterGoal * 0.5) return false;
    }

    // dayStressHigh
    if (trigger.dayStressHigh) {
      const stress = dayData?.stressAvg || 0;
      if (stress < 6) return false;
    }

    // hasOnlyCarbs
    if (trigger.hasOnlyCarbs) {
      const t = mealTotals || {};
      if (t.prot > 5 || t.fat > 5) return false;
      if (t.carbs < 20) return false;
    }

    return true;
  }

  /**
   * –ù–∞–π—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç—ã –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
   */
  function findRecommendedProducts(recommend, products, currentItems, limit = 3) {
    if (!recommend || !products || products.length === 0) return [];

    const currentIds = new Set((currentItems || []).map(it => it.product_id || it.id));
    const candidates = [];

    // –ü–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
    if (recommend.keywords) {
      for (const product of products) {
        if (currentIds.has(product.id)) continue;
        const name = (product.name || '').toLowerCase();
        for (const keyword of recommend.keywords) {
          if (name.includes(keyword.toLowerCase())) {
            candidates.push({ product, score: 10 });
            break;
          }
        }
      }
    }

    // –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–∏—Å–ø–æ–ª—å–∑—É–µ–º PRODUCT_CATEGORIES)
    if (recommend.categories) {
      const adviceCategories = HEYS.advice?.PRODUCT_CATEGORIES || {};
      for (const product of products) {
        if (currentIds.has(product.id)) continue;
        const name = (product.name || '').toLowerCase();

        for (const catId of recommend.categories) {
          const cat = adviceCategories[catId] || NUTRIENT_KEYWORDS[catId];
          if (!cat?.keywords) continue;

          for (const keyword of cat.keywords) {
            if (name.includes(keyword.toLowerCase())) {
              candidates.push({ product, score: 5 });
              break;
            }
          }
        }
      }
    }

    // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ score
    const seen = new Set();
    const unique = candidates.filter(c => {
      if (seen.has(c.product.id)) return false;
      seen.add(c.product.id);
      return true;
    });

    unique.sort((a, b) => b.score - a.score);
    return unique.slice(0, limit).map(c => c.product);
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –ø–æ—Ä—Ü–∏—é –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞
   */
  function getSmartPortion(product) {
    if (!product) return RECOMMENDED_PORTIONS.default;

    const name = (product.name || '').toLowerCase();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
    if (/—è–π—Ü|–æ–º–ª–µ—Ç|—è–∏—á–Ω/.test(name)) return RECOMMENDED_PORTIONS.eggs;
    if (/—Å—ã—Ä|–ø–∞—Ä–º–µ–∑–∞–Ω|–º–æ—Ü–∞—Ä–µ–ª–ª–∞|–±—Ä—ã–Ω–∑–∞/.test(name)) return RECOMMENDED_PORTIONS.cheese;
    if (/–º–∞—Å–ª–æ/.test(name)) return RECOMMENDED_PORTIONS.oil;
    if (/–º–æ–ª–æ–∫–æ|–∫–µ—Ñ–∏—Ä|–π–æ–≥—É—Ä—Ç|—Ä—è–∂–µ–Ω–∫–∞/.test(name)) return RECOMMENDED_PORTIONS.dairy;
    if (/–∫—É—Ä–∏—Ü–∞|–≥–æ–≤—è–¥–∏–Ω–∞|—Å–≤–∏–Ω–∏–Ω–∞|–∏–Ω–¥–µ–π–∫–∞|—Ä—ã–±–∞|–ª–æ—Å–æ—Å—å|—Ç—É–Ω–µ—Ü|–º–∏–Ω—Ç–∞–π/.test(name)) return RECOMMENDED_PORTIONS.protein;
    if (/–æ—Ä–µ—Ö|–º–∏–Ω–¥–∞–ª—å|–∫–µ—à—å—é|—Ñ—É–Ω–¥—É–∫|–≥—Ä–µ—Ü–∫/.test(name)) return RECOMMENDED_PORTIONS.nuts;
    if (/–≥—Ä–µ—á–∫–∞|—Ä–∏—Å|–æ–≤—Å—è–Ω–∫–∞|–º–∞–∫–∞—Ä–æ–Ω|–ø–∞—Å—Ç–∞/.test(name)) return RECOMMENDED_PORTIONS.grains;
    if (/–±–∞–Ω–∞–Ω|—è–±–ª–æ–∫–æ|–∞–ø–µ–ª—å—Å–∏–Ω|–≥—Ä—É—à–∞|–ø–µ—Ä—Å–∏–∫/.test(name)) return RECOMMENDED_PORTIONS.fruits;
    if (/—Å–∞–ª–∞—Ç|–æ–≥—É—Ä–µ—Ü|–ø–æ–º–∏–¥–æ—Ä|–∫–∞–ø—É—Å—Ç–∞|–±—Ä–æ–∫–∫–æ–ª–∏|—à–ø–∏–Ω–∞—Ç/.test(name)) return RECOMMENDED_PORTIONS.vegetables;
    if (/—É–∫—Ä–æ–ø|–ø–µ—Ç—Ä—É—à–∫–∞|–±–∞–∑–∏–ª–∏–∫|–∫–∏–Ω–∑–∞|–∑–µ–ª–µ–Ω—å/.test(name)) return RECOMMENDED_PORTIONS.greens;
    if (/—Å–æ—É—Å|–∫–µ—Ç—á—É–ø|–º–∞–π–æ–Ω–µ–∑/.test(name)) return RECOMMENDED_PORTIONS.sauce;

    return RECOMMENDED_PORTIONS.default;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // CONTEXTUAL RECOMMENDATIONS ‚Äî –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –°–¥–µ–ª–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–π ‚Äî —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
   */
  function makeContextualRecommendation(rule, context, recommendedProducts) {
    const { meal, mealTotals, mealNutrients } = context;
    const items = meal?.items || [];

    // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –ø—Ä–∏—ë–º–µ (–ø–µ—Ä–≤—ã–µ 2 –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏)
    const productNames = items.slice(0, 2).map(it => {
      const name = it.name || '';
      // –°–æ–∫—Ä–∞—â–∞–µ–º –¥–ª–∏–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
      return name.length > 20 ? name.substring(0, 18) + '...' : name;
    });
    const mainProduct = productNames[0] || '–ø—Ä–∏—ë–º';
    const hasMultiple = items.length > 1;

    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
    const recProduct = recommendedProducts[0]?.name || '';
    const recShort = recProduct.length > 15 ? recProduct.substring(0, 13) + '...' : recProduct;

    // –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞
    const contextTemplates = {
      // SYNERGY
      'iron_vitc': {
        title: `–ö ${mainProduct} –¥–æ–±–∞–≤—å –≤–∏—Ç–∞–º–∏–Ω C`,
        reason: `${recShort || '–õ–∏–º–æ–Ω/–ø–µ—Ä–µ—Ü'} ‚Äî –∂–µ–ª–µ–∑–æ —É—Å–≤–æ–∏—Ç—Å—è –≤ 6 —Ä–∞–∑ –ª—É—á—à–µ`
      },
      'calcium_vitd': {
        title: `–í–∏—Ç–∞–º–∏–Ω D –∫ ${mainProduct}`,
        reason: `${recShort || '–Ø–π—Ü–æ/—Ä—ã–±–∞'} —É—Å–∏–ª–∏—Ç —É—Å–≤–æ–µ–Ω–∏–µ –∫–∞–ª—å—Ü–∏—è`
      },
      'fat_vitamins': {
        title: `–ú–∞—Å–ª–æ –∫ ${mainProduct}`,
        reason: `–ö–∞—Ä–æ—Ç–∏–Ω—ã –∏–∑ –æ–≤–æ—â–µ–π —É—Å–≤–∞–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å –∂–∏—Ä–∞–º–∏`
      },
      'plant_protein': {
        title: `–ë–æ–±–æ–≤—ã–µ –∫ ${mainProduct}`,
        reason: `${recShort || '–§–∞—Å–æ–ª—å/—á–µ—á–µ–≤–∏—Ü–∞'} ‚Äî –ø–æ–ª–Ω—ã–π –±–µ–ª–æ–∫ –≤–º–µ—Å—Ç–µ —Å –∫—Ä—É–ø–æ–π`
      },
      'turmeric_pepper': {
        title: `–ß—ë—Ä–Ω—ã–π –ø–µ—Ä–µ—Ü –∫ –∫—É—Ä–∫—É–º–µ`,
        reason: `–£—Å–≤–æ–µ–Ω–∏–µ –∫—É—Ä–∫—É–º–∏–Ω–∞ –≤—ã—Ä–∞—Å—Ç–µ—Ç –≤ 20 —Ä–∞–∑`
      },
      'tomato_fat': {
        title: `–ú–∞—Å–ª–æ –∫ —Ç–æ–º–∞—Ç–∞–º`,
        reason: `–õ–∏–∫–æ–ø–∏–Ω —É—Å–≤–æ–∏—Ç—Å—è –≤ 4 —Ä–∞–∑–∞ –ª—É—á—à–µ —Å –∂–∏—Ä–∞–º–∏`
      },
      'tea_no_milk': {
        title: `–ú–æ–ª–æ–∫–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç —á–∞–π`,
        reason: `–ö–∞–∑–µ–∏–Ω —Å–≤—è–∑—ã–≤–∞–µ—Ç –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç—ã ‚Äî –ø–µ–π –æ—Ç–¥–µ–ª—å–Ω–æ`
      },
      'coffee_iron': {
        title: `–ö–æ—Ñ–µ —Å–Ω–∏–∂–∞–µ—Ç —É—Å–≤–æ–µ–Ω–∏–µ –∂–µ–ª–µ–∑–∞`,
        reason: `–ü–æ–¥–æ–∂–¥–∏ 1-2 —á–∞—Å–∞ –ø–æ—Å–ª–µ ${mainProduct}`
      },
      'fiber_minerals': {
        title: `–ú–Ω–æ–≥–æ –∫–ª–µ—Ç—á–∞—Ç–∫–∏ = –º–µ–Ω—å—à–µ —Ü–∏–Ω–∫–∞`,
        reason: `–§–∏—Ç–∞—Ç—ã —Å–≤—è–∑—ã–≤–∞—é—Ç –º–∏–Ω–µ—Ä–∞–ª—ã`
      },

      // BALANCE
      'need_protein': {
        title: `–ú–∞–ª–æ –±–µ–ª–∫–∞ –≤ ${mainProduct}`,
        reason: `–¢–æ–ª—å–∫–æ ${Math.round((mealTotals?.prot || 0) * 4 / (mealTotals?.kcal || 1) * 100)}% –∫–∞–ª–æ—Ä–∏–π –∏–∑ –±–µ–ª–∫–∞ ‚Äî –¥–æ–±–∞–≤—å ${recShort || '—è–π—Ü–æ/—Ç–≤–æ—Ä–æ–≥'}`
      },
      'need_fiber': {
        title: `–î–æ–±–∞–≤—å –∫–ª–µ—Ç—á–∞—Ç–∫—É –∫ ${mainProduct}`,
        reason: `–í—Å–µ–≥–æ ${Math.round(mealTotals?.fiber || 0)}–≥ ‚Äî –Ω—É–∂–Ω–æ ${recShort || '–æ–≤–æ—â–∏/—Å–∞–ª–∞—Ç'}`
      },
      'need_healthy_fat': {
        title: `–£–ª—É—á—à–∏ –∂–∏—Ä—ã –≤ ${mainProduct}`,
        reason: `–ó–∞–º–µ–Ω–∏ –Ω–∞ ${recShort || '–∞–≤–æ–∫–∞–¥–æ/–æ—Ä–µ—Ö–∏/–æ–ª–∏–≤–∫–æ–≤–æ–µ'}`
      },
      'too_much_simple': {
        title: `${Math.round((mealTotals?.simple || 0) / (mealTotals?.carbs || 1) * 100)}% ‚Äî –ø—Ä–æ—Å—Ç—ã–µ —É–≥–ª–µ–≤–æ–¥—ã`,
        reason: `–î–æ–±–∞–≤—å ${recShort || '–±–µ–ª–æ–∫/–∫–ª–µ—Ç—á–∞—Ç–∫—É'} ‚Äî —Å–≥–ª–∞–¥–∏—Ç —Å–∫–∞—á–æ–∫ —Å–∞—Ö–∞—Ä–∞`
      },

      // TIMING
      'protein_leucine': {
        title: `–ï—â—ë ${30 - Math.round(mealTotals?.prot || 0)}–≥ –±–µ–ª–∫–∞ –¥–æ –æ–ø—Ç–∏–º—É–º–∞`,
        reason: `${recShort || '–Ø–π—Ü–æ/—Ç–≤–æ—Ä–æ–≥'} ‚Äî –¥–æ—Å—Ç–∏–≥–Ω–µ—à—å –ª–µ–π—Ü–∏–Ω–æ–≤–æ–≥–æ –ø–æ—Ä–æ–≥–∞`
      },
      'gi_balance': {
        title: `–í—ã—Å–æ–∫–∏–π –ì–ò (${Math.round(context.avgGI || 0)}) –≤ ${mainProduct}`,
        reason: `${recShort || '–û–≤–æ—â–∏/—Å–∞–ª–∞—Ç'} —Å–Ω–∏–∑—è—Ç —Å–∫–∞—á–æ–∫ —Å–∞—Ö–∞—Ä–∞`
      },
      'evening_protein': {
        title: `–î–æ–±–∞–≤—å –∫–∞–∑–µ–∏–Ω –Ω–∞ –Ω–æ—á—å`,
        reason: `${recShort || '–¢–≤–æ—Ä–æ–≥'} ‚Äî –º–µ–¥–ª–µ–Ω–Ω—ã–π –±–µ–ª–æ–∫ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è`
      },
      'preworkout_carbs': {
        title: `–£–≥–ª–µ–≤–æ–¥—ã –ø–µ—Ä–µ–¥ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–æ–π`,
        reason: `${recShort || '–ë–∞–Ω–∞–Ω/–æ–≤—Å—è–Ω–∫–∞'} ‚Äî —Ç–æ–ø–ª–∏–≤–æ –¥–ª—è –º—ã—à—Ü`
      },
      'postworkout_protein': {
        title: `–ë–µ–ª–æ–∫ –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤–∞–∂–µ–Ω`,
        reason: `${recShort || '–ö—É—Ä–∏—Ü–∞/—è–π—Ü–æ'} ‚Äî –æ–∫–Ω–æ –∞–Ω–∞–±–æ–ª–∏–∑–º–∞ 2 —á–∞—Å–∞`
      },
      'carbs_protein_combo': {
        title: `–ö ${mainProduct} –¥–æ–±–∞–≤—å –±–µ–ª–æ–∫`,
        reason: `${recShort || '–Ø–π—Ü–æ/—Ç–≤–æ—Ä–æ–≥'} ‚Äî –¥–æ–ª—å—à–µ –Ω–∞—Å—ã—Ç–∏—Ç`
      },
      'simple_carbs_high': {
        title: `–ú–Ω–æ–≥–æ —Å–∞—Ö–∞—Ä–∞ (${Math.round(mealTotals?.simple || 0)}–≥)`,
        reason: `${recShort || '–û—Ä–µ—Ö–∏/–±–µ–ª–æ–∫'} –∑–∞–º–µ–¥–ª—è—Ç –≤—Å–∞—Å—ã–≤–∞–Ω–∏–µ`
      },
      'breakfast_protein': {
        title: `–ë–µ–ª–æ–∫ –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫`,
        reason: `${recShort || '–Ø–π—Ü–æ/—Ç–≤–æ—Ä–æ–≥'} ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –¥–æ –æ–±–µ–¥–∞`
      },
      'omega3_recovery': {
        title: `–û–º–µ–≥–∞-3 –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è`,
        reason: `${recShort || '–õ–æ—Å–æ—Å—å/–ª—å–Ω—è–Ω–æ–µ'} ‚Äî —Å–Ω–∏–∑–∏—Ç –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏`
      },
      'magnesium_stress': {
        title: `–ú–∞–≥–Ω–∏–π –ø—Ä–∏ —Å—Ç—Ä–µ—Å—Å–µ`,
        reason: `${recShort || '–ú–∏–Ω–¥–∞–ª—å/–∞–≤–æ–∫–∞–¥–æ'} ‚Äî —Å–Ω–∏–∑–∏—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª`
      },
      'late_carbs': {
        title: `–ü–æ–∑–¥–Ω–∏–µ —É–≥–ª–µ–≤–æ–¥—ã (${Math.round(mealTotals?.carbs || 0)}–≥)`,
        reason: `–í–µ—á–µ—Ä–æ–º –ª—É—á—à–µ –±–µ–ª–æ–∫ + –∂–∏—Ä—ã ‚Äî –∏–Ω—Å—É–ª–∏–Ω —Å–Ω–∏–∂–µ–Ω`
      },
      'morning_fat': {
        title: `–î–æ–±–∞–≤—å –∂–∏—Ä—ã –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫`,
        reason: `${recShort || '–ê–≤–æ–∫–∞–¥–æ/–æ—Ä–µ—Ö–∏'} ‚Äî —Å—ã—Ç–æ—Å—Ç—å –¥–æ –æ–±–µ–¥–∞`
      },
      'afternoon_slump': {
        title: `–í—ã—Å–æ–∫–∏–π –ì–ò –ø–æ—Å–ª–µ –æ–±–µ–¥–∞`,
        reason: `${recShort || '–û—Ä–µ—Ö–∏/–±–µ–ª–æ–∫'} ‚Äî –∏–∑–±–µ–∂–∏—à—å —Å–æ–Ω–ª–∏–≤–æ—Å—Ç–∏`
      },

      // –†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ë–ï–õ–ö–ê
      'protein_distribution': {
        title: `–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏ –±–µ–ª–æ–∫ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ`,
        reason: `${Math.round(mealTotals?.prot || 0)}–≥ ‚Äî –º–Ω–æ–≥–æ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø—Ä–∏—ë–º–∞, –æ–ø—Ç–∏–º—É–º 20-40–≥`
      },
      'protein_variety': {
        title: `–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –±–µ–ª–∫–∞`,
        reason: `${recShort || '–†—ã–±–∞/—è–π—Ü–∞/–º–æ–ª–æ—á–∫–∞'} ‚Äî —Ä–∞–∑–Ω—ã–µ –∞–º–∏–Ω–æ–∫–∏—Å–ª–æ—Ç—ã`
      },

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // –ù–û–í–´–ï –ù–ê–£–ß–ù–´–ï –ü–†–ê–í–ò–õ–ê (2025-12-10)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

      // –î–û–ë–ê–í–ö–ò –ò –í–ò–¢–ê–ú–ò–ù–´
      'fat_meal_vitd': {
        title: `–í—ã–ø–µ–π –≤–∏—Ç–∞–º–∏–Ω D —Å —ç—Ç–∏–º –ø—Ä–∏—ë–º–æ–º`,
        reason: `${Math.round(mealTotals?.fat || 0)}–≥ –∂–∏—Ä–æ–≤ ‚Äî D3 —É—Å–≤–æ–∏—Ç—Å—è –Ω–∞ 32% –ª—É—á—à–µ`
      },
      'evening_magnesium': {
        title: `–•–æ—Ä–æ—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –º–∞–≥–Ω–∏—è`,
        reason: `–í–µ—á–µ—Ä ‚Äî Mg —Ä–∞—Å—Å–ª–∞–±–∏—Ç –º—ã—à—Ü—ã –∏ —É–ª—É—á—à–∏—Ç —Å–æ–Ω`
      },
      'omega3_with_fat': {
        title: `–û—Ç–ª–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –û–º–µ–≥–∞-3`,
        reason: `–° ${Math.round(mealTotals?.fat || 0)}–≥ –∂–∏—Ä–æ–≤ —É—Å–≤–æ–∏—Ç—Å—è –≤ 3√ó –ª—É—á—à–µ`
      },
      'protein_creatine_timing': {
        title: `–ò–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –∫—Ä–µ–∞—Ç–∏–Ω–∞`,
        reason: `${Math.round(mealTotals?.prot || 0)}–≥ –±–µ–ª–∫–∞ + —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ‚Äî —É—Å–≤–æ–µ–Ω–∏–µ +60%`
      },

      // –ö–û–ù–§–õ–ò–ö–¢–´
      'calcium_iron_conflict': {
        title: `‚ö†Ô∏è –ö–∞–ª—å—Ü–∏–π + –∂–µ–ª–µ–∑–æ ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç!`,
        reason: `–í ${mainProduct} –æ–±–∞ –º–∏–Ω–µ—Ä–∞–ª–∞ ‚Äî –∫–∞–ª—å—Ü–∏–π —Å–Ω–∏–∑–∏—Ç —É—Å–≤–æ–µ–Ω–∏–µ Fe –Ω–∞ 50%`
      },
      'coffee_calcium_timing': {
        title: `–ö–æ—Ñ–µ + –º–æ–ª–æ—á–∫–∞ ‚Äî –ø–æ–¥–æ–∂–¥–∏ 2 —á–∞—Å–∞`,
        reason: `–ö–æ—Ñ–µ–∏–Ω –≤—ã–º—ã–≤–∞–µ—Ç –∫–∞–ª—å—Ü–∏–π ‚Äî 6–º–≥ Ca –Ω–∞ 100–º–≥ –∫–æ—Ñ–µ–∏–Ω–∞`
      },
      'green_tea_iron': {
        title: `–ó–µ–ª—ë–Ω—ã–π —á–∞–π –±–ª–æ–∫–∏—Ä—É–µ—Ç –∂–µ–ª–µ–∑–æ`,
        reason: `–¢–∞–Ω–∏–Ω—ã —Å–Ω–∏–∂–∞—é—Ç Fe –Ω–∞ 70% ‚Äî –ø–µ–π —á–µ—Ä–µ–∑ 1—á –ø–æ—Å–ª–µ ${mainProduct}`
      },

      // –í–†–ï–ú–Ø –°–£–¢–û–ö
      'iron_morning_best': {
        title: `–£—Ç—Ä–æ ‚Äî –ª—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –∂–µ–ª–µ–∑–∞`,
        reason: `–ì–µ–ø—Å–∏–¥–∏–Ω –º–∏–Ω–∏–º–∞–ª–µ–Ω ‚Äî Fe –∏–∑ ${mainProduct} —É—Å–≤–æ–∏—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ`
      },
      'late_night_fat': {
        title: `–ú–Ω–æ–≥–æ –∂–∏—Ä–æ–≤ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º`,
        reason: `${Math.round(mealTotals?.fat || 0)}–≥ ‚Äî –∑–∞–º–µ–¥–ª–∏—Ç –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ –Ω–∞ 2-4—á`
      },
      'morning_cortisol': {
        title: `–£—Ç—Ä–æ–º –º–µ–Ω—å—à–µ —Å–∞—Ö–∞—Ä–∞`,
        reason: `${Math.round(mealTotals?.simple || 0)}–≥ –ø—Ä–æ—Å—Ç—ã—Ö + –∫–æ—Ä—Ç–∏–∑–æ–ª = –∏–Ω—Å—É–ª–∏–Ω–æ–≤—ã–µ –∫–∞—á–µ–ª–∏`
      },

      // –°–ò–ù–ï–†–ì–ò–ò –ú–ò–ö–†–û–ù–£–¢–†–ò–ï–ù–¢–û–í
      'magnesium_b6': {
        title: `–ú–∞–≥–Ω–∏–π + B6 ‚Äî —Å–∏–Ω–µ—Ä–≥–∏—è`,
        reason: `${recShort || '–ö—É—Ä–∏—Ü–∞/–±–∞–Ω–∞–Ω'} ‚Äî B6 —É—Å–∏–ª–∏—Ç —É—Å–≤–æ–µ–Ω–∏–µ Mg –Ω–∞ 20%`
      },
      'spinach_lemon': {
        title: `–î–æ–±–∞–≤—å –ª–∏–º–æ–Ω –∫ —à–ø–∏–Ω–∞—Ç—É`,
        reason: `–í–∏—Ç–∞–º–∏–Ω C –Ω–µ–π—Ç—Ä–∞–ª–∏–∑—É–µ—Ç –æ–∫—Å–∞–ª–∞—Ç—ã ‚Äî –∂–µ–ª–µ–∑–æ —É—Å–≤–æ–∏—Ç—Å—è`
      },
      'berries_fat': {
        title: `–ö —è–≥–æ–¥–∞–º ‚Äî –∂–∏—Ä—ã`,
        reason: `${recShort || '–°–ª–∏–≤–∫–∏/—Å–º–µ—Ç–∞–Ω–∞'} ‚Äî –∞–Ω—Ç–æ—Ü–∏–∞–Ω—ã —É—Å–≤–æ—è—Ç—Å—è –ª—É—á—à–µ`
      },

      // –°–ü–ï–¶–ò–§–ò–ß–ù–´–ï –ü–†–û–î–£–ö–¢–´
      'tryptophan_carbs': {
        title: `–¢—Ä–∏–ø—Ç–æ—Ñ–∞–Ω + —É–≥–ª–µ–≤–æ–¥—ã = –º–µ–ª–∞—Ç–æ–Ω–∏–Ω`,
        reason: `${mainProduct} + ${Math.round(mealTotals?.carbs || 0)}–≥ —É–≥–ª–µ–≤–æ–¥–æ–≤ ‚Äî –æ—Ç–ª–∏—á–Ω–æ –¥–ª—è —Å–Ω–∞`
      },
      'collagen_sleep': {
        title: `–ö–æ–ª–ª–∞–≥–µ–Ω –≤–µ—á–µ—Ä–æ–º ‚Äî –æ—Ç–ª–∏—á–Ω–æ!`,
        reason: `–ì–ª–∏—Ü–∏–Ω –≤ –∫–æ–ª–ª–∞–≥–µ–Ω–µ —É–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞`
      },
      'eggs_morning_brain': {
        title: `–•–æ–ª–∏–Ω –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫ ‚Äî –¥–ª—è –º–æ–∑–≥–∞`,
        reason: `–Ø–π—Ü–∞ ‚Üí –∞—Ü–µ—Ç–∏–ª—Ö–æ–ª–∏–Ω ‚Üí –ø–∞–º—è—Ç—å –∏ —Ñ–æ–∫—É—Å –≤–µ—Å—å –¥–µ–Ω—å`
      },
      'avocado_salad': {
        title: `–ò–¥–µ–∞–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è!`,
        reason: `–ñ–∏—Ä—ã –∞–≤–æ–∫–∞–¥–æ √ó4 —É—Å–≤–æ–µ–Ω–∏–µ –∫–∞—Ä–æ—Ç–∏–Ω–æ–∏–¥–æ–≤ –∏–∑ –æ–≤–æ—â–µ–π`
      },

      // –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø
      'zinc_empty_stomach': {
        title: `–¶–∏–Ω–∫ —Å –µ–¥–æ–π, –Ω–µ –Ω–∞—Ç–æ—â–∞–∫`,
        reason: `${Math.round(mealTotals?.kcal || 0)} –∫–∫–∞–ª ‚Äî –º–∞–ª–æ–≤–∞—Ç–æ, Zn –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ç–æ—à–Ω–æ—Ç—É`
      },
      'liver_vita_excess': {
        title: `–ü–µ—á–µ–Ω—å 1-2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é`,
        reason: `–ò–∑–±—ã—Ç–æ–∫ –≤–∏—Ç–∞–º–∏–Ω–∞ A —Ç–æ–∫—Å–∏—á–µ–Ω –ø—Ä–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏`
      },

      // INFO
      'nuts_soaking': {
        title: `–ó–∞–º–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ä–µ—Ö–æ–≤ —É–ª—É—á—à–∞–µ—Ç —É—Å–≤–æ–µ–Ω–∏–µ`,
        reason: `8-12—á –≤ –≤–æ–¥–µ ‚Äî —Ñ–∏—Ç–∞—Ç—ã —Å–Ω–∏–∂–∞—é—Ç—Å—è, –º–∏–Ω–µ—Ä–∞–ª—ã –¥–æ—Å—Ç—É–ø–Ω–µ–µ`
      },
      'probiotic_empty': {
        title: `–ü—Ä–æ–±–∏–æ—Ç–∏–∫–∏ –ª—É—á—à–µ –Ω–∞—Ç–æ—â–∞–∫`,
        reason: `–ò–ª–∏ —á–µ—Ä–µ–∑ 2—á –ø–æ—Å–ª–µ –µ–¥—ã ‚Äî –∂–µ–ª—É–¥–æ—á–Ω—ã–π —Å–æ–∫ —É–±–∏–≤–∞–µ—Ç –±–∞–∫—Ç–µ—Ä–∏–∏`
      },
      'vitc_with_meal': {
        title: `–í–∏—Ç–∞–º–∏–Ω C –ª—É—á—à–µ —Å –µ–¥–æ–π`,
        reason: `–ê—Å–∫–æ—Ä–±–∏–Ω–æ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞ ‚Äî —Å–Ω–∏–∑–∏—Ç—Å—è —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ –∂–µ–ª—É–¥–∫–∞`
      }
    };

    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π —à–∞–±–ª–æ–Ω –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª
    const template = contextTemplates[rule.id];

    if (template) {
      return {
        title: template.title,
        reason: template.reason
      };
    }

    // Fallback ‚Äî –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    let title = rule.title || '';
    let reason = rule.reason || '';

    // –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    reason = reason.replace('{protPct}', Math.round((mealTotals?.prot || 0) * 4 / (mealTotals?.kcal || 1) * 100));
    reason = reason.replace('{fiber}', Math.round(mealTotals?.fiber || 0));
    reason = reason.replace('{simplePct}', Math.round((mealTotals?.simple || 0) / (mealTotals?.carbs || 1) * 100));

    return { title, reason };
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // MAIN API ‚Äî getMealOptimization
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–∏—ë–º–∞ –ø–∏—â–∏
   * @param {Object} params
   * @param {Object} params.meal - –ü—Ä–∏—ë–º –ø–∏—â–∏ { items: [...], time: 'HH:MM' }
   * @param {Object} params.mealTotals - –°—É–º–º—ã –Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤ { kcal, prot, carbs, ... }
   * @param {Object} params.dayData - –î–∞–Ω–Ω—ã–µ –¥–Ω—è { dayTot, trainings, waterMl, ... }
   * @param {Object} params.profile - –ü—Ä–æ—Ñ–∏–ª—å { age, gender, ... }
   * @param {Array} params.products - –ú–∞—Å—Å–∏–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ –±–∞–∑—ã
   * @param {Object} params.pIndex - –ò–Ω–¥–µ–∫—Å –ø—Ä–æ–¥—É–∫—Ç–æ–≤
   * @returns {Array} –ú–∞—Å—Å–∏–≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
   */
  function getMealOptimization(params) {
    const { meal, mealTotals, dayData, profile, products, pIndex, avgGI } = params;

    if (!meal?.items || meal.items.length === 0) return [];

    // –°–æ–±–∏—Ä–∞–µ–º –Ω—É—Ç—Ä–∏–µ–Ω—Ç—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –ø—Ä–∏—ë–º–µ
    const mealNutrients = new Set();
    const mealCategories = new Set();

    for (const item of meal.items) {
      const name = item.name || '';

      // –ù—É—Ç—Ä–∏–µ–Ω—Ç—ã
      const nutrients = detectNutrients(name);
      nutrients.forEach(n => mealNutrients.add(n));

      // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
      const cats = detectCategories({ name });
      cats.forEach(c => mealCategories.add(c));
    }

    const context = {
      meal,
      mealTotals: mealTotals || {},
      mealNutrients: Array.from(mealNutrients),
      mealCategories: Array.from(mealCategories),
      dayData: dayData || {},
      profile: profile || {},
      products: products || [],
      pIndex,
      avgGI: avgGI || 50,
      time: meal.time
    };

    const recommendations = [];

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞
    const allRules = [...SYNERGY_RULES, ...BALANCE_RULES, ...TIMING_RULES];

    for (const rule of allRules) {
      if (checkTrigger(rule.trigger, context)) {
        // –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º –ø—Ä–æ–¥—É–∫—Ç—ã –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        let recProducts = [];
        if (rule.recommend && products && products.length > 0) {
          recProducts = findRecommendedProducts(
            rule.recommend,
            products,
            meal.items,
            3
          );

          // –î–æ–±–∞–≤–ª—è–µ–º smart portion –∫ –∫–∞–∂–¥–æ–º—É –ø—Ä–æ–¥—É–∫—Ç—É
          recProducts = recProducts.map(p => ({
            ...p,
            smartPortion: getSmartPortion(p)
          }));
        }

        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
        const contextual = makeContextualRecommendation(rule, context, recProducts);

        const rec = {
          id: rule.id,
          priority: rule.priority || 50,
          icon: rule.icon,
          title: contextual.title,
          reason: contextual.reason,
          science: rule.science,
          isWarning: rule.isWarning || false,
          isInfo: rule.isInfo || false,
          mild: rule.mild || false,
          products: recProducts
        };

        recommendations.push(rec);
      }
    }

    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (–≤—ã—à–µ = –≤–∞–∂–Ω–µ–µ)
    recommendations.sort((a, b) => b.priority - a.priority);

    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (max 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π)
    return recommendations.slice(0, 5);
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // USER ACTIONS TRACKING ‚Äî –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  const ACTIONS_KEY = 'heys_meal_optimizer_actions';
  const MAX_ACTIONS = 1000; // –õ–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π
  const MAX_AGE_DAYS = 30; // –£–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π

  /**
   * –ó–∞–ø–∏—Å–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   */
  function trackUserAction(action) {
    try {
      let actions = U.lsGet ? U.lsGet(ACTIONS_KEY, []) : JSON.parse(localStorage.getItem(ACTIONS_KEY) || '[]');

      // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
      const cutoff = Date.now() - (MAX_AGE_DAYS * 24 * 60 * 60 * 1000);
      actions = actions.filter(a => (a.timestamp || 0) > cutoff);

      actions.push({
        ...action,
        timestamp: Date.now()
      });

      // –•—Ä–∞–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ MAX_ACTIONS –¥–µ–π—Å—Ç–≤–∏–π
      const trimmed = actions.slice(-MAX_ACTIONS);

      if (U.lsSet) {
        U.lsSet(ACTIONS_KEY, trimmed);
      } else {
        localStorage.setItem(ACTIONS_KEY, JSON.stringify(trimmed));
      }
    } catch (e) {
      console.warn('[MealOptimizer] Failed to track action:', e);
    }
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
   */
  function getActionStats() {
    try {
      const actions = U.lsGet ? U.lsGet(ACTIONS_KEY, []) : JSON.parse(localStorage.getItem(ACTIONS_KEY) || '[]');

      const stats = {
        acceptedRules: {},
        dismissedRules: {},
        addedProducts: {},
        totalAccepted: 0,
        totalDismissed: 0
      };

      for (const action of actions) {
        if (action.type === 'accept') {
          stats.acceptedRules[action.ruleId] = (stats.acceptedRules[action.ruleId] || 0) + 1;
          stats.totalAccepted++;
          if (action.productId) {
            stats.addedProducts[action.productId] = (stats.addedProducts[action.productId] || 0) + 1;
          }
        } else if (action.type === 'dismiss') {
          stats.dismissedRules[action.ruleId] = (stats.dismissedRules[action.ruleId] || 0) + 1;
          stats.totalDismissed++;
        }
      }

      return stats;
    } catch (e) {
      return { acceptedRules: {}, dismissedRules: {}, addedProducts: {}, totalAccepted: 0, totalDismissed: 0 };
    }
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ —Å–∫—Ä—ã—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é (—Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è)
   */
  function shouldHideRecommendation(ruleId) {
    const stats = getActionStats();
    const dismissed = stats.dismissedRules[ruleId] || 0;
    const accepted = stats.acceptedRules[ruleId] || 0;

    // –ï—Å–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ 5+ —Ä–∞–∑ –∏ –ø—Ä–∏–Ω—è—Ç–æ –º–µ–Ω—å—à–µ 20% ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º
    if (dismissed >= 5 && accepted / (dismissed + accepted) < 0.2) {
      return true;
    }

    return false;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // EXPORT
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  HEYS.MealOptimizer = {
    // Main API
    getMealOptimization,

    // Helpers
    detectNutrients,
    detectCategories,
    getSmartPortion,
    findRecommendedProducts,

    // Tracking
    trackUserAction,
    getActionStats,
    shouldHideRecommendation,

    // Constants (for debugging/extension)
    NUTRIENT_KEYWORDS,
    RECOMMENDED_PORTIONS,
    SYNERGY_RULES,
    BALANCE_RULES,
    TIMING_RULES,

    // Version
    VERSION: '1.0.0'
  };

  // Verbose init log removed

})(typeof window !== 'undefined' ? window : global);
