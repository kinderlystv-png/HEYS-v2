const fs = require('fs');
const path = require('path');

const ROOT = process.cwd();
const OUT_FILE = path.join(ROOT, 'heys_day_bundle_v1.js');

const modules = [
    { file: 'day/_advice.js', label: 'day/_advice.js' },
    { file: 'heys_day_meals_bundle_v1.js', label: 'heys_day_meals_bundle_v1.js' }
];

const banner = [
    '// heys_day_bundle_v1.js — bundled day modules (advice + meals bundle)',
    '// ⚠️ Auto-generated by scripts/bundle-day.cjs. Do not edit manually.',
    ''
].join('\n');

const chunks = [banner];

modules.forEach((mod) => {
    const srcPath = path.join(ROOT, mod.file);
    if (!fs.existsSync(srcPath)) {
        throw new Error(`[bundle-day] Missing source file: ${mod.file}`);
    }

    const raw = fs.readFileSync(srcPath, 'utf8');
    const content = raw.trimEnd();
    const safeContent = content.startsWith(';') ? content : `;${content}`;

    chunks.push(`// ===== Begin ${mod.label} =====`);
    chunks.push(safeContent);
    chunks.push(`// ===== End ${mod.label} =====`);
    chunks.push('');
});

fs.writeFileSync(OUT_FILE, chunks.join('\n'), 'utf8');
