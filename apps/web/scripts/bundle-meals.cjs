const fs = require('fs');
const path = require('path');

const ROOT = process.cwd();
const OUT_FILE = path.join(ROOT, 'heys_day_meals_bundle_v1.js');

const modules = [
    { file: 'day/_meal_quality.js', label: 'day/_meal_quality.js' },
    { file: 'heys_day_add_product.js', label: 'heys_day_add_product.js' },
    { file: 'heys_day_meal_optimizer_section.js', label: 'heys_day_meal_optimizer_section.js' },
    { file: 'day/_meals.js', label: 'day/_meals.js' },
    { file: 'heys_day_diary_section.js', label: 'heys_day_diary_section.js' },
    { file: 'heys_day_orphan_alert.js', label: 'heys_day_orphan_alert.js' }
];

const banner = [
    '// heys_day_meals_bundle_v1.js — bundled day meals modules (meal quality, add product, optimizer, meals UI, diary, orphan alert)',
    '// ⚠️ Auto-generated by scripts/bundle-meals.cjs. Do not edit manually.',
    ''
].join('\n');

const chunks = [banner];

modules.forEach((mod) => {
    const srcPath = path.join(ROOT, mod.file);
    if (!fs.existsSync(srcPath)) {
        throw new Error(`[bundle-meals] Missing source file: ${mod.file}`);
    }

    const raw = fs.readFileSync(srcPath, 'utf8');
    const content = raw.trimEnd();
    const safeContent = content.startsWith(';') ? content : `;${content}`;

    chunks.push(`// ===== Begin ${mod.label} =====`);
    chunks.push(safeContent);
    chunks.push(`// ===== End ${mod.label} =====`);
    chunks.push('');
});

fs.writeFileSync(OUT_FILE, chunks.join('\n'), 'utf8');

console.log(`[bundle-meals] ✅ Generated ${OUT_FILE} (${modules.length} modules)`);
