const fs = require('fs');
const path = require('path');

const ROOT = process.cwd();
const OUT_FILE = path.join(ROOT, 'heys_advice_bundle_v1.js');

const modules = [
    { file: 'advice/_core.js', label: 'advice/_core.js' },
    { file: 'advice/_nutrition.js', label: 'advice/_nutrition.js' },
    { file: 'advice/_timing.js', label: 'advice/_timing.js' },
    { file: 'advice/_training.js', label: 'advice/_training.js' },
    { file: 'advice/_emotional.js', label: 'advice/_emotional.js' },
    { file: 'advice/_hydration.js', label: 'advice/_hydration.js' },
    { file: 'advice/_other.js', label: 'advice/_other.js' }
];

const banner = [
    '// heys_advice_bundle_v1.js — bundled advice modules (core + categories)',
    '// ⚠️ Auto-generated by scripts/bundle-advice.cjs. Do not edit manually.',
    ''
].join('\n');

const chunks = [banner];

modules.forEach((mod) => {
    const srcPath = path.join(ROOT, mod.file);
    if (!fs.existsSync(srcPath)) {
        throw new Error(`[bundle-advice] Missing source file: ${mod.file}`);
    }

    const raw = fs.readFileSync(srcPath, 'utf8');
    const content = raw.trimEnd();
    const safeContent = content.startsWith(';') ? content : `;${content}`;

    chunks.push(`// ===== Begin ${mod.label} =====`);
    chunks.push(safeContent);
    chunks.push(`// ===== End ${mod.label} =====`);
    chunks.push('');
});

fs.writeFileSync(OUT_FILE, chunks.join('\n'), 'utf8');
