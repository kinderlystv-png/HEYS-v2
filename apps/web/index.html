<!--
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üó∫Ô∏è –ù–ê–í–ò–ì–ê–¶–ò–û–ù–ù–ê–Ø –ö–ê–†–¢–ê –§–ê–ô–õ–ê index.html (513 —Å—Ç—Ä–æ–∫)                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üìã –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–ê:                                                                       ‚îÇ
‚îÇ                                                                                           ‚îÇ
‚îÇ üìÑ HTML HEAD –ò –ù–ê–°–¢–†–û–ô–ö–ò (—Å—Ç—Ä–æ–∫–∏ 1-20):                                                  ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ DOCTYPE –∏ meta —Ç–µ–≥–∏ (1-6)                                                        ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ CSS —Å—Ç–∏–ª–µ–π (7-8)                                                     ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ Title –∏ viewport (5-6)                                                           ‚îÇ
‚îÇ                                                                                           ‚îÇ
‚îÇ üìö –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ë–ò–ë–õ–ò–û–¢–ï–ö (—Å—Ç—Ä–æ–∫–∏ 21-40):                                                 ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ React –∏ ReactDOM (13-14)                                                         ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ Supabase SDK (15)                                                                ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏                                                              ‚îÇ
‚îÇ                                                                                           ‚îÇ
‚îÇ üß© –û–°–ù–û–í–ù–´–ï –ú–û–î–£–õ–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø (—Å—Ç—Ä–æ–∫–∏ 41-100):                                           ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –°–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (17-22):                                                     ‚îÇ
‚îÇ    ‚îÇ   ‚îú‚îÄ‚îÄ heys_performance_monitor.js (17)                                             ‚îÇ
‚îÇ    ‚îÇ   ‚îú‚îÄ‚îÄ heys_analytics_ui.js (18)                                                    ‚îÇ
‚îÇ    ‚îÇ   ‚îî‚îÄ‚îÄ heys_advanced_error_tracker_v1.js (20)                                       ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –ü–æ–∏—Å–∫ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (23-27):                                                      ‚îÇ
‚îÇ    ‚îÇ   ‚îú‚îÄ‚îÄ heys_smart_search_with_typos_v1.js (21)                                      ‚îÇ
‚îÇ    ‚îÇ   ‚îú‚îÄ‚îÄ modern-search-integration.js (27)                                            ‚îÇ
‚îÇ    ‚îÇ   ‚îî‚îÄ‚îÄ heys_integration_layer_v1.js (26)                                            ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫ (24-28):                                                        ‚îÇ
‚îÇ        ‚îú‚îÄ‚îÄ heys_storage_indexeddb_v1.js (24)                                            ‚îÇ
‚îÇ        ‚îî‚îÄ‚îÄ heys_worker_manager_v1.js (25)                                               ‚îÇ
‚îÇ                                                                                           ‚îÇ
‚îÇ üèõÔ∏è –û–°–ù–û–í–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ HEYS (—Å—Ç—Ä–æ–∫–∏ 101-200):                                           ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –•—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –º–æ–¥–µ–ª–∏ (30-33):                                                      ‚îÇ
‚îÇ    ‚îÇ   ‚îú‚îÄ‚îÄ heys_storage_supabase_v1.js (30)                                             ‚îÇ
‚îÇ    ‚îÇ   ‚îú‚îÄ‚îÄ heys_models_v1.js (31)                                                       ‚îÇ
‚îÇ    ‚îÇ   ‚îî‚îÄ‚îÄ heys_storage_layer_v1.js (32)                                                ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (33-36):                                                     ‚îÇ
‚îÇ    ‚îÇ   ‚îú‚îÄ‚îÄ heys_core_v12.js (33)                                                        ‚îÇ
‚îÇ    ‚îÇ   ‚îú‚îÄ‚îÄ heys_day_v12.js (34)                                                         ‚îÇ
‚îÇ    ‚îÇ   ‚îú‚îÄ‚îÄ heys_user_v12.js (35)                                                        ‚îÇ
‚îÇ    ‚îÇ   ‚îî‚îÄ‚îÄ heys_reports_v12.js (36)                                                     ‚îÇ
‚îÇ                                                                                           ‚îÇ
‚îÇ ‚öõÔ∏è –û–°–ù–û–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï (—Å—Ç—Ä–æ–∫–∏ 201-400):                                                 ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ React hooks –∏ state (42-45)                                                      ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è cloud (46-60)                                                      ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç App (61-150)                                                   ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –°–∏—Å—Ç–µ–º–∞ —Ç–∞–±–æ–≤ (151-250)                                                          ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ UI (251-350)                                                    ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π (351-400)                                                    ‚îÇ
‚îÇ                                                                                           ‚îÇ
‚îÇ üé® –°–¢–ò–õ–ò –ò –§–ò–ù–ê–õ–ò–ó–ê–¶–ò–Ø (—Å—Ç—Ä–æ–∫–∏ 401-513):                                                 ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ CSS —Å—Ç–∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (401-480)                                                  ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ Responsive –¥–∏–∑–∞–π–Ω (481-500)                                                      ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ ReactDOM.render() (501-510)                                                      ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –ó–∞–∫—Ä—ã–≤–∞—é—â–∏–µ —Ç–µ–≥–∏ (511-513)                                                       ‚îÇ
‚îÇ                                                                                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üéØ –ë–´–°–¢–†–´–ô –ü–û–ò–°–ö:                                                                        ‚îÇ
‚îÇ    ‚Ä¢ –ú–æ–¥—É–ª–∏: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (17), –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (18), –ü–æ–∏—Å–∫ (21), –Ø–¥—Ä–æ (33)            ‚îÇ
‚îÇ    ‚Ä¢ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: App (61), TabButton (151), AuthForm (251)                             ‚îÇ
‚îÇ    ‚Ä¢ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: cloud.init (46), ReactDOM.render (501)                             ‚îÇ
‚îÇ    ‚Ä¢ –°—Ç–∏–ª–∏: –û—Å–Ω–æ–≤–Ω—ã–µ (401), –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ (481)                                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
-->

<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>HEYS ‚Äî —Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ (–º–æ–¥—É–ª—å–Ω–∞—è)</title>
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="stylesheet" href="styles/analytics.css" />
  </head>
  <body>
    <div id="root"></div>

    <!-- libs -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

    <!-- app modules (order matters) -->
    <script src="heys_performance_monitor.js"></script>
    <script src="heys_analytics_ui.js"></script>

    <!-- –ù–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ -->
    <script src="heys_advanced_error_tracker_v1.js"></script>
    <script src="heys_smart_search_with_typos_v1.js"></script>

    <!-- Modern Tech Stack -->
    <script src="heys_storage_indexeddb_v1.js"></script>
    <script src="heys_worker_manager_v1.js"></script>
    <script src="heys_integration_layer_v1.js"></script>
    <script src="modern-search-integration.js"></script>

    <!-- Legacy modules (still supported) -->
    <script src="heys_storage_supabase_v1.js?v=15"></script>
    <script src="heys_models_v1.js?v=1"></script>
    <script src="heys_storage_layer_v1.js?v=1"></script>
    <script src="heys_core_v12.js"></script>
    <script src="heys_day_v12.js?v=3"></script>
    <script src="heys_user_v12.js"></script>
    <script src="heys_reports_v12.js"></script>

    <script>
      (function () {
        window.HEYS = window.HEYS || {};
        const React = window.React,
          ReactDOM = window.ReactDOM;
        const { useState, useEffect } = React;

        // init cloud (safe if no cloud module)
        if (window.HEYS.cloud && typeof HEYS.cloud.init === 'function') {
          HEYS.cloud.init({
            url: 'https://ukqolcziqcuplqfgrmsh.supabase.co',
            anonKey:
              'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVrcW9sY3ppcWN1cGxxZmdybXNoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNTE1NDUsImV4cCI6MjA3MDgyNzU0NX0.Nzd8--PyGMJvIHqFoCQKNUOwpxnrAZuslQHtAjcE1Ds',
          });
        }

        // Initialize Modern Tech Stack
        if (window.HEYS.integration) {
          HEYS.integration
            .init()
            .then(() => {
              console.log('üöÄ HEYS Modern Tech Stack –≥–æ—Ç–æ–≤!');

              // Enable performance analytics
              if (HEYS.analytics) {
                HEYS.analytics.trackComponentRender('main_app', performance.now());
              }

              // Setup offline handlers
              HEYS.integration.on('network_offline', () => {
                console.log('üì± –ü–µ—Ä–µ—Ö–æ–¥ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º');
                showNotification('–†–∞–±–æ—Ç–∞–µ–º –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ', 'info');
              });

              HEYS.integration.on('network_online', () => {
                console.log('üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                showNotification('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...', 'success');
              });
            })
            .catch(error => {
              console.warn('‚ö†Ô∏è Modern Tech Stack –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error);
            });
        }

        // Global notification function
        window.showNotification = function (message, type = 'info') {
          const notification = document.createElement('div');
          notification.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 500;
        z-index: 10001;
        transition: all 0.3s ease;
        max-width: 400px;
        text-align: center;
      `;

          const colors = {
            info: { bg: '#bee3f8', color: '#2a69ac' },
            success: { bg: '#c6f6d5', color: '#22543d' },
            warning: { bg: '#faf089', color: '#744210' },
            error: { bg: '#fed7d7', color: '#9b2c2c' },
          };

          const style = colors[type] || colors.info;
          notification.style.backgroundColor = style.bg;
          notification.style.color = style.color;
          notification.textContent = message;

          document.body.appendChild(notification);

          setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transform = 'translateX(-50%) translateY(-20px)';
            setTimeout(() => notification.remove(), 300);
          }, 3000);
        };

        // –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è DayTab: –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ day ‚Äî –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–±–ª–∞–∫–∞
        function DayTabWithCloudSync(props) {
          const { clientId, products } = props;
          const [loading, setLoading] = React.useState(true);
          React.useEffect(() => {
            let cancelled = false;
            const cloud = window.HEYS && window.HEYS.cloud;
            const finish = () => {
              if (!cancelled) setLoading(false);
            };
            if (clientId && cloud && typeof cloud.bootstrapClientSync === 'function') {
              const need =
                typeof cloud.shouldSyncClient === 'function'
                  ? cloud.shouldSyncClient(clientId, 4000)
                  : true;
              if (need) {
                setLoading(true);
                cloud.bootstrapClientSync(clientId).then(finish);
              } else finish();
            } else {
              finish();
            }
            return () => {
              cancelled = true;
            };
          }, [clientId]);
          if (loading)
            return React.createElement(
              'div',
              { className: 'muted', style: { padding: 24 } },
              '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞...'
            );
          return React.createElement(window.HEYS.DayTab, { products });
        }

        // –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è Ration: –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ —Ä–∞—Ü–∏–æ–Ω ‚Äî –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–¥—É–∫—Ç—ã –∏–∑ –æ–±–ª–∞–∫–∞
        function RationTabWithCloudSync(props) {
          const { clientId, setProducts, products } = props;
          const [loading, setLoading] = React.useState(true);
          React.useEffect(() => {
            let cancelled = false;
            if (
              clientId &&
              window.HEYS.cloud &&
              typeof window.HEYS.cloud.bootstrapClientSync === 'function'
            ) {
              setLoading(true);
              window.HEYS.cloud.bootstrapClientSync(clientId).then(() => {
                if (!cancelled) {
                  const loadedProducts = Array.isArray(window.HEYS.utils.lsGet('heys_products', []))
                    ? window.HEYS.utils.lsGet('heys_products', [])
                    : [];
                  setProducts(loadedProducts);
                  setLoading(false);
                }
              });
            } else {
              setLoading(false);
            }
            return () => {
              cancelled = true;
            };
          }, [clientId]);
          if (loading)
            return React.createElement(
              'div',
              { className: 'muted', style: { padding: 24 } },
              '–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞...'
            );
          return React.createElement(window.HEYS.Ration, { products, setProducts });
        }

        // –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è User: –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∏ –∑–æ–Ω—ã –∏–∑ –æ–±–ª–∞–∫–∞
        function UserTabWithCloudSync(props) {
          const { clientId } = props;
          const [loading, setLoading] = React.useState(true);
          React.useEffect(() => {
            let cancelled = false;
            if (
              clientId &&
              window.HEYS.cloud &&
              typeof window.HEYS.cloud.bootstrapClientSync === 'function'
            ) {
              setLoading(true);
              window.HEYS.cloud.bootstrapClientSync(clientId).then(() => {
                if (!cancelled) setLoading(false);
              });
            } else {
              setLoading(false);
            }
            return () => {
              cancelled = true;
            };
          }, [clientId]);
          if (loading)
            return React.createElement(
              'div',
              { className: 'muted', style: { padding: 24 } },
              '–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –∫–ª–∏–µ–Ω—Ç–∞...'
            );
          return React.createElement(window.HEYS.UserTab, {});
        }

        function App() {
          const ONE_CURATOR_MODE = true;
          const [tab, setTab] = useState('ration');
          // ...–≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ useState...
          // useEffect –∞–≤—Ç–æ—Å–º–µ–Ω—ã –∫–ª–∏–µ–Ω—Ç–∞ ‚Äî –Ω–∏–∂–µ –≤—Å–µ—Ö useState!
          const U = window.HEYS.utils || { lsGet: (k, d) => d, lsSet: () => {} };
          const [products, setProducts] = useState([]);
          const [reportsRefresh, setReportsRefresh] = useState(0);

          const cloud = window.HEYS.cloud || {};
          const [status, setStatus] = useState(
            typeof cloud.getStatus === 'function' ? cloud.getStatus() : 'offline'
          );
          const [syncVer, setSyncVer] = useState(0);
          // === Clients (selector + persistence) ===
          const [clients, setClients] = useState([]);
          const [clientId, setClientId] = useState('');
          const [newName, setNewName] = useState('');
          const [cloudUser, setCloudUser] = useState(null);

          // –ü–æ–ª—É—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫—É—Ä–∞—Ç–æ—Ä–∞ –∏–∑ Supabase
          async function fetchClientsFromCloud(curatorId) {
            if (!cloud.client || !curatorId) return [];
            const { data, error } = await cloud.client
              .from('clients')
              .select('id, name')
              .eq('curator_id', curatorId)
              .order('updated_at', { ascending: true });
            if (error) {
              console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤:', error);
              return [];
            }
            return data || [];
          }

          // –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –≤ Supabase
          async function addClientToCloud(name) {
            if (!cloud.client || !cloudUser || !cloudUser.id) {
              console.warn('addClientToCloud: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç client –∏–ª–∏ cloudUser', {
                hasClient: !!cloud.client,
                hasCloudUser: !!cloudUser,
                cloudUserId: cloudUser?.id,
              });
              return;
            }

            const userId = cloudUser.id; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            const { data, error } = await cloud.client
              .from('clients')
              .insert([
                { name: (name || '').trim() || `–ö–ª–∏–µ–Ω—Ç ${clients.length + 1}`, curator_id: userId },
              ])
              .select('id, name')
              .single();
            if (error) {
              console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞:', error);
              alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞: ' + error.message);
              return;
            }
            // –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
            const updated = await fetchClientsFromCloud(userId);
            setClients(updated);
            setClientId(data.id);
          }

          // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ (Supabase)
          async function renameClient(id, name) {
            if (!cloud.client || !cloudUser || !cloudUser.id) return;
            const userId = cloudUser.id; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
            await cloud.client.from('clients').update({ name }).eq('id', id);
            const updated = await fetchClientsFromCloud(userId);
            setClients(updated);
          }

          // –£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ (Supabase)
          async function removeClient(id) {
            if (!cloud.client || !cloudUser || !cloudUser.id) return;
            const userId = cloudUser.id; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
            await cloud.client.from('clients').delete().eq('id', id);
            const updated = await fetchClientsFromCloud(userId);
            setClients(updated);
            if (clientId === id) setClientId('');
          }

          // –ê–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–Ω—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–ª–∏–µ–Ω—Ç–∞
          useEffect(() => {
            if (clientId) setTab('day');
          }, [clientId]);

          // Fallback: –µ—Å–ª–∏ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –ø—Ä–æ–¥—É–∫—Ç—ã –ø—É—Å—Ç—ã–µ, –ø—Ä–æ–±—É–µ–º –≤–∑—è—Ç—å –∏–∑ localStorage —á–µ—Ä–µ–∑ utils
          useEffect(() => {
            if (products.length === 0) {
              try {
                const stored =
                  (window.HEYS &&
                    window.HEYS.utils &&
                    window.HEYS.utils.lsGet &&
                    window.HEYS.utils.lsGet('heys_products', [])) ||
                  [];
                if (Array.isArray(stored) && stored.length) setProducts(stored);
              } catch (e) {}
            }
          }, [products.length]);

          // –ü—Ä–∏ —Å–º–µ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
          useEffect(() => {
            if (clientId) {
              U.lsSet('heys_client_current', clientId);
              window.HEYS = window.HEYS || {};
              window.HEYS.currentClientId = clientId;
              // –ü–æ–¥–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ Supabase –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã
              if (cloud && typeof cloud.bootstrapClientSync === 'function') {
                cloud.bootstrapClientSync(clientId).then(() => {
                  // –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º HEYS.utils.lsGet –¥–ª—è clientId-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
                  const loadedProducts = Array.isArray(window.HEYS.utils.lsGet('heys_products', []))
                    ? window.HEYS.utils.lsGet('heys_products', [])
                    : [];
                  setProducts(loadedProducts);
                  setSyncVer(v => v + 1);
                });
              } else {
                setSyncVer(v => v + 1);
              }
            }
          }, [clientId]);

          // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ –æ–±–ª–∞–∫–∞
          useEffect(() => {
            const handleProductsUpdate = event => {
              const { products } = event.detail;
              setProducts(products);
              setSyncVer(v => v + 1);
            };

            window.addEventListener('heysProductsUpdated', handleProductsUpdate);
            return () => window.removeEventListener('heysProductsUpdated', handleProductsUpdate);
          }, []);

          // –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞ –≤ –æ–±–ª–∞–∫–æ
          window.HEYS = window.HEYS || {};
          window.HEYS.saveClientKey = function (k, v) {
            if (clientId && cloud && typeof cloud.saveClientKey === 'function') {
              cloud.saveClientKey(clientId, k, v);
            }
          };
          // overlay (no early return, to keep hooks order stable)
          // One-time migration of old, namespaced client lists -> global
          // –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫—É—Ä–∞—Ç–æ—Ä–∞
          useEffect(() => {
            if (cloudUser && cloudUser.id) {
              fetchClientsFromCloud(cloudUser.id).then(setClients);
            }
          }, [cloudUser]);

          // –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
          async function createTestClients() {
            if (!cloud.client || !cloudUser || !cloudUser.id) return;
            const userId = cloudUser.id; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
            const testClients = [{ name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤' }, { name: '–ê–Ω–Ω–∞ –°–∏–¥–æ—Ä–æ–≤–∞' }];

            for (const testClient of testClients) {
              try {
                await cloud.client
                  .from('clients')
                  .insert([{ name: testClient.name, curator_id: userId }]);
              } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞:', error);
              }
            }

            // –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
            const updated = await fetchClientsFromCloud(userId);
            setClients(updated);
          }

          const gate = !clientId
            ? React.createElement(
                'div',
                { className: 'modal-backdrop' },
                React.createElement(
                  'div',
                  { className: 'modal' },
                  React.createElement(
                    'div',
                    {
                      className: 'row',
                      style: { justifyContent: 'space-between', marginBottom: '6px' },
                    },
                    React.createElement('div', { style: { fontWeight: 600 } }, '–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞'),
                    React.createElement('span', { className: 'muted' }, `–í—Å–µ–≥–æ: ${clients.length}`)
                  ),
                  React.createElement(
                    'div',
                    { style: { maxHeight: 260, overflow: 'auto', marginBottom: 8 } },
                    clients.length
                      ? clients.map(c =>
                          React.createElement(
                            'div',
                            {
                              key: c.id,
                              className: 'row',
                              style: { justifyContent: 'space-between' },
                            },
                            React.createElement(
                              'div',
                              null,
                              React.createElement('div', { style: { fontWeight: 600 } }, c.name),
                              React.createElement('div', { className: 'muted' }, c.id)
                            ),
                            React.createElement(
                              'div',
                              { className: 'row' },
                              React.createElement(
                                'button',
                                { className: 'btn', onClick: () => setClientId(c.id) },
                                '–í—ã–±—Ä–∞—Ç—å'
                              ),
                              React.createElement(
                                'button',
                                {
                                  className: 'btn',
                                  onClick: () => {
                                    const nm = prompt('–ù–æ–≤–æ–µ –∏–º—è', c.name) || c.name;
                                    renameClient(c.id, nm);
                                  },
                                },
                                '–ü–µ—Ä–µ–∏–º–µ–Ω.'
                              ),
                              React.createElement(
                                'button',
                                {
                                  className: 'btn',
                                  onClick: () => {
                                    if (confirm('–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞?')) removeClient(c.id);
                                  },
                                },
                                '–£–¥–∞–ª–∏—Ç—å'
                              )
                            )
                          )
                        )
                      : React.createElement(
                          'div',
                          { className: 'muted' },
                          '–ï—â—ë –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞'
                        )
                  ),
                  React.createElement(
                    'div',
                    { className: 'row' },
                    React.createElement('input', {
                      placeholder: '–ò–º—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞',
                      value: newName,
                      onChange: e => setNewName(e.target.value),
                    }),
                    React.createElement(
                      'button',
                      { className: 'btn acc', onClick: () => addClientToCloud(newName) },
                      '–°–æ–∑–¥–∞—Ç—å –∏ –≤—ã–±—Ä–∞—Ç—å'
                    )
                  ),
                  React.createElement(
                    'div',
                    { className: 'row', style: { marginTop: 8 } },
                    React.createElement(
                      'button',
                      { className: 'btn secondary', onClick: createTestClients },
                      '–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤'
                    )
                  )
                )
              )
            : null;

          const [email, setEmail] = useState('poplanton@mail.ru');
          const [pwd, setPwd] = useState('007670');

          useEffect(() => {
            if (cloud && typeof cloud.bootstrapSync === 'function') {
              cloud
                .bootstrapSync()
                .then(() => {
                  setStatus(typeof cloud.getStatus === 'function' ? cloud.getStatus() : 'online');
                  setProducts(
                    Array.isArray(U.lsGet('heys_products', [])) ? U.lsGet('heys_products', []) : []
                  );
                  setSyncVer(v => v + 1);
                })
                .catch(() => {
                  setStatus('offline');
                });
            }
          }, []);

          // –ü—Ä–∏ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –ø–∞–Ω–µ–ª–∏ ‚Äî bootstrap –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ –æ–±–ª–∞–∫–∞, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∫–ª–∏–µ–Ω—Ç
          useEffect(() => {
            if (clientId && cloud && typeof cloud.bootstrapClientSync === 'function') {
              cloud.bootstrapClientSync(clientId).then(() => {
                const loadedProducts = Array.isArray(window.HEYS.utils.lsGet('heys_products', []))
                  ? window.HEYS.utils.lsGet('heys_products', [])
                  : [];
                setProducts(loadedProducts);
                setSyncVer(v => v + 1);
              });
            }
          }, [clientId]);

          // debounced save products
          const saveTimerRef = React.useRef(null);
          useEffect(() => {
            if (saveTimerRef.current) clearTimeout(saveTimerRef.current);
            saveTimerRef.current = setTimeout(() => {
              try {
                window.HEYS.saveClientKey('heys_products', products);
              } catch (e) {}
            }, 300);
            return () => {
              if (saveTimerRef.current) {
                clearTimeout(saveTimerRef.current);
                saveTimerRef.current = null;
              }
            };
          }, [products]);

          // auto sign-in in single-curator mode
          useEffect(() => {
            if (ONE_CURATOR_MODE && status !== 'online') {
              doSignIn();
            }
          }, [ONE_CURATOR_MODE, status]);

          async function doSignIn() {
            try {
              if (!email || !pwd) {
                alert('–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å');
                return;
              }
              setStatus('signin');
              if (cloud && typeof cloud.signIn === 'function') {
                const result = await cloud.signIn(email, pwd);
                if (result.error) {
                  alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + (result.error.message || result.error));
                  setStatus('offline');
                  return;
                }
                setCloudUser(result.user);
              }
              setStatus(typeof cloud.getStatus === 'function' ? cloud.getStatus() : 'online');
              // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã –ø–æ—Å–ª–µ sign-in
              const loadedProducts = Array.isArray(U.lsGet('heys_products', []))
                ? U.lsGet('heys_products', [])
                : [];
              setProducts(loadedProducts);
              setSyncVer(v => v + 1);
            } catch (e) {
              setStatus('offline');
              alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + (e && e.message ? e.message : e));
            }
          }
          async function doSignOut() {
            try {
              if (cloud && typeof cloud.signOut === 'function') await cloud.signOut();
            } catch (e) {}
            setStatus(typeof cloud.getStatus === 'function' ? cloud.getStatus() : 'offline');
            setProducts([]);
            setSyncVer(v => v + 1);
          }

          return React.createElement(
            React.Fragment,
            null,
            gate,
            React.createElement(
              'div',
              { className: 'wrap' },
              React.createElement(
                'div',
                { className: 'hdr' },
                React.createElement('div', null, 'HEYS ‚Äî –ø–∞–Ω–µ–ª—å –∫—É—Ä–∞—Ç–æ—Ä–∞'),
                ONE_CURATOR_MODE
                  ? React.createElement(
                      'div',
                      { style: { display: 'flex', alignItems: 'center', gap: '8px' } },
                      React.createElement(
                        'span',
                        { className: 'status ' + (status === 'online' ? 'ok' : 'err') },
                        'cloud: ' + String(status || '')
                      ),
                      window.HEYS.analyticsUI
                        ? React.createElement(window.HEYS.analyticsUI.AnalyticsButton)
                        : null,
                      React.createElement(
                        'button',
                        {
                          className: 'btn',
                          style: {
                            fontSize: '12px',
                            padding: '4px 8px',
                            backgroundColor: '#4299e1',
                            color: 'white',
                          },
                          onClick: () => {
                            if (window.HEYS.integration) {
                              const stats = window.HEYS.integration.getStats();
                              const message =
                                `üöÄ Modern Tech Status:\n` +
                                `IndexedDB: ${stats.capabilities.indexedDB ? '‚úÖ' : '‚ùå'}\n` +
                                `Workers: ${stats.capabilities.webWorkers ? '‚úÖ' : '‚ùå'}\n` +
                                `Service Worker: ${stats.capabilities.serviceWorker ? '‚úÖ' : '‚ùå'}\n` +
                                `Network: ${stats.online ? 'üü¢ Online' : 'üî¥ Offline'}`;
                              alert(message);

                              // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
                              if (stats.capabilities.indexedDB) {
                                window.HEYS.preloadPopularProducts().then(() => {
                                  window.showNotification(
                                    'üöÄ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã!',
                                    'success'
                                  );
                                });
                              }
                            } else {
                              alert('Modern Tech Stack –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                            }
                          },
                        },
                        'üöÄ Modern Tech'
                      )
                    )
                  : React.createElement(
                      'div',
                      { className: 'login' },
                      React.createElement('input', {
                        placeholder: 'email',
                        value: email,
                        onChange: e => setEmail(e.target.value),
                      }),
                      React.createElement('input', {
                        placeholder: '–ø–∞—Ä–æ–ª—å',
                        type: 'password',
                        value: pwd,
                        onChange: e => setPwd(e.target.value),
                      }),
                      React.createElement(
                        'button',
                        { className: 'btn', onClick: doSignIn },
                        '–í–æ–π—Ç–∏'
                      ),
                      React.createElement(
                        'button',
                        { className: 'btn secondary', onClick: doSignOut },
                        '–í—ã–π—Ç–∏'
                      ),
                      React.createElement(
                        'span',
                        { className: 'status ' + (status === 'online' ? 'ok' : 'err') },
                        String(status || '')
                      ),
                      window.HEYS.analyticsUI
                        ? React.createElement(window.HEYS.analyticsUI.AnalyticsButton)
                        : null
                    ),
                React.createElement(
                  'div',
                  { className: 'row' },
                  clientId
                    ? React.createElement(
                        React.Fragment,
                        null,
                        React.createElement(
                          'span',
                          { className: 'muted', style: { marginRight: 8 } },
                          '–ö–ª–∏–µ–Ω—Ç:'
                        ),
                        React.createElement(
                          'span',
                          { style: { fontWeight: 600, marginRight: 8 } },
                          clients.find(c => c.id === clientId)?.name || clientId
                        ),
                        React.createElement(
                          'button',
                          { className: 'btn', onClick: () => setClientId('') },
                          '–°–º–µ–Ω–∏—Ç—å'
                        )
                      )
                    : null
                )
              ),
              React.createElement(
                'div',
                { className: 'tabs' },
                React.createElement(
                  'div',
                  {
                    className: 'tab ' + (tab === 'ration' ? 'active' : ''),
                    onClick: () => setTab('ration'),
                  },
                  '–†–∞—Ü–∏–æ–Ω'
                ),
                React.createElement(
                  'div',
                  {
                    className: 'tab ' + (tab === 'day' ? 'active' : ''),
                    onClick: () => setTab('day'),
                  },
                  '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–Ω—è'
                ),
                React.createElement(
                  'div',
                  {
                    className: 'tab ' + (tab === 'reports' ? 'active' : ''),
                    onClick: () => {
                      setTab('reports');
                      setReportsRefresh(Date.now());
                    },
                  },
                  '–û—Ç—á—ë—Ç–Ω–æ—Å—Ç—å'
                ),
                React.createElement(
                  'div',
                  {
                    className: 'tab ' + (tab === 'user' ? 'active' : ''),
                    onClick: () => setTab('user'),
                  },
                  '–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'
                )
              ),
              tab === 'ration'
                ? React.createElement(RationTabWithCloudSync, {
                    key: 'ration' + syncVer + '_' + String(clientId || ''),
                    products,
                    setProducts,
                    clientId,
                  })
                : tab === 'day'
                  ? React.createElement(DayTabWithCloudSync, {
                      key: 'day' + syncVer + '_' + String(clientId || ''),
                      products,
                      clientId,
                    })
                  : tab === 'user'
                    ? React.createElement(UserTabWithCloudSync, {
                        key: 'user' + syncVer + '_' + String(clientId || ''),
                        clientId,
                      })
                    : React.createElement(window.HEYS.ReportTab, {
                        key:
                          'reports' + syncVer + '_' + String(clientId || '') + '_' + reportsRefresh,
                        products,
                      })
            )
          );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
      })();
    </script>
  </body>
</html>
