<!doctype html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <!-- ÔøΩ Preconnect: DNS+TCP+TLS ahead of time -->
    <link rel="preconnect" href="https://api.heyslab.ru" crossorigin />
    <!-- ÔøΩüîç PWA Debug: Boot timing logger (saved to localStorage for mobile diagnosis) -->
    <script>
        (function () {
            window.__heysBootLog = [];
            window.__heysBootStart = Date.now();
            window.__heysLog = function (msg) {
                var entry = { t: Date.now() - window.__heysBootStart, m: msg };
                window.__heysBootLog.push(entry);
                try {
                    localStorage.setItem('heys_boot_log', JSON.stringify(window.__heysBootLog.slice(-50)));
                } catch (e) { }
                // üîá v4.7.0: BOOT –ª–æ–≥–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã (—Å–º. localStorage.heys_boot_log)
            };
            window.__heysLog('HTML parsing started');

            // ‚è±Ô∏è Boot performance marker ‚Äî logs elapsed time since page load
            window.__heysPerfMark = function (label) {
                if (!window.__heysBootStart) return;
                var elapsed = ((Date.now() - window.__heysBootStart) / 1000).toFixed(1);
                console.info('[PERF] ‚è±Ô∏è +' + elapsed + 's ‚Äî ' + label);
            };
            window.__heysPerfMark('HTML parsing started');

            // üöÄ SPECULATIVE PREFETCH: –∑–∞–ø—É—Å–∫–∞–µ–º –ù–ê–°–¢–û–Ø–©–ò–ô delta fetch –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ HTML
            // –ù–µ –∂–¥—ë–º React (+0.9—Å) ‚Äî –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫ API —Å—Ä–∞–∑—É ‚Üí —ç–∫–æ–Ω–æ–º–∏–º ~1—Å
            // –ï—Å–ª–∏ clientId/lastSyncTs –Ω–µ—Ç ‚Äî fallback –Ω–∞ —Ç—ë–ø–ª—ã–π /health
            try {
                var rawCid = localStorage.getItem('heys_client_current');
                var cid = rawCid ? JSON.parse(rawCid) : null;
                if (cid) {
                    var syncTs = localStorage.getItem('heys_' + cid + '_last_sync_ts');
                    if (syncTs) {
                        var pfUrl = 'https://api.heyslab.ru/rest/v1/client_kv_store'
                            + '?select=k%2Cv%2Cupdated_at'
                            + '&client_id=eq.' + encodeURIComponent(cid)
                            + '&updated_at=gt.' + encodeURIComponent(syncTs)
                            + '&limit=400&offset=0';
                        window.__heysPrefetch = {
                            clientId: cid, since: syncTs,
                            promise: fetch(pfUrl, { mode: 'cors', cache: 'no-store' })
                                .then(function (r) {
                                    if (!r.ok) throw new Error('HTTP ' + r.status);
                                    return r.json();
                                })
                                .then(function (d) {
                                    window.__heysPerfMark && window.__heysPerfMark('Prefetch data ready: ' + (Array.isArray(d) ? d.length : 0) + ' keys');
                                    return { data: d, ok: true };
                                })
                                .catch(function (e) {
                                    return { data: null, ok: false, error: e.message };
                                })
                        };
                    } else {
                        fetch('https://api.heyslab.ru/health', { mode: 'cors', cache: 'no-store' })
                            .then(function () { window.__heysPerfMark && window.__heysPerfMark('CF warm-up done'); })
                            .catch(function () { });
                    }
                } else {
                    fetch('https://api.heyslab.ru/health', { mode: 'cors', cache: 'no-store' })
                        .then(function () { window.__heysPerfMark && window.__heysPerfMark('CF warm-up done'); })
                        .catch(function () { });
                }
            } catch (e) {
                try { fetch('https://api.heyslab.ru/health', { mode: 'cors', cache: 'no-store' }).catch(function () { }); } catch (e2) { }
            }

            // Check if PWA standalone mode
            var isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
            window.__heysLog('PWA standalone: ' + isStandalone);
        })();
    </script>

    <!-- üÜï PWA Recovery: Global pre-React error handler -->
    <script>
        (function () {
            var errorCount = 0;
            var MAX_ERRORS = 3;
            var recoveryShown = false;
            window.__heysRecoveryBusy = false;

            function notifySwBootFailure() {
                if (navigator.serviceWorker && navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ type: 'BOOT_FAILURE' });
                }
            }

            function setRecoveryStatus(text) {
                var statusEl = document.getElementById('heys-recovery-status');
                if (statusEl) statusEl.textContent = text || '';
            }

            function setRecoveryButtonsDisabled(disabled) {
                var reloadBtn = document.getElementById('heys-recovery-reload');
                var clearBtn = document.getElementById('heys-recovery-clear');
                if (reloadBtn) reloadBtn.disabled = !!disabled;
                if (clearBtn) clearBtn.disabled = !!disabled;
            }

            function showRecoveryUI(errorMsg) {
                if (recoveryShown) return;
                recoveryShown = true;
                notifySwBootFailure();
                window.__heysLog && window.__heysLog('[CRITICAL] Recovery UI: ' + errorMsg);

                document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;min-height:100vh;font-family:system-ui;padding:20px;background:#f3f4f6">' +
                    '<div style="background:white;padding:32px;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,0.1);max-width:400px;text-align:center">' +
                    '<div style="font-size:48px;margin-bottom:16px">‚ö†Ô∏è</div>' +
                    '<h2 style="margin:0 0 8px;font-size:20px">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>' +
                    '<p style="margin:0 0 24px;color:#6b7280;font-size:14px">' + (errorMsg || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞') + '</p>' +
                    '<div id="heys-recovery-status" style="margin:0 0 16px;color:#6b7280;font-size:12px"></div>' +
                    '<div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">' +
                    '<button id="heys-recovery-reload" onclick="window.__heysReloadApp && window.__heysReloadApp()" style="padding:12px 24px;border-radius:8px;border:none;background:#10b981;color:white;font-weight:500;cursor:pointer">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>' +
                    '<button id="heys-recovery-clear" onclick="clearCacheAndReload()" style="padding:12px 24px;border-radius:8px;border:1px solid #d1d5db;background:white;color:#374151;font-weight:500;cursor:pointer">üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –∫—ç—à</button>' +
                    '</div></div></div>';
            }

            window.__heysShowRecoveryUI = showRecoveryUI;

            window.__heysReloadApp = function () {
                if (window.__heysRecoveryBusy) return;
                window.__heysRecoveryBusy = true;
                setRecoveryStatus('–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è‚Ä¶');
                setRecoveryButtonsDisabled(true);
                setTimeout(function () {
                    location.reload();
                }, 250);
            };

            window.clearCacheAndReload = async function () {
                if (window.__heysRecoveryBusy) return;
                window.__heysRecoveryBusy = true;
                setRecoveryStatus('–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫‚Ä¶');
                setRecoveryButtonsDisabled(true);
                try {
                    if ('caches' in window) {
                        var names = await caches.keys();
                        await Promise.all(names.map(function (n) { return caches.delete(n); }));
                    }
                    if ('serviceWorker' in navigator) {
                        var regs = await navigator.serviceWorker.getRegistrations();
                        await Promise.all(regs.map(function (r) { return r.unregister(); }));
                    }
                    sessionStorage.clear();
                } catch (e) {
                    window.__heysLog && window.__heysLog('[RECOVERY] cache clear failed: ' + (e && e.message ? e.message : String(e)));
                }
                setTimeout(function () {
                    location.reload();
                }, 350);
            };

            // Global error handler
            window.onerror = function (msg, url, line, col, error) {
                errorCount++;
                window.__heysLog && window.__heysLog('[ERROR] ' + msg + ' at ' + url + ':' + line);

                // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ —Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ recovery
                var isCritical = /React|ReactDOM|HEYS|createRoot|createElement/.test(msg + (error ? error.stack : ''));

                if (isCritical || errorCount >= MAX_ERRORS) {
                    showRecoveryUI(msg);
                    return true; // Suppress error
                }
                return false;
            };

            // Unhandled promise rejections
            window.onunhandledrejection = function (event) {
                errorCount++;
                var reason = event.reason ? (event.reason.message || String(event.reason)) : 'Unknown error';
                window.__heysLog && window.__heysLog('[REJECT] ' + reason);

                if (errorCount >= MAX_ERRORS) {
                    showRecoveryUI(reason);
                }
            };

            // Watchdog: –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä —Å heartbeat
            // –í–º–µ—Å—Ç–æ –∂—ë—Å—Ç–∫–æ–≥–æ 15s cutoff ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 5s,
            // –∏ –∂–¥—ë–º –¥–æ 120s –ø–æ–∫–∞ –µ—Å—Ç—å heartbeat (—Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è)
            // üîÑ v5: —É–≤–µ–ª–∏—á–µ–Ω–æ —Å 60s –¥–æ 120s –¥–ª—è throttled-—Å–µ—Ç–µ–π
            window.__heysLoadingHeartbeat = Date.now();
            var watchdogChecks = 0;
            var WATCHDOG_INTERVAL = 5000;
            var WATCHDOG_MAX_CHECKS = 24; // 120s –º–∞–∫—Å–∏–º—É–º (was 12/60s ‚Äî —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–ª—è slow 3G)
            var WATCHDOG_STALE_MS = 10000; // 10s –±–µ–∑ heartbeat = –∑–∞–≤–∏—Å–ª–æ

            function watchdogCheck() {
                watchdogChecks++;
                if (window.__heysAppReady) {
                    window.__heysPerfMark && window.__heysPerfMark('Watchdog: appReady confirmed');
                    return; // App –∑–∞–≥—Ä—É–∑–∏–ª—Å—è ‚Äî –æ—Ç–ª–∏—á–Ω–æ
                }

                var now = Date.now();
                var heartbeatAge = now - (window.__heysLoadingHeartbeat || 0);
                var totalElapsed = watchdogChecks * WATCHDOG_INTERVAL;

                // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–≤–µ–∂–∏–π heartbeat ‚Äî —Å–∫—Ä–∏–ø—Ç—ã –µ—â—ë –≥—Ä—É–∑—è—Ç—Å—è, –∂–¥—ë–º
                if (heartbeatAge < WATCHDOG_STALE_MS && watchdogChecks < WATCHDOG_MAX_CHECKS) {
                    window.__heysLog && window.__heysLog('[WATCHDOG] Still loading... (' + (totalElapsed / 1000) + 's, heartbeat ' + (heartbeatAge / 1000).toFixed(1) + 's ago)');
                    setTimeout(watchdogCheck, WATCHDOG_INTERVAL);
                    return;
                }

                // Heartbeat —É—Å—Ç–∞—Ä–µ–ª –∏–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –º–∞–∫—Å–∏–º—É–º ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º recovery
                window.__heysLog && window.__heysLog('[WATCHDOG] App not ready after ' + (totalElapsed / 1000) + 's (heartbeat age: ' + (heartbeatAge / 1000).toFixed(1) + 's)');
                if (window.__heysShowRecoveryUI) {
                    window.__heysShowRecoveryUI('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å –∑–∞ ' + (totalElapsed / 1000) + ' —Å–µ–∫—É–Ω–¥');
                }
            }
            setTimeout(watchdogCheck, WATCHDOG_INTERVAL);
        })();
    </script>
    <!-- Global deps loader (used to wait for React safely) -->
    <script>
        (function () {
            window.HEYS = window.HEYS || {};
            window.HEYS.waitForDeps = function (deps, onReady, options) {
                var opts = options || {};
                var timeoutMs = typeof opts.timeoutMs === 'number' ? opts.timeoutMs : 5000;
                var intervalMs = typeof opts.intervalMs === 'number' ? opts.intervalMs : 20;
                var startedAt = Date.now();

                function check() {
                    var missing = (deps || []).filter(function (d) {
                        try {
                            return !(d && typeof d.check === 'function' && d.check());
                        } catch (e) {
                            return true;
                        }
                    });

                    if (missing.length === 0) {
                        if (typeof onReady === 'function') onReady();
                        return;
                    }

                    if (Date.now() - startedAt >= timeoutMs) {
                        var names = missing.map(function (d) { return d && d.name ? d.name : 'unknown'; }).join(', ');
                        window.__heysLog && window.__heysLog('[DEPS] Timeout waiting for: ' + names);
                        if (typeof opts.onTimeout === 'function') {
                            opts.onTimeout(missing);
                        }
                        return;
                    }

                    setTimeout(check, intervalMs);
                }

                check();
            };
        })();
    </script>
    <!-- Prevent FOUC: Apply theme before CSS loads -->
    <script>
        (function () {
            var t = localStorage.getItem('heys_theme');
            var isDark = t === 'dark' || (t === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches);
            if (isDark) document.documentElement.setAttribute('data-theme', 'dark');
            window.__heysLog && window.__heysLog('Theme applied: ' + (isDark ? 'dark' : 'light'));
        })();
    </script>
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>HEYS Nutrition Tracker - Production</title>

    <!-- Tailwind CSS (production-friendly —á–µ—Ä–µ–∑ Vite/PostCSS) -->
    <link rel="stylesheet" href="/styles/tailwind.css" />

    <!-- Critical CSS for instant rendering -->
    <link rel="stylesheet" href="styles/critical.css" />

    <!-- Pattern Debugger CSS (–æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –º–æ–¥–∞–ª–∫–∞ ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ–º async, –Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è FCP) -->
    <link rel="preload" href="insights/pi_pattern_debugger.css?v=2" as="style"
        onload="this.onload=null;this.rel='stylesheet'" />
    <noscript>
        <link rel="stylesheet" href="insights/pi_pattern_debugger.css?v=2" />
    </noscript>

    <!-- HTTP/2 + Resource hints for optimal performance -->
    <!-- cdn.jsdelivr.net –æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è Twemoji (emoji SVG) -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />

    <!-- React —Ç–µ–ø–µ—Ä—å –±–∞–Ω–¥–ª–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Vite (–º–∏–≥—Ä–∞—Ü–∏—è —Å CDN 2026-01-21) -->

    <!-- Resource hints for better caching (prefetch, not preload to avoid warnings) -->
    <link rel="prefetch" href="heys_core_v12.js?v=2" />
    <link rel="prefetch" href="heys_simple_analytics.js" />
    <!-- heys_storage_supabase_v1.js ‚Äî prefetch —É–¥–∞–ª—ë–Ω, —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω—ã–π, SDK —É–¥–∞–ª—ë–Ω -->
    <link rel="prefetch" href="heys_models_v1.js" />

    <!-- Load non-critical CSS asynchronously -->
    <link rel="preload" href="styles/main.css?v=36" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <noscript>
        <link rel="stylesheet" href="styles/main.css?v=36" />
    </noscript>

    <!-- PWA Manifest and Meta Tags -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#2563eb" />

    <!-- PWA Support (iOS + Android) -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="HEYS" />
    <link rel="apple-touch-icon" href="/icon-192.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png" />

    <!-- IW config: loaded externally from /heys-iw-config.json (async fetch + localStorage cache) -->
    <!-- 37KB inline JSON removed ‚Üí improves HTML parse time by ~1-2s on slow 3G -->
    <!-- Fallback: localStorage cache (heys_iw_config_cache_v1) with 24h TTL -->
</head>

<body class="emoji-system">
    <!-- üîç vConsole –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ (–≤–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ ?debug=1 –∏–ª–∏ localStorage heys_debug=1) -->
    <script>
        (function () {
            window.__heysLog && window.__heysLog('Body parsing started');
            var debug = new URLSearchParams(window.location.search).get('debug') === '1' || localStorage.getItem('heys_debug') === '1';
            if (debug) {
                var s = document.createElement('script');
                s.src = 'https://cdn.jsdelivr.net/npm/vconsole@latest/dist/vconsole.min.js';
                s.onload = function () {
                    new window.VConsole({ theme: 'dark' });
                    window.__heysLog && window.__heysLog('vConsole loaded');
                };
                document.head.appendChild(s);
            }
        })();
    </script>
    <div id="root"></div>

    <!-- Emoji style initialization - runs BEFORE twemoji loads -->
    <script>
        (function () {
            // Detect platform - Twemoji only needed on Windows/Linux
            var ua = navigator.userAgent || '';
            var isWindows = /Windows/i.test(ua);
            var isLinux = /Linux/i.test(ua) && !/Android/i.test(ua);
            var needsTwemoji = isWindows || isLinux;

            window.heysPlatformNeedsTwemoji = needsTwemoji;

            // Get stored preference or auto-detect
            var stored = localStorage.getItem('heys_emoji_style');
            if (stored) {
                stored = stored.replace(/"/g, '');
            }

            // Auto mode: use twemoji on Windows/Linux, system on Mac/iOS/Android
            if (!stored || stored === 'auto' || stored === 'android' || stored === 'apple' || stored === 'null') {
                stored = needsTwemoji ? 'twemoji' : 'system';
                localStorage.setItem('heys_emoji_style', stored);
            }

            // Apply class
            document.body.classList.remove('emoji-system', 'emoji-twemoji');
            document.body.classList.add('emoji-' + stored);

            // Global state
            window.twemojiReady = false;
            window.heysEmojiStyle = stored;
            window.applyTwemoji = function () { };
            window.scheduleTwemojiParse = function () { };
        })();
    </script>

    <!-- Twemoji library - load only if needed (async to avoid parser-blocking) -->
    <script>
        if (window.heysPlatformNeedsTwemoji || window.heysEmojiStyle === 'twemoji') {
            (function () {
                var s = document.createElement('script');
                s.src = 'https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js';
                s.async = false; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                s.onload = function () { window.twemojiLoaded = true; };
                document.head.appendChild(s);
            })();
        }
    </script>

    <!-- Twemoji initialization - runs AFTER twemoji loads (only if loaded) -->
    <script>
        (function () {
            // Setup function to initialize Twemoji
            function initTwemoji() {
                if (!window.twemoji) return;

                window.twemojiReady = true;

                var parseTimeout = null;
                var isParsing = false;
                var pendingTarget = null;
                var lastParsedAt = 0;
                var MIN_PARSE_INTERVAL_MS = 120;

                function resolveTwemojiTarget(el) {
                    return el || document.getElementById('root') || document.body;
                }

                function runTwemojiParse(el) {
                    if (window.heysEmojiStyle !== 'twemoji') return;
                    if (!window.twemoji) return;
                    // –ù–µ –ø–∞—Ä—Å–∏—Ç—å —ç–º–æ–¥–∑–∏ –∫–æ–≥–¥–∞ –Ω–µ—Ç —Å–µ—Ç–∏ ‚Äî –∏–Ω–∞—á–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ SVG
                    if (!navigator.onLine) return;

                    // Ensure class is set
                    if (!document.body.classList.contains('emoji-twemoji')) {
                        document.body.classList.add('emoji-twemoji');
                    }

                    var target = resolveTwemojiTarget(el);

                    if (isParsing) {
                        pendingTarget = pendingTarget || target;
                        return;
                    }

                    var now = Date.now();
                    var elapsed = now - lastParsedAt;
                    if (elapsed < MIN_PARSE_INTERVAL_MS) {
                        if (parseTimeout) clearTimeout(parseTimeout);
                        parseTimeout = setTimeout(function () {
                            runTwemojiParse(target);
                        }, MIN_PARSE_INTERVAL_MS - elapsed);
                        return;
                    }

                    isParsing = true;
                    try {
                        twemoji.parse(target, {
                            folder: 'svg',
                            ext: '.svg',
                            base: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/'
                        });
                        lastParsedAt = Date.now();
                    } finally {
                        isParsing = false;
                    }

                    if (pendingTarget) {
                        var nextTarget = pendingTarget;
                        pendingTarget = null;
                        if (parseTimeout) clearTimeout(parseTimeout);
                        parseTimeout = setTimeout(function () {
                            runTwemojiParse(nextTarget);
                        }, MIN_PARSE_INTERVAL_MS);
                    }
                }

                // Apply Twemoji parsing
                window.applyTwemoji = function (el) {
                    runTwemojiParse(el);
                };

                // Debounced parse
                window.scheduleTwemojiParse = function (el) {
                    // –ù–µ —Å—Ç–∞–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä –µ—Å–ª–∏ –Ω–µ—Ç —Å–µ—Ç–∏
                    if (!navigator.onLine) return;
                    if (parseTimeout) clearTimeout(parseTimeout);
                    parseTimeout = setTimeout(function () {
                        runTwemojiParse(el);
                    }, 80);
                };

                // Parse immediately
                window.applyTwemoji(document.getElementById('root') || document.body);

                // MutationObserver for dynamic content
                var observer = new MutationObserver(function (mutations) {
                    var parseTarget = null;

                    for (var i = 0; i < mutations.length; i++) {
                        var m = mutations[i];

                        if (m.type === 'childList' && m.addedNodes && m.addedNodes.length) {
                            for (var j = 0; j < m.addedNodes.length; j++) {
                                var node = m.addedNodes[j];
                                if (node && node.nodeType === 1) {
                                    parseTarget = node;
                                    break;
                                }
                                if (node && node.nodeType === 3 && m.target && m.target.nodeType === 1) {
                                    parseTarget = m.target;
                                    break;
                                }
                            }
                        } else if (m.type === 'characterData' && m.target && m.target.parentElement) {
                            parseTarget = m.target.parentElement;
                        }

                        if (parseTarget) break;
                    }

                    if (parseTarget) {
                        window.scheduleTwemojiParse(parseTarget);
                    }
                });

                // Wait for root to exist
                var startObserver = function () {
                    var root = document.getElementById('root');
                    if (root) {
                        observer.observe(root, { childList: true, subtree: true, characterData: true });
                    } else {
                        setTimeout(startObserver, 10);
                    }
                };
                startObserver();

                // Reparse when back online
                window.addEventListener('online', function () {
                    window.scheduleTwemojiParse(document.getElementById('root') || document.body);
                });

                // One delayed pass after initial React mount
                setTimeout(function () {
                    window.scheduleTwemojiParse(document.getElementById('root') || document.body);
                }, 250);
            }

            // If Twemoji already loaded, init now. Otherwise wait for it.
            if (window.twemoji) {
                initTwemoji();
            } else if (window.heysPlatformNeedsTwemoji || window.heysEmojiStyle === 'twemoji') {
                // Wait for async script to load
                var checkInterval = setInterval(function () {
                    if (window.twemoji) {
                        clearInterval(checkInterval);
                        initTwemoji();
                    }
                }, 20);
                // Timeout after 5s
                setTimeout(function () { clearInterval(checkInterval); }, 5000);
            }
            // Else: not needed, stubs already set
        })();
    </script>

    <!-- libs with defer and priority for optimal loading -->
    <!-- React (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π –±–∞–Ω–¥–ª) - 152-–§–ó compliant, –±–µ–∑ CDN -->
    <!-- –í–ê–ñ–ù–û: –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –°–ò–ù–•–†–û–ù–ù–û –ø–µ—Ä–µ–¥ defer-—Å–∫—Ä–∏–ø—Ç–∞–º–∏ (blocking script) -->
    <!-- –°–æ–±–∏—Ä–∞–µ—Ç—Å—è: npx esbuild src/react-globals-sync.ts --bundle --format=iife --minify -->
    <script src="react-bundle.js"></script>
    <!-- Dark theme interceptor ‚Äî patches React.createElement for CSS var colors -->
    <script src="heys_dark_theme_interceptor.js"></script>
    <!-- Supabase CDN ‚Äî –£–î–ê–õ–Å–ù 2025-12-24 (152-–§–ó compliance)
         –ü—Ä–∏—á–∏–Ω–∞: SDK –¥–µ–ª–∞–ª –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–µ—Ä–∞–º Supabase (–ì–µ—Ä–º–∞–Ω–∏—è), 
         –Ω–∞—Ä—É—à–∞—è —Å—Ç.18 —á.5 152-–§–ó –æ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –ü–î–Ω.
         –ó–∞–º–µ–Ω–∞: YandexAPI (heys_yandex_api_v1.js) ‚Üí api.heyslab.ru
    -->

    <!-- app modules with defer and optimized priority -->
    <script defer src="heys_dev_utils.js"></script>
    <!-- Refactoring Infrastructure (v1.0) -->
    <script defer src="heys_feature_flags_v1.js?v=1"></script>
    <script defer src="heys_module_perf_v1.js?v=1"></script>
    <script defer src="heys_module_loader_v1.js?v=1"></script>
    <!-- Modular App Components (Phase 2) -->
    <script defer src="heys_bootstrap_v1.js?v=1" fetchpriority="high"></script>
    <script defer src="heys_platform_apis_v1.js?v=1"></script>
    <script defer src="heys_pwa_module_v1.js?v=1"></script>
    <script defer src="heys_simple_analytics.js"></script>
    <!-- Smart search with typo correction, synonyms, phonetic (—ë‚Üí–µ) -->
    <script defer src="heys_smart_search_v2.js?v=1"></script>
    <script defer src="heys_shared_products_export_fields_v1.js?v=1"></script>
    <script defer src="heys_export_utils_v1.js?v=1"></script>
    <script defer src="heys_core_v12.js?v=2" fetchpriority="high"></script>
    <!-- Yandex Cloud API adapter (152-–§–ó compliant) - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –î–û supabase –¥–ª—è auth -->
    <script defer src="heys_yandex_api_v1.js?v=6"></script>
    <!-- Cloud sync modularization (Phase refactor) -->
    <script defer src="heys_cloud_merge_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_cloud_storage_utils_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_cloud_shared_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_cloud_queue_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_storage_photos_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_storage_supabase_v1.js?v=63" fetchpriority="low"></script>
    <script defer src="heys_models_v1.js?v=20" fetchpriority="low"></script>
    <script defer src="heys_storage_layer_v1.js?v=20" fetchpriority="low"></script>
    <script defer src="heys_wheel_picker.js?v=20" fetchpriority="low"></script>
    <script defer src="heys_swipeable.js?v=20" fetchpriority="low"></script>
    <script defer src="heys_pull_refresh.js?v=20" fetchpriority="low"></script>
    <!-- Toast Notification System (universal replacement for browser alerts) -->
    <script defer src="heys_toast_v1.js?v=1" fetchpriority="low"></script>
    <!-- Centralized ratio zones logic -->
    <script defer src="heys_ratio_zones_v1.js?v=20" fetchpriority="low"></script>
    <!-- TEF (Thermic Effect of Food) calculation module -->
    <script defer src="heys_tef_v1.js?v=1" fetchpriority="low"></script>
    <!-- TDEE calculation module -->
    <script defer src="heys_tdee_v1.js?v=6" fetchpriority="low"></script>
    <!-- Harm Score v2.0: Scientific Food Harm Assessment System -->
    <script defer src="heys_harm_v1.js?v=1" fetchpriority="low"></script>
    <!-- Sparkline utilities (curves, regression, caching) -->
    <script defer src="heys_sparkline_utils_v1.js?v=20" fetchpriority="low"></script>
    <!-- Shared mini-sparklines -->
    <script defer src="heys_sparklines_shared_v1.js?v=6" fetchpriority="low"></script>
    <!-- Day module split (Phase 2-5) -->
    <script defer src="heys_day_core_bundle_v1.js?v=3" fetchpriority="low"></script>
    <script defer src="heys_day_utils.js?v=3" fetchpriority="low"></script>
    <script defer src="heys_day_pickers.js?v=20" fetchpriority="low"></script>
    <script defer src="heys_day_popups.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_gallery.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_bundle_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_add_product.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_storage_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_sound_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_guards_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_init_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_sleep_effects_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_global_exports_v1.js?v=1" fetchpriority="low"></script>
    <!-- Day module handlers (Phase 10) -->

    <!-- End Day module handlers -->
    <!-- Day helper functions (Phase 11) -->
    <!-- Day effects (Phase 12) -->
    <!-- End Day helper functions -->
    <!-- Day render components (Phase 13A) -->
    <!-- End Day render components -->
    <!-- Day Stats/Water/Activity modules (PR #29 extractions) -->
    <script defer src="heys_day_stats_bundle_loader_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_edit_grams_modal_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_time_mood_picker_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_sparklines_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_sparkline_data_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_caloric_balance_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_insights_data_v1.js?v=5" fetchpriority="low"></script>
    <script defer src="heys_day_insulin_wave_data_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_goal_progress_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_daily_summary_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_pull_refresh_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_offline_sync_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_insulin_wave_ui_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_measurements_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_popups_state_v1.js?v=1" fetchpriority="low"></script>

    <script defer src="heys_day_main_block_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_side_block_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_cycle_card_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_weight_trends_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_picker_modals.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_animations.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_hero_metrics.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_water_state.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_daily_table.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_steps_ui.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_sparkline_state.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_edit_grams_state.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_caloric_display_state.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_page_shell.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_engagement_effects.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_calendar_metrics.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_calendar_block_v1.js?v=2" fetchpriority="low"></script>
    <script defer src="heys_day_mood_sparkline_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_stats_block_v1.js?v=1" fetchpriority="low"></script>

    <script defer src="heys_day_orphan_state_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_nutrition_state_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_runtime_ui_state_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_water_card_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_activity_card_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_energy_context_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_bottom_sheet_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_hero_display_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_rating_averages_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_advice_integration_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_products_context_v1.js?v=1" fetchpriority="low"></script>
    <!-- Diary section (–ü–† #2.3: meal rec card integration) -->
    <script defer src="heys_day_diary_section.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_tab_render_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_day_cycle_state.js" fetchpriority="low"></script>
    <!-- End PR #29 extractions -->
    <!-- Day module: consolidated meals (card/list/display/chart/state/handlers) -->
    <script defer src="day/_meals.js?v=4" fetchpriority="low"></script>
    <!-- End Day module split -->
    <script defer src="heys_day_tab_impl_v1.js?v=5" fetchpriority="low"></script>
    <script defer src="heys_day_v12.js?v=54" fetchpriority="low"></script>
    <script defer src="heys_user_tab_impl_v1.js?v=1" fetchpriority="low"></script>
    <script defer src="heys_user_v12.js?v=20" fetchpriority="low"></script>
    <!-- Auth + Login (client phone+PIN, curator email+password) ‚Äî –Ω—É–∂–Ω—ã –¥–æ React render –¥–ª—è gate –ª–æ–≥–∏–∫–∏ -->
    <script defer src="heys_auth_v1.js?v=3"></script>
    <script defer src="heys_subscription_v1.js?v=1"></script>
    <script defer src="heys_trial_queue_v1.js?v=1"></script>
    <script defer src="heys_paywall_v1.js?v=2"></script>
    <script defer src="heys_login_screen_v1.js?v=2"></script>
    <script defer src="heys_ui_onboarding_v1.js"></script>
    <!-- üöÄ PERF v7.0: Boot chain –ø–µ—Ä–µ–º–µ—â—ë–Ω —Å—é–¥–∞ (–¥–æ reports/widgets).
         React –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–µ–Ω–¥–µ—Ä —Å—Ä–∞–∑—É –∫–∞–∫ –∑–∞–≥—Ä—É–∂–µ–Ω—ã DayTab/UserTab,
         –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å ~11 –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ (~10-15s —ç–∫–æ–Ω–æ–º–∏–∏ –Ω–∞ mid-tier throttle).
         Reports –∏ Widgets –≥—Ä—É–∑—è—Ç—Å—è –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ React —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. -->
    <script defer src="heys_app_hooks_v1.js?v=1"></script>
    <script defer src="heys_app_tabs_v1.js?v=1"></script>
    <script defer src="heys_early_warning_panel_v1.js?v=16"></script>
    <script defer src="heys_gamification_bar_v1.js?v=1"></script>
    <script defer src="heys_app_gates_v1.js?v=1"></script>
    <script defer src="heys_app_shell_v1.js?v=12"></script>
    <script defer src="heys_app_overlays_v1.js?v=1"></script>
    <script defer src="heys_app_gate_flow_v1.js?v=1"></script>
    <script defer src="heys_app_backup_v1.js?v=1"></script>
    <script defer src="heys_app_shortcuts_v1.js?v=1"></script>
    <script defer src="heys_app_onboarding_v1.js?v=1"></script>
    <script defer src="heys_app_auth_init_v1.js?v=1"></script>
    <script defer src="heys_app_client_helpers_v1.js?v=1"></script>
    <script defer src="heys_app_desktop_gate_v1.js?v=1"></script>
    <script defer src="heys_app_morning_checkin_v1.js?v=1"></script>
    <script defer src="heys_app_swipe_nav_v1.js?v=1"></script>
    <script defer src="heys_app_runtime_effects_v1.js?v=1"></script>
    <script defer src="heys_app_sync_effects_v1.js?v=3"></script>
    <script defer src="heys_app_tab_state_v1.js?v=1"></script>
    <script defer src="heys_app_client_management_v1.js?v=1"></script>
    <script defer src="heys_app_backup_actions_v1.js?v=1"></script>
    <script defer src="heys_app_backup_export_v1.js?v=2"></script>
    <script defer src="heys_app_update_checks_v1.js?v=1"></script>
    <script defer src="heys_app_update_notifications_v1.js?v=1"></script>
    <script defer src="heys_app_cloud_init_v1.js?v=1"></script>
    <script defer src="heys_app_client_state_manager_v1.js?v=1"></script>
    <script defer src="heys_app_date_state_v1.js?v=1"></script>
    <script defer src="heys_app_derived_state_v1.js?v=1"></script>
    <script defer src="heys_app_shell_props_v1.js?v=1"></script>
    <script defer src="heys_app_overlays_props_v1.js?v=1"></script>
    <script defer src="heys_app_gate_state_v1.js?v=1"></script>
    <script defer src="heys_app_global_bindings_v1.js?v=1"></script>
    <script defer src="heys_app_backup_state_v1.js?v=1"></script>
    <script defer src="heys_app_banner_state_v1.js?v=1"></script>
    <script defer src="heys_app_client_init_v1.js?v=1"></script>
    <script defer src="heys_app_twemoji_effect_v1.js?v=1"></script>
    <script defer src="heys_app_runtime_state_v1.js?v=1"></script>
    <script defer src="heys_app_core_state_v1.js?v=1"></script>
    <script defer src="heys_app_root_impl_v1.js?v=1"></script>
    <script defer src="heys_app_root_component_v1.js?v=1"></script>
    <script defer src="heys_app_root_v1.js?v=1"></script>
    <script defer src="heys_app_dependency_loader_v1.js?v=2026.02.08"></script>
    <script defer src="heys_app_ui_state_v1.js?v=1"></script>
    <script defer src="heys_app_initialize_v1.js?v=2026.02.08"></script>
    <script defer src="heys_app_entry_v1.js?v=1"
        onerror="window.__heysShowRecoveryUI && window.__heysShowRecoveryUI('CRITICAL_SCRIPT_LOAD: heys_app_entry_v1.js')"></script>
    <script defer src="heys_app_v12.js?v=2026.02.22.1805.8325fa69"
        onerror="window.__heysShowRecoveryUI && window.__heysShowRecoveryUI('CRITICAL_SCRIPT_LOAD: heys_app_v12.js')"></script>

    <!-- üöÄ PERF v8.0: Post-boot –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (–±—ã–ª–æ: v7.1 defer).
         –ü–†–ò–ß–ò–ù–ê –ò–ó–ú–ï–ù–ï–ù–ò–Ø: 70+ <script defer> –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û –Ω–∞ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ,
         –±–ª–æ–∫–∏—Ä—É—è event loop –Ω–∞ ~15s –ü–û–°–õ–ï —É—Å—Ç–∞–Ω–æ–≤–∫–∏ __heysAppReady. setTimeout-watchdog
         –∏ React —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–µ –º–æ–≥–ª–∏ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ–π defer-–æ—á–µ—Ä–µ–¥–∏ ‚Üí appReady +35s.

         –†–ï–®–ï–ù–ò–ï: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–Ω–∂–µ–∫—Ç–∏—Ä—É–µ–º <script> —Ç–µ–≥–∏ –ü–û–°–õ–ï React —Ä–µ–Ω–¥–µ—Ä–∞ (window.__heysAppReady).
         –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–≥–∏ = async –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ –æ–¥–Ω–æ–º—É —á–µ—Ä–µ–∑ onload-—Ü–µ–ø–æ—á–∫—É.
         setTimeout(0) –º–µ–∂–¥—É —Å–∫—Ä–∏–ø—Ç–∞–º–∏ —É—Å—Ç—É–ø–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ event loop (React, watchdog, –≤–≤–æ–¥).

         –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢: appReady ~15-20s –≤–º–µ—Å—Ç–æ 35s (boot chain ~100 defer —Å–∫—Ä–∏–ø—Ç–æ–≤
         –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –∑–∞–Ω–∏–º–∞–µ—Ç ~15-20s ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–º —Å–ø—Ä–∏–Ω—Ç–µ). -->
    <script>
        (function () {
            // –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ post-boot –º–æ–¥—É–ª–µ–π –≤ –ø–æ—Ä—è–¥–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏.
            // –í–ê–ñ–ù–û: –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ defer-—Å–ø–∏—Å–∫–∞ (race conditions).
            var POST_BOOT_SCRIPTS = [
                // Daily missions & Gamification
                'heys_daily_missions_v1.js?v=1',
                'heys_gamification_v1.js?v=22',
                // Advice engine & Meals
                'heys_advice_rules_v1.js?v=1',
                'heys_advice_bundle_v1.js?v=3',
                'heys_meal_optimizer_v1.js?v=20',
                'heys_sounds_v1.js?v=20',
                'heys_expandable_card_v1.js?v=20',
                // Insulin Wave Modules (v4.2.2)
                'heys_iw_shim.js?v=25',
                'heys_iw_patterns.js?v=25',
                'heys_iw_config_loader.js?v=25',
                'heys_iw_constants.js?v=25',
                'heys_iw_utils.js?v=25',
                'heys_iw_lipolysis.js?v=25',
                'heys_iw_v30.js?v=25',
                'heys_iw_v41.js?v=25',
                'heys_iw_calc.js?v=25',
                'heys_iw_orchestrator.js?v=25',
                'heys_iw_graph.js?v=25',
                'heys_iw_ndte.js?v=25',
                'heys_iw_ui.js?v=25',
                'heys_insulin_wave_v1.js?v=25',
                'heys_iw_version_info.js?v=25',
                // Cycle, Refeed, Cascade, Misc
                'heys_cycle_v1.js?v=20',
                'heys_refeed_v1.js?v=20',
                'heys_cascade_card_v1.js?v=4',
                'heys_yesterday_verify_v1.js?v=4',
                'heys_sms_v1.js?v=2',
                'heys_consents_v1.js?v=5',
                'heys_subscriptions_v1.js?v=1',
                'heys_status_v1.js?v=1',
                // Predictive Insights (split modules) v6
                'insights/pi_constants.js?v=44',
                'insights/pi_stats.js?v=7',
                'insights/pi_thresholds.js?v=1',
                'insights/pi_science_info.js?v=7',
                // Pattern modules MUST load before pi_patterns.js (race condition fix)
                'insights/patterns/timing.js?v=2',
                'insights/patterns/sleep.js?v=5',
                'insights/patterns/psychology.js?v=3',
                'insights/patterns/activity.js?v=5',
                'insights/patterns/lifestyle.js?v=4',
                'insights/patterns/body.js?v=2',
                'insights/patterns/training_nutrition.js?v=2',
                'insights/patterns/metabolic.js?v=3',
                'insights/patterns/quality.js?v=3',
                'insights/patterns/micronutrients.js?v=4',
                'insights/pi_patterns.js?v=10',
                'insights/pi_advanced.js?v=12',
                'insights/pi_cache.js?v=1',
                'insights/pi_analytics_api.js?v=7',
                'insights/pi_calculations.js?v=8',
                // Modal Management System
                'heys_modal_manager_v1.js?v=2',
                'heys_step_modal_v1.js?v=20',
                'heys_steps_v1.js?v=21',
                'heys_add_product_step_v1.js?v=25.3',
                'heys_confirm_modal_v1.js?v=20',
                // Insights PI v3.5.0+ Advanced Modules
                'insights/pi_phenotype.js?v=1',
                'insights/pi_causal_chains.js?v=1',
                'insights/pi_early_warning.js?v=44',
                'insights/pi_whatif.js?v=2',
                'insights/pi_ui_phenotype.js?v=1',
                'insights/pi_ui_whatif_scenarios.js?v=6',
                'insights/pi_product_picker.js?v=3.6.0',
                'insights/pi_meal_rec_patterns.js?v=1',
                'insights/pi_meal_planner.js?v=1.3.1',
                'insights/pi_meal_recommender.js?v=3.1',
                'insights/pi_feedback_loop.js?v=3',
                'insights/pi_outcome_modal.js?v=2',
                'insights/pi_meal_rec_feedback.js?v=3',
                'insights/pi_ui_meal_rec_card.js?v=27.5',
                'insights/pi_ui_helpers.js?v=1',
                'insights/pi_ui_rings.js?v=6',
                'insights/pi_ui_cards.js?v=8',
                'insights/pi_ui_whatif.js?v=6',
                'insights/pi_ui_dashboard.js?v=19',
                'insights/pi_pattern_debugger.js?v=27',
                // Predictive Insights bridge + Phenotype + Supplements
                'heys_predictive_insights_v1.js?v=6',
                'heys_phenotype_v1.js?v=2',
                'heys_metabolic_intelligence_v1.js?v=3',
                'heys_supplements_v1.js?v=1',
                'heys_supplements_science_v1.js?v=1',
                // StepModal components + Morning Checkin
                'heys_profile_step_v1.js?v=20',
                'heys_meal_step_v1.js?v=20',
                'heys_training_step_v1.js?v=20',
                'heys_morning_checkin_v1.js?v=20',
                // Reports & Widgets (non-critical)
                'heys_monthly_reports_service_v1.js?v=1',
                'heys_monthly_reports_v1.js?v=1',
                'heys_reports_tab_impl_v1.js?v=1',
                'heys_reports_v12.js?v=20',
                'heys_weekly_reports_v2.js?v=8',
                'heys_data_overview_v1.js?v=20',
                // Widgets Dashboard system
                'heys_widgets_events_v1.js?v=1',
                'heys_widgets_registry_v1.js?v=1',
                'heys_widgets_data_crash_risk_v1.js?v=1',
                'heys_widgets_core_v1.js?v=1',
                'widgets/widget_data.js?v=6',
                'heys_widgets_ui_v1.js?v=4'
            ];

            var idx = 0;
            var total = POST_BOOT_SCRIPTS.length;

            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã –ø–æ –æ–¥–Ω–æ–º—É —á–µ—Ä–µ–∑ onload-—Ü–µ–ø–æ—á–∫—É.
            // onload –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç: —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –ò –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º.
            // setTimeout(0) —É—Å—Ç—É–ø–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ event loop –º–µ–∂–¥—É –∫–∞–∂–¥—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º
            // ‚Üí React —ç—Ñ—Ñ–µ–∫—Ç—ã, –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, watchdog –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ.
            function loadNext() {
                if (idx >= total) {
                    console.info('[HEYS.postboot] ‚úÖ All ' + total + ' post-boot modules loaded');
                    window.__heysPerfMark && window.__heysPerfMark('PostBoot: all ' + total + ' modules loaded');
                    return;
                }
                var src = POST_BOOT_SCRIPTS[idx++];
                var s = document.createElement('script');
                s.src = src;
                s.onload = s.onerror = function () {
                    // Yield to event loop, then load next script
                    setTimeout(loadNext, 0);
                };
                document.head.appendChild(s);
            }

            // –ñ–¥—ë–º window.__heysAppReady (React –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏–ª—Å—è), –ø–æ—Ç–æ–º –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            var waitChecks = 0;
            function waitForAppReady() {
                waitChecks++;
                if (window.__heysAppReady) {
                    console.info('[HEYS.postboot] üöÄ appReady detected, loading ' + total + ' post-boot scripts');
                    window.__heysPerfMark && window.__heysPerfMark('PostBoot: dynamic load started (' + total + ' scripts)');
                    // Small delay to let React finish initial paint
                    setTimeout(loadNext, 50);
                    return;
                }
                // Timeout fallback: –µ—Å–ª–∏ appReady –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –∑–∞ 60s ‚Äî –≥—Ä—É–∑–∏–º –≤—Å—ë —Ä–∞–≤–Ω–æ
                if (waitChecks > 600) {
                    console.warn('[HEYS.postboot] ‚ö†Ô∏è appReady timeout, loading post-boot anyway');
                    setTimeout(loadNext, 0);
                    return;
                }
                setTimeout(waitForAppReady, 100);
            }
            // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ 200ms (–¥–∞—ë–º boot chain –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è)
            setTimeout(waitForAppReady, 200);
        })();
    </script>

    <!-- Service Worker —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ heys_platform_apis_v1.js ‚Üí registerServiceWorker() -->
</body>

</html>