<!doctype html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <!-- ÔøΩ Preconnect: DNS+TCP+TLS ahead of time -->
    <link rel="preconnect" href="https://api.heyslab.ru" crossorigin />
    <!-- ÔøΩüîç PWA Debug: Boot timing logger (saved to localStorage for mobile diagnosis) -->
    <script>
        (function () {
            window.__heysBootLog = [];
            window.__heysBootStart = Date.now();
            window.__heysLog = function (msg) {
                var entry = { t: Date.now() - window.__heysBootStart, m: msg };
                window.__heysBootLog.push(entry);
                try {
                    localStorage.setItem('heys_boot_log', JSON.stringify(window.__heysBootLog.slice(-50)));
                } catch (e) { }
                // üîá v4.7.0: BOOT –ª–æ–≥–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã (—Å–º. localStorage.heys_boot_log)
            };
            window.__heysLog('HTML parsing started');

            // ‚è±Ô∏è Boot performance marker ‚Äî logs elapsed time since page load
            window.__heysPerfMark = function (label) {
                if (!window.__heysBootStart) return;
                var elapsed = ((Date.now() - window.__heysBootStart) / 1000).toFixed(1);
                console.info('[PERF] ‚è±Ô∏è +' + elapsed + 's ‚Äî ' + label);
            };
            window.__heysPerfMark('HTML parsing started');

            // ü¶¥ Skeleton timing: –∑–∞–ø–æ–º–∏–Ω–∞–µ–º –º–æ–º–µ–Ω—Ç –ø–µ—Ä–≤–æ–≥–æ paint
            window.__heysSkelStart = Date.now();
            window.__heysSkelVisible = true;

            // üöÄ SPECULATIVE PREFETCH: –∑–∞–ø—É—Å–∫–∞–µ–º –ù–ê–°–¢–û–Ø–©–ò–ô delta fetch –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ HTML
            // –ù–µ –∂–¥—ë–º React (+0.9—Å) ‚Äî –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫ API —Å—Ä–∞–∑—É ‚Üí —ç–∫–æ–Ω–æ–º–∏–º ~1—Å
            // –ï—Å–ª–∏ clientId/lastSyncTs –Ω–µ—Ç ‚Äî fallback –Ω–∞ —Ç—ë–ø–ª—ã–π /health
            try {
                var rawCid = localStorage.getItem('heys_client_current');
                var cid = rawCid ? JSON.parse(rawCid) : null;
                if (cid) {
                    var syncTs = localStorage.getItem('heys_' + cid + '_last_sync_ts');
                    if (syncTs) {
                        var pfUrl = 'https://api.heyslab.ru/rest/v1/client_kv_store'
                            + '?select=k%2Cv%2Cupdated_at'
                            + '&client_id=eq.' + encodeURIComponent(cid)
                            + '&updated_at=gt.' + encodeURIComponent(syncTs)
                            + '&limit=400&offset=0';
                        window.__heysPrefetch = {
                            clientId: cid, since: syncTs,
                            promise: fetch(pfUrl, { mode: 'cors', cache: 'no-store' })
                                .then(function (r) {
                                    if (!r.ok) throw new Error('HTTP ' + r.status);
                                    return r.json();
                                })
                                .then(function (d) {
                                    window.__heysPerfMark && window.__heysPerfMark('Prefetch data ready: ' + (Array.isArray(d) ? d.length : 0) + ' keys');
                                    return { data: d, ok: true };
                                })
                                .catch(function (e) {
                                    return { data: null, ok: false, error: e.message };
                                })
                        };
                    } else {
                        fetch('https://api.heyslab.ru/health', { mode: 'cors', cache: 'no-store' })
                            .then(function () { window.__heysPerfMark && window.__heysPerfMark('CF warm-up done'); })
                            .catch(function () { });
                    }
                } else {
                    fetch('https://api.heyslab.ru/health', { mode: 'cors', cache: 'no-store' })
                        .then(function () { window.__heysPerfMark && window.__heysPerfMark('CF warm-up done'); })
                        .catch(function () { });
                }
            } catch (e) {
                try { fetch('https://api.heyslab.ru/health', { mode: 'cors', cache: 'no-store' }).catch(function () { }); } catch (e2) { }
            }

            // Check if PWA standalone mode
            var isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
            window.__heysLog('PWA standalone: ' + isStandalone);
        })();
    </script>

    <!-- üÜï PWA Recovery: Global pre-React error handler -->
    <script>
        (function () {
            var errorCount = 0;
            var MAX_ERRORS = 3;
            var recoveryShown = false;
            window.__heysRecoveryBusy = false;

            function notifySwBootFailure() {
                if (navigator.serviceWorker && navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ type: 'BOOT_FAILURE' });
                }
            }

            function setRecoveryStatus(text) {
                var statusEl = document.getElementById('heys-recovery-status');
                if (statusEl) statusEl.textContent = text || '';
            }

            function setRecoveryButtonsDisabled(disabled) {
                var reloadBtn = document.getElementById('heys-recovery-reload');
                var clearBtn = document.getElementById('heys-recovery-clear');
                if (reloadBtn) reloadBtn.disabled = !!disabled;
                if (clearBtn) clearBtn.disabled = !!disabled;
            }

            function showRecoveryUI(errorMsg) {
                if (recoveryShown) return;
                recoveryShown = true;
                notifySwBootFailure();
                window.__heysLog && window.__heysLog('[CRITICAL] Recovery UI: ' + errorMsg);

                document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;min-height:100vh;font-family:system-ui;padding:20px;background:#f3f4f6">' +
                    '<div style="background:white;padding:32px;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,0.1);max-width:400px;text-align:center">' +
                    '<div style="font-size:48px;margin-bottom:16px">‚ö†Ô∏è</div>' +
                    '<h2 style="margin:0 0 8px;font-size:20px">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>' +
                    '<p style="margin:0 0 24px;color:#6b7280;font-size:14px">' + (errorMsg || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞') + '</p>' +
                    '<div id="heys-recovery-status" style="margin:0 0 16px;color:#6b7280;font-size:12px"></div>' +
                    '<div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">' +
                    '<button id="heys-recovery-reload" onclick="window.__heysReloadApp && window.__heysReloadApp()" style="padding:12px 24px;border-radius:8px;border:none;background:#10b981;color:white;font-weight:500;cursor:pointer">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>' +
                    '<button id="heys-recovery-clear" onclick="clearCacheAndReload()" style="padding:12px 24px;border-radius:8px;border:1px solid #d1d5db;background:white;color:#374151;font-weight:500;cursor:pointer">üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –∫—ç—à</button>' +
                    '</div></div></div>';
            }

            window.__heysShowRecoveryUI = showRecoveryUI;

            window.__heysReloadApp = function () {
                if (window.__heysRecoveryBusy) return;
                window.__heysRecoveryBusy = true;
                setRecoveryStatus('–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è‚Ä¶');
                setRecoveryButtonsDisabled(true);
                setTimeout(function () {
                    location.reload();
                }, 250);
            };

            window.clearCacheAndReload = async function () {
                if (window.__heysRecoveryBusy) return;
                window.__heysRecoveryBusy = true;
                setRecoveryStatus('–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫‚Ä¶');
                setRecoveryButtonsDisabled(true);
                try {
                    if ('caches' in window) {
                        var names = await caches.keys();
                        await Promise.all(names.map(function (n) { return caches.delete(n); }));
                    }
                    if ('serviceWorker' in navigator) {
                        var regs = await navigator.serviceWorker.getRegistrations();
                        await Promise.all(regs.map(function (r) { return r.unregister(); }));
                    }
                    sessionStorage.clear();
                } catch (e) {
                    window.__heysLog && window.__heysLog('[RECOVERY] cache clear failed: ' + (e && e.message ? e.message : String(e)));
                }
                setTimeout(function () {
                    location.reload();
                }, 350);
            };

            // Global error handler
            window.onerror = function (msg, url, line, col, error) {
                errorCount++;
                window.__heysLog && window.__heysLog('[ERROR] ' + msg + ' at ' + url + ':' + line);

                // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ —Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ recovery
                var isCritical = /React|ReactDOM|HEYS|createRoot|createElement/.test(msg + (error ? error.stack : ''));

                if (isCritical || errorCount >= MAX_ERRORS) {
                    showRecoveryUI(msg);
                    return true; // Suppress error
                }
                return false;
            };

            // Unhandled promise rejections
            window.onunhandledrejection = function (event) {
                errorCount++;
                var reason = event.reason ? (event.reason.message || String(event.reason)) : 'Unknown error';
                window.__heysLog && window.__heysLog('[REJECT] ' + reason);

                if (errorCount >= MAX_ERRORS) {
                    showRecoveryUI(reason);
                }
            };

            // Watchdog: –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä —Å heartbeat
            // –í–º–µ—Å—Ç–æ –∂—ë—Å—Ç–∫–æ–≥–æ 15s cutoff ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 5s,
            // –∏ –∂–¥—ë–º –¥–æ 120s –ø–æ–∫–∞ –µ—Å—Ç—å heartbeat (—Å–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è)
            // üîÑ v5: —É–≤–µ–ª–∏—á–µ–Ω–æ —Å 60s –¥–æ 120s –¥–ª—è throttled-—Å–µ—Ç–µ–π
            window.__heysLoadingHeartbeat = Date.now();
            // üÜï v9.1: –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ heartbeat –∏–∑ HTML (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–Ω–¥–ª–æ–≤).
            // –° –±–∞–Ω–¥–ª–∞–º–∏ boot-init —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è ~30s –Ω–∞ throttled-—Å–µ—Ç–∏,
            // –ø–æ—ç—Ç–æ–º—É heartbeat –∏–∑ waitForDependencies –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –¥–æ watchdog.
            (function autoHeartbeat() {
                if (window.__heysAppReady) return;
                window.__heysLoadingHeartbeat = Date.now();
                setTimeout(autoHeartbeat, 2000);
            })();
            var watchdogChecks = 0;
            var WATCHDOG_INTERVAL = 5000;
            var WATCHDOG_MAX_CHECKS = 24; // 120s –º–∞–∫—Å–∏–º—É–º (was 12/60s ‚Äî —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–ª—è slow 3G)
            var WATCHDOG_STALE_MS = 10000; // 10s –±–µ–∑ heartbeat = –∑–∞–≤–∏—Å–ª–æ

            function watchdogCheck() {
                watchdogChecks++;
                if (window.__heysAppReady) {
                    window.__heysPerfMark && window.__heysPerfMark('Watchdog: appReady confirmed');
                    return; // App –∑–∞–≥—Ä—É–∑–∏–ª—Å—è ‚Äî –æ—Ç–ª–∏—á–Ω–æ
                }

                var now = Date.now();
                var heartbeatAge = now - (window.__heysLoadingHeartbeat || 0);
                var totalElapsed = watchdogChecks * WATCHDOG_INTERVAL;

                // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–≤–µ–∂–∏–π heartbeat ‚Äî —Å–∫—Ä–∏–ø—Ç—ã –µ—â—ë –≥—Ä—É–∑—è—Ç—Å—è, –∂–¥—ë–º
                if (heartbeatAge < WATCHDOG_STALE_MS && watchdogChecks < WATCHDOG_MAX_CHECKS) {
                    window.__heysLog && window.__heysLog('[WATCHDOG] Still loading... (' + (totalElapsed / 1000) + 's, heartbeat ' + (heartbeatAge / 1000).toFixed(1) + 's ago)');
                    setTimeout(watchdogCheck, WATCHDOG_INTERVAL);
                    return;
                }

                // Heartbeat —É—Å—Ç–∞—Ä–µ–ª –∏–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –º–∞–∫—Å–∏–º—É–º ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º recovery
                window.__heysLog && window.__heysLog('[WATCHDOG] App not ready after ' + (totalElapsed / 1000) + 's (heartbeat age: ' + (heartbeatAge / 1000).toFixed(1) + 's)');
                if (window.__heysShowRecoveryUI) {
                    window.__heysShowRecoveryUI('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å –∑–∞ ' + (totalElapsed / 1000) + ' —Å–µ–∫—É–Ω–¥');
                }
            }
            setTimeout(watchdogCheck, WATCHDOG_INTERVAL);
        })();
    </script>
    <!-- Global deps loader (used to wait for React safely) -->
    <script>
        (function () {
            window.HEYS = window.HEYS || {};
            window.HEYS.waitForDeps = function (deps, onReady, options) {
                var opts = options || {};
                var timeoutMs = typeof opts.timeoutMs === 'number' ? opts.timeoutMs : 5000;
                var intervalMs = typeof opts.intervalMs === 'number' ? opts.intervalMs : 20;
                var startedAt = Date.now();

                function check() {
                    var missing = (deps || []).filter(function (d) {
                        try {
                            return !(d && typeof d.check === 'function' && d.check());
                        } catch (e) {
                            return true;
                        }
                    });

                    if (missing.length === 0) {
                        if (typeof onReady === 'function') onReady();
                        return;
                    }

                    if (Date.now() - startedAt >= timeoutMs) {
                        var names = missing.map(function (d) { return d && d.name ? d.name : 'unknown'; }).join(', ');
                        window.__heysLog && window.__heysLog('[DEPS] Timeout waiting for: ' + names);
                        if (typeof opts.onTimeout === 'function') {
                            opts.onTimeout(missing);
                        }
                        return;
                    }

                    setTimeout(check, intervalMs);
                }

                check();
            };
        })();
    </script>
    <!-- Prevent FOUC: Apply theme before CSS loads -->
    <script>
        (function () {
            var t = localStorage.getItem('heys_theme');
            var isDark = t === 'dark' || (t === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches);
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            window.__heysLog && window.__heysLog('Theme applied: ' + (isDark ? 'dark' : 'light'));
        })();
    </script>
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>HEYS Nutrition Tracker - Production</title>

    <!-- Tailwind CSS ‚Äî render-blocking (69KB, –Ω—É–∂–µ–Ω –¥–ª—è skeleton/app UI) -->
    <!-- Login gate –∏–º–µ–µ—Ç inline —Å—Ç–∏–ª–∏ –∏ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Tailwind -->
    <link rel="stylesheet" href="/styles/tailwind.css" />

    <!-- Critical CSS for instant rendering -->
    <link rel="stylesheet" href="styles/critical.css?v=2" />

    <!-- Pattern Debugger CSS (–æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –º–æ–¥–∞–ª–∫–∞ ‚Äî –∑–∞–≥—Ä—É–∂–∞–µ–º async, –Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è FCP) -->
    <link rel="preload" href="insights/pi_pattern_debugger.css?v=2" as="style"
        onload="this.onload=null;this.rel='stylesheet'" />
    <noscript>
        <link rel="stylesheet" href="insights/pi_pattern_debugger.css?v=2" />
    </noscript>

    <!-- HTTP/2 + Resource hints for optimal performance -->
    <!-- cdn.jsdelivr.net –æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è Twemoji (emoji SVG) -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
    <!-- Preload –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö boot-–±–∞–Ω–¥–ª–æ–≤ (2026-02-25 bundle migration) -->
    <link rel="preload" href="boot-core.bundle.d78546fb6349.js" as="script" />
    <link rel="preload" href="boot-calc.bundle.9701e1633ac1.js" as="script" />
    <link rel="preload" href="boot-day.bundle.0f10e7bf96dc.js" as="script" />
    <link rel="preload" href="boot-app.bundle.e539ebd7a716.js" as="script" />
    <link rel="preload" href="boot-init.bundle.26d91a786979.js" as="script" />

    <!-- React —Ç–µ–ø–µ—Ä—å –±–∞–Ω–¥–ª–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Vite (–º–∏–≥—Ä–∞—Ü–∏—è —Å CDN 2026-01-21) -->

    <!-- Resource hints for better caching (prefetch, not preload to avoid warnings) -->
    <link rel="prefetch" href="heys_core_v12.js?v=2" />
    <link rel="prefetch" href="heys_simple_analytics.js" />
    <!-- heys_storage_supabase_v1.js ‚Äî prefetch —É–¥–∞–ª—ë–Ω, —Ñ–∞–π–ª –ª–æ–∫–∞–ª—å–Ω—ã–π, SDK —É–¥–∞–ª—ë–Ω -->
    <link rel="prefetch" href="heys_models_v1.js" />

    <!-- Main CSS ‚Äî async load (1.19MB via @import, –Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è login gate) -->
    <!-- v12: Login gate –∏–º–µ–µ—Ç inline —Å—Ç–∏–ª–∏, main.css –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–Ω–¥–ª–æ–≤ -->
    <!-- v9.8: —Ñ–ª–∞–≥ __heysMainCSSLoaded + —Å–æ–±—ã—Ç–∏–µ heysMainCSSLoaded –¥–ª—è gate DayTab -->
    <link rel="preload" href="styles/main.css?v=38" as="style"
        onload="this.onload=null;this.rel='stylesheet';window.__heysMainCSSLoaded=true;window.dispatchEvent(new CustomEvent('heysMainCSSLoaded'))" />
    <noscript>
        <link rel="stylesheet" href="styles/main.css?v=38" />
    </noscript>

    <!-- v9.10: CSS load detection ‚Äî detects both dev (main.css) and Vite production build
         (/assets/index-*.css where Vite processes main.css into a blocking stylesheet) -->
    <script>
        (function () {
            if (window.__heysMainCSSLoaded) return;
            // v9.10: Vite production build processes main.css ‚Üí /assets/index-HASH.css
            // (blocking <link rel="stylesheet">), so CSS is already loaded when this runs.
            // Detect it immediately instead of waiting 3s for a 'main.css' that doesn't exist.
            var sheets = document.styleSheets;
            for (var i = 0; i < sheets.length; i++) {
                try {
                    var href = sheets[i].href;
                    if (href && (href.indexOf('main.css') !== -1 ||
                        (href.indexOf('/assets/') !== -1 && href.indexOf('.css') !== -1))) {
                        window.__heysMainCSSLoaded = true;
                        window.dispatchEvent(new CustomEvent('heysMainCSSLoaded'));
                        console.info('[HEYS.css] ‚úÖ main.css detected (immediate): ' + href.split('/').pop());
                        return;
                    }
                } catch (e) { }
            }
            // Fallback: also check for <link> element directly (covers edge cases)
            var viteCssLink = document.querySelector('link[rel="stylesheet"][href*="/assets/"]');
            if (viteCssLink) {
                window.__heysMainCSSLoaded = true;
                window.dispatchEvent(new CustomEvent('heysMainCSSLoaded'));
                console.info('[HEYS.css] ‚úÖ Vite CSS already loaded (link element detected)');
                return;
            }
            // Polling fallback for dev mode or delayed CSS loading
            var checks = 0, maxChecks = 15; // 15 √ó 200ms = 3s max
            var timer = setInterval(function () {
                checks++;
                if (window.__heysMainCSSLoaded) { clearInterval(timer); return; }
                var sheets = document.styleSheets;
                for (var i = 0; i < sheets.length; i++) {
                    try {
                        var href = sheets[i].href;
                        if (href && (href.indexOf('main.css') !== -1 ||
                            (href.indexOf('/assets/') !== -1 && href.indexOf('.css') !== -1))) {
                            clearInterval(timer);
                            window.__heysMainCSSLoaded = true;
                            window.dispatchEvent(new CustomEvent('heysMainCSSLoaded'));
                            console.info('[HEYS.css] ‚úÖ main.css detected via polling (' + (checks * 200) + 'ms)');
                            return;
                        }
                    } catch (e) { } // CORS sheets throw SecurityError
                }
                if (checks >= maxChecks) {
                    clearInterval(timer);
                    console.warn('[HEYS.css] ‚ö†Ô∏è main.css polling exhausted (3s) ‚Äî onload will handle it');
                }
            }, 200);
        })();
    </script>

    <!-- PWA Manifest and Meta Tags -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#2563eb" />

    <!-- PWA Support (iOS + Android) -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="HEYS" />
    <link rel="apple-touch-icon" href="/icon-192.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png" />

    <!-- IW config: loaded externally from /heys-iw-config.json (async fetch + localStorage cache) -->
    <!-- 37KB inline JSON removed ‚Üí improves HTML parse time by ~1-2s on slow 3G -->
    <!-- Fallback: localStorage cache (heys_iw_config_cache_v1) with 24h TTL -->
</head>

<body class="emoji-system">
    <!-- üîç vConsole –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ (–≤–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ ?debug=1 –∏–ª–∏ localStorage heys_debug=1) -->
    <script>
        (function () {
            window.__heysLog && window.__heysLog('Body parsing started');
            var debug = new URLSearchParams(window.location.search).get('debug') === '1' || localStorage.getItem('heys_debug') === '1';
            if (debug) {
                var s = document.createElement('script');
                s.src = 'https://cdn.jsdelivr.net/npm/vconsole@latest/dist/vconsole.min.js';
                s.onload = function () {
                    new window.VConsole({ theme: 'dark' });
                    window.__heysLog && window.__heysLog('vConsole loaded');
                };
                document.head.appendChild(s);
            }
        })();
    </script>
    <div id="root">
        <!-- ü¶¥ Skeleton UI v1.0: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (0ms) –ø–æ–∫–∞ –≥—Ä—É–∑—è—Ç—Å—è JS-–±–∞–Ω–¥–ª—ã.
             React.render() –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ <div id="root">.
             –ù–∏–∫–∞–∫–æ–≥–æ JS –Ω–µ –Ω—É–∂–Ω–æ ‚Äî —á–∏—Å—Ç—ã–π HTML/CSS. -->
        <div class="heys-skeleton"
            style="max-width:480px;margin:0 auto;padding:16px;font-family:system-ui,-apple-system,sans-serif">
            <!-- Header bar -->
            <div style="display:flex;align-items:center;justify-content:space-between;padding:8px 0 16px">
                <div style="width:90px;height:18px;background:#e5e7eb;border-radius:6px"></div>
                <div style="display:flex;gap:8px">
                    <div style="width:28px;height:28px;background:#e5e7eb;border-radius:50%"></div>
                    <div style="width:28px;height:28px;background:#e5e7eb;border-radius:50%"></div>
                </div>
            </div>
            <!-- Date selector -->
            <div style="display:flex;justify-content:center;gap:6px;margin-bottom:16px">
                <div style="width:36px;height:36px;background:#f3f4f6;border-radius:50%"></div>
                <div style="width:36px;height:36px;background:#f3f4f6;border-radius:50%"></div>
                <div style="width:36px;height:36px;background:#dbeafe;border-radius:50%;border:2px solid #93c5fd"></div>
                <div style="width:36px;height:36px;background:#f3f4f6;border-radius:50%"></div>
                <div style="width:36px;height:36px;background:#f3f4f6;border-radius:50%"></div>
            </div>
            <!-- Hero metrics card -->
            <div style="background:#f9fafb;border-radius:16px;padding:20px;margin-bottom:12px">
                <div style="display:flex;justify-content:space-between;margin-bottom:16px">
                    <div style="text-align:center;flex:1">
                        <div
                            style="width:48px;height:48px;margin:0 auto 6px;background:linear-gradient(135deg,#dbeafe,#bfdbfe);border-radius:50%">
                        </div>
                        <div style="width:60px;height:10px;margin:0 auto;background:#e5e7eb;border-radius:4px"></div>
                    </div>
                    <div style="text-align:center;flex:1">
                        <div
                            style="width:48px;height:48px;margin:0 auto 6px;background:linear-gradient(135deg,#dcfce7,#bbf7d0);border-radius:50%">
                        </div>
                        <div style="width:60px;height:10px;margin:0 auto;background:#e5e7eb;border-radius:4px"></div>
                    </div>
                    <div style="text-align:center;flex:1">
                        <div
                            style="width:48px;height:48px;margin:0 auto 6px;background:linear-gradient(135deg,#fef3c7,#fde68a);border-radius:50%">
                        </div>
                        <div style="width:60px;height:10px;margin:0 auto;background:#e5e7eb;border-radius:4px"></div>
                    </div>
                </div>
                <div style="width:100%;height:8px;background:#e5e7eb;border-radius:4px;overflow:hidden">
                    <div class="heys-skeleton__progress"
                        style="width:0%;height:100%;background:linear-gradient(90deg,#93c5fd,#60a5fa);border-radius:4px">
                    </div>
                </div>
            </div>
            <!-- Meal cards -->
            <div style="display:flex;flex-direction:column;gap:10px">
                <div
                    style="background:#fff;border:1px solid #f3f4f6;border-radius:12px;padding:14px;display:flex;align-items:center;gap:12px">
                    <div style="width:32px;height:32px;background:#dbeafe;border-radius:8px"></div>
                    <div style="flex:1">
                        <div style="width:70px;height:10px;background:#e5e7eb;border-radius:4px;margin-bottom:6px">
                        </div>
                        <div style="width:120px;height:8px;background:#f3f4f6;border-radius:4px"></div>
                    </div>
                    <div style="width:40px;height:16px;background:#f3f4f6;border-radius:4px"></div>
                </div>
                <div
                    style="background:#fff;border:1px solid #f3f4f6;border-radius:12px;padding:14px;display:flex;align-items:center;gap:12px">
                    <div style="width:32px;height:32px;background:#dcfce7;border-radius:8px"></div>
                    <div style="flex:1">
                        <div style="width:50px;height:10px;background:#e5e7eb;border-radius:4px;margin-bottom:6px">
                        </div>
                        <div style="width:100px;height:8px;background:#f3f4f6;border-radius:4px"></div>
                    </div>
                    <div style="width:40px;height:16px;background:#f3f4f6;border-radius:4px"></div>
                </div>
                <div
                    style="background:#fff;border:1px solid #f3f4f6;border-radius:12px;padding:14px;display:flex;align-items:center;gap:12px">
                    <div style="width:32px;height:32px;background:#fef3c7;border-radius:8px"></div>
                    <div style="flex:1">
                        <div style="width:80px;height:10px;background:#e5e7eb;border-radius:4px;margin-bottom:6px">
                        </div>
                        <div style="width:90px;height:8px;background:#f3f4f6;border-radius:4px"></div>
                    </div>
                    <div style="width:40px;height:16px;background:#f3f4f6;border-radius:4px"></div>
                </div>
            </div>
            <!-- Bottom tab bar -->
            <div
                style="position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid #f3f4f6;padding:8px 0 env(safe-area-inset-bottom,0);display:flex;justify-content:space-around">
                <div style="text-align:center;padding:4px 12px">
                    <div style="width:22px;height:22px;margin:0 auto 3px;background:#93c5fd;border-radius:4px"></div>
                    <div style="width:24px;height:6px;margin:0 auto;background:#bfdbfe;border-radius:3px"></div>
                </div>
                <div style="text-align:center;padding:4px 12px">
                    <div style="width:22px;height:22px;margin:0 auto 3px;background:#e5e7eb;border-radius:4px"></div>
                    <div style="width:24px;height:6px;margin:0 auto;background:#f3f4f6;border-radius:3px"></div>
                </div>
                <div style="text-align:center;padding:4px 12px">
                    <div style="width:22px;height:22px;margin:0 auto 3px;background:#e5e7eb;border-radius:4px"></div>
                    <div style="width:24px;height:6px;margin:0 auto;background:#f3f4f6;border-radius:3px"></div>
                </div>
                <div style="text-align:center;padding:4px 12px">
                    <div style="width:22px;height:22px;margin:0 auto 3px;background:#e5e7eb;border-radius:4px"></div>
                    <div style="width:24px;height:6px;margin:0 auto;background:#f3f4f6;border-radius:3px"></div>
                </div>
            </div>
        </div>
        <style>
            .heys-skeleton__progress {
                animation: heys-skel-progress 3s ease-out forwards;
            }

            @keyframes heys-skel-progress {
                0% {
                    width: 0%
                }

                30% {
                    width: 40%
                }

                60% {
                    width: 65%
                }

                100% {
                    width: 85%
                }
            }

            @media(prefers-color-scheme:dark) {
                html:not([data-theme]) .heys-skeleton {
                    background: #111827 !important;
                    color: #f9fafb !important
                }

                html:not([data-theme]) .heys-skeleton div[style*="background:#f9fafb"] {
                    background: #1f2937 !important
                }

                html:not([data-theme]) .heys-skeleton div[style*="background:#fff"] {
                    background: #1f2937 !important;
                    border-color: #374151 !important
                }

                html:not([data-theme]) .heys-skeleton div[style*="background:#e5e7eb"] {
                    background: #374151 !important
                }

                html:not([data-theme]) .heys-skeleton div[style*="background:#f3f4f6"] {
                    background: #374151 !important
                }

                html:not([data-theme]) .heys-skeleton div[style*="border-top:1px solid #f3f4f6"] {
                    background: #111827 !important;
                    border-color: #374151 !important
                }
            }

            [data-theme="dark"] .heys-skeleton {
                background: #111827 !important;
                color: #f9fafb !important
            }

            [data-theme="dark"] .heys-skeleton div[style*="background:#f9fafb"] {
                background: #1f2937 !important
            }

            [data-theme="dark"] .heys-skeleton div[style*="background:#fff"] {
                background: #1f2937 !important;
                border-color: #374151 !important
            }

            [data-theme="dark"] .heys-skeleton div[style*="background:#e5e7eb"] {
                background: #374151 !important
            }

            [data-theme="dark"] .heys-skeleton div[style*="background:#f3f4f6"] {
                background: #374151 !important
            }

            [data-theme="dark"] .heys-skeleton div[style*="border-top:1px solid #f3f4f6"] {
                background: #111827 !important;
                border-color: #374151 !important
            }
        </style>
    </div>

    <!-- üöÄ LOGIN-FIRST BOOT: –°—Ç–∞—Ç–∏—á–Ω—ã–π HTML –ª–æ–≥–∏–Ω –ø–æ–≤–µ—Ä—Ö —Å–∫–µ–ª–µ—Ç–æ–Ω–∞.
         –ü–æ—è–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (0ms) –¥–ª—è —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
         –ë–∞–Ω–¥–ª—ã –≥—Ä—É–∑—è—Ç—Å—è –≤ —Ñ–æ–Ω–µ –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ.
         –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –æ–≤–µ—Ä–ª–µ–π —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚Üí —Å–∫–µ–ª–µ—Ç–æ–Ω/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. -->

    <!-- –®–∞–≥ 1: –î–µ—Ç–µ–∫—Ü–∏—è —Å–µ—Å—Å–∏–∏ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ) -->
    <script>
        (function () {
            try {
                var hasPinAuth = !!localStorage.getItem('heys_pin_auth_client');
                var hasCuratorSession = !!localStorage.getItem('heys_curator_session');
                var hasSupabaseToken = (function () {
                    try {
                        var raw = localStorage.getItem('heys_supabase_auth_token');
                        if (!raw) return false;
                        var parsed = JSON.parse(raw);
                        if (!parsed) return false;
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º expires_at ‚Äî –µ—Å–ª–∏ –∏—Å—Ç—ë–∫, —Å—á–∏—Ç–∞–µ–º –Ω–µ—Ç —Å–µ—Å—Å–∏–∏
                        var expiresAt = parsed.expires_at;
                        if (expiresAt && expiresAt * 1000 < Date.now()) return false;
                        return !!(parsed.user && parsed.user.id);
                    } catch (_) { return false; }
                })();
                window.__heysHasSession = hasPinAuth || hasCuratorSession || hasSupabaseToken;
            } catch (_) {
                window.__heysHasSession = false;
            }
            window.__heysLog && window.__heysLog('Session detected: ' + window.__heysHasSession);
        })();
    </script>

    <!-- –®–∞–≥ 2: –°—Ç–∞—Ç–∏—á–Ω—ã–π HTML –ª–æ–≥–∏–Ω-–æ–≤–µ—Ä–ª–µ–π -->
    <div id="heys-login-gate"
        style="position:fixed;inset:0;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(135deg,#3b82f6,#1d4ed8);padding:20px 20px 40px;overflow-y:auto">

        <!-- –≠–∫—Ä–∞–Ω: client (—Ç–µ–ª–µ—Ñ–æ–Ω + PIN) ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É -->
        <div id="hlg-screen-client">
            <div
                style="width:100%;max-width:360px;border-radius:16px;background:rgba(255,255,255,0.95);padding:28px;box-shadow:0 25px 50px -12px rgba(0,0,0,0.25);margin:0 auto">
                <div style="text-align:center;margin-bottom:28px">
                    <div
                        style="font-size:28px;font-weight:800;letter-spacing:-0.5px;color:#0f172a;font-family:system-ui,-apple-system,sans-serif">
                        üëã –ü—Ä–∏–≤–µ—Ç!</div>
                    <div
                        style="margin-top:4px;font-size:15px;color:#64748b;font-family:system-ui,-apple-system,sans-serif">
                        –í—Ö–æ–¥ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                </div>
                <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
                <div style="margin-bottom:20px">
                    <div
                        style="text-align:center;font-size:15px;font-weight:600;color:#334155;margin-bottom:10px;font-family:system-ui,-apple-system,sans-serif">
                        –¢–µ–ª–µ—Ñ–æ–Ω</div>
                    <div id="hlg-phone-wrap"
                        style="display:flex;align-items:center;justify-content:center;gap:8px;border-radius:1rem;border:2px solid #e2e8f0;padding:12px 16px;background:white;transition:border-color 0.2s">
                        <span class="phone-prefix-large"
                            style="font-weight:700;color:#334155;flex-shrink:0;font-family:system-ui,-apple-system,sans-serif;user-select:none">+7</span>
                        <input id="hlg-phone" type="tel" inputmode="numeric" autocomplete="tel"
                            placeholder="(999) 123-45-67" maxlength="15" class="phone-input-large"
                            style="width:195px;font-weight:700;color:#334155;font-family:system-ui,-apple-system,sans-serif" />
                    </div>
                </div>
                <!-- PIN -->
                <div style="margin-bottom:20px">
                    <div
                        style="text-align:center;font-size:15px;font-weight:600;color:#334155;margin-bottom:10px;font-family:system-ui,-apple-system,sans-serif">
                        PIN-–∫–æ–¥</div>
                    <div style="display:flex;justify-content:center;gap:12px">
                        <div style="position:relative;width:56px;height:72px">
                            <input id="hlg-pin-0" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1"
                                autocomplete="one-time-code"
                                style="width:100%;height:100%;border-radius:16px;border:2px solid #e2e8f0;background:white;text-align:center;font-size:32px;line-height:1;font-weight:700;color:#1e293b;outline:none;font-family:system-ui,-apple-system,sans-serif;caret-color:transparent" />
                            <span id="hlg-pin-ov-0"
                                style="display:none;position:absolute;inset:0;align-items:center;justify-content:center;font-size:32px;font-weight:700;color:#1e293b;font-family:system-ui,-apple-system,sans-serif;pointer-events:none"></span>
                        </div>
                        <div style="position:relative;width:56px;height:72px">
                            <input id="hlg-pin-1" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1"
                                autocomplete="off"
                                style="width:100%;height:100%;border-radius:16px;border:2px solid #e2e8f0;background:white;text-align:center;font-size:32px;line-height:1;font-weight:700;color:#1e293b;outline:none;font-family:system-ui,-apple-system,sans-serif;caret-color:transparent" />
                            <span id="hlg-pin-ov-1"
                                style="display:none;position:absolute;inset:0;align-items:center;justify-content:center;font-size:32px;font-weight:700;color:#1e293b;font-family:system-ui,-apple-system,sans-serif;pointer-events:none"></span>
                        </div>
                        <div style="position:relative;width:56px;height:72px">
                            <input id="hlg-pin-2" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1"
                                autocomplete="off"
                                style="width:100%;height:100%;border-radius:16px;border:2px solid #e2e8f0;background:white;text-align:center;font-size:32px;line-height:1;font-weight:700;color:#1e293b;outline:none;font-family:system-ui,-apple-system,sans-serif;caret-color:transparent" />
                            <span id="hlg-pin-ov-2"
                                style="display:none;position:absolute;inset:0;align-items:center;justify-content:center;font-size:32px;font-weight:700;color:#1e293b;font-family:system-ui,-apple-system,sans-serif;pointer-events:none"></span>
                        </div>
                        <div style="position:relative;width:56px;height:72px">
                            <input id="hlg-pin-3" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="1"
                                autocomplete="off"
                                style="width:100%;height:100%;border-radius:16px;border:2px solid #e2e8f0;background:white;text-align:center;font-size:32px;line-height:1;font-weight:700;color:#1e293b;outline:none;font-family:system-ui,-apple-system,sans-serif;caret-color:transparent" />
                            <span id="hlg-pin-ov-3"
                                style="display:none;position:absolute;inset:0;align-items:center;justify-content:center;font-size:32px;font-weight:700;color:#1e293b;font-family:system-ui,-apple-system,sans-serif;pointer-events:none"></span>
                        </div>
                    </div>
                </div>
                <!-- –û—à–∏–±–∫–∞ -->
                <div id="hlg-client-err"
                    style="display:none;border-radius:12px;background:#fef2f2;border:1px solid #fee2e2;padding:12px 16px;text-align:center;font-size:14px;color:#dc2626;margin-bottom:16px;font-family:system-ui,-apple-system,sans-serif">
                </div>
                <!-- –ö–Ω–æ–ø–∫–∞ -->
                <button id="hlg-client-submit" onclick="hlgClientLogin()" disabled
                    style="width:100%;border-radius:12px;background:linear-gradient(135deg,#3b82f6,#2563eb);border:none;padding:14px 16px;font-size:16px;font-weight:600;color:white;cursor:pointer;box-shadow:0 4px 14px rgba(59,130,246,0.4);opacity:0.5;font-family:system-ui,-apple-system,sans-serif;transition:opacity 0.2s">–í–æ–π—Ç–∏
                    ‚Üí</button>
                <div style="margin-top:20px;text-align:center">
                    <div
                        style="font-size:13px;color:#94a3b8;margin-bottom:6px;font-family:system-ui,-apple-system,sans-serif">
                        –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞? –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å:</div>
                    <a href="tel:+79624556111"
                        style="display:block;font-size:14px;font-weight:600;color:#3b82f6;text-decoration:none;font-family:system-ui,-apple-system,sans-serif">+7
                        962 455-61-11</a>
                    <button onclick="hlgShowScreen('curator')"
                        style="margin-top:10px;background:none;border:none;font-size:14px;font-weight:500;color:#3b82f6;cursor:pointer;font-family:system-ui,-apple-system,sans-serif">–í—Ö–æ–¥
                        –¥–ª—è –∫—É—Ä–∞—Ç–æ—Ä–∞ ‚Üí</button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω: curator (email + –ø–∞—Ä–æ–ª—å) -->
        <div id="hlg-screen-curator" style="display:none">
            <div
                style="width:100%;max-width:360px;border-radius:16px;background:rgba(255,255,255,0.95);padding:28px;box-shadow:0 25px 50px -12px rgba(0,0,0,0.25);margin:0 auto">
                <div style="text-align:center;margin-bottom:24px">
                    <div style="font-size:36px;margin-bottom:6px">üçé</div>
                    <div
                        style="font-size:24px;font-weight:800;letter-spacing:-0.5px;color:#0f172a;font-family:system-ui,-apple-system,sans-serif">
                        HEYS</div>
                    <div
                        style="margin-top:4px;font-size:14px;color:#64748b;font-family:system-ui,-apple-system,sans-serif">
                        –í—Ö–æ–¥ –∫—É—Ä–∞—Ç–æ—Ä–∞</div>
                </div>
                <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:12px">
                    <input id="hlg-curator-email" type="email" autocomplete="email" placeholder="Email"
                        style="width:100%;box-sizing:border-box;border-radius:12px;border:2px solid #e2e8f0;background:white;padding:12px 16px;font-size:16px;color:#1e293b;outline:none;font-family:system-ui,-apple-system,sans-serif" />
                    <input id="hlg-curator-pass" type="password" autocomplete="current-password" placeholder="–ü–∞—Ä–æ–ª—å"
                        style="width:100%;box-sizing:border-box;border-radius:12px;border:2px solid #e2e8f0;background:white;padding:12px 16px;font-size:16px;color:#1e293b;outline:none;font-family:system-ui,-apple-system,sans-serif" />
                </div>
                <!-- –û—à–∏–±–∫–∞ -->
                <div id="hlg-curator-err"
                    style="display:none;border-radius:12px;background:#fef2f2;border:1px solid #fee2e2;padding:12px 16px;text-align:center;font-size:14px;color:#dc2626;margin-bottom:12px;font-family:system-ui,-apple-system,sans-serif">
                </div>
                <button id="hlg-curator-submit" onclick="hlgCuratorLogin()"
                    style="width:100%;border-radius:12px;background:linear-gradient(135deg,#3b82f6,#2563eb);border:none;padding:14px 16px;font-size:16px;font-weight:600;color:white;cursor:pointer;box-shadow:0 4px 14px rgba(59,130,246,0.4);font-family:system-ui,-apple-system,sans-serif">–í–æ–π—Ç–∏
                    ‚Üí</button>
                <div style="margin-top:20px;text-align:center">
                    <div id="hlg-greeting-curator"
                        style="font-size:14px;color:#94a3b8;margin-bottom:8px;font-family:system-ui,-apple-system,sans-serif">
                    </div>
                    <button onclick="hlgShowScreen('client')"
                        style="background:none;border:none;font-size:14px;color:#3b82f6;cursor:pointer;font-family:system-ui,-apple-system,sans-serif">‚Üê
                        –ù–∞–∑–∞–¥</button>
                </div>
            </div>
        </div>

        <!-- –í–µ—Ä—Å–∏—è –≤–Ω–∏–∑—É -->
        <div id="hlg-version"
            style="margin-top:20px;font-size:11px;color:rgba(255,255,255,0.3);font-family:monospace;letter-spacing:0.05em">
        </div>
    </div>

    <!-- Dark mode —Å—Ç–∏–ª–∏ –¥–ª—è –ª–æ–≥–∏–Ω-–æ–≤–µ—Ä–ª–µ—è -->
    <style>
        @keyframes hlg-fadeout {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        @keyframes hlg-pin-appear {
            0% {
                opacity: 1;
                transform: scale(1.15);
            }

            60% {
                opacity: 1;
                transform: scale(1);
            }

            100% {
                opacity: 0;
                transform: scale(0.9);
            }
        }

        /* PIN overlay ‚Äî –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–∏—Ñ—Ä–∞ –ø–æ–≤–µ—Ä—Ö –ø–æ–ª—è */
        .hlg-pin-ov-active {
            display: flex !important;
            animation: hlg-pin-appear 1.2s ease forwards;
        }

        /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ PIN –ø–æ–ª—è */
        #hlg-pin-0:focus,
        #hlg-pin-1:focus,
        #hlg-pin-2:focus,
        #hlg-pin-3:focus {
            border-color: #60a5fa !important;
            box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.25);
        }

        /* –ì–æ—Ç–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω */
        #hlg-phone-wrap.phone-complete {
            border-color: #22c55e !important;
            background: #f0fdf4 !important;
        }

        /* –ì–æ—Ç–æ–≤—ã–π PIN */
        .hlg-pin-complete {
            border-color: #22c55e !important;
            background: #f0fdf4 !important;
        }

        /* –§–æ–∫—É—Å —Ç–µ–ª–µ—Ñ–æ–Ω */
        #hlg-phone-wrap:focus-within {
            border-color: #60a5fa !important;
        }

        /* Placeholder —Ç–µ–ª–µ—Ñ–æ–Ω–∞ */
        #hlg-phone::placeholder {
            color: #94a3b8;
            font-weight: 700;
        }

        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–ø–µ—Ä–µ–±–∏–≤–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ !important) */
        #hlg-phone {
            font-size: clamp(16px, 5.2vw, 28px) !important;
            line-height: clamp(22px, 6.2vw, 34px) !important;
            height: clamp(22px, 6.2vw, 34px) !important;
            letter-spacing: -0.01em !important;
            padding: 0 !important;
            min-height: 0 !important;
            border: none !important;
            background: transparent !important;
            box-shadow: none !important;
            outline: none !important;
        }

        #hlg-phone-wrap>span {
            font-size: clamp(16px, 5.2vw, 28px) !important;
            line-height: clamp(22px, 6.2vw, 34px) !important;
        }

        /* Disabled submit spin */
        #hlg-client-submit:not([disabled]) {
            opacity: 1 !important;
            cursor: pointer;
        }

        #hlg-client-submit.loading,
        #hlg-curator-submit.loading {
            opacity: 0.7 !important;
            cursor: not-allowed;
        }

        @media (prefers-color-scheme: dark) {
            html:not([data-theme]) #heys-login-gate {
                background: linear-gradient(135deg, #1e3a8a, #1e1b4b) !important;
            }
        }

        [data-theme="dark"] #heys-login-gate {
            background: linear-gradient(135deg, #1e3a8a, #1e1b4b) !important;
        }
    </style>

    <!-- –®–∞–≥ 3: Returning user ‚Üí loader –Ω–∞ gate (v12: –ù–ï —Å–∫—Ä—ã–≤–∞–µ–º, –±–∞–Ω–¥–ª—ã –≥—Ä—É–∑—è—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ) -->
    <script>
        if (window.__heysHasSession) {
            // üöÄ PERF v7.1: –î–ª—è returning user ‚Äî –ø—Ä—è—á–µ–º gate, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º skeleton –∏–∑ #root.
            // –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ–≤–∞–ª–∏–¥–Ω–∞ ‚Äî boot-app –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç gate (__heysShowGateLogin).
            window.__heysReturningUser = true;
            var _gate = document.getElementById('heys-login-gate');
            if (_gate) _gate.style.display = 'none';
            window.__heysLog && window.__heysLog('Returning user ‚Äî gate hidden, skeleton visible');
        }
    </script>
    <script>
        (function () {
            var API = 'https://api.heyslab.ru';
            var AUTH_RATE_KEY = 'heys_auth_rate_limit_v1';

            // ‚îÄ‚îÄ‚îÄ –£—Ç–∏–ª–∏—Ç—ã localStorage ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function lsGet(k, def) {
                try { var v = localStorage.getItem(k); return v == null ? def : JSON.parse(v); } catch (_) { return def; }
            }
            function lsSet(k, v) {
                try { localStorage.setItem(k, JSON.stringify(v)); } catch (_) { }
            }
            function lsRaw(k, v) {
                try { localStorage.setItem(k, v); } catch (_) { }
            }
            function lsDel(k) {
                try { localStorage.removeItem(k); } catch (_) { }
            }

            // ‚îÄ‚îÄ‚îÄ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç 10 —Ü–∏—Ñ—Ä –≤ (XXX) XXX-XX-XX
            function formatPhoneBody(digits) {
                var d = String(digits || '').slice(0, 10);
                if (!d) return '';
                var r = '';
                if (d.length > 0) r += '(' + d.slice(0, 3);
                if (d.length >= 3) r += ') ';
                if (d.length > 3) r += d.slice(3, 6);
                if (d.length >= 6) r += '-';
                if (d.length > 6) r += d.slice(6, 8);
                if (d.length >= 8) r += '-';
                if (d.length > 8) r += d.slice(8, 10);
                return r;
            }

            // ‚îÄ‚îÄ‚îÄ Rate limiting (–ø–æ—Ä—Ç –∏–∑ heys_auth_v1.js) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function canAttempt(kind, phone) {
                try {
                    var st = lsGet(AUTH_RATE_KEY, { byKey: {} });
                    var key = kind + ':' + (phone || '');
                    var rec = (st.byKey && st.byKey[key]) || { count: 0, resetAt: 0, lockedUntil: 0 };
                    var t = Date.now();
                    var WINDOW = 10 * 60 * 1000;
                    if (rec.lockedUntil && t < rec.lockedUntil) return { ok: false, retryAfterMs: rec.lockedUntil - t };
                    if (!rec.resetAt || t > rec.resetAt) { rec.count = 0; rec.resetAt = t + WINDOW; }
                    if (rec.count >= 10) {
                        rec.lockedUntil = t + WINDOW;
                        if (!st.byKey) st.byKey = {};
                        st.byKey[key] = rec;
                        lsSet(AUTH_RATE_KEY, st);
                        return { ok: false, retryAfterMs: WINDOW };
                    }
                    return { ok: true };
                } catch (_) { return { ok: true }; }
            }
            function registerFail(kind, phone) {
                try {
                    var st = lsGet(AUTH_RATE_KEY, { byKey: {} });
                    var key = kind + ':' + (phone || '');
                    var t = Date.now();
                    var WINDOW = 10 * 60 * 1000;
                    var rec = (st.byKey && st.byKey[key]) || { count: 0, resetAt: 0, lockedUntil: 0 };
                    if (!rec.resetAt || t > rec.resetAt) { rec.count = 0; rec.resetAt = t + WINDOW; }
                    rec.count += 1;
                    if (rec.count >= 10) rec.lockedUntil = t + WINDOW;
                    if (!st.byKey) st.byKey = {};
                    st.byKey[key] = rec;
                    lsSet(AUTH_RATE_KEY, st);
                } catch (_) { }
            }

            // ‚îÄ‚îÄ‚îÄ –°–æ—Å—Ç–æ—è–Ω–∏–µ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            var phoneDigits = ''; // 10 —Ü–∏—Ñ—Ä –±–µ–∑ 7
            var pinDigits = ['', '', '', ''];
            var currentScreen = 'start';
            var isBusy = false;

            // ‚îÄ‚îÄ‚îÄ –≠–∫—Ä–∞–Ω—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            window.hlgShowScreen = function (screen) {
                document.getElementById('hlg-screen-client').style.display = screen === 'client' ? '' : 'none';
                document.getElementById('hlg-screen-curator').style.display = screen === 'curator' ? '' : 'none';
                currentScreen = screen;
                // –§–æ–∫—É—Å
                if (screen === 'client') {
                    setTimeout(function () {
                        var ph = document.getElementById('hlg-phone');
                        if (ph && !phoneDigits) ph.focus();
                        else if (ph && phoneDigits.length === 10) {
                            var p0 = document.getElementById('hlg-pin-0');
                            if (p0) p0.focus();
                        } else if (ph) ph.focus();
                    }, 50);
                }
                if (screen === 'curator') {
                    setTimeout(function () {
                        var em = document.getElementById('hlg-curator-email');
                        if (em) em.focus();
                    }, 50);
                }
            };

            // ‚îÄ‚îÄ‚îÄ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function getGreeting() {
                var h = new Date().getHours();
                if (h >= 5 && h < 12) return 'üåÖ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ!';
                if (h >= 12 && h < 18) return '‚òÄÔ∏è –î–æ–±—Ä—ã–π –¥–µ–Ω—å!';
                if (h >= 18 && h < 23) return 'üåÜ –î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä!';
                return 'üåô –î–æ–±—Ä–æ–π –Ω–æ—á–∏!';
            }

            // ‚îÄ‚îÄ‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –í–æ–π—Ç–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function updateClientSubmit() {
                var btn = document.getElementById('hlg-client-submit');
                if (!btn) return;
                var phoneOk = phoneDigits.length === 10;
                var pinOk = pinDigits.every(function (d) { return d.length === 1; });
                var canLogin = phoneOk && pinOk && !isBusy;
                btn.disabled = !canLogin;
            }

            // ‚îÄ‚îÄ‚îÄ PIN overlay (—Ü–∏—Ñ—Ä–∞ –≤–∏–¥–Ω–∞ ~1.2s, –ø–æ—Ç–æ–º –∏—Å—á–µ–∑–∞–µ—Ç) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            var pinOverlayTimers = [null, null, null, null];
            function showPinOverlay(idx, digit) {
                var ov = document.getElementById('hlg-pin-ov-' + idx);
                var inp = document.getElementById('hlg-pin-' + idx);
                if (!ov || !inp) return;
                // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç input –ø–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è overlay
                inp.style.color = 'transparent';
                ov.textContent = digit;
                ov.classList.remove('hlg-pin-ov-active');
                // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ reflow
                void ov.offsetWidth;
                ov.classList.add('hlg-pin-ov-active');
                // –°–±—Ä–æ—Å ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –∏ —Å–∫—Ä—ã–≤–∞–µ–º overlay
                if (pinOverlayTimers[idx]) clearTimeout(pinOverlayTimers[idx]);
                pinOverlayTimers[idx] = setTimeout(function () {
                    ov.classList.remove('hlg-pin-ov-active');
                    ov.style.display = 'none';
                    inp.style.color = '#1e293b';
                }, 1350);
            }
            function clearPinOverlay(idx) {
                if (pinOverlayTimers[idx]) { clearTimeout(pinOverlayTimers[idx]); pinOverlayTimers[idx] = null; }
                var ov = document.getElementById('hlg-pin-ov-' + idx);
                var inp = document.getElementById('hlg-pin-' + idx);
                if (ov) { ov.classList.remove('hlg-pin-ov-active'); ov.style.display = 'none'; }
                if (inp) inp.style.color = '#1e293b';
            }

            // ‚îÄ‚îÄ‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π PIN –ø–æ–ª–µ–π ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function updatePinStyles() {
                var allFilled = pinDigits.every(function (d) { return d.length === 1; });
                for (var i = 0; i < 4; i++) {
                    var el = document.getElementById('hlg-pin-' + i);
                    if (!el) continue;
                    if (allFilled) el.style.borderColor = '#22c55e';
                    else if (pinDigits[i]) el.style.borderColor = '#cbd5e1';
                    else el.style.borderColor = '#e2e8f0';
                    if (allFilled) el.style.background = '#f0fdf4';
                    else el.style.background = 'white';
                }
            }

            // ‚îÄ‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–≥–æ –ø–æ–ª—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function initPhoneInput() {
                var inp = document.getElementById('hlg-phone');
                var wrap = document.getElementById('hlg-phone-wrap');
                if (!inp) return;

                inp.addEventListener('input', function (e) {
                    var raw = inp.value.replace(/\D/g, '').slice(0, 10);
                    phoneDigits = raw;
                    inp.value = formatPhoneBody(raw);
                    // –°—Ç–∏–ª—å –æ–±—ë—Ä—Ç–∫–∏
                    if (raw.length === 10) {
                        wrap.style.borderColor = '#22c55e';
                        wrap.style.background = '#f0fdf4';
                    } else {
                        wrap.style.borderColor = '#e2e8f0';
                        wrap.style.background = 'white';
                    }
                    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                    hlgSetClientErr('');
                    updateClientSubmit();
                    // –ê–≤—Ç–æ-–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ PIN
                    if (raw.length === 10) {
                        setTimeout(function () {
                            var p0 = document.getElementById('hlg-pin-0');
                            if (p0) p0.focus();
                        }, 50);
                    }
                });

                inp.addEventListener('keydown', function (e) {
                    if (e.key === 'Backspace' && phoneDigits.length > 0) {
                        e.preventDefault();
                        phoneDigits = phoneDigits.slice(0, -1);
                        inp.value = formatPhoneBody(phoneDigits);
                        var wrap2 = document.getElementById('hlg-phone-wrap');
                        if (wrap2) { wrap2.style.borderColor = '#e2e8f0'; wrap2.style.background = 'white'; }
                        updateClientSubmit();
                    }
                });
            }

            // ‚îÄ‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PIN –ø–æ–ª–µ–π ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function initPinInputs() {
                for (var i = 0; i < 4; i++) {
                    (function (idx) {
                        var inp = document.getElementById('hlg-pin-' + idx);
                        if (!inp) return;

                        inp.addEventListener('input', function (e) {
                            var v = inp.value.replace(/\D/g, '').slice(0, 1);
                            inp.value = v;
                            pinDigits[idx] = v;
                            hlgSetClientErr('');
                            if (v) {
                                showPinOverlay(idx, v);
                            } else {
                                clearPinOverlay(idx);
                            }
                            updatePinStyles();
                            updateClientSubmit();
                            // –ê–≤—Ç–æ-–ø–µ—Ä–µ—Ö–æ–¥ –≤–ø–µ—Ä—ë–¥
                            if (v && idx < 3) {
                                var next = document.getElementById('hlg-pin-' + (idx + 1));
                                if (next) next.focus();
                            }
                            // –ê–≤—Ç–æ-–≤–æ–π—Ç–∏ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ü–∏—Ñ—Ä—ã
                            if (v && idx === 3) {
                                var phoneOk = phoneDigits.length === 10;
                                var pinFull = pinDigits.every(function (d) { return d.length === 1; });
                                if (phoneOk && pinFull && !isBusy) {
                                    setTimeout(function () { window.hlgClientLogin(); }, 100);
                                }
                            }
                        });

                        inp.addEventListener('keydown', function (e) {
                            if (e.key === 'Backspace') {
                                if (!pinDigits[idx] && idx > 0) {
                                    e.preventDefault();
                                    pinDigits[idx - 1] = '';
                                    var prev = document.getElementById('hlg-pin-' + (idx - 1));
                                    if (prev) { prev.value = ''; prev.focus(); }
                                    updatePinStyles();
                                    updateClientSubmit();
                                    return;
                                }
                                if (pinDigits[idx]) {
                                    e.preventDefault();
                                    pinDigits[idx] = '';
                                    inp.value = '';
                                    clearPinOverlay(idx);
                                    updatePinStyles();
                                    updateClientSubmit();
                                    return;
                                }
                            }
                            if (e.key === 'ArrowLeft' && idx > 0) {
                                e.preventDefault();
                                var pl = document.getElementById('hlg-pin-' + (idx - 1));
                                if (pl) pl.focus();
                            }
                            if (e.key === 'ArrowRight' && idx < 3) {
                                e.preventDefault();
                                var pr = document.getElementById('hlg-pin-' + (idx + 1));
                                if (pr) pr.focus();
                            }
                            if (e.key === 'Enter') {
                                var phoneOk2 = phoneDigits.length === 10;
                                var pinFull2 = pinDigits.every(function (d) { return d.length === 1; });
                                if (phoneOk2 && pinFull2 && !isBusy) window.hlgClientLogin();
                            }
                        });

                        inp.addEventListener('paste', function (e) {
                            try {
                                var txt = (e.clipboardData && e.clipboardData.getData('text')) || '';
                                var digits = txt.replace(/\D/g, '').slice(0, 4);
                                if (digits) {
                                    e.preventDefault();
                                    hlgSetClientErr('');
                                    for (var k = 0; k < 4; k++) {
                                        pinDigits[k] = digits[k] || '';
                                        var el = document.getElementById('hlg-pin-' + k);
                                        if (el) el.value = pinDigits[k];
                                    }
                                    updatePinStyles();
                                    updateClientSubmit();
                                    var nextIdx = Math.min(3, digits.length);
                                    var nextEl = document.getElementById('hlg-pin-' + nextIdx);
                                    if (nextEl) nextEl.focus();
                                }
                            } catch (_) { }
                        });
                    })(i);
                }
            }

            // ‚îÄ‚îÄ‚îÄ –ü–æ–∫–∞–∑ –æ—à–∏–±–æ–∫ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function hlgSetClientErr(msg) {
                var el = document.getElementById('hlg-client-err');
                if (!el) return;
                if (msg) { el.textContent = msg; el.style.display = ''; }
                else { el.style.display = 'none'; el.textContent = ''; }
            }
            function hlgSetCuratorErr(msg) {
                var el = document.getElementById('hlg-curator-err');
                if (!el) return;
                if (msg) { el.textContent = msg; el.style.display = ''; }
                else { el.style.display = 'none'; el.textContent = ''; }
            }

            // ‚îÄ‚îÄ‚îÄ setBusy ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function hlgSetBusy(busy, submitId, label) {
                isBusy = busy;
                var btn = document.getElementById(submitId);
                if (!btn) return;
                if (busy) {
                    btn.classList.add('loading');
                    btn.disabled = true;
                    btn.textContent = '‚è≥ –í—Ö–æ–¥...';
                } else {
                    btn.classList.remove('loading');
                    btn.textContent = label || '–í–æ–π—Ç–∏ ‚Üí';
                    updateClientSubmit();
                }
            }

            // ‚îÄ‚îÄ‚îÄ –°–∫—Ä—ã—Ç–∏–µ –æ–≤–µ—Ä–ª–µ—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function hlgHideOverlay(doReload) {
                var gate = document.getElementById('heys-login-gate');
                if (!gate) return;
                console.info('[HEYS.entry] üö™ hlgHideOverlay start, preAuth:', JSON.stringify(window.__heysPreAuth || {}));
                gate.style.animation = 'hlg-fadeout 0.3s ease forwards';
                setTimeout(function () {
                    gate.style.display = 'none';
                    // v10.1: –ù–ï –¥–µ–ª–∞–µ–º reload ‚Äî –±–∞–Ω–¥–ª—ã —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã/–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è.
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º __heysHasSession –∏ –¥–∏—Å–ø–∞—Ç—á–∏–º —Å–æ–±—ã—Ç–∏–µ –¥–ª—è React.
                    window.__heysHasSession = true;
                    console.info('[HEYS.entry] üîî dispatching heys-auth-ready, mode:', (window.__heysPreAuth || {}).mode);
                    // –£–≤–µ–¥–æ–º–ª—è–µ–º boot-core/sync –æ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
                    try {
                        window.dispatchEvent(new CustomEvent('heys-auth-ready', {
                            detail: window.__heysPreAuth || { mode: 'unknown', timestamp: Date.now() }
                        }));
                    } catch (_) { }
                    // v11: NO fallback reload ‚Äî event handoff to React handles fast network case.
                    // React listens to 'heys-auth-ready' in heys_app_auth_init_v1.js.
                    // Slow network (React not yet mounted): runAuthInit reads localStorage on mount.
                }, 320);
            }

            // ‚îÄ‚îÄ‚îÄ –°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–Ω–¥–ª–æ–≤ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            var BOOT_BUNDLES = ['react-bundle', 'boot-core', 'boot-calc', 'boot-day', 'boot-app', 'boot-init'];
            var POST_BUNDLES = ['postboot-1-game', 'postboot-2-insights', 'postboot-3-ui'];

            function hlgLogBundleStatus(trigger) {
                var entries = (performance && performance.getEntriesByType) ? performance.getEntriesByType('resource') : [];
                var loaded = {};
                var totalBytes = 0;
                for (var i = 0; i < entries.length; i++) {
                    var e = entries[i];
                    for (var j = 0; j < BOOT_BUNDLES.length; j++) {
                        if (e.name.indexOf(BOOT_BUNDLES[j]) !== -1) {
                            loaded[BOOT_BUNDLES[j]] = Math.round(e.transferSize / 1024);
                            totalBytes += e.transferSize;
                        }
                    }
                    for (var k = 0; k < POST_BUNDLES.length; k++) {
                        if (e.name.indexOf(POST_BUNDLES[k]) !== -1) {
                            loaded[POST_BUNDLES[k]] = Math.round(e.transferSize / 1024);
                            totalBytes += e.transferSize;
                        }
                    }
                }
                var bootDone = BOOT_BUNDLES.filter(function (b) { return loaded[b]; });
                var postDone = POST_BUNDLES.filter(function (b) { return loaded[b]; });
                var bootPending = BOOT_BUNDLES.filter(function (b) { return !loaded[b]; });
                var postPending = POST_BUNDLES.filter(function (b) { return !loaded[b]; });
                var appReady = !!window.__heysAppReady;
                var elapsedSec = ((performance.now()) / 1000).toFixed(1);

                console.info('[HEYS.loginGate] üì¶ Bundle status at "' + trigger + '" (+' + elapsedSec + 's):');
                console.info('[HEYS.loginGate]   Boot:    ' + bootDone.length + '/' + BOOT_BUNDLES.length +
                    ' loaded (' + Math.round(totalBytes / 1024) + 'KB total)');
                if (bootDone.length > 0) {
                    console.info('[HEYS.loginGate]   ‚úÖ ' + bootDone.map(function (b) { return b + ' (' + loaded[b] + 'KB)'; }).join(', '));
                }
                if (bootPending.length > 0) {
                    console.info('[HEYS.loginGate]   ‚è≥ Pending: ' + bootPending.join(', '));
                }
                console.info('[HEYS.loginGate]   PostBoot: ' + postDone.length + '/' + POST_BUNDLES.length + ' loaded');
                console.info('[HEYS.loginGate]   React mounted: ' + appReady);
            }

            // ‚îÄ‚îÄ‚îÄ –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –ª–æ–≥–∏–Ω ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            window.hlgClientLogin = function () {
                if (isBusy) return;
                hlgLogBundleStatus('–ö–ª–∏–µ–Ω—Ç: –í–æ–π—Ç–∏');
                var phone = '7' + phoneDigits; // 11 —Ü–∏—Ñ—Ä: 7 + 10
                var pin = pinDigits.join('');

                // –í–∞–ª–∏–¥–∞—Ü–∏—è
                if (phoneDigits.length !== 10) { hlgSetClientErr('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞'); return; }
                if (!/^\d{4}$/.test(pin)) { hlgSetClientErr('–í–≤–µ–¥–∏—Ç–µ PIN-–∫–æ–¥ –∏–∑ 4 —Ü–∏—Ñ—Ä'); return; }

                // Offline
                if (!navigator.onLine) { hlgSetClientErr('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É'); return; }

                // Rate limit
                var rate = canAttempt('login', phone);
                if (!rate.ok) {
                    var sec = Math.ceil((rate.retryAfterMs || 10000) / 1000);
                    hlgSetClientErr('–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–¥–æ–∂–¥–∏—Ç–µ ' + sec + '—Å');
                    return;
                }

                hlgSetBusy(true, 'hlg-client-submit', '–í–æ–π—Ç–∏ ‚Üí');

                // Anti-timing delay (350-600ms, –∫–∞–∫ –≤ heys_auth_v1.js)
                var delay = 350 + Math.floor(Math.random() * 250);
                setTimeout(function () {
                    fetch(API + '/rpc?fn=verify_client_pin_v3', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ p_phone: phone, p_pin: pin }),
                        mode: 'cors',
                        cache: 'no-store'
                    })
                        .then(function (r) { return r.json().then(function (d) { return { ok: r.ok, status: r.status, data: d }; }); })
                        .then(function (res) {
                            // YandexAPI –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç: { verify_client_pin_v3: {...} }
                            var raw = res.data;
                            var row = (raw && raw.verify_client_pin_v3) || (Array.isArray(raw) ? raw[0] : raw);

                            if (!res.ok || !row || !row.success) {
                                registerFail('login', phone);
                                var serverErr = row && row.error;
                                if (serverErr === 'rate_limited') {
                                    hlgSetClientErr('–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                                } else {
                                    hlgSetClientErr('–¢–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ PIN –Ω–µ–≤–µ—Ä–Ω—ã–µ');
                                }
                                hlgSetBusy(false, 'hlg-client-submit', '–í–æ–π—Ç–∏ ‚Üí');
                                return;
                            }

                            var clientId = row.client_id;
                            var sessionToken = row.session_token;
                            var clientName = row.name || row.client_name || '';

                            if (!clientId || !sessionToken) {
                                registerFail('login', phone);
                                hlgSetClientErr('–¢–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ PIN –Ω–µ–≤–µ—Ä–Ω—ã–µ');
                                hlgSetBusy(false, 'hlg-client-submit', '–í–æ–π—Ç–∏ ‚Üí');
                                return;
                            }

                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é (—Ç–µ –∂–µ –∫–ª—é—á–∏ —á—Ç–æ heys_auth_v1.js:loginClient)
                            lsDel('heys_supabase_auth_token');
                            lsRaw('heys_session_token', sessionToken);
                            lsRaw('heys_pin_auth_client', clientId);
                            if (clientName) lsRaw('heys_pending_client_name', JSON.stringify(clientName));

                            // –ü–µ—Ä–µ–¥–∞—ë–º –¥–∞–Ω–Ω—ã–µ –≤ React —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
                            window.__heysPreAuth = {
                                mode: 'client',
                                clientId: clientId,
                                sessionToken: sessionToken,
                                timestamp: Date.now()
                            };

                            window.__heysLog && window.__heysLog('[LoginGate] Client login ok: ' + clientId.slice(0, 8));
                            console.info('[HEYS.loginGate] ‚úÖ –ö–ª–∏–µ–Ω—Ç –≤–æ—à—ë–ª: ' + clientId.slice(0, 8) + '***');

                            hlgHideOverlay(true);
                        })
                        .catch(function (e) {
                            registerFail('login', phone);
                            hlgSetClientErr(navigator.onLine ? '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.' : '–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
                            hlgSetBusy(false, 'hlg-client-submit', '–í–æ–π—Ç–∏ ‚Üí');
                        });
                }, delay);
            };

            // ‚îÄ‚îÄ‚îÄ –ö—É—Ä–∞—Ç–æ—Ä—Å–∫–∏–π –ª–æ–≥–∏–Ω ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            window.hlgCuratorLogin = function () {
                if (isBusy) return;
                hlgLogBundleStatus('–ö—É—Ä–∞—Ç–æ—Ä: –í–æ–π—Ç–∏');
                var email = (document.getElementById('hlg-curator-email') || {}).value || '';
                var password = (document.getElementById('hlg-curator-pass') || {}).value || '';
                email = email.trim();

                if (!email || !password) { hlgSetCuratorErr('–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å'); return; }
                if (!navigator.onLine) { hlgSetCuratorErr('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É'); return; }

                hlgSetBusy(true, 'hlg-curator-submit', '–í–æ–π—Ç–∏ ‚Üí');
                hlgSetCuratorErr('');

                fetch(API + '/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email, password: password }),
                    mode: 'cors',
                    cache: 'no-store'
                })
                    .then(function (r) { return r.json().then(function (d) { return { ok: r.ok, status: r.status, data: d }; }); })
                    .then(function (res) {
                        if (!res.ok || res.data.error) {
                            var msg = (res.data && (res.data.error || res.data.message)) || '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                            hlgSetCuratorErr(typeof msg === 'string' ? msg : '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
                            hlgSetBusy(false, 'hlg-curator-submit', '–í–æ–π—Ç–∏ ‚Üí');
                            return;
                        }

                        var d = res.data;
                        if (!d || !d.access_token || !d.user) {
                            hlgSetCuratorErr('–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
                            hlgSetBusy(false, 'hlg-curator-submit', '–í–æ–π—Ç–∏ ‚Üí');
                            return;
                        }

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º (—Ç–µ –∂–µ –∫–ª—é—á–∏ —á—Ç–æ heys_yandex_api_v1.js:curatorLogin)
                        lsDel('heys_pin_auth_client');
                        lsDel('heys_session_token');
                        var tokenData = {
                            access_token: d.access_token,
                            expires_in: d.expires_in || 86400,
                            expires_at: Math.floor(Date.now() / 1000) + (d.expires_in || 86400),
                            user: d.user
                        };
                        lsRaw('heys_supabase_auth_token', JSON.stringify(tokenData));
                        lsRaw('heys_curator_session', d.access_token);

                        // –ü–µ—Ä–µ–¥–∞—ë–º –¥–∞–Ω–Ω—ã–µ –≤ React
                        window.__heysPreAuth = {
                            mode: 'curator',
                            accessToken: d.access_token,
                            user: d.user,
                            timestamp: Date.now()
                        };

                        window.__heysLog && window.__heysLog('[LoginGate] Curator login ok: ' + (d.user.email || ''));
                        console.info('[HEYS.loginGate] ‚úÖ –ö—É—Ä–∞—Ç–æ—Ä –≤–æ—à—ë–ª: ' + (d.user.email || ''));

                        hlgHideOverlay(true);
                    })
                    .catch(function (e) {
                        hlgSetCuratorErr(navigator.onLine ? '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.' : '–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
                        hlgSetBusy(false, 'hlg-curator-submit', '–í–æ–π—Ç–∏ ‚Üí');
                    });
            };

            // ‚îÄ‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Enter –¥–ª—è –∫—É—Ä–∞—Ç–æ—Ä–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function initCuratorEnter() {
                var passEl = document.getElementById('hlg-curator-pass');
                if (passEl) {
                    passEl.addEventListener('keydown', function (e) {
                        if (e.key === 'Enter') window.hlgCuratorLogin();
                    });
                }
            }

            // ‚îÄ‚îÄ‚îÄ Watchdog —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            // –ï—Å–ª–∏ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç recovery UI ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º –ª–æ–≥–∏–Ω-–æ–≤–µ—Ä–ª–µ–π
            (function patchRecoveryUI() {
                var orig = window.__heysShowRecoveryUI;
                window.__heysShowRecoveryUI = function (msg) {
                    try {
                        var gate = document.getElementById('heys-login-gate');
                        if (gate) gate.style.display = 'none';
                    } catch (_) { }
                    if (typeof orig === 'function') orig(msg);
                };
            })();

            // ‚îÄ‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            function init() {
                // v12: –ù–ï —Å–∫—Ä—ã–≤–∞–µ–º gate –¥–ª—è returning users ‚Äî boot-app —Å–∞–º –∑–∞–∫—Ä–æ–µ—Ç –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–∏
                // –î–ª—è returning users gate –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç loader, –¥–ª—è –Ω–æ–≤—ã—Ö ‚Äî —Ñ–æ—Ä–º—É –ª–æ–≥–∏–Ω–∞
                if (window.__heysHasSession && window.__heysReturningUser) {
                    // üöÄ PERF v7.1: Gate —Å–∫—Ä—ã—Ç, skeleton –≤–∏–¥–∏–º ‚Äî boot-app –∑–∞–∫—Ä–æ–µ—Ç —á–µ—Ä–µ–∑ __heysDismissGate
                    return;
                }
                if (window.__heysHasSession) {
                    // –°–µ—Å—Å–∏—è –ø–æ—è–≤–∏–ª–∞—Å—å –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ —á–µ—Ä–µ–∑ gate (hlgClientLogin/hlgCuratorLogin)
                    // Gate —É–∂–µ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ hlgHideOverlay
                    return;
                }

                // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                var greeting = getGreeting();
                var grCur = document.getElementById('hlg-greeting-curator');
                if (grCur) grCur.textContent = greeting;

                // –í–µ—Ä—Å–∏—è
                var verEl = document.getElementById('hlg-version');
                if (verEl) {
                    try {
                        var v = (window.HEYS && window.HEYS.version) || '';
                        if (v) verEl.textContent = 'v' + v;
                    } catch (_) { }
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –∫–ª–∏–µ–Ω—Ç–∞ —Å—Ä–∞–∑—É
                hlgShowScreen('client');

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–≤–æ–¥—ã
                initPhoneInput();
                initPinInputs();
                initCuratorEnter();
            }

            // –ó–∞–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–∑—É –∏–ª–∏ –ø–æ—Å–ª–µ DOMContentLoaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>

    <!-- Emoji style initialization - runs BEFORE twemoji loads -->
    <script>
        (function () {
            // Detect platform - Twemoji only needed on Windows/Linux
            var ua = navigator.userAgent || '';
            var isWindows = /Windows/i.test(ua);
            var isLinux = /Linux/i.test(ua) && !/Android/i.test(ua);
            var needsTwemoji = isWindows || isLinux;

            window.heysPlatformNeedsTwemoji = needsTwemoji;

            // Get stored preference or auto-detect
            var stored = localStorage.getItem('heys_emoji_style');
            if (stored) {
                stored = stored.replace(/"/g, '');
            }

            // Auto mode: use twemoji on Windows/Linux, system on Mac/iOS/Android
            if (!stored || stored === 'auto' || stored === 'android' || stored === 'apple' || stored === 'null') {
                stored = needsTwemoji ? 'twemoji' : 'system';
                localStorage.setItem('heys_emoji_style', stored);
            }

            // Apply class
            document.body.classList.remove('emoji-system', 'emoji-twemoji');
            document.body.classList.add('emoji-' + stored);

            // Global state
            window.twemojiReady = false;
            window.heysEmojiStyle = stored;
            window.applyTwemoji = function () { };
            window.scheduleTwemojiParse = function () { };
        })();
    </script>

    <!-- Twemoji library - load only if needed (async to avoid parser-blocking) -->
    <script>
        if (window.heysPlatformNeedsTwemoji || window.heysEmojiStyle === 'twemoji') {
            (function () {
                var s = document.createElement('script');
                s.src = 'https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js';
                s.async = false; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                s.onload = function () { window.twemojiLoaded = true; };
                document.head.appendChild(s);
            })();
        }
    </script>

    <!-- Twemoji initialization - runs AFTER twemoji loads (only if loaded) -->
    <script>
        (function () {
            // Setup function to initialize Twemoji
            function initTwemoji() {
                if (!window.twemoji) return;

                window.twemojiReady = true;

                var parseTimeout = null;
                var isParsing = false;
                var pendingTarget = null;
                var lastParsedAt = 0;
                var MIN_PARSE_INTERVAL_MS = 120;

                function resolveTwemojiTarget(el) {
                    return el || document.getElementById('root') || document.body;
                }

                function runTwemojiParse(el) {
                    if (window.heysEmojiStyle !== 'twemoji') return;
                    if (!window.twemoji) return;
                    // –ù–µ –ø–∞—Ä—Å–∏—Ç—å —ç–º–æ–¥–∑–∏ –∫–æ–≥–¥–∞ –Ω–µ—Ç —Å–µ—Ç–∏ ‚Äî –∏–Ω–∞—á–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ SVG
                    if (!navigator.onLine) return;

                    // Ensure class is set
                    if (!document.body.classList.contains('emoji-twemoji')) {
                        document.body.classList.add('emoji-twemoji');
                    }

                    var target = resolveTwemojiTarget(el);

                    if (isParsing) {
                        pendingTarget = pendingTarget || target;
                        return;
                    }

                    var now = Date.now();
                    var elapsed = now - lastParsedAt;
                    if (elapsed < MIN_PARSE_INTERVAL_MS) {
                        if (parseTimeout) clearTimeout(parseTimeout);
                        parseTimeout = setTimeout(function () {
                            runTwemojiParse(target);
                        }, MIN_PARSE_INTERVAL_MS - elapsed);
                        return;
                    }

                    isParsing = true;
                    try {
                        twemoji.parse(target, {
                            folder: 'svg',
                            ext: '.svg',
                            base: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/'
                        });
                        lastParsedAt = Date.now();
                    } finally {
                        isParsing = false;
                    }

                    if (pendingTarget) {
                        var nextTarget = pendingTarget;
                        pendingTarget = null;
                        if (parseTimeout) clearTimeout(parseTimeout);
                        parseTimeout = setTimeout(function () {
                            runTwemojiParse(nextTarget);
                        }, MIN_PARSE_INTERVAL_MS);
                    }
                }

                // Apply Twemoji parsing
                window.applyTwemoji = function (el) {
                    runTwemojiParse(el);
                };

                // Debounced parse
                window.scheduleTwemojiParse = function (el) {
                    // –ù–µ —Å—Ç–∞–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä –µ—Å–ª–∏ –Ω–µ—Ç —Å–µ—Ç–∏
                    if (!navigator.onLine) return;
                    if (parseTimeout) clearTimeout(parseTimeout);
                    parseTimeout = setTimeout(function () {
                        runTwemojiParse(el);
                    }, 80);
                };

                // Parse immediately
                window.applyTwemoji(document.getElementById('root') || document.body);

                // MutationObserver for dynamic content
                var observer = new MutationObserver(function (mutations) {
                    var parseTarget = null;

                    for (var i = 0; i < mutations.length; i++) {
                        var m = mutations[i];

                        if (m.type === 'childList' && m.addedNodes && m.addedNodes.length) {
                            for (var j = 0; j < m.addedNodes.length; j++) {
                                var node = m.addedNodes[j];
                                if (node && node.nodeType === 1) {
                                    parseTarget = node;
                                    break;
                                }
                                if (node && node.nodeType === 3 && m.target && m.target.nodeType === 1) {
                                    parseTarget = m.target;
                                    break;
                                }
                            }
                        } else if (m.type === 'characterData' && m.target && m.target.parentElement) {
                            parseTarget = m.target.parentElement;
                        }

                        if (parseTarget) break;
                    }

                    if (parseTarget) {
                        window.scheduleTwemojiParse(parseTarget);
                    }
                });

                // Wait for root to exist
                var startObserver = function () {
                    var root = document.getElementById('root');
                    if (root) {
                        observer.observe(root, { childList: true, subtree: true, characterData: true });
                    } else {
                        setTimeout(startObserver, 10);
                    }
                };
                startObserver();

                // Reparse when back online
                window.addEventListener('online', function () {
                    window.scheduleTwemojiParse(document.getElementById('root') || document.body);
                });

                // One delayed pass after initial React mount
                setTimeout(function () {
                    window.scheduleTwemojiParse(document.getElementById('root') || document.body);
                }, 250);
            }

            // If Twemoji already loaded, init now. Otherwise wait for it.
            if (window.twemoji) {
                initTwemoji();
            } else if (window.heysPlatformNeedsTwemoji || window.heysEmojiStyle === 'twemoji') {
                // Wait for async script to load
                var checkInterval = setInterval(function () {
                    if (window.twemoji) {
                        clearInterval(checkInterval);
                        initTwemoji();
                    }
                }, 20);
                // Timeout after 5s
                setTimeout(function () { clearInterval(checkInterval); }, 5000);
            }
            // Else: not needed, stubs already set
        })();
    </script>

    <!-- libs with defer and priority for optimal loading -->
    <!-- React (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π –±–∞–Ω–¥–ª) - 152-–§–ó compliant, –±–µ–∑ CDN -->
    <!-- –í–ê–ñ–ù–û: –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –°–ò–ù–•–†–û–ù–ù–û –ø–µ—Ä–µ–¥ defer-—Å–∫—Ä–∏–ø—Ç–∞–º–∏ (blocking script) -->
    <!-- –°–æ–±–∏—Ä–∞–µ—Ç—Å—è: npx esbuild src/react-globals-sync.ts --bundle --format=iife --minify -->
    <script src="react-bundle.js"></script>
    <!-- Dark theme interceptor ‚Äî patches React.createElement for CSS var colors -->
    <script src="heys_dark_theme_interceptor.js"></script>
    <!-- Supabase CDN ‚Äî –£–î–ê–õ–Å–ù 2025-12-24 (152-–§–ó compliance)
         –ü—Ä–∏—á–∏–Ω–∞: SDK –¥–µ–ª–∞–ª –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–µ—Ä–∞–º Supabase (–ì–µ—Ä–º–∞–Ω–∏—è), 
         –Ω–∞—Ä—É—à–∞—è —Å—Ç.18 —á.5 152-–§–ó –æ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –ü–î–Ω.
         –ó–∞–º–µ–Ω–∞: YandexAPI (heys_yandex_api_v1.js) ‚Üí api.heyslab.ru
    -->

    <!-- üöÄ BOOT BUNDLES v9.0 (2026-02-25): 151 defer-—Ñ–∞–π–ª ‚Üí 5 bundle-—Ç–µ–≥–æ–≤
         –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: node scripts/bundle-legacy.mjs  (pnpm bundle:legacy)
         –°–æ—Å—Ç–∞–≤ –∏ —Ö–µ—à–∏: bundle-manifest.json
         –•–µ—à –≤ –∏–º–µ–Ω–∏ = –≤–µ—á–Ω—ã–π –∫—ç—à (cache-first SW). -->
    <script defer src="boot-core.bundle.d78546fb6349.js" fetchpriority="high"></script>
    <script defer src="boot-calc.bundle.9701e1633ac1.js"></script>
    <script defer src="boot-day.bundle.0f10e7bf96dc.js"></script>
    <script defer src="boot-app.bundle.e539ebd7a716.js"></script>
    <script defer src="boot-init.bundle.26d91a786979.js"
        onerror="window.__heysShowRecoveryUI && window.__heysShowRecoveryUI('CRITICAL_SCRIPT_LOAD: boot-init.bundle')"></script>

    <!-- PERF: Detect returning user (localStorage has profile) ‚Üí skip card unfold animations -->
    <script>
        (function () {
            try {
                var found = false;
                for (var i = 0; i < localStorage.length; i++) {
                    var k = localStorage.key(i);
                    if (k && k.indexOf('heys_') === 0 && k.indexOf('profile') !== -1) {
                        var v = localStorage.getItem(k);
                        if (v && v.length > 10) { found = true; break; }
                    }
                }
                if (found) window.__heysHasLocalData = true;
            } catch (e) { /* private browsing / quota */ }
        })();
    </script>

    <!-- üöÄ PERF v10.0 (2026-02-25): Post-boot ‚Üí 3 –±–∞–Ω–¥–ª–∞ –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–û.
         93 —Ñ–∞–π–ª–∞ ‚Üí postboot-1-game + postboot-2-insights + postboot-3-ui
         –ó–∞–≥—Ä—É–∑–∫–∞: Promise.all after window.__heysAppReady (30.6s ‚Üí ~10s).
         Event-driven architecture (Session 4) –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é
         –º–µ–∂–¥—É –±–∞–Ω–¥–ª–∞–º–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏.
         –•–µ—à –≤ –∏–º–µ–Ω–∏ = –≤–µ—á–Ω—ã–π –∫—ç—à (cache-first SW). -->
    <script>
        (function () {
            var POST_BOOT_BUNDLES = [
                'postboot-1-game.bundle.7f1c5f112d43.js',
                'postboot-2-insights.bundle.eeccbf4ef697.js',
                'postboot-3-ui.bundle.9df20d00d993.js'
            ];
            var total = POST_BOOT_BUNDLES.length;

            var pbStartTime = 0;
            var pbBundleTimes = {};

            function loadAllParallel() {
                var loaded = 0;
                var failed = 0;
                pbStartTime = Date.now();

                POST_BOOT_BUNDLES.forEach(function (src) {
                    var bundleStart = Date.now();
                    var s = document.createElement('script');
                    s.src = src;
                    s.async = true; // parallel download + execute
                    s.onload = function () {
                        loaded++;
                        var elapsed = Date.now() - bundleStart;
                        var shortName = src.replace(/\.bundle\.[a-f0-9]+\.js$/, '');
                        pbBundleTimes[shortName] = elapsed;
                        window.__heysPerfMark && window.__heysPerfMark('PostBoot: ' + shortName + ' loaded (' + elapsed + 'ms)');
                        if (loaded + failed === total) onAllDone();
                    };
                    s.onerror = function () {
                        failed++;
                        var shortName = src.replace(/\.bundle\.[a-f0-9]+\.js$/, '');
                        pbBundleTimes[shortName] = -1;
                        console.error('[HEYS.postboot] ‚ùå Failed to load: ' + src);
                        if (loaded + failed === total) onAllDone();
                    };
                    document.head.appendChild(s);
                });
            }

            function onAllDone() {
                var totalMs = Date.now() - pbStartTime;
                console.info('[HEYS.postboot] ‚úÖ All ' + total + ' post-boot bundles loaded (parallel) in ' + totalMs + 'ms');
                window.__heysPerfMark && window.__heysPerfMark('PostBoot: all bundles loaded (' + totalMs + 'ms parallel)');
                window.__heysPostbootDone = true;

                // üìä Per-bundle timing summary
                console.info('[HEYS.postboot] üìä Per-bundle timing:', JSON.stringify(pbBundleTimes));

                // üìä Resource Timing API: real network metrics (gzip sizes, TTFB, etc.)
                logResourceTimings();
            }

            // üìä Log boot bundle Resource Timing at appReady (before postboot starts)
            function logBootResourceTimings() {
                try {
                    if (!window.performance || !performance.getEntriesByType) return;
                    var entries = performance.getEntriesByType('resource');
                    var bootTotal = 0;
                    var bootDecoded = 0;
                    console.info('[PERF] üì¶ Boot Resource Timing (at appReady):');
                    entries.forEach(function (e) {
                        if (e.name.indexOf('boot-') === -1 && e.name.indexOf('react-bundle') === -1) return;
                        if (e.name.indexOf('postboot') !== -1) return;
                        var shortName = e.name.split('/').pop().replace(/\.bundle\.[a-f0-9]+\.js.*$/, '').replace('.js', '');
                        bootTotal += e.transferSize;
                        bootDecoded += e.decodedBodySize;
                        if (e.transferSize === 0) {
                            console.info('[PERF]   üíæ ' + shortName + ': CACHE HIT (' + (e.decodedBodySize / 1024).toFixed(0) + 'KB)');
                        } else {
                            var ratio = ((1 - e.transferSize / e.decodedBodySize) * 100).toFixed(0);
                            console.info('[PERF]   üì• ' + shortName + ': ' + (e.transferSize / 1024).toFixed(0) + 'KB ‚Üí ' + (e.decodedBodySize / 1024).toFixed(0) + 'KB (gzip ' + ratio + '%) | TTFB ' + Math.round(e.responseStart - e.requestStart) + 'ms, dl ' + Math.round(e.responseEnd - e.responseStart) + 'ms');
                        }
                    });
                    if (bootTotal > 0) {
                        console.info('[PERF] üìä Boot total: ' + (bootTotal / 1024).toFixed(0) + 'KB wire / ' + (bootDecoded / 1024).toFixed(0) + 'KB decoded');
                    } else if (bootDecoded > 0) {
                        console.info('[PERF] üìä Boot total: ALL FROM CACHE (' + (bootDecoded / 1024).toFixed(0) + 'KB decoded)');
                    }
                } catch (e) { /* Resource Timing unavailable */ }
            }

            // üìä Resource Timing API: gzip transfer sizes, TTFB, download duration
            function logResourceTimings() {
                try {
                    if (!window.performance || !performance.getEntriesByType) return;
                    var entries = performance.getEntriesByType('resource');
                    var bootBundles = [];
                    var postbootBundles = [];
                    var totalTransfer = 0;
                    var totalDecoded = 0;

                    entries.forEach(function (e) {
                        if (e.name.indexOf('.bundle.') === -1 && e.name.indexOf('react-bundle') === -1) return;
                        var shortName = e.name.split('/').pop().replace(/\.bundle\.[a-f0-9]+\.js.*$/, '').replace('.js', '');
                        var info = {
                            name: shortName,
                            transferKB: (e.transferSize / 1024).toFixed(1),
                            decodedKB: (e.decodedBodySize / 1024).toFixed(1),
                            ratio: e.transferSize > 0 ? ((1 - e.transferSize / e.decodedBodySize) * 100).toFixed(0) + '%' : 'cache',
                            ttfbMs: Math.round(e.responseStart - e.requestStart),
                            downloadMs: Math.round(e.responseEnd - e.responseStart),
                            totalMs: Math.round(e.responseEnd - e.startTime),
                            cached: e.transferSize === 0
                        };
                        totalTransfer += e.transferSize;
                        totalDecoded += e.decodedBodySize;

                        if (shortName.indexOf('boot-') === 0) bootBundles.push(info);
                        else if (shortName.indexOf('postboot-') === 0) postbootBundles.push(info);
                        else bootBundles.unshift(info); // react-bundle
                    });

                    if (bootBundles.length > 0) {
                        console.info('[PERF] üì¶ Boot bundles (Resource Timing):');
                        bootBundles.forEach(function (b) {
                            if (b.cached) {
                                console.info('[PERF]   üíæ ' + b.name + ': FROM CACHE (' + b.decodedKB + 'KB decoded)');
                            } else {
                                console.info('[PERF]   üì• ' + b.name + ': ' + b.transferKB + 'KB wire ‚Üí ' + b.decodedKB + 'KB decoded (gzip ' + b.ratio + ') | TTFB ' + b.ttfbMs + 'ms, download ' + b.downloadMs + 'ms, total ' + b.totalMs + 'ms');
                            }
                        });
                    }
                    if (postbootBundles.length > 0) {
                        console.info('[PERF] üì¶ PostBoot bundles (Resource Timing):');
                        postbootBundles.forEach(function (b) {
                            if (b.cached) {
                                console.info('[PERF]   üíæ ' + b.name + ': FROM CACHE (' + b.decodedKB + 'KB decoded)');
                            } else {
                                console.info('[PERF]   üì• ' + b.name + ': ' + b.transferKB + 'KB wire ‚Üí ' + b.decodedKB + 'KB decoded (gzip ' + b.ratio + ') | TTFB ' + b.ttfbMs + 'ms, download ' + b.downloadMs + 'ms, total ' + b.totalMs + 'ms');
                            }
                        });
                    }

                    var comprRatio = totalTransfer > 0 ? ((1 - totalTransfer / totalDecoded) * 100).toFixed(0) : '100';
                    console.info('[PERF] üìä TOTAL: ' + (totalTransfer / 1024).toFixed(0) + 'KB wire / ' + (totalDecoded / 1024).toFixed(0) + 'KB decoded (gzip savings: ' + comprRatio + '%) | cached: ' + (totalTransfer === 0 ? 'ALL' : 'partial'));

                    // üìä Full session summary
                    var bootTime = window.__heysBootStart ? ((Date.now() - window.__heysBootStart) / 1000).toFixed(1) : '?';
                    var skelDuration = window.__heysSkelReplacedAt && window.__heysSkelStart
                        ? ((window.__heysSkelReplacedAt - window.__heysSkelStart) / 1000).toFixed(1)
                        : '?';
                    console.info('[PERF] üèÅ SESSION SUMMARY: total=' + bootTime + 's, skeleton=' + skelDuration + 's visible, transfer=' + (totalTransfer / 1024).toFixed(0) + 'KB');
                } catch (e) {
                    console.warn('[PERF] ‚ö†Ô∏è Resource Timing unavailable:', e.message);
                }
            }

            var waitChecks = 0;
            function waitForAppReady() {
                waitChecks++;
                if (window.__heysAppReady) {
                    var appReadyMs = window.__heysBootStart ? (Date.now() - window.__heysBootStart) : 0;
                    console.info('[HEYS.postboot] üöÄ appReady detected after ' + (appReadyMs / 1000).toFixed(1) + 's, loading ' + total + ' post-boot bundles (parallel)');
                    window.__heysPerfMark && window.__heysPerfMark('PostBoot: bundle load started');

                    // üìä Log boot bundle Resource Timing immediately (before postboot starts)
                    logBootResourceTimings();

                    setTimeout(loadAllParallel, window.__heysHasLocalData ? 0 : 50);
                    return;
                }
                if (waitChecks > 600) {
                    console.warn('[HEYS.postboot] ‚ö†Ô∏è appReady timeout, loading post-boot bundles anyway');
                    setTimeout(loadAllParallel, 0);
                    return;
                }
                setTimeout(waitForAppReady, 100);
            }
            setTimeout(waitForAppReady, 200);
        })();
    </script>

    <!-- Service Worker —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ heys_platform_apis_v1.js ‚Üí registerServiceWorker() -->
</body>

</html>