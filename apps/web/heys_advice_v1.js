/**
 * HEYS Advice Module v1
 * ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒĞ¼Ğ½Ñ‹Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
 * 
 * @file heys_advice_v1.js
 * @version 1.1.0
 * @description Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ¸ Ğ´Ğ½Ñ
 * 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * ğŸ“‹ ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ Ğ ĞĞ‘ĞĞ¢Ğ« ĞœĞĞ”Ğ£Ğ›Ğ¯ Ğ¡ĞĞ’Ğ•Ğ¢ĞĞ’ (Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ)
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * ğŸ¯ ĞŸĞ Ğ˜ĞĞ Ğ˜Ğ¢Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ (Smart Scoring)
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞ¾Ğ²ĞµÑ‚ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ score = Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ + Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹:
 * 
 * 1. CTR Factor (Ğ´Ğ¾ +20 Ğ±Ğ°Ğ»Ğ»Ğ¾Ğ²)
 *    - Ğ•ÑĞ»Ğ¸ ÑĞ¾Ğ²ĞµÑ‚ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ»ÑÑ â‰¥3 Ñ€Ğ°Ğ·, ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ clicked/shown
 *    - Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ CTR â†’ Ñ‡Ğ°Ñ‰Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼
 * 
 * 2. Rating Factor (Â±12 Ğ±Ğ°Ğ»Ğ»Ğ¾Ğ²)
 *    - ğŸ‘ ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚, ğŸ‘ ÑƒĞ¼ĞµĞ½ÑŒÑˆĞ°ĞµÑ‚
 *    - ĞÑƒĞ¶Ğ½Ğ¾ â‰¥2 Ğ¾Ñ†ĞµĞ½ĞºĞ¸ Ğ´Ğ»Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ°
 * 
 * 3. Recency Factor (Ğ´Ğ¾ +15 Ğ±Ğ°Ğ»Ğ»Ğ¾Ğ²)
 *    - Ğ”Ğ°Ğ²Ğ½Ğ¾ Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ»Ğ¸ â†’ Ğ±Ğ¾Ğ½ÑƒÑ
 *    - ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ»Ğ¸ â†’ +3 Ğ±Ğ°Ğ»Ğ»Ğ°
 * 
 * 4. Relevance Factor (Ğ´Ğ¾ +6 Ğ±Ğ°Ğ»Ğ»Ğ¾Ğ²)
 *    - Ğ¡Ğ¾Ğ²ĞµÑ‚ Ğ¿Ñ€Ğ¾ Ğ±ĞµĞ»Ğ¾Ğº + Ğ±ĞµĞ»ĞºĞ° Ğ¼Ğ°Ğ»Ğ¾ â†’ Ğ²Ñ‹ÑĞ¾ĞºĞ°Ñ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ
 * 
 * ğŸ”„ Ğ”Ğ•Ğ”Ğ£ĞŸĞ›Ğ˜ĞšĞĞ¦Ğ˜Ğ¯
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * Ğ¡Ğ¼. DEDUPLICATION_RULES â€” Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ².
 * Ğ˜Ğ· Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ 1 ÑĞ¾Ğ²ĞµÑ‚ Ğ·Ğ° ÑĞµÑÑĞ¸Ñ.
 * 
 * â° Ğ’Ğ Ğ•ĞœĞ¯ Ğ¡Ğ£Ğ¢ĞĞš
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * Ğ¡Ğ¼. TIME_BASED_TEXTS â€” Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ ÑƒÑ‚Ñ€Ğ¾Ğ¼/Ğ´Ğ½Ñ‘Ğ¼/Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼.
 * Ğ¡Ğ¼. TIME_RESTRICTIONS â€” ĞºĞ°ĞºĞ¸Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ ĞĞ• Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ² Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ.
 * 
 * ğŸ”— Ğ¡Ğ’Ğ¯Ğ—ĞĞĞĞ«Ğ• Ğ¡ĞĞ’Ğ•Ğ¢Ğ« (Chains)
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * Ğ¡Ğ¼. ADVICE_CHAINS â€” Ğ¿Ğ¾ÑĞ»Ğµ ÑĞ¾Ğ²ĞµÑ‚Ğ° A Ñ‡ĞµÑ€ĞµĞ· N Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¾Ğ²ĞµÑ‚ B.
 * ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: "Ğ¼Ğ°Ğ»Ğ¾ Ğ±ĞµĞ»ĞºĞ°" â†’ Ñ‡ĞµÑ€ĞµĞ· 30 Ğ¼Ğ¸Ğ½ â†’ "Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ±ĞµĞ»ĞºĞ°"
 * 
 * ğŸ­ Ğ­ĞœĞĞ¦Ğ˜ĞĞĞĞ›Ğ¬ĞĞĞ¯ ĞĞ”ĞĞŸĞ¢ĞĞ¦Ğ˜Ğ¯
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * Ğ¡Ğ¼. MOOD_TONES â€” Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¹ Ñ‚Ğ¾Ğ½ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.
 * ĞŸĞ»Ğ¾Ñ…Ğ¾Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ â†’ Ğ¼ÑĞ³Ñ‡Ğµ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸, Ğ¼ĞµĞ½ÑŒÑˆĞµ ĞºÑ€Ğ¸Ñ‚Ğ¸ĞºĞ¸.
 * 
 * ğŸ“Š Ğ¢Ğ Ğ•ĞšĞ˜ĞĞ“ Ğ˜ ĞĞĞĞ›Ğ˜Ğ¢Ğ˜ĞšĞ
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * - heys_advice_stats: Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹, ĞºĞ»Ğ¸ĞºĞ¸, lastShown (Ğ°Ğ²Ñ‚Ğ¾Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ° >30 Ğ´Ğ½ĞµĞ¹)
 * - heys_advice_ratings: ğŸ‘/ğŸ‘ Ğ¾Ñ†ĞµĞ½ĞºĞ¸ (Ğ°Ğ²Ñ‚Ğ¾Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ° >60 Ğ´Ğ½ĞµĞ¹)
 * - heys_scheduled_advices: Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ (â° 2Ñ‡)
 * 
 * ğŸš« ĞĞĞ¢Ğ˜-Ğ¡ĞŸĞĞœ
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * - MAX_ADVICES_PER_SESSION = 10 ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² Ğ·Ğ° ÑĞµÑÑĞ¸Ñ
 * - MAX_ADVICES_PER_CATEGORY = 2 ÑĞ¾Ğ²ĞµÑ‚Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
 * - ADVICE_COOLDOWN_MS = 30 ÑĞµĞº Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ¾Ğ²ĞµÑ‚Ğ°Ğ¼Ğ¸
 * 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

(function() {
  'use strict';
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONFIGURATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const MAX_ADVICES_PER_SESSION = 10;
  const ADVICE_COOLDOWN_MS = 30000; // 30 ÑĞµĞºÑƒĞ½Ğ´ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ¾Ğ²ĞµÑ‚Ğ°Ğ¼Ğ¸
  const SESSION_KEY = 'heys_advice_session';
  const TRACKING_KEY = 'heys_advice_stats';
  const MAX_ADVICES_PER_CATEGORY = 2; // ĞĞ½Ñ‚Ğ¸-ÑĞ¿Ğ°Ğ¼: max ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // THRESHOLDS â€” ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğµ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ¸ (Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ğ¼Ğ°Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ñ‡Ğ¸ÑĞµĞ»)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const THRESHOLDS = {
    // Ğ‘ĞµĞ»Ğ¾Ğº
    protein: {
      low: 0.5,        // < 50% â€” ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¼Ğ°Ğ»Ğ¾
      adequate: 0.8,   // < 80% â€” Ğ¼Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚Ğ¾
      good: 0.9,       // 90%+ â€” Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾
      high: 1.2,       // 120%+ â€” Ğ¼Ğ½Ğ¾Ğ³Ğ¾ (achievement)
      champion: 1.2    // Ğ‘ĞµĞ»ĞºĞ¾Ğ²Ñ‹Ğ¹ Ñ‡ĞµĞ¼Ğ¿Ğ¸Ğ¾Ğ½
    },
    // ĞšĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ°
    fiber: {
      low: 0.3,        // < 30% â€” Ğ¼Ğ°Ğ»Ğ¾
      adequate: 0.5,   // < 50% â€” Ğ¼Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚Ğ¾
      good: 1.0        // 100%+ â€” Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾
    },
    // Ğ–Ğ¸Ñ€Ñ‹
    fat: {
      goodRatioLow: 0.4,  // < 40% Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ñ… = Ğ¿Ğ»Ğ¾Ñ…Ğ¾
      goodRatioGood: 0.6  // 60%+ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ñ… = Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾
    },
    // Ğ£Ğ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹
    carbs: {
      simpleExcess: 1.3,  // > 130% Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ…
      simpleRatioMax: 0.5, // > 50% Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… Ğ¾Ñ‚ Ğ²ÑĞµÑ…
      simpleRatioGood: 0.3 // < 30% â€” Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾
    },
    // ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸
    kcal: {
      undereating: 0.6,   // < 60% Ğº Ğ¾Ğ±ĞµĞ´Ñƒ â€” Ğ¼Ğ°Ğ»Ğ¾
      evening: 0.7        // < 70% Ğº Ğ²ĞµÑ‡ĞµÑ€Ñƒ â€” Ğ½ĞµĞ´Ğ¾ĞµĞ»
    },
    // Ğ¢Ñ€Ğ°Ğ½Ñ-Ğ¶Ğ¸Ñ€Ñ‹ Ğ¸ Ğ²Ñ€ĞµĞ´
    trans: { excess: 1.0 },
    harm: { excess: 1.0 },
    // Ğ“Ğ»Ğ¸ĞºĞµĞ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ
    gi: {
      high: 70,
      low: 55
    },
    // Ğ’Ğ¾Ğ´Ğ°
    water: {
      eveningLow: 0.5,
      hoursSinceMax: 2
    },
    // Ğ¡Ğ¾Ğ½
    sleep: {
      low: 6,
      deficit: 1.5,
      deficitHigh: 2
    },
    // Ğ¡Ñ‚Ñ€ĞµÑÑ
    stress: {
      high: 4,
      low: 2
    },
    // ĞŸÑ€Ğ¸Ñ‘Ğ¼Ñ‹ Ğ¿Ğ¸Ñ‰Ğ¸
    meal: {
      tooLarge: 800,     // ĞºĞºĞ°Ğ»
      tooSmall: 150,     // ĞºĞºĞ°Ğ»
      proteinMin: 20,    // Ğ³ Ğ±ĞµĞ»ĞºĞ° Ğ½Ğ° Ğ¿Ñ€Ğ¸Ñ‘Ğ¼
      eveningCarbsMax: 50, // Ğ³ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼
      fiberGood: 8       // Ğ³ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ¸ â€” Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾
    },
    // Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸
    training: {
      highIntensityMin: 20, // Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ´Ğ»Ñ hard_workout
      fatBurnMin: 30,       // Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¶Ğ¸Ñ€Ğ¾ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ñ
      greatWorkout: 45      // Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ´Ğ»Ñ great_workout
    },
    // ĞœĞ°ĞºÑ€Ğ¾ÑÑ‹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ
    macros: {
      balanceMin: 0.9,
      balanceMax: 1.2
    }
  };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PRODUCT CATEGORIES CONFIG â€” ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ²
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const PRODUCT_CATEGORIES = {
    vegetables: {
      keywords: ['Ğ¾Ğ³ÑƒÑ€ĞµÑ†', 'Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€', 'Ñ‚Ğ¾Ğ¼Ğ°Ñ‚', 'Ğ¼Ğ¾Ñ€ĞºĞ¾Ğ²ÑŒ', 'ĞºĞ°Ğ¿ÑƒÑÑ‚Ğ°', 'Ğ±Ñ€Ğ¾ĞºĞºĞ¾Ğ»Ğ¸', 'ÑˆĞ¿Ğ¸Ğ½Ğ°Ñ‚', 'ÑĞ°Ğ»Ğ°Ñ‚', 'Ğ¿ĞµÑ€ĞµÑ†', 'Ğ»ÑƒĞº', 'Ñ‡ĞµÑĞ½Ğ¾Ğº', 'ĞºĞ°Ğ±Ğ°Ñ‡Ğ¾Ğº', 'Ğ±Ğ°ĞºĞ»Ğ°Ğ¶Ğ°Ğ½', 'ÑĞ²Ñ‘ĞºĞ»Ğ°', 'Ñ€ĞµĞ´Ğ¸Ñ', 'ÑĞµĞ»ÑŒĞ´ĞµÑ€ĞµĞ¹', 'Ğ¿ĞµÑ‚Ñ€ÑƒÑˆĞºĞ°', 'ÑƒĞºÑ€Ğ¾Ğ¿', 'Ñ€ÑƒĞºĞºĞ¾Ğ»Ğ°', 'Ñ†Ğ²ĞµÑ‚Ğ½Ğ°Ñ', 'Ñ‚Ñ‹ĞºĞ²Ğ°', 'Ğ³Ğ¾Ñ€Ğ¾Ñ…', 'Ñ„Ğ°ÑĞ¾Ğ»ÑŒ Ğ·ĞµĞ»Ñ‘Ğ½Ğ°Ñ'],
      icon: 'ğŸ¥—',
      advice: 'Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ¼Ğ°Ğ»Ğ¾ Ğ¾Ğ²Ğ¾Ñ‰ĞµĞ¹ â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ ÑĞ°Ğ»Ğ°Ñ‚ Ğ¸Ğ»Ğ¸ Ğ³Ğ°Ñ€Ğ½Ğ¸Ñ€',
      goodAdvice: 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ Ñ Ğ¾Ğ²Ğ¾Ñ‰Ğ°Ğ¼Ğ¸ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ!'
    },
    fruits: {
      keywords: ['ÑĞ±Ğ»Ğ¾ĞºĞ¾', 'Ğ±Ğ°Ğ½Ğ°Ğ½', 'Ğ°Ğ¿ĞµĞ»ÑŒÑĞ¸Ğ½', 'Ğ¼Ğ°Ğ½Ğ´Ğ°Ñ€Ğ¸Ğ½', 'Ğ³Ñ€ÑƒÑˆĞ°', 'Ğ²Ğ¸Ğ½Ğ¾Ğ³Ñ€Ğ°Ğ´', 'Ğ¿ĞµÑ€ÑĞ¸Ğº', 'Ğ°Ğ±Ñ€Ğ¸ĞºĞ¾Ñ', 'ÑĞ»Ğ¸Ğ²Ğ°', 'ĞºĞ¸Ğ²Ğ¸', 'Ğ¼Ğ°Ğ½Ğ³Ğ¾', 'Ğ°Ğ½Ğ°Ğ½Ğ°Ñ', 'Ğ°Ñ€Ğ±ÑƒĞ·', 'Ğ´Ñ‹Ğ½Ñ', 'ĞºĞ»ÑƒĞ±Ğ½Ğ¸ĞºĞ°', 'Ğ¼Ğ°Ğ»Ğ¸Ğ½Ğ°', 'Ñ‡ĞµÑ€Ğ½Ğ¸ĞºĞ°', 'ÑĞ³Ğ¾Ğ´', 'ÑĞ³Ğ¾Ğ´Ñ‹', 'Ğ³Ñ€Ğ°Ğ½Ğ°Ñ‚', 'Ğ³Ñ€ĞµĞ¹Ğ¿Ñ„Ñ€ÑƒÑ‚', 'Ğ»Ğ¸Ğ¼Ğ¾Ğ½'],
      icon: 'ğŸ',
      advice: 'Ğ¤Ñ€ÑƒĞºÑ‚Ñ‹ â€” Ğ¿Ñ€Ğ¸Ñ€Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ²Ğ¸Ñ‚Ğ°Ğ¼Ğ¸Ğ½Ñ‹. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¾Ğ´Ğ¸Ğ½ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ',
      goodAdvice: 'Ğ¤Ñ€ÑƒĞºÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ!'
    },
    dairy: {
      keywords: ['Ğ¼Ğ¾Ğ»Ğ¾ĞºĞ¾', 'ĞºĞµÑ„Ğ¸Ñ€', 'Ğ¹Ğ¾Ğ³ÑƒÑ€Ñ‚', 'Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³', 'ÑÑ‹Ñ€', 'ÑĞ¼ĞµÑ‚Ğ°Ğ½Ğ°', 'Ñ€ÑĞ¶ĞµĞ½ĞºĞ°', 'Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ĞºĞ²Ğ°ÑˆĞ°', 'Ğ¼Ğ°ÑĞ»Ğ¾ ÑĞ»Ğ¸Ğ²Ğ¾Ñ‡Ğ½Ğ¾Ğµ', 'ÑĞ»Ğ¸Ğ²ĞºĞ¸', 'Ğ¼Ğ°Ñ†Ğ¾Ğ½Ğ¸', 'Ğ±Ñ€Ñ‹Ğ½Ğ·Ğ°', 'Ğ¿Ğ°Ñ€Ğ¼ĞµĞ·Ğ°Ğ½', 'Ğ¼Ğ¾Ñ†Ğ°Ñ€ĞµĞ»Ğ»Ğ°', 'Ñ€Ğ¸ĞºĞ¾Ñ‚Ñ‚Ğ°'],
      icon: 'ğŸ¥›',
      advice: 'ĞœĞ¾Ğ»Ğ¾Ñ‡ĞºĞ° = ĞºĞ°Ğ»ÑŒÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ ĞºĞ¾ÑÑ‚ĞµĞ¹. Ğ¢Ğ²Ğ¾Ñ€Ğ¾Ğ³ Ğ¸Ğ»Ğ¸ Ğ¹Ğ¾Ğ³ÑƒÑ€Ñ‚?',
      goodAdvice: 'ĞšĞ°Ğ»ÑŒÑ†Ğ¸Ğ¹ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ!'
    },
    fish: {
      keywords: ['Ñ€Ñ‹Ğ±Ğ°', 'Ğ»Ğ¾ÑĞ¾ÑÑŒ', 'ÑÑ‘Ğ¼Ğ³Ğ°', 'Ñ„Ğ¾Ñ€ĞµĞ»ÑŒ', 'ÑĞºÑƒĞ¼Ğ±Ñ€Ğ¸Ñ', 'Ñ‚Ñ€ĞµÑĞºĞ°', 'Ñ‚ÑƒĞ½ĞµÑ†', 'ÑĞµĞ»ÑŒĞ´ÑŒ', 'ĞºĞ°Ñ€Ğ¿', 'Ğ¾ĞºÑƒĞ½ÑŒ', 'ÑÑƒĞ´Ğ°Ğº', 'Ğ¼Ğ¸Ğ½Ñ‚Ğ°Ğ¹', 'Ğ´Ğ¾Ñ€Ğ°Ğ´Ğ¾', 'ÑĞ¸Ğ±Ğ°Ñ', 'ĞºÑ€ĞµĞ²ĞµÑ‚Ğº', 'Ğ¼Ğ¸Ğ´Ğ¸Ğ¸', 'ĞºĞ°Ğ»ÑŒĞ¼Ğ°Ñ€', 'Ğ¼Ğ¾Ñ€ĞµĞ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚'],
      icon: 'ğŸŸ',
      advice: 'Ğ Ñ‹Ğ±Ğ° 2-3 Ñ€Ğ°Ğ·Ğ° Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ â€” ĞĞ¼ĞµĞ³Ğ°-3 Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ·Ğ³Ğ°',
      goodAdvice: 'ĞĞ¼ĞµĞ³Ğ°-3 Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»!'
    },
    meat: {
      keywords: ['Ğ¼ÑÑĞ¾', 'Ğ³Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ°', 'ÑĞ²Ğ¸Ğ½Ğ¸Ğ½Ğ°', 'ĞºÑƒÑ€Ğ¸Ñ†Ğ°', 'ĞºÑƒÑ€Ğ¸Ñ†', 'Ğ¸Ğ½Ğ´ĞµĞ¹ĞºĞ°', 'Ğ±Ğ°Ñ€Ğ°Ğ½Ğ¸Ğ½Ğ°', 'ĞºÑ€Ğ¾Ğ»Ğ¸Ğº', 'ÑƒÑ‚ĞºĞ°', 'Ğ³ÑƒÑÑŒ', 'Ñ‚ĞµĞ»ÑÑ‚Ğ¸Ğ½Ğ°', 'Ñ„Ğ°Ñ€Ñˆ', 'ÑÑ‚ĞµĞ¹Ğº', 'Ñ„Ğ¸Ğ»Ğµ', 'Ğ³Ñ€ÑƒĞ´ĞºĞ°', 'Ğ±ĞµĞ´Ñ€Ğ¾', 'ĞºĞ¾Ñ‚Ğ»ĞµÑ‚', 'ÑˆĞ°ÑˆĞ»Ñ‹Ğº'],
      icon: 'ğŸ¥©',
      advice: 'ĞœÑÑĞ¾ â€” Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ±ĞµĞ»ĞºĞ° Ğ¸ Ğ¶ĞµĞ»ĞµĞ·Ğ°',
      goodAdvice: 'Ğ‘ĞµĞ»Ğ¾Ğº Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»!'
    },
    grains: {
      keywords: ['Ğ³Ñ€ĞµÑ‡ĞºĞ°', 'Ñ€Ğ¸Ñ', 'Ğ¾Ğ²ÑÑĞ½ĞºĞ°', 'Ğ¾Ğ²Ñ‘Ñ', 'Ğ¿ÑˆĞµĞ½Ğ¾', 'Ğ¿ĞµÑ€Ğ»Ğ¾Ğ²ĞºĞ°', 'Ğ±ÑƒĞ»Ğ³ÑƒÑ€', 'ĞºÑƒÑĞºÑƒÑ', 'ĞºĞ¸Ğ½Ğ¾Ğ°', 'Ğ¼Ğ°ĞºĞ°Ñ€Ğ¾Ğ½', 'Ğ¿Ğ°ÑÑ‚Ğ°', 'ÑĞ¿Ğ°Ğ³ĞµÑ‚Ñ‚Ğ¸', 'Ñ…Ğ»ĞµĞ±', 'Ğ±Ğ°Ñ‚Ğ¾Ğ½', 'Ğ»Ğ°Ğ²Ğ°Ñˆ', 'ĞºĞ°ÑˆĞ°'],
      icon: 'ğŸŒ¾',
      advice: 'Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ â€” ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ½Ğ° Ğ²ĞµÑÑŒ Ğ´ĞµĞ½ÑŒ',
      goodAdvice: 'Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ°!'
    },
    nuts: {
      keywords: ['Ğ¾Ñ€ĞµÑ…', 'Ğ¼Ğ¸Ğ½Ğ´Ğ°Ğ»ÑŒ', 'Ğ³Ñ€ĞµÑ†Ğº', 'Ñ„ÑƒĞ½Ğ´ÑƒĞº', 'ĞºĞµÑˆÑŒÑ', 'Ñ„Ğ¸ÑÑ‚Ğ°ÑˆĞº', 'Ğ°Ñ€Ğ°Ñ…Ğ¸Ñ', 'ĞºĞµĞ´Ñ€Ğ¾Ğ²', 'Ğ¼Ğ°ĞºĞ°Ğ´Ğ°Ğ¼Ğ¸Ñ', 'Ğ¿ĞµĞºĞ°Ğ½', 'ÑĞµĞ¼ĞµÑ‡Ğº', 'ÑĞµĞ¼ĞµĞ½Ğ°', 'Ñ‚Ñ‹ĞºĞ²ĞµĞ½Ğ½', 'Ğ¿Ğ¾Ğ´ÑĞ¾Ğ»Ğ½', 'Ñ‡Ğ¸Ğ°', 'Ğ»Ñ‘Ğ½'],
      icon: 'ğŸ¥œ',
      advice: 'ĞÑ€ĞµÑ…Ğ¸ â€” Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ¶Ğ¸Ñ€Ñ‹ Ğ¸ Ğ±ĞµĞ»Ğ¾Ğº. Ğ“Ğ¾Ñ€ÑÑ‚ÑŒ Ğ² Ğ´ĞµĞ½ÑŒ',
      goodAdvice: 'ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ¶Ğ¸Ñ€Ñ‹ âœ“'
    },
    eggs: {
      keywords: ['ÑĞ¹Ñ†Ğ¾', 'ÑĞ¹Ñ†Ğ°', 'Ğ¾Ğ¼Ğ»ĞµÑ‚', 'ÑĞ¸Ñ‡Ğ½Ğ¸Ñ†Ğ°', 'Ğ³Ğ»Ğ°Ğ·ÑƒĞ½ÑŒÑ', 'ÑĞºÑ€Ğ°Ğ¼Ğ±Ğ»'],
      icon: 'ğŸ¥š',
      advice: 'Ğ¯Ğ¹Ñ†Ğ° â€” Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±ĞµĞ»Ğ¾Ğº. 2-3 Ğ² Ğ´ĞµĞ½ÑŒ Ğ½Ğ¾Ñ€Ğ¼Ğ°',
      goodAdvice: 'Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±ĞµĞ»Ğ¾Ğº!'
    }
  };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DEDUPLICATION_RULES â€” Ğ“Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ 1 Ğ¸Ğ· Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const DEDUPLICATION_RULES = {
    // Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° "Ğ±ĞµĞ»Ğ¾Ğº" â€” Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² Ğ¿Ñ€Ğ¾ Ğ±ĞµĞ»Ğ¾Ğº Ğ¿Ğ¾Ğ´Ñ€ÑĞ´
    protein: ['protein_low', 'protein_sources', 'post_training_protein', 'age_protein', 'bedtime_protein', 'protein_champion', 'protein_per_meal_low'],
    // Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° "Ğ²Ğ¾Ğ´Ğ°"
    water: ['water_reminder', 'water_evening_low', 'water_goal_reached', 'water_benefits', 'super_hydration'],
    // Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° "ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹"
    carbs: ['simple_carbs_warning', 'complex_carbs_tip', 'carbs_balance_perfect', 'simple_complex_ratio', 'evening_carbs_high'],
    // Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° "ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ°"
    fiber: ['fiber_low', 'fiber_good', 'fiber_sources', 'fiber_per_meal_good'],
    // Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° "Ğ¶Ğ¸Ñ€Ñ‹"
    fat: ['fat_quality_low', 'fat_quality_great', 'good_fat_low', 'trans_fat_warning'],
    // Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° "ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸"
    kcal: ['kcal_excess_critical', 'kcal_excess_mild', 'kcal_under_critical', 'evening_undereating', 'evening_perfect'],
    // Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° "ÑĞ¾Ğ½"
    sleep: ['sleep_low', 'bad_sleep_advice', 'great_sleep', 'sleep_hunger_correlation', 'sleep_debt_accumulating'],
    // Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° "Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸"
    training: ['post_training_protein', 'hard_workout_recovery', 'cardio_carbs_balance', 'great_workout', 'training_recovery_window'],
    // Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° "Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ"
    mood: ['stress_support', 'crash_support', 'mood_improving', 'sugar_mood_crash', 'wellbeing_low_food']
  };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // TIME_RESTRICTIONS â€” ĞšĞ¾Ğ³Ğ´Ğ° ĞĞ• Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const TIME_RESTRICTIONS = {
    // ĞĞµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ²ĞµÑ‚ Ğ¿Ñ€Ğ¾ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº Ğ¿Ğ¾ÑĞ»Ğµ 12:00
    'morning_breakfast': { notAfterHour: 12 },
    // Ğ¡Ğ¾Ğ²ĞµÑ‚ Ğ¿Ñ€Ğ¾ Ğ¾Ğ±ĞµĞ´ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ 11 Ğ´Ğ¾ 15
    'lunch_time': { onlyBetweenHours: [11, 15] },
    // ĞŸĞ¾Ğ»Ğ´Ğ½Ğ¸Ğº â€” Ñ 15 Ğ´Ğ¾ 18
    'snack_window': { onlyBetweenHours: [15, 18] },
    // Ğ’ĞµÑ‡ĞµÑ€Ğ½Ğ¸Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ â€” Ğ¿Ğ¾ÑĞ»Ğµ 18
    'evening_undereating': { notBeforeHour: 18 },
    'evening_perfect': { notBeforeHour: 20 },
    'evening_carbs_high': { notBeforeHour: 19 },
    'late_dinner_warning': { notBeforeHour: 21 },
    'bedtime_protein': { onlyBetweenHours: [20, 23] },
    // ĞĞ¾Ñ‡Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
    'night_owl_warning': { onlyBetweenHours: [1, 5] },
    // Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ñ€Ğ¾ ÑĞ¾Ğ½ ÑƒÑ‚Ñ€Ğ¾Ğ¼
    'bad_sleep_advice': { notAfterHour: 12 },
    'sleep_hunger_warning': { notAfterHour: 14 }
  };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADVICE CHAINS â€” Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const ADVICE_CHAINS = {
    // ĞŸĞ¾ÑĞ»Ğµ ÑĞ¾Ğ²ĞµÑ‚Ğ° A, Ñ‡ĞµÑ€ĞµĞ· Ğ²Ñ€ĞµĞ¼Ñ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¾Ğ²ĞµÑ‚ B
    'protein_low': { next: 'protein_sources', delayMinutes: 30 },
    'fiber_low': { next: 'fiber_sources', delayMinutes: 30 },
    'water_reminder': { next: 'water_benefits', delayMinutes: 60 },
    'simple_carbs_warning': { next: 'complex_carbs_tip', delayMinutes: 20 },
    'fat_quality_low': { next: 'good_fat_sources', delayMinutes: 45 },
    'sleep_low': { next: 'sleep_tips', delayMinutes: 120 }
  };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // STREAK MILESTONES â€” Ğ“ĞµĞ¹Ğ¼Ğ¼Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const STREAK_MILESTONES = [
    { days: 3, icon: 'ğŸ”¥', text: 'Ğ•Ñ‰Ñ‘ ${remain} Ğ´Ğ½ĞµĞ¹ Ğ´Ğ¾ streak 3!' },
    { days: 7, icon: 'â­', text: 'Ğ•Ñ‰Ñ‘ ${remain} Ğ´Ğ½ĞµĞ¹ Ğ´Ğ¾ Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ streak!' },
    { days: 14, icon: 'ğŸ’', text: 'Ğ•Ñ‰Ñ‘ ${remain} Ğ´Ğ½ĞµĞ¹ Ğ´Ğ¾ Ğ´Ğ²ÑƒÑ…Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ streak!' },
    { days: 30, icon: 'ğŸ†', text: 'Ğ•Ñ‰Ñ‘ ${remain} Ğ´Ğ½ĞµĞ¹ Ğ´Ğ¾ Ğ¼ĞµÑÑÑ‡Ğ½Ğ¾Ğ³Ğ¾ streak!' }
  ];
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DISMISS TRACKING â€” Ğ£Ğ¼Ğ½Ğ¾Ğµ ÑĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const QUICK_DISMISS_THRESHOLD_MS = 1500; // Ğ•ÑĞ»Ğ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ğ»Ğ¸ Ğ·Ğ° 1.5 ÑĞµĞº â€” Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾
  const DISMISS_PENALTY_FACTOR = 0.5;      // Ğ¡Ğ½Ğ¸Ğ¶Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ Ğ½Ğ° 50%
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DYNAMIC TTL CONFIG
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const TTL_CONFIG = {
    minTTL: 4000,      // ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 4 ÑĞµĞº
    maxTTL: 12000,     // ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 12 ÑĞµĞº
    msPerChar: 50,     // 50Ğ¼Ñ Ğ½Ğ° ÑĞ¸Ğ¼Ğ²Ğ¾Ğ» (~20 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²/ÑĞµĞº = Ğ½Ğ¾Ñ€Ğ¼. ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ)
    criticalBonus: 2000 // +2 ÑĞµĞº Ğ´Ğ»Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ…
  };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADVICE RATING â€” Feedback ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const RATING_KEY = 'heys_advice_ratings';
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // TIME-BASED ADVICE VARIANTS â€” Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ‚ĞµĞºÑÑ‚Ñ‹ Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ÑÑƒÑ‚Ğ¾Ğº
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const TIME_BASED_TEXTS = {
    protein_low: {
      morning: ['Ğ£Ñ‚Ñ€Ğ¾Ğ¼ Ğ±ĞµĞ»Ğ¾Ğº Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ Ğ²Ğ°Ğ¶ĞµĞ½ â€” Ğ¾Ğ¼Ğ»ĞµÑ‚ Ğ¸Ğ»Ğ¸ Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³?', 'ĞĞ°Ñ‡Ğ½Ğ¸ Ğ´ĞµĞ½ÑŒ Ñ Ğ±ĞµĞ»ĞºĞ° â€” ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸ Ñ…Ğ²Ğ°Ñ‚Ğ¸Ñ‚ Ğ´Ğ¾ Ğ¾Ğ±ĞµĞ´Ğ°'],
      afternoon: ['ĞĞ±ĞµĞ´ Ğ±ĞµĞ· Ğ±ĞµĞ»ĞºĞ° â€” Ğº Ğ²ĞµÑ‡ĞµÑ€Ñƒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ³Ğ¾Ğ»Ğ¾Ğ´', 'Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ±ĞµĞ»ĞºĞ° Ğ² Ğ¾Ğ±ĞµĞ´ â€” ĞºÑƒÑ€Ğ¸Ñ†Ğ°, Ñ€Ñ‹Ğ±Ğ°, Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³'],
      evening: ['Ğ’ĞµÑ‡ĞµÑ€Ğ½Ğ¸Ğ¹ Ğ±ĞµĞ»Ğ¾Ğº = Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ñ‹ÑˆÑ† Ğ½Ğ¾Ñ‡ÑŒÑ', 'ĞĞ° ÑƒĞ¶Ğ¸Ğ½ Ğ±ĞµĞ»Ğ¾Ğº â€” Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³, Ñ€Ñ‹Ğ±Ğ°, ÑĞ¹Ñ†Ğ°']
    },
    water_reminder: {
      morning: ['Ğ¡Ñ‚Ğ°ĞºĞ°Ğ½ Ğ²Ğ¾Ğ´Ñ‹ Ñ ÑƒÑ‚Ñ€Ğ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼ â˜€ï¸', 'ĞĞ°Ñ‡Ğ½Ğ¸ Ğ´ĞµĞ½ÑŒ Ñ Ğ²Ğ¾Ğ´Ñ‹ â€” Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ¼ ÑĞºĞ°Ğ¶ĞµÑ‚ ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾'],
      afternoon: ['Ğ¡ĞµÑ€ĞµĞ´Ğ¸Ğ½Ğ° Ğ´Ğ½Ñ â€” Ğ²Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ²Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ ğŸ’§', 'ĞĞµ Ğ·Ğ°Ğ±Ñ‹Ğ²Ğ°Ğ¹ Ğ¿Ğ¸Ñ‚ÑŒ â€” Ğ´Ğ¾ Ğ²ĞµÑ‡ĞµÑ€Ğ° ĞµÑ‰Ñ‘ Ğ´Ğ°Ğ»ĞµĞºĞ¾'],
      evening: ['Ğ’ĞµÑ‡ĞµÑ€Ğ¾Ğ¼ Ğ¿ĞµĞ¹ ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾, Ğ½Ğ¾ Ğ½Ğµ Ğ·Ğ°Ğ±Ñ‹Ğ²Ğ°Ğ¹ Ğ¾ Ğ²Ğ¾Ğ´Ğµ', 'Ğ¡Ñ‚Ğ°ĞºĞ°Ğ½ Ğ²Ğ¾Ğ´Ñ‹ Ğ¿ĞµÑ€ĞµĞ´ ÑĞ½Ğ¾Ğ¼ â€” Ğ½Ğ¾ Ğ½Ğµ Ğ¿Ğ¾Ğ·Ğ¶Ğµ Ñ‡ĞµĞ¼ Ğ·Ğ° Ñ‡Ğ°Ñ']
    },
    fiber_low: {
      morning: ['Ğ£Ñ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ¾Ğ²ÑÑĞ½ĞºĞ° = ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° Ğ½Ğ° Ğ²ĞµÑÑŒ Ğ´ĞµĞ½ÑŒ', 'Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº Ñ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ¾Ğ¹ â€” ÑÑ‹Ñ‚Ğ¾ÑÑ‚ÑŒ Ğ´Ğ¾ Ğ¾Ğ±ĞµĞ´Ğ°'],
      afternoon: ['Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ÑĞ°Ğ»Ğ°Ñ‚ Ğº Ğ¾Ğ±ĞµĞ´Ñƒ â€” ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° Ğ½ÑƒĞ¶Ğ½Ğ°', 'ĞĞ±ĞµĞ´ Ğ±ĞµĞ· Ğ¾Ğ²Ğ¾Ñ‰ĞµĞ¹? Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ³Ğ°Ñ€Ğ½Ğ¸Ñ€'],
      evening: ['ĞĞ²Ğ¾Ñ‰Ğ¸ Ğ½Ğ° ÑƒĞ¶Ğ¸Ğ½ â€” Ğ»Ñ‘Ğ³ĞºĞ¾ÑÑ‚ÑŒ Ğ¸ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ°', 'Ğ’ĞµÑ‡ĞµÑ€ â€” Ğ²Ñ€ĞµĞ¼Ñ Ğ´Ğ»Ñ Ğ»Ñ‘Ğ³ĞºĞ¾Ğ³Ğ¾ ÑĞ°Ğ»Ğ°Ñ‚Ğ°']
    },
    simple_carbs_warning: {
      morning: ['Ğ¡Ğ°Ñ…Ğ°Ñ€ ÑƒÑ‚Ñ€Ğ¾Ğ¼ = ĞºĞ°Ñ‡ĞµĞ»Ğ¸ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸ Ğ²ĞµÑÑŒ Ğ´ĞµĞ½ÑŒ', 'Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸ ÑĞ»Ğ°Ğ´ĞºĞ¾Ğµ Ğ½Ğ° ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹'],
      afternoon: ['Ğ¡Ğ»Ğ°Ğ´ĞºĞ¾Ğµ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¾Ğ±ĞµĞ´Ğ°? Ğ¡ĞºĞ¾Ñ€Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ ÑĞ¿Ğ°Ğ´ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸', 'Ğ›ÑƒÑ‡ÑˆĞµ Ñ„Ñ€ÑƒĞºÑ‚Ñ‹ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ğ´ĞµÑĞµÑ€Ñ‚Ğ°'],
      evening: ['Ğ¡Ğ°Ñ…Ğ°Ñ€ Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼ = Ğ¿Ğ»Ğ¾Ñ…Ğ¾Ğ¹ ÑĞ¾Ğ½', 'Ğ’ĞµÑ‡ĞµÑ€Ğ¾Ğ¼ ÑĞ»Ğ°Ğ´ĞºĞ¾Ğµ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ Ğ²Ñ€ĞµĞ´Ğ½Ğ¾']
    }
  };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // COMBO ACHIEVEMENTS â€” ĞšĞ¾Ğ¼Ğ±Ğ¾ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const COMBO_ACHIEVEMENTS = [
    {
      id: 'protein_fiber_combo',
      name: 'Ğ‘ĞµĞ»Ğ¾Ğº + ĞšĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ°',
      conditions: { proteinPct: 0.9, fiberPct: 0.8 },
      daysRequired: 3,
      icon: 'ğŸ’ªğŸ¥—',
      text: '3 Ğ´Ğ½Ñ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ±ĞµĞ»Ğ¾Ğº Ğ˜ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ°! ĞšĞ¾Ğ¼Ğ±Ğ¾!'
    },
    {
      id: 'balanced_macros_combo',
      name: 'Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ Ğ¼Ğ°ĞºÑ€Ğ¾ÑĞ¾Ğ²',
      conditions: { proteinPct: 0.9, carbsPct: 0.9, fatPct: 0.9, allUnder: 1.15 },
      daysRequired: 3,
      icon: 'âš–ï¸',
      text: '3 Ğ´Ğ½Ñ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ° Ğ‘Ğ–Ğ£! ĞœĞ°ÑÑ‚ĞµÑ€!'
    },
    {
      id: 'hydration_master',
      name: 'ĞœĞ°ÑÑ‚ĞµÑ€ Ğ³Ğ¸Ğ´Ñ€Ğ°Ñ‚Ğ°Ñ†Ğ¸Ğ¸',
      conditions: { waterPct: 1.0 },
      daysRequired: 5,
      icon: 'ğŸ’§',
      text: '5 Ğ´Ğ½ĞµĞ¹ Ñ Ğ½Ğ¾Ñ€Ğ¼Ğ¾Ğ¹ Ğ²Ğ¾Ğ´Ñ‹! Ğ“Ğ¸Ğ´Ñ€Ğ°Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ!'
    },
    {
      id: 'clean_eating',
      name: 'Ğ§Ğ¸ÑÑ‚Ğ¾Ğµ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ',
      conditions: { harmPct: 0.5, transPct: 0.3 },
      daysRequired: 3,
      icon: 'ğŸŒ¿',
      text: '3 Ğ´Ğ½Ñ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ Ğ²Ñ€ĞµĞ´Ğ½Ğ¾Ğ³Ğ¾! Ğ§Ğ¸ÑÑ‚Ğ¾Ğµ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ!'
    },
    {
      id: 'early_bird',
      name: 'Ğ Ğ°Ğ½Ğ½ÑÑ Ğ¿Ñ‚Ğ°ÑˆĞºĞ°',
      conditions: { breakfastBefore: 9 },
      daysRequired: 5,
      icon: 'ğŸŒ…',
      text: '5 Ğ´Ğ½ĞµĞ¹ Ñ Ñ€Ğ°Ğ½Ğ½Ğ¸Ğ¼ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°ĞºĞ¾Ğ¼! Ğ ĞµĞ¶Ğ¸Ğ¼!'
    }
  ];
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SMART RECOMMENDATIONS â€” Ğ£Ğ¼Ğ½Ñ‹Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const RECOMMENDATION_PATTERNS_KEY = 'heys_user_patterns';
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // MOOD-ADAPTIVE MESSAGES â€” ĞĞ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ´ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const MOOD_TONES = {
    low: {  // mood 1-2
      prefix: ['ĞĞ¸Ñ‡ĞµĞ³Ğ¾ ÑÑ‚Ñ€Ğ°ÑˆĞ½Ğ¾Ğ³Ğ¾, ', 'Ğ’ÑÑ‘ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾, ', 'ĞĞµ Ğ¿ĞµÑ€ĞµĞ¶Ğ¸Ğ²Ğ°Ğ¹, '],
      suffix: [' ğŸ’™', ' Ğ¢Ñ‹ ÑĞ¿Ñ€Ğ°Ğ²Ğ¸ÑˆÑŒÑÑ!', ''],
      avoid: ['warning', 'critical'] // ĞĞµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¶Ñ‘ÑÑ‚ĞºĞ¸Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
    },
    neutral: { // mood 3
      prefix: ['', '', ''],
      suffix: ['', '', ''],
      avoid: []
    },
    high: { // mood 4-5
      prefix: ['ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! ', 'Ğ¡ÑƒĞ¿ĞµÑ€! ', 'Ğ¢Ğ°Ğº Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ! '],
      suffix: [' ğŸ‰', ' ğŸ’ª', ''],
      avoid: []
    }
  };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADVICE CATEGORIES SETTINGS â€” ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const ADVICE_SETTINGS_KEY = 'heys_advice_settings';
  
  const DEFAULT_ADVICE_SETTINGS = {
    // ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)
    categories: {
      nutrition: true,      // ĞŸĞ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ (Ğ‘Ğ–Ğ£, ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸)
      hydration: true,      // Ğ’Ğ¾Ğ´Ğ°
      lifestyle: true,      // ĞĞ±Ñ€Ğ°Ğ· Ğ¶Ğ¸Ğ·Ğ½Ğ¸
      training: true,       // Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸
      sleep: true,          // Ğ¡Ğ¾Ğ½
      emotional: true,      // Ğ­Ğ¼Ğ¾Ñ†Ğ¸Ğ¸ Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ
      achievement: true,    // Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ
      timing: true,         // Ğ¢Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ¾Ğ²
      correlation: true     // ĞšĞ¾Ñ€Ñ€ĞµĞ»ÑÑ†Ğ¸Ğ¸
    },
    // ĞĞ±Ñ‰Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
    toastsEnabled: true,    // ĞĞ²Ñ‚Ğ¾Ğ¿Ğ¾ĞºĞ°Ğ· Ñ‚Ğ¾ÑÑ‚Ğ¾Ğ² (FAB Ğ²ÑĞµĞ³Ğ´Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚)
    soundEnabled: true,     // Ğ—Ğ²ÑƒĞº Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ²ĞµÑ‚Ğ°Ñ…
    hapticEnabled: true,    // Ğ’Ğ¸Ğ±Ñ€Ğ°Ñ†Ğ¸Ñ
    showDetails: true,      // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸
    maxPerDay: 20,          // ĞœĞ°ĞºÑ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² Ğ² Ğ´ĞµĞ½ÑŒ
    quietHoursStart: 23,    // Ğ¢Ğ¸Ñ…Ğ¸Ğµ Ñ‡Ğ°ÑÑ‹ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾
    quietHoursEnd: 7        // Ğ¢Ğ¸Ñ…Ğ¸Ğµ Ñ‡Ğ°ÑÑ‹ ĞºĞ¾Ğ½ĞµÑ†
  };
  
  const CATEGORY_LABELS = {
    nutrition: { name: 'ĞŸĞ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ', icon: 'ğŸ¥—', desc: 'Ğ‘Ğ–Ğ£, ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸, Ğ¼Ğ°ĞºÑ€Ğ¾ÑÑ‹' },
    hydration: { name: 'Ğ’Ğ¾Ğ´Ğ°', icon: 'ğŸ’§', desc: 'Ğ“Ğ¸Ğ´Ñ€Ğ°Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ' },
    lifestyle: { name: 'ĞĞ±Ñ€Ğ°Ğ· Ğ¶Ğ¸Ğ·Ğ½Ğ¸', icon: 'ğŸŒ…', desc: 'Ğ ĞµĞ¶Ğ¸Ğ¼, Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºĞ¸' },
    training: { name: 'Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸', icon: 'ğŸ’ª', desc: 'ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¸ ÑĞ¿Ğ¾Ñ€Ñ‚' },
    sleep: { name: 'Ğ¡Ğ¾Ğ½', icon: 'ğŸ˜´', desc: 'ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¸ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ½Ğ°' },
    emotional: { name: 'Ğ­Ğ¼Ğ¾Ñ†Ğ¸Ğ¸', icon: 'ğŸ’™', desc: 'ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ Ğ¸ ÑÑ‚Ñ€ĞµÑÑ' },
    achievement: { name: 'Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ', icon: 'ğŸ†', desc: 'Streak, Ñ€ĞµĞºĞ¾Ñ€Ğ´Ñ‹' },
    timing: { name: 'Ğ¢Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³', icon: 'â°', desc: 'Ğ’Ñ€ĞµĞ¼Ñ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ¾Ğ² Ğ¿Ğ¸Ñ‰Ğ¸' },
    correlation: { name: 'ĞšĞ¾Ñ€Ñ€ĞµĞ»ÑÑ†Ğ¸Ğ¸', icon: 'ğŸ”—', desc: 'Ğ¡Ğ²ÑĞ·Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸' }
  };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PERSONAL BEST TRACKING â€” Ğ›ÑƒÑ‡ÑˆĞ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const PERSONAL_BESTS_KEY = 'heys_personal_bests';
  
  const TRACKABLE_METRICS = {
    proteinPct: { name: 'Ğ‘ĞµĞ»Ğ¾Ğº', icon: 'ğŸ¥©', unit: '%', higher: true },
    fiberPct: { name: 'ĞšĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ°', icon: 'ğŸ¥¬', unit: '%', higher: true },
    waterPct: { name: 'Ğ’Ğ¾Ğ´Ğ°', icon: 'ğŸ’§', unit: '%', higher: true },
    goodFatRatio: { name: 'ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ¶Ğ¸Ñ€Ñ‹', icon: 'ğŸ¥‘', unit: '%', higher: true },
    streak: { name: 'Ğ¡ĞµÑ€Ğ¸Ñ Ğ´Ğ½ĞµĞ¹', icon: 'ğŸ”¥', unit: 'Ğ´Ğ½', higher: true },
    lowGIday: { name: 'ĞĞ¸Ğ·ĞºĞ¸Ğ¹ Ğ“Ğ˜', icon: 'ğŸ“Š', unit: 'Ğ“Ğ˜', higher: false },
    lowHarmDay: { name: 'Ğ§Ğ¸ÑÑ‚Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ', icon: 'ğŸŒ¿', unit: '%', higher: false }
  };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // GOAL-SPECIFIC ADVICE â€” Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾ Ñ†ĞµĞ»ÑĞ¼
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const GOAL_MODES = {
    deficit: {
      name: 'ĞŸĞ¾Ñ…ÑƒĞ´ĞµĞ½Ğ¸Ğµ',
      icon: 'ğŸ“‰',
      priorities: ['protein', 'fiber', 'water', 'satiety'],
      avoidCategories: [],
      bonusAdvices: [
        { id: 'deficit_protein_priority', text: 'ĞŸÑ€Ğ¸ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğµ Ğ±ĞµĞ»Ğ¾Ğº â€” Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ â„–1', priority: 25 },
        { id: 'deficit_fiber_satiety', text: 'ĞšĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° Ğ´Ğ°Ñ‘Ñ‚ ÑÑ‹Ñ‚Ğ¾ÑÑ‚ÑŒ Ğ±ĞµĞ· ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹', priority: 26 },
        { id: 'deficit_water_hunger', text: 'Ğ§Ğ°ÑÑ‚Ğ¾ Ğ¶Ğ°Ğ¶Ğ´Ñƒ Ğ¿ÑƒÑ‚Ğ°ÑÑ‚ Ñ Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ¾Ğ¼ â€” Ğ²Ñ‹Ğ¿ĞµĞ¹ Ğ²Ğ¾Ğ´Ñ‹', priority: 27 }
      ]
    },
    bulk: {
      name: 'ĞĞ°Ğ±Ğ¾Ñ€ Ğ¼Ğ°ÑÑÑ‹',
      icon: 'ğŸ“ˆ',
      priorities: ['protein', 'carbs', 'calories', 'training'],
      avoidCategories: [],
      bonusAdvices: [
        { id: 'bulk_protein_timing', text: 'Ğ‘ĞµĞ»Ğ¾Ğº Ğ¿Ğ¾ÑĞ»Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ â€” Ğ¾ĞºĞ½Ğ¾ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ĞµĞ¹', priority: 25 },
        { id: 'bulk_carbs_energy', text: 'Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ = Ñ‚Ğ¾Ğ¿Ğ»Ğ¸Ğ²Ğ¾ Ğ´Ğ»Ñ Ñ€Ğ¾ÑÑ‚Ğ°', priority: 26 },
        { id: 'bulk_sleep_growth', text: 'ĞœÑ‹ÑˆÑ†Ñ‹ Ñ€Ğ°ÑÑ‚ÑƒÑ‚ Ğ²Ğ¾ ÑĞ½Ğµ â€” Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 7-8 Ñ‡Ğ°ÑĞ¾Ğ²', priority: 27 }
      ]
    },
    maintenance: {
      name: 'ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ',
      icon: 'âš–ï¸',
      priorities: ['balance', 'variety', 'consistency'],
      avoidCategories: [],
      bonusAdvices: [
        { id: 'maintenance_balance', text: 'Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ Ğ²Ğ°Ğ¶Ğ½ĞµĞµ Ğ¸Ğ´ĞµĞ°Ğ»Ğ° â€” Ğ´ĞµÑ€Ğ¶Ğ¸ ÑÑ€ĞµĞ´Ğ½ÑÑ', priority: 25 },
        { id: 'maintenance_variety', text: 'Ğ Ğ°Ğ·Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ğµ â€” ĞºĞ»ÑÑ‡ Ğº ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ¾ÑÑ‚Ğ¸', priority: 26 }
      ]
    }
  };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADVICE SCHEDULING â€” ĞÑ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const SCHEDULED_KEY = 'heys_scheduled_advices';
  const SNOOZE_OPTIONS = [
    { label: '30 Ğ¼Ğ¸Ğ½', minutes: 30 },
    { label: '1 Ñ‡Ğ°Ñ', minutes: 60 },
    { label: '2 Ñ‡Ğ°ÑĞ°', minutes: 120 }
  ];
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // MICRO-ANIMATIONS CONFIG
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const ADVICE_ANIMATIONS = {
    achievement: 'bounce',
    warning: 'shake',
    tip: 'fadeSlide',
    success: 'pulse',
    streak: 'glow'
  };
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PROGRESSIVE DISCLOSURE â€” ĞšÑ€Ğ°Ñ‚ĞºĞ¸Ğ¹/Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  // details Ğ¿Ğ¾Ğ»Ğµ ÑƒĞ¶Ğµ ĞµÑÑ‚ÑŒ Ğ² Ğ½ĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ°Ñ…, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ¼ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ Ğ²ĞµĞ·Ğ´Ğµ
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SMART PRIORITIZATION â€” ML-like scoring
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const CTR_WEIGHT = 0.4;        // Ğ’ĞµÑ CTR Ğ² scoring
  const RECENCY_WEIGHT = 0.3;   // Ğ’ĞµÑ Ğ´Ğ°Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°
  const RELEVANCE_WEIGHT = 0.3; // Ğ’ĞµÑ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ñƒ
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SEASONAL CONFIG â€” Ğ¡ĞµĞ·Ğ¾Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const SEASONAL_TIPS = [
    {
      id: 'winter_vitamin_d',
      months: [10, 11, 0, 1, 2], // Ğ½Ğ¾ÑĞ±Ñ€ÑŒ-Ğ¼Ğ°Ñ€Ñ‚
      icon: 'â„ï¸',
      texts: [
        'Ğ—Ğ¸Ğ¼Ğ¾Ğ¹ Ğ²Ğ°Ğ¶ĞµĞ½ Ğ²Ğ¸Ñ‚Ğ°Ğ¼Ğ¸Ğ½ D â€” Ñ€Ñ‹Ğ±Ğ°, ÑĞ¹Ñ†Ğ°, Ğ³Ñ€Ğ¸Ğ±Ñ‹',
        'ĞœĞ°Ğ»Ğ¾ ÑĞ¾Ğ»Ğ½Ñ†Ğ°? Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¶Ğ¸Ñ€Ğ½ÑƒÑ Ñ€Ñ‹Ğ±Ñƒ Ğ¸ ÑĞ¹Ñ†Ğ°',
        'Ğ’Ğ¸Ñ‚Ğ°Ğ¼Ğ¸Ğ½ D Ğ·Ğ¸Ğ¼Ğ¾Ğ¹ â€” Ñ‡ĞµÑ€ĞµĞ· ĞµĞ´Ñƒ: ÑÑ‘Ğ¼Ğ³Ğ°, ÑĞºÑƒĞ¼Ğ±Ñ€Ğ¸Ñ, Ğ¶ĞµĞ»Ñ‚Ğ¾Ğº'
      ],
      category: 'lifestyle',
      priority: 60
    },
    {
      id: 'spring_detox',
      months: [2, 3, 4], // Ğ¼Ğ°Ñ€Ñ‚-Ğ¼Ğ°Ğ¹
      icon: 'ğŸŒ±',
      texts: [
        'Ğ’ĞµÑĞ½Ğ° â€” Ğ²Ñ€ĞµĞ¼Ñ Ğ·ĞµĞ»ĞµĞ½Ğ¸! Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ÑˆĞ¿Ğ¸Ğ½Ğ°Ñ‚, Ñ€ÑƒĞºĞºĞ¾Ğ»Ñƒ',
        'Ğ’ĞµÑĞµĞ½Ğ½Ğ¸Ğ¹ Ğ´ĞµÑ‚Ğ¾ĞºÑ â€” Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¾Ğ²Ğ¾Ñ‰ĞµĞ¹ Ğ¸ Ğ²Ğ¾Ğ´Ñ‹',
        'ĞŸĞ¾Ñ€Ğ° Ğ¿Ñ€Ğ¾ÑÑ‹Ğ¿Ğ°Ñ‚ÑŒÑÑ â€” Ğ·ĞµĞ»Ñ‘Ğ½Ñ‹Ğµ ÑĞ¼ÑƒĞ·Ğ¸ Ğ² Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ'
      ],
      category: 'lifestyle',
      priority: 60
    },
    {
      id: 'summer_hydration',
      months: [5, 6, 7], // Ğ¸ÑĞ½ÑŒ-Ğ°Ğ²Ğ³ÑƒÑÑ‚
      icon: 'â˜€ï¸',
      texts: [
        'Ğ–Ğ°Ñ€Ğ° â€” Ğ¿ĞµĞ¹ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ²Ğ¾Ğ´Ñ‹, +500Ğ¼Ğ» Ğº Ğ½Ğ¾Ñ€Ğ¼Ğµ',
        'Ğ›ĞµÑ‚Ğ¾Ğ¼ Ğ²Ğ°Ğ¶Ğ½Ğ° Ğ³Ğ¸Ğ´Ñ€Ğ°Ñ‚Ğ°Ñ†Ğ¸Ñ â€” Ğ°Ñ€Ğ±ÑƒĞ·, Ğ¾Ğ³ÑƒÑ€Ñ†Ñ‹, Ğ²Ğ¾Ğ´Ğ°',
        'Ğ’ Ğ¶Ğ°Ñ€Ñƒ Ñ‚ĞµÑ€ÑĞµÑˆÑŒ Ğ²Ğ¾Ğ´Ñƒ â€” Ğ²Ğ¾ÑĞ¿Ğ¾Ğ»Ğ½ÑĞ¹ Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾'
      ],
      category: 'hydration',
      priority: 55
    },
    {
      id: 'autumn_immunity',
      months: [8, 9, 10], // ÑĞµĞ½Ñ‚ÑĞ±Ñ€ÑŒ-Ğ½Ğ¾ÑĞ±Ñ€ÑŒ
      icon: 'ğŸ‚',
      texts: [
        'ĞÑĞµĞ½ÑŒ â€” ÑƒĞºÑ€ĞµĞ¿Ğ»ÑĞ¹ Ğ¸Ğ¼Ğ¼ÑƒĞ½Ğ¸Ñ‚ĞµÑ‚: Ğ¸Ğ¼Ğ±Ğ¸Ñ€ÑŒ, Ğ»Ğ¸Ğ¼Ğ¾Ğ½, Ğ¼Ñ‘Ğ´',
        'Ğ¡ĞµĞ·Ğ¾Ğ½ Ğ¿Ñ€Ğ¾ÑÑ‚ÑƒĞ´ â€” Ğ²Ğ¸Ñ‚Ğ°Ğ¼Ğ¸Ğ½ C Ğ¸Ğ· Ñ†Ğ¸Ñ‚Ñ€ÑƒÑĞ¾Ğ² Ğ¸ ĞºĞ¸Ğ²Ğ¸',
        'ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸ Ğ¸Ğ¼Ğ¼ÑƒĞ½Ğ¸Ñ‚ĞµÑ‚ â€” Ñ‡ĞµÑĞ½Ğ¾Ğº, Ğ¸Ğ¼Ğ±Ğ¸Ñ€ÑŒ, ĞºÑƒÑ€ĞºÑƒĞ¼Ğ°'
      ],
      category: 'lifestyle',
      priority: 60
    }
  ];
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PERSONALIZED TEXT TEMPLATES
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¿Ğ»ĞµĞ¹ÑÑ…Ğ¾Ğ»Ğ´ĞµÑ€Ñ‹ Ğ² Ñ‚ĞµĞºÑÑ‚Ğµ
   * @param {string} text - Ğ¢ĞµĞºÑÑ‚ Ñ Ğ¿Ğ»ĞµĞ¹ÑÑ…Ğ¾Ğ»Ğ´ĞµÑ€Ğ°Ğ¼Ğ¸
   * @param {Object} ctx - ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
   * @returns {string}
   */
  function personalizeText(text, ctx) {
    const firstName = ctx.prof?.firstName || '';
    const result = text
      .replace(/\$\{firstName\}/g, firstName)
      .replace(/\$\{firstName\}, /g, firstName ? firstName + ', ' : '')
      .replace(/\$\{firstName\}!/g, firstName ? firstName + '!' : '')
      .replace(/\, \$\{firstName\}/g, firstName ? ', ' + firstName : '');
    return result.trim();
  }
  
  /**
   * Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ñ‚ĞµĞºÑÑ‚Ğ° Ğ´ĞµÑ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾ (ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ² Ñ€Ğ°Ğ¼ĞºĞ°Ñ… ÑĞµÑÑĞ¸Ğ¸)
   * Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´Ğ°Ñ‚Ñƒ + id Ğ´Ğ»Ñ seed, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ±Ñ‹Ğ» ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ½Ğ¾ Ğ¼ĞµĞ½ÑĞ»ÑÑ ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ¾
   * @param {string|string[]} textOrArray
   * @param {string} [seed] - Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ seed Ğ´Ğ»Ñ Ğ´ĞµÑ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° (id ÑĞ¾Ğ²ĞµÑ‚Ğ°)
   * @returns {string}
   */
  // ĞšÑÑˆ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ² Ğ´Ğ»Ñ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ² Ñ€Ğ°Ğ¼ĞºĞ°Ñ… ÑĞµÑÑĞ¸Ğ¸
  const _textChoiceCache = new Map();
  
  function pickRandomText(textOrArray, seed = '') {
    if (!Array.isArray(textOrArray)) {
      return textOrArray;
    }
    if (textOrArray.length === 1) {
      return textOrArray[0];
    }
    
    // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ ĞºĞ»ÑÑ‡ ĞºÑÑˆĞ° Ğ¸Ğ· seed + Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²
    const cacheKey = seed + '|' + textOrArray.join('|');
    
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºÑÑˆ
    if (_textChoiceCache.has(cacheKey)) {
      return _textChoiceCache.get(cacheKey);
    }
    
    // Ğ”ĞµÑ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ´Ğ°Ñ‚Ñ‹ + seed
    const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD
    const seedStr = today + seed;
    
    // Simple hash function
    let hash = 0;
    for (let i = 0; i < seedStr.length; i++) {
      const char = seedStr.charCodeAt(i);
      hash = ((hash << 5) - hash) + char;
      hash = hash & hash; // Convert to 32bit integer
    }
    
    const index = Math.abs(hash) % textOrArray.length;
    const result = textOrArray[index];
    
    // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² ĞºÑÑˆ
    _textChoiceCache.set(cacheKey, result);
    
    return result;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADVICE RATING â€” Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¾Ñ†ĞµĞ½ĞºĞ¸ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ¾Ñ†ĞµĞ½ĞºÑƒ ÑĞ¾Ğ²ĞµÑ‚Ğ° (ğŸ‘/ğŸ‘)
   * @param {string} adviceId
   * @param {boolean} isPositive - true = ğŸ‘, false = ğŸ‘
   */
  function rateAdvice(adviceId, isPositive) {
    try {
      const ratings = JSON.parse(localStorage.getItem(RATING_KEY) || '{}');
      if (!ratings[adviceId]) {
        ratings[adviceId] = { positive: 0, negative: 0 };
      }
      if (isPositive) {
        ratings[adviceId].positive++;
      } else {
        ratings[adviceId].negative++;
      }
      ratings[adviceId].lastRated = Date.now();
      localStorage.setItem(RATING_KEY, JSON.stringify(ratings));
    } catch (e) {}
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³ ÑĞ¾Ğ²ĞµÑ‚Ğ°
   * @param {string} adviceId
   * @returns {Object} { positive, negative, score }
   */
  function getAdviceRating(adviceId) {
    try {
      const ratings = JSON.parse(localStorage.getItem(RATING_KEY) || '{}');
      const r = ratings[adviceId] || { positive: 0, negative: 0 };
      const total = r.positive + r.negative;
      const score = total > 0 ? (r.positive - r.negative) / total : 0;
      return { ...r, score, total };
    } catch (e) {
      return { positive: 0, negative: 0, score: 0, total: 0 };
    }
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ²ÑĞµ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ğ¸ (Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ¾Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… >60 Ğ´Ğ½ĞµĞ¹)
   * @returns {Object}
   */
  function getAllRatings() {
    try {
      const data = localStorage.getItem(RATING_KEY);
      if (!data) return {};
      const parsed = JSON.parse(data);
      
      // ĞĞ²Ñ‚Ğ¾Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ°: ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ ÑÑ‚Ğ°Ñ€ÑˆĞµ 60 Ğ´Ğ½ĞµĞ¹
      const now = Date.now();
      const SIXTY_DAYS = 60 * 24 * 60 * 60 * 1000;
      let needsSave = false;
      Object.keys(parsed).forEach(key => {
        if (parsed[key].lastRated && (now - parsed[key].lastRated) > SIXTY_DAYS) {
          delete parsed[key];
          needsSave = true;
        }
      });
      if (needsSave) {
        localStorage.setItem(RATING_KEY, JSON.stringify(parsed));
      }
      return parsed;
    } catch (e) {
      return {};
    }
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // TIME-BASED TEXT SELECTION â€” Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ÑÑƒÑ‚Ğ¾Ğº
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ Ğ´Ğ½Ñ
   * @param {number} hour
   * @returns {'morning'|'afternoon'|'evening'}
   */
  function getTimePeriod(hour) {
    if (hour >= 5 && hour < 12) return 'morning';
    if (hour >= 12 && hour < 18) return 'afternoon';
    return 'evening';
  }
  
  /**
   * Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑÑ‚ ÑĞ¾Ğ²ĞµÑ‚Ğ° Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ÑÑƒÑ‚Ğ¾Ğº
   * @param {string} adviceId
   * @param {number} hour
   * @param {string} defaultText
   * @returns {string}
   */
  function getTimeBasedText(adviceId, hour, defaultText) {
    const variants = TIME_BASED_TEXTS[adviceId];
    if (!variants) return defaultText;
    
    const period = getTimePeriod(hour);
    const texts = variants[period];
    
    if (texts && texts.length > 0) {
      return pickRandomText(texts);
    }
    return defaultText;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // COMBO ACHIEVEMENTS â€” ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ¼Ğ±Ğ¾ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ combo Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸
   * @param {Object} ctx - ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ñ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
   * @returns {Object|null} Ğ”Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚Ğ¾Ğµ ĞºĞ¾Ğ¼Ğ±Ğ¾ Ğ¸Ğ»Ğ¸ null
   */
  function checkComboAchievements(ctx) {
    try {
      const lsGet = (window.HEYS?.utils?.lsGet) || ((k, d) => {
        try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : d; } catch { return d; }
      });
      
      const today = new Date();
      
      for (const combo of COMBO_ACHIEVEMENTS) {
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ»Ğ¸ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¾ ĞºĞ¾Ğ¼Ğ±Ğ¾
        const shownKey = 'heys_combo_' + combo.id;
        const lastShown = localStorage.getItem(shownKey);
        if (lastShown) {
          const daysSince = (Date.now() - parseInt(lastShown, 10)) / (1000 * 60 * 60 * 24);
          if (daysSince < 7) continue; // ĞĞµ Ñ‡Ğ°Ñ‰Ğµ Ñ€Ğ°Ğ·Ğ° Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ
        }
        
        // Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ° Ğ½ÑƒĞ¶Ğ½Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ½ĞµĞ¹
        let successDays = 0;
        
        for (let i = 0; i < combo.daysRequired + 2; i++) { // +2 Ğ´Ğ»Ñ Ğ±ÑƒÑ„ĞµÑ€Ğ°
          const d = new Date(today);
          d.setDate(d.getDate() - i);
          const iso = d.toISOString().slice(0, 10);
          const dayData = lsGet('heys_dayv2_' + iso, null);
          
          if (!dayData?.meals?.length) continue;
          
          // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ
          let meetsConditions = true;
          const cond = combo.conditions;
          
          if (cond.proteinPct !== undefined) {
            const pct = (dayData.dayTot?.prot || 0) / (ctx.normAbs?.prot || 100);
            if (pct < cond.proteinPct) meetsConditions = false;
          }
          if (cond.fiberPct !== undefined) {
            const pct = (dayData.dayTot?.fiber || 0) / (ctx.normAbs?.fiber || 25);
            if (pct < cond.fiberPct) meetsConditions = false;
          }
          if (cond.waterPct !== undefined) {
            const pct = (dayData.waterMl || 0) / (ctx.waterGoal || 2000);
            if (pct < cond.waterPct) meetsConditions = false;
          }
          if (cond.harmPct !== undefined) {
            const pct = (dayData.dayTot?.harm || 0) / 100;
            if (pct > cond.harmPct) meetsConditions = false;
          }
          if (cond.breakfastBefore !== undefined) {
            const firstMeal = (dayData.meals || []).find(m => m.items?.length > 0);
            if (firstMeal?.time) {
              const [h] = firstMeal.time.split(':').map(Number);
              if (h >= cond.breakfastBefore) meetsConditions = false;
            } else {
              meetsConditions = false;
            }
          }
          
          if (meetsConditions) successDays++;
          if (successDays >= combo.daysRequired) {
            return combo;
          }
        }
      }
      
      return null;
    } catch (e) {
      return null;
    }
  }
  
  /**
   * ĞÑ‚Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ Ğ¿Ğ¾ĞºĞ°Ğ· ĞºĞ¾Ğ¼Ğ±Ğ¾
   * @param {string} comboId
   */
  function markComboShown(comboId) {
    try {
      localStorage.setItem('heys_combo_' + comboId, String(Date.now()));
    } catch (e) {}
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SMART RECOMMENDATIONS â€” ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°
   * @param {string} productName
   * @param {number} hour
   */
  function trackProductPattern(productName, hour) {
    try {
      const patterns = JSON.parse(localStorage.getItem(RECOMMENDATION_PATTERNS_KEY) || '{}');
      const key = productName.toLowerCase().slice(0, 20); // ĞŸĞµÑ€Ğ²Ñ‹Ğµ 20 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
      
      if (!patterns[key]) {
        patterns[key] = { hours: [], count: 0 };
      }
      
      patterns[key].hours.push(hour);
      patterns[key].count++;
      patterns[key].lastAdded = Date.now();
      
      // Ğ”ĞµÑ€Ğ¶Ğ¸Ğ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 10 Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
      if (patterns[key].hours.length > 10) {
        patterns[key].hours = patterns[key].hours.slice(-10);
      }
      
      localStorage.setItem(RECOMMENDATION_PATTERNS_KEY, JSON.stringify(patterns));
    } catch (e) {}
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ²
   * @param {number} currentHour
   * @returns {Object|null} { productName, avgHour, message }
   */
  function getSmartRecommendation(currentHour) {
    try {
      const patterns = JSON.parse(localStorage.getItem(RECOMMENDATION_PATTERNS_KEY) || '{}');
      
      let bestMatch = null;
      let bestScore = 0;
      
      for (const [product, data] of Object.entries(patterns)) {
        if (data.count < 3) continue; // ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 3 Ñ€Ğ°Ğ·Ğ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ»
        
        // Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ‡Ğ°Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ
        const avgHour = Math.round(data.hours.reduce((a, b) => a + b, 0) / data.hours.length);
        
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ Ğ»Ğ¸ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ Ğº Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğ¼Ñƒ
        const hourDiff = Math.abs(currentHour - avgHour);
        if (hourDiff <= 1) { // Ğ’ Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ°Ñ… Ñ‡Ğ°ÑĞ°
          const score = data.count / (hourDiff + 1);
          if (score > bestScore) {
            bestScore = score;
            bestMatch = {
              productName: product,
              avgHour,
              count: data.count,
              message: `ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ² ÑÑ‚Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ñ‚Ñ‹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑˆÑŒ ${product}`
            };
          }
        }
      }
      
      return bestMatch;
    } catch (e) {
      return null;
    }
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // MOOD-ADAPTIVE MESSAGES â€” ĞĞ´Ğ°Ğ¿Ñ‚Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¾Ğ½Ğ° Ğ¿Ğ¾Ğ´ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‚ĞµĞºÑÑ‚ ÑĞ¾Ğ²ĞµÑ‚Ğ° Ğ¿Ğ¾Ğ´ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ
   * @param {string} text - ĞÑ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚
   * @param {number} mood - ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ (1-5)
   * @param {string} adviceType - Ğ¢Ğ¸Ğ¿ ÑĞ¾Ğ²ĞµÑ‚Ğ°
   * @returns {string}
   */
  function adaptTextToMood(text, mood, adviceType) {
    if (!mood || mood === 0) return text;
    
    let toneKey = 'neutral';
    if (mood <= 2) toneKey = 'low';
    else if (mood >= 4) toneKey = 'high';
    
    const tone = MOOD_TONES[toneKey];
    if (!tone) return text;
    
    // ĞŸÑ€Ğ¸ Ğ½Ğ¸Ğ·ĞºĞ¾Ğ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ·Ğ±ĞµĞ³Ğ°ĞµĞ¼ Ğ¶Ñ‘ÑÑ‚ĞºĞ¸Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
    if (tone.avoid.includes(adviceType)) {
      return null; // Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ» Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ
    }
    
    // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ prefix/suffix ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾
    const prefix = pickRandomText(tone.prefix);
    const suffix = pickRandomText(tone.suffix);
    
    return prefix + text + suffix;
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑÑ€ĞµĞ´Ğ½ĞµĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ Ğ·Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ
   * @param {Object} day
   * @returns {number} 0-5
   */
  function getAverageMoodToday(day) {
    const meals = (day?.meals || []).filter(m => m.mood > 0);
    if (meals.length === 0) return 0;
    return meals.reduce((sum, m) => sum + m.mood, 0) / meals.length;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SMART PRIORITIZATION â€” ML-like scoring Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ CTR
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ smart score Ğ´Ğ»Ñ ÑĞ¾Ğ²ĞµÑ‚Ğ° (Ğ±ĞµĞ· ĞºÑÑˆĞ° - Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²)
   * @param {Object} advice
   * @param {Object} ctx
   * @returns {number} Score (Ğ²Ñ‹ÑˆĞµ = Ğ»ÑƒÑ‡ÑˆĞµ)
   */
  function calculateSmartScore(advice, ctx) {
    return calculateSmartScoreCached(advice, ctx, getTrackingStats(), getAllRatings());
  }
  
  /**
   * Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾ smart score
   * @param {Array} advices
   * @param {Object} ctx
   * @returns {Array}
   */
  function sortBySmartScore(advices, ctx) {
    // ğŸš€ ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ: ĞºÑÑˆĞ¸Ñ€ÑƒĞµĞ¼ stats Ğ¸ ratings Ğ´Ğ»Ñ Ğ²ÑĞµĞ¹ ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸
    const cachedStats = getTrackingStats();
    const cachedRatings = getAllRatings();
    
    return advices
      .map(a => ({ ...a, smartScore: calculateSmartScoreCached(a, ctx, cachedStats, cachedRatings) }))
      .sort((a, b) => b.smartScore - a.smartScore);
  }
  
  /**
   * Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ smart score Ñ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
   * @param {Object} advice
   * @param {Object} ctx
   * @param {Object} stats - ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ stats
   * @param {Object} ratings - ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ratings
   * @returns {number}
   */
  function calculateSmartScoreCached(advice, ctx, stats, ratings) {
    let score = 100 - advice.priority;
    
    // 1. CTR factor
    const adviceStats = stats[advice.id];
    if (adviceStats && adviceStats.shown >= 3) {
      const ctr = adviceStats.clicked / adviceStats.shown;
      score += ctr * 50 * CTR_WEIGHT;
    }
    
    // 2. Rating factor
    const r = ratings[advice.id] || { positive: 0, negative: 0 };
    const total = r.positive + r.negative;
    if (total >= 2) {
      const ratingScore = (r.positive - r.negative) / total;
      score += ratingScore * 30 * CTR_WEIGHT;
    }
    
    // 3. Recency factor
    if (adviceStats?.lastShown) {
      const hoursSince = (Date.now() - adviceStats.lastShown) / (1000 * 60 * 60);
      if (hoursSince > 24) {
        score += Math.min(hoursSince / 24, 5) * 10 * RECENCY_WEIGHT;
      }
    } else {
      score += 10 * RECENCY_WEIGHT;
    }
    
    // 4. Relevance
    if (advice.category === 'nutrition' && advice.nutrient) {
      const pct = (ctx.dayTot?.[advice.nutrient] || 0) / (ctx.normAbs?.[advice.nutrient] || 100);
      if (pct < 0.5) score += 20 * RELEVANCE_WEIGHT;
    }
    
    return score;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADVICE SETTINGS â€” Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
   * @returns {Object}
   */
  function getAdviceSettings() {
    try {
      const stored = localStorage.getItem(ADVICE_SETTINGS_KEY);
      if (stored) {
        return { ...DEFAULT_ADVICE_SETTINGS, ...JSON.parse(stored) };
      }
    } catch (e) {}
    return { ...DEFAULT_ADVICE_SETTINGS };
  }
  
  /**
   * Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
   * @param {Object} settings
   */
  function setAdviceSettings(settings) {
    try {
      const current = getAdviceSettings();
      const merged = { ...current, ...settings };
      localStorage.setItem(ADVICE_SETTINGS_KEY, JSON.stringify(merged));
      // Emit event Ğ´Ğ»Ñ UI
      window.dispatchEvent(new CustomEvent('heysAdviceSettingsChanged', { detail: merged }));
    } catch (e) {}
  }
  
  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ° Ğ»Ğ¸ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
   * @param {string} category
   * @returns {boolean}
   */
  function isCategoryEnabled(category) {
    const settings = getAdviceSettings();
    return settings.categories?.[category] !== false;
  }
  
  /**
   * ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ
   * @param {string} category
   * @param {boolean} enabled
   */
  function toggleCategory(category, enabled) {
    const settings = getAdviceSettings();
    settings.categories = settings.categories || {};
    settings.categories[category] = enabled;
    setAdviceSettings(settings);
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PERSONAL BEST TRACKING â€” ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞºĞ¾Ñ€Ğ´Ğ¾Ğ²
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ²ÑĞµ Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ñ€ĞµĞºĞ¾Ñ€Ğ´Ñ‹
   * @returns {Object}
   */
  function getPersonalBests() {
    try {
      const stored = localStorage.getItem(PERSONAL_BESTS_KEY);
      return stored ? JSON.parse(stored) : {};
    } catch (e) {
      return {};
    }
  }
  
  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´
   * @param {string} metric - ĞšĞ»ÑÑ‡ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
   * @param {number} value - Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
   * @param {string} date - Ğ”Ğ°Ñ‚Ğ° Ğ² ISO Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ
   * @returns {Object|null} { isNewRecord, previousValue, improvement }
   */
  function checkAndUpdatePersonalBest(metric, value, date) {
    const config = TRACKABLE_METRICS[metric];
    if (!config) return null;
    
    const bests = getPersonalBests();
    const current = bests[metric];
    
    let isNewRecord = false;
    let previousValue = null;
    
    if (!current) {
      isNewRecord = true;
    } else {
      previousValue = current.value;
      if (config.higher) {
        isNewRecord = value > current.value;
      } else {
        isNewRecord = value < current.value;
      }
    }
    
    if (isNewRecord && value > 0) {
      bests[metric] = { value, date, previous: previousValue };
      try {
        localStorage.setItem(PERSONAL_BESTS_KEY, JSON.stringify(bests));
      } catch (e) {}
      
      return {
        isNewRecord: true,
        previousValue,
        improvement: previousValue ? Math.abs(value - previousValue) : null,
        metric: config
      };
    }
    
    return { isNewRecord: false, currentBest: current?.value };
  }
  
  /**
   * Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ²ĞµÑ‚ Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ€ĞµĞºĞ¾Ñ€Ğ´Ğ°
   * @param {string} metric
   * @param {Object} recordInfo
   * @returns {Object|null} Advice object
   */
  function createPersonalBestAdvice(metric, recordInfo) {
    if (!recordInfo?.isNewRecord) return null;
    
    const config = TRACKABLE_METRICS[metric];
    if (!config) return null;
    
    const value = recordInfo.improvement 
      ? `+${recordInfo.improvement.toFixed(1)}${config.unit} Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ³Ğ¾!`
      : `${config.unit}`;
    
    return {
      id: 'personal_best_' + metric,
      icon: 'ğŸ†',
      text: `ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´: ${config.name}! ${value}`,
      type: 'achievement',
      priority: 3,
      category: 'achievement',
      triggers: ['tab_open'],
      ttl: 6000,
      showConfetti: true,
      animation: 'bounce'
    };
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADVICE CHAINS â€” Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const CHAIN_STORAGE_KEY = 'heys_advice_chains';
  
  /**
   * ĞÑ‚Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞ¸ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
   * @param {string} chainId - ID Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞ¾Ğ²ĞµÑ‚Ğ°
   */
  function markChainStart(chainId) {
    try {
      const chains = JSON.parse(localStorage.getItem(CHAIN_STORAGE_KEY) || '{}');
      chains[chainId] = Date.now();
      localStorage.setItem(CHAIN_STORAGE_KEY, JSON.stringify(chains));
    } catch (e) {}
  }
  
  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ¿Ğ¾Ñ€Ğ° Ğ»Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑĞ¾Ğ²ĞµÑ‚ Ğ² Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞµ
   * @param {string} chainId
   * @returns {Object|null} Next advice in chain Ğ¸Ğ»Ğ¸ null
   */
  function checkChainContinuation(chainId) {
    const chainConfig = ADVICE_CHAINS[chainId];
    if (!chainConfig) return null;
    
    try {
      const chains = JSON.parse(localStorage.getItem(CHAIN_STORAGE_KEY) || '{}');
      const startTime = chains[chainId];
      if (!startTime) return null;
      
      const minutesPassed = (Date.now() - startTime) / (1000 * 60);
      if (minutesPassed >= chainConfig.delayMinutes) {
        // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ¸Ğ· chains, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ½Ğ¾Ğ²Ğ°
        delete chains[chainId];
        localStorage.setItem(CHAIN_STORAGE_KEY, JSON.stringify(chains));
        
        return chainConfig.next;
      }
    } catch (e) {}
    
    return null;
  }
  
  /**
   * Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ follow-up ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ†ĞµĞ¿Ğ¾Ñ‡ĞµĞº
   * @returns {Array} ĞœĞ°ÑÑĞ¸Ğ² follow-up ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
   */
  function generateChainAdvices() {
    const advices = [];
    
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ²ÑĞµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞ¸
    for (const chainId of Object.keys(ADVICE_CHAINS)) {
      const nextId = checkChainContinuation(chainId);
      if (nextId) {
        // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ follow-up ÑĞ¾Ğ²ĞµÑ‚
        if (nextId === 'protein_sources') {
          advices.push({
            id: 'protein_sources',
            icon: 'ğŸ—',
            text: 'Ğ˜Ğ´ĞµĞ¸ Ğ´Ğ»Ñ Ğ±ĞµĞ»ĞºĞ°: ĞºÑƒÑ€Ğ¸Ñ†Ğ°, ÑĞ¹Ñ†Ğ°, Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³, Ñ€Ñ‹Ğ±Ğ°, Ğ³Ñ€ĞµÑ‡ĞµÑĞºĞ¸Ğ¹ Ğ¹Ğ¾Ğ³ÑƒÑ€Ñ‚',
            details: 'ĞšÑƒÑ€Ğ¸Ñ†Ğ° â€” 27Ğ³/100Ğ³, Ğ¢Ğ²Ğ¾Ñ€Ğ¾Ğ³ â€” 18Ğ³/100Ğ³, Ğ¯Ğ¹Ñ†Ğ° â€” 13Ğ³/100Ğ³, Ğ¢ÑƒĞ½ĞµÑ† â€” 24Ğ³/100Ğ³',
            type: 'tip',
            priority: 28,
            category: 'nutrition',
            triggers: ['tab_open'],
            ttl: 7000
          });
        } else if (nextId === 'fiber_sources') {
          advices.push({
            id: 'fiber_sources',
            icon: 'ğŸ¥¦',
            text: 'Ğ›ÑƒÑ‡ÑˆĞ¸Ğµ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ¸: Ğ±Ñ€Ğ¾ĞºĞºĞ¾Ğ»Ğ¸, Ğ¾Ğ²ÑÑĞ½ĞºĞ°, Ñ‡ĞµÑ‡ĞµĞ²Ğ¸Ñ†Ğ°, Ğ°Ğ²Ğ¾ĞºĞ°Ğ´Ğ¾',
            details: 'Ğ§ĞµÑ‡ĞµĞ²Ğ¸Ñ†Ğ° â€” 8Ğ³/100Ğ³, ĞĞ²Ğ¾ĞºĞ°Ğ´Ğ¾ â€” 7Ğ³/100Ğ³, Ğ‘Ñ€Ğ¾ĞºĞºĞ¾Ğ»Ğ¸ â€” 3Ğ³/100Ğ³, ĞĞ²ÑÑĞ½ĞºĞ° â€” 10Ğ³/100Ğ³',
            type: 'tip',
            priority: 28,
            category: 'nutrition',
            triggers: ['tab_open'],
            ttl: 7000
          });
        } else if (nextId === 'water_benefits') {
          advices.push({
            id: 'water_benefits',
            icon: 'ğŸ’§',
            text: 'Ğ’Ğ¾Ğ´Ğ° ÑƒÑĞºĞ¾Ñ€ÑĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼ Ğ½Ğ° 30% Ğ½Ğ° Ñ‡Ğ°Ñ Ğ¿Ğ¾ÑĞ»Ğµ ÑÑ‚Ğ°ĞºĞ°Ğ½Ğ°',
            type: 'tip',
            priority: 45,
            category: 'hydration',
            triggers: ['tab_open'],
            ttl: 5000
          });
        }
      }
    }
    
    return advices;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADVICE SCHEDULING â€” ĞÑ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞÑ‚ĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°ĞµÑ‚ ÑĞ¾Ğ²ĞµÑ‚ Ğ½Ğ° ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ
   * @param {Object} advice - Ğ¡Ğ¾Ğ²ĞµÑ‚
   * @param {number} minutes - Ğ§ĞµÑ€ĞµĞ· ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ
   */
  function scheduleAdvice(advice, minutes) {
    try {
      const scheduled = JSON.parse(localStorage.getItem(SCHEDULED_KEY) || '[]');
      scheduled.push({
        advice,
        showAt: Date.now() + minutes * 60 * 1000
      });
      localStorage.setItem(SCHEDULED_KEY, JSON.stringify(scheduled));
      
      // Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞºĞµ
      window.dispatchEvent(new CustomEvent('heysAdviceScheduled', { 
        detail: { advice, minutes } 
      }));
    } catch (e) {}
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞ¾Ğ²ĞµÑ‚Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¿Ğ¾Ñ€Ğ° Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ
   * @returns {Array}
   */
  function getScheduledAdvices() {
    try {
      const scheduled = JSON.parse(localStorage.getItem(SCHEDULED_KEY) || '[]');
      const now = Date.now();
      
      const ready = scheduled.filter(s => s.showAt <= now);
      const remaining = scheduled.filter(s => s.showAt > now);
      
      // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ storage
      localStorage.setItem(SCHEDULED_KEY, JSON.stringify(remaining));
      
      return ready.map(s => ({
        ...s.advice,
        id: s.advice.id + '_scheduled',
        isScheduled: true,
        text: 'â° ' + s.advice.text,
        triggers: ['scheduled', 'tab_open', 'product_added'], // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸ Ğ»ÑĞ±Ğ¾Ğ¼ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğµ
        priority: 100 // Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ â€” Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ°Ğ¼ Ğ¾Ñ‚Ğ»Ğ¾Ğ¶Ğ¸Ğ»
      }));
    } catch (e) {
      return [];
    }
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
   * @returns {number}
   */
  function getScheduledCount() {
    try {
      const scheduled = JSON.parse(localStorage.getItem(SCHEDULED_KEY) || '[]');
      return scheduled.length;
    } catch (e) {
      return 0;
    }
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // GOAL-SPECIFIC ADVICE â€” Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾ Ñ†ĞµĞ»ÑĞ¼
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ñ†ĞµĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
   * @param {number} deficitPct - % Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğ°/Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ñ‚Ğ°
   * @returns {'deficit'|'bulk'|'maintenance'}
   */
  function getGoalMode(deficitPct) {
    if (deficitPct <= -10) return 'deficit';
    if (deficitPct >= 10) return 'bulk';
    return 'maintenance';
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ±Ğ¾Ğ½ÑƒÑĞ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ñ†ĞµĞ»Ğ¸
   * @param {string} goalMode
   * @returns {Array}
   */
  function getGoalSpecificAdvices(goalMode) {
    const config = GOAL_MODES[goalMode];
    if (!config || !config.bonusAdvices) return [];
    
    return config.bonusAdvices.map(a => ({
      ...a,
      type: 'tip',
      category: 'lifestyle',
      triggers: ['tab_open'],
      ttl: 5000,
      goalSpecific: true
    }));
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // MICRO-ANIMATIONS â€” ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ° ÑĞ¾Ğ²ĞµÑ‚Ğ°
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ĞºĞ»Ğ°ÑÑ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ ÑĞ¾Ğ²ĞµÑ‚Ğ°
   * @param {Object} advice
   * @returns {string} CSS class name
   */
  function getAdviceAnimation(advice) {
    // Ğ¯Ğ²Ğ½Ğ¾ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ
    if (advice.animation) return advice.animation;
    
    // ĞŸĞ¾ Ñ‚Ğ¸Ğ¿Ñƒ
    return ADVICE_ANIMATIONS[advice.type] || 'fadeSlide';
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SMART PRODUCT CATEGORIES â€” ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ²
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹ Ğ´Ğ½Ñ Ğ¸ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ ĞºĞ°ĞºĞ¸Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ñ‹
   * @param {Object} day - Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ½Ñ
   * @param {Object} pIndex - Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ²
   * @returns {Object} { present: Set<string>, missing: string[], counts: Map }
   */
  function analyzeProductCategories(day, pIndex) {
    const present = new Set();
    const counts = new Map();
    
    const allItems = (day?.meals || []).flatMap(m => m.items || []);
    
    for (const item of allItems) {
      let productName = item.name || '';
      if (!productName && pIndex?.byId && item.product_id) {
        const product = pIndex.byId.get(item.product_id) || pIndex.byId.get(String(item.product_id));
        if (product) productName = product.name || '';
      }
      
      const nameLower = productName.toLowerCase();
      
      for (const [category, config] of Object.entries(PRODUCT_CATEGORIES)) {
        if (config.keywords.some(kw => nameLower.includes(kw))) {
          present.add(category);
          counts.set(category, (counts.get(category) || 0) + 1);
        }
      }
    }
    
    // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰Ğ¸Ğµ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    const importantCategories = ['vegetables', 'fruits', 'dairy', 'fish'];
    const missing = importantCategories.filter(c => !present.has(c));
    
    return { present, missing, counts };
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DAY FORECAST â€” ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ· ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹ Ğº ĞºĞ¾Ğ½Ñ†Ñƒ Ğ´Ğ½Ñ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ % ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹ Ğº ĞºĞ¾Ğ½Ñ†Ñƒ Ğ´Ğ½Ñ
   * @param {number} currentKcalPct - Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ % Ğ¾Ñ‚ Ğ½Ğ¾Ñ€Ğ¼Ñ‹
   * @param {number} hour - Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ‡Ğ°Ñ
   * @param {number} mealCount - ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ¾Ğ² Ğ¿Ğ¸Ñ‰Ğ¸
   * @returns {Object} { forecastPct, trend: 'under'|'on_track'|'over', message }
   */
  function getDayForecast(currentKcalPct, hour, mealCount) {
    if (hour < 10 || mealCount === 0) return null;
    
    // Ğ¢Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ: Ğº 12:00 ~25%, Ğº 15:00 ~50%, Ğº 18:00 ~75%, Ğº 21:00 ~95%
    const expectedByHour = {
      10: 0.15, 11: 0.20, 12: 0.30, 13: 0.40, 14: 0.50,
      15: 0.55, 16: 0.60, 17: 0.65, 18: 0.75, 19: 0.80,
      20: 0.85, 21: 0.92, 22: 0.97, 23: 1.0
    };
    
    const expectedNow = expectedByHour[hour] || (hour < 10 ? 0.1 : 1.0);
    const pace = currentKcalPct / expectedNow;
    
    // ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ· Ğ½Ğ° ĞºĞ¾Ğ½ĞµÑ† Ğ´Ğ½Ñ
    const forecastPct = Math.round(pace * 100);
    
    let trend = 'on_track';
    let message = '';
    
    if (pace < 0.85) {
      trend = 'under';
      message = `ĞŸÑ€Ğ¸ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¼ Ñ‚ĞµĞ¼Ğ¿Ğµ Ğ±ÑƒĞ´ĞµÑ‚ ~${forecastPct}% Ğº Ğ²ĞµÑ‡ĞµÑ€Ñƒ`;
    } else if (pace > 1.15) {
      trend = 'over';
      message = `ĞŸÑ€Ğ¸ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¼ Ñ‚ĞµĞ¼Ğ¿Ğµ Ğ±ÑƒĞ´ĞµÑ‚ ~${forecastPct}% Ğº Ğ²ĞµÑ‡ĞµÑ€Ñƒ`;
    } else {
      trend = 'on_track';
      message = `Ğ¢ĞµĞ¼Ğ¿ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹ â€” Ğ±ÑƒĞ´ĞµÑ‚ ~${forecastPct}% Ğº Ğ²ĞµÑ‡ĞµÑ€Ñƒ`;
    }
    
    return { forecastPct, trend, message, pace };
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // WEEKLY COMPARISON â€” Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ½ĞµĞ´ĞµĞ»Ğ¸ Ñ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ¹
   * @returns {Object|null} { kcalDiff, simpleDiff, protDiff, message }
   */
  function getWeeklyComparison() {
    try {
      const lsGet = (window.HEYS?.utils?.lsGet) || ((k, d) => {
        try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : d; } catch { return d; }
      });
      
      const today = new Date();
      const dayOfWeek = today.getDay() || 7; // 1-7 (Ğ¿Ğ½-Ğ²Ñ)
      
      // Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº Ğ¸Ğ»Ğ¸ Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¸Ğº â€” Ğ¼Ğ°Ğ»Ğ¾ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
      if (dayOfWeek <= 2) return null;
      
      let thisWeek = { kcal: 0, simple: 0, prot: 0, days: 0 };
      let lastWeek = { kcal: 0, simple: 0, prot: 0, days: 0 };
      
      // Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ½ĞµĞ´ĞµĞ»Ğ¸
      for (let i = 0; i < dayOfWeek; i++) {
        const d = new Date(today);
        d.setDate(d.getDate() - i);
        const iso = d.toISOString().slice(0, 10);
        const dayData = lsGet('heys_dayv2_' + iso, null);
        if (dayData?.meals?.length > 0) {
          thisWeek.kcal += dayData.dayTot?.kcal || 0;
          thisWeek.simple += dayData.dayTot?.simple || 0;
          thisWeek.prot += dayData.dayTot?.prot || 0;
          thisWeek.days++;
        }
      }
      
      // Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»Ğ¸ (Ñ‚Ğµ Ğ¶Ğµ Ğ´Ğ½Ğ¸)
      for (let i = 7; i < 7 + dayOfWeek; i++) {
        const d = new Date(today);
        d.setDate(d.getDate() - i);
        const iso = d.toISOString().slice(0, 10);
        const dayData = lsGet('heys_dayv2_' + iso, null);
        if (dayData?.meals?.length > 0) {
          lastWeek.kcal += dayData.dayTot?.kcal || 0;
          lastWeek.simple += dayData.dayTot?.simple || 0;
          lastWeek.prot += dayData.dayTot?.prot || 0;
          lastWeek.days++;
        }
      }
      
      if (thisWeek.days < 2 || lastWeek.days < 2) return null;
      
      // Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ
      const avgThis = {
        kcal: thisWeek.kcal / thisWeek.days,
        simple: thisWeek.simple / thisWeek.days,
        prot: thisWeek.prot / thisWeek.days
      };
      const avgLast = {
        kcal: lastWeek.kcal / lastWeek.days,
        simple: lastWeek.simple / lastWeek.days,
        prot: lastWeek.prot / lastWeek.days
      };
      
      // ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚Ğ½Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ
      const kcalDiff = avgLast.kcal > 0 ? Math.round((avgThis.kcal - avgLast.kcal) / avgLast.kcal * 100) : 0;
      const simpleDiff = avgLast.simple > 0 ? Math.round((avgThis.simple - avgLast.simple) / avgLast.simple * 100) : 0;
      const protDiff = avgLast.prot > 0 ? Math.round((avgThis.prot - avgLast.prot) / avgLast.prot * 100) : 0;
      
      // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑĞ°Ğ¼Ğ¾Ğ³Ğ¾ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ
      let message = null;
      const absDiffs = [
        { type: 'simple', diff: simpleDiff, positive: simpleDiff < 0 },
        { type: 'prot', diff: protDiff, positive: protDiff > 0 },
        { type: 'kcal', diff: kcalDiff, positive: Math.abs(kcalDiff) < 10 }
      ];
      
      // Ğ˜Ñ‰ĞµĞ¼ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ğ¸
      const goodNews = absDiffs.filter(d => d.positive && Math.abs(d.diff) >= 10);
      if (goodNews.length > 0) {
        const best = goodNews.sort((a, b) => Math.abs(b.diff) - Math.abs(a.diff))[0];
        if (best.type === 'simple' && best.diff < -10) {
          message = `ĞĞ° ${Math.abs(best.diff)}% Ğ¼ĞµĞ½ÑŒÑˆĞµ ÑĞ°Ñ…Ğ°Ñ€Ğ° Ñ‡ĞµĞ¼ Ğ½Ğ° Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»Ğµ! ğŸ‰`;
        } else if (best.type === 'prot' && best.diff > 10) {
          message = `ĞĞ° ${best.diff}% Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ±ĞµĞ»ĞºĞ° Ñ‡ĞµĞ¼ Ğ½Ğ° Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»Ğµ! ğŸ’ª`;
        }
      }
      
      return { kcalDiff, simpleDiff, protDiff, message, thisWeek, lastWeek };
    } catch (e) {
      return null;
    }
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SMART DISMISS â€” Ğ£Ğ¼Ğ½Ğ¾Ğµ ÑĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğµ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ÑĞ¾Ğ²ĞµÑ‚Ğ°
   * @param {string} adviceId
   * @param {number} visibleMs - Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ñ Ğ±Ñ‹Ğ» Ğ²Ğ¸Ğ´ĞµĞ½
   */
  function trackDismiss(adviceId, visibleMs) {
    try {
      if (visibleMs < QUICK_DISMISS_THRESHOLD_MS) {
        const key = 'heys_dismiss_' + adviceId;
        const count = parseInt(localStorage.getItem(key) || '0', 10);
        localStorage.setItem(key, String(count + 1));
      }
    } catch (e) {}
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¼Ğ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ° Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¹
   * @param {string} adviceId
   * @returns {number} 1.0 = Ğ½Ğ¾Ñ€Ğ¼Ğ°, <1 = ÑĞ½Ğ¸Ğ¶ĞµĞ½
   */
  function getDismissPenalty(adviceId) {
    try {
      const count = parseInt(localStorage.getItem('heys_dismiss_' + adviceId) || '0', 10);
      if (count >= 3) return 0.3;  // 3+ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¹ = ÑĞ¸Ğ»ÑŒĞ½Ğ¾ ÑĞ½Ğ¸Ğ¶Ğ°ĞµĞ¼
      if (count >= 2) return 0.5;  // 2 = ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾
      if (count >= 1) return 0.7;  // 1 = ÑĞ»ĞµĞ³ĞºĞ°
      return 1.0;
    } catch (e) {
      return 1.0;
    }
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DYNAMIC TTL â€” ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ TTL Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ´Ğ»Ğ¸Ğ½Ñ‹ Ñ‚ĞµĞºÑÑ‚Ğ°
   * @param {string} text
   * @param {boolean} isCritical
   * @returns {number} TTL Ğ² Ğ¼Ñ
   */
  function calculateDynamicTTL(text, isCritical = false) {
    const baseTime = text.length * TTL_CONFIG.msPerChar;
    let ttl = Math.max(TTL_CONFIG.minTTL, Math.min(TTL_CONFIG.maxTTL, baseTime));
    if (isCritical) ttl += TTL_CONFIG.criticalBonus;
    return ttl;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADVICE CHAINS â€” Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ follow-up ÑĞ¾Ğ²ĞµÑ‚ Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°
   * @param {string} prevAdviceId
   * @returns {Object|null} { nextAdviceId, ready: boolean }
   */
  function checkAdviceChain(prevAdviceId) {
    const chain = ADVICE_CHAINS[prevAdviceId];
    if (!chain) return null;
    
    try {
      const key = 'heys_chain_' + prevAdviceId;
      const shownAt = localStorage.getItem(key);
      if (!shownAt) return null;
      
      const elapsed = Date.now() - parseInt(shownAt, 10);
      const ready = elapsed >= chain.delayMinutes * 60 * 1000;
      
      return { nextAdviceId: chain.next, ready };
    } catch (e) {
      return null;
    }
  }
  
  /**
   * Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¾ĞºĞ°Ğ· ÑĞ¾Ğ²ĞµÑ‚Ğ° Ğ´Ğ»Ñ chain
   * @param {string} adviceId
   */
  function markChainStart(adviceId) {
    if (ADVICE_CHAINS[adviceId]) {
      try {
        localStorage.setItem('heys_chain_' + adviceId, String(Date.now()));
      } catch (e) {}
    }
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // STREAK GAMIFICATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞ¸Ğ¹ milestone streak Ğ¸ ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¾ÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ
   * @param {number} currentStreak
   * @returns {Object|null} { milestone, remain, icon, text }
   */
  function getNextStreakMilestone(currentStreak) {
    for (const m of STREAK_MILESTONES) {
      if (currentStreak < m.days) {
        const remain = m.days - currentStreak;
        const text = m.text.replace('${remain}', String(remain));
        return { milestone: m.days, remain, icon: m.icon, text };
      }
    }
    return null;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // WEEKLY SUMMARY
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸Ñ‚Ğ¾Ğ³Ğ¸ Ğ½ĞµĞ´ĞµĞ»Ğ¸ (Ğ´Ğ»Ñ Ğ²Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒÑ Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼)
   * @returns {Object|null} { avgKcal, avgProt, avgSimple, bestDay, worstDay, message }
   */
  function getWeeklySummary() {
    try {
      const lsGet = (window.HEYS?.utils?.lsGet) || ((k, d) => {
        try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : d; } catch { return d; }
      });
      
      const today = new Date();
      if (today.getDay() !== 0) return null; // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ
      
      const weekDays = [];
      
      for (let i = 0; i < 7; i++) {
        const d = new Date(today);
        d.setDate(d.getDate() - i);
        const iso = d.toISOString().slice(0, 10);
        const dayData = lsGet('heys_dayv2_' + iso, null);
        if (dayData?.meals?.length > 0) {
          weekDays.push({
            date: iso,
            kcal: dayData.dayTot?.kcal || 0,
            prot: dayData.dayTot?.prot || 0,
            simple: dayData.dayTot?.simple || 0,
            score: dayData.dayScore || 0
          });
        }
      }
      
      if (weekDays.length < 3) return null;
      
      const avgKcal = Math.round(weekDays.reduce((s, d) => s + d.kcal, 0) / weekDays.length);
      const avgProt = Math.round(weekDays.reduce((s, d) => s + d.prot, 0) / weekDays.length);
      const avgSimple = Math.round(weekDays.reduce((s, d) => s + d.simple, 0) / weekDays.length);
      
      const bestDay = weekDays.reduce((best, d) => d.score > best.score ? d : best, weekDays[0]);
      const worstDay = weekDays.reduce((worst, d) => d.score < worst.score && d.score > 0 ? d : worst, weekDays[0]);
      
      const message = `ĞĞµĞ´ĞµĞ»Ñ: ${weekDays.length} Ğ´Ğ½ĞµĞ¹, ~${avgKcal} ĞºĞºĞ°Ğ»/Ğ´ĞµĞ½ÑŒ, ~${avgProt}Ğ³ Ğ±ĞµĞ»ĞºĞ°`;
      
      return { avgKcal, avgProt, avgSimple, bestDay, worstDay, message, daysTracked: weekDays.length };
    } catch (e) {
      return null;
    }
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // HELPER FUNCTIONS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ½ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ÑÑƒÑ‚Ğ¾Ğº
   * @param {number} hour - Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ñ‡Ğ°Ñ (0-23)
   * @returns {'gentle'|'active'|'calm'}
   */
  function getToneForHour(hour) {
    // Ğ£Ğ±Ñ€Ğ°Ğ½ silent Ñ€ĞµĞ¶Ğ¸Ğ¼ â€” ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ 24/7
    if (hour >= 6 && hour < 10) return 'gentle';   // Ğ£Ñ‚Ñ€Ğ¾ â€” Ğ¼ÑĞ³ĞºĞ¾
    if (hour >= 10 && hour < 18) return 'active';  // Ğ”ĞµĞ½ÑŒ â€” Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾
    return 'calm'; // Ğ’ĞµÑ‡ĞµÑ€/Ğ½Ğ¾Ñ‡ÑŒ â€” ÑĞ¿Ğ¾ĞºĞ¾Ğ¹Ğ½Ğ¾
  }
  
  /**
   * ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
   * Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ HEYS.ratioZones Ğ´Ğ»Ñ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ²
   * @param {Object} params
   * @returns {'normal'|'stressed'|'crashed'|'success'|'returning'}
   */
  function getEmotionalState(params) {
    const { day, currentStreak, mealCount, kcalPct, totalDaysTracked, goal } = params;
    
    // Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ goal â€” Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ goal-aware Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ
    if (goal) {
      // Ğ’ĞµÑ€Ğ½ÑƒĞ»ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµÑ€Ñ‹Ğ²Ğ°
      let lastVisitDaysAgo = 0;
      try {
        const lastVisit = localStorage.getItem('heys_last_visit');
        if (lastVisit) {
          const last = new Date(lastVisit);
          const now = new Date();
          lastVisitDaysAgo = Math.floor((now - last) / (1000 * 60 * 60 * 24));
        }
      } catch(e) {}
      if (lastVisitDaysAgo > 3) return 'returning';
      
      // Ğ¡Ñ€Ñ‹Ğ² â€” ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ñ‹Ğ±Ğ¸Ğ»ÑÑ Ğ¸Ğ· Ñ†ĞµĞ»Ğ¸
      if (isCriticallyOver(kcalPct, goal) || isCriticallyUnder(kcalPct, goal)) return 'crashed';
      
      // Ğ¡Ñ‚Ñ€ĞµÑÑ â€” Ğ½Ğ¸Ğ·ĞºĞ¾Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ
      const avgMood = calculateAverageMood(day);
      if (avgMood > 0 && avgMood < 3) return 'stressed';
      
      // Ğ£ÑĞ¿ĞµÑ… â€” Ğ² Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ¼ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğµ Ğ¸Ğ»Ğ¸ streak
      if (currentStreak >= 3 || isInTargetRange(kcalPct, goal)) return 'success';
      
      return 'normal';
    }
    
    // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ratioZones (legacy fallback)
    const rz = HEYS.ratioZones;
    if (rz) {
      return rz.getEmotionalCategory(kcalPct, currentStreak);
    }
    
    // Fallback ĞµÑĞ»Ğ¸ ratioZones Ğ½Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½
    // Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ lastVisitDaysAgo Ğ¸Ğ· localStorage
    let lastVisitDaysAgo = 0;
    try {
      const lastVisit = localStorage.getItem('heys_last_visit');
      if (lastVisit) {
        const last = new Date(lastVisit);
        const now = new Date();
        lastVisitDaysAgo = Math.floor((now - last) / (1000 * 60 * 60 * 24));
      }
    } catch(e) {}
    
    // Ğ’ĞµÑ€Ğ½ÑƒĞ»ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿ĞµÑ€ĞµÑ€Ñ‹Ğ²Ğ°
    if (lastVisitDaysAgo > 3) return 'returning';
    
    // Ğ¡Ñ€Ñ‹Ğ² â€” ÑĞ¸Ğ»ÑŒĞ½Ğ¾ Ğ¿ĞµÑ€ĞµĞµĞ» Ğ¸Ğ»Ğ¸ Ğ½ĞµĞ´Ğ¾ĞµĞ»
    if (kcalPct > 1.3 || kcalPct < 0.5) return 'crashed';
    
    // Ğ¡Ñ‚Ñ€ĞµÑÑ â€” Ğ½Ğ¸Ğ·ĞºĞ¾Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ
    const avgMood = calculateAverageMood(day);
    if (avgMood > 0 && avgMood < 3) return 'stressed';
    
    // Ğ£ÑĞ¿ĞµÑ… â€” streak Ğ¸Ğ»Ğ¸ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹ Ğ´ĞµĞ½ÑŒ (0.75-1.1)
    if (currentStreak >= 3 || (kcalPct >= 0.75 && kcalPct <= 1.1)) return 'success';
    
    return 'normal';
  }
  
  /**
   * Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ ÑÑ€ĞµĞ´Ğ½ĞµĞµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ Ğ·Ğ° Ğ´ĞµĞ½ÑŒ
   * @param {Object} day
   * @returns {number} 0 ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, Ğ¸Ğ½Ğ°Ñ‡Ğµ 1-5
   */
  function calculateAverageMood(day) {
    const meals = day?.meals || [];
    const moods = meals.map(m => m.mood).filter(m => m > 0);
    if (moods.length === 0) return 0;
    return moods.reduce((a, b) => a + b, 0) / moods.length;
  }
  
  /**
   * Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ ÑÑ‚Ñ€ĞµÑÑ Ğ·Ğ° Ğ´ĞµĞ½ÑŒ
   * @param {Object} day
   * @returns {number} 0 ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, Ğ¸Ğ½Ğ°Ñ‡Ğµ 1-5
   */
  function calculateAverageStress(day) {
    const meals = day?.meals || [];
    const stresses = meals.map(m => m.stress).filter(s => s > 0);
    if (stresses.length === 0) return 0;
    return stresses.reduce((a, b) => a + b, 0) / stresses.length;
  }
  
  /**
   * Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ ÑÑ€ĞµĞ´Ğ½ĞµĞµ ÑĞ°Ğ¼Ğ¾Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ğµ Ğ·Ğ° Ğ´ĞµĞ½ÑŒ
   * @param {Object} day
   * @returns {number} 0 ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, Ğ¸Ğ½Ğ°Ñ‡Ğµ 1-5
   */
  function calculateAverageWellbeing(day) {
    const meals = day?.meals || [];
    const values = meals.map(m => m.wellbeing).filter(w => w > 0);
    if (values.length === 0) return 0;
    return values.reduce((a, b) => a + b, 0) / values.length;
  }
  
  /**
   * ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ğ¾ÑĞ¾Ğ±Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ (Ğ¿Ğ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº, Ğ¿ÑÑ‚Ğ½Ğ¸Ñ†Ğ° Ğ¸ Ñ‚.Ğ´.)
   * @param {Date} date
   * @returns {string|null}
   */
  function getSpecialDay(date) {
    const day = date.getDay();
    const month = date.getMonth();
    const dateNum = date.getDate();
    const hour = date.getHours();
    
    // ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ³Ğ¾Ğ´
    if (month === 0 && dateNum === 1) return 'new_year';
    
    // ĞŸĞ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº ÑƒÑ‚Ñ€Ğ¾
    if (day === 1 && hour < 12) return 'monday_morning';
    
    // ĞŸÑÑ‚Ğ½Ğ¸Ñ†Ğ° Ğ²ĞµÑ‡ĞµÑ€
    if (day === 5 && hour >= 17) return 'friday_evening';
    
    // Ğ’Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ Ğ²ĞµÑ‡ĞµÑ€
    if (day === 0 && hour >= 18) return 'sunday_evening';
    
    // ĞšĞ¾Ğ½ĞµÑ† Ğ¼ĞµÑÑÑ†Ğ°
    if (dateNum >= 28) return 'month_end';
    
    return null;
  }
  
  /**
   * Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
   * @param {Array} advices
   * @param {string} emotionalState
   * @returns {Array}
   */
  function filterByEmotionalState(advices, emotionalState) {
    // ĞŸÑ€Ğ¸ ÑÑ‚Ñ€ĞµÑÑĞµ Ğ¸Ğ»Ğ¸ ÑÑ€Ñ‹Ğ²Ğµ â€” ÑƒĞ±Ğ¸Ñ€Ğ°ĞµĞ¼ warnings
    if (emotionalState === 'stressed' || emotionalState === 'crashed') {
      return advices.filter(a => a.type !== 'warning');
    }
    return advices;
  }
  
  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ·Ğ°Ğ½ÑÑ‚ Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ (Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ° Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºĞ° Ğ¸ Ñ‚.Ğ´.)
   * @param {Object} uiState
   * @returns {boolean}
   */
  function isUserBusy(uiState) {
    if (!uiState) return false;
    return !!(
      uiState.modalOpen ||
      uiState.searchOpen ||
      uiState.showTimePicker ||
      uiState.showGramsPicker ||
      uiState.showWeightPicker ||
      uiState.showDeficitPicker ||
      uiState.showZonePicker ||
      uiState.showSleepQualityPicker ||
      uiState.showDayScorePicker ||
      uiState.showHouseholdPicker ||
      uiState.showTrainingPicker
    );
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SESSION MANAGEMENT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞµÑÑĞ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
   * @returns {Object}
   */
  function getSessionData() {
    try {
      const data = sessionStorage.getItem(SESSION_KEY);
      return data ? JSON.parse(data) : { shown: [], count: 0, lastShown: 0 };
    } catch (e) {
      return { shown: [], count: 0, lastShown: 0 };
    }
  }
  
  /**
   * Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ ÑĞµÑÑĞ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
   * @param {Object} data
   */
  function saveSessionData(data) {
    try {
      sessionStorage.setItem(SESSION_KEY, JSON.stringify(data));
    } catch (e) {
      // Ignore storage errors
    }
  }
  
  /**
   * ĞÑ‚Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ ÑĞ¾Ğ²ĞµÑ‚ ĞºĞ°Ğº Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¹
   * @param {string} adviceId
   */
  function markAdviceShown(adviceId) {
    const data = getSessionData();
    if (!data.shown.includes(adviceId)) {
      data.shown.push(adviceId);
    }
    data.count++;
    data.lastShown = Date.now();
    saveSessionData(data);
  }
  
  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¾Ğ²ĞµÑ‚
   * @param {string} adviceId
   * @param {Object} options - { canSkipCooldown?: boolean }
   * @returns {boolean}
   */
  function canShowAdvice(adviceId, options = {}) {
    const data = getSessionData();
    
    // Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² Ğ·Ğ° ÑĞµÑÑĞ¸Ñ
    if (data.count >= MAX_ADVICES_PER_SESSION) return false;
    
    // Cooldown Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ¾Ğ²ĞµÑ‚Ğ°Ğ¼Ğ¸ (ĞµÑĞ»Ğ¸ Ğ½Ğµ canSkipCooldown)
    if (!options.canSkipCooldown && Date.now() - data.lastShown < ADVICE_COOLDOWN_MS) return false;
    
    // Ğ£Ğ¶Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ»Ğ¸ ÑÑ‚Ğ¾Ñ‚ ÑĞ¾Ğ²ĞµÑ‚
    if (data.shown.includes(adviceId)) return false;
    
    return true;
  }
  
  /**
   * Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ excludes
   * Ğ•ÑĞ»Ğ¸ ÑĞ¾Ğ²ĞµÑ‚ A.excludes ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ B.id, Ğ¸ Ğ¾Ğ±Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹ â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ A (Ğ¿Ğ¾ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñƒ)
   * @param {Array} advices - ĞÑ‚ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñƒ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
   * @returns {Array}
   */
  function filterByExcludes(advices) {
    const excludedIds = new Set();
    const result = [];
    
    for (const advice of advices) {
      // Ğ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾Ñ‚ ÑĞ¾Ğ²ĞµÑ‚ ÑƒĞ¶Ğµ Ğ¸ÑĞºĞ»ÑÑ‡Ñ‘Ğ½ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼ â€” Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼
      if (excludedIds.has(advice.id)) continue;
      
      result.push(advice);
      
      // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞµĞ³Ğ¾ excludes Ğ² Ğ¸ÑĞºĞ»ÑÑ‡Ñ‘Ğ½Ğ½Ñ‹Ğµ
      if (advice.excludes && Array.isArray(advice.excludes)) {
        for (const exId of advice.excludes) {
          excludedIds.add(exId);
        }
      }
    }
    
    return result;
  }
  
  /**
   * Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ â€” Ğ¸Ğ· Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½
   * @param {Array} advices - Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ (ÑƒĞ¶Ğµ Ğ¾Ñ‚ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñƒ)
   * @returns {Array}
   */
  function deduplicateAdvices(advices) {
    const shownGroups = new Set();
    const result = [];
    
    for (const advice of advices) {
      // ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñƒ, Ğº ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ÑÑ ÑĞ¾Ğ²ĞµÑ‚
      let adviceGroup = null;
      for (const [group, ids] of Object.entries(DEDUPLICATION_RULES)) {
        if (ids.includes(advice.id)) {
          adviceGroup = group;
          break;
        }
      }
      
      // Ğ•ÑĞ»Ğ¸ ÑĞ¾Ğ²ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ½Ğ°Ğ´Ğ»ĞµĞ¶Ğ¸Ñ‚ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğµ Ğ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ° ÑƒĞ¶Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ° â€” Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼
      if (adviceGroup && shownGroups.has(adviceGroup)) {
        continue;
      }
      
      result.push(advice);
      if (adviceGroup) {
        shownGroups.add(adviceGroup);
      }
    }
    
    return result;
  }
  
  /**
   * Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµÑ‚ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¼ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸ÑĞ¼
   * @param {Array} advices
   * @returns {Array}
   */
  function filterByTimeRestrictions(advices) {
    const hour = new Date().getHours();
    
    return advices.filter(advice => {
      const restriction = TIME_RESTRICTIONS[advice.id];
      if (!restriction) return true; // ĞĞµÑ‚ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğ¹
      
      // notAfterHour: Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»Ğµ N Ñ‡Ğ°ÑĞ¾Ğ²
      if (restriction.notAfterHour !== undefined && hour >= restriction.notAfterHour) {
        return false;
      }
      
      // notBeforeHour: Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ¾ N Ñ‡Ğ°ÑĞ¾Ğ²
      if (restriction.notBeforeHour !== undefined && hour < restriction.notBeforeHour) {
        return false;
      }
      
      // onlyBetweenHours: Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğµ [from, to]
      if (restriction.onlyBetweenHours) {
        const [from, to] = restriction.onlyBetweenHours;
        if (hour < from || hour >= to) {
          return false;
        }
      }
      
      return true;
    });
  }

  /**
   * ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼ (Ğ°Ğ½Ñ‚Ğ¸ÑĞ¿Ğ°Ğ¼)
   * ĞĞµ Ğ±Ğ¾Ğ»ĞµĞµ MAX_ADVICES_PER_CATEGORY ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
   * @param {Array} advices
   * @returns {Array}
   */
  function limitByCategory(advices) {
    const categoryCount = {};
    const result = [];
    
    for (const advice of advices) {
      const cat = advice.category || 'other';
      categoryCount[cat] = (categoryCount[cat] || 0) + 1;
      
      if (categoryCount[cat] <= MAX_ADVICES_PER_CATEGORY) {
        result.push(advice);
      }
    }
    
    return result;
  }
  
  /**
   * ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ boost Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ° Ğ´Ğ»Ñ goal-specific ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
   * @param {Array} advices
   * @param {Object} goal - Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ goal Ñ€ĞµĞ¶Ğ¸Ğ¼
   * @returns {Array}
   */
  function applyGoalBoost(advices, goal) {
    if (!goal) return advices;
    
    const goalPrefix = goal.mode + '_'; // 'bulk_', 'deficit_', 'maintenance_'
    
    return advices.map(advice => {
      // Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ÑÑ‰Ğ¸ĞµÑÑ Ñ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ goal Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ÑÑ‚ boost
      if (advice.id.startsWith(goalPrefix)) {
        return { ...advice, priority: advice.priority - 10 }; // ĞœĞµĞ½ÑŒÑˆĞµ = Ğ²Ñ‹ÑˆĞµ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚
      }
      return advice;
    });
  }
  
  /**
   * Ğ¡Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµÑ‚ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº ÑĞµÑÑĞ¸Ğ¸ (Ğ¿Ñ€Ğ¸ ÑĞ¼ĞµĞ½Ğµ Ğ´Ğ½Ñ)
   */
  function resetSessionAdvices() {
    saveSessionData({ shown: [], count: 0, lastShown: 0 });
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // TRACKING â€” Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
   * @returns {Object} { [adviceId]: { shown: number, clicked: number, lastShown: timestamp } }
   */
  function getTrackingStats() {
    try {
      const data = localStorage.getItem(TRACKING_KEY);
      if (!data) return {};
      const parsed = JSON.parse(data);
      
      // ĞĞ²Ñ‚Ğ¾Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ°: ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ ÑÑ‚Ğ°Ñ€ÑˆĞµ 30 Ğ´Ğ½ĞµĞ¹
      const now = Date.now();
      const THIRTY_DAYS = 30 * 24 * 60 * 60 * 1000;
      let needsSave = false;
      Object.keys(parsed).forEach(key => {
        if (parsed[key].lastShown && (now - parsed[key].lastShown) > THIRTY_DAYS) {
          delete parsed[key];
          needsSave = true;
        }
      });
      if (needsSave) {
        localStorage.setItem(TRACKING_KEY, JSON.stringify(parsed));
      }
      return parsed;
    } catch (e) {
      return {};
    }
  }
  
  /**
   * Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ
   * @param {Object} stats
   */
  function saveTrackingStats(stats) {
    try {
      localStorage.setItem(TRACKING_KEY, JSON.stringify(stats));
    } catch (e) {
      // Ignore storage errors
    }
  }
  
  /**
   * Ğ¢Ñ€ĞµĞºĞ°ĞµÑ‚ Ğ¿Ğ¾ĞºĞ°Ğ· ÑĞ¾Ğ²ĞµÑ‚Ğ°
   * @param {string} adviceId
   */
  function trackAdviceShown(adviceId) {
    const stats = getTrackingStats();
    if (!stats[adviceId]) {
      stats[adviceId] = { shown: 0, clicked: 0, lastShown: 0 };
    }
    stats[adviceId].shown++;
    stats[adviceId].lastShown = Date.now();
    saveTrackingStats(stats);
  }
  
  /**
   * Ğ¢Ñ€ĞµĞºĞ°ĞµÑ‚ ĞºĞ»Ğ¸Ğº/Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ¿Ğ¾ ÑĞ¾Ğ²ĞµÑ‚Ñƒ
   * @param {string} adviceId
   */
  function trackAdviceClicked(adviceId) {
    const stats = getTrackingStats();
    if (!stats[adviceId]) {
      stats[adviceId] = { shown: 0, clicked: 0, lastShown: 0 };
    }
    stats[adviceId].clicked++;
    saveTrackingStats(stats);
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ CTR (click-through rate) ÑĞ¾Ğ²ĞµÑ‚Ğ°
   * @param {string} adviceId
   * @returns {number} 0-1
   */
  function getAdviceCTR(adviceId) {
    const stats = getTrackingStats();
    const s = stats[adviceId];
    if (!s || s.shown === 0) return 0;
    return s.clicked / s.shown;
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ¿ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² Ğ¿Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ¼
   * @param {number} n - ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾
   * @returns {Array<{id: string, shown: number, clicked: number, ctr: number}>}
   */
  function getTopAdvices(n = 10) {
    const stats = getTrackingStats();
    return Object.entries(stats)
      .map(([id, s]) => ({ id, ...s, ctr: s.shown > 0 ? s.clicked / s.shown : 0 }))
      .sort((a, b) => b.shown - a.shown)
      .slice(0, n);
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // GOAL-AWARE HELPERS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
   * @param {number} deficitPct - ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğ°/Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ñ‚Ğ° (Ğ¾Ñ‚Ñ€Ğ¸Ñ†Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ = Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚, Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ = Ğ½Ğ°Ğ±Ğ¾Ñ€)
   * @returns {{mode: 'deficit'|'maintenance'|'bulk', label: string, emoji: string, targetRange: {min: number, max: number}}}
   */
  function getGoalMode(deficitPct) {
    const pct = deficitPct || 0;
    
    if (pct <= -10) {
      // ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ (-10% Ğ¸ Ğ½Ğ¸Ğ¶Ğµ)
      return {
        mode: 'deficit',
        label: 'ĞŸĞ¾Ñ…ÑƒĞ´ĞµĞ½Ğ¸Ğµ',
        emoji: 'ğŸ”¥',
        // Ğ£ÑĞ¿ĞµÑ…: 90-105% Ğ¾Ñ‚ optimum (Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ·Ğ°Ğ¿Ğ°Ñ Ğ½Ğ° Ğ¿Ğ¾Ğ³Ñ€ĞµÑˆĞ½Ğ¾ÑÑ‚ÑŒ)
        targetRange: { min: 0.90, max: 1.05 },
        // ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ĞµĞ±Ğ¾Ñ€: >115% (ÑƒĞ¶Ğµ ÑĞ¸Ğ»ÑŒĞ½Ğ¾ Ğ²Ñ‹Ğ±Ğ¸Ğ»ÑÑ Ğ¸Ğ· Ğ¿Ğ»Ğ°Ğ½Ğ°)
        criticalOver: 1.15,
        // ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ½ĞµĞ´Ğ¾Ğ±Ğ¾Ñ€: <80%
        criticalUnder: 0.80
      };
    } else if (pct <= -5) {
      // Ğ›Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ (-5% Ğ´Ğ¾ -9%)
      return {
        mode: 'deficit',
        label: 'Ğ›Ñ‘Ğ³ĞºĞ¾Ğµ Ğ¿Ğ¾Ñ…ÑƒĞ´ĞµĞ½Ğ¸Ğµ',
        emoji: 'ğŸ¯',
        targetRange: { min: 0.92, max: 1.08 },
        criticalOver: 1.20,
        criticalUnder: 0.75
      };
    } else if (pct >= 10) {
      // ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ (+10% Ğ¸ Ğ²Ñ‹ÑˆĞµ)
      return {
        mode: 'bulk',
        label: 'ĞĞ°Ğ±Ğ¾Ñ€ Ğ¼Ğ°ÑÑÑ‹',
        emoji: 'ğŸ’ª',
        // Ğ£ÑĞ¿ĞµÑ…: 95-110% Ğ¾Ñ‚ optimum
        targetRange: { min: 0.95, max: 1.10 },
        // ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ĞµĞ±Ğ¾Ñ€: >125% (ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾)
        criticalOver: 1.25,
        // ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ½ĞµĞ´Ğ¾Ğ±Ğ¾Ñ€: <85% (Ğ½Ğµ Ğ´Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑˆÑŒ Ğ´Ğ»Ñ Ñ€Ğ¾ÑÑ‚Ğ°)
        criticalUnder: 0.85
      };
    } else if (pct >= 5) {
      // Ğ›Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€ (+5% Ğ´Ğ¾ +9%)
      return {
        mode: 'bulk',
        label: 'Ğ›Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€',
        emoji: 'ğŸ’ª',
        targetRange: { min: 0.93, max: 1.12 },
        criticalOver: 1.20,
        criticalUnder: 0.80
      };
    } else {
      // ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ (-4% Ğ´Ğ¾ +4%)
      return {
        mode: 'maintenance',
        label: 'ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ',
        emoji: 'âš–ï¸',
        targetRange: { min: 0.90, max: 1.10 },
        criticalOver: 1.25,
        criticalUnder: 0.70
      };
    }
  }

  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ² Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ¼ Ğ»Ğ¸ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğµ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸
   * @param {number} kcalPct - ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚ Ğ¾Ñ‚ optimum
   * @param {Object} goal - ĞĞ±ÑŠĞµĞºÑ‚ Ğ¾Ñ‚ getGoalMode()
   * @returns {boolean}
   */
  function isInTargetRange(kcalPct, goal) {
    return kcalPct >= goal.targetRange.min && kcalPct <= goal.targetRange.max;
  }

  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ĞµĞ±Ğ¾Ñ€ (Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ Ñ†ĞµĞ»Ğ¸)
   * @param {number} kcalPct
   * @param {Object} goal
   * @returns {boolean}
   */
  function isCriticallyOver(kcalPct, goal) {
    return kcalPct > goal.criticalOver;
  }

  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ½ĞµĞ´Ğ¾Ğ±Ğ¾Ñ€ (Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ Ñ†ĞµĞ»Ğ¸)
   * @param {number} kcalPct
   * @param {Object} goal
   * @returns {boolean}
   */
  function isCriticallyUnder(kcalPct, goal) {
    return kcalPct < goal.criticalUnder;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ADVICE GENERATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ ÑĞ¾Ğ²ĞµÑ‚ ÑĞ¾ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼ (Ğ´ĞµÑ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ¸Ğ· Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ¾Ğ²)
   * @param {Object} advice - ĞĞ±ÑŠĞµĞºÑ‚ ÑĞ¾Ğ²ĞµÑ‚Ğ° Ñ id, text (string|array), Ğ¸ Ğ´Ñ€.
   * @param {Object} ctx - ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ personalizeText
   * @returns {Object} Ğ¡Ğ¾Ğ²ĞµÑ‚ ÑĞ¾ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼
   */
  function createAdvice(advice, ctx) {
    // Ğ•ÑĞ»Ğ¸ text â€” Ğ¼Ğ°ÑÑĞ¸Ğ², Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾ id
    const rawText = Array.isArray(advice.text) 
      ? pickRandomText(advice.text, advice.id) 
      : advice.text;
    
    // ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ñ‚ĞµĞºÑÑ‚
    const text = ctx ? personalizeText(rawText, ctx) : rawText;
    
    return { ...advice, text };
  }
  
  /**
   * Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ²ÑĞµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°
   * @param {Object} ctx - ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ½Ñ
   * @returns {Array} ĞœĞ°ÑÑĞ¸Ğ² ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
   */
  function generateAdvices(ctx) {
    // ğŸš€ Early exit: ĞµÑĞ»Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ½ĞµĞ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ â€” Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ğ¼Ğ°ÑÑĞ¸Ğ²
    if (!ctx || !ctx.normAbs) {
      return [];
    }
    
    const advices = [];
    const {
      dayTot, normAbs, optimum, day, pIndex, currentStreak,
      hour, mealCount, hasTraining, kcalPct,
      tone, specialDay, emotionalState, prof, waterGoal,
      goal: ctxGoal // ğŸ¯ Goal Ğ¸Ğ· ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)
    } = ctx;
    
    // ğŸ¯ Goal-aware ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
    // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ goal Ğ¸Ğ· ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¸Ğ»Ğ¸ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾ (fallback)
    const goal = ctxGoal || (() => {
      const dayDeficit = day?.deficitPct;
      const profileDeficit = prof?.deficitPctTarget;
      const effectiveDeficit = dayDeficit ?? profileDeficit ?? 0;
      return getGoalMode(effectiveDeficit);
    })();
    
    // Ğ¤Ğ»Ğ°Ğ³ Ğ´Ğ»Ñ Ğ¿ÑƒÑÑ‚Ğ¾Ğ³Ğ¾ Ğ´Ğ½Ñ â€” Ğ½ĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ
    const isDayEmpty = (dayTot?.kcal || 0) < 10 && mealCount === 0;
    
    // Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚Ğ½Ñ‹Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»Ğ¸
    const proteinPct = (dayTot?.prot || 0) / (normAbs?.prot || 1);
    const fatPct = (dayTot?.fat || 0) / (normAbs?.fat || 1);
    const carbsPct = (dayTot?.carbs || 0) / (normAbs?.carbs || 1);
    const fiberPct = (dayTot?.fiber || 0) / (normAbs?.fiber || 1);
    const simplePct = (dayTot?.simple || 0) / (normAbs?.simple || 1);
    const transPct = (dayTot?.trans || 0) / (normAbs?.trans || 1);
    const harmPct = (dayTot?.harm || 0) / (normAbs?.harm || 1);
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ¯ SPECIAL DAY TIPS â€” ĞœĞ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ´Ğ½ÑĞ¼
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (specialDay === 'monday_morning') {
      advices.push({
        id: 'monday_motivation',
        icon: 'ğŸ’ª',
        text: personalizeText(pickRandomText([
          'ĞĞ¾Ğ²Ğ°Ñ Ğ½ĞµĞ´ĞµĞ»Ñ â€” Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸!',
          '${firstName}, Ğ½Ğ¾Ğ²Ğ°Ñ Ğ½ĞµĞ´ĞµĞ»Ñ â€” Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚!',
          'ĞŸĞ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº â€” Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚ Ğ´Ğ»Ñ Ñ†ĞµĞ»ĞµĞ¹!'
        ]), ctx),
        details: 'Ğ˜ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚: Ğ»ÑĞ´Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒÑÑ‚ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ Ğ² Ğ¿Ğ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº, Ğ½Ğ° 30% ÑƒÑĞ¿ĞµÑˆĞ½ĞµĞµ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ°ÑÑ‚ Ñ†ĞµĞ»ĞµĞ¹. Ğ—Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ¿Ğ»Ğ°Ğ½ Ğ½Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ!',
        type: 'tip',
        priority: 5,
        category: 'motivation',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    if (specialDay === 'friday_evening') {
      advices.push({
        id: 'friday_reminder',
        icon: 'ğŸ¯',
        text: 'Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ±Ğ»Ğ¸Ğ·ĞºĞ¾ â€” Ğ¿Ğ¾Ğ¼Ğ½Ğ¸ Ğ¾ ÑĞ²Ğ¾Ğ¸Ñ… Ñ†ĞµĞ»ÑÑ…!',
        details: 'Ğ’ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ»ĞµĞ³ĞºĞ¾ Ğ¿ĞµÑ€ĞµĞµÑÑ‚ÑŒ Ğ½Ğ° 500-1000 ĞºĞºĞ°Ğ». Ğ¡Ğ¾Ğ²ĞµÑ‚: Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑŒ ÑĞµĞ±Ğµ 1 "ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğ¹" Ğ¿Ñ€Ğ¸Ñ‘Ğ¼, Ğ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´ĞµÑ€Ğ¶Ğ¸ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ.',
        type: 'tip',
        priority: 10,
        category: 'motivation',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    if (specialDay === 'sunday_evening') {
      advices.push({
        id: 'sunday_planning',
        icon: 'ğŸ“‹',
        text: 'Ğ¡Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞ¹ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ',
        details: 'Meal prep Ğ² Ğ²Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ‚ 3-5 Ñ‡Ğ°ÑĞ¾Ğ² Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ. ĞŸÑ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²ÑŒ Ğ±Ğ°Ğ·Ñƒ: ĞºÑ€ÑƒĞ¿Ñ‹, Ğ¼ÑÑĞ¾, Ğ¾Ğ²Ğ¾Ñ‰Ğ¸ â€” ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ¸Ñ€ÑƒĞ¹ Ğ² Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ±Ğ»ÑĞ´Ğ°.',
        type: 'tip',
        priority: 10,
        category: 'motivation',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 42: ĞŸĞ¾ÑĞ»Ğµ Ğ¿Ñ€Ğ°Ğ·Ğ´Ğ½Ğ¸ĞºĞ¾Ğ² â€” Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ´ĞµĞ½ÑŒ
    const today = new Date();
    const dayOfMonth = today.getDate();
    const monthOfYear = today.getMonth(); // 0-indexed
    // Ğ”Ğ½Ğ¸ ĞŸĞĞ¡Ğ›Ğ• Ğ¿Ñ€Ğ°Ğ·Ğ´Ğ½Ğ¸ĞºĞ¾Ğ²: 1-2 ÑĞ½Ğ²Ğ°Ñ€Ñ, 24 Ñ„ĞµĞ²Ñ€Ğ°Ğ»Ñ, 9 Ğ¼Ğ°Ñ€Ñ‚Ğ°, 10 Ğ¼Ğ°Ñ, 13 Ğ¸ÑĞ½Ñ
    const postHolidayDates = [
      [1, 0], [2, 0],    // ĞŸĞ¾ÑĞ»Ğµ ĞĞ“
      [24, 1],           // ĞŸĞ¾ÑĞ»Ğµ 23 Ñ„ĞµĞ²Ñ€Ğ°Ğ»Ñ
      [9, 2],            // ĞŸĞ¾ÑĞ»Ğµ 8 Ğ¼Ğ°Ñ€Ñ‚Ğ°
      [10, 4],           // ĞŸĞ¾ÑĞ»Ğµ 9 Ğ¼Ğ°Ñ
      [13, 5]            // ĞŸĞ¾ÑĞ»Ğµ 12 Ğ¸ÑĞ½Ñ
    ];
    
    const isPostHoliday = postHolidayDates.some(([d, m]) => d === dayOfMonth && m === monthOfYear);
    
    if (isPostHoliday && !sessionStorage.getItem('heys_post_holiday')) {
      advices.push({
        id: 'post_holiday_detox',
        icon: 'ğŸŒ¿',
        text: 'ĞŸĞ¾ÑĞ»Ğµ Ğ²Ñ‡ĞµÑ€Ğ°ÑˆĞ½ĞµĞ³Ğ¾ Ğ¿Ñ€Ğ°Ğ·Ğ´Ğ½Ğ¸ĞºĞ° â€” Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ´ĞµĞ½ÑŒ: Ğ¾Ğ²Ğ¾Ñ‰Ğ¸, Ğ²Ğ¾Ğ´Ğ°, Ğ±ĞµĞ»Ğ¾Ğº',
        details: 'ĞĞµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ°Ñ‚ÑŒ! ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ Ğ»Ñ‘Ğ³ĞºÑƒÑ ĞµĞ´Ñƒ: ÑĞ°Ğ»Ğ°Ñ‚Ñ‹, Ñ€Ñ‹Ğ±Ğ° Ğ½Ğ° Ğ¿Ğ°Ñ€Ñƒ, Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ¾Ğ´Ñ‹. ĞÑ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ¼ ÑĞ°Ğ¼ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ·Ğ° 1-2 Ğ´Ğ½Ñ.',
        type: 'tip',
        priority: 15,
        category: 'lifestyle',
        triggers: ['tab_open'],
        ttl: 6000,
        onShow: () => { try { sessionStorage.setItem('heys_post_holiday', '1'); } catch(e) {} }
      });
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 43: ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ Ğ¾ Ğ»ÑƒÑ‡ÑˆĞµĞ¼ Ğ´Ğ½Ğµ Ğ½ĞµĞ´ĞµĞ»Ğ¸
    const lastBestDayCheck = localStorage.getItem('heys_best_day_last_check');
    const weekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000;
    
    if (!lastBestDayCheck || +lastBestDayCheck < weekAgo) {
      const recentDays = getRecentDays(7);
      
      if (recentDays.length >= 3) {
        // ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ´ĞµĞ½ÑŒ Ñ Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¼ ratio (closest to 1.0)
        let bestDay = null;
        let bestDiff = Infinity;
        
        for (const d of recentDays) {
          // Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ ÑÑƒĞ¼Ğ¼Ñƒ ĞºĞºĞ°Ğ» Ğ´Ğ½Ñ (Ğ³Ñ€ÑƒĞ±Ğ¾)
          const dayMeals = d.meals || [];
          let dayKcal = 0;
          for (const meal of dayMeals) {
            for (const item of (meal.items || [])) {
              const product = pIndex?.byId?.get(item.product_id);
              if (product) dayKcal += (product.kcal100 || 0) * (item.grams || 100) / 100;
            }
          }
          
          // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ optimum (Ğ¾Ğ½ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ĞµĞ½)
          const ratio = dayKcal / (optimum || 2000);
          const diff = Math.abs(ratio - 1.0);
          
          if (diff < bestDiff && ratio > 0.5) {
            bestDiff = diff;
            bestDay = { ...d, ratio };
          }
        }
        
        if (bestDay && bestDiff < 0.15) { // Ğ’ Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ°Ñ… Â±15% Ğ¾Ñ‚ Ğ½Ğ¾Ñ€Ğ¼Ñ‹
          const dayDate = new Date(bestDay.date);
          const dayNames = ['Ğ²Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ', 'Ğ¿Ğ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº', 'Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¸Ğº', 'ÑÑ€ĞµĞ´Ğ°', 'Ñ‡ĞµÑ‚Ğ²ĞµÑ€Ğ³', 'Ğ¿ÑÑ‚Ğ½Ğ¸Ñ†Ğ°', 'ÑÑƒĞ±Ğ±Ğ¾Ñ‚Ğ°'];
          const dayName = dayNames[dayDate.getDay()];
          const pct = Math.round(bestDay.ratio * 100);
          
          advices.push({
            id: 'best_day_recall',
            icon: 'â­',
            text: `Ğ¢Ğ²Ğ¾Ğ¹ Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ±Ñ‹Ğ» ${dayName} â€” ${pct}% Ğ½Ğ¾Ñ€Ğ¼Ñ‹. ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸!`,
            details: 'ğŸ’¡ Ğ’ÑĞ¿Ğ¾Ğ¼Ğ½Ğ¸, Ñ‡Ñ‚Ğ¾ Ñ‚Ñ‹ ĞµĞ» Ğ² Ñ‚Ğ¾Ñ‚ Ğ´ĞµĞ½ÑŒ. Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑ‚ÑŒ!',
            type: 'motivation',
            priority: 44,
            category: 'motivation',
            triggers: ['tab_open'],
            ttl: 6000,
            onShow: () => { 
              try { localStorage.setItem('heys_best_day_last_check', Date.now().toString()); } catch(e) {} 
            }
          });
        }
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ˜Š EMOTIONAL STATE TIPS â€” ĞŸĞ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (emotionalState === 'crashed') {
      advices.push({
        id: 'crash_support',
        icon: 'ğŸ’™',
        text: 'Ğ‘Ñ‹Ğ²Ğ°ĞµÑ‚! Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ° Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ. Ğ¢Ñ‹ ÑĞ¿Ñ€Ğ°Ğ²Ğ¸ÑˆÑŒÑÑ!',
        details: 'ğŸ§¡ ĞĞ´Ğ¸Ğ½ Ğ¿Ğ»Ğ¾Ñ…Ğ¾Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ½Ğµ Ğ¾Ñ‚Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ²ÑĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°. Ğ”Ğ°Ğ¶Ğµ Ñƒ Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»Ğ¾Ğ² Ğ±Ñ‹Ğ²Ğ°ÑÑ‚ ÑÑ€Ñ‹Ğ²Ñ‹. Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ â€” Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğº Ğ¿Ğ»Ğ°Ğ½Ñƒ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°.',
        type: 'achievement',
        priority: 1,
        category: 'emotional',
        triggers: ['tab_open', 'product_added'],
        ttl: 6000
      });
    }
    
    if (emotionalState === 'stressed') {
      advices.push({
        id: 'stress_support',
        icon: 'ğŸ¤—',
        text: 'Ğ¢Ñ‹ Ğ¼Ğ¾Ğ»Ğ¾Ğ´ĞµÑ†, Ñ‡Ñ‚Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑˆÑŒ. Ğ­Ñ‚Ğ¾ ÑƒĞ¶Ğµ ÑƒÑĞ¿ĞµÑ…!',
        details: 'ğŸ’ª Ğ¡Ğ°Ğ¼ Ñ„Ğ°ĞºÑ‚ Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ´Ğ½ĞµĞ²Ğ½Ğ¸ĞºĞ° ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ ÑˆĞ°Ğ½ÑÑ‹ Ğ½Ğ° ÑƒÑĞ¿ĞµÑ… Ğ² 2 Ñ€Ğ°Ğ·Ğ°. Ğ”Ğ°Ğ¶Ğµ Ğ² ÑÑ‚Ñ€ĞµÑÑĞµ Ñ‚Ñ‹ Ğ´ĞµĞ»Ğ°ĞµÑˆÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ ÑˆĞ°Ğ³Ğ¸.',
        type: 'achievement',
        priority: 2,
        category: 'emotional',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ† ACHIEVEMENTS (priority: 1-10) â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ¿Ñ€Ğ¸ tab_open
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (currentStreak >= 7 && !sessionStorage.getItem('heys_streak7')) {
      advices.push({
        id: 'streak_7',
        icon: 'ğŸ†',
        text: personalizeText(pickRandomText([
          `ĞĞµĞ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾! ${currentStreak} Ğ´Ğ½ĞµĞ¹ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ!`,
          `${firstName}, Ñ‚Ñ‹ Ğ»ĞµĞ³ĞµĞ½Ğ´Ğ°! ${currentStreak} Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´!`,
          `ğŸ”¥ ${currentStreak} Ğ´Ğ½ĞµĞ¹ streak! Ğ¢Ğ°Ğº Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ!`
        ]), ctx),
        details: 'ğŸŒŸ Ğ­Ñ‚Ğ¾ Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚, Ñ‡Ñ‚Ğ¾ Ñ‚Ñ‹ ÑƒĞ¶Ğµ ÑÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ» Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºÑƒ! Ğ˜ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚: 21 Ğ´ĞµĞ½ÑŒ â€” Ğ¸ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ğ°Ğ½ĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼.',
        type: 'achievement',
        priority: 1,
        category: 'achievement',
        score: 1.0,
        triggers: ['tab_open'],
        ttl: 7000,
        showConfetti: true,
        canSkipCooldown: true, // ğŸš¨ Critical â€” Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ
        excludes: ['streak_3'], // Ğ˜ÑĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ streak_3
        onShow: () => { try { sessionStorage.setItem('heys_streak7', '1'); } catch(e) {} }
      });
    }
    
    if (currentStreak >= 3 && currentStreak < 7 && !sessionStorage.getItem('heys_streak3')) {
      advices.push({
        id: 'streak_3',
        icon: 'ğŸ”¥',
        text: `${currentStreak} Ğ´Ğ½Ñ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ! Ğ¢Ğ°Ğº Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ!`,
        details: 'ğŸ’ª Ğ¢Ñ‹ Ğ½Ğ° Ğ¿ÑƒÑ‚Ğ¸ Ğº Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºĞµ! Ğ•Ñ‰Ñ‘ 4 Ğ´Ğ½Ñ â€” Ğ¸ Ğ±ÑƒĞ´ĞµÑ‚ Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ streak. ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ â€” ÑÑ‚Ğ¾ Ğ¸Ğ½Ğ²ĞµÑÑ‚Ğ¸Ñ†Ğ¸Ñ Ğ² Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ.',
        type: 'achievement',
        priority: 2,
        category: 'achievement',
        score: 0.9,
        triggers: ['tab_open'],
        ttl: 5000,
        onShow: () => { try { sessionStorage.setItem('heys_streak3', '1'); } catch(e) {} }
      });
    }
    
    // Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ â€” Ğ² Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ¼ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğµ Ñ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¼Ğ¸ Ğ¼Ğ°ĞºÑ€Ğ¾ÑĞ°Ğ¼Ğ¸ (Goal-aware)
    if (hour >= 18 && isInTargetRange(kcalPct, goal) && 
        proteinPct >= 0.9 && fatPct >= 0.9 && carbsPct >= 0.9) {
      advices.push({
        id: 'perfect_day',
        icon: 'â­',
        text: goal.mode === 'bulk'
          ? 'Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ°! ğŸ’ªğŸ‰'
          : goal.mode === 'deficit'
            ? 'Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ Ñ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¾Ğ¼ Ğ‘Ğ–Ğ£! ğŸ”¥ğŸ‰'
            : 'Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ! ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° ğŸ‰',
        details: 'ğŸŒŸ ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸, Ğ±ĞµĞ»ĞºĞ¸, Ğ¶Ğ¸Ñ€Ñ‹ Ğ¸ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ â€” Ğ²ÑÑ‘ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ. Ğ¢Ğ°ĞºĞ¸Ğµ Ğ´Ğ½Ğ¸ Ğ¿Ñ€Ğ¸Ğ±Ğ»Ğ¸Ğ¶Ğ°ÑÑ‚ Ñ‚ĞµĞ±Ñ Ğº Ñ†ĞµĞ»Ğ¸. Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸, Ñ‡Ñ‚Ğ¾ ĞµĞ» ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ!',
        type: 'achievement',
        priority: 5,
        category: 'achievement',
        score: 1.0,
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ â€” Ğ¿Ğ¾ÑĞ»Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°
    if (mealCount === 1 && !localStorage.getItem('heys_first_meal_tip')) {
      advices.push({
        id: 'first_day',
        icon: 'ğŸ‘‹',
        text: 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾! Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ¹ Ğ²ÑÑ‘ â€” ÑÑ‚Ğ¾ ĞºĞ»ÑÑ‡ Ğº ÑƒÑĞ¿ĞµÑ…Ñƒ',
        details: 'ğŸ“Š Ğ˜ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: Ğ»ÑĞ´Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ÑÑ‚ ĞµĞ´Ñƒ, Ñ…ÑƒĞ´ĞµÑÑ‚ Ğ² 2 Ñ€Ğ°Ğ·Ğ° ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½ĞµĞµ. Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ¹ ÑÑ€Ğ°Ğ·Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ ĞµĞ´Ñ‹ â€” Ñ‚Ğ°Ğº Ñ‚Ğ¾Ñ‡Ğ½ĞµĞµ.',
        type: 'achievement',
        priority: 3,
        category: 'achievement',
        score: 1.0,
        triggers: ['product_added'],
        ttl: 5000,
        onShow: () => { try { localStorage.setItem('heys_first_meal_tip', '1'); } catch(e) {} }
      });
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // âš ï¸ WARNINGS (priority: 11-30) â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°
    // ğŸ¯ Goal-aware: Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ¸ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ¿Ğ¾Ğ´ Ñ†ĞµĞ»ÑŒ (Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚/Ğ½Ğ°Ğ±Ğ¾Ñ€/Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ĞµĞ±Ğ¾Ñ€ (Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ Ñ†ĞµĞ»Ğ¸)
    if (isCriticallyOver(kcalPct, goal)) {
      const overPct = Math.round((kcalPct - 1) * 100);
      const goalText = goal.mode === 'bulk' 
        ? 'Ğ”Ğ°Ğ¶Ğµ Ğ´Ğ»Ñ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ° ÑÑ‚Ğ¾ Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ‚Ğ¾' 
        : goal.mode === 'deficit'
          ? 'ĞŸĞ»Ğ°Ğ½ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğ° Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½'
          : 'Ğ¡Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğ¾Ñ€Ğ¼Ñ‹';
      advices.push({
        id: 'kcal_excess_critical',
        icon: 'ğŸ”´',
        text: `+${overPct}% Ğ¾Ñ‚ Ğ¿Ğ»Ğ°Ğ½Ğ°. ${goalText}`,
        details: goal.mode === 'bulk'
          ? 'ĞĞ°Ğ±Ğ¾Ñ€ Ğ¼Ğ°ÑÑÑ‹ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ñ‚Ğ°, Ğ½Ğ¾ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¸Ğ·Ğ±Ñ‹Ñ‚Ğ¾Ğº ÑƒÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Ğ¶Ğ¸Ñ€. Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ° Ğ²ĞµÑ€Ğ½Ğ¸ÑÑŒ Ğ² Ğ¿Ğ»Ğ°Ğ½ +10-15%.'
          : 'ĞĞµ ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¿ĞµÑ€ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ! ĞĞ´Ğ¸Ğ½ Ğ´ĞµĞ½ÑŒ Ğ¿ĞµÑ€ĞµĞµĞ´Ğ°Ğ½Ğ¸Ñ â€” ÑÑ‚Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾. Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ° ÑĞ´ĞµĞ»Ğ°Ğ¹ Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ Ğ¸ Ğ²ÑÑ‘ Ğ²Ñ‹Ñ€Ğ¾Ğ²Ğ½ÑĞµÑ‚ÑÑ.',
        type: 'warning',
        priority: 11,
        category: 'nutrition',
        triggers: ['product_added'],
        ttl: 6000
      });
    } 
    // Ğ›Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ĞµĞ±Ğ¾Ñ€ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ ĞĞ• Ğ² Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ¼ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğµ Ğ¸ Ğ½Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹)
    else if (kcalPct > goal.targetRange.max && !isCriticallyOver(kcalPct, goal)) {
      const overPct = Math.round((kcalPct - 1) * 100);
      advices.push({
        id: 'kcal_excess_mild',
        icon: 'âš ï¸',
        text: goal.mode === 'bulk'
          ? `+${overPct}% â€” Ñ‡ÑƒÑ‚ÑŒ Ğ²Ñ‹ÑˆĞµ Ğ¿Ğ»Ğ°Ğ½Ğ° Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ°`
          : `+${overPct}% Ğ¾Ñ‚ Ğ¿Ğ»Ğ°Ğ½Ğ° â€” Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ ÑÑ‚Ñ€Ğ°ÑˆĞ½Ğ¾Ğ³Ğ¾`,
        details: 'ğŸ“Š ĞĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¿ĞµÑ€ĞµĞ±Ğ¾Ñ€ Ğ½Ğµ ÑÑ‚Ñ€Ğ°ÑˆĞµĞ½. Ğ’Ğ°Ğ¶ĞµĞ½ Ñ‚Ñ€ĞµĞ½Ğ´ Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ, Ğ° Ğ½Ğµ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾.',
        type: 'tip',
        priority: 15,
        category: 'nutrition',
        triggers: ['product_added'],
        ttl: 5000
      });
    }
    
    // ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ½ĞµĞ´Ğ¾Ğ±Ğ¾Ñ€ (Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ Ñ†ĞµĞ»Ğ¸)
    if (isCriticallyUnder(kcalPct, goal) && hour >= 14) {
      const underPct = Math.round((1 - kcalPct) * 100);
      advices.push({
        id: 'kcal_under_critical',
        icon: goal.mode === 'bulk' ? 'âš ï¸' : 'ğŸŒ™',
        text: goal.mode === 'bulk'
          ? `Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ${Math.round(kcalPct * 100)}% â€” Ğ´Ğ»Ñ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ° Ğ¼Ğ°Ğ»Ğ¾!`
          : goal.mode === 'deficit'
            ? `${Math.round(kcalPct * 100)}% â€” ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¶Ñ‘ÑÑ‚ĞºĞ¸Ğ¹ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚`
            : `Ğ¡ÑŠĞµĞ´ĞµĞ½Ğ¾ Ğ¼Ğ°Ğ»Ğ¾ â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼`,
        details: goal.mode === 'bulk'
          ? 'Ğ”Ğ»Ñ Ñ€Ğ¾ÑÑ‚Ğ° Ğ¼Ñ‹ÑˆÑ† Ğ½ÑƒĞ¶ĞµĞ½ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ñ‚ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ¸ Ğ±ĞµĞ»Ğ¾Ğº.'
          : 'Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ€ĞµĞ·ĞºĞ¸Ğ¹ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ Ğ·Ğ°Ğ¼ĞµĞ´Ğ»ÑĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼ Ğ¸ Ğ¿Ñ€Ğ¸Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğº ÑÑ€Ñ‹Ğ²Ğ°Ğ¼. Ğ›ÑƒÑ‡ÑˆĞµ ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ 10-15%.',
        type: goal.mode === 'bulk' ? 'warning' : 'tip',
        priority: 16,
        category: 'nutrition',
        triggers: ['tab_open', 'product_added'],
        ttl: 5000
      });
    }
    
    // Ğ¢Ñ€Ğ°Ğ½Ñ-Ğ¶Ğ¸Ñ€Ñ‹
    if (transPct > 1.0) {
      advices.push({
        id: 'trans_fat_warning',
        icon: 'âš ï¸',
        text: 'Ğ¢Ñ€Ğ°Ğ½Ñ-Ğ¶Ğ¸Ñ€Ñ‹ Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞµĞ½Ñ‹ â€” Ğ¸Ğ·Ğ±ĞµĞ³Ğ°Ğ¹ Ñ„Ğ°ÑÑ‚Ñ„ÑƒĞ´Ğ°',
        details: 'Ğ¢Ñ€Ğ°Ğ½Ñ-Ğ¶Ğ¸Ñ€Ñ‹ â€” ÑĞ°Ğ¼Ñ‹Ğµ Ğ²Ñ€ĞµĞ´Ğ½Ñ‹Ğµ. ĞĞ½Ğ¸ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞ°ÑÑ‚ "Ğ¿Ğ»Ğ¾Ñ…Ğ¾Ğ¹" Ñ…Ğ¾Ğ»ĞµÑÑ‚ĞµÑ€Ğ¸Ğ½ Ğ¸ ÑĞ½Ğ¸Ğ¶Ğ°ÑÑ‚ "Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹". Ğ˜Ğ·Ğ±ĞµĞ³Ğ°Ğ¹: Ğ¼Ğ°Ñ€Ğ³Ğ°Ñ€Ğ¸Ğ½, Ñ„Ğ°ÑÑ‚-Ñ„ÑƒĞ´, Ñ‡Ğ¸Ğ¿ÑÑ‹, Ğ²Ñ‹Ğ¿ĞµÑ‡ĞºĞ° Ñ Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ ÑÑ€Ğ¾ĞºĞ¾Ğ¼ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ.',
        type: 'warning',
        priority: 12,
        category: 'nutrition',
        triggers: ['product_added'],
        ttl: 5000
      });
    }
    
    // ĞŸÑ€Ğ¾ÑÑ‚Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹
    if (simplePct > 1.3) {
      const carbsText = getTimeBasedText('simple_carbs_warning', hour, 'ĞœĞ½Ğ¾Ğ³Ğ¾ ÑĞ°Ñ…Ğ°Ñ€Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ â€” Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ÑŒ ÑĞ»Ğ°Ğ´ĞºĞ¾Ğµ');
      advices.push({
        id: 'simple_carbs_warning',
        icon: 'ğŸ¬',
        text: carbsText,
        details: 'ĞŸÑ€Ğ¾ÑÑ‚Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞ°ÑÑ‚ ÑĞ°Ñ…Ğ°Ñ€ Ğ² ĞºÑ€Ğ¾Ğ²Ğ¸, Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°Ñ Ğ²ÑĞ¿Ğ»ĞµÑĞº Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½Ğ° Ğ¸ Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ ÑƒĞ¿Ğ°Ğ´Ğ¾Ğº ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸. ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ñ‹: Ñ„Ñ€ÑƒĞºÑ‚Ñ‹, Ñ‚Ñ‘Ğ¼Ğ½Ñ‹Ğ¹ ÑˆĞ¾ĞºĞ¾Ğ»Ğ°Ğ´ 70%+, Ğ¾Ñ€ĞµÑ…Ğ¸.',
        type: 'warning',
        priority: 14,
        category: 'nutrition',
        triggers: ['product_added'],
        ttl: 5000
      });
    }
    
    // Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ²Ñ€ĞµĞ´Ğ°
    if (harmPct > 1.0) {
      advices.push({
        id: 'harm_warning',
        icon: 'ğŸ’”',
        text: 'ĞœĞ½Ğ¾Ğ³Ğ¾ Ğ²Ñ€ĞµĞ´Ğ½Ğ¾Ğ³Ğ¾ â€” Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ° Ğ½Ğ°Ñ‡Ğ½Ñ‘Ğ¼ ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ°',
        details: 'Ğ’Ñ€ĞµĞ´Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹ â€” ÑÑ‚Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ¸Ğ½Ğ¾Ğ³Ğ´Ğ°. Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ â€” Ğ½Ğµ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ. Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ° ÑĞ´ĞµĞ»Ğ°Ğ¹ Ğ°ĞºÑ†ĞµĞ½Ñ‚ Ğ½Ğ° Ğ¾Ğ²Ğ¾Ñ‰Ğ°Ñ…, Ğ±ĞµĞ»ĞºĞµ Ğ¸ Ğ²Ğ¾Ğ´Ğµ.',
        type: 'warning',
        priority: 13,
        category: 'nutrition',
        triggers: ['product_added'],
        ttl: 5000
      });
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ’¡ TIPS (priority: 31-50) â€” ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾ Ğ±Ğ°Ğ»Ğ°Ğ½ÑÑƒ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ‘ĞµĞ»Ğ¾Ğº
    if (proteinPct < THRESHOLDS.protein.low && hour >= 12) {
      // Time-based text selection
      const proteinText = getTimeBasedText('protein_low', hour, 
        personalizeText(pickRandomText([
          'Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ±ĞµĞ»ĞºĞ° â€” Ğ¼ÑÑĞ¾, Ñ€Ñ‹Ğ±Ğ°, Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³',
          '${firstName}, Ğ±ĞµĞ»ĞºĞ° Ğ¼Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚Ğ¾ â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ!',
          'Ğ‘ĞµĞ»Ğ¾Ğº Ğ½ÑƒĞ¶ĞµĞ½ Ğ¼Ñ‹ÑˆÑ†Ğ°Ğ¼ â€” ĞºÑƒÑ€Ğ¸Ñ†Ğ°, ÑĞ¹Ñ†Ğ°, Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³'
        ]), ctx)
      );
      advices.push({
        id: 'protein_low',
        icon: 'ğŸ¥©',
        text: proteinText,
        details: 'Ğ‘ĞµĞ»Ğ¾Ğº Ğ²Ğ°Ğ¶ĞµĞ½ Ğ´Ğ»Ñ Ğ¼Ñ‹ÑˆÑ†, Ğ¸Ğ¼Ğ¼ÑƒĞ½Ğ¸Ñ‚ĞµÑ‚Ğ° Ğ¸ ÑÑ‹Ñ‚Ğ¾ÑÑ‚Ğ¸. ĞĞ¾Ñ€Ğ¼Ğ°: 1.5-2Ğ³ Ğ½Ğ° ĞºĞ³ Ğ²ĞµÑĞ°. Ğ›ÑƒÑ‡ÑˆĞ¸Ğµ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸: ĞºÑƒÑ€Ğ¸Ñ†Ğ°, Ğ¸Ğ½Ğ´ĞµĞ¹ĞºĞ°, Ñ€Ñ‹Ğ±Ğ°, ÑĞ¹Ñ†Ğ°, Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³, Ğ³Ñ€ĞµÑ‡ĞµÑĞºĞ¸Ğ¹ Ğ¹Ğ¾Ğ³ÑƒÑ€Ñ‚, Ğ±Ğ¾Ğ±Ğ¾Ğ²Ñ‹Ğµ.',
        type: 'tip',
        priority: 31,
        category: 'nutrition',
        triggers: ['product_added', 'tab_open'],
        excludes: ['post_training_protein', 'deficit_protein_save_muscle', 'bulk_protein_critical'],
        ttl: 5000,
        onShow: () => { markChainStart('protein_low'); }
      });
    }
    
    // ĞšĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ°
    if (fiberPct < THRESHOLDS.fiber.low && mealCount >= 2) {
      const fiberDefault = personalizeText(pickRandomText([
        'ĞœĞ°Ğ»Ğ¾ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ¸ â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¾Ğ²Ğ¾Ñ‰ĞµĞ¹ Ğ¸Ğ»Ğ¸ Ğ·Ğ»Ğ°ĞºĞ¾Ğ²',
        'ĞšĞ¸ÑˆĞµÑ‡Ğ½Ğ¸ĞºÑƒ Ğ½ÑƒĞ¶Ğ½Ğ° ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° â€” Ğ¾Ğ²Ğ¾Ñ‰Ğ¸, Ğ·ĞµĞ»ĞµĞ½ÑŒ',
        '${firstName}, Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¾Ğ²Ğ¾Ñ‰ĞµĞ¹ Ğ´Ğ»Ñ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ¸'
      ]), ctx);
      const fiberText = getTimeBasedText('fiber_low', hour, fiberDefault);
      advices.push({
        id: 'fiber_low',
        icon: 'ğŸ¥¬',
        text: fiberText,
        details: 'ĞšĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° Ğ²Ğ°Ğ¶Ğ½Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¸Ñ‰ĞµĞ²Ğ°Ñ€ĞµĞ½Ğ¸Ñ Ğ¸ ÑÑ‹Ñ‚Ğ¾ÑÑ‚Ğ¸. ĞĞ¾Ñ€Ğ¼Ğ°: 25-35Ğ³ Ğ² Ğ´ĞµĞ½ÑŒ. Ğ›Ğ¸Ğ´ĞµÑ€Ñ‹: Ğ°Ğ²Ğ¾ĞºĞ°Ğ´Ğ¾, Ğ±Ñ€Ğ¾ĞºĞºĞ¾Ğ»Ğ¸, Ğ¾Ğ²ÑÑĞ½ĞºĞ°, Ñ‡ĞµÑ‡ĞµĞ²Ğ¸Ñ†Ğ°, Ğ³Ñ€ÑƒÑˆĞ¸, Ğ¼Ğ°Ğ»Ğ¸Ğ½Ğ°, ÑĞµĞ¼ĞµĞ½Ğ° Ñ‡Ğ¸Ğ°.',
        type: 'tip',
        priority: 32,
        category: 'nutrition',
        triggers: ['product_added', 'tab_open'],
        excludes: ['deficit_fiber_satiety'],
        ttl: 5000,
        onShow: () => { markChainStart('fiber_low'); }
      });
    }
    
    // Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ°
    if (fiberPct >= THRESHOLDS.fiber.good) {
      advices.push({
        id: 'fiber_good',
        icon: 'ğŸ¥—',
        text: personalizeText(pickRandomText([
          'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ Ñ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ¾Ğ¹! ĞšĞ¸ÑˆĞµÑ‡Ğ½Ğ¸Ğº ÑĞºĞ°Ğ¶ĞµÑ‚ ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾',
          '${firstName}, ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ! ğŸ‘',
          'ĞšĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° Ğ² Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞµ â€” Ğ¿Ğ¸Ñ‰ĞµĞ²Ğ°Ñ€ĞµĞ½Ğ¸Ğµ ÑĞºĞ°Ğ¶ĞµÑ‚ ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾'
        ]), ctx),
        details: 'ğŸŒ± ĞšĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° ĞºĞ¾Ñ€Ğ¼Ğ¸Ñ‚ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ±Ğ°ĞºÑ‚ĞµÑ€Ğ¸Ğ¸ ĞºĞ¸ÑˆĞµÑ‡Ğ½Ğ¸ĞºĞ°, ÑƒĞ»ÑƒÑ‡ÑˆĞ°ĞµÑ‚ Ğ¸Ğ¼Ğ¼ÑƒĞ½Ğ¸Ñ‚ĞµÑ‚ Ğ¸ Ğ´Ğ°Ñ‘Ñ‚ Ğ´Ğ¾Ğ»Ğ³ÑƒÑ ÑÑ‹Ñ‚Ğ¾ÑÑ‚ÑŒ.',
        type: 'achievement',
        priority: 35,
        category: 'nutrition',
        triggers: ['product_added'],
        ttl: 4000
      });
    }
    
    // ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ¶Ğ¸Ñ€Ñ‹
    const goodFatPct = (dayTot?.good || 0) / (normAbs?.good || 1);
    if (goodFatPct < THRESHOLDS.fat.goodRatioLow && hour >= 14) {
      advices.push({
        id: 'good_fat_low',
        icon: 'ğŸ¥‘',
        text: personalizeText(pickRandomText([
          'Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ñ‹Ñ… Ğ¶Ğ¸Ñ€Ğ¾Ğ² â€” Ğ°Ğ²Ğ¾ĞºĞ°Ğ´Ğ¾, Ğ¾Ñ€ĞµÑ…Ğ¸, Ğ¾Ğ»Ğ¸Ğ²ĞºĞ¾Ğ²Ğ¾Ğµ Ğ¼Ğ°ÑĞ»Ğ¾',
          'ĞĞ¼ĞµĞ³Ğ°-3 Ğ²Ğ°Ğ¶Ğ½Ñ‹ â€” Ñ€Ñ‹Ğ±Ğ°, Ğ¾Ñ€ĞµÑ…Ğ¸, Ğ»ÑŒĞ½ÑĞ½Ğ¾Ğµ Ğ¼Ğ°ÑĞ»Ğ¾',
          '${firstName}, Ğ½Ğµ Ğ·Ğ°Ğ±ÑƒĞ´ÑŒ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ¶Ğ¸Ñ€Ñ‹!'
        ]), ctx),
        details: 'ĞĞ¼ĞµĞ³Ğ°-3 Ğ¸ Ğ¼Ğ¾Ğ½Ğ¾Ğ½ĞµĞ½Ğ°ÑÑ‹Ñ‰ĞµĞ½Ğ½Ñ‹Ğµ Ğ¶Ğ¸Ñ€Ñ‹ Ğ²Ğ°Ğ¶Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ·Ğ³Ğ°, ÑĞµÑ€Ğ´Ñ†Ğ° Ğ¸ Ğ³Ğ¾Ñ€Ğ¼Ğ¾Ğ½Ğ¾Ğ². Ğ›ÑƒÑ‡ÑˆĞ¸Ğµ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸: Ğ¶Ğ¸Ñ€Ğ½Ğ°Ñ Ñ€Ñ‹Ğ±Ğ° (ÑÑ‘Ğ¼Ğ³Ğ°, ÑĞºÑƒĞ¼Ğ±Ñ€Ğ¸Ñ), Ğ°Ğ²Ğ¾ĞºĞ°Ğ´Ğ¾, Ğ¾Ğ»Ğ¸Ğ²ĞºĞ¾Ğ²Ğ¾Ğµ Ğ¼Ğ°ÑĞ»Ğ¾, Ğ¾Ñ€ĞµÑ…Ğ¸ (Ğ³Ñ€ĞµÑ†ĞºĞ¸Ğµ, Ğ¼Ğ¸Ğ½Ğ´Ğ°Ğ»ÑŒ), ÑĞµĞ¼ĞµĞ½Ğ° Ğ»ÑŒĞ½Ğ° Ğ¸ Ñ‡Ğ¸Ğ°.',
        type: 'tip',
        priority: 33,
        category: 'nutrition',
        triggers: ['product_added', 'tab_open'],
        excludes: ['fat_quality_low'],
        ttl: 5000
      });
    }
    
    // Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°
    if (hasTraining && proteinPct < THRESHOLDS.protein.adequate) {
      advices.push({
        id: 'post_training_protein',
        icon: 'ğŸ’ª',
        text: personalizeText(pickRandomText([
          'ĞŸĞ¾ÑĞ»Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ²Ğ°Ğ¶ĞµĞ½ Ğ±ĞµĞ»Ğ¾Ğº â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ 20-30Ğ³',
          '${firstName}, Ğ¿Ğ¾ÑĞ»Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ½ÑƒĞ¶ĞµĞ½ Ğ±ĞµĞ»Ğ¾Ğº!',
          'ĞœÑ‹ÑˆÑ†Ñ‹ Ğ¶Ğ´ÑƒÑ‚ Ğ±ĞµĞ»Ğ¾Ğº â€” Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³, ĞºÑƒÑ€Ğ¸Ñ†Ğ°, ÑĞ¹Ñ†Ğ°'
        ]), ctx),
        details: 'Ğ‘ĞµĞ»Ğ¾Ğº Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ 2 Ñ‡Ğ°ÑĞ¾Ğ² Ğ¿Ğ¾ÑĞ»Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ ÑƒÑĞºĞ¾Ñ€ÑĞµÑ‚ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼Ñ‹ÑˆÑ†. Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾: Ğ¿Ñ€Ğ¾Ñ‚ĞµĞ¸Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾ĞºÑ‚ĞµĞ¹Ğ»ÑŒ, Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³ Ñ Ğ±Ğ°Ğ½Ğ°Ğ½Ğ¾Ğ¼, ĞºÑƒÑ€Ğ¸Ğ½Ğ°Ñ Ğ³Ñ€ÑƒĞ´ĞºĞ° Ñ Ñ€Ğ¸ÑĞ¾Ğ¼, Ğ¸Ğ»Ğ¸ Ğ³Ñ€ĞµÑ‡ĞµÑĞºĞ¸Ğ¹ Ğ¹Ğ¾Ğ³ÑƒÑ€Ñ‚ Ñ Ğ¾Ñ€ĞµÑ…Ğ°Ğ¼Ğ¸.',
        type: 'tip',
        priority: 34,
        category: 'training',
        triggers: ['product_added', 'tab_open'],
        excludes: ['protein_low', 'hard_workout_recovery', 'training_recovery_window'],
        canSkipCooldown: true, // Ğ’Ğ°Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾ÑĞ»Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸
        ttl: 5000
      });
    }
    
    // Ğ’ĞµÑ‡ĞµÑ€Ğ½Ğ¸Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ (Goal-aware)
    // ĞĞµĞ´Ğ¾Ğ±Ğ¾Ñ€ Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼ â€” Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ Ñ†ĞµĞ»Ğ¸
    if (hour >= 20 && isCriticallyUnder(kcalPct, goal)) {
      advices.push({
        id: 'evening_undereating',
        icon: goal.mode === 'bulk' ? 'âš ï¸' : 'ğŸŒ™',
        text: goal.mode === 'bulk'
          ? `Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ${Math.round(kcalPct * 100)}% â€” Ğ´Ğ»Ñ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ° Ğ¼Ğ°Ğ»Ğ¾! Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ²ĞµÑ‡ĞµÑ€Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼`
          : goal.mode === 'deficit'
            ? 'Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¶Ñ‘ÑÑ‚ĞºĞ¸Ğ¹ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ ÑƒĞ¶Ğ¸Ğ½'
            : 'Ğ•Ñ‰Ñ‘ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾ĞµÑÑ‚ÑŒ â€” Ğ½Ğµ Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ°Ğ¹ Ğ¿ĞµÑ€ĞµĞ´ ÑĞ½Ğ¾Ğ¼',
        details: goal.mode === 'bulk'
          ? 'Ğ”Ğ»Ñ Ñ€Ğ¾ÑÑ‚Ğ° Ğ¼Ñ‹ÑˆÑ† Ğ½ÑƒĞ¶ĞµĞ½ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ñ‚. Ğ’ĞµÑ‡ĞµÑ€Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼: Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³ + Ğ¾Ñ€ĞµÑ…Ğ¸, Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾Ñ‚ĞµĞ¸Ğ½ + Ğ±Ğ°Ğ½Ğ°Ğ½.'
          : 'Ğ¡Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ³Ğ¾Ğ»Ğ¾Ğ´ Ğ¿ĞµÑ€ĞµĞ´ ÑĞ½Ğ¾Ğ¼ ÑƒÑ…ÑƒĞ´ÑˆĞ°ĞµÑ‚ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ½Ğ° Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²ĞµÑÑ‚Ğ¸ Ğº Ğ½Ğ¾Ñ‡Ğ½Ñ‹Ğ¼ Ğ¿ĞµÑ€ĞµĞºÑƒÑĞ°Ğ¼.',
        type: goal.mode === 'bulk' ? 'warning' : 'tip',
        priority: 36,
        category: 'nutrition',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ â€” Ğ² Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ¼ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğµ (Goal-aware)
    if (hour >= 21 && isInTargetRange(kcalPct, goal)) {
      advices.push({
        id: 'evening_perfect',
        icon: goal.mode === 'maintenance' ? 'ğŸ˜´' : goal.emoji,
        text: goal.mode === 'bulk'
          ? 'ĞŸĞ»Ğ°Ğ½ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½! ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾ Ğ¿Ğ¾ÑĞ¿Ğ°Ñ‚ÑŒ'
          : goal.mode === 'deficit'
            ? 'Ğ”ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ Ğ²Ñ‹Ğ´ĞµÑ€Ğ¶Ğ°Ğ½! ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ'
            : 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ! ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾ Ğ²Ñ‹ÑĞ¿Ğ°Ñ‚ÑŒÑÑ',
        details: 'ğŸŒŸ Ğ’ĞµÑ‡ĞµÑ€Ğ¾Ğ¼ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ â€” Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ Ğ´ĞµĞ½ÑŒ ÑƒĞ´Ğ°Ğ»ÑÑ! Ğ¡Ğ¾Ğ½ 7-8 Ñ‡Ğ°ÑĞ¾Ğ² Ğ·Ğ°ĞºÑ€ĞµĞ¿Ğ¸Ñ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚.',
        type: 'achievement',
        priority: 37,
        category: 'lifestyle',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ Ğ¼Ğ°ĞºÑ€Ğ¾ÑĞ¾Ğ²
    if (mealCount >= 2 && 
        proteinPct >= THRESHOLDS.macros.balanceMin && fatPct >= THRESHOLDS.macros.balanceMin && carbsPct >= THRESHOLDS.macros.balanceMin &&
        proteinPct <= THRESHOLDS.macros.balanceMax && fatPct <= THRESHOLDS.macros.balanceMax && carbsPct <= THRESHOLDS.macros.balanceMax) {
      advices.push({
        id: 'balanced_macros',
        icon: 'âš–ï¸',
        text: 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ‘Ğ–Ğ£!',
        details: 'ğŸ¯ Ğ‘ĞµĞ»ĞºĞ¸, Ğ¶Ğ¸Ñ€Ñ‹ Ğ¸ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ² Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞµ â€” ÑÑ‚Ğ¾ Ñ€ĞµĞ´ĞºĞ¾ÑÑ‚ÑŒ! Ğ¢Ğ°ĞºĞ¾Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ´Ğ°Ñ‘Ñ‚ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½ÑƒÑ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ¸ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞµĞµ ÑĞ°Ğ¼Ğ¾Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ğµ.',
        type: 'achievement',
        priority: 38,
        category: 'nutrition',
        triggers: ['product_added'],
        ttl: 4000
      });
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ¯ GOAL-SPECIFIC Ğ¡ĞĞ’Ğ•Ğ¢Ğ« (priority: 39-50)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ° Ğ¼Ğ°ÑÑÑ‹
    if (goal.mode === 'bulk') {
      // Ğ‘ĞµĞ»Ğ¾Ğº ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµĞ½ Ğ´Ğ»Ñ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ°
      if (proteinPct < 0.8 && mealCount >= 1) {
        advices.push({
          id: 'bulk_protein_critical',
          icon: 'ğŸ¥©',
          text: 'Ğ”Ğ»Ñ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ° Ğ½ÑƒĞ¶ĞµĞ½ Ğ±ĞµĞ»Ğ¾Ğº! Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¼ÑÑĞ¾, Ñ€Ñ‹Ğ±Ñƒ Ğ¸Ğ»Ğ¸ Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³',
          details: 'ĞŸÑ€Ğ¸ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğµ Ğ¼Ğ°ÑÑÑ‹ Ğ±ĞµĞ»Ğ¾Ğº â€” Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ». ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 1.8-2.2Ğ³ Ğ½Ğ° ĞºĞ³ Ğ²ĞµÑĞ°. Ğ Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ğ¼ Ğ¿Ğ¸Ñ‰Ğ¸.',
          type: 'tip',
          priority: 39,
          category: 'nutrition',
          triggers: ['tab_open', 'product_added'],
          ttl: 5000
        });
      }
      
      // Ğ£Ğ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸
      if (carbsPct < 0.7 && mealCount >= 2) {
        advices.push({
          id: 'bulk_carbs_low',
          icon: 'ğŸš',
          text: 'Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² â€” Ğ¾Ğ½Ğ¸ Ğ´Ğ°ÑÑ‚ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ¾ÑÑ‚Ğ°',
          details: 'Ğ£Ğ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ â€” Ñ‚Ğ¾Ğ¿Ğ»Ğ¸Ğ²Ğ¾ Ğ´Ğ»Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ. Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğµ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸: Ñ€Ğ¸Ñ, Ğ³Ñ€ĞµÑ‡ĞºĞ°, Ğ¾Ğ²ÑÑĞ½ĞºĞ°, ĞºĞ°Ñ€Ñ‚Ğ¾Ñ„ĞµĞ»ÑŒ, Ğ¼Ğ°ĞºĞ°Ñ€Ğ¾Ğ½Ñ‹.',
          type: 'tip',
          priority: 41,
          category: 'nutrition',
          triggers: ['tab_open'],
          ttl: 5000
        });
      }
      
      // ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ Ğ¾ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸ÑÑ…
      if (hour >= 16 && kcalPct < 0.6) {
        advices.push({
          id: 'bulk_kcal_behind',
          icon: 'âš ï¸',
          text: `Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ${Math.round(kcalPct * 100)}% Ğ¾Ñ‚ Ğ¿Ğ»Ğ°Ğ½Ğ° Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ° â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹!`,
          details: 'ğŸš Ğ”Ğ»Ñ Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ° Ğ¼Ğ°ÑÑÑ‹ Ğ½ÑƒĞ¶ĞµĞ½ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ñ‚ 10-15%. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ (Ñ€Ğ¸Ñ, Ğ³Ñ€ĞµÑ‡ĞºĞ°) Ğ¸ Ğ±ĞµĞ»Ğ¾Ğº (Ğ¼ÑÑĞ¾, Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³). Ğ‘ĞµĞ· Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ñ‚Ğ° Ğ¼Ñ‹ÑˆÑ†Ñ‹ Ğ½Ğµ Ñ€Ğ°ÑÑ‚ÑƒÑ‚!',
          type: 'warning',
          priority: 40,
          category: 'nutrition',
          triggers: ['tab_open'],
          ttl: 5000
        });
      }
    }
    
    // Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğ°
    if (goal.mode === 'deficit') {
      // Ğ‘ĞµĞ»Ğ¾Ğº Ğ²Ğ°Ğ¶ĞµĞ½ Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ¼Ñ‹ÑˆÑ†
      if (proteinPct < 0.9 && mealCount >= 2) {
        advices.push({
          id: 'deficit_protein_save_muscle',
          icon: 'ğŸ’ª',
          text: 'ĞĞ° Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğµ Ğ±ĞµĞ»Ğ¾Ğº ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµĞ½ â€” Ğ¾Ğ½ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ¼Ñ‹ÑˆÑ†Ñ‹',
          details: 'ĞŸÑ€Ğ¸ Ğ¿Ğ¾Ñ…ÑƒĞ´ĞµĞ½Ğ¸Ğ¸ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ñ€Ğ°Ğ·Ñ€ÑƒÑˆĞ°Ñ‚ÑŒ Ğ¼Ñ‹ÑˆÑ†Ñ‹. Ğ‘ĞµĞ»Ğ¾Ğº 1.6-2Ğ³ Ğ½Ğ° ĞºĞ³ Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ğ°ĞµÑ‚ Ğ¼Ñ‹ÑˆĞµÑ‡Ğ½ÑƒÑ Ğ¼Ğ°ÑÑÑƒ. ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚: Ğ½ĞµĞ¶Ğ¸Ñ€Ğ½Ğ¾Ğµ Ğ¼ÑÑĞ¾, Ñ€Ñ‹Ğ±Ğ°, ÑĞ¹Ñ†Ğ°.',
          type: 'tip',
          priority: 42,
          category: 'nutrition',
          triggers: ['tab_open', 'product_added'],
          ttl: 5000
        });
      }
      
      // ĞšĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° Ğ´Ğ»Ñ ÑÑ‹Ñ‚Ğ¾ÑÑ‚Ğ¸
      if (fiberPct < 0.5 && mealCount >= 2) {
        advices.push({
          id: 'deficit_fiber_satiety',
          icon: 'ğŸ¥—',
          text: 'Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¾Ğ²Ğ¾Ñ‰ĞµĞ¹ â€” ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° Ğ´Ğ°Ñ‘Ñ‚ ÑÑ‹Ñ‚Ğ¾ÑÑ‚ÑŒ Ğ±ĞµĞ· ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹',
          details: 'ĞĞ° Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğµ Ğ²Ğ°Ğ¶Ğ½Ğ¾ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑ‹Ñ‚Ğ¾ÑÑ‚ÑŒ. ĞĞ²Ğ¾Ñ‰Ğ¸ Ğ¸ Ğ·ĞµĞ»ĞµĞ½ÑŒ â€” Ğ¾Ğ±ÑŠÑ‘Ğ¼ Ğ±ĞµĞ· ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹. ĞĞ³ÑƒÑ€Ñ†Ñ‹, Ğ¿Ğ¾Ğ¼Ğ¸Ğ´Ğ¾Ñ€Ñ‹, ĞºĞ°Ğ¿ÑƒÑÑ‚Ğ°, ÑĞ°Ğ»Ğ°Ñ‚ â€” ĞµÑˆÑŒ ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ…Ğ¾Ñ‡ĞµÑˆÑŒ.',
          type: 'tip',
          priority: 43,
          category: 'nutrition',
          triggers: ['tab_open'],
          ttl: 5000
        });
      }
      
      // ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¾ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¶Ñ‘ÑÑ‚ĞºĞ¾Ğ¼ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğµ
      if (hour >= 18 && kcalPct < 0.7 && kcalPct > 0) {
        advices.push({
          id: 'deficit_too_harsh',
          icon: 'âš ï¸',
          text: 'Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¶Ñ‘ÑÑ‚ĞºĞ¸Ğ¹ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ Ğ·Ğ°Ğ¼ĞµĞ´Ğ»ÑĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼',
          details: 'Ğ ĞµĞ·ĞºĞ¾Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğº ÑÑ€Ñ‹Ğ²Ğ°Ğ¼ Ğ¸ Ğ·Ğ°Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ğ±Ğ¼ĞµĞ½Ğ° Ğ²ĞµÑ‰ĞµÑÑ‚Ğ². Ğ›ÑƒÑ‡ÑˆĞµ ÑƒĞ¼ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ 10-15% Ğ½Ğ° Ğ´Ğ¾Ğ»Ğ³Ğ¾Ğ¹ Ğ´Ğ¸ÑÑ‚Ğ°Ğ½Ñ†Ğ¸Ğ¸.',
          type: 'warning',
          priority: 44,
          category: 'nutrition',
          triggers: ['tab_open'],
          ttl: 5000
        });
      }
      
      // ĞœĞ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğµ
      if (isInTargetRange(kcalPct, goal) && mealCount >= 2) {
        advices.push({
          id: 'deficit_on_track_motivation',
          icon: 'ğŸ”¥',
          text: 'Ğ”ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ Ğ²Ñ‹Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ â€” Ñ‚Ğ°Ğº Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ!',
          details: 'ğŸ¯ ĞŸÑ€Ğ¸ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğµ 10-15% Ñ‚Ñ‹ Ñ‚ĞµÑ€ÑĞµÑˆÑŒ ~0.5-1 ĞºĞ³ Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ Ğ±ĞµĞ· Ğ²Ñ€ĞµĞ´Ğ° Ğ´Ğ»Ñ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼Ğ°. Ğ­Ñ‚Ğ¾ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚ĞµĞ¼Ğ¿!',
          type: 'achievement',
          priority: 45,
          category: 'motivation',
          triggers: ['tab_open'],
          ttl: 4000
        });
      }
    }
    
    // Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ñ
    if (goal.mode === 'maintenance') {
      // Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ â€” Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ
      if (isInTargetRange(kcalPct, goal) && mealCount >= 2) {
        advices.push({
          id: 'maintenance_stable',
          icon: 'âš–ï¸',
          text: 'ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸ Ğ² Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞµ â€” Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ!',
          details: 'âš–ï¸ ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ Ğ²ĞµÑĞ° â€” ÑÑ‚Ğ¾ Ñ‚Ğ¾Ğ¶Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚! Ğ¢Ñ‹ Ğ½Ğ°ÑˆÑ‘Ğ» ÑĞ²Ğ¾Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ â€” Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ğ¹ Ğ² Ñ‚Ğ¾Ğ¼ Ğ¶Ğµ Ğ´ÑƒÑ…Ğµ.',
          type: 'achievement',
          priority: 46,
          category: 'nutrition',
          triggers: ['tab_open'],
          ttl: 4000
        });
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸŒ LIFESTYLE TIPS (priority: 51-70)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ¡Ğ¾Ğ½
    const sleepHours = calculateSleepHours(day);
    if (sleepHours > 0 && sleepHours < 6) {
      advices.push({
        id: 'sleep_low',
        icon: 'ğŸ˜´',
        text: 'ĞœĞ°Ğ»Ğ¾ ÑĞ½Ğ° â€” Ğ°Ğ¿Ğ¿ĞµÑ‚Ğ¸Ñ‚ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½',
        details: 'ğŸ’¤ ĞĞµĞ´Ğ¾ÑÑ‹Ğ¿ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞ°ĞµÑ‚ Ğ³Ñ€ĞµĞ»Ğ¸Ğ½ (Ğ³Ğ¾Ñ€Ğ¼Ğ¾Ğ½ Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ°) Ğ¸ ÑĞ½Ğ¸Ğ¶Ğ°ĞµÑ‚ Ğ»ĞµĞ¿Ñ‚Ğ¸Ğ½ (ÑÑ‹Ñ‚Ğ¾ÑÑ‚ÑŒ). Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ±ÑƒĞ´ĞµÑ‚ Ñ…Ğ¾Ñ‚ĞµÑ‚ÑŒÑÑ ĞµÑÑ‚ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ â€” ÑÑ‚Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾.',
        type: 'tip',
        priority: 51,
        category: 'lifestyle',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // Ğ£Ñ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğ¹ ÑĞ¾Ğ²ĞµÑ‚
    if (hour >= 7 && hour < 10 && mealCount === 0) {
      advices.push({
        id: 'morning_breakfast',
        icon: 'â˜€ï¸',
        text: 'Ğ”Ğ¾Ğ±Ñ€Ğ¾Ğµ ÑƒÑ‚Ñ€Ğ¾! ĞĞµ Ğ·Ğ°Ğ±ÑƒĞ´ÑŒ Ğ¿Ğ¾Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°ĞºĞ°Ñ‚ÑŒ',
        details: 'ğŸ³ Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼ Ğ¸ Ğ´Ğ°Ñ‘Ñ‚ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ. Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾: Ğ±ĞµĞ»Ğ¾Ğº + ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ (ÑĞ¹Ñ†Ğ° + Ğ¾Ğ²ÑÑĞ½ĞºĞ°, Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³ + Ñ„Ñ€ÑƒĞºÑ‚Ñ‹).',
        type: 'tip',
        priority: 52,
        category: 'lifestyle',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 37: Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ morning_breakfast â€” Ğ½ĞµÑ‚ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°ĞºĞ° Ğº 11
    // ĞĞ• Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ĞµÑĞ»Ğ¸ morning_breakfast ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ» Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½
    if (hour >= 10 && hour < 12 && mealCount === 0 && !sessionStorage.getItem('heys_morning_breakfast_shown')) {
      advices.push({
        id: 'empty_stomach_late',
        icon: 'ğŸ³',
        text: `Ğ£Ğ¶Ğµ ${hour}:00, Ğ° Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°ĞºĞ° Ğ½ĞµÑ‚ â€” Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼ Ğ¶Ğ´Ñ‘Ñ‚ Ñ‚Ğ¾Ğ¿Ğ»Ğ¸Ğ²Ğ°`,
        details: 'âš ï¸ ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞº Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°ĞºĞ° Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²ĞµÑÑ‚Ğ¸ Ğº Ğ¿ĞµÑ€ĞµĞµĞ´Ğ°Ğ½Ğ¸Ñ Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼. Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ³Ğ¾Ğ»Ğ¾Ğ´ĞµĞ½ â€” Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ĞµĞºÑƒÑ.',
        type: 'tip',
        priority: 53,
        category: 'lifestyle',
        triggers: ['tab_open'],
        ttl: 5000,
        onShow: () => { try { sessionStorage.setItem('heys_morning_breakfast_shown', '1'); } catch(e) {} }
      });
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 44: ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾Ğ±ĞµĞ´Ğµ
    if (hour === 13 && mealCount === 1) {
      advices.push({
        id: 'lunch_time',
        icon: 'ğŸ½ï¸',
        text: 'Ğ§Ğ°Ñ Ğ´Ğ½Ñ â€” Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ´Ğ»Ñ Ğ¾Ğ±ĞµĞ´Ğ°!',
        details: 'ğŸŒ ĞĞ±ĞµĞ´ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ ÑĞ°Ğ¼Ñ‹Ğ¼ Ğ¿Ğ»Ğ¾Ñ‚Ğ½Ñ‹Ğ¼ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ¾Ğ¼ Ğ´Ğ½Ñ (35-40% ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹). Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾: Ğ±ĞµĞ»Ğ¾Ğº + ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ + Ğ¾Ğ²Ğ¾Ñ‰Ğ¸.',
        type: 'tip',
        priority: 52,
        category: 'lifestyle',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 45: Ğ’Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾Ğ»Ğ´Ğ½Ğ¸ĞºĞ°
    if (hour === 16 && kcalPct < 0.6) {
      const remaining = Math.round((optimum || 2000) * (1 - kcalPct));
      advices.push({
        id: 'snack_window',
        icon: 'ğŸ¥ª',
        text: `16:00 â€” Ğ²Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾Ğ»Ğ´Ğ½Ğ¸ĞºĞ°. ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ ~${remaining} ĞºĞºĞ°Ğ»`,
        details: 'ğŸ ĞŸĞ¾Ğ»Ğ´Ğ½Ğ¸Ğº Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞµÑÑ‚ÑŒ Ğ·Ğ° ÑƒĞ¶Ğ¸Ğ½Ğ¾Ğ¼. Ğ˜Ğ´ĞµĞ¸: Ğ¾Ñ€ĞµÑ…Ğ¸, ÑĞ±Ğ»Ğ¾ĞºĞ¾, Ğ³Ñ€ĞµÑ‡ĞµÑĞºĞ¸Ğ¹ Ğ¹Ğ¾Ğ³ÑƒÑ€Ñ‚, Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³.',
        type: 'tip',
        priority: 51,
        category: 'lifestyle',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 46: Ğ‘ĞµĞ»ĞºĞ¾Ğ²Ñ‹Ğ¹ Ñ‡ĞµĞ¼Ğ¿Ğ¸Ğ¾Ğ½
    if (proteinPct >= THRESHOLDS.protein.champion && !sessionStorage.getItem('heys_protein_champion')) {
      advices.push({
        id: 'protein_champion',
        icon: 'ğŸ†',
        text: personalizeText(pickRandomText([
          'Ğ‘ĞµĞ»ĞºĞ¾Ğ²Ñ‹Ğ¹ Ñ‡ĞµĞ¼Ğ¿Ğ¸Ğ¾Ğ½! ĞœÑ‹ÑˆÑ†Ñ‹ Ñ‚ĞµĞ±Ñ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€ÑÑ‚',
          '${firstName}, Ñ‚Ñ‹ Ğ±ĞµĞ»ĞºĞ¾Ğ²Ñ‹Ğ¹ Ñ‡ĞµĞ¼Ğ¿Ğ¸Ğ¾Ğ½! ğŸ†',
          'Ğ‘ĞµĞ»ĞºĞ° Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğ¾Ñ€Ğ¼Ñ‹ â€” Ğ¼Ñ‹ÑˆÑ†Ñ‹ Ñ€Ğ°Ğ´Ñ‹!'
        ]), ctx),
        details: 'ğŸ’ª Ğ‘ĞµĞ»Ğ¾Ğº 1.5-2Ğ³/ĞºĞ³ â€” Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ Ñ€Ğ¾ÑÑ‚Ğ° Ğ¼Ñ‹ÑˆÑ† Ğ¸ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ. ĞŸĞµÑ€ĞµĞ¸Ğ·Ğ±Ñ‹Ñ‚Ğ¾Ğº Ğ±ĞµĞ»ĞºĞ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞµĞ½ Ğ´Ğ»Ñ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ñ‹Ñ… Ğ»ÑĞ´ĞµĞ¹.',
        type: 'achievement',
        priority: 10,
        category: 'achievement',
        triggers: ['tab_open', 'product_added'],
        ttl: 5000,
        excludes: ['protein_low', 'post_training_protein'],
        onShow: () => { try { sessionStorage.setItem('heys_protein_champion', '1'); } catch(e) {} }
      });
    }
    
    // Ğ¨Ğ°Ğ³Ğ¸
    const steps = day?.steps || 0;
    if (steps >= 10000) {
      advices.push({
        id: 'steps_goal',
        icon: 'ğŸš¶',
        text: `${steps.toLocaleString()} ÑˆĞ°Ğ³Ğ¾Ğ²! ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ`,
        details: 'ğŸ¯ 10 000 ÑˆĞ°Ğ³Ğ¾Ğ² ÑĞ¶Ğ¸Ğ³Ğ°ÑÑ‚ ~400-500 ĞºĞºĞ°Ğ» Ğ¸ ÑƒĞ»ÑƒÑ‡ÑˆĞ°ÑÑ‚ ÑĞµÑ€Ğ´ĞµÑ‡Ğ½Ğ¾-ÑĞ¾ÑÑƒĞ´Ğ¸ÑÑ‚ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ. Ğ­Ñ‚Ğ¾ Ñ‚Ğ²Ğ¾Ğ¹ ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ Ğ±Ğ¾Ğ½ÑƒÑ!',
        type: 'achievement',
        priority: 53,
        category: 'lifestyle',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // â„ï¸ SEASONAL TIPS (priority: 60-65) â€” Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑĞµĞ·Ğ¾Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    const month = new Date().getMonth();
    
    // ĞŸÑ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ¿Ğ¾ Ğ²ÑĞµĞ¼ ÑĞµĞ·Ğ¾Ğ½Ğ½Ñ‹Ğ¼ ÑĞ¾Ğ²ĞµÑ‚Ğ°Ğ¼
    for (const seasonal of SEASONAL_TIPS) {
      if (seasonal.months.includes(month) && !sessionStorage.getItem('heys_seasonal_' + seasonal.id)) {
        advices.push({
          id: seasonal.id,
          icon: seasonal.icon,
          text: personalizeText(pickRandomText(seasonal.texts), ctx),
          type: 'tip',
          priority: seasonal.priority,
          category: seasonal.category,
          triggers: ['tab_open'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_seasonal_' + seasonal.id, '1'); } catch(e) {} }
        });
        break; // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½ ÑĞµĞ·Ğ¾Ğ½Ğ½Ñ‹Ğ¹ ÑĞ¾Ğ²ĞµÑ‚ Ğ·Ğ° Ñ€Ğ°Ğ·
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸŒˆ VARIETY TIPS (priority: 45-50)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ Ğ°Ğ·Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ğµ Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ°
    const allItems = (day?.meals || []).flatMap(m => m.items || []);
    const productNames = allItems.map(it => {
      const product = pIndex?.byId?.get(it.product_id);
      return (product?.name || it.name || '').toLowerCase().trim();
    }).filter(Boolean);
    const uniqueProducts = new Set(productNames).size;
    
    if (productNames.length >= 5 && uniqueProducts < 3) {
      advices.push({
        id: 'variety_low',
        icon: 'ğŸŒˆ',
        text: 'Ğ Ğ°Ğ·Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·ÑŒ Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½ â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹',
        details: 'ğŸ¥— Ğ Ğ°Ğ·Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ğµ = Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ¿ĞµĞºÑ‚Ñ€ Ğ²Ğ¸Ñ‚Ğ°Ğ¼Ğ¸Ğ½Ğ¾Ğ² Ğ¸ Ğ¼Ğ¸Ğ½ĞµÑ€Ğ°Ğ»Ğ¾Ğ². Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ†Ğ²ĞµÑ‚Ğ° ĞµĞ´Ñ‹ = Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ½ÑƒÑ‚Ñ€Ğ¸ĞµĞ½Ñ‚Ñ‹. Ğ¡Ñ‚Ğ°Ñ€Ğ°Ğ¹ÑÑ 10+ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² Ğ² Ğ´ĞµĞ½ÑŒ.',
        type: 'tip',
        priority: 45,
        category: 'nutrition',
        triggers: ['product_added', 'tab_open'],
        ttl: 5000
      });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ½ï¸ PHASE 1: MEAL-LEVEL Ğ¡ĞĞ’Ğ•Ğ¢Ğ« (priority: 71-80)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¾ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ñ… Ğ¿Ğ¸Ñ‰Ğ¸
    const lastMealWithItems = getLastMealWithItems(day);
    const firstMealWithItems = getFirstMealWithItems(day);
    const lastMealTotals = lastMealWithItems ? getMealTotals(lastMealWithItems, pIndex) : null;
    
    // meal_too_large â€” Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ Ğ¿Ğ¸Ñ‰Ğ¸
    if (lastMealTotals && lastMealTotals.kcal > THRESHOLDS.meal.tooLarge && canShowMealAdvice()) {
      advices.push({
        id: 'meal_too_large',
        icon: 'ğŸ½ï¸',
        text: personalizeText(`Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ (${Math.round(lastMealTotals.kcal)} ĞºĞºĞ°Ğ»)! Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑĞ´ĞµĞ»Ğ°Ğ¹ Ğ¿Ğ¾Ğ»ĞµĞ³Ñ‡Ğµ`, ctx),
        details: 'ğŸ½ï¸ Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ñ‹ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ Ñ€ĞµĞ·ĞºĞ¸Ğ¹ ÑĞºĞ°Ñ‡Ğ¾Ğº Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½Ğ° Ğ¸ ÑĞ¾Ğ½Ğ»Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒ. Ğ›ÑƒÑ‡ÑˆĞµ 4-5 ÑÑ€ĞµĞ´Ğ½Ğ¸Ñ… Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ¾Ğ² Ğ¿Ğ¾ 300-500 ĞºĞºĞ°Ğ».',
        type: 'tip',
        priority: 71,
        category: 'nutrition',
        triggers: ['product_added'],
        excludes: ['meal_too_small'],
        ttl: 5000,
        onShow: () => markMealAdviceShown()
      });
    }
    
    // meal_too_small â€” Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼
    if (lastMealTotals && lastMealTotals.kcal < THRESHOLDS.meal.tooSmall && lastMealTotals.kcal > 0 && mealCount >= 2 && canShowMealAdvice()) {
      advices.push({
        id: 'meal_too_small',
        icon: 'ğŸ¥„',
        text: personalizeText(pickRandomText(['ĞœĞ°Ğ»Ğ¾Ğ²Ğ°Ñ‚Ğ¾ â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ ĞµÑ‰Ñ‘ Ñ‡Ñ‚Ğ¾-Ğ½Ğ¸Ğ±ÑƒĞ´ÑŒ', '${firstName}, Ğ¼Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚Ğ¾ â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ ĞµÑ‰Ñ‘']), ctx),
        details: 'ğŸ¥„ Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğµ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ñ‹ Ğ½Ğµ Ğ½Ğ°ÑÑ‹Ñ‰Ğ°ÑÑ‚ Ğ¸ Ğ²ĞµĞ´ÑƒÑ‚ Ğº Ğ¿ĞµÑ€ĞµĞºÑƒÑĞ°Ğ¼. ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 150-200 ĞºĞºĞ°Ğ» Ğ½Ğ° Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ Ğ´Ğ»Ñ ÑÑ‹Ñ‚Ğ¾ÑÑ‚Ğ¸.',
        type: 'tip',
        priority: 72,
        category: 'nutrition',
        triggers: ['product_added'],
        excludes: ['meal_too_large'],
        ttl: 5000,
        onShow: () => markMealAdviceShown()
      });
    }
    
    // protein_per_meal_low â€” Ğ¼Ğ°Ğ»Ğ¾ Ğ±ĞµĞ»ĞºĞ° Ğ² Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğµ
    if (lastMealTotals && lastMealTotals.prot < THRESHOLDS.meal.proteinMin && lastMealTotals.kcal > 200 && canShowMealAdvice()) {
      advices.push({
        id: 'protein_per_meal_low',
        icon: 'ğŸ¥š',
        text: 'ĞœĞ°Ğ»Ğ¾ Ğ±ĞµĞ»ĞºĞ° Ğ² Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğµ â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ ÑĞ¹Ñ†Ğ¾ Ğ¸Ğ»Ğ¸ Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³',
        details: 'ğŸ’ª 20-30Ğ³ Ğ±ĞµĞ»ĞºĞ° Ğ½Ğ° Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ â€” Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ ÑĞ¸Ğ½Ñ‚ĞµĞ·Ğ° Ğ¼Ñ‹ÑˆÑ†. Ğ¯Ğ¹Ñ†Ğ¾ = 6Ğ³, 100Ğ³ Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³Ğ° = 18Ğ³, ĞºÑƒÑ€Ğ¸Ğ½Ğ°Ñ Ğ³Ñ€ÑƒĞ´ĞºĞ° = 31Ğ³.',
        type: 'tip',
        priority: 73,
        category: 'nutrition',
        triggers: ['product_added'],
        ttl: 5000,
        onShow: () => markMealAdviceShown()
      });
    }
    
    // evening_carbs_high â€” Ğ¼Ğ½Ğ¾Ğ³Ğ¾ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼ (>50Ğ³ Ğ¿Ğ¾ÑĞ»Ğµ 20:00)
    if (hour >= 20 && lastMealTotals && lastMealTotals.carbs > 50 && canShowMealAdvice()) {
      advices.push({
        id: 'evening_carbs_high',
        icon: 'ğŸŒ™',
        text: `${Math.round(lastMealTotals.carbs)}Ğ³ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² Ğ½Ğ° Ğ½Ğ¾Ñ‡ÑŒ â€” ÑƒÑ‚Ñ€Ğ¾Ğ¼ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ½Ğ¾`,
        details: 'ğŸŒœ Ğ£Ğ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ²ÑĞ¿Ğ»ĞµÑĞº Ğ¸ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ ÑĞ°Ñ…Ğ°Ñ€Ğ° Ğ½Ğ¾Ñ‡ÑŒÑ. Ğ›ÑƒÑ‡ÑˆĞµ Ğ±ĞµĞ»Ğ¾Ğº + Ğ¾Ğ²Ğ¾Ñ‰Ğ¸ Ğ½Ğ° ÑƒĞ¶Ğ¸Ğ½.',
        type: 'tip',
        priority: 74,
        category: 'nutrition',
        triggers: ['product_added'],
        ttl: 5000,
        onShow: () => markMealAdviceShown()
      });
    }
    
    // fiber_per_meal_good â€” Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° Ğ² Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğµ (>8Ğ³)
    if (lastMealTotals && lastMealTotals.fiber > 8 && canShowMealAdvice()) {
      advices.push({
        id: 'fiber_per_meal_good',
        icon: 'ğŸ¥—',
        text: 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ Ñ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ¾Ğ¹! ĞĞ°Ğ´Ğ¾Ğ»Ğ³Ğ¾ Ğ½Ğ°ÑÑ‹Ñ‚Ğ¸Ñ‚',
        details: 'ğŸ¥¦ 8+ Ğ³Ñ€Ğ°Ğ¼Ğ¼ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ¸ Ğ² Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğµ â€” ÑÑ‚Ğ¾ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! ĞšĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° Ğ·Ğ°Ğ¼ĞµĞ´Ğ»ÑĞµÑ‚ ÑƒÑĞ²Ğ¾ĞµĞ½Ğ¸Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² Ğ¸ Ğ´Ğ¾Ğ»ÑŒÑˆĞµ Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ ÑÑ‹Ñ‚Ñ‹Ğ¼.',
        type: 'achievement',
        priority: 75,
        category: 'nutrition',
        triggers: ['product_added'],
        ttl: 4000,
        onShow: () => markMealAdviceShown()
      });
    }
    
    // variety_meal_good â€” Ñ€Ğ°Ğ·Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ (>=4 Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°)
    if (lastMealWithItems && lastMealWithItems.items?.length >= 4 && canShowMealAdvice()) {
      advices.push({
        id: 'variety_meal_good',
        icon: 'ğŸŒˆ',
        text: 'Ğ Ğ°Ğ·Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ â€” Ñ‚Ğ°Ğº Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ!',
        details: 'ğŸŒŸ Ğ Ğ°Ğ·Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ğµ = Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¼Ğ¸ĞºÑ€Ğ¾Ğ½ÑƒÑ‚Ñ€Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ². Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ†Ğ²ĞµÑ‚Ğ° ĞµĞ´Ñ‹ = Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ²Ğ¸Ñ‚Ğ°Ğ¼Ğ¸Ğ½Ñ‹ Ğ¸ Ğ°Ğ½Ñ‚Ğ¸Ğ¾ĞºÑĞ¸Ğ´Ğ°Ğ½Ñ‚Ñ‹.',
        type: 'achievement',
        priority: 76,
        category: 'nutrition',
        triggers: ['product_added'],
        ttl: 4000,
        onShow: () => markMealAdviceShown()
      });
    }
    
    // late_first_meal â€” Ğ¿Ğ¾Ğ·Ğ´Ğ½Ğ¸Ğ¹ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ (Ğ¿Ğ¾ÑĞ»Ğµ 12:00)
    if (firstMealWithItems && hour >= 13) {
      const [fmHour] = (firstMealWithItems.time || '12:00').split(':').map(Number);
      if (fmHour >= 12) {
        advices.push({
          id: 'late_first_meal',
          icon: 'â°',
          text: 'ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ Ğ¿Ğ¾Ğ·Ğ´Ğ½Ğ¾Ğ²Ğ°Ñ‚Ğ¾ â€” Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ° Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ñ€Ğ°Ğ½ÑŒÑˆĞµ',
          details: 'â˜• ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ Ğ´Ğ¾ 12:00 Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼ Ğ¸ Ğ´Ğ°Ñ‘Ñ‚ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ. ĞŸĞ¾Ğ·Ğ´Ğ½Ğ¸Ğ¹ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº = Ğ¿Ğ¾Ğ·Ğ´Ğ½Ğ¸Ğ¹ ÑƒĞ¶Ğ¸Ğ½.',
          type: 'tip',
          priority: 77,
          category: 'timing',
          triggers: ['tab_open'],
          ttl: 5000
        });
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ“Š PHASE 2: DAY-QUALITY Ğ¡ĞĞ’Ğ•Ğ¢Ğ« (priority: 81-90)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // trans_free_day â€” Ğ´ĞµĞ½ÑŒ Ğ±ĞµĞ· Ñ‚Ñ€Ğ°Ğ½Ñ-Ğ¶Ğ¸Ñ€Ğ¾Ğ²
    if ((dayTot?.trans || 0) === 0 && mealCount >= 2) {
      advices.push({
        id: 'trans_free_day',
        icon: 'ğŸ‰',
        text: 'Ğ”ĞµĞ½ÑŒ Ğ±ĞµĞ· Ñ‚Ñ€Ğ°Ğ½Ñ-Ğ¶Ğ¸Ñ€Ğ¾Ğ²!',
        details: 'ğŸ’š Ğ¢Ñ€Ğ°Ğ½Ñ-Ğ¶Ğ¸Ñ€Ñ‹ â€” ÑĞ°Ğ¼Ñ‹Ğµ Ğ²Ñ€ĞµĞ´Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ ÑĞµÑ€Ğ´Ñ†Ğ°. ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾, Ñ‡Ñ‚Ğ¾ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ±ĞµĞ· Ğ½Ğ¸Ñ…!',
        type: 'achievement',
        priority: 81,
        category: 'nutrition',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // sugar_low_day â€” Ğ¿Ğ¾Ñ‡Ñ‚Ğ¸ Ğ±ĞµĞ· ÑĞ°Ñ…Ğ°Ñ€Ğ° (<25Ğ³ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… Ğ¿Ñ€Ğ¸ >=2 Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ñ…)
    if ((dayTot?.simple || 0) < 25 && (dayTot?.simple || 0) > 0 && mealCount >= 2) {
      advices.push({
        id: 'sugar_low_day',
        icon: 'ğŸ¬',
        text: 'ĞŸĞ¾Ñ‡Ñ‚Ğ¸ Ğ±ĞµĞ· ÑĞ°Ñ…Ğ°Ñ€Ğ° â€” Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! ğŸš«',
        details: 'ğŸ† ĞœĞµĞ½ĞµĞµ 25Ğ³ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² â€” ÑÑ‚Ğ¾ ĞºÑ€ÑƒÑ‚Ğ¾! ĞĞ¾Ñ€Ğ¼Ğ° Ğ’ĞĞ—: Ğ¼Ğ°ĞºÑ 50Ğ³ ÑĞ°Ñ…Ğ°Ñ€Ğ° Ğ² Ğ´ĞµĞ½ÑŒ, Ğ¸Ğ´ĞµĞ°Ğ» â€” Ğ´Ğ¾ 25Ğ³.',
        type: 'achievement',
        priority: 82,
        category: 'nutrition',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // super_hydration â€” Ğ³Ğ¸Ğ´Ñ€Ğ°Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼Ğµ (>=2500Ğ¼Ğ»)
    const waterMlP2 = day?.waterMl || 0;
    if (waterMlP2 >= 2500) {
      advices.push({
        id: 'super_hydration',
        icon: 'ğŸ’§',
        text: `${waterMlP2}Ğ¼Ğ» Ğ²Ğ¾Ğ´Ñ‹ â€” Ğ³Ğ¸Ğ´Ñ€Ğ°Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼Ğµ! ğŸ’§ğŸ’§ğŸ’§`,
        details: 'ğŸ’¦ 2.5+ Ğ»Ğ¸Ñ‚Ñ€Ğ° Ğ²Ğ¾Ğ´Ñ‹ ÑƒĞ»ÑƒÑ‡ÑˆĞ°ĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼, ĞºĞ¾Ğ¶Ñƒ Ğ¸ ĞºĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ñ†Ğ¸Ñ. Ğ¢Ñ‹ Ğ² Ñ‚Ğ¾Ğ¿-10% Ğ¿Ğ¾ Ğ³Ğ¸Ğ´Ñ€Ğ°Ñ‚Ğ°Ñ†Ğ¸Ğ¸!',
        type: 'achievement',
        priority: 83,
        category: 'hydration',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // variety_day_good â€” 10+ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ²
    const uniqueProductCount = countUniqueProducts(day);
    if (uniqueProductCount >= 10) {
      advices.push({
        id: 'variety_day_good',
        icon: 'ğŸŒˆ',
        text: `${uniqueProductCount} Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² â€” Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ¸Ğµ!`,
        details: 'ğŸ¥— 10+ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² = Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ¿ĞµĞºÑ‚Ñ€ Ğ²Ğ¸Ñ‚Ğ°Ğ¼Ğ¸Ğ½Ğ¾Ğ², Ğ¼Ğ¸Ğ½ĞµÑ€Ğ°Ğ»Ğ¾Ğ² Ğ¸ Ğ°Ğ½Ñ‚Ğ¸Ğ¾ĞºÑĞ¸Ğ´Ğ°Ğ½Ñ‚Ğ¾Ğ². Ğ¢Ğ°Ğº Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ!',
        type: 'achievement',
        priority: 84,
        category: 'nutrition',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // goal_on_track â€” Ñ†ĞµĞ»ÑŒ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ (Goal-aware: Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ´Ğ»Ñ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğ°, Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ°, Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ñ)
    // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ĞµÑĞ»Ğ¸ Ğ² Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ¼ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğµ Ğ¸ ÑƒĞ¶Ğµ Ğº ÑĞµÑ€ĞµĞ´Ğ¸Ğ½Ğµ Ğ´Ğ½Ñ
    if (isInTargetRange(kcalPct, goal) && hour >= 12 && mealCount >= 2) {
      advices.push({
        id: 'goal_on_track',
        icon: goal.emoji,
        text: goal.mode === 'bulk'
          ? 'ĞĞ°Ğ±Ğ¾Ñ€ Ğ¸Ğ´Ñ‘Ñ‚ Ğ¿Ğ¾ Ğ¿Ğ»Ğ°Ğ½Ñƒ! ğŸ’ª'
          : goal.mode === 'deficit'
            ? 'Ğ”ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ Ğ²Ñ‹Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ! ğŸ”¥'
            : 'ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ! âš–ï¸',
        details: 'ğŸ† ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ â€” ĞºĞ»ÑÑ‡ Ğº Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñƒ. ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² Ğ¿Ğ»Ğ°Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ±Ğ»Ğ¸Ğ¶Ğ°ĞµÑ‚ Ñ‚ĞµĞ±Ñ Ğº Ñ†ĞµĞ»Ğ¸!',
        type: 'achievement',
        priority: 85,
        category: 'nutrition',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // weekend_relax â€” Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ñ€Ğ°ÑÑĞ»Ğ°Ğ±Ğ»ĞµĞ½Ğ¸Ğµ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚Ğ°/Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ñ, Ğ¿Ñ€Ğ¸ Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¼ Ğ¿ĞµÑ€ĞµĞ±Ğ¾Ñ€Ğµ)
    const dayOfWeek = new Date().getDay();
    const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
    if (isWeekend && kcalPct > goal.targetRange.max && !isCriticallyOver(kcalPct, goal) && goal.mode !== 'bulk') {
      advices.push({
        id: 'weekend_relax',
        icon: 'ğŸ›‹ï¸',
        text: 'Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ€Ğ°ÑÑĞ»Ğ°Ğ±Ğ»ÑĞµÑˆÑŒÑÑ â€” ÑÑ‚Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾',
        details: 'ğŸ‰ Ğ›Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ĞµĞ±Ğ¾Ñ€ Ğ² Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ½Ñ‹Ğµ â€” ÑÑ‚Ğ¾ ĞĞš! Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ â€” ÑÑ€ĞµĞ´Ğ½ÑÑ Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ. ĞĞ°ÑĞ»Ğ°Ğ¶Ğ´Ğ°Ğ¹ÑÑ Ğ±ĞµĞ· Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ° Ğ²Ğ¸Ğ½Ñ‹.',
        type: 'tip',
        priority: 86,
        category: 'lifestyle',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â±ï¸ PHASE 3: TIMING & PATTERNS (priority: 91-100)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ²
    const mealsWithItemsP3 = (day?.meals || []).filter(m => m.items?.length > 0);
    const mealTimes = mealsWithItemsP3.map(m => {
      const [h, min] = (m.time || '12:00').split(':').map(Number);
      return h * 60 + min;
    }).sort((a, b) => a - b);
    
    // fasting_window_good â€” 14+ Ñ‡Ğ°ÑĞ¾Ğ² Ğ±ĞµĞ· ĞµĞ´Ñ‹ (ÑƒĞ¶Ğ¸Ğ½â†’Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº)
    if (firstMealWithItems && hour >= 10) {
      const yesterdayDays = getRecentDays(1);
      const yesterdayDay = yesterdayDays[0];
      const yesterdayLastMeal = getLastMealWithItems(yesterdayDay);
      
      if (yesterdayLastMeal) {
        const [lastH] = (yesterdayLastMeal.time || '20:00').split(':').map(Number);
        const [firstH] = (firstMealWithItems.time || '08:00').split(':').map(Number);
        const fastingWindow = (24 - lastH) + firstH;
        
        if (fastingWindow >= 14 && !sessionStorage.getItem('heys_fasting_good')) {
          advices.push({
            id: 'fasting_window_good',
            icon: 'ğŸ•',
            text: `${fastingWindow}+ Ñ‡Ğ°ÑĞ¾Ğ² Ğ±ĞµĞ· ĞµĞ´Ñ‹ â€” Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾!`,
            details: 'â° 14+ Ñ‡Ğ°ÑĞ¾Ğ² Ğ½Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ°Ğ½Ğ¸Ñ = Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ°Ğ½Ğ¸Ğµ. Ğ­Ñ‚Ğ¾ ÑƒÑĞºĞ¾Ñ€ÑĞµÑ‚ Ğ°ÑƒÑ‚Ğ¾Ñ„Ğ°Ğ³Ğ¸Ñ Ğ¸ Ğ¶Ğ¸Ñ€Ğ¾ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ğµ.',
            type: 'achievement',
            priority: 91,
            category: 'timing',
            triggers: ['tab_open'],
            ttl: 5000,
            onShow: () => { try { sessionStorage.setItem('heys_fasting_good', '1'); } catch(e) {} }
          });
        }
      }
    }
    
    // long_fast_warning â€” Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ Ğ¿ĞµÑ€ĞµÑ€Ñ‹Ğ² Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ğ¼Ğ¸ (>7Ñ‡ Ğ´Ğ½Ñ‘Ğ¼)
    // ĞŸĞµÑ€ĞµĞ¾ÑĞ¼Ñ‹ÑĞ»ĞµĞ½Ğ¾: Ğ´Ğ¾Ğ»Ğ³Ğ¸Ğ¹ Ğ¿ĞµÑ€ĞµÑ€Ñ‹Ğ² = Ğ´Ğ¾Ğ»Ğ³Ğ¸Ğ¹ Ğ»Ğ¸Ğ¿Ğ¾Ğ»Ğ¸Ğ· = Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾ Ğ´Ğ»Ñ Ğ¶Ğ¸Ñ€Ğ¾ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ñ!
    if (mealTimes.length >= 1 && hour >= 10 && hour <= 18) {
      const lastMealMinutes = mealTimes[mealTimes.length - 1];
      const nowMinutes = hour * 60 + new Date().getMinutes();
      const gapHours = (nowMinutes - lastMealMinutes) / 60;
      
      if (gapHours > 5 && gapHours <= 7) {
        // 5-7 Ñ‡Ğ°ÑĞ¾Ğ² â€” Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ»Ğ¸Ğ¿Ğ¾Ğ»Ğ¸Ğ·!
        advices.push({
          id: 'lipolysis_going_strong',
          icon: 'ğŸ”¥',
          text: `${Math.round(gapHours)}Ñ‡ Ğ±ĞµĞ· ĞµĞ´Ñ‹ â€” Ğ»Ğ¸Ğ¿Ğ¾Ğ»Ğ¸Ğ· Ğ² Ñ€Ğ°Ğ·Ğ³Ğ°Ñ€Ğµ! Ğ”ĞµÑ€Ğ¶Ğ¸ÑÑŒ!`,
          details: 'ğŸ”¥ ĞŸĞ¾ÑĞ»Ğµ 4-5 Ñ‡Ğ°ÑĞ¾Ğ² Ğ±ĞµĞ· ĞµĞ´Ñ‹ Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½ Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚ Ğ¸ Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ Ğ¶Ğ¸Ñ€Ğ¾ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ğµ. Ğ¢Ñ‹ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ»Ğ¸Ğ¿Ğ¾Ğ»Ğ¸Ğ·Ğ°!',
          type: 'achievement',
          priority: 92,
          category: 'timing',
          triggers: ['tab_open'],
          ttl: 5000
        });
      } else if (gapHours > 7) {
        // >7 Ñ‡Ğ°ÑĞ¾Ğ² â€” Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¾ Ğ¿ĞµÑ€ĞµĞµĞ´Ğ°Ğ½Ğ¸Ğ¸ Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼
        advices.push({
          id: 'long_fast_warning',
          icon: 'âš ï¸',
          text: `${Math.round(gapHours)}Ñ‡ Ğ±ĞµĞ· ĞµĞ´Ñ‹ â€” ĞºĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾ĞµÑˆÑŒ, Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°Ğ¹ Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹ Ğ“Ğ˜!`,
          details: 'ğŸ¥— ĞŸĞ¾ÑĞ»Ğµ Ğ´Ğ¾Ğ»Ğ³Ğ¾Ğ³Ğ¾ Ğ¿ĞµÑ€ĞµÑ€Ñ‹Ğ²Ğ° Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ĞµĞ½ Ğº ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ°Ğ¼. ĞĞ°Ñ‡Ğ½Ğ¸ Ñ Ğ±ĞµĞ»ĞºĞ° + Ğ¾Ğ²Ğ¾Ñ‰Ğ¸, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹.',
          type: 'tip',
          priority: 92,
          category: 'timing',
          triggers: ['tab_open'],
          ttl: 5000
        });
      }
    }
    
    // meal_spacing_perfect â€” Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»Ñ‹ (3-5Ñ‡ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ğ¼Ğ¸, >=3 Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°)
    // = ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ² Ğ»Ğ¸Ğ¿Ğ¾Ğ»Ğ¸Ğ·Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ğ¼Ğ¸
    if (mealTimes.length >= 3) {
      const gaps = [];
      for (let i = 1; i < mealTimes.length; i++) {
        gaps.push((mealTimes[i] - mealTimes[i-1]) / 60);
      }
      const allGapsGood = gaps.every(g => g >= 3 && g <= 5);
      
      if (allGapsGood && !sessionStorage.getItem('heys_spacing_perfect')) {
        advices.push({
          id: 'meal_spacing_perfect',
          icon: 'ğŸ”¥',
          text: 'Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»Ñ‹! ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ² Ğ»Ğ¸Ğ¿Ğ¾Ğ»Ğ¸Ğ·Ğµ',
          details: 'â±ï¸ Ğ˜Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»Ñ‹ 3-5 Ñ‡Ğ°ÑĞ¾Ğ² = Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ¶Ğ¸Ñ€Ğ¾ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ğ¼Ğ¸. Ğ˜Ğ½ÑÑƒĞ»Ğ¸Ğ½ ÑƒÑĞ¿ĞµĞ²Ğ°ĞµÑ‚ ÑĞ½Ğ¸Ğ·Ğ¸Ñ‚ÑŒÑÑ, Ğ¸ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ğµ Ğ¶Ğ¸Ñ€Ğ°.',
          type: 'achievement',
          priority: 93,
          category: 'timing',
          triggers: ['tab_open'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_spacing_perfect', '1'); } catch(e) {} }
        });
      }
      
      // Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ñ‹ = Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½ = Ğ½ĞµÑ‚ Ğ»Ğ¸Ğ¿Ğ¾Ğ»Ğ¸Ğ·Ğ°
      const shortGaps = gaps.filter(g => g < 2);
      if (shortGaps.length >= 2) {
        advices.push({
          id: 'frequent_eating_no_lipolysis',
          icon: 'ğŸ“ˆ',
          text: 'Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ñ‹ â€” Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½ Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹, Ğ»Ğ¸Ğ¿Ğ¾Ğ»Ğ¸Ğ·Ğ° Ğ½ĞµÑ‚',
          details: 'ğŸ“Š ĞŸĞµÑ€ĞµÑ€Ñ‹Ğ²Ñ‹ < 2 Ñ‡Ğ°ÑĞ¾Ğ² Ğ¼ĞµĞ¶Ğ´Ñƒ ĞµĞ´Ğ¾Ğ¹ = Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½. Ğ–Ğ¸Ñ€Ğ¾ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ğµ Ğ½Ğµ Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ. Ğ”ĞµĞ»Ğ°Ğ¹ Ğ¿Ğ°ÑƒĞ·Ñ‹ 3-5 Ñ‡Ğ°ÑĞ¾Ğ².',
          type: 'warning',
          priority: 45,
          category: 'timing',
          triggers: ['meal_added'],
          ttl: 6000
        });
      }
    }
    
    // training_recovery_window â€” Ğ¾ĞºĞ½Ğ¾ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ (30-60 Ğ¼Ğ¸Ğ½ Ğ¿Ğ¾ÑĞ»Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸)
    const trainingsP3 = day?.trainings || [];
    const todayTrainingP3 = trainingsP3.find(t => t.z && t.z.some(m => m > 0));
    if (todayTrainingP3 && todayTrainingP3.time) {
      const [trainH, trainM] = todayTrainingP3.time.split(':').map(Number);
      const trainMinutes = trainH * 60 + trainM;
      const nowMinutes = hour * 60 + new Date().getMinutes();
      const minutesSince = nowMinutes - trainMinutes;
      
      if (minutesSince >= 30 && minutesSince <= 60 && proteinPct < 0.8) {
        advices.push({
          id: 'training_recovery_window',
          icon: 'ğŸ‹ï¸',
          text: 'ĞĞºĞ½Ğ¾ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ â€” Ğ±ĞµĞ»Ğ¾Ğº ÑĞµĞ¹Ñ‡Ğ°Ñ ÑƒÑĞ²Ğ¾Ğ¸Ñ‚ÑÑ Ğ»ÑƒÑ‡ÑˆĞµ!',
          details: 'ğŸ’ª 30-60 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¿Ğ¾ÑĞ»Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ â€” Ğ°Ğ½Ğ°Ğ±Ğ¾Ğ»Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾ĞºĞ½Ğ¾. Ğ‘ĞµĞ»Ğ¾Ğº ÑƒÑĞ²Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° 25% ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½ĞµĞµ. Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾: 20-30Ğ³ Ğ±ĞµĞ»ĞºĞ°.',
          type: 'tip',
          priority: 94,
          category: 'training',
          triggers: ['tab_open'],
          ttl: 5000
        });
      }
    }
    
    // sleep_debt_accumulating â€” Ğ½Ğ°ĞºĞ¾Ğ¿Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ½ĞµĞ´Ğ¾ÑÑ‹Ğ¿ (3 Ğ´Ğ½Ñ < 6 Ñ‡Ğ°ÑĞ¾Ğ²)
    const recentDaysForSleep = getRecentDays(3);
    const sleepHoursRecent = recentDaysForSleep.map(d => calculateSleepHours(d)).filter(h => h > 0);
    if (sleepHoursRecent.length >= 3) {
      const allUnder6 = sleepHoursRecent.every(h => h < 6);
      if (allUnder6 && !sessionStorage.getItem('heys_sleep_debt')) {
        advices.push({
          id: 'sleep_debt_accumulating',
          icon: 'ğŸ˜´',
          text: 'ĞĞ°ĞºĞ¾Ğ¿Ğ¸Ğ»ÑÑ Ğ½ĞµĞ´Ğ¾ÑÑ‹Ğ¿ â€” ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ»ÑĞ³ Ğ¿Ğ¾Ñ€Ğ°Ğ½ÑŒÑˆĞµ!',
          details: 'âš ï¸ 3+ Ğ´Ğ½Ñ Ğ½ĞµĞ´Ğ¾ÑÑ‹Ğ¿Ğ° = Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ğµ Ğ³Ğ¾Ñ€Ğ¼Ğ¾Ğ½Ğ¾Ğ². Ğ“Ñ€ĞµĞ»Ğ¸Ğ½ (Ğ³Ğ¾Ğ»Ğ¾Ğ´) Ñ€Ğ°ÑÑ‚Ñ‘Ñ‚, Ğ»ĞµĞ¿Ñ‚Ğ¸Ğ½ (ÑÑ‹Ñ‚Ğ¾ÑÑ‚ÑŒ) Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚.',
          type: 'warning',
          priority: 95,
          category: 'lifestyle',
          triggers: ['tab_open'],
          ttl: 6000,
          onShow: () => { try { sessionStorage.setItem('heys_sleep_debt', '1'); } catch(e) {} }
        });
      }
    }
    
    // stress_eating_detected â€” ÑÑ‚Ñ€ĞµÑÑ + Ğ¿ĞµÑ€ĞµĞµĞ´Ğ°Ğ½Ğ¸Ğµ
    const avgStressForPattern = calculateAverageStress(day);
    if (avgStressForPattern >= 4 && kcalPct > 1.15) {
      advices.push({
        id: 'stress_eating_detected',
        icon: 'ğŸš¶',
        text: 'Ğ¡Ñ‚Ñ€ĞµÑÑ â†’ Ğ¿ĞµÑ€ĞµĞºÑƒÑ? ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ğ¿Ñ€Ğ¾Ğ³ÑƒĞ»ĞºÑƒ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ĞµĞ´Ñ‹',
        details: 'ğŸ§  Ğ¡Ñ‚Ñ€ĞµÑÑĞ¾Ğ²Ğ¾Ğµ Ğ¿ĞµÑ€ĞµĞµĞ´Ğ°Ğ½Ğ¸Ğµ â€” ÑÑ‚Ğ¾ ĞºĞ¾Ñ€Ñ‚Ğ¸Ğ·Ğ¾Ğ». 10-Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ³ÑƒĞ»ĞºĞ° ÑĞ½Ğ¸Ğ¶Ğ°ĞµÑ‚ ĞµĞ³Ğ¾ Ğ»ÑƒÑ‡ÑˆĞµ, Ñ‡ĞµĞ¼ ĞµĞ´Ğ°.',
        type: 'tip',
        priority: 96,
        category: 'emotional',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ† PHASE 4: TRENDS & MILESTONES (priority: 1-10)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // weight_trend_down/up â€” Ñ‚Ñ€ĞµĞ½Ğ´ Ğ²ĞµÑĞ° Ğ·Ğ° 7 Ğ´Ğ½ĞµĞ¹
    const recentDaysForWeight = getRecentDays(7);
    const weightsForTrend = recentDaysForWeight.map(d => d.weightMorning).filter(w => w > 0);
    
    if (weightsForTrend.length >= 3) {
      // Ğ£Ğ¿Ñ€Ğ¾Ñ‰Ñ‘Ğ½Ğ½Ñ‹Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ´: ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¿ĞµÑ€Ğ²Ñ‹Ñ… 3 vs ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… 3
      const firstAvg = weightsForTrend.slice(0, 3).reduce((a, b) => a + b, 0) / 3;
      const lastAvg = weightsForTrend.slice(-3).reduce((a, b) => a + b, 0) / 3;
      const trendPerWeek = ((lastAvg - firstAvg) / weightsForTrend.length) * 7;
      
      if (trendPerWeek < -0.3 && !sessionStorage.getItem('heys_weight_trend_down')) {
        advices.push({
          id: 'weight_trend_down',
          icon: 'ğŸ“‰',
          text: 'Ğ’ĞµÑ ÑƒÑ…Ğ¾Ğ´Ğ¸Ñ‚! Ğ¢Ğ°Ğº Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ',
          details: 'ğŸ† Ğ¢Ñ€ĞµĞ½Ğ´ Ğ²Ğ½Ğ¸Ğ· = Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚! 0.5-1 ĞºĞ³/Ğ½ĞµĞ´ĞµĞ»Ñ â€” Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚ĞµĞ¼Ğ¿ Ğ¿Ğ¾Ñ…ÑƒĞ´ĞµĞ½Ğ¸Ñ.',
          type: 'achievement',
          priority: 6,
          category: 'weight',
          triggers: ['tab_open'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_weight_trend_down', '1'); } catch(e) {} }
        });
      }
      
      if (trendPerWeek > 0.5 && !sessionStorage.getItem('heys_weight_trend_up')) {
        advices.push({
          id: 'weight_trend_up',
          icon: 'ğŸ“ˆ',
          text: 'Ğ’ĞµÑ Ñ€Ğ°ÑÑ‚Ñ‘Ñ‚ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸',
          details: 'âš ï¸ >0.5 ĞºĞ³/Ğ½ĞµĞ´ĞµĞ»Ñ = ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ ĞºĞ°Ğ»Ğ¾Ñ€Ğ°Ğ¶ Ğ¸ ÑĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞºÑƒÑÑ‹.',
          type: 'warning',
          priority: 7,
          category: 'weight',
          triggers: ['tab_open'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_weight_trend_up', '1'); } catch(e) {} }
        });
      }
    }
    
    // milestone_7_days â€” Ğ½ĞµĞ´ĞµĞ»Ñ Ñ HEYS
    const totalDays = getTotalDaysTracked();
    if (totalDays === 7 && !isMilestoneShown('7_days')) {
      advices.push({
        id: 'milestone_7_days',
        icon: 'ğŸ“…',
        text: 'ĞĞµĞ´ĞµĞ»Ñ Ñ HEYS! ĞŸÑ€Ğ¸Ğ²Ñ‹Ñ‡ĞºĞ° Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ',
        details: 'ğŸ’¡ 7 Ğ´Ğ½ĞµĞ¹ â€” Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€ÑƒĞ±ĞµĞ¶! Ğ˜ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚: 21 Ğ´ĞµĞ½ÑŒ â€” Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºĞ°, 66 Ğ´Ğ½ĞµĞ¹ â€” Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¼.',
        type: 'achievement',
        priority: 2,
        category: 'achievement',
        triggers: ['tab_open'],
        ttl: 8000,
        showConfetti: true,
        onShow: () => markMilestoneShown('7_days')
      });
    }
    
    // milestone_30_days â€” Ğ¼ĞµÑÑÑ† Ñ HEYS
    if (totalDays === 30 && !isMilestoneShown('30_days')) {
      const firstName = prof?.firstName || '';
      advices.push({
        id: 'milestone_30_days',
        icon: 'ğŸ‰',
        text: firstName ? `ĞœĞµÑÑÑ† Ñ HEYS, ${firstName}! Ğ¢Ñ‹ Ğ¼Ğ¾Ğ»Ğ¾Ğ´ĞµÑ†` : 'ĞœĞµÑÑÑ† Ñ HEYS! Ğ¢Ñ‹ Ğ¼Ğ¾Ğ»Ğ¾Ğ´ĞµÑ†',
        details: 'ğŸ† 30 Ğ´Ğ½ĞµĞ¹ = Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºĞ° ÑÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°! Ğ¢Ñ€ĞµĞºĞ¸Ğ½Ğ³ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ğ°Ğ» Ñ‡Ğ°ÑÑ‚ÑŒÑ Ñ‚Ğ²Ğ¾ĞµĞ¹ Ğ¶Ğ¸Ğ·Ğ½Ğ¸.',
        type: 'achievement',
        priority: 1,
        category: 'achievement',
        triggers: ['tab_open'],
        ttl: 10000,
        showConfetti: true,
        onShow: () => markMilestoneShown('30_days')
      });
    }
    
    // milestone_100_days â€” 100 Ğ´Ğ½ĞµĞ¹ Ñ HEYS
    if (totalDays === 100 && !isMilestoneShown('100_days')) {
      advices.push({
        id: 'milestone_100_days',
        icon: 'ğŸ†',
        text: '100 Ğ´Ğ½ĞµĞ¹! Ğ¢Ñ‹ Ğ»ĞµĞ³ĞµĞ½Ğ´Ğ°',
        details: 'ğŸŒŸ 100 Ğ´Ğ½ĞµĞ¹ Ñ‚Ñ€ĞµĞºĞ¸Ğ½Ğ³Ğ° â€” ÑÑ‚Ğ¾ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¼Ğ°ÑÑ‚ĞµÑ€Ğ°! Ğ¢Ñ‹ Ğ² Ñ‚Ğ¾Ğ¿-1% Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹.',
        type: 'achievement',
        priority: 1,
        category: 'achievement',
        triggers: ['tab_open'],
        ttl: 12000,
        showConfetti: true,
        onShow: () => markMilestoneShown('100_days')
      });
    }
    
    // new_record_streak â€” Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´ streak
    if (currentStreak > 0) {
      const isNewRecord = updatePersonalBestStreak(currentStreak);
      if (isNewRecord && currentStreak >= 3 && !sessionStorage.getItem('heys_new_record')) {
        advices.push({
          id: 'new_record_streak',
          icon: 'ğŸ”¥',
          text: `Ğ ĞµĞºĞ¾Ñ€Ğ´Ğ½Ñ‹Ğ¹ streak â€” ${currentStreak} Ğ´Ğ½ĞµĞ¹! ğŸ”¥ğŸ”¥ğŸ”¥`,
          details: 'ğŸ… ĞĞ¾Ğ²Ñ‹Ğ¹ Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´! ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ streak ÑƒĞºÑ€ĞµĞ¿Ğ»ÑĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºÑƒ. ĞĞµ ÑĞ»Ğ¾Ğ¼Ğ°Ğ¹ ÑĞµÑ€Ğ¸Ñ!',
          type: 'achievement',
          priority: 2,
          category: 'achievement',
          triggers: ['tab_open'],
          ttl: 8000,
          showConfetti: true,
          onShow: () => { try { sessionStorage.setItem('heys_new_record', '1'); } catch(e) {} }
        });
      }
    }
    
    // first_training_ever â€” Ğ¿ĞµÑ€Ğ²Ğ°Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ² Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸
    if (hasTraining && !isMilestoneShown('first_training')) {
      // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¿ĞµÑ€Ğ²Ğ°Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°
      const historyDays = getRecentDays(30);
      const hasHistoryTraining = historyDays.some(d => 
        d.trainings?.some(t => t.z && t.z.some(m => m > 0))
      );
      
      if (!hasHistoryTraining) {
        advices.push({
          id: 'first_training_ever',
          icon: 'ğŸƒ',
          text: 'ĞŸĞµÑ€Ğ²Ğ°Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ² HEYS! ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¾',
          details: 'ğŸ¯ ĞŸĞµÑ€Ğ²Ğ°Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° â€” ÑĞ°Ğ¼Ğ°Ñ Ñ‚ÑĞ¶Ñ‘Ğ»Ğ°Ñ! Ğ¢ĞµĞ¿ĞµÑ€ÑŒ HEYS Ğ±ÑƒĞ´ĞµÑ‚ ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ²Ğ¾Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ² Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ°Ñ….',
          type: 'achievement',
          priority: 3,
          category: 'achievement',
          triggers: ['tab_open'],
          ttl: 8000,
          showConfetti: true,
          onShow: () => markMilestoneShown('first_training')
        });
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ¥œ TIMING TIPS (priority: 55-59)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // ĞŸĞ¾ÑĞ»Ğµ ÑĞ»Ğ°Ğ´ĞºĞ¾Ğ³Ğ¾ Ğ½ÑƒĞ¶ĞµĞ½ Ğ±ĞµĞ»Ğ¾Ğº
    const lastMeal = (day?.meals || []).slice(-1)[0];
    if (lastMeal && lastMeal.items?.length > 0) {
      let lastMealSimple = 0, lastMealCarbs = 0, lastMealKcal = 0;
      for (const item of lastMeal.items) {
        const product = pIndex?.byId?.get(item.product_id);
        if (!product) continue;
        const grams = item.grams || 100;
        lastMealSimple += (product.simple100 || 0) * grams / 100;
        lastMealCarbs += ((product.simple100 || 0) + (product.complex100 || 0)) * grams / 100;
        lastMealKcal += (product.kcal100 || 0) * grams / 100;
      }
      const lastMealSimplePct = lastMealCarbs > 0 ? (lastMealSimple / lastMealCarbs) : 0;
      
      if (lastMealSimplePct > 0.6 && lastMealKcal > 100) {
        advices.push({
          id: 'after_sweet_protein',
          icon: 'ğŸ¥œ',
          text: 'ĞŸĞ¾ÑĞ»Ğµ ÑĞ»Ğ°Ğ´ĞºĞ¾Ğ³Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ±ĞµĞ»Ğ¾Ğº â€” Ğ¾Ñ€ĞµÑ…Ğ¸ Ğ¸Ğ»Ğ¸ Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³',
          details: 'âš–ï¸ Ğ‘ĞµĞ»Ğ¾Ğº Ğ·Ğ°Ğ¼ĞµĞ´Ğ»ÑĞµÑ‚ ÑƒÑĞ²Ğ¾ĞµĞ½Ğ¸Ğµ ÑĞ°Ñ…Ğ°Ñ€Ğ° Ğ¸ ÑĞ¼ÑĞ³Ñ‡Ğ°ĞµÑ‚ Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑĞºĞ°Ñ‡Ğ¾Ğº. Ğ“Ğ¾Ñ€ÑÑ‚ÑŒ Ğ¾Ñ€ĞµÑ…Ğ¾Ğ² Ğ¸Ğ»Ğ¸ Ğ»Ğ¾Ğ¶ĞºĞ° Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³Ğ° ÑĞ¿Ğ°ÑÑƒÑ‚ ÑĞ¸Ñ‚ÑƒĞ°Ñ†Ğ¸Ñ.',
          type: 'tip',
          priority: 55,
          category: 'nutrition',
          triggers: ['product_added'],
          ttl: 5000
        });
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ§  CORRELATION INSIGHTS (priority: 20-30)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 10: Ğ¡Ğ²ÑĞ·ÑŒ ÑĞ½Ğ° Ğ¸ Ğ¿ĞµÑ€ĞµĞµĞ´Ğ°Ğ½Ğ¸Ñ
    const sleepHoursCorr = calculateSleepHours(day);
    const sleepNorm = prof?.sleepHours || 8;
    const sleepDeficit = sleepNorm - sleepHoursCorr;
    
    // ĞĞµĞ´Ğ¾ÑÑ‹Ğ¿ + Ğ¿ĞµÑ€ĞµĞµĞ´Ğ°Ğ½Ğ¸Ğµ = Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ñ‚ÑŒ ÑĞ²ÑĞ·ÑŒ
    if (sleepDeficit > 2 && kcalPct > 1.15) {
      advices.push({
        id: 'sleep_hunger_correlation',
        icon: 'ğŸ§ ',
        text: `ĞĞµĞ´Ğ¾ÑÑ‹Ğ¿ ${sleepDeficit.toFixed(1)}Ñ‡ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞ°ĞµÑ‚ Ğ°Ğ¿Ğ¿ĞµÑ‚Ğ¸Ñ‚ â€” ÑÑ‚Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾`,
        details: 'ğŸ“Š ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‡Ğ°Ñ Ğ½ĞµĞ´Ğ¾ÑÑ‹Ğ¿Ğ° = +45 ĞºĞºĞ°Ğ» Ğ°Ğ¿Ğ¿ĞµÑ‚Ğ¸Ñ‚Ğ°. Ğ­Ñ‚Ğ¾ Ğ³Ğ¾Ñ€Ğ¼Ğ¾Ğ½Ñ‹, Ğ½Ğµ ÑĞ»Ğ°Ğ±Ğ¾ÑÑ‚ÑŒ Ğ²Ğ¾Ğ»Ğ¸.',
        type: 'insight',
        priority: 20,
        category: 'correlation',
        triggers: ['product_added', 'tab_open'],
        ttl: 6000
      });
    }
    
    // ĞĞµĞ´Ğ¾ÑÑ‹Ğ¿ ÑƒÑ‚Ñ€Ğ¾Ğ¼ â€” Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ´Ğ¸Ñ‚ÑŒ Ğ¾ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞµĞ½Ğ½Ğ¾Ğ¼ Ğ°Ğ¿Ğ¿ĞµÑ‚Ğ¸Ñ‚Ğµ
    if (sleepDeficit > 1.5 && hour < 12 && kcalPct < 0.3) {
      advices.push({
        id: 'sleep_hunger_warning',
        icon: 'âš¡',
        text: 'ĞŸĞ¾ÑĞ»Ğµ Ğ½ĞµĞ´Ğ¾ÑÑ‹Ğ¿Ğ° Ğ°Ğ¿Ğ¿ĞµÑ‚Ğ¸Ñ‚ Ğ²Ñ‹ÑˆĞµ â€” Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞ¹ ÑÑ‹Ñ‚Ğ½Ñ‹Ğ¹ Ğ¾Ğ±ĞµĞ´',
        details: 'â˜• ĞŸĞ¾ÑĞ»Ğµ Ğ½ĞµĞ´Ğ¾ÑÑ‹Ğ¿Ğ° Ñ‚ÑĞ½ĞµÑ‚ Ğ½Ğ° ÑĞ»Ğ°Ğ´ĞºĞ¾Ğµ. Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞ¹ Ğ±ĞµĞ»ĞºĞ¾Ğ²Ñ‹Ğ¹ Ğ¾Ğ±ĞµĞ´ Ğ·Ğ°Ñ€Ğ°Ğ½ĞµĞµ.',
        type: 'tip',
        priority: 25,
        category: 'correlation',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 11: Ğ¡Ñ‚Ñ€ĞµÑÑ â†’ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹
    const avgStress = calculateAverageStress(day);
    const simplePctCorr = (dayTot?.simple || 0) / ((normAbs?.simple || 50) || 1);
    
    // Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ ÑÑ‚Ñ€ĞµÑÑ + Ğ¼Ğ½Ğ¾Ğ³Ğ¾ ÑĞ»Ğ°Ğ´ĞºĞ¾Ğ³Ğ¾ = Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½
    if (avgStress >= 4 && simplePctCorr > 1.2) {
      advices.push({
        id: 'stress_sweet_pattern',
        icon: 'ğŸ’¡',
        text: 'Ğ¡Ñ‚Ñ€ĞµÑÑ â†’ ÑĞ»Ğ°Ğ´ĞºĞ¾Ğµ â€” Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ğ¾Ñ€ĞµÑ…Ğ¸ Ğ¸Ğ»Ğ¸ Ñ‚Ñ‘Ğ¼Ğ½Ñ‹Ğ¹ ÑˆĞ¾ĞºĞ¾Ğ»Ğ°Ğ´',
        details: 'ğŸ« Ğ¡Ñ‚Ñ€ĞµÑÑ â†’ ĞºĞ¾Ñ€Ñ‚Ğ¸Ğ·Ğ¾Ğ» â†’ Ñ‚ÑĞ³Ğ° Ğº ÑĞ»Ğ°Ğ´ĞºĞ¾Ğ¼Ñƒ. ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ°: Ñ‚Ñ‘Ğ¼Ğ½Ñ‹Ğ¹ ÑˆĞ¾ĞºĞ¾Ğ»Ğ°Ğ´ 70%+, Ğ¾Ñ€ĞµÑ…Ğ¸, Ğ±Ğ°Ğ½Ğ°Ğ½.',
        type: 'insight',
        priority: 22,
        category: 'correlation',
        triggers: ['product_added'],
        ttl: 6000
      });
    }
    
    // ĞĞ¸Ğ·ĞºĞ¸Ğ¹ ÑÑ‚Ñ€ĞµÑÑ + Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ = Ğ¿Ğ¾Ñ…Ğ²Ğ°Ğ»Ğ¸Ñ‚ÑŒ
    if (avgStress > 0 && avgStress <= 2 && kcalPct >= 0.9 && kcalPct <= 1.1) {
      advices.push({
        id: 'low_stress_balance',
        icon: 'â˜®ï¸',
        text: 'Ğ¡Ğ¿Ğ¾ĞºĞ¾Ğ¹Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ = Ğ»ĞµĞ³Ñ‡Ğµ Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ. Ğ—Ğ°Ğ¼ĞµÑ‡Ğ°ĞµÑˆÑŒ?',
        details: 'ğŸ§˜ ĞĞ¸Ğ·ĞºĞ¸Ğ¹ ÑÑ‚Ñ€ĞµÑÑ = Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹ ĞºĞ¾Ñ€Ñ‚Ğ¸Ğ·Ğ¾Ğ» = Ğ¼ĞµĞ½ÑŒÑˆĞµ Ñ‚ÑĞ³Ğ¸ Ğº ĞµĞ´Ğµ. Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸ ÑÑ‚Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ!',
        type: 'insight',
        priority: 40,
        category: 'correlation',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 36: Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºĞ° Ğ²ĞµÑĞ°
    const todayWeight = day?.weightMorning || 0;
    
    if (todayWeight > 0 && !sessionStorage.getItem('heys_weight_tip')) {
      // Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ²Ñ‡ĞµÑ€Ğ°ÑˆĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
      const yesterdayDays = getRecentDays(1);
      const yesterdayDay = yesterdayDays[0];
      const yesterdayWeight = yesterdayDay?.weightMorning || 0;
      
      // Ğ ĞµĞ·ĞºĞ¸Ğ¹ ÑĞºĞ°Ñ‡Ğ¾Ğº Ğ²ĞµÑĞ° (Â±1ĞºĞ³)
      if (yesterdayWeight > 0) {
        const diff = todayWeight - yesterdayWeight;
        
        if (Math.abs(diff) > 1.0) {
          const diffStr = diff > 0 ? `+${diff.toFixed(1)}` : diff.toFixed(1);
          advices.push({
            id: 'weight_spike_up',
            icon: 'ğŸ’§',
            text: `Ğ’ĞµÑ ${diffStr}ĞºĞ³ â€” ÑĞºĞ¾Ñ€ĞµĞµ Ğ²ÑĞµĞ³Ğ¾ Ğ²Ğ¾Ğ´Ğ°, Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ¶Ğ¸Ğ²Ğ°Ğ¹`,
            details: 'ğŸ’§ Ğ¡ĞºĞ°Ñ‡ĞºĞ¸ Ğ²ĞµÑĞ° Â±1ĞºĞ³ Ğ·Ğ° Ğ´ĞµĞ½ÑŒ â€” ÑÑ‚Ğ¾ Ğ²Ğ¾Ğ´Ğ° Ğ¸ Ğ³Ğ»Ğ¸ĞºĞ¾Ğ³ĞµĞ½, Ğ½Ğµ Ğ¶Ğ¸Ñ€. Ğ¡Ğ¼Ğ¾Ñ‚Ñ€Ğ¸ Ğ½Ğ° Ñ‚Ñ€ĞµĞ½Ğ´ Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ.',
            type: 'insight',
            priority: 23,
            category: 'correlation',
            triggers: ['tab_open'],
            ttl: 5000,
            onShow: () => { try { sessionStorage.setItem('heys_weight_tip', '1'); } catch(e) {} }
          });
        }
      }
      
      // Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµÑ Ğ·Ğ° 7 Ğ´Ğ½ĞµĞ¹
      const recentDays = getRecentDays(7);
      const weights = recentDays
        .map(d => d.weightMorning)
        .filter(w => w > 0);
      
      if (weights.length >= 5) {
        // Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğµ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½Ğ¸Ğµ
        const avg = weights.reduce((a, b) => a + b, 0) / weights.length;
        const variance = weights.reduce((sum, w) => sum + Math.pow(w - avg, 2), 0) / weights.length;
        const stdDev = Math.sqrt(variance);
        
        if (stdDev < 0.5 && !sessionStorage.getItem('heys_weight_stable_tip')) {
          advices.push({
            id: 'weight_stable',
            icon: 'ğŸ“Š',
            text: 'Ğ’ĞµÑ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ĞµĞ½ ÑƒĞ¶Ğµ Ğ½ĞµĞ´ĞµĞ»Ñ â€” Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°!',
            details: 'âš–ï¸ Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµÑ 7 Ğ´Ğ½ĞµĞ¹ = Ñ‚Ñ‹ Ğ½Ğ°ÑˆÑ‘Ğ» ÑĞ²Ğ¾Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ. ĞŸĞ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ = Ñ€Ğ°ÑÑ…Ğ¾Ğ´.',
            type: 'achievement',
            priority: 9,
            category: 'achievement',
            triggers: ['tab_open'],
            ttl: 5000,
            onShow: () => { try { sessionStorage.setItem('heys_weight_stable_tip', '1'); } catch(e) {} }
          });
        }
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ‹ï¸ TRAINING TIPS (priority: 30-35)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 14: Post-workout ÑĞ¾Ğ²ĞµÑ‚Ñ‹
    const trainings = day?.trainings || [];
    const todayTraining = trainings.find(t => t.z && t.z.some(m => m > 0));
    
    if (todayTraining) {
      const totalMinutes = todayTraining.z.reduce((a, b) => a + b, 0);
      const highIntensityMinutes = (todayTraining.z[2] || 0) + (todayTraining.z[3] || 0); // Ğ—Ğ¾Ğ½Ñ‹ 3-4
      const isHardWorkout = highIntensityMinutes > 20;
      const proteinPct = (dayTot?.prot || 0) / ((normAbs?.prot || 100) || 1);
      
      // Ğ¢ÑĞ¶Ñ‘Ğ»Ğ°Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° â€” Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ±ĞµĞ»ĞºĞ°
      if (isHardWorkout && proteinPct < 1.0) {
        advices.push({
          id: 'hard_workout_recovery',
          icon: 'ğŸ”¥',
          text: `${highIntensityMinutes} Ğ¼Ğ¸Ğ½ Ğ² Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ñ… Ğ·Ğ¾Ğ½Ğ°Ñ… â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ±ĞµĞ»ĞºĞ° Ğ´Ğ»Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ`,
          details: 'ğŸ‹ï¸ Ğ˜Ğ½Ñ‚ĞµĞ½ÑĞ¸Ğ²Ğ½Ğ°Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ¼Ğ¸ĞºÑ€Ğ¾Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¼Ñ‹ÑˆÑ†. Ğ‘ĞµĞ»Ğ¾Ğº Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ 2Ñ‡ ÑƒÑĞºĞ¾Ñ€ÑĞµÑ‚ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ.',
          type: 'tip',
          priority: 30,
          category: 'training',
          triggers: ['product_added', 'tab_open'],
          ttl: 5000
        });
      }
      
      // ĞšĞ°Ñ€Ğ´Ğ¸Ğ¾ Ğ² Ğ·Ğ¾Ğ½Ğµ Ğ¶Ğ¸Ñ€Ğ¾ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ñ â€” Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞµĞ´Ğ°Ñ‚ÑŒ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ°Ğ¼Ğ¸
      const fatBurnMinutes = todayTraining.z[1] || 0; // Ğ—Ğ¾Ğ½Ğ° 2
      const carbsPct = (dayTot?.carbs || 0) / ((normAbs?.carbs || 200) || 1);
      if (fatBurnMinutes > 30 && carbsPct > 1.2) {
        advices.push({
          id: 'cardio_carbs_balance',
          icon: 'ğŸƒ',
          text: 'ĞŸĞ¾ÑĞ»Ğµ ĞºĞ°Ñ€Ğ´Ğ¸Ğ¾ Ğ»ÑƒÑ‡ÑˆĞµ Ğ±ĞµĞ»Ğ¾Ğº Ğ¸ Ğ¾Ğ²Ğ¾Ñ‰Ğ¸, Ñ‡ĞµĞ¼ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹',
          details: 'ğŸ”¥ ĞŸĞ¾ÑĞ»Ğµ ĞºĞ°Ñ€Ğ´Ğ¸Ğ¾ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ¶Ğ¸Ñ€Ğ¾ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ñ. Ğ£Ğ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ°Ñ‚ ÑÑ‚Ğ¾Ñ‚ Ñ€ĞµĞ¶Ğ¸Ğ¼.',
          type: 'tip',
          priority: 35,
          category: 'training',
          triggers: ['product_added'],
          ttl: 5000
        });
      }
      
      // ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°!
      if (totalMinutes >= 45) {
        advices.push({
          id: 'great_workout',
          icon: 'ğŸ’ª',
          text: `${totalMinutes} Ğ¼Ğ¸Ğ½ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ â€” ÑÑƒĞ¿ĞµÑ€!`,
          details: 'ğŸ¯ 45+ Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ = ÑĞµÑ€ÑŒÑ‘Ğ·Ğ½Ğ°Ñ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°! ĞĞµ Ğ·Ğ°Ğ±ÑƒĞ´ÑŒ Ğ¿Ñ€Ğ¾ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸ ÑĞ¾Ğ½.',
          type: 'achievement',
          priority: 7,
          category: 'training',
          triggers: ['tab_open'],
          ttl: 4000
        });
      }
      
      // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 35: Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ñƒ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸
      // training.type = 'cardio' | 'strength' | 'hobby'
      
      // ĞŸĞ¾ÑĞ»Ğµ ÑĞ¸Ğ»Ğ¾Ğ²Ğ¾Ğ¹ â€” Ğ±ĞµĞ»Ğ¾Ğº Ğ²Ğ°Ğ¶Ğ½ĞµĞµ
      if (todayTraining.type === 'strength' && proteinPct < 1.0) {
        advices.push({
          id: 'training_type_strength',
          icon: 'ğŸ‹ï¸',
          text: 'ĞŸĞ¾ÑĞ»Ğµ ÑĞ¸Ğ»Ğ¾Ğ²Ğ¾Ğ¹ Ğ²Ğ°Ğ¶ĞµĞ½ Ğ±ĞµĞ»Ğ¾Ğº â€” 20-30Ğ³ Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ 2 Ñ‡Ğ°ÑĞ¾Ğ²',
          details: 'ğŸ’ª Ğ¡Ğ¸Ğ»Ğ¾Ğ²Ğ°Ñ ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ Ğ¼Ğ¸ĞºÑ€Ğ¾Ğ¿Ğ¾Ğ²Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¼Ñ‹ÑˆÑ†, Ğ±ĞµĞ»Ğ¾Ğº Ğ¸Ñ… Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚. Ğ‘ĞµĞ· Ğ±ĞµĞ»ĞºĞ° â€” Ñ€Ğ¾ÑÑ‚Ğ° Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚.',
          type: 'tip',
          priority: 31,
          category: 'training',
          triggers: ['tab_open', 'product_added'],
          ttl: 5000
        });
      }
      
      // ĞŸĞ¾ÑĞ»Ğµ Ñ…Ğ¾Ğ±Ğ±Ğ¸ (Ğ¹Ğ¾Ğ³Ğ° Ğ¸ Ñ‚.Ğ¿.) â€” Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼
      if (todayTraining.type === 'hobby' && !sessionStorage.getItem('heys_hobby_tip')) {
        advices.push({
          id: 'training_type_hobby',
          icon: 'ğŸ§˜',
          text: 'ĞŸĞ¾ÑĞ»Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ñ…Ğ¾Ğ±Ğ±Ğ¸ Ğ¸Ğ´ĞµĞ°Ğ»ĞµĞ½ Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ â€” Ğ¾Ğ²Ğ¾Ñ‰Ğ¸, Ñ„Ñ€ÑƒĞºÑ‚Ñ‹',
          details: 'ğŸŒ¿ Ğ™Ğ¾Ğ³Ğ°, Ğ¿Ñ€Ğ¾Ğ³ÑƒĞ»ĞºĞ¸, ÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¸Ğ³Ñ€Ñ‹ Ñ€Ğ°ÑÑĞ»Ğ°Ğ±Ğ»ÑÑÑ‚ Ğ¸ Ğ½Ğµ Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ Ğ°Ğ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ.',
          type: 'tip',
          priority: 49,
          category: 'training',
          triggers: ['tab_open'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_hobby_tip', '1'); } catch(e) {} }
        });
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ’§ HYDRATION TIPS (priority: 42-46)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 13: Ğ£Ğ¼Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ Ğ¾ Ğ²Ğ¾Ğ´Ğµ
    const waterMl = day?.waterMl || 0;
    const waterNorm = waterGoal || 2000; // waterGoal Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ½ Ğ¸Ğ· ctx
    const waterPct = waterMl / waterNorm;
    
    // ĞœĞ°Ğ»Ğ¾ Ğ²Ğ¾Ğ´Ñ‹ Ğº Ğ²ĞµÑ‡ĞµÑ€Ñƒ
    if (hour >= 18 && waterPct < 0.5) {
      const needed = Math.round(waterNorm * 0.7 - waterMl);
      if (needed > 0) {
        advices.push({
          id: 'water_evening_low',
          icon: 'ğŸ’§',
          text: `Ğ’Ñ‹Ğ¿Ğ¸Ñ‚Ğ¾ ${waterMl}Ğ¼Ğ» â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ ĞµÑ‰Ñ‘ ${needed}Ğ¼Ğ»`,
          details: 'ğŸ’§ Ğ’ĞµÑ‡ĞµÑ€Ğ½ÑÑ Ğ³Ğ¸Ğ´Ñ€Ğ°Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ²Ğ°Ğ¶Ğ½Ğ° Ğ´Ğ»Ñ Ğ½Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ. ĞĞ¾ Ğ·Ğ° 1 Ñ‡Ğ°Ñ Ğ´Ğ¾ ÑĞ½Ğ° â€” Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ÑŒ Ğ²Ğ¾Ğ´Ñƒ.',
          type: 'tip',
          priority: 42,
          category: 'hydration',
          triggers: ['tab_open'],
          ttl: 5000
        });
      }
    }
    
    // Ğ”Ğ°Ğ²Ğ½Ğ¾ Ğ½Ğµ Ğ¿Ğ¸Ğ» â€” Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚ÑŒ
    const lastWater = day?.lastWaterTime ? new Date(day.lastWaterTime) : null;
    const hoursSinceWater = lastWater ? (Date.now() - lastWater.getTime()) / (1000 * 60 * 60) : 99;
    
    if (hoursSinceWater > 2 && hour >= 10 && hour <= 21 && waterPct < 1.0) {
      const waterText = getTimeBasedText('water_reminder', hour, 'Ğ£Ğ¶Ğµ 2+ Ñ‡Ğ°ÑĞ° Ğ±ĞµĞ· Ğ²Ğ¾Ğ´Ñ‹ â€” Ğ²Ñ‹Ğ¿ĞµĞ¹ ÑÑ‚Ğ°ĞºĞ°Ğ½');
      advices.push({
        id: 'water_reminder',
        icon: 'ğŸš°',
        text: waterText,
        details: 'ğŸ’§ Ğ’Ğ¾Ğ´Ğ° ÑƒÑĞºĞ¾Ñ€ÑĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼ Ğ½Ğ° 30% Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ñ‡Ğ°ÑĞ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ğ¸Ñ‚ÑŒÑ. 2 ÑÑ‚Ğ°ĞºĞ°Ğ½Ğ° Ğ¿ĞµÑ€ĞµĞ´ ĞµĞ´Ğ¾Ğ¹ ÑĞ½Ğ¸Ğ¶Ğ°ÑÑ‚ Ğ°Ğ¿Ğ¿ĞµÑ‚Ğ¸Ñ‚ Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ÑÑ‚ ÑÑŠĞµÑÑ‚ÑŒ Ğ½Ğ° 75-90 ĞºĞºĞ°Ğ» Ğ¼ĞµĞ½ÑŒÑˆĞµ.',
        type: 'tip',
        priority: 44,
        category: 'hydration',
        triggers: ['tab_open', 'product_added'],
        ttl: 4000
      });
    }
    
    // ĞĞ¾Ñ€Ğ¼Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°!
    if (waterPct >= 1.0 && !sessionStorage.getItem('heys_water_done')) {
      advices.push({
        id: 'water_goal_reached',
        icon: 'ğŸ’¦',
        text: `${waterMl}Ğ¼Ğ» â€” Ğ´Ğ½ĞµĞ²Ğ½Ğ°Ñ Ğ½Ğ¾Ñ€Ğ¼Ğ° Ğ²Ğ¾Ğ´Ñ‹ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°!`,
        details: 'ğŸ† ĞĞ¾Ñ€Ğ¼Ğ° Ğ²Ğ¾Ğ´Ñ‹ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°! Ğ­Ñ‚Ğ¾ ÑƒĞ»ÑƒÑ‡ÑˆĞ°ĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼, ĞºĞ¾Ğ¶Ñƒ Ğ¸ ĞºĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ñ†Ğ¸Ñ.',
        type: 'achievement',
        priority: 6,
        category: 'hydration',
        triggers: ['tab_open'],
        ttl: 5000,
        onShow: () => { try { sessionStorage.setItem('heys_water_done', '1'); } catch(e) {} }
      });
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ¯ NUTRITION QUALITY TIPS (priority: 32-40)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 22: Ğ“Ğ»Ğ¸ĞºĞµĞ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ
    const avgGI = dayTot?.gi || 0;
    
    if (avgGI > 70 && mealCount >= 2) {
      advices.push({
        id: 'high_gi_warning',
        icon: 'ğŸ“ˆ',
        text: `Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ“Ğ˜ ${Math.round(avgGI)} â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ±ĞµĞ»Ğ¾Ğº Ğ¸ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºÑƒ`,
        details: 'ğŸ“‰ Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ“Ğ˜ = ÑĞºĞ°Ñ‡ĞºĞ¸ ÑĞ°Ñ…Ğ°Ñ€Ğ° Ğ¸ Ğ³Ğ¾Ğ»Ğ¾Ğ´. Ğ‘ĞµĞ»Ğ¾Ğº Ğ¸ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° Ğ·Ğ°Ğ¼ĞµĞ´Ğ»ÑÑÑ‚ ÑƒÑĞ²Ğ¾ĞµĞ½Ğ¸Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ².',
        type: 'tip',
        priority: 33,
        category: 'nutrition',
        triggers: ['product_added', 'tab_open'],
        ttl: 5000
      });
    }
    
    // ğŸ†• Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°: Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ“Ğ˜ Ğ¿Ñ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ²Ğ¾Ğ»Ğ½Ğµ â€” ÑƒÑĞ¸Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¸ĞºĞ¸
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‡ĞµÑ€ĞµĞ· HEYS.InsulinWave ĞµÑĞ»Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½
    const checkActiveWaveHighGI = () => {
      if (typeof HEYS === 'undefined' || !HEYS.InsulinWave) return null;
      
      const mealsWithItems = (day?.meals || []).filter(m => m.items?.length > 0 && m.time);
      if (mealsWithItems.length < 2) return null;
      
      const insulinWaveHours = prof?.insulinWaveHours || 3;
      const lastMeal = mealsWithItems[mealsWithItems.length - 1];
      const prevMeal = mealsWithItems[mealsWithItems.length - 2];
      
      // Ğ’Ñ€ĞµĞ¼Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¼Ğ¸ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ğ¼Ğ¸
      const lastTime = HEYS.InsulinWave.utils?.timeToMinutes?.(lastMeal.time) || 0;
      const prevTime = HEYS.InsulinWave.utils?.timeToMinutes?.(prevMeal.time) || 0;
      const gapMinutes = lastTime - prevTime;
      
      // Ğ•ÑĞ»Ğ¸ gap Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ²Ğ¾Ğ»Ğ½Ñ‹ â€” Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ ĞµĞ»Ğ¸ Ğ²Ğ¾ Ğ²Ñ€ĞµĞ¼Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ğ²Ğ¾Ğ»Ğ½Ñ‹
      if (gapMinutes > 0 && gapMinutes < insulinWaveHours * 60) {
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ“Ğ˜ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°
        const lastMealGI = (() => {
          let totalW = 0, totalG = 0;
          for (const item of (lastMeal.items || [])) {
            const g = item.grams || 100;
            const prod = pIndex?.byId?.get?.(item.product_id);
            const gi = prod?.gi || prod?.gi100 || 50;
            totalW += gi * g;
            totalG += g;
          }
          return totalG > 0 ? totalW / totalG : 50;
        })();
        
        if (lastMealGI > 65) {
          return {
            gap: Math.round(gapMinutes),
            gi: Math.round(lastMealGI),
            severity: lastMealGI > 75 ? 'high' : 'medium'
          };
        }
      }
      return null;
    };
    
    const activeWaveHighGI = checkActiveWaveHighGI();
    if (activeWaveHighGI) {
      advices.push({
        id: 'active_wave_high_gi',
        icon: 'âš ï¸',
        text: activeWaveHighGI.severity === 'high'
          ? `Ğ“Ğ˜ ${activeWaveHighGI.gi} Ğ¿Ñ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ğ²Ğ¾Ğ»Ğ½Ğµ â€” Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½ ĞµÑ‰Ñ‘ Ğ²Ñ‹ÑˆĞµ, Ğ»Ğ¸Ğ¿Ğ¾Ğ»Ğ¸Ğ· Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½!`
          : `Ğ“Ğ˜ ${activeWaveHighGI.gi} Ğ¿Ñ€Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ğ²Ğ¾Ğ»Ğ½Ğµ â€” Ğ¶Ğ¸Ñ€Ğ¾ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚ĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ`,
        details: 'ğŸ”– Ğ˜Ğ½ÑÑƒĞ»Ğ¸Ğ½ ĞµÑ‰Ñ‘ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ¾Ñ‚ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ ĞµĞ´Ñ‹. Ğ¡Ğ»Ğ°Ğ´ĞºĞ¾Ğµ ÑĞµĞ¹Ñ‡Ğ°Ñ ÑƒĞ¹Ğ´Ñ‘Ñ‚ Ğ² Ğ¶Ğ¸Ñ€. Ğ”Ğ¾Ğ¶Ğ´Ğ¸ÑÑŒ Ğ¾ĞºĞ½Ğ° Ğ»Ğ¸Ğ¿Ğ¾Ğ»Ğ¸Ğ·Ğ°.',
        type: 'warning',
        priority: 42, // Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚
        category: 'timing',
        triggers: ['product_added'],
        ttl: 6000
      });
    }
    
    if (avgGI > 0 && avgGI <= 55 && mealCount >= 2) {
      advices.push({
        id: 'low_gi_great',
        icon: 'ğŸ’š',
        text: `Ğ“Ğ˜ ${Math.round(avgGI)} â€” ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ°Ñ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ²ĞµÑÑŒ Ğ´ĞµĞ½ÑŒ`,
        details: 'ğŸŒ¿ ĞĞ¸Ğ·ĞºĞ¸Ğ¹ Ğ“Ğ˜ = ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ°Ñ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ±ĞµĞ· ÑĞºĞ°Ñ‡ĞºĞ¾Ğ². Ğ¢Ñ‹ Ğ½Ğµ Ñ‡ÑƒĞ²ÑÑ‚Ğ²ÑƒĞµÑˆÑŒ Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ° Ğ¸ ÑƒĞ¿Ğ°Ğ´ĞºĞ° ÑĞ¸Ğ».',
        type: 'achievement',
        priority: 36,
        category: 'nutrition',
        triggers: ['tab_open'],
        ttl: 4000
      });
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 23: Ğ¡Ğ¾Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ…/ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ²
    const simpleCarbs = dayTot?.simple || 0;
    const complexCarbs = dayTot?.complex || 0;
    const totalCarbs = simpleCarbs + complexCarbs;
    
    if (totalCarbs > 50) {
      const simpleRatio = simpleCarbs / totalCarbs;
      
      if (simpleRatio > 0.5) {
        advices.push({
          id: 'simple_complex_ratio',
          icon: 'âš–ï¸',
          text: `${Math.round(simpleRatio * 100)}% Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ² â€” Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ ĞºĞ°ÑˆĞ¸, Ñ…Ğ»ĞµĞ±`,
          details: 'ğŸŒ¾ Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ: 70% ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… (ĞºĞ°ÑˆĞ¸, Ñ…Ğ»ĞµĞ±, Ğ¼Ğ°ĞºĞ°Ñ€Ğ¾Ğ½Ñ‹) / 30% Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… (Ñ„Ñ€ÑƒĞºÑ‚Ñ‹, Ğ¼Ñ‘Ğ´). Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ´Ğ°ÑÑ‚ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½ÑƒÑ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ½Ğ° 3-4 Ñ‡Ğ°ÑĞ° Ğ±ĞµĞ· ÑĞºĞ°Ñ‡ĞºĞ¾Ğ² ÑĞ°Ñ…Ğ°Ñ€Ğ°.',
          type: 'tip',
          priority: 34,
          category: 'nutrition',
          triggers: ['product_added'],
          ttl: 5000
        });
      }
      
      if (simpleRatio <= 0.3 && mealCount >= 2) {
        advices.push({
          id: 'carbs_balance_perfect',
          icon: 'ğŸŒ¾',
          text: 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ğ¾Ğ²!',
          details: 'ğŸŒ¾ 70% ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… / 30% Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… â€” Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¹ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸.',
          type: 'achievement',
          priority: 37,
          category: 'nutrition',
          triggers: ['tab_open'],
          ttl: 4000
        });
      }
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 24: ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¶Ğ¸Ñ€Ğ¾Ğ²
    const goodFat = dayTot?.good || 0;
    const badFat = dayTot?.bad || 0;
    const transFat = dayTot?.trans || 0;
    const totalFat = goodFat + badFat + transFat;
    
    if (totalFat > 20) {
      const goodRatio = goodFat / totalFat;
      
      if (goodRatio < 0.4) {
        advices.push({
          id: 'fat_quality_low',
          icon: 'ğŸŸ',
          text: 'Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ñ‹Ñ… Ğ¶Ğ¸Ñ€Ğ¾Ğ² â€” Ñ€Ñ‹Ğ±Ğ°, Ğ¾Ñ€ĞµÑ…Ğ¸, Ğ°Ğ²Ğ¾ĞºĞ°Ğ´Ğ¾',
          details: 'ğŸ§  ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ¶Ğ¸Ñ€Ñ‹ (Ğ¾Ğ¼ĞµĞ³Ğ°-3) Ğ½ÑƒĞ¶Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ·Ğ³Ğ°, ÑĞµÑ€Ğ´Ñ†Ğ° Ğ¸ Ğ³Ğ¾Ñ€Ğ¼Ğ¾Ğ½Ğ¾Ğ². Ğ¡Ñ‘Ğ¼Ğ³Ğ°, Ğ³Ñ€ĞµÑ†ĞºĞ¸Ğµ Ğ¾Ñ€ĞµÑ…Ğ¸, Ğ°Ğ²Ğ¾ĞºĞ°Ğ´Ğ¾.',
          type: 'tip',
          priority: 32,
          category: 'nutrition',
          triggers: ['product_added', 'tab_open'],
          ttl: 5000
        });
      }
      
      if (goodRatio >= 0.6) {
        advices.push({
          id: 'fat_quality_great',
          icon: 'ğŸ’š',
          text: `${Math.round(goodRatio * 100)}% Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ñ‹Ñ… Ğ¶Ğ¸Ñ€Ğ¾Ğ² â€” ÑÑƒĞ¿ĞµÑ€!`,
          details: 'â¤ï¸ ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ Ğ¶Ğ¸Ñ€Ğ¾Ğ²! Ğ¢Ğ²Ğ¾Ñ‘ ÑĞµÑ€Ğ´Ñ†Ğµ Ğ¸ Ğ¼Ğ¾Ğ·Ğ³ ÑĞºĞ°Ğ¶ÑƒÑ‚ ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾.',
          type: 'achievement',
          priority: 38,
          category: 'nutrition',
          triggers: ['tab_open'],
          ttl: 4000
        });
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // â° CHRONO-NUTRITION TIPS (priority: 38-43)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 15: Ğ˜Ğ½ÑÑƒĞ»Ğ¸Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ²Ğ¾Ğ»Ğ½Ñ‹
    const insulinWave = prof?.insulinWaveHours || 4;
    const mealsWithItems = (day?.meals || []).filter(m => m.items?.length > 0);
    
    if (mealsWithItems.length >= 2) {
      const times = mealsWithItems.map(m => {
        const [h, min] = (m.time || '12:00').split(':').map(Number);
        return h * 60 + min;
      }).sort((a, b) => a - b);
      
      for (let i = 1; i < times.length; i++) {
        const gap = times[i] - times[i - 1];
        
        if (gap < insulinWave * 60 * 0.5) { // < 50% Ğ¾Ñ‚ Ğ½Ğ¾Ñ€Ğ¼Ñ‹
          const gapHours = (gap / 60).toFixed(1).replace('.0', '');
          advices.push({
            id: 'insulin_too_fast',
            icon: 'â±ï¸',
            text: `ĞœĞµĞ¶Ğ´Ñƒ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ğ¼Ğ¸ ${gapHours}Ñ‡ â€” Ğ´Ğ°Ğ¹ Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½Ñƒ Ğ¾Ñ‚Ğ´Ğ¾Ñ…Ğ½ÑƒÑ‚ÑŒ`,
            details: 'ğŸ”– Ğ˜Ğ½ÑÑƒĞ»Ğ¸Ğ½ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ = Ğ¶Ğ¸Ñ€ Ğ½Ğµ Ğ³Ğ¾Ñ€Ğ¸Ñ‚. Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ĞµÑ€ĞµÑ€Ñ‹Ğ² 3-4 Ñ‡Ğ°ÑĞ° Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ğ¼Ğ¸.',
            type: 'tip',
            priority: 38,
            category: 'timing',
            triggers: ['product_added'],
            ttl: 5000
          });
          break;
        }
      }
      
      const avgGap = (times[times.length - 1] - times[0]) / (times.length - 1);
      if (avgGap >= insulinWave * 60 * 0.9 && mealsWithItems.length >= 3) {
        advices.push({
          id: 'insulin_perfect',
          icon: 'â°',
          text: 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»Ñ‹ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°Ğ¼Ğ¸!',
          details: 'ğŸ¯ Ğ˜Ğ½ÑÑƒĞ»Ğ¸Ğ½ ÑƒÑĞ¿ĞµĞ²Ğ°ĞµÑ‚ ÑĞ½Ğ¸Ğ·Ğ¸Ñ‚ÑŒÑÑ â†’ Ğ»Ğ¸Ğ¿Ğ¾Ğ»Ğ¸Ğ· Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ÑÑ. Ğ¢Ğ°Ğº Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ!',
          type: 'achievement',
          priority: 39,
          category: 'timing',
          triggers: ['tab_open'],
          ttl: 4000
        });
      }
      
      // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 40: ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚ÑÑ‡Ñ‘Ñ‚ Ğ´Ğ¾ ĞºĞ¾Ğ½Ñ†Ğ° Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ²Ğ¾Ğ»Ğ½Ñ‹
      const lastMealTimeMinutes = times[times.length - 1];
      const nowMinutes = hour * 60 + new Date().getMinutes();
      const insulinEndMinutes = lastMealTimeMinutes + insulinWave * 60;
      const minutesUntilEnd = insulinEndMinutes - nowMinutes;
      
      if (minutesUntilEnd > 0 && minutesUntilEnd < 60 && !sessionStorage.getItem('heys_insulin_countdown')) {
        advices.push({
          id: 'insulin_countdown',
          icon: 'â±ï¸',
          text: `Ğ§ĞµÑ€ĞµĞ· ${minutesUntilEnd} Ğ¼Ğ¸Ğ½ Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½Ğ¾Ğ²Ğ°Ñ Ğ²Ğ¾Ğ»Ğ½Ğ° Ğ·Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸Ñ‚ÑÑ â€” Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿ĞµÑ€ĞµĞºÑƒÑĞ¸Ñ‚ÑŒ`,
          details: 'ğŸ”¥ ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½ ÑĞ½Ğ¸Ğ·Ğ¸Ñ‚ÑÑ, Ğ½Ğ°Ñ‡Ğ½Ñ‘Ñ‚ÑÑ Ğ¶Ğ¸Ñ€Ğ¾ÑĞ¶Ğ¸Ğ³Ğ°Ğ½Ğ¸Ğµ. ĞŸĞ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸ ĞµÑ‰Ñ‘ Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾!',
          type: 'info',
          priority: 40,
          category: 'timing',
          triggers: ['tab_open'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_insulin_countdown', '1'); } catch(e) {} }
        });
      }
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 41: Ğ‘ĞµĞ»Ğ¾Ğº Ğ¿ĞµÑ€ĞµĞ´ ÑĞ½Ğ¾Ğ¼
    const sleepNormHours = prof?.sleepHours || 8;
    const expectedBedtime = 24 - sleepNormHours + 7; // ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ğ½Ğ¾ ĞºĞ¾Ğ³Ğ´Ğ° Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑÑ ÑĞ¿Ğ°Ñ‚ÑŒ (ĞµÑĞ»Ğ¸ Ğ²ÑÑ‚Ğ°Ñ‘Ñ‚ Ğ² 7)
    const hoursUntilBed = expectedBedtime - hour;
    
    if (hour >= 20 && hour <= 22 && proteinPct < 0.8 && hoursUntilBed > 0 && hoursUntilBed <= 4) {
      advices.push({
        id: 'bedtime_protein',
        icon: 'ğŸ¥›',
        text: `Ğ”Ğ¾ ÑĞ½Ğ° ~${Math.round(hoursUntilBed)}Ñ‡ â€” Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ ÑˆĞ°Ğ½Ñ Ğ´Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ±ĞµĞ»Ğ¾Ğº`,
        details: 'ğŸŒ™ ĞšĞ°Ğ·ĞµĞ¸Ğ½ (Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³, Ğ³Ñ€ĞµÑ‡ĞµÑĞºĞ¸Ğ¹ Ğ¹Ğ¾Ğ³ÑƒÑ€Ñ‚) â€” Ğ¸Ğ´ĞµĞ°Ğ»ĞµĞ½ Ğ½Ğ° Ğ½Ğ¾Ñ‡ÑŒ. ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾ ÑƒÑĞ²Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¸ Ğ¿Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ¼Ñ‹ÑˆÑ†Ñ‹ Ğ²Ğ¾ ÑĞ½Ğµ.',
        type: 'tip',
        priority: 35,
        category: 'timing',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 16: ĞŸĞ¾Ğ·Ğ´Ğ½Ğ¸Ğ¹ ÑƒĞ¶Ğ¸Ğ½
    const lastMealTime = (() => {
      const mealsList = (day?.meals || []).filter(m => m.items?.length > 0);
      if (mealsList.length === 0) return null;
      const timesList = mealsList.map(m => m.time || '12:00').sort();
      return timesList[timesList.length - 1];
    })();
    
    if (lastMealTime) {
      const [lastH] = lastMealTime.split(':').map(Number);
      
      if (lastH >= 22) {
        advices.push({
          id: 'late_dinner_warning',
          icon: 'ğŸŒ™',
          text: 'ĞŸĞ¾Ğ·Ğ´Ğ½Ğ¸Ğ¹ ÑƒĞ¶Ğ¸Ğ½ â€” ÑĞ¾Ğ½ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ…ÑƒĞ¶Ğµ',
          details: 'ğŸ’¤ Ğ•Ğ´Ğ° Ğ·Ğ° 2-3 Ñ‡Ğ°ÑĞ° Ğ´Ğ¾ ÑĞ½Ğ° ÑƒÑĞ¿ĞµĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ²Ğ°Ñ€Ğ¸Ñ‚ÑŒÑÑ. ĞŸĞ¾Ğ·Ğ´Ğ½Ñ‹Ğ¹ ÑƒĞ¶Ğ¸Ğ½ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²Ñ‹Ğ·Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ·Ğ¶Ğ¾Ğ³Ñƒ Ğ¸ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ…Ğ½Ğ¾ÑÑ‚Ğ½Ñ‹Ğ¹ ÑĞ¾Ğ½.',
          type: 'tip',
          priority: 41,
          category: 'timing',
          triggers: ['product_added'],
          ttl: 5000
        });
      }
      
      // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 38: Ğ¢ÑĞ¶Ñ‘Ğ»Ñ‹Ğ¹ ÑƒĞ¶Ğ¸Ğ½ Ğ¿Ğ¾ÑĞ»Ğµ 21:00
      // Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¸ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°
      const lastMealByTime = (day?.meals || []).find(m => m.time === lastMealTime);
      if (lastH >= 21 && lastH < 22 && lastMealByTime && !sessionStorage.getItem('heys_late_heavy_shown')) {
        let lateMealKcal = 0;
        for (const item of (lastMealByTime.items || [])) {
          const product = pIndex?.byId?.get(item.product_id);
          if (product) lateMealKcal += (product.kcal100 || 0) * (item.grams || 100) / 100;
        }
        
        if (lateMealKcal > 500) {
          advices.push({
            id: 'late_heavy_meal',
            icon: 'ğŸŒ™',
            text: `ĞŸĞ»Ğ¾Ñ‚Ğ½Ñ‹Ğ¹ ÑƒĞ¶Ğ¸Ğ½ (${Math.round(lateMealKcal)} ĞºĞºĞ°Ğ») Ğ¿Ğ¾ÑĞ»Ğµ 21:00 â€” ÑĞ¾Ğ½ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ñ…ÑƒĞ¶Ğµ`,
            details: 'ğŸ’¤ ĞŸĞ¸Ñ‰ĞµĞ²Ğ°Ñ€ĞµĞ½Ğ¸Ğµ Ğ¼ĞµÑˆĞ°ĞµÑ‚ Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¾Ğ¼Ñƒ ÑĞ½Ñƒ. Ğ’ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ñ€Ğ°Ğ· Ğ¿Ğ¾ÑƒĞ¶Ğ¸Ğ½Ğ°Ğ¹ Ğ»ĞµĞ³Ñ‡Ğµ Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ½ÑŒÑˆĞµ.',
            type: 'tip',
            priority: 40,
            category: 'timing',
            triggers: ['product_added'],
            ttl: 5000,
            onShow: () => { try { sessionStorage.setItem('heys_late_heavy_shown', '1'); } catch(e) {} }
          });
        }
      }
      
      if (lastH >= 18 && lastH <= 20 && hour >= 21) {
        advices.push({
          id: 'good_dinner_time',
          icon: 'âœ¨',
          text: 'Ğ£Ğ¶Ğ¸Ğ½ Ğ² Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ â€” Ğ¼Ğ¾Ğ»Ğ¾Ğ´ĞµÑ†!',
          details: 'ğŸŒ™ Ğ£Ğ¶Ğ¸Ğ½ Ğ·Ğ° 2-3 Ñ‡Ğ°ÑĞ° Ğ´Ğ¾ ÑĞ½Ğ° â€” Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ¾Ğ¹ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚. ĞŸĞ¸Ñ‰ĞµĞ²Ğ°Ñ€ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ¼ĞµÑˆĞ°ĞµÑ‚ Ğ·Ğ°ÑÑ‹Ğ¿Ğ°Ğ½Ğ¸Ñ, Ğ° Ğ½Ğ¾Ñ‡Ğ½Ğ¾Ğ¹ Ğ»Ğ¸Ğ¿Ğ¾Ğ»Ğ¸Ğ· Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ğ²Ğ¾Ğ²Ñ€ĞµĞ¼Ñ.',
          type: 'achievement',
          priority: 43,
          category: 'timing',
          triggers: ['tab_open'],
          ttl: 4000
        });
      }
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 39: ĞšĞ¾Ñ„Ğµ Ğ²ĞµÑ‡ĞµÑ€Ğ¾Ğ¼
    if (hasCoffeeAfterHour(day?.meals, 16, pIndex) && !sessionStorage.getItem('heys_caffeine_tip')) {
      advices.push({
        id: 'caffeine_evening',
        icon: 'â˜•',
        text: 'ĞšĞ¾Ñ„Ğµ Ğ¿Ğ¾ÑĞ»Ğµ 16:00 Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑƒÑ…ÑƒĞ´ÑˆĞ¸Ñ‚ÑŒ ÑĞ¾Ğ½',
        details: 'â° ĞšĞ¾Ñ„ĞµĞ¸Ğ½ Ğ´ĞµĞ¹ÑÑ‚Ğ²ÑƒĞµÑ‚ 6-8 Ñ‡Ğ°ÑĞ¾Ğ². ĞšĞ¾Ñ„Ğµ Ğ² 16:00 = ĞºĞ¾Ñ„ĞµĞ¸Ğ½ Ğ² ĞºÑ€Ğ¾Ğ²Ğ¸ Ğ´Ğ¾ Ğ¿Ğ¾Ğ»ÑƒĞ½Ğ¾Ñ‡Ğ¸. ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ°: Ğ´ĞµĞºĞ°Ñ„, Ğ·ĞµĞ»Ñ‘Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ğ¹, Ñ†Ğ¸ĞºĞ¾Ñ€Ğ¸Ğ¹.',
        type: 'tip',
        priority: 42,
        category: 'nutrition',
        triggers: ['product_added'],
        ttl: 5000,
        onShow: () => { try { sessionStorage.setItem('heys_caffeine_tip', '1'); } catch(e) {} }
      });
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ˜´ SLEEP QUALITY TIPS (priority: 26-28)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 25: ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ½Ğ° + Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ
    const sleepQuality = day?.sleepQuality || 0;
    const sleepHoursQ = calculateSleepHours(day);
    
    if (sleepQuality > 0 && sleepQuality <= 2 && hour < 12) {
      advices.push({
        id: 'bad_sleep_advice',
        icon: 'ğŸ˜´',
        text: 'ĞŸĞ¾ÑĞ»Ğµ Ğ¿Ğ»Ğ¾Ñ…Ğ¾Ğ³Ğ¾ ÑĞ½Ğ° â€” Ğ¼ĞµĞ½ÑŒÑˆĞµ ĞºĞ¾Ñ„Ğµ, Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ±ĞµĞ»ĞºĞ°',
        details: 'ğŸ’¡ ĞŸĞ¾ÑĞ»Ğµ Ğ½ĞµĞ´Ğ¾ÑÑ‹Ğ¿Ğ° Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ¼ Ñ…Ğ¾Ñ‡ĞµÑ‚ Ğ±Ñ‹ÑÑ‚Ñ€ÑƒÑ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ (ÑĞ°Ñ…Ğ°Ñ€, ĞºĞ¾Ñ„Ğµ). Ğ›ÑƒÑ‡ÑˆĞµ: Ğ±ĞµĞ»Ğ¾Ğº + ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¹ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸.',
        type: 'tip',
        priority: 26,
        category: 'sleep',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    if (sleepQuality >= 4 && sleepHoursQ >= 7) {
      advices.push({
        id: 'great_sleep',
        icon: 'ğŸ˜Š',
        text: 'Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾ Ğ²Ñ‹ÑĞ¿Ğ°Ğ»ÑÑ â€” Ğ´ĞµĞ½ÑŒ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¼!',
        details: 'ğŸŒŸ ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞ¾Ğ½ = Ğ½Ğ¸Ğ·ĞºĞ¸Ğ¹ ĞºĞ¾Ñ€Ñ‚Ğ¸Ğ·Ğ¾Ğ» Ğ¸ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ¿Ğ¿ĞµÑ‚Ğ¸Ñ‚. Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ±ÑƒĞ´ĞµÑ‚ Ğ»ĞµĞ³Ñ‡Ğµ Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ¿Ğ»Ğ°Ğ½!',
        type: 'achievement',
        priority: 46,
        category: 'sleep',
        triggers: ['tab_open'],
        ttl: 4000
      });
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ­ EMOTIONAL INTELLIGENCE (priority: 24-30)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 19: ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ñ Ğ¸ ĞµĞ´Ñ‹
    const mealsWithMood = (day?.meals || []).filter(m => m.mood > 0 && m.items?.length > 0);
    
    if (mealsWithMood.length >= 2) {
      const moodDropMeal = mealsWithMood.find((m, i) => {
        if (i === 0) return false;
        return m.mood < mealsWithMood[i - 1].mood - 1; // ĞŸĞ°Ğ´ĞµĞ½Ğ¸Ğµ Ğ½Ğ° 2+
      });
      
      if (moodDropMeal) {
        const prevMealIdx = mealsWithMood.indexOf(moodDropMeal) - 1;
        const prevMeal = mealsWithMood[prevMealIdx];
        
        // ĞœĞ½Ğ¾Ğ³Ğ¾ ÑĞ°Ñ…Ğ°Ñ€Ğ° Ğ² Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¼ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğµ?
        let prevSimple = 0;
        for (const item of prevMeal.items || []) {
          const product = pIndex?.byId?.get(item.product_id);
          if (product) prevSimple += (product.simple100 || 0) * (item.grams || 100) / 100;
        }
        
        if (prevSimple > 30) {
          advices.push({
            id: 'sugar_mood_crash',
            icon: 'ğŸ¢',
            text: 'Ğ—Ğ°Ğ¼ĞµÑ‚Ğ¸Ğ»? ĞŸĞ¾ÑĞ»Ğµ ÑĞ»Ğ°Ğ´ĞºĞ¾Ğ³Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ğ°Ğ´Ğ°Ñ‚ÑŒ',
            details: 'ğŸ“‰ Ğ­Ñ‚Ğ¾ "ÑĞ°Ñ…Ğ°Ñ€Ğ½Ñ‹Ğµ Ğ³Ğ¾Ñ€ĞºĞ¸": Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑĞºĞ°Ñ‡Ğ¾Ğº Ğ³Ğ»ÑĞºĞ¾Ğ·Ñ‹ â†’ Ğ¸Ğ½ÑÑƒĞ»Ğ¸Ğ½ â†’ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸. Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑƒĞ³Ğ»ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ´Ğ°ÑÑ‚ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½ÑƒÑ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ.',
            type: 'insight',
            priority: 24,
            category: 'emotional',
            triggers: ['tab_open'],
            ttl: 6000
          });
        }
      }
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 20: Wellbeing Ğ¸ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ
    const avgWellbeing = calculateAverageWellbeing(day);
    
    // ĞŸĞ»Ğ¾Ñ…Ğ¾Ğµ ÑĞ°Ğ¼Ğ¾Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ğµ + Ğ¼Ğ°Ğ»Ğ¾ ĞµĞ´Ñ‹ â€” Ğ¿Ğ¾ĞµÑÑ‚ÑŒ!
    if (avgWellbeing > 0 && avgWellbeing < 3 && kcalPct < 0.4 && hour >= 12) {
      advices.push({
        id: 'wellbeing_low_food',
        icon: 'ğŸ½ï¸',
        text: 'Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ°Ğ¼Ğ¾Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ ĞµĞ´Ñ‹',
        details: 'ğŸ§  ĞœĞ¾Ğ·Ğ³Ñƒ Ğ½ÑƒĞ¶Ğ½Ğ° Ğ³Ğ»ÑĞºĞ¾Ğ·Ğ°! ĞĞ¸Ğ·ĞºĞ¸Ğ¹ ÑĞ°Ñ…Ğ°Ñ€ Ğ² ĞºÑ€Ğ¾Ğ²Ğ¸ = ÑƒÑÑ‚Ğ°Ğ»Ğ¾ÑÑ‚ÑŒ, Ñ€Ğ°Ğ·Ğ´Ñ€Ğ°Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ, ÑĞ»Ğ°Ğ±Ğ¾ÑÑ‚ÑŒ. ĞŸĞ¾ĞµÑˆÑŒ â€” ÑÑ‚Ğ°Ğ½ĞµÑ‚ Ğ»ĞµĞ³Ñ‡Ğµ.',
        type: 'tip',
        priority: 29,
        category: 'emotional',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğµ ÑĞ°Ğ¼Ğ¾Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ğµ â€” Ğ·Ğ°ĞºÑ€ĞµĞ¿Ğ¸Ñ‚ÑŒ
    if (avgWellbeing >= 4 && kcalPct >= 0.8 && kcalPct <= 1.1) {
      advices.push({
        id: 'wellbeing_nutrition_link',
        icon: 'âœ¨',
        text: 'Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞµĞµ ÑĞ°Ğ¼Ğ¾Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ğµ + Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ â€” Ğ·Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸ ÑÑ‚Ğ¾Ñ‚ Ğ´ĞµĞ½ÑŒ!',
        details: 'ğŸ“ Ğ—Ğ°Ğ¿Ğ¸ÑˆĞ¸, Ñ‡Ñ‚Ğ¾ ĞµĞ» ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ! ĞšĞ¾Ğ³Ğ´Ğ° Ğ½Ğ°Ğ¹Ğ´Ñ‘ÑˆÑŒ ÑĞ²Ğ¾Ğ¹ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½ â€” Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ¹ ĞµĞ³Ğ¾.',
        type: 'insight',
        priority: 45,
        category: 'emotional',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 34: dayScore â€” Ğ¾Ñ†ĞµĞ½ĞºĞ° Ğ´Ğ½Ñ
    const dayScore = day?.dayScore ? +day.dayScore : 0;
    
    // ĞŸĞ»Ğ¾Ñ…Ğ¾Ğ¹ Ğ´ĞµĞ½ÑŒ â€” Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°
    if (dayScore > 0 && dayScore < 5 && hour >= 20) {
      advices.push({
        id: 'day_score_low',
        icon: 'ğŸ’™',
        text: 'ĞĞµ Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ Ğ´ĞµĞ½ÑŒ? Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ° Ğ±ÑƒĞ´ĞµÑ‚ Ğ»ÑƒÑ‡ÑˆĞµ!',
        details: 'ğŸ§¡ ĞŸĞ»Ğ¾Ñ…Ğ¸Ğµ Ğ´Ğ½Ğ¸ Ğ±Ñ‹Ğ²Ğ°ÑÑ‚ Ñƒ Ğ²ÑĞµÑ…. Ğ’Ğ°Ğ¶Ğ½Ğ¾ Ğ½Ğµ ÑĞ´Ğ°Ğ²Ğ°Ñ‚ÑŒÑÑ. Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹ ÑĞ¾Ğ½ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ â€” Ğ¸ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ° Ğ±ÑƒĞ´ĞµÑ‚ Ğ»ÑƒÑ‡ÑˆĞµ.',
        type: 'tip',
        priority: 27,
        category: 'emotional',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ â€” Ğ¿Ğ¾Ñ…Ğ²Ğ°Ğ»Ğ°
    if (dayScore >= 8 && hour >= 20) {
      advices.push({
        id: 'day_score_high',
        icon: 'â­',
        text: 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ° Ğ´Ğ½Ñ! Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸ ÑÑ‚Ğ¾ Ğ¾Ñ‰ÑƒÑ‰ĞµĞ½Ğ¸Ğµ',
        details: 'ğŸ† Ğ”Ğ½Ğ¸ Ñ Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğ¹ Ğ¾Ñ†ĞµĞ½ĞºĞ¾Ğ¹ â€” ÑÑ‚Ğ°Ğ»Ğ¾Ğ½ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ°Ğ¶Ğ°Ğ½Ğ¸Ñ. Ğ§Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°Ğ» ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ? ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°!',
        type: 'achievement',
        priority: 8,
        category: 'achievement',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 47: ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾ÑĞ»Ğµ ĞµĞ´Ñ‹
    const allMeals = day?.meals || [];
    const mealsWithMoodData = allMeals.filter(m => m.mood > 0 && m.items?.length > 0);
    
    if (mealsWithMoodData.length >= 2 && !sessionStorage.getItem('heys_mood_improving')) {
      const prevMealMood = mealsWithMoodData[mealsWithMoodData.length - 2]?.mood || 0;
      const currentMealMood = mealsWithMoodData[mealsWithMoodData.length - 1]?.mood || 0;
      
      if (prevMealMood > 0 && currentMealMood > prevMealMood) {
        advices.push({
          id: 'mood_improving',
          icon: 'ğŸ“ˆ',
          text: 'ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾ÑĞ»Ğµ ĞµĞ´Ñ‹ â€” Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½!',
          details: 'ğŸ§  Ğ•Ğ´Ğ° Ğ²Ğ»Ğ¸ÑĞµÑ‚ Ğ½Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· ÑĞµÑ€Ğ¾Ñ‚Ğ¾Ğ½Ğ¸Ğ½ Ğ¸ Ğ´Ğ¾Ñ„Ğ°Ğ¼Ğ¸Ğ½. Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ¹ ÑƒĞ´Ğ°Ñ‡Ğ½Ñ‹Ğµ ÑĞ¾Ñ‡ĞµÑ‚Ğ°Ğ½Ğ¸Ñ!',
          type: 'insight',
          priority: 45,
          category: 'correlation',
          triggers: ['product_added'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_mood_improving', '1'); } catch(e) {} }
        });
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ“Š BEHAVIORAL PATTERNS (priority: 7-39)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 48: Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ 3 Ğ´Ğ½Ñ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´
    const recentForTraining = getRecentDays(2); // Ğ’Ñ‡ĞµÑ€Ğ° Ğ¸ Ğ¿Ğ¾Ğ·Ğ°Ğ²Ñ‡ĞµÑ€Ğ°
    const todayHasTraining = (day?.trainings || []).some(t => t.z?.some(m => m > 0));
    
    if (todayHasTraining && recentForTraining.length >= 2 && !sessionStorage.getItem('heys_workout_consistent')) {
      const allThreeHaveTraining = recentForTraining.every(d => 
        (d.trainings || []).some(t => t.z?.some(m => m > 0))
      );
      
      if (allThreeHaveTraining) {
        advices.push({
          id: 'workout_consistent',
          icon: 'ğŸ”¥',
          text: '3 Ğ´Ğ½Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº Ğ¿Ğ¾Ğ´Ñ€ÑĞ´! Ğ¢Ñ‹ Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ° ğŸ’ª',
          details: 'ğŸ¯ Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾ÑÑ‚ÑŒ Ğ²Ğ°Ğ¶Ğ½ĞµĞµ Ğ¸Ğ½Ñ‚ĞµĞ½ÑĞ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸. 3 Ğ´Ğ½Ñ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´ = Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºĞ° Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ!',
          type: 'achievement',
          priority: 7,
          category: 'achievement',
          triggers: ['tab_open'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_workout_consistent', '1'); } catch(e) {} }
        });
      }
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 49: ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ¿Ğ¾Ğ·Ğ´Ğ½Ğ¸Ñ… ÑƒĞ¶Ğ¸Ğ½Ğ¾Ğ² (3 Ğ´Ğ½Ñ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´)
    const lastEvensCheck = localStorage.getItem('heys_evening_snacker_check');
    const weekAgoPattern = Date.now() - 7 * 24 * 60 * 60 * 1000;
    
    if (!lastEvensCheck || +lastEvensCheck < weekAgoPattern) {
      const recentForPattern = getRecentDays(3);
      
      if (recentForPattern.length >= 3) {
        const allLateEaters = recentForPattern.every(d => {
          const dayMeals = (d.meals || []).filter(m => m.items?.length > 0);
          if (dayMeals.length === 0) return false;
          const times = dayMeals.map(m => m.time || '12:00').sort();
          const lastTime = times[times.length - 1];
          const [h] = lastTime.split(':').map(Number);
          return h >= 22;
        });
        
        if (allLateEaters) {
          advices.push({
            id: 'evening_snacker',
            icon: 'ğŸŒ™',
            text: 'Ğ—Ğ°Ğ¼ĞµÑ‚Ğ¸Ğ» Ñ‚Ñ€ĞµĞ½Ğ´ â€” Ñ‚Ñ‹ Ñ‡Ğ°ÑÑ‚Ğ¾ ÑƒĞ¶Ğ¸Ğ½Ğ°ĞµÑˆÑŒ Ğ¿Ğ¾Ğ·Ğ´Ğ½Ğ¾. ĞœĞ¾Ğ¶ĞµÑ‚, Ğ¿ĞµÑ€ĞµĞºÑƒÑ Ñ€Ğ°Ğ½ÑŒÑˆĞµ?',
            details: 'ğŸ’¡ ĞŸĞ¾Ğ·Ğ´Ğ½Ğ¸Ğµ ÑƒĞ¶Ğ¸Ğ½Ñ‹ ÑƒÑ…ÑƒĞ´ÑˆĞ°ÑÑ‚ ÑĞ¾Ğ½ Ğ¸ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ ÑƒĞ¶Ğ¸Ğ½Ğ°Ñ‚ÑŒ Ğ´Ğ¾ 20:00.',
            type: 'insight',
            priority: 38,
            category: 'correlation',
            triggers: ['tab_open'],
            ttl: 6000,
            onShow: () => { 
              try { localStorage.setItem('heys_evening_snacker_check', Date.now().toString()); } catch(e) {} 
            }
          });
        }
      }
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 50: ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ±ĞµĞ· Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°ĞºĞ° (3 Ğ´Ğ½Ñ Ğ¿Ğ¾Ğ´Ñ€ÑĞ´)
    const lastSkipCheck = localStorage.getItem('heys_morning_skipper_check');
    
    if (!lastSkipCheck || +lastSkipCheck < weekAgoPattern) {
      const recentForSkip = getRecentDays(3);
      
      if (recentForSkip.length >= 3) {
        const allSkipBreakfast = recentForSkip.every(d => {
          const dayMeals = (d.meals || []).filter(m => m.items?.length > 0);
          if (dayMeals.length === 0) return true; // ĞĞµÑ‚ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ¾Ğ² = Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ğ»
          const times = dayMeals.map(m => m.time || '12:00').sort();
          const firstTime = times[0];
          const [h] = firstTime.split(':').map(Number);
          return h >= 11; // ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ Ğ¿Ğ¾ÑĞ»Ğµ 11:00
        });
        
        if (allSkipBreakfast) {
          advices.push({
            id: 'morning_skipper',
            icon: 'ğŸ¤”',
            text: 'Ğ£Ğ¶Ğµ 3 Ğ´Ğ½Ñ Ğ±ĞµĞ· Ñ€Ğ°Ğ½Ğ½ĞµĞ³Ğ¾ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°ĞºĞ° â€” ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€ÑƒĞµÑˆÑŒ Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ°Ğ½Ğ¸ĞµĞ¼?',
            details: 'ğŸ¥ Ğ•ÑĞ»Ğ¸ 16/8 â€” Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ â€” Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ±Ğ¾Ğ»Ğ¸Ğ·Ğ¼.',
            type: 'insight',
            priority: 39,
            category: 'correlation',
            triggers: ['tab_open'],
            ttl: 6000,
            onShow: () => { 
              try { localStorage.setItem('heys_morning_skipper_check', Date.now().toString()); } catch(e) {} 
            }
          });
        }
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸŒŸ PERSONALIZATION TIPS (priority: 54-56)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 26: Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ¿Ğ¾Ğ»Ñƒ
    const isFemale = prof?.gender === 'Ğ–ĞµĞ½ÑĞºĞ¸Ğ¹';
    
    if (isFemale && mealCount >= 2) {
      // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² Ğ±Ğ¾Ğ³Ğ°Ñ‚Ñ‹Ñ… Ğ¶ĞµĞ»ĞµĞ·Ğ¾Ğ¼
      const ironRichKeywords = ['Ğ¼ÑÑĞ¾', 'Ğ¿ĞµÑ‡ĞµĞ½ÑŒ', 'Ğ³Ğ¾Ğ²ÑĞ´Ğ¸Ğ½Ğ°', 'Ğ³Ñ€ĞµÑ‡ĞºĞ°', 'ÑˆĞ¿Ğ¸Ğ½Ğ°Ñ‚', 'Ñ‡ĞµÑ‡ĞµĞ²Ğ¸Ñ†Ğ°'];
      const allItemsP = (day?.meals || []).flatMap(m => m.items || []);
      const hasIronRichFood = allItemsP.some(item => {
        const product = pIndex?.byId?.get(item.product_id);
        const name = (product?.name || item.name || '').toLowerCase();
        return ironRichKeywords.some(kw => name.includes(kw));
      });
      
      if (!hasIronRichFood && !sessionStorage.getItem('heys_iron_tip_today')) {
        advices.push({
          id: 'iron_reminder',
          icon: 'ğŸ©¸',
          text: 'ĞĞµ Ğ·Ğ°Ğ±Ñ‹Ğ²Ğ°Ğ¹ Ğ¾ Ğ¶ĞµĞ»ĞµĞ·Ğµ â€” Ğ¼ÑÑĞ¾, Ğ¿ĞµÑ‡ĞµĞ½ÑŒ, Ğ³Ñ€ĞµÑ‡ĞºĞ°',
          details: 'ğŸ¦¸â€â™€ï¸ Ğ–ĞµĞ½Ñ‰Ğ¸Ğ½Ğ°Ğ¼ Ğ½ÑƒĞ¶Ğ½Ğ¾ 18Ğ¼Ğ³ Ğ¶ĞµĞ»ĞµĞ·Ğ°/Ğ´ĞµĞ½ÑŒ (Ğ¼ÑƒĞ¶Ñ‡Ğ¸Ğ½Ğ°Ğ¼ 8Ğ¼Ğ³). Ğ›Ğ¸Ğ´ĞµÑ€Ñ‹: Ğ¿ĞµÑ‡ĞµĞ½ÑŒ, ĞºÑ€Ğ°ÑĞ½Ğ¾Ğµ Ğ¼ÑÑĞ¾, Ñ‡ĞµÑ‡ĞµĞ²Ğ¸Ñ†Ğ°, ÑˆĞ¿Ğ¸Ğ½Ğ°Ñ‚.',
          type: 'tip',
          priority: 55,
          category: 'personalized',
          triggers: ['tab_open'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_iron_tip_today', '1'); } catch(e) {} }
        });
      }
    }
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 27: Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚Ñƒ
    const age = prof?.age || 30;
    const proteinPctAge = (dayTot?.prot || 0) / ((normAbs?.prot || 100) || 1);
    
    if (age >= 40 && proteinPctAge < 0.9) {
      advices.push({
        id: 'age_protein',
        icon: 'ğŸ’ª',
        text: 'ĞŸĞ¾ÑĞ»Ğµ 40 Ğ²Ğ°Ğ¶Ğ½Ğ¾ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ±ĞµĞ»ĞºĞ° â€” ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¼Ñ‹ÑˆÑ†Ñ‹',
        details: 'ğŸ“Š ĞŸĞ¾ÑĞ»Ğµ 40 Ğ¼Ñ‹ÑˆĞµÑ‡Ğ½Ğ°Ñ Ğ¼Ğ°ÑÑĞ° Ñ‚ĞµÑ€ÑĞµÑ‚ÑÑ Ğ½Ğ° 3-5% Ğ·Ğ° Ğ´ĞµÑÑÑ‚Ğ¸Ğ»ĞµÑ‚Ğ¸Ğµ. Ğ‘ĞµĞ»Ğ¾Ğº 1.5-2Ğ³/ĞºĞ³ + ÑĞ¸Ğ»Ğ¾Ğ²Ñ‹Ğµ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ = ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ñ„Ğ¾Ñ€Ğ¼Ñ‹.',
        type: 'tip',
        priority: 54,
        category: 'personalized',
        triggers: ['product_added', 'tab_open'],
        ttl: 5000
      });
    }
    
    // young_sleep Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ (Ğ² silent mode)
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ  ACTIVITY TIPS (priority: 48-50)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 21: Ğ”Ğ¾Ğ¼Ğ°ÑˆĞ½ÑÑ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ
    const household = day?.householdMin || 0;
    
    if (household >= 60) {
      const extraKcal = Math.round(household * 3); // ~3 ĞºĞºĞ°Ğ»/Ğ¼Ğ¸Ğ½
      advices.push({
        id: 'household_bonus',
        icon: 'ğŸ ',
        text: `${household} Ğ¼Ğ¸Ğ½ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ â‰ˆ +${extraKcal} ĞºĞºĞ°Ğ» ÑĞ¾Ğ¶Ğ¶ĞµĞ½Ğ¾`,
        details: 'ğŸ§¹ Ğ”Ğ¾Ğ¼Ğ°ÑˆĞ½Ğ¸Ğµ Ğ´ĞµĞ»Ğ° â€” ÑÑ‚Ğ¾ Ñ‚Ğ¾Ğ¶Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ! Ğ£Ğ±Ğ¾Ñ€ĞºĞ° 60 Ğ¼Ğ¸Ğ½ = ~180 ĞºĞºĞ°Ğ».',
        type: 'info',
        priority: 50,
        category: 'activity',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // ĞĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ²ĞµÑÑŒ Ğ´ĞµĞ½ÑŒ
    const stepsDay = day?.steps || 0;
    if (household === 0 && stepsDay < 3000 && !hasTraining && hour >= 18) {
      advices.push({
        id: 'sedentary_day',
        icon: 'ğŸš¶',
        text: 'ĞœĞ°Ğ»Ğ¾Ğ¿Ğ¾Ğ´Ğ²Ğ¸Ğ¶Ğ½Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ â€” Ğ¿Ñ€Ğ¾Ğ³ÑƒĞ»ÑĞ¹ÑÑ 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚',
        details: 'ğŸ¯ 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ñ…Ğ¾Ğ´ÑŒĞ±Ñ‹ = ~50-70 ĞºĞºĞ°Ğ» + ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ñ Ğ¸ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ° ÑĞ½Ğ°. Ğ”Ğ°Ğ¶Ğµ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ°Ñ Ğ¿Ñ€Ğ¾Ğ³ÑƒĞ»ĞºĞ° Ğ»ÑƒÑ‡ÑˆĞµ, Ñ‡ĞµĞ¼ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾!',
        type: 'tip',
        priority: 48,
        category: 'activity',
        triggers: ['tab_open'],
        ttl: 5000
      });
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ¥— SMART PRODUCT CATEGORIES (NEW!)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (mealCount >= 2) {
      const categories = analyzeProductCategories(day, pIndex);
      
      // ĞĞµÑ‚ Ğ¾Ğ²Ğ¾Ñ‰ĞµĞ¹
      if (categories.missing.includes('vegetables') && !sessionStorage.getItem('heys_veggies_tip')) {
        const config = PRODUCT_CATEGORIES.vegetables;
        advices.push({
          id: 'missing_vegetables',
          icon: config.icon,
          text: config.advice,
          details: 'ğŸ¥— ĞĞ²Ğ¾Ñ‰Ğ¸ = ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ° + Ğ²Ğ¸Ñ‚Ğ°Ğ¼Ğ¸Ğ½Ñ‹ + ÑÑ‹Ñ‚Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼Ğµ ĞºĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ ÑĞ°Ğ»Ğ°Ñ‚ Ğ¸Ğ»Ğ¸ Ğ¾Ğ²Ğ¾Ñ‰Ğ¸ Ğ² Ğ±Ğ»ÑĞ´Ğ¾.',
          type: 'tip',
          priority: 52,
          category: 'nutrition',
          triggers: ['tab_open', 'product_added'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_veggies_tip', '1'); } catch(e) {} }
        });
      }
      
      // ĞĞµÑ‚ Ğ¼Ğ¾Ğ»Ğ¾Ñ‡ĞºĞ¸
      if (categories.missing.includes('dairy') && !sessionStorage.getItem('heys_dairy_tip')) {
        const config = PRODUCT_CATEGORIES.dairy;
        advices.push({
          id: 'missing_dairy',
          icon: config.icon,
          text: config.advice,
          details: 'ğŸ§€ ĞœĞ¾Ğ»Ğ¾Ñ‡ĞºĞ° = ĞºĞ°Ğ»ÑŒÑ†Ğ¸Ğ¹ + Ğ±ĞµĞ»Ğ¾Ğº + Ğ¿Ñ€Ğ¾Ğ±Ğ¸Ğ¾Ñ‚Ğ¸ĞºĞ¸ (Ğ¹Ğ¾Ğ³ÑƒÑ€Ñ‚). Ğ”Ğ»Ñ ĞºĞ¾ÑÑ‚ĞµĞ¹ Ğ¸ Ğ¼Ñ‹ÑˆÑ†.',
          type: 'tip',
          priority: 53,
          category: 'nutrition',
          triggers: ['tab_open'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_dairy_tip', '1'); } catch(e) {} }
        });
      }
      
      // Ğ•ÑÑ‚ÑŒ Ğ¾Ğ²Ğ¾Ñ‰Ğ¸ â€” Ğ¿Ğ¾Ñ…Ğ²Ğ°Ğ»Ğ¸Ñ‚ÑŒ
      if (categories.present.has('vegetables') && (categories.counts.get('vegetables') || 0) >= 3) {
        advices.push({
          id: 'good_vegetables',
          icon: 'ğŸ¥—',
          text: 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾ Ñ Ğ¾Ğ²Ğ¾Ñ‰Ğ°Ğ¼Ğ¸ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ! ğŸŒ±',
          details: 'ğŸŒˆ 3+ Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ğ¸ Ğ¾Ğ²Ğ¾Ñ‰ĞµĞ¹ Ğ² Ğ´ĞµĞ½ÑŒ ÑĞ½Ğ¸Ğ¶Ğ°ÑÑ‚ Ñ€Ğ¸ÑĞº Ñ…Ñ€Ğ¾Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ·Ğ°Ğ±Ğ¾Ğ»ĞµĞ²Ğ°Ğ½Ğ¸Ğ¹ Ğ½Ğ° 25%.',
          type: 'achievement',
          priority: 65,
          category: 'achievement',
          triggers: ['product_added'],
          ttl: 4000
        });
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ“Š DAY FORECAST (NEW!)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (hour >= 11 && hour <= 18 && mealCount >= 1 && !sessionStorage.getItem('heys_forecast_shown')) {
      const forecast = getDayForecast(kcalPct, hour, mealCount);
      
      if (forecast && forecast.trend !== 'on_track') {
        advices.push({
          id: 'day_forecast',
          icon: forecast.trend === 'under' ? 'ğŸ“‰' : 'ğŸ“ˆ',
          text: forecast.message,
          details: 'ğŸ”® ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ· Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ñ‚ĞµĞ¼Ğ¿Ğ°. ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ¾ ĞºĞ¾Ğ½Ñ†Ğ° Ğ´Ğ½Ñ.',
          type: 'insight',
          priority: 42,
          category: 'nutrition',
          triggers: ['tab_open'],
          ttl: 6000,
          onShow: () => { try { sessionStorage.setItem('heys_forecast_shown', '1'); } catch(e) {} }
        });
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ“… WEEKLY COMPARISON (NEW!)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (!sessionStorage.getItem('heys_weekly_comparison')) {
      const weekComp = getWeeklyComparison();
      
      if (weekComp?.message) {
        advices.push({
          id: 'weekly_comparison',
          icon: 'ğŸ“Š',
          text: weekComp.message,
          details: 'ğŸ“… Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ¹ Ğ½ĞµĞ´ĞµĞ»ĞµĞ¹ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¸ Ñ‚Ñ€ĞµĞ½Ğ´Ñ‹.',
          type: 'achievement',
          priority: 15,
          category: 'achievement',
          triggers: ['tab_open'],
          ttl: 6000,
          onShow: () => { try { sessionStorage.setItem('heys_weekly_comparison', '1'); } catch(e) {} }
        });
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ® STREAK GAMIFICATION (NEW!)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (currentStreak > 0 && currentStreak < 30 && !sessionStorage.getItem('heys_streak_hint')) {
      const milestone = getNextStreakMilestone(currentStreak);
      
      if (milestone && milestone.remain <= 3) {
        advices.push({
          id: 'streak_hint',
          icon: milestone.icon,
          text: milestone.text,
          details: 'ğŸ”¥ ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² Ğ½Ğ¾Ñ€Ğ¼Ğµ ÑƒĞºÑ€ĞµĞ¿Ğ»ÑĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºÑƒ. ĞĞµ ÑĞ´Ğ°Ğ²Ğ°Ğ¹ÑÑ!',
          type: 'motivation',
          priority: 20,
          category: 'gamification',
          triggers: ['tab_open'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_streak_hint', '1'); } catch(e) {} }
        });
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ“‹ WEEKLY SUMMARY (Ğ²Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ Ğ²ĞµÑ‡ĞµÑ€) (NEW!)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (hour >= 18 && !sessionStorage.getItem('heys_weekly_summary')) {
      const summary = getWeeklySummary();
      
      if (summary) {
        advices.push({
          id: 'weekly_summary',
          icon: 'ğŸ“‹',
          text: summary.message,
          details: 'ğŸ“ˆ ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ½ĞµĞ´ĞµĞ»Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ ÑƒĞ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¸ ÑĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ»Ğ°Ğ½.',
          type: 'insight',
          priority: 10,
          category: 'lifestyle',
          triggers: ['tab_open'],
          ttl: 8000,
          onShow: () => { try { sessionStorage.setItem('heys_weekly_summary', '1'); } catch(e) {} }
        });
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ”— ADVICE CHAINS â€” Follow-up ÑĞ¾Ğ²ĞµÑ‚Ñ‹ (NEW!)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ chain Ğ´Ğ»Ñ protein_low
    const proteinChain = checkAdviceChain('protein_low');
    if (proteinChain?.ready && proteinPct < 0.8) {
      advices.push({
        id: 'protein_sources',
        icon: 'ğŸ—',
        text: 'Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ±ĞµĞ»ĞºĞ°: ĞºÑƒÑ€Ğ¸Ñ†Ğ°, Ñ€Ñ‹Ğ±Ğ°, Ñ‚Ğ²Ğ¾Ñ€Ğ¾Ğ³, ÑĞ¹Ñ†Ğ°, Ğ±Ğ¾Ğ±Ñ‹',
        details: 'ğŸ¥© Ğ”Ğ»Ñ Ğ¼Ñ‹ÑˆÑ†: 1.6-2Ğ³ Ğ±ĞµĞ»ĞºĞ°/ĞºĞ³ Ğ²ĞµÑĞ°. Ğ Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸ Ğ½Ğ° 3-4 Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°.',
        type: 'tip',
        priority: 40,
        category: 'nutrition',
        triggers: ['tab_open'],
        ttl: 6000
      });
    }
    
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ chain Ğ´Ğ»Ñ fiber_low
    const fiberChain = checkAdviceChain('fiber_low');
    if (fiberChain?.ready && fiberPct < 0.5) {
      advices.push({
        id: 'fiber_sources',
        icon: 'ğŸ¥¦',
        text: 'ĞšĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ°: Ğ¾Ğ²ÑÑĞ½ĞºĞ°, ÑĞ±Ğ»Ğ¾ĞºĞ¸, Ğ±Ñ€Ğ¾ĞºĞºĞ¾Ğ»Ğ¸, Ñ„Ğ°ÑĞ¾Ğ»ÑŒ',
        details: 'ğŸŒ¿ 25-30Ğ³ ĞºĞ»ĞµÑ‚Ñ‡Ğ°Ñ‚ĞºĞ¸/Ğ´ĞµĞ½ÑŒ â€” Ğ¸Ğ´ĞµĞ°Ğ». Ğ¯Ğ±Ğ»Ğ¾ĞºĞ¾ = 4Ğ³, Ğ¾Ğ²ÑÑĞ½ĞºĞ° = 10Ğ³.',
        type: 'tip',
        priority: 41,
        category: 'nutrition',
        triggers: ['tab_open'],
        ttl: 6000
      });
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ† COMBO ACHIEVEMENTS (NEW!)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (!sessionStorage.getItem('heys_combo_checked')) {
      const combo = checkComboAchievements(ctx);
      
      if (combo) {
        advices.push({
          id: 'combo_' + combo.id,
          icon: combo.icon,
          text: combo.text,
          type: 'achievement',
          priority: 5, // Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚
          category: 'achievement',
          triggers: ['tab_open'],
          ttl: 8000,
          onShow: () => {
            markComboShown(combo.id);
            try { sessionStorage.setItem('heys_combo_checked', '1'); } catch(e) {}
          }
        });
      }
      try { sessionStorage.setItem('heys_combo_checked', '1'); } catch(e) {}
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ§  SMART RECOMMENDATIONS (NEW!)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    if (!sessionStorage.getItem('heys_smart_rec_shown')) {
      const recommendation = getSmartRecommendation(hour);
      
      if (recommendation) {
        advices.push({
          id: 'smart_recommendation',
          icon: 'ğŸ’¡',
          text: recommendation.message,
          details: 'ğŸ¯ ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚Ğ²Ğ¾Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ².',
          type: 'tip',
          priority: 35,
          category: 'personalized',
          triggers: ['tab_open'],
          ttl: 5000,
          onShow: () => { try { sessionStorage.setItem('heys_smart_rec_shown', '1'); } catch(e) {} }
        });
      }
    }
    
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ¯ APPLY DISMISS PENALTY & DYNAMIC TTL (NEW!)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ penalty Ğº Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñƒ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¹
    for (const advice of advices) {
      const penalty = getDismissPenalty(advice.id);
      if (penalty < 1) {
        advice.priority = Math.round(advice.priority / penalty); // Ğ’Ñ‹ÑˆĞµ priority = Ğ½Ğ¸Ğ¶Ğµ Ğ² ÑĞ¿Ğ¸ÑĞºĞµ
      }
      
      // ĞŸĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ TTL Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ´Ğ»Ğ¸Ğ½Ñ‹ Ñ‚ĞµĞºÑÑ‚Ğ°
      if (!advice.ttl || advice.ttl === 5000) { // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¾Ğ³Ğ¾ TTL
        const isCritical = advice.type === 'critical' || advice.canSkipCooldown;
        advice.ttl = calculateDynamicTTL(advice.text, isCritical);
      }
    }
    
    return advices;
  }
  
  /**
   * Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Ñ‡Ğ°ÑÑ‹ ÑĞ½Ğ°
   * @param {Object} day
   * @returns {number}
   */
  function calculateSleepHours(day) {
    if (!day?.sleepStart || !day?.sleepEnd) return 0;
    
    const [startH, startM] = day.sleepStart.split(':').map(Number);
    const [endH, endM] = day.sleepEnd.split(':').map(Number);
    
    let hours = endH - startH;
    let mins = endM - startM;
    
    // Ğ•ÑĞ»Ğ¸ Ğ»ĞµĞ³Ğ»Ğ¸ Ğ²Ñ‡ĞµÑ€Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ 23:00 â†’ 07:00)
    if (hours < 0) hours += 24;
    
    return hours + mins / 60;
  }
  
  /**
   * Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ N Ğ´Ğ½ĞµĞ¹ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ Ğ¸Ğ· localStorage
   * @param {number} n - ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ½ĞµĞ¹ Ğ½Ğ°Ğ·Ğ°Ğ´
   * @returns {Array<{date: string, [key: string]: any}>} ĞœĞ°ÑÑĞ¸Ğ² Ğ´Ğ½ĞµĞ¹ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
   */
  function getRecentDays(n) {
    // ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚: HEYS.utils (Ñ namespace) â†’ HEYS.dayUtils â†’ fallback
    const lsGet = (window.HEYS?.utils?.lsGet) || (window.HEYS?.dayUtils?.lsGet) || ((k, d) => {
      try { 
        const v = localStorage.getItem(k);
        return v ? JSON.parse(v) : d; 
      } catch { return d; }
    });
    
    const days = [];
    const today = new Date();
    
    for (let i = 1; i <= n; i++) {
      const d = new Date(today);
      d.setDate(d.getDate() - i);
      const iso = d.toISOString().slice(0, 10);
      const dayData = lsGet('heys_dayv2_' + iso, null);
      
      if (dayData && dayData.date) {
        days.push({ date: iso, ...dayData });
      }
    }
    
    return days;
  }
  
  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ĞºĞ¾Ñ„Ğµ-ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‰Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹ Ğ¿Ğ¾ÑĞ»Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‡Ğ°ÑĞ°
   * @param {Array} meals - ĞœĞ°ÑÑĞ¸Ğ² Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ¾Ğ² Ğ¿Ğ¸Ñ‰Ğ¸ (day.meals)
   * @param {number} afterHour - ĞŸĞ¾ÑĞ»Ğµ ĞºĞ°ĞºĞ¾Ğ³Ğ¾ Ñ‡Ğ°ÑĞ° Ğ¸ÑĞºĞ°Ñ‚ÑŒ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ 16)
   * @param {Object} pIndex - Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² { byId: Map, byName: Map }
   * @returns {boolean} true ĞµÑĞ»Ğ¸ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ ĞºĞ¾Ñ„Ğµ Ğ¿Ğ¾ÑĞ»Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‡Ğ°ÑĞ°
   */
  function hasCoffeeAfterHour(meals, afterHour, pIndex) {
    if (!meals || !Array.isArray(meals)) return false;
    
    const coffeeKeywords = ['ĞºĞ¾Ñ„Ğµ', 'coffee', 'ĞºĞ°Ğ¿ÑƒÑ‡Ğ¸Ğ½Ğ¾', 'Ğ»Ğ°Ñ‚Ñ‚Ğµ', 'Ğ»Ğ°Ñ‚Ğµ', 'Ñ€Ğ°Ñ„', 'Ğ°Ğ¼ĞµÑ€Ğ¸ĞºĞ°Ğ½Ğ¾', 'ÑÑĞ¿Ñ€ĞµÑÑĞ¾', 'Ñ„Ğ»ÑÑ‚', 'Ğ¼Ğ¾ĞºĞºĞ¾', 'Ğ¼Ğ°ĞºĞ¸Ğ°Ñ‚Ğ¾'];
    
    for (const meal of meals) {
      // ĞŸĞ°Ñ€ÑĞ¸Ğ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ°
      if (!meal.time) continue;
      const [h] = meal.time.split(':').map(Number);
      if (h < afterHour) continue;
      
      // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹ Ğ² Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğµ
      for (const item of (meal.items || [])) {
        // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°
        let name = item.name || '';
        if (!name && pIndex?.byId && item.product_id) {
          const product = pIndex.byId.get(item.product_id);
          if (product) name = product.name || '';
        }
        
        // Ğ˜Ñ‰ĞµĞ¼ ĞºĞ¾Ñ„Ğµ-ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°
        const nameLower = name.toLowerCase();
        if (coffeeKeywords.some(kw => nameLower.includes(kw))) {
          return true;
        }
      }
    }
    
    return false;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PHASE 0: MEAL & MILESTONE HELPERS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ ÑÑƒĞ¼Ğ¼Ñ‹ Ğ½ÑƒÑ‚Ñ€Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼Ğ° Ğ¿Ğ¸Ñ‰Ğ¸
   * @param {Object} meal - ĞŸÑ€Ğ¸Ñ‘Ğ¼ Ğ¿Ğ¸Ñ‰Ğ¸ (meal object)
   * @param {Object} pIndex - Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² { byId: Map, byName: Map }
   * @returns {Object|null} { kcal, prot, carbs, simple, complex, fat, good, bad, trans, fiber } Ğ¸Ğ»Ğ¸ null
   */
  function getMealTotals(meal, pIndex) {
    if (!meal || !meal.items || meal.items.length === 0) return null;
    
    // ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ HEYS.models.mealTotals ĞµÑĞ»Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½
    if (window.HEYS?.models?.mealTotals) {
      return window.HEYS.models.mealTotals(meal, pIndex);
    }
    
    // Fallback: Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ ÑĞ°Ğ¼Ğ¸
    const tot = { kcal: 0, prot: 0, carbs: 0, simple: 0, complex: 0, fat: 0, good: 0, bad: 0, trans: 0, fiber: 0 };
    
    for (const item of meal.items) {
      const grams = item.grams || 0;
      if (grams <= 0) continue;
      
      // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚ Ğ¸Ğ· Ğ¸Ğ½Ğ´ĞµĞºÑĞ°
      let product = null;
      if (pIndex?.byId && item.product_id) {
        product = pIndex.byId.get(item.product_id) || pIndex.byId.get(String(item.product_id));
      }
      if (!product) continue;
      
      const ratio = grams / 100;
      tot.kcal += (product.kcal100 || 0) * ratio;
      tot.prot += (product.protein100 || 0) * ratio;
      tot.simple += (product.simple100 || 0) * ratio;
      tot.complex += (product.complex100 || 0) * ratio;
      tot.carbs += ((product.simple100 || 0) + (product.complex100 || 0)) * ratio;
      tot.good += (product.goodFat100 || 0) * ratio;
      tot.bad += (product.badFat100 || 0) * ratio;
      tot.trans += (product.trans100 || 0) * ratio;
      tot.fat += ((product.goodFat100 || 0) + (product.badFat100 || 0) + (product.trans100 || 0)) * ratio;
      tot.fiber += (product.fiber100 || 0) * ratio;
    }
    
    return tot;
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ Ğ¿Ğ¸Ñ‰Ğ¸ Ñ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°Ğ¼Ğ¸
   * @param {Object} day - Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ½Ñ
   * @returns {Object|null} meal Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ¸Ğ»Ğ¸ null
   */
  function getLastMealWithItems(day) {
    const meals = (day?.meals || []).filter(m => m.items?.length > 0);
    return meals.length > 0 ? meals[meals.length - 1] : null;
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ñ‘Ğ¼ Ğ¿Ğ¸Ñ‰Ğ¸ Ñ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°Ğ¼Ğ¸
   * @param {Object} day - Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ½Ñ
   * @returns {Object|null} meal Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ¸Ğ»Ğ¸ null
   */
  function getFirstMealWithItems(day) {
    const meals = (day?.meals || []).filter(m => m.items?.length > 0);
    return meals.length > 0 ? meals[0] : null;
  }
  
  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ±Ñ‹Ğ» Ğ»Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½ milestone (Ğ¿ĞµÑ€ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾)
   * @param {string} id - ID milestone (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ '30_days')
   * @returns {boolean}
   */
  function isMilestoneShown(id) {
    try {
      return localStorage.getItem('heys_milestone_' + id) === '1';
    } catch (e) {
      return false;
    }
  }
  
  /**
   * ĞÑ‚Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ milestone ĞºĞ°Ğº Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ½Ğ½Ñ‹Ğ¹
   * @param {string} id - ID milestone
   */
  function markMilestoneShown(id) {
    try {
      localStorage.setItem('heys_milestone_' + id, '1');
    } catch (e) {
      // Ignore storage errors
    }
  }
  
  /**
   * ĞŸĞ¾Ğ´ÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ² Ğ·Ğ° Ğ´ĞµĞ½ÑŒ
   * @param {Object} day - Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ½Ñ
   * @returns {number}
   */
  function countUniqueProducts(day) {
    const ids = new Set();
    (day?.meals || []).forEach(meal => {
      (meal.items || []).forEach(item => {
        if (item.product_id) ids.add(String(item.product_id));
      });
    });
    return ids.size;
  }
  
  /**
   * ĞŸĞ¾Ğ´ÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¾Ğ±Ñ‰ĞµĞµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ½ĞµĞ¹ Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ² localStorage
   * Ğ£Ñ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ clientId Ğ´Ğ»Ñ multi-client Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°
   * @returns {number}
   */
  function getTotalDaysTracked() {
    try {
      const U = HEYS.utils || {};
      const clientId = U.getCurrentClientId ? U.getCurrentClientId() : '';
      let count = 0;
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.includes('heys_dayv2_')) {
          // Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ clientId, Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‡Ñ‚Ğ¾ ĞºĞ»ÑÑ‡ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ Ñ Ğ½ĞµĞ³Ğ¾
          // Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: {clientId}_heys_dayv2_{date} Ğ¸Ğ»Ğ¸ heys_dayv2_{date}
          if (!clientId || key.startsWith(clientId + '_') || !key.includes('_heys_dayv2_')) {
            count++;
          }
        }
      }
      return count;
    } catch (e) {
      return 0;
    }
  }
  
  /**
   * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ streak Ğ¸Ğ· localStorage
   * @returns {number}
   */
  function getPersonalBestStreak() {
    try {
      return parseInt(localStorage.getItem('heys_best_streak') || '0', 10);
    } catch (e) {
      return 0;
    }
  }
  
  /**
   * ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¹ streak ĞµÑĞ»Ğ¸ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ
   * @param {number} currentStreak - Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ streak
   * @returns {boolean} true ĞµÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´
   */
  function updatePersonalBestStreak(currentStreak) {
    const best = getPersonalBestStreak();
    if (currentStreak > best) {
      try {
        localStorage.setItem('heys_best_streak', String(currentStreak));
      } catch (e) {
        // Ignore storage errors
      }
      return true; // ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµĞºĞ¾Ñ€Ğ´!
    }
    return false;
  }
  
  /**
   * Throttle Ğ´Ğ»Ñ meal-level ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² (3 ÑĞµĞºÑƒĞ½Ğ´Ñ‹ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ¼Ğ¸)
   */
  const MEAL_ADVICE_THROTTLE_MS = 3000;
  
  /**
   * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ meal-level ÑĞ¾Ğ²ĞµÑ‚
   * @returns {boolean}
   */
  function canShowMealAdvice() {
    try {
      const last = sessionStorage.getItem('heys_last_meal_advice');
      return !last || (Date.now() - parseInt(last, 10)) > MEAL_ADVICE_THROTTLE_MS;
    } catch (e) {
      return true;
    }
  }
  
  /**
   * ĞÑ‚Ğ¼ĞµÑ‡Ğ°ĞµÑ‚ Ğ²Ñ€ĞµĞ¼Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° meal-level ÑĞ¾Ğ²ĞµÑ‚Ğ°
   */
  function markMealAdviceShown() {
    try {
      sessionStorage.setItem('heys_last_meal_advice', String(Date.now()));
    } catch (e) {
      // Ignore storage errors
    }
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // REACT HOOK
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  /**
   * React hook Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
   * @param {Object} params
   * @param {Object} params.dayTot - Ğ¡ÑƒĞ¼Ğ¼Ñ‹ Ğ·Ğ° Ğ´ĞµĞ½ÑŒ
   * @param {Object} params.normAbs - ĞĞ¾Ñ€Ğ¼Ñ‹ Ğ² Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ…
   * @param {number} params.optimum - Ğ¦ĞµĞ»ĞµĞ²Ğ¾Ğ¹ ĞºĞ°Ğ»Ğ¾Ñ€Ğ°Ğ¶
   * @param {Object} params.day - Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ½Ñ
   * @param {Map} params.pIndex - Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ²
   * @param {number} params.currentStreak - Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ streak (Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ Ğ¸Ğ· DayTab, ĞĞ• Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ÑÑ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾!)
   * @param {string} params.trigger - Ğ§Ñ‚Ğ¾ Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ»Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ· ('tab_open'|'product_added')
   * @param {Object} params.uiState - Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ UI Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ·Ğ°Ğ½ÑÑ‚Ğ¾ÑÑ‚Ğ¸
   * @param {Object} params.prof - ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (sex, age, weight, sleepHours, insulinWaveHours, deficitPctTarget Ğ¸ Ğ´Ñ€.)
   * @param {number} params.waterGoal - Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ½Ğ¾Ñ€Ğ¼Ğ° Ğ²Ğ¾Ğ´Ñ‹ (Ğ¸Ğ· waterGoalBreakdown)
   * @returns {Object} ĞĞ±ÑŠĞµĞºÑ‚ Ñ ÑĞ¾Ğ²ĞµÑ‚Ğ°Ğ¼Ğ¸ Ğ¸ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ°Ğ¼Ğ¸
   */
  function useAdviceEngine(params) {
    // âš ï¸ Ğ’ĞĞ–ĞĞ: currentStreak Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ ĞºĞ°Ğº Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€, ĞĞ• Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ÑÑ!
    const { dayTot, normAbs, optimum, day, pIndex, currentStreak, trigger, uiState, prof, waterGoal } = params;
    const React = window.React;
    
    // Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
    const ctx = React.useMemo(() => {
      const now = new Date();
      const hour = now.getHours();
      const meals = day?.meals || [];
      const mealCount = meals.filter(m => m.items?.length > 0).length;
      const trainings = day?.trainings || [];
      const hasTraining = trainings.some(t => t.z && t.z.some(m => m > 0));
      
      // ğŸ§  Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
      const kcalPct = (dayTot?.kcal || 0) / (optimum || 2000);
      const tone = getToneForHour(hour);
      const specialDay = getSpecialDay(now);
      
      // ğŸ¯ Goal-aware: Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ğ¾ Ñ†ĞµĞ»Ğ¸ (Ğ´ĞµÑ„Ğ¸Ñ†Ğ¸Ñ‚/Ğ½Ğ°Ğ±Ğ¾Ñ€/Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ)
      const dayDeficit = day?.deficitPct;
      const profileDeficit = prof?.deficitPctTarget;
      const effectiveDeficit = dayDeficit ?? profileDeficit ?? 0;
      const goal = getGoalMode(effectiveDeficit);
      
      const emotionalState = getEmotionalState({
        day,
        currentStreak: currentStreak || 0,
        mealCount,
        kcalPct,
        goal, // ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‘Ğ¼ goal Ğ´Ğ»Ñ goal-aware Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ
        totalDaysTracked: 30 // ĞŸÑ€Ğ¸Ğ±Ğ»Ğ¸Ğ·Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
      });
      
      return {
        dayTot: dayTot || {},
        normAbs: normAbs || {},
        optimum: optimum || 2000,
        day: day || {},
        pIndex: pIndex || { byId: new Map(), byName: new Map() },
        currentStreak: currentStreak || 0,
        hour,
        mealCount,
        hasTraining,
        kcalPct,
        tone,
        specialDay,
        emotionalState,
        prof: prof || {},           // ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        waterGoal: waterGoal || 2000, // ĞĞ¾Ñ€Ğ¼Ğ° Ğ²Ğ¾Ğ´Ñ‹
        goal                         // ğŸ¯ Goal Ñ€ĞµĞ¶Ğ¸Ğ¼ (deficit/bulk/maintenance)
      };
    }, [dayTot, normAbs, optimum, day, pIndex, currentStreak, prof, waterGoal]);
    
    // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ²ÑĞµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
    const allAdvices = React.useMemo(() => {
      const baseAdvices = generateAdvices(ctx);
      
      // ğŸ”— Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ chain follow-ups
      const chainAdvices = generateChainAdvices();
      
      // â° Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
      const scheduledAdvices = getScheduledAdvices();
      
      // ğŸ¯ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ goal-specific ÑĞ¾Ğ²ĞµÑ‚Ñ‹
      const goalAdvices = getGoalSpecificAdvices(ctx.goal);
      
      // ğŸ† ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ personal bests
      const personalBestAdvices = [];
      const todayISO = new Date().toISOString().slice(0, 10);
      
      // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ€ĞµĞºĞ¾Ñ€Ğ´Ñ‹ Ğ¿Ğ¾ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ°Ğ¼
      const proteinPct = (ctx.dayTot?.prot || 0) / (ctx.normAbs?.prot || 100);
      const proteinRecord = checkAndUpdatePersonalBest('proteinPct', proteinPct * 100, todayISO);
      if (proteinRecord?.isNewRecord) {
        const advice = createPersonalBestAdvice('proteinPct', proteinRecord);
        if (advice) personalBestAdvices.push(advice);
      }
      
      const fiberPct = (ctx.dayTot?.fiber || 0) / (ctx.normAbs?.fiber || 25);
      const fiberRecord = checkAndUpdatePersonalBest('fiberPct', fiberPct * 100, todayISO);
      if (fiberRecord?.isNewRecord) {
        const advice = createPersonalBestAdvice('fiberPct', fiberRecord);
        if (advice) personalBestAdvices.push(advice);
      }
      
      // Streak record
      if (ctx.currentStreak > 0) {
        const streakRecord = checkAndUpdatePersonalBest('streak', ctx.currentStreak, todayISO);
        if (streakRecord?.isNewRecord) {
          const advice = createPersonalBestAdvice('streak', streakRecord);
          if (advice) personalBestAdvices.push(advice);
        }
      }
      
      return [
        ...baseAdvices, 
        ...chainAdvices, 
        ...scheduledAdvices, 
        ...goalAdvices,
        ...personalBestAdvices
      ];
    }, [ctx]);
    
    // ğŸ”§ Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ Ğ²ĞºĞ»ÑÑ‡Ñ‘Ğ½Ğ½Ñ‹Ğ¼ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼
    const categoryFilteredAdvices = React.useMemo(() => {
      return allAdvices.filter(a => {
        if (!a.category) return true;
        return isCategoryEnabled(a.category);
      });
    }, [allAdvices]);
    
    // ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ boost Ğ´Ğ»Ñ goal-specific ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
    const boostedAdvices = React.useMemo(() => {
      return applyGoalBoost(categoryFilteredAdvices, ctx.goal);
    }, [categoryFilteredAdvices, ctx.goal]);
    
    // Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼Ñƒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
    const filteredAdvices = React.useMemo(() => {
      return filterByEmotionalState(boostedAdvices, ctx.emotionalState);
    }, [boostedAdvices, ctx.emotionalState]);
    
    // ğŸ­ ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ñ‚ĞµĞºÑÑ‚Ñ‹ Ğ¿Ğ¾Ğ´ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ
    const moodAdaptedAdvices = React.useMemo(() => {
      const avgMood = getAverageMoodToday(ctx.day);
      if (!avgMood || avgMood === 0) return filteredAdvices;
      
      return filteredAdvices.map(advice => {
        const adaptedText = adaptTextToMood(advice.text, avgMood, advice.type);
        if (adaptedText === null) return null; // Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ğ¶Ñ‘ÑÑ‚ĞºĞ¸Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿Ñ€Ğ¸ Ğ¿Ğ»Ğ¾Ñ…Ğ¾Ğ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğ¸
        return { ...advice, text: adaptedText };
      }).filter(Boolean);
    }, [filteredAdvices, ctx.day]);
    
    // Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñƒ (Ğ´Ğ»Ñ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ° Ğ² Ñ€Ğ°Ğ·Ğ²Ñ‘Ñ€Ğ½ÑƒÑ‚Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ â€” Ğ±ĞµĞ· canShowAdvice)
    // Ğ¡Ğ¿ĞµÑ†Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ 'manual' â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ’Ğ¡Ğ• ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ±ĞµĞ· Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñƒ
    const allForTrigger = React.useMemo(() => {
      if (!trigger) return [];
      if (isUserBusy(uiState)) return [];
      
      let advices = moodAdaptedAdvices;
      
      // Manual trigger â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²ÑĞµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
      if (trigger !== 'manual') {
        advices = advices.filter(a => a.triggers.includes(trigger));
      }
      
      // ğŸ§  Smart Prioritization â€” ML-like scoring
      advices = sortBySmartScore(advices, ctx);
      
      // â° ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ
      advices = filterByTimeRestrictions(advices);
      
      // ğŸ”„ Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ â€” Ğ¸Ğ· Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ñ… Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½
      advices = deduplicateAdvices(advices);
      
      // ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ excludes
      advices = filterByExcludes(advices);
      
      // ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼ (Ğ°Ğ½Ñ‚Ğ¸ÑĞ¿Ğ°Ğ¼)
      advices = limitByCategory(advices);
      
      return advices;
    }, [moodAdaptedAdvices, trigger, uiState, ctx]);
    
    // Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ (Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¾Ğ¹ cooldown)
    const relevantAdvices = React.useMemo(() => {
      return allForTrigger.filter(a => canShowAdvice(a.id, { canSkipCooldown: a.canSkipCooldown }));
    }, [allForTrigger]);
    
    // ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ÑĞ¾Ğ²ĞµÑ‚ (Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğ¹)
    const primary = relevantAdvices[0] || null;
    
    // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ animation ĞºĞ»Ğ°ÑÑ
    const primaryWithAnimation = primary ? {
      ...primary,
      animationClass: getAdviceAnimation(primary)
    } : null;
    
    // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ»Ñ badge â€” Ğ’Ğ¡Ğ• ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğ° (Ğ±ĞµĞ· canShowAdvice)
    const adviceCount = allForTrigger.length;
    
    // ğŸ”¢ Badge advices â€” ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ FAB badge (ĞºĞ°Ğº trigger='manual', Ğ½Ğ¾ Ğ±ĞµĞ· Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ trigger)
    // ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ’Ğ¡Ğ• Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹
    const badgeAdvices = React.useMemo(() => {
      if (isUserBusy(uiState)) return [];
      
      let advices = moodAdaptedAdvices;
      
      // ğŸ§  Smart Prioritization
      advices = sortBySmartScore(advices, ctx);
      
      // â° Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ
      advices = filterByTimeRestrictions(advices);
      
      // ğŸ”„ Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
      advices = deduplicateAdvices(advices);
      
      // Excludes
      advices = filterByExcludes(advices);
      
      // Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼
      advices = limitByCategory(advices);
      
      return advices;
    }, [moodAdaptedAdvices, uiState, ctx]);
    
    // ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾Ñ‚Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ñ‹Ñ…
    const scheduledCount = getScheduledCount();
    
    return {
      primary: primaryWithAnimation,
      relevant: allForTrigger, // Ğ’ÑĞµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ²Ñ‘Ñ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ
      adviceCount,
      badgeAdvices, // Ğ”Ğ»Ñ FAB badge â€” Ğ¼Ğ°ÑÑĞ¸Ğ² ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ² Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹
      scheduledCount,
      allAdvices,
      ctx,
      // ĞœĞµÑ‚Ğ¾Ğ´Ñ‹
      markShown: (id) => {
        markAdviceShown(id);
        trackAdviceShown(id); // ğŸ“Š Tracking
      },
      trackClick: trackAdviceClicked, // ğŸ“Š Tracking ĞºĞ»Ğ¸ĞºĞ°
      rateAdvice, // ğŸ‘/ğŸ‘ Rating
      scheduleAdvice, // â° ĞÑ‚Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ²ĞµÑ‚
      canShow: canShowAdvice,
      resetSession: resetSessionAdvices
    };
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EXPORTS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  window.HEYS = window.HEYS || {};
  window.HEYS.advice = {
    useAdviceEngine,
    generateAdvices,
    markShown: markAdviceShown,
    canShow: canShowAdvice,
    resetSessionAdvices,
    // ğŸ¯ Goal-aware helpers
    getGoalMode,
    isInTargetRange,
    isCriticallyOver,
    isCriticallyUnder,
    // ğŸ”§ Filtering & processing
    filterByExcludes,
    limitByCategory,
    applyGoalBoost,
    sortBySmartScore,
    // ğŸ“Š Tracking & Analytics
    trackAdviceShown,
    trackAdviceClicked,
    getAdviceCTR,
    getTopAdvices,
    getTrackingStats,
    // ğŸ‘ğŸ‘ Rating system
    rateAdvice,
    getAdviceRating,
    getAllRatings,
    // ğŸ¨ Text helpers
    personalizeText,
    pickRandomText,
    getTimeBasedText,
    getTimePeriod,
    adaptTextToMood,
    getAverageMoodToday,
    // ğŸ“‹ Config â€” Ğ’ÑĞµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ
    THRESHOLDS,
    SEASONAL_TIPS,
    MAX_ADVICES_PER_CATEGORY,
    PRODUCT_CATEGORIES,
    ADVICE_CHAINS,
    DEDUPLICATION_RULES,    // ğŸ†• Ğ“Ñ€ÑƒĞ¿Ğ¿Ñ‹ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğ¸Ñ… ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ²
    TIME_RESTRICTIONS,      // ğŸ†• Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ
    STREAK_MILESTONES,
    TTL_CONFIG,
    TIME_BASED_TEXTS,
    COMBO_ACHIEVEMENTS,
    MOOD_TONES,
    // ğŸ”§ Filtering functions
    deduplicateAdvices,       // ğŸ†• Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
    filterByTimeRestrictions, // ğŸ†• Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ
    // Helper functions Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
    getToneForHour,
    getEmotionalState,
    getSpecialDay,
    filterByEmotionalState,
    isUserBusy,
    calculateAverageMood,
    calculateAverageStress,
    calculateAverageWellbeing,
    // Phase 0 helpers (Phase 2 ÑĞ¾Ğ²ĞµÑ‚Ñ‹)
    getMealTotals,
    getLastMealWithItems,
    getFirstMealWithItems,
    isMilestoneShown,
    markMilestoneShown,
    countUniqueProducts,
    getTotalDaysTracked,
    getPersonalBestStreak,
    updatePersonalBestStreak,
    canShowMealAdvice,
    markMealAdviceShown,
    getRecentDays,
    // ğŸ†• Phase 3 helpers
    analyzeProductCategories,
    getDayForecast,
    getWeeklyComparison,
    getWeeklySummary,
    getNextStreakMilestone,
    trackDismiss,
    getDismissPenalty,
    calculateDynamicTTL,
    checkAdviceChain,
    markChainStart,
    // ğŸ†• Phase 4 helpers
    checkComboAchievements,
    markComboShown,
    trackProductPattern,
    getSmartRecommendation,
    calculateSmartScore,
    // ğŸ†• Phase 5 helpers
    // Settings
    getAdviceSettings,
    setAdviceSettings,
    isCategoryEnabled,
    toggleCategory,
    CATEGORY_LABELS,
    DEFAULT_ADVICE_SETTINGS,
    // Personal Bests
    getPersonalBests,
    checkAndUpdatePersonalBest,
    createPersonalBestAdvice,
    TRACKABLE_METRICS,
    // Chains
    checkChainContinuation,
    generateChainAdvices,
    // Scheduling
    scheduleAdvice,
    getScheduledAdvices,
    getScheduledCount,
    SNOOZE_OPTIONS,
    // Goal-specific
    getGoalSpecificAdvices,
    GOAL_MODES,
    // Animations
    getAdviceAnimation,
    ADVICE_ANIMATIONS
  };
  
})();
