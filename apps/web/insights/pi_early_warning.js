/**
 * HEYS Predictive Insights ‚Äî Early Warning System v3.2
 * 
 * –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–Ω–¥–æ–≤ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∏ —Å—Ç–∞–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º–æ–π.
 * 
 * v3.1 improvements:
 * - Pipeline logging standard (`ews /` filter: start/input/compute/result/ui)
 * - Actionable Steps (2-3 concrete actions per warning)
 * - Warning Trends tracking (14/30 days frequency)
 * - Priority Queue (severity √ó frequency √ó impact)
 * 
 * –°—Ü–µ–Ω–∞—Ä–∏–∏:
 * 1. Health Score –ø–∞–¥–∞–µ—Ç 3 –¥–Ω—è –ø–æ–¥—Ä—è–¥
 * 2. –ö—Ä–∏—Ç–∏—á–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω (C1-C22) —É—Ö—É–¥—à–∏–ª—Å—è –Ω–∞ 20%+ –∑–∞ 7 –¥–Ω–µ–π OR –Ω–∏–∑–∫–∏–π score
 * 3. Status Score (0-100) –ø–∞–¥–∞–µ—Ç 3 –¥–Ω—è –ø–æ–¥—Ä—è–¥
 * 4. Sleep debt –Ω–∞–∫–æ–ø–∏–ª—Å—è (3+ –¥–Ω—è <7—á)
 * 5. Caloric debt >1500 kcal 2 –¥–Ω—è –ø–æ–¥—Ä—è–¥
 * + 10 –Ω–æ–≤—ã—Ö checks (v2.0-v3.0): Weight Spike, Hydration, Logging Gap, Protein, Stress, Meal Skip, Binge, Mood, Plateau, Weekend
 * 
 * Dependencies: pi_patterns.js, pi_advanced.js, heys_status_v1.js
 * @param global
 */

(function (global) {
    'use strict';

    console.info('[pi_early_warning.js] üöÄ Script execution started');

    const HEYS = global.HEYS = global.HEYS || {};
    HEYS.InsightsPI = HEYS.InsightsPI || {};

    console.info('[pi_early_warning.js] üîß Initializing module...');

    // Thresholds for warnings
    const THRESHOLDS = {
        HEALTH_SCORE_DECLINE_DAYS: 3,
        HEALTH_SCORE_MIN_DELTA: 10, // minimum total drop over N days (positive = decline)
        STATUS_SCORE_DECLINE_DAYS: 3,
        STATUS_SCORE_MIN_DELTA: 10, // minimum total drop over N days (positive = decline)
        CRITICAL_PATTERN_DEGRADATION: -0.2, // -20%
        SLEEP_DEFICIT_DAYS: 3,
        SLEEP_DEFICIT_HOURS: 7,
        CALORIC_DEBT_DAYS: 2,
        CALORIC_DEBT_THRESHOLD: 1500,
        MIN_DAYS_FOR_ANALYSIS: 6  // Temporarily lowered from 7 for testing
    };

    // Critical patterns (C1-C22) that require immediate attention
    // Based on health impact: inflammation, metabolic health, performance
    const CRITICAL_PATTERNS = [
        // C1-C10: Timing & Behavior
        'meal_timing',          // C1: Meal spacing affects insulin
        'wave_overlap',         // C2: Fat burning windows
        'late_eating',          // C3: Sleep & weight impact
        'meal_quality_trend',   // C4: Diet quality trajectory
        'sleep_weight',         // C5: Recovery & metabolism
        'sleep_hunger',         // C6: Appetite regulation
        'training_kcal',        // C7: Energy balance
        'steps_weight',         // C8: NEAT activity
        'protein_satiety',      // C9: Satiety optimization
        'fiber_regularity',     // C10: Gut transit

        // C11-C22: Nutrition Quality (high health impact)
        'nutrition_quality',    // C15: Overall diet quality score
        'omega_balancer',       // C16: Inflammation control
        'protein_distribution', // C17: Muscle protein synthesis
        'training_type_match',  // C19: Performance optimization
        'hydration',            // C20: Basic physiological need
        'gut_health'            // C14: Microbiome & immunity
    ];

    // Low score thresholds for pattern alerts
    const PATTERN_LOW_SCORE_THRESHOLDS = {
        critical: 35,  // Critical patterns below this = high severity warning
        important: 45  // Important patterns below this = medium severity warning
    };

    // Dual-Mode Architecture (v4.0): Acute vs Full mode checks
    // ACUTE mode: 10 checks for badge (‚â§5 day window, current state alerts)
    //   - Focus: immediate actionable signals, hydration, sleep, weight, stress
    //   - Use case: header badge quick glance (7 days data)
    // FULL mode: all 25 checks for insights dashboard (7-30 day patterns, comprehensive audit)
    //   - Focus: accumulated patterns, nutrition quality, trends
    //   - Use case: insights card deep dive (30 days data)
    const ACUTE_CHECK_IDS = [1, 3, 4, 5, 6, 7, 8, 9, 10, 19];

    // localStorage key for warning trends tracking (v3.1)
    const TRENDS_STORAGE_KEY = 'heys_ews_trends_v1';
    const WEEKLY_PROGRESS_STORAGE_KEY = 'heys_ews_weekly_v1';

    // Trends tracking configuration
    const TRENDS_CONFIG = {
        MAX_AGE_DAYS: 30,        // Keep occurrences for 30 days
        FREQUENCY_WINDOW_14D: 14, // Calculate 14-day frequency
        FREQUENCY_WINDOW_30D: 30, // Calculate 30-day frequency
        TOP_CHRONIC_COUNT: 3     // Show top-3 chronic warnings
    };

    // Weekly progress tracking configuration (Wave 3.1)
    const WEEKLY_CONFIG = {
        WEEKS_TO_TRACK: 4,       // Track last 4 weeks
        IMPROVEMENT_THRESHOLD: -15, // -15% warnings = improving
        STABLE_THRESHOLD: 15,    // ¬±15% warnings = stable
        // > 15% warnings = worsening
    };

    // Cloud sync configuration (Wave 3.1 cloud sync)
    const CLOUD_SYNC_CONFIG = {
        ENABLED: true,           // Enable cloud sync
        LOAD_TIMEOUT_MS: 3000,   // Max wait time for cloud load
        SAVE_TIMEOUT_MS: 5000,   // Max wait time for cloud save
        FALLBACK_TO_LOCAL: true  // Use localStorage if cloud fails
    };



    // Health impact scores for priority calculation (0-100 scale)
    // Based on long-term health consequences and scientific evidence
    const HEALTH_IMPACT_SCORES = {
        // High Impact (80-100): Cardiovascular, metabolic, mental health
        SLEEP_DEBT: 95,              // CVD risk +40-80%, metabolic dysfunction
        STRESS_ACCUMULATION: 90,     // CVD risk +40-80%, burnout
        MOOD_WELLBEING_DECLINE: 85,  // Depression risk +60%, chronic stress
        CALORIC_DEBT: 80,            // Metabolic damage, hormone disruption
        BINGE_RISK: 85,              // Obesity +50%, diabetes +35%, depression +60%

        // Medium-High Impact (60-79): Metabolic health, performance
        HEALTH_SCORE_DECLINE: 75,    // Integrates 50+ metrics, multi-system
        STATUS_SCORE_DECLINE: 70,    // Recovery, adaptation, overtraining
        WEIGHT_SPIKE: 65,            // Rapid weight gain, inflammation
        PROTEIN_DEFICIT: 65,         // Muscle loss, satiety issues
        HYDRATION_DEFICIT: 60,       // Basic physiological function

        // Medium Impact (40-59): Behavior patterns
        MEAL_SKIP_PATTERN: 55,       // Metabolic syndrome +25%
        WEEKEND_PATTERN: 50,         // Binge-restrict cycle risk
        LOGGING_GAP: 45,             // Accountability, awareness

        // Lower Impact (20-39): Weight management
        WEIGHT_PLATEAU: 30,          // Adaptation, not health risk

        // Pattern-specific (varies)
        CRITICAL_PATTERN_DEGRADATION: 70,  // Depends on specific pattern

        // NEW v3.2: Advanced Tier (40-80)
        FIBER_DEFICIT: 70,           // Gut health, metabolic
        SODIUM_EXCESS: 55,           // Water retention, BP
        CIRCADIAN_DISRUPTION: 75,    // Sleep quality, hormones
        TRAINING_WITHOUT_RECOVERY: 80, // Overtraining, injury risk
        FAT_QUALITY_DECLINE: 60,     // Inflammation, omega balance
        SUGAR_DEPENDENCY: 65,        // Insulin resistance
        MICRONUTRIENT_GAP: 70,       // Multiple deficiencies
        STEP_DECLINE: 45,            // NEAT reduction
        MEAL_TIMING_DRIFT: 50,       // Circadian alignment
        ELECTROLYTE_IMBALANCE: 60    // Performance, hydration
    };

    // Severity weights for priority calculation
    const SEVERITY_WEIGHTS = {
        high: 3,
        medium: 2,
        low: 1
    };

    // Human-friendly pattern descriptions (v1.0)
    // –§–æ—Ä–º–∞—Ç: –ø—Ä–æ—Å—Ç–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ + –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ + –Ω–∞—É—á–Ω–∞—è –±–∞–∑–∞
    const PATTERN_HUMAN_MESSAGES = {
        // C1-C10: Timing & Behavior
        'meal_timing': {
            title: '–ü—Ä–æ–º–µ–∂—É—Ç–∫–∏ –º–µ–∂–¥—É –µ–¥–æ–π',
            message: '–°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –∏–ª–∏ —Ä–µ–¥–∫–∏–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏ –Ω–∞—Ä—É—à–∞—é—Ç –æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤',
            insight: '–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã 3-5 —á–∞—Å–æ–≤ –º–µ–∂–¥—É –ø—Ä–∏—ë–º–∞–º–∏ –ø–∏—â–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω—Å—É–ª–∏–Ω–∞ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∂–∏—Ä–∞.',
            science: '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ —á–∞—Å—Ç—ã–µ –ø–µ—Ä–µ–∫—É—Å—ã (–∫–∞–∂–¥—ã–µ 1-2 —á–∞—Å–∞) –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–º—É –∏–Ω—Å—É–ª–∏–Ω—É, —á—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ. –î–ª–∏–Ω–Ω—ã–µ –ø—Ä–æ–º–µ–∂—É—Ç–∫–∏ –±–æ–ª–µ–µ 6-7 —á–∞—Å–æ–≤ –≤—ã–∑—ã–≤–∞—é—Ç —á—Ä–µ–∑–º–µ—Ä–Ω—ã–π –≥–æ–ª–æ–¥ –∏ –ø–µ—Ä–µ–µ–¥–∞–Ω–∏–µ.'
        },
        'wave_overlap': {
            title: '–ò–Ω—Å—É–ª–∏–Ω–æ–≤—ã–µ –≤–æ–ª–Ω—ã',
            message: '–ù–æ–≤—ã–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏ –Ω–µ –¥–∞—é—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –ø—Ä–µ–¥—ã–¥—É—â–∏–º ‚Äî –∂–∏—Ä –Ω–µ —Å–∂–∏–≥–∞–µ—Ç—Å—è',
            insight: '–ú–µ–∂–¥—É –ø—Ä–∏—ë–º–∞–º–∏ –ø–∏—â–∏ –Ω—É–∂–Ω–æ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –∏–Ω—Å—É–ª–∏–Ω –≤–µ—Ä–Ω—É–ª—Å—è –∫ –±–∞–∑–æ–≤–æ–º—É —É—Ä–æ–≤–Ω—é –∏ –Ω–∞—á–∞–ª–æ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∂–∏—Ä–æ–≤ –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —ç–Ω–µ—Ä–≥–∏–∏.',
            science: '–ü–æ—Å–ª–µ –µ–¥—ã –∏–Ω—Å—É–ª–∏–Ω –ø–æ–≤—ã—à–∞–µ—Ç—Å—è –Ω–∞ 3-5 —á–∞—Å–æ–≤. –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–∞–Ω—å—à–µ, —á–µ–º –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –ø—Ä–µ–¥—ã–¥—É—â–∞—è ¬´–≤–æ–ª–Ω–∞¬ª, –æ—Ä–≥–∞–Ω–∏–∑–º –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ. –≠—Ç–æ –æ—Å–Ω–æ–≤–∞ –º–µ—Ç–æ–¥–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è.'
        },
        'late_eating': {
            title: '–ü–æ–∑–¥–Ω–∏–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏',
            message: '–ï–¥–∞ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º –º–µ—à–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –∏ –Ω–∞–±–æ—Ä—É –≤–µ—Å–∞',
            insight: '–ü–æ–∑–¥–Ω–∏–µ —É–≥–ª–µ–≤–æ–¥—ã –∏ –±–æ–ª—å—à–∏–µ –ø–æ—Ä—Ü–∏–∏ –∑–∞ 2-3 —á–∞—Å–∞ –¥–æ —Å–Ω–∞ –Ω–∞—Ä—É—à–∞—é—Ç –≤—ã—Ä–∞–±–æ—Ç–∫—É –º–µ–ª–∞—Ç–æ–Ω–∏–Ω–∞ –∏ –≥–æ—Ä–º–æ–Ω–∞ —Ä–æ—Å—Ç–∞, —É—Ö—É–¥—à–∞—é—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞.',
            science: '–ù–æ—á—å—é –æ—Ä–≥–∞–Ω–∏–∑–º –¥–æ–ª–∂–µ–Ω –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è, –∞ –Ω–µ –ø–µ—Ä–µ–≤–∞—Ä–∏–≤–∞—Ç—å –ø–∏—â—É. –ï–¥–∞ –ø–æ–∑–∂–µ 20:00-21:00 —Å–º–µ—â–∞–µ—Ç —Ü–∏—Ä–∫–∞–¥–Ω—ã–µ —Ä–∏—Ç–º—ã, —Å–Ω–∏–∂–∞–µ—Ç —É—Ç—Ä–µ–Ω–Ω—é—é —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –∏–Ω—Å—É–ª–∏–Ω—É –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∏—Å–∫ –Ω–∞–±–æ—Ä–∞ –≤–µ—Å–∞.'
        },
        'meal_quality_trend': {
            title: '–ö–∞—á–µ—Å—Ç–≤–æ –ø–∏—Ç–∞–Ω–∏—è',
            message: '–†–∞—Ü–∏–æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–µ–Ω–µ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º ‚Äî –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤–∞–∂–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤',
            insight: '–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤ ‚Äî –∫–ª—é—á –∫ –∑–¥–æ—Ä–æ–≤—å—é –∏ —ç–Ω–µ—Ä–≥–∏–∏.',
            science: '–ú–æ–Ω–æ—Ç–æ–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –¥–µ—Ñ–∏—Ü–∏—Ç—É –º–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ (30+ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –Ω–µ–¥–µ–ª—é) —Å–≤—è–∑–∞–Ω–æ —Å –ª—É—á—à–∏–º –∑–¥–æ—Ä–æ–≤—å–µ–º –º–∏–∫—Ä–æ–±–∏–æ–º–∞ –∏ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞.'
        },
        'sleep_weight': {
            title: '–°–≤—è–∑—å —Å–Ω–∞ –∏ –≤–µ—Å–∞',
            message: '–ù–µ–¥–æ—Å—ã–ø –Ω–∞—Ä—É—à–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –∞–ø–ø–µ—Ç–∏—Ç–∞ –∏ –∑–∞–º–µ–¥–ª—è–µ—Ç –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ',
            insight: '–ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ —Å–Ω–∞ —Ä–∞—Å—Ç—ë—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª –∏ –≥—Ä–µ–ª–∏–Ω (–≥–æ—Ä–º–æ–Ω –≥–æ–ª–æ–¥–∞), –ø–∞–¥–∞–µ—Ç –ª–µ–ø—Ç–∏–Ω (–≥–æ—Ä–º–æ–Ω –Ω–∞—Å—ã—â–µ–Ω–∏—è).',
            science: '–ú–µ—Ç–∞-–∞–Ω–∞–ª–∏–∑—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: —Å–æ–Ω <7 —á–∞—Å–æ–≤ –ø–æ–≤—ã—à–∞–µ—Ç —Ä–∏—Å–∫ –æ–∂–∏—Ä–µ–Ω–∏—è –Ω–∞ 40%. –ù–µ–¥–æ—Å—ã–ø —É—Å–∏–ª–∏–≤–∞–µ—Ç —Ç—è–≥—É –∫ —Å–ª–∞–¥–∫–æ–º—É –∏ –∫–∞–ª–æ—Ä–∏–π–Ω–æ–º—É, —Å–Ω–∏–∂–∞–µ—Ç –±–∞–∑–æ–≤—ã–π –º–µ—Ç–∞–±–æ–ª–∏–∑–º –Ω–∞ 5-15%.'
        },
        'sleep_hunger': {
            title: '–°–æ–Ω –∏ –≥–æ–ª–æ–¥',
            message: '–ü–ª–æ—Ö–æ–π —Å–æ–Ω —É—Å–∏–ª–∏–≤–∞–µ—Ç –∞–ø–ø–µ—Ç–∏—Ç –∏ —Ç—è–≥—É –∫ –±—ã—Å—Ç—Ä—ã–º —É–≥–ª–µ–≤–æ–¥–∞–º',
            insight: '–ü–æ—Å–ª–µ –±–µ—Å—Å–æ–Ω–Ω–æ–π –Ω–æ—á–∏ –º–æ–∑–≥ —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –≥–ª—é–∫–æ–∑—ã, —á—Ç–æ–±—ã –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —É—Å—Ç–∞–ª–æ—Å—Ç—å.',
            science: '–ù–µ–¥–æ—Å—ã–ø –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∑–æ–Ω—ã –º–æ–∑–≥–∞, –æ—Ç–≤–µ—á–∞—é—â–∏–µ –∑–∞ –Ω–∞–≥—Ä–∞–¥—É, –∏ —É—Å–∏–ª–∏–≤–∞–µ—Ç —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –∫–∞–ª–æ—Ä–∏–π–Ω—É—é –ø–∏—â—É. –ì—Ä–µ–ª–∏–Ω (–≥–æ–ª–æ–¥) —Ä–∞—Å—Ç—ë—Ç –Ω–∞ 15-20%, –ª–µ–ø—Ç–∏–Ω (—Å—ã—Ç–æ—Å—Ç—å) –ø–∞–¥–∞–µ—Ç –Ω–∞ 15%.'
        },
        'training_kcal': {
            title: '–ë–∞–ª–∞–Ω—Å: —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ –µ–¥–∞',
            message: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –µ—Å—Ç—å, –Ω–æ –µ–¥—ã —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç ‚Äî —ç—Ñ—Ñ–µ–∫—Ç —Å–Ω–∏–∂–∞–µ—Ç—Å—è',
            insight: '–î–ª—è —Ä–æ—Å—Ç–∞ –º—ã—à—Ü –Ω—É–∂–µ–Ω –ø—Ä–æ—Ñ–∏—Ü–∏—Ç –∫–∞–ª–æ—Ä–∏–π, –¥–ª—è –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏—è ‚Äî –Ω–µ–±–æ–ª—å—à–æ–π –¥–µ—Ñ–∏—Ü–∏—Ç. –í–∞–∂–µ–Ω –±–∞–ª–∞–Ω—Å.',
            science: '–ò–∑–±—ã—Ç–æ—á–Ω—ã–π –¥–µ—Ñ–∏—Ü–∏—Ç –ø—Ä–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö (>30% –æ—Ç –Ω–æ—Ä–º—ã) –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä–µ –º—ã—à—Ü –∏ –∑–∞–º–µ–¥–ª–µ–Ω–∏—é –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞. –ò–∑–±—ã—Ç–æ—á–Ω—ã–π –ø—Ä–æ—Ñ–∏—Ü–∏—Ç –±–µ–∑ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ ‚Äî –∫ –Ω–∞–±–æ—Ä—É –∂–∏—Ä–∞.'
        },
        'steps_weight': {
            title: '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –≤–µ—Å',
            message: '–ú–∞–ª–æ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ‚Äî –æ—Ä–≥–∞–Ω–∏–∑–º —Ç—Ä–∞—Ç–∏—Ç –º–µ–Ω—å—à–µ –∫–∞–ª–æ—Ä–∏–π',
            insight: 'NEAT (Non-Exercise Activity Thermogenesis) ‚Äî —ç—Ç–æ –≤—Å–µ –¥–≤–∏–∂–µ–Ω–∏—è –∫—Ä–æ–º–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: —Ö–æ–¥—å–±–∞, —Ä–∞–±–æ—Ç–∞ –ø–æ –¥–æ–º—É, —Å—Ç–æ—è–Ω–∏–µ.',
            science: 'NEAT –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –æ—Ç 200 –¥–æ 800 –∫–∫–∞–ª –≤ –¥–µ–Ω—å. –õ—é–¥–∏ —Å —Å–∏–¥—è—á–µ–π —Ä–∞–±–æ—Ç–æ–π —Ç—Ä–∞—Ç—è—Ç –Ω–∞ 30-40% –º–µ–Ω—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏. 10 000 —à–∞–≥–æ–≤ –≤ –¥–µ–Ω—å ‚Äî –Ω–∞—É—á–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–æ—Ä–º–∞ –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è.'
        },
        'protein_satiety': {
            title: '–ë–µ–ª–æ–∫ –∏ —Å—ã—Ç–æ—Å—Ç—å',
            message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–µ–ª–∫–∞ ‚Äî –≥–æ–ª–æ–¥ –Ω–∞—Å—Ç—É–ø–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ',
            insight: '–ë–µ–ª–æ–∫ –Ω–∞—Å—ã—â–∞–µ—Ç –ª—É—á—à–µ –≤—Å–µ—Ö –º–∞–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤ –∏ –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –º—ã—à—Ü—ã –ø—Ä–∏ –¥–µ—Ñ–∏—Ü–∏—Ç–µ –∫–∞–ª–æ—Ä–∏–π.',
            science: '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: –¥–∏–µ—Ç–∞ —Å 25-30% –±–µ–ª–∫–∞ —Å–Ω–∏–∂–∞–µ—Ç —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –∫–∞–ª–æ—Ä–∏–π –Ω–∞ 10-15%. –ë–µ–ª–æ–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ç–µ—Ä–º–æ–≥–µ–Ω–µ–∑ (–∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø–µ—Ä–µ–≤–∞—Ä–∏–≤–∞–Ω–∏–µ) –Ω–∞ 20-30%.'
        },
        'fiber_regularity': {
            title: '–ö–ª–µ—Ç—á–∞—Ç–∫–∞ –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å',
            message: '–ú–∞–ª–æ –∫–ª–µ—Ç—á–∞—Ç–∫–∏ ‚Äî –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ–º –∏ —Å—ã—Ç–æ—Å—Ç—å—é',
            insight: '–ö–ª–µ—Ç—á–∞—Ç–∫–∞ –ø–∏—Ç–∞–µ—Ç –ø–æ–ª–µ–∑–Ω—ã–µ –±–∞–∫—Ç–µ—Ä–∏–∏, —É–ª—É—á—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –∫–∏—à–µ—á–Ω–∏–∫–∞ –∏ –∑–∞–º–µ–¥–ª—è–µ—Ç —É—Å–≤–æ–µ–Ω–∏–µ —É–≥–ª–µ–≤–æ–¥–æ–≤.',
            science: '–ù–æ—Ä–º–∞ –∫–ª–µ—Ç—á–∞—Ç–∫–∏: 25-35 –≥/–¥–µ–Ω—å. –ö–∞–∂–¥—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ 10 –≥ –∫–ª–µ—Ç—á–∞—Ç–∫–∏ —Å–Ω–∏–∂–∞—é—Ç —Ä–∏—Å–∫ –¥–∏–∞–±–µ—Ç–∞ 2 —Ç–∏–ø–∞ –Ω–∞ 10%, —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π –Ω–∞ 15-20%.'
        },

        // C11-C22: Nutrition Quality
        'nutrition_quality': {
            title: '–û–±—â–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞—Ü–∏–æ–Ω–∞',
            message: '–ü–∏—Ç–∞–Ω–∏–µ –Ω–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–æ ‚Äî –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–æ–ª–µ–∑–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤',
            insight: '–ò–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä–æ–¥—É–∫—Ç–æ–≤, –±–∞–ª–∞–Ω—Å –º–∞–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤ –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –º–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤.',
            science: '–ò–Ω–¥–µ–∫—Å—ã –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∏–µ—Ç—ã (HEI, DASH) –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: —á–µ–º –≤—ã—à–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–∏—Ç–∞–Ω–∏—è, —Ç–µ–º –Ω–∏–∂–µ —Ä–∏—Å–∫ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π, –≤—ã—à–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏ –∏ —ç–Ω–µ—Ä–≥–∏—è.'
        },
        'omega_balancer': {
            title: '–ë–∞–ª–∞–Ω—Å –æ–º–µ–≥–∞-3 –∏ –æ–º–µ–≥–∞-6',
            message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ–º–µ–≥–∞-6 (—Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Å–ª–∞) ‚Äî —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ',
            insight: '–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–º–µ–≥–∞-6 –∫ –æ–º–µ–≥–∞-3: –æ—Ç 1:1 –¥–æ 4:1. –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏–µ—Ç–∞ –¥–∞—ë—Ç 15:1 –∏ –≤—ã—à–µ.',
            science: '–ò–∑–±—ã—Ç–æ–∫ –æ–º–µ–≥–∞-6 (–ø–æ–¥—Å–æ–ª–Ω–µ—á–Ω–æ–µ, –∫—É–∫—É—Ä—É–∑–Ω–æ–µ –º–∞—Å–ª–æ) —É—Å–∏–ª–∏–≤–∞–µ—Ç –≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã. –û–º–µ–≥–∞-3 (—Ä—ã–±–∞, –ª—å–Ω—è–Ω–æ–µ –º–∞—Å–ª–æ) —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–æ—Ç–∏–≤–æ–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω–æ. –î–∏—Å–±–∞–ª–∞–Ω—Å —Å–≤—è–∑–∞–Ω —Å –æ–∂–∏—Ä–µ–Ω–∏–µ–º, –¥–∏–∞–±–µ—Ç–æ–º, –±–æ–ª–µ–∑–Ω—è–º–∏ —Å–µ—Ä–¥—Ü–∞.'
        },
        'protein_distribution': {
            title: '–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–µ–ª–∫–∞',
            message: '–ë–µ–ª–æ–∫ –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è',
            insight: '–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Å–∏–Ω—Ç–µ–∑–∞ –º—ã—à–µ—á–Ω–æ–≥–æ –±–µ–ª–∫–∞ –Ω—É–∂–Ω–æ 20-40 –≥ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –±–µ–ª–∫–∞ –∫–∞–∂–¥—ã–µ 3-5 —á–∞—Å–æ–≤.',
            science: '–ú–µ—Ö–∞–Ω–∏–∑–º mTOR (—Ä–æ—Å—Ç –º—ã—à—Ü) –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–æ—Ä–æ–≥–æ–≤–æ–π –¥–æ–∑–µ –ª–µ–π—Ü–∏–Ω–∞ (2.5-3 –≥). –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–µ–ª–∫–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –¥–ª—è –º—ã—à—Ü, —á–µ–º –æ–¥–Ω–∞ –±–æ–ª—å—à–∞—è –ø–æ—Ä—Ü–∏—è.'
        },
        'training_type_match': {
            title: '–ü–∏—Ç–∞–Ω–∏–µ –∏ —Ç–∏–ø —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',
            message: '–ü–∏—Ç–∞–Ω–∏–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–∏–¥—É –Ω–∞–≥—Ä—É–∑–∫–∏ ‚Äî —ç—Ñ—Ñ–µ–∫—Ç —Å–Ω–∏–∂–∞–µ—Ç—Å—è',
            insight: '–°–∏–ª–æ–≤—ã–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º –Ω—É–∂–µ–Ω –±–µ–ª–æ–∫ –∏ —É–≥–ª–µ–≤–æ–¥—ã. –ö–∞—Ä–¥–∏–æ ‚Äî —É–≥–ª–µ–≤–æ–¥—ã –¥–æ –∏ –∂–∏—Ä—ã –ø–æ—Å–ª–µ. –î–ª–∏—Ç–µ–ª—å–Ω–æ–π –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏ ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —É–≥–ª–µ–≤–æ–¥–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.',
            science: '–ì–ª–∏–∫–æ–≥–µ–Ω (–∑–∞–ø–∞—Å—ë–Ω–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ –¥–ª—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫. 60-90 –º–∏–Ω –∏–Ω—Ç–µ–Ω—Å–∏–≤–∞ –∏—Å—Ç–æ—â–∞—é—Ç –∑–∞–ø–∞—Å—ã. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–ª–∏–∫–æ–≥–µ–Ω–∞ —Ç—Ä–µ–±—É–µ—Ç 1-1.2 –≥ —É–≥–ª–µ–≤–æ–¥–æ–≤ –Ω–∞ –∫–≥ –≤–µ—Å–∞.'
        },
        'hydration': {
            title: '–í–æ–¥–Ω—ã–π –±–∞–ª–∞–Ω—Å',
            message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∂–∏–¥–∫–æ—Å—Ç–∏ ‚Äî –ø–∞–¥–∞–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∏ –º–µ—Ç–∞–±–æ–ª–∏–∑–º',
            insight: '–î–∞–∂–µ –ª—ë–≥–∫–æ–µ –æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ (1-2% –º–∞—Å—Å—ã —Ç–µ–ª–∞) —Å–Ω–∏–∂–∞–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∏ —É–º—Å—Ç–≤–µ–Ω–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.',
            science: '–ù–æ—Ä–º–∞: 30-40 –º–ª/–∫–≥ –≤–µ—Å–∞. –í–æ–¥–∞ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤–∞, –≤—ã–≤–æ–¥–∏—Ç –ø—Ä–æ–¥—É–∫—Ç—ã –æ–±–º–µ–Ω–∞. –û–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–º–µ–¥–ª—è–µ—Ç –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —É—Å—Ç–∞–ª–æ—Å—Ç—å.'
        },
        'gut_health': {
            title: '–ó–¥–æ—Ä–æ–≤—å–µ –∫–∏—à–µ—á–Ω–∏–∫–∞',
            message: '–ú–∞–ª–æ –∫–ª–µ—Ç—á–∞—Ç–∫–∏ –∏ –±–æ–±–æ–≤—ã—Ö ‚Äî —Å—Ç—Ä–∞–¥–∞–µ—Ç –º–∏–∫—Ä–æ–±–∏–æ–º',
            insight: '–†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –º–∏–∫—Ä–æ–±–∏–æ–º–∞ —Å–≤—è–∑–∞–Ω–æ —Å –∏–º–º—É–Ω–∏—Ç–µ—Ç–æ–º, –≤–µ—Å–æ–º, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º –∏ —ç–Ω–µ—Ä–≥–∏–µ–π.',
            science: '–ö–ª–µ—Ç—á–∞—Ç–∫–∞ (15+ –≥/–¥–µ–Ω—å) –∏ –ø—Ä–µ–±–∏–æ—Ç–∏–∫–∏ –ø–∏—Ç–∞—é—Ç –ø–æ–ª–µ–∑–Ω—ã–µ –±–∞–∫—Ç–µ—Ä–∏–∏. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Å–≤—è–∑—ã–≤–∞—é—Ç —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –º–∏–∫—Ä–æ–±–∏–æ–º–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –≤–æ—Å–ø–∞–ª–µ–Ω–∏—è, –æ–∂–∏—Ä–µ–Ω–∏—è, –¥–µ–ø—Ä–µ—Å—Å–∏–∏. –í—ã—Å–æ–∫–æ–±–µ–ª–∫–æ–≤–∞—è –¥–∏–µ—Ç–∞ –±–µ–∑ –∫–ª–µ—Ç—á–∞—Ç–∫–∏ –≤—Ä–µ–¥–∏—Ç –±–∞–∫—Ç–µ—Ä–∏—è–º.'
        },

        // Additional patterns (not in C1-C22 but used)
        'added_sugar_dependency': {
            title: '–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Å–∞—Ö–∞—Ä–∞',
            message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–∞—Ö–∞—Ä–∞ ‚Äî —Å–∫–∞—á–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏ –∏ —Ç—è–≥–∞ –∫ —Å–ª–∞–¥–∫–æ–º—É',
            insight: '–ò–∑–±—ã—Ç–æ—á–Ω—ã–π —Å–∞—Ö–∞—Ä –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç –ø–µ—á–µ–Ω—å, –≤—ã–∑—ã–≤–∞–µ—Ç –∏–Ω—Å—É–ª–∏–Ω–æ—Ä–µ–∑–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ —É—Å–∏–ª–∏–≤–∞–µ—Ç –≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã.',
            science: '–í–û–ó —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç <25 –≥ –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–∞—Ö–∞—Ä–∞ –≤ –¥–µ–Ω—å (<5% –∫–∞–ª–æ—Ä–∏–π). –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å —Ä–∏—Å–∫–æ–º –¥–∏–∞–±–µ—Ç–∞, –æ–∂–∏—Ä–µ–Ω–∏—è –ø–µ—á–µ–Ω–∏, —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π. –°–∞—Ö–∞—Ä –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∑–æ–Ω—ã –Ω–∞–≥—Ä–∞–¥—ã –≤ –º–æ–∑–≥–µ, –∫–∞–∫ –Ω–∞—Ä–∫–æ—Ç–∏–∫–∏.'
        }
    };

    /**
     * Human-friendly messages for non-pattern warnings
     * 
     * Structure: { title, message, insight, science }
     * - title: –∫–æ—Ä–æ—Ç–∫–æ–µ –ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (2-5 —Å–ª–æ–≤)
     * - message: friendly –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
     * - insight: –ø–æ–¥—Ä–æ–±–Ω—ã–π —Å–æ–≤–µ—Ç —á—Ç–æ –¥–µ–ª–∞—Ç—å
     *- science: –Ω–∞—É—á–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Å –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è–º–∏
     */
    const WARNING_HUMAN_MESSAGES = {
        HEALTH_SCORE_DECLINE: {
            title: '–û–±—â–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —Å–Ω–∏–∂–∞–µ—Ç—Å—è',
            message: 'Health Score –ø–∞–¥–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ ‚Äî —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Å–∏–≥–Ω–∞–ª –æ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–º –¥–∏—Å–±–∞–ª–∞–Ω—Å–µ.',
            insight: '–ü–∞–¥–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç 50+ –º–µ—Ç—Ä–∏–∫ –ø–∏—Ç–∞–Ω–∏—è, —Å–Ω–∞, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å –Ω–∏–∑–∫–∏–º–∏ scores ‚Äî —Ç–∞–º –ø—Ä–∏—á–∏–Ω–∞.',
            science: 'Health Score –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–∏—Ç–∞–Ω–∏—è (timing, quality, balance), –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (—Å–æ–Ω, —Å—Ç—Ä–µ—Å—Å) –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (NEAT, —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏). –°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è 3+ –¥–Ω—è —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–π –¥–∏—Å–±–∞–ª–∞–Ω—Å, —Ç—Ä–µ–±—É—é—â–∏–π –≤–Ω–∏–º–∞–Ω–∏—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Å–ª–∞–±—ã–º –∑–æ–Ω–∞–º. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: —Ä–∞–Ω–Ω–µ–µ –≤—ã—è–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤ (–¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–∏–º–ø—Ç–æ–º–æ–≤) —É–ª—É—á—à–∞–µ—Ç –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ 40-60%.',
            actions: [
                '–û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª Insights ‚Üí –ü–∞—Ç—Ç–µ—Ä–Ω—ã, –Ω–∞–π–¥–∏—Ç–µ 3 –ø–∞—Ç—Ç–µ—Ä–Ω–∞ —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º score ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤—ã–µ –∑–æ–Ω—ã —Ä–∏—Å–∫–∞',
                '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–Ω –∑–∞ 3 –¥–Ω—è: –µ—Å–ª–∏ <7—á ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, –∞ –Ω–µ –Ω–æ–≤—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏',
                '–°—Ä–∞–≤–Ω–∏—Ç–µ –∫–∞–ª–æ—Ä–∏–∏ —Å –Ω–æ—Ä–º–æ–π: –¥–µ—Ñ–∏—Ü–∏—Ç >500 –∫–∫–∞–ª/–¥–µ–Ω—å ‚Äî —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ, –ø—Ä–æ—Ñ–∏—Ü–∏—Ç >300 ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á–∏—Ç–º–∏–ª—ã'
            ]
        },
        STATUS_SCORE_DECLINE: {
            title: '–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–∞–¥–∞–µ—Ç',
            message: 'Status Score —Å–Ω–∏–∂–∞–µ—Ç—Å—è ‚Äî –æ—Ä–≥–∞–Ω–∏–∑–º —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–π —É—Å—Ç–∞–ª–æ—Å—Ç–∏ –∏ –Ω–µ–¥–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏.',
            insight: 'Status Score (0-100) —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–æ–Ω, —Å—Ç—Ä–µ—Å—Å, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å. –ü–∞–¥–µ–Ω–∏–µ 3+ –¥–Ω—è –æ–∑–Ω–∞—á–∞–µ—Ç: –Ω—É–∂–µ–Ω –æ—Ç–¥—ã—Ö, –∞ –Ω–µ –Ω–æ–≤—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏.',
            science: 'Status Score –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ñ–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–º–∞ —á–µ—Ä–µ–∑ –±–∞–ª–∞–Ω—Å —Å–∏–º–ø–∞—Ç–∏—á–µ—Å–∫–æ–π –∏ –ø–∞—Ä–∞—Å–∏–º–ø–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º. –•—Ä–æ–Ω–∏—á–µ—Å–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ (consecutive decline) —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –¥–µ—Ñ–∏—Ü–∏—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: HRV –ø–∞–¥–∞–µ—Ç, cortisol —Ä–∞—Å—Ç—ë—Ç, –∏–º–º—É–Ω–∏—Ç–µ—Ç —Å–ª–∞–±–µ–µ—Ç. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç: –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ —É—Å—Ç–∞–ª–æ—Å—Ç–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∏—Å–∫ –ø–µ—Ä–µ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏, –±–æ–ª–µ–∑–Ω–µ–π, —Ç—Ä–∞–≤–º (J Sports Sci, 2020).',
            actions: [
                '–î–æ–±–∞–≤—å—Ç–µ 1 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –¥–µ–Ω—å –æ—Ç–¥—ã—Ö–∞ –æ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ',
                '–ü–æ–≤—ã—Å—å—Ç–µ –∫–∞–ª–æ—Ä–∏–∏ –Ω–∞ 10-15% –Ω–∞ 2-3 –¥–Ω—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≥–æ—Ä–º–æ–Ω–æ–≤',
                '–£–¥–µ–ª–∏—Ç–µ –≤—Ä–µ–º—è —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏: –º–µ–¥–∏—Ç–∞—Ü–∏—è, –ø—Ä–æ–≥—É–ª–∫–∞, —è–Ω—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ 15-20 –º–∏–Ω/–¥–µ–Ω—å'
            ]
        },
        SLEEP_DEBT: {
            title: '–ù–∞–∫–æ–ø–∏–ª—Å—è –Ω–µ–¥–æ—Å—ã–ø',
            message: '–ù–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ —Å–æ–Ω –º–µ–Ω—å—à–µ 7 —á–∞—Å–æ–≤ ‚Äî –æ—Ä–≥–∞–Ω–∏–∑–º –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.',
            insight: 'Sleep debt —Å–Ω–∏–∂–∞–µ—Ç –º–µ—Ç–∞–±–æ–ª–∏–∑–º –Ω–∞ 10-15%, —É—Å–∏–ª–∏–≤–∞–µ—Ç –≥–æ–ª–æ–¥ –∏ —Ç—è–≥—É –∫ —Å–ª–∞–¥–∫–æ–º—É, —É—Ö—É–¥—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –∏–Ω—Å—É–ª–∏–Ω–∞. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–æ–Ω 7-9 —á–∞—Å–æ–≤.',
            science: '–°–æ–Ω <7 —á–∞—Å–æ–≤ 3+ –Ω–æ—á–∏ –ø–æ–¥—Ä—è–¥ –Ω–∞—Ä—É—à–∞–µ—Ç –≥–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: —Ä–∞—Å—Ç—ë—Ç ghrelin (–≥–æ—Ä–º–æ–Ω –≥–æ–ª–æ–¥–∞), –ø–∞–¥–∞–µ—Ç leptin (–≥–æ—Ä–º–æ–Ω —Å—ã—Ç–æ—Å—Ç–∏), —Å–Ω–∏–∂–∞–µ—Ç—Å—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫ –∏–Ω—Å—É–ª–∏–Ω—É –Ω–∞ 20-30%. –†–∏—Å–∫ –æ–∂–∏—Ä–µ–Ω–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 40%, —Ä–∏—Å–∫ –¥–∏–∞–±–µ—Ç–∞ 2 —Ç–∏–ø–∞ ‚Äî –Ω–∞ 28% (Sleep Medicine Reviews, 2019). –ù–µ–¥–æ—Å—ã–ø 1 –Ω–æ—á–∏ –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç—Å—è 2-3 –Ω–æ—á–∞–º–∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ —Å–Ω–∞; —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏–π debt —Ç—Ä–µ–±—É–µ—Ç 7-10 –¥–Ω–µ–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.',
            actions: [
                '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±—É–¥–∏–ª—å–Ω–∏–∫ –Ω–∞ –æ—Ç–±–æ–π —Å–æ–Ω –∑–∞ 8 —á–∞—Å–æ–≤ –¥–æ –ø–æ–¥—ä—ë–º–∞ (–Ω–µ –Ω–∞ –ø–æ–¥—ä—ë–º!)',
                '–û—Ç–∫–∞–∂–∏—Ç–µ—Å—å –æ—Ç —ç–∫—Ä–∞–Ω–æ–≤ –∑–∞ 1 —á–∞—Å –¥–æ —Å–Ω–∞ (—Å–∏–Ω–∏–π —Å–≤–µ—Ç –ø–æ–¥–∞–≤–ª—è–µ—Ç –º–µ–ª–∞—Ç–æ–Ω–∏–Ω)',
                '–ï—Å–ª–∏ –Ω–µ–¥–æ—Å—ã–ø >3 –¥–Ω–µ–π ‚Äî –¥–æ–±–∞–≤—å—Ç–µ 15-30 –º–∏–Ω –¥–Ω–µ–≤–Ω–æ–≥–æ —Å–Ω–∞ –¥–æ 15:00 —á–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è'
            ]
        },
        CALORIC_DEBT: {
            title: '–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–µ—Ñ–∏—Ü–∏—Ç –∫–∞–ª–æ—Ä–∏–π',
            message: '–î–≤–∞ –¥–Ω—è –ø–æ–¥—Ä—è–¥ –Ω–µ–¥–æ–±–æ—Ä –±–æ–ª–µ–µ 1500 –∫–∫–∞–ª ‚Äî —ç—Ç–æ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–π –¥–µ—Ñ–∏—Ü–∏—Ç, –∑–∞–º–µ–¥–ª—è—é—â–∏–π –º–µ—Ç–∞–±–æ–ª–∏–∑–º.',
            insight: '–†–µ–∑–∫–∏–π –¥–µ—Ñ–∏—Ü–∏—Ç –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º—ç–∫–æ–Ω–æ–º–∏–∏: –æ—Ä–≥–∞–Ω–∏–∑–º —Ä–∞—Å—Ö–æ–¥—É–µ—Ç –º–µ–Ω—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏, —Ç–µ—Ä—è–µ—Ç –º—ã—à—Ü—ã –≤–º–µ—Å—Ç–æ –∂–∏—Ä–∞. –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –¥–µ—Ñ–∏—Ü–∏—Ç –¥–ª—è –ø–æ—Ö—É–¥–µ–Ω–∏—è: 300-500 –∫–∫–∞–ª/–¥–µ–Ω—å.',
            science: '–î–µ—Ñ–∏—Ü–∏—Ç >30% –æ—Ç –Ω–æ—Ä–º—ã (>1500 –∫–∫–∞–ª) –∑–∞–ø—É—Å–∫–∞–µ—Ç adaptive thermogenesis: –±–∞–∑–æ–≤—ã–π –º–µ—Ç–∞–±–æ–ª–∏–∑–º –ø–∞–¥–∞–µ—Ç –Ω–∞ 10-15%, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å NEAT —Å–Ω–∏–∂–∞–µ—Ç—Å—è, —Ä–∞—Å—Ç—ë—Ç cortisol (–∫–∞—Ç–∞–±–æ–ª–∏–∑–º –º—ã—à—Ü). –ü–æ—Ç–µ—Ä—è –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã –ø—Ä–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–º –¥–µ—Ñ–∏—Ü–∏—Ç–µ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç 40-50% –æ—Ç –æ–±—â–µ–π –ø–æ—Ç–µ—Ä–∏ –≤–µ—Å–∞ (vs 20-30% –ø—Ä–∏ —É–º–µ—Ä–µ–Ω–Ω–æ–º –¥–µ—Ñ–∏—Ü–∏—Ç–µ). –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: –±—ã—Å—Ç—Ä–∞—è –ø–æ—Ç–µ—Ä—è –≤–µ—Å–∞ (>1 –∫–≥/–Ω–µ–¥–µ–ª—é) –≤–µ–¥—ë—Ç –∫ rebound —ç—Ñ—Ñ–µ–∫—Ç—É –≤ 80% —Å–ª—É—á–∞–µ–≤ (Obesity Reviews, 2021).',
            actions: [
                '–ü–æ–≤—ã—Å—å—Ç–µ –∫–∞–ª–æ—Ä–∏–∏ –Ω–∞ 300-500 –∫–∫–∞–ª/–¥–µ–Ω—å –∑–∞ —Å—á—ë—Ç –ø—Ä–æ—Ç–µ–∏–Ω–∞ –∏ —Å–ª–æ–∂–Ω—ã—Ö —É–≥–ª–µ–≤–æ–¥–æ–≤',
                '–î–æ–±–∞–≤—å—Ç–µ 1-2 –ø–µ—Ä–µ–∫—É—Å–∞ –ø–æ 150-200 –∫–∫–∞–ª (–æ—Ä–µ—Ö–∏, –∫–µ—Ñ–∏—Ä, –±–∞–Ω–∞–Ω)',
                '–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ refeed day –∫–∞–∂–¥—ã–µ 7-10 –¥–Ω–µ–π: +10-15% –∫–∫–∞–ª –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞'
            ]
        },
        WEIGHT_SPIKE: {
            title: '–†–µ–∑–∫–∏–π —Å–∫–∞—á–æ–∫ –≤–µ—Å–∞',
            message: '–í–µ—Å —É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ 1+ –∫–≥ –∑–∞ 1-2 –¥–Ω—è ‚Äî —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞ –≤–æ–¥—ã –∏–ª–∏ –ø–µ—Ä–µ–µ–¥–∞–Ω–∏–µ.',
            insight: '–ë—ã—Å—Ç—Ä—ã–π –Ω–∞–±–æ—Ä –≤–µ—Å–∞ —á–∞—â–µ –≤—Å–µ–≥–æ —Å–≤—è–∑–∞–Ω —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤–æ–¥—ã (—Å–æ–ª—å, —É–≥–ª–µ–≤–æ–¥—ã, –º–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω—ã–π —Ü–∏–∫–ª). –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –≤–æ–¥–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–ª–æ—Ä–∏–∏ –∏ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏.',
            science: '–ù–∞–±–æ—Ä 1 –∫–≥ –∂–∏—Ä–∞ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–±—ã—Ç–∫–∞ ~7700 –∫–∫–∞–ª, —á—Ç–æ –Ω–µ—Ä–µ–∞–ª—å–Ω–æ –∑–∞ 1-2 –¥–Ω—è. –ë—ã—Å—Ç—Ä–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤–µ—Å–∞ –æ–±—ã—á–Ω–æ –≤—ã–∑–≤–∞–Ω–æ –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤–æ–¥—ã: 1 –≥ –≥–ª–∏–∫–æ–≥–µ–Ω–∞ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 3-4 –≥ –≤–æ–¥—ã, 1 –≥ –Ω–∞—Ç—Ä–∏—è ‚Äî –¥–æ 200 –º–ª –∂–∏–¥–∫–æ—Å—Ç–∏. –ì–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è (–º–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω—ã–π —Ü–∏–∫–ª) –º–æ–≥—É—Ç –¥–æ–±–∞–≤–∏—Ç—å 1-3 –∫–≥ –≤–æ–¥—ã. –û–¥–Ω–∞–∫–æ —á–∞—Å—Ç—ã–µ —Å–∫–∞—á–∫–∏ –º–æ–≥—É—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ (binge-restrict cycle) –∏–ª–∏ –≥–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–∫–æ—Ä—Ç–∏–∑–æ–ª, –∏–Ω—Å—É–ª–∏–Ω).',
            actions: [
                '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Å–æ–ª–∏ –∑–∞ 2 –¥–Ω—è: –æ–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ 2000 –º–≥/–¥–µ–Ω—å',
                '–£–≤–µ–ª–∏—á—å—Ç–µ –≤–æ–¥—É –¥–æ 2.5-3 –ª/–¥–µ–Ω—å –¥–ª—è –≤—ã–≤–æ–¥–∞ –∑–∞–¥–µ—Ä–∂–∞–≤—à–µ–π—Å—è –∂–∏–¥–∫–æ—Å—Ç–∏',
                '–ï—Å–ª–∏ —Å–∫–∞—á–∫–∏ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è —á–∞—Å—Ç–æ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–æ—Ä–º–æ–Ω—ã (–∫–æ—Ä—Ç–∏–∑–æ–ª, —â–∏—Ç–æ–≤–∏–¥–∫–∞, –∏–Ω—Å—É–ª–∏–Ω)'
            ]
        },
        HYDRATION_DEFICIT: {
            title: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –∂–∏–¥–∫–æ—Å—Ç–∏',
            message: '–ù–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ –≤—ã –ø—å—ë—Ç–µ –º–µ–Ω—å—à–µ 1.5 –ª –≤–æ–¥—ã ‚Äî —ç—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —ç–Ω–µ—Ä–≥–∏—é –∏ –º–µ—Ç–∞–±–æ–ª–∏–∑–º.',
            insight: '–í–æ–¥–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤, —Ç–µ—Ä–º–æ—Ä–µ–≥—É–ª—è—Ü–∏—è, –≤—ã–≤–æ–¥ —Ç–æ–∫—Å–∏–Ω–æ–≤, —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å. –î–∞–∂–µ –ª—ë–≥–∫–æ–µ –æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ (1-2%) —Å–Ω–∏–∂–∞–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∏ —É–º—Å—Ç–≤–µ–Ω–Ω—É—é –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.',
            science: '–ù–æ—Ä–º–∞: 30-40 –º–ª/–∫–≥ –≤–µ—Å–∞ (–¥–ª—è 70 –∫–≥ ‚Äî 2.1-2.8 –ª). –û–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ 1-2% –º–∞—Å—Å—ã —Ç–µ–ª–∞ —Å–Ω–∏–∂–∞–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å –Ω–∞ 10-20%, –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ 10% (European Journal of Clinical Nutrition, 2003). –í–æ–¥–∞ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ª–∏–ø–æ–ª–∏–∑–µ (–∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–∏): –¥–µ—Ñ–∏—Ü–∏—Ç –∑–∞–º–µ–¥–ª—è–µ—Ç –º–µ—Ç–∞–±–æ–ª–∏–∑–º –Ω–∞ 3-5%. –•—Ä–æ–Ω–∏—á–µ—Å–∫–æ–µ –æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–≤—ã—à–∞–µ—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª, —É—Ö—É–¥—à–∞–µ—Ç —Å–æ–Ω, —É—Å–∏–ª–∏–≤–∞–µ—Ç –≥–æ–ª–æ–¥ (–ø—É—Ç–∞–µ—Ç—Å—è —Å –∂–∞–∂–¥–æ–π).',
            actions: [
                '–ü–æ—Å—Ç–∞–≤—å—Ç–µ –±—É—Ç—ã–ª–∫—É 1.5 –ª –Ω–∞ –≤–∏–¥–Ω–æ–µ –º–µ—Å—Ç–æ –∏ –≤—ã–ø–µ–π—Ç–µ –¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è',
                '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–∏—Ç—å –≤–æ–¥—É –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞',
                '–î–æ–±–∞–≤—å—Ç–µ —Ç—Ä–∞–≤—è–Ω–æ–π —á–∞–π, –æ–≥—É—Ä–µ—Ü, –ª–∏–º–æ–Ω –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è'
            ]
        },
        LOGGING_GAP: {
            title: '–ü—Ä–æ–ø—É—Å–∫–∏ –≤ –¥–Ω–µ–≤–Ω–∏–∫–µ',
            message: '–í—ã –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–ª–∏ –ø–∏—Ç–∞–Ω–∏–µ 2+ –¥–Ω—è ‚Äî —Ç–µ—Ä—è–µ—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª—å –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å.',
            insight: '–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞ ‚Äî –∫–ª—é—á –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º. –ü—Ä–æ–ø—É—Å–∫–∏ –ª–æ–º–∞—é—Ç –ø—Ä–∏–≤—ã—á–∫—É, —Å–Ω–∏–∂–∞—é—Ç –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–æ–≤, –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –ø–µ—Ä–µ–µ–¥–∞–Ω–∏—é –∏ –ø–æ—Ç–µ—Ä–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.',
            science: '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: –ª—é–¥–∏, –≤–µ–¥—É—â–∏–µ food diary –µ–∂–µ–¥–Ω–µ–≤–Ω–æ, —Ç–µ—Ä—è—é—Ç –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –≤–µ—Å–∞, —á–µ–º —Ç–µ, –∫—Ç–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–µ—Ä–µ–≥—É–ª—è—Ä–Ω–æ (American Journal of Preventive Medicine, 2008). Self-monitoring –ø–æ–≤—ã—à–∞–µ—Ç –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å –Ω–∞ 40-60%, —Å–Ω–∏–∂–∞–µ—Ç –∏–º–ø—É–ª—å—Å–∏–≤–Ω—ã–µ –≤—ã–±–æ—Ä—ã. –ü—Ä–æ–ø—É—Å–∫ >2 –¥–Ω–µ–π –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º –∫ —Å—Ç–∞—Ä—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –ø–∏—Ç–∞–Ω–∏—è –≤ 70% —Å–ª—É—á–∞–µ–≤ (Obesity, 2017).',
            actions: [
                '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–∏—ë–º—ã –ø–∏—â–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –µ–¥—ã (–ø–æ–∫–∞ –Ω–µ –∑–∞–±—ã–ª–∏)',
                '–ù–∞—á–Ω–∏—Ç–µ —Å —É–ø—Ä–æ—â—ë–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞: —Ñ–æ—Ç–æ –µ–¥—ã + –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –ø–æ—Ä—Ü–∏–∏',
                '–°–≤—è–∂–∏—Ç–µ –∑–∞–ø–∏—Å—å —Å —Ç—Ä–∏–≥–≥–µ—Ä–æ–º: —á–∞—à–∫–∞ –∫–æ—Ñ–µ ‚Üí –æ—Ç–∫—Ä—ã–≤–∞—é HEYS ‚Üí –∑–∞–ø–∏—Å—ã–≤–∞—é –∑–∞–≤—Ç—Ä–∞–∫'
            ]
        },
        PROTEIN_DEFICIT: {
            title: '–î–µ—Ñ–∏—Ü–∏—Ç –±–µ–ª–∫–∞',
            message: '–ù–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ –±–µ–ª–∫–∞ –º–µ–Ω—å—à–µ –Ω–æ—Ä–º—ã ‚Äî —ç—Ç–æ —É–≥—Ä–æ–∂–∞–µ—Ç –º—ã—à—Ü–∞–º –∏ –∑–∞–º–µ–¥–ª—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.',
            insight: '–ë–µ–ª–æ–∫ –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –¥–µ—Ñ–∏—Ü–∏—Ç–µ –∫–∞–ª–æ—Ä–∏–π. –ú–∏–Ω–∏–º—É–º 1.2-1.6 –≥/–∫–≥ –≤–µ—Å–∞, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è.',
            science: '–ù–æ—Ä–º–∞ –±–µ–ª–∫–∞ –ø—Ä–∏ –ø–æ—Ö—É–¥–µ–Ω–∏–∏: 1.6-2.2 –≥/–∫–≥ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º—ã—à—Ü (JISSN, 2017). –ü—Ä–∏ –¥–µ—Ñ–∏—Ü–∏—Ç–µ <1.2 –≥/–∫–≥ √ó 3+ –¥–Ω—è –æ—Ä–≥–∞–Ω–∏–∑–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º—ã—à–µ—á–Ω—ã–π –±–µ–ª–æ–∫ –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ —ç–Ω–µ—Ä–≥–∏–∏ (–≥–ª—é–∫–æ–Ω–µ–æ–≥–µ–Ω–µ–∑). –ü–æ—Ç–µ—Ä—è –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã —Å–Ω–∏–∂–∞–µ—Ç –±–∞–∑–æ–≤—ã–π –º–µ—Ç–∞–±–æ–ª–∏–∑–º –Ω–∞ 10-50 –∫–∫–∞–ª –Ω–∞ –∫–∞–∂–¥—ã–π –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–π –∫–≥, —É—Å–∏–ª–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç –π–æ-–π–æ. –ë–µ–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞—Å—ã—â–µ–Ω–∏–µ (thermic effect 20-30% vs 5-10% —É–≥–ª–µ–≤–æ–¥–æ–≤), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–Ω—Ç–µ–∑ –≥–æ—Ä–º–æ–Ω–æ–≤ –∏ –∏–º–º—É–Ω–∏—Ç–µ—Ç.',
            actions: [
                '–î–æ–±–∞–≤—å—Ç–µ 20-40 –≥ –ø—Ä–æ—Ç–µ–∏–Ω–∞ –≤ –∫–∞–∂–¥—ã–π –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏—ë–º –ø–∏—â–∏ (–∫—É—Ä–∏—Ü–∞, —Ä—ã–±–∞, —Ç–≤–æ—Ä–æ–≥, —è–π—Ü–∞)',
                '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ç–µ–∏–Ω–æ–≤—ã–µ –ø–µ—Ä–µ–∫—É—Å—ã: –≥—Ä–µ—á–µ—Å–∫–∏–π –π–æ–≥—É—Ä—Ç, –æ—Ä–µ—Ö–∏, –ø—Ä–æ—Ç–µ–∏–Ω–æ–≤—ã–π –∫–æ–∫—Ç–µ–π–ª—å',
                '–ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ: —Ç—Ä–µ—Ç—å —Ç–∞—Ä–µ–ª–∫–∏ = –±–µ–ª–æ–∫, —Ç—Ä–µ—Ç—å = –æ–≤–æ—â–∏, —Ç—Ä–µ—Ç—å = —É–≥–ª–µ–≤–æ–¥—ã'
            ]
        },
        STRESS_ACCUMULATION: {
            title: '–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–∞',
            message: '–í—ã—Å–æ–∫–∏–π —Å—Ç—Ä–µ—Å—Å –±–µ–∑ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è ‚Äî —Ä–∞—Å—Ç—ë—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª, –ø–∞–¥–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.',
            insight: '–•—Ä–æ–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç—Ä–µ—Å—Å –Ω–∞—Ä—É—à–∞–µ—Ç –≥–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: –∫–æ—Ä—Ç–∏–∑–æ–ª –±–ª–æ–∫–∏—Ä—É–µ—Ç –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ, —É—Å–∏–ª–∏–≤–∞–µ—Ç —Ç—è–≥—É –∫ —Å–ª–∞–¥–∫–æ–º—É, —É—Ö—É–¥—à–∞–µ—Ç —Å–æ–Ω –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.',
            science: '–•—Ä–æ–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç—Ä–µ—Å—Å –ø–æ–≤—ã—à–∞–µ—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª –Ω–∞ 30-50% –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è. –í—ã—Å–æ–∫–∏–π –∫–æ—Ä—Ç–∏–∑–æ–ª —Å—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç –ª–∏–ø–æ–≥–µ–Ω–µ–∑ (–Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∂–∏—Ä–∞) –≤ –≤–∏—Å—Ü–µ—Ä–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏, —É—Å–∏–ª–∏–≤–∞–µ—Ç –∏–Ω—Å—É–ª–∏–Ω–æ—Ä–µ–∑–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –ø–æ–¥–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω/—ç—Å—Ç—Ä–æ–≥–µ–Ω, —É—Ö—É–¥—à–∞–µ—Ç quality —Å–Ω–∞ (Psychoneuroendocrinology, 2019). –°—Ç—Ä–µ—Å—Å –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç reward pathways ‚Äî —Ç—è–≥–∞ –∫ comfort food (—Å–∞—Ö–∞—Ä, –∂–∏—Ä—ã). –î–µ—Ñ–∏—Ü–∏—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è >3 –¥–Ω–µ–π —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∏—Å–∫ –ø–µ—Ä–µ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏, —Å–Ω–∏–∂–∞–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç –Ω–∞ 20-40% (J Sports Sci, 2020).',
            actions: [
                '–í–Ω–µ–¥—Ä–∏—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –ø—Ä–∞–∫—Ç–∏–∫—É —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏: –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –ø—Ä–æ–≥—É–ª–∫–∞, –π–æ–≥–∞ (15-30 –º–∏–Ω)',
                '–°–Ω–∏–∑—å—Ç–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–∞ 20-30% –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ 1 –¥–µ–Ω—å –æ—Ç–¥—ã—Ö–∞',
                '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–Ω: —Å—Ç—Ä–µ—Å—Å —á–∞—Å—Ç–æ –∏–¥—ë—Ç —Ä—É–∫–∞ –æ–± —Ä—É–∫—É —Å –Ω–µ–¥–æ—Å—ã–ø–æ–º ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ 7-9 —á–∞—Å–æ–≤'
            ]
        },
        MEAL_SKIP_PATTERN: {
            title: '–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–ø—É—Å–∫–∏ –µ–¥—ã',
            message: '–í—ã —á–∞—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏ ‚Äî —ç—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–µ—Ä–µ–µ–¥–∞–Ω–∏—é –∏ –Ω–∞—Ä—É—à–µ–Ω–∏—é –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞.',
            insight: '–î–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤—ã –±–µ–∑ –µ–¥—ã (>6-8 —á–∞—Å–æ–≤) –≤—ã–∑—ã–≤–∞—é—Ç —á—Ä–µ–∑–º–µ—Ä–Ω—ã–π –≥–æ–ª–æ–¥, –ø–µ—Ä–µ–µ–¥–∞–Ω–∏–µ, —Å–∫–∞—á–∫–∏ –∏–Ω—Å—É–ª–∏–Ω–∞. –†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–∏—ë–º–æ–≤.',
            science: '–ü—Ä–æ–ø—É—Å–∫ –ø—Ä–∏—ë–º–æ–≤ –ø–∏—â–∏ —Å–Ω–∏–∂–∞–µ—Ç –º–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫—É—é –≥–∏–±–∫–æ—Å—Ç—å, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π –≥–æ–ª–æ–¥. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: –Ω–µ—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –ø–æ–≤—ã—à–∞–µ—Ç —Ä–∏—Å–∫ –º–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–æ–≥–æ —Å–∏–Ω–¥—Ä–æ–º–∞ –Ω–∞ 25%, —É—Ö—É–¥—à–∞–µ—Ç –≥–ª–∏–∫–µ–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å (Proc Nutr Soc, 2016). –î–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤—ã (>8—á) —Å—Ç–∏–º—É–ª–∏—Ä—É—é—Ç –∫–æ–º–ø–µ–Ω—Å–∞—Ç–æ—Ä–Ω–æ–µ –ø–µ—Ä–µ–µ–¥–∞–Ω–∏–µ (+20-40% –∫–∞–ª–æ—Ä–∏–π –∑–∞ —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏—ë–º), –Ω–∞—Ä—É—à–∞—é—Ç —Ü–∏—Ä–∫–∞–¥–Ω—ã–µ —Ä–∏—Ç–º—ã –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞. –ü—Ä–æ–ø—É—Å–∫ –∑–∞–≤—Ç—Ä–∞–∫–∞ –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç —Å +5-8% –º–∞—Å—Å—ã —Ç–µ–ª–∞ –∑–∞ –≥–æ–¥.',
            actions: [
                '–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ 3-4 –ø—Ä–∏—ë–º–∞ –ø–∏—â–∏ –∫–∞–∂–¥—ã–µ 3-5 —á–∞—Å–æ–≤ –≤ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –≤—Ä–µ–º—è',
                '–ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∑–¥–æ—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–∫—É—Å—ã –∑–∞—Ä–∞–Ω–µ–µ: –æ—Ä–µ—Ö–∏, —Ñ—Ä—É–∫—Ç—ã, –π–æ–≥—É—Ä—Ç ‚Äî –≤—Å–µ–≥–¥–∞ –ø–æ–¥ —Ä—É–∫–æ–π',
                '–ï—Å–ª–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç–µ –∑–∞–≤—Ç—Ä–∞–∫/–æ–±–µ–¥ –∏–∑-–∑–∞ —Ä–∞–±–æ—Ç—ã ‚Äî —Å—Ç–∞–≤—å—Ç–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞'
            ]
        },
        BINGE_RISK: {
            title: '–†–∏—Å–∫ –ø–µ—Ä–µ–µ–¥–∞–Ω–∏—è',
            message: '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–∏–∑–Ω–∞–∫–∏ binge eating: –±–æ–ª—å—à–∏–µ –ø–æ—Ä—Ü–∏–∏ –ø–æ—Å–ª–µ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ—Ä—ã–≤–æ–≤.',
            insight: 'Binge-restrict —Ü–∏–∫–ª —Ä–∞–∑—Ä—É—à–∞–µ—Ç –º–µ—Ç–∞–±–æ–ª–∏–∑–º –∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ. –ö–ª—é—á ‚Äî —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –¥—Ä–æ–±–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –±–µ–∑ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.',
            science: 'Binge Eating Disorder (BED) —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É–µ—Ç—Å—è —ç–ø–∏–∑–æ–¥–∞–º–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–∏—â–∏ (>2000 –∫–∫–∞–ª –∑–∞ 2 —á–∞—Å–∞) —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º —á—É–≤—Å—Ç–≤–æ–º –≤–∏–Ω—ã. –§–∏–∑–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã: –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤—ã (>8—á), –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –¥–µ—Ñ–∏—Ü–∏—Ç –∫–∞–ª–æ—Ä–∏–π (>30%), –¥–µ—Ñ–∏—Ü–∏—Ç —Å–Ω–∞. –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ: —Å—Ç—Ä–µ—Å—Å, –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å–Ω—ã–π mindset. BED –ø–æ–≤—ã—à–∞–µ—Ç —Ä–∏—Å–∫ –æ–∂–∏—Ä–µ–Ω–∏—è –Ω–∞ 50%, –¥–∏–∞–±–µ—Ç–∞ –Ω–∞ 35%, –¥–µ–ø—Ä–µ—Å—Å–∏–∏ –Ω–∞ 60% (Int J Eat Disord, 2018). –õ–µ—á–µ–Ω–∏–µ: –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ-–ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∞—è —Ç–µ—Ä–∞–ø–∏—è + —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –±–µ–∑ –∑–∞–ø—Ä–µ—Ç–æ–≤.',
            actions: [
                '–£–≤–µ–ª–∏—á—å—Ç–µ —Å—É—Ç–æ—á–Ω—ã–µ –∫–∞–ª–æ—Ä–∏–∏ –Ω–∞ 200-300 –∫–∫–∞–ª, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —á–µ—Ä–µ–∑ –≤—Å–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏',
                '–£–±–µ—Ä–∏—Ç–µ –∑–∞–ø—Ä–µ—Ç—ã: —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –ª—é–±–∏–º—É—é –µ–¥—É 1-2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é –Ω–µ–±–æ–ª—å—à–∏–º–∏ –ø–æ—Ä—Ü–∏—è–º–∏ (200-300 –∫–∫–∞–ª)',
                '–ï—Å–ª–∏ —á—É–≤—Å—Ç–≤–æ –≤–∏–Ω—ã –ø–æ—Å–ª–µ –µ–¥—ã –∏–ª–∏ –∫–æ–º–ø—É–ª—å—Å–∏–≤–Ω–æ–µ –ø–µ—Ä–µ–µ–¥–∞–Ω–∏–µ ‚Äî —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –ø—Å–∏—Ö–æ–ª–æ–≥–∞ –ö–ü–¢'
            ]
        },
        MOOD_WELLBEING_DECLINE: {
            title: '–ü–∞–¥–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è',
            message: '–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ —Å–Ω–∏–∂–∞—é—Ç—Å—è 7+ –¥–Ω–µ–π ‚Äî —Å–∏–≥–Ω–∞–ª burnout –∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏.',
            insight: '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –∏ —ç–Ω–µ—Ä–≥–∏–∏ —á–∞—Å—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å –ø–µ—Ä–µ–≥—Ä—É–∑–∫–æ–π, –Ω–µ–¥–æ—Å—ã–ø–æ–º, –¥–µ—Ñ–∏—Ü–∏—Ç–æ–º –ø–∏—Ç–∞–Ω–∏—è –∏–ª–∏ —Å—Ç—Ä–µ—Å—Å–æ–º. –í–Ω–∏–º–∞–Ω–∏–µ: –Ω–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ —Å–∏–≥–Ω–∞–ª—ã —Ç–µ–ª–∞.',
            science: 'Mood –∏ wellbeing —Å–∫–æ—Ä—ã –∫–æ—Ä—Ä–µ–ª–∏—Ä—É—é—Ç —Å —Å–µ—Ä–æ—Ç–æ–Ω–∏–Ω–æ–º, –¥–æ—Ñ–∞–º–∏–Ω–æ–º, HRV, —É—Ä–æ–≤–Ω–µ–º –≤–æ—Å–ø–∞–ª–µ–Ω–∏—è. –°–Ω–∏–∂–µ–Ω–∏–µ 7+ –¥–Ω–µ–π –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞: 1) —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç—Ä–µ—Å—Å (–∫–æ—Ä—Ç–∏–∑–æ–ª –ø–æ–¥–∞–≤–ª—è–µ—Ç —Å–µ—Ä–æ—Ç–æ–Ω–∏–Ω), 2) –¥–µ—Ñ–∏—Ü–∏—Ç —Å–Ω–∞ (<7—á —Å–Ω–∏–∂–∞–µ—Ç —Å–µ—Ä–æ—Ç–æ–Ω–∏–Ω –Ω–∞ 20%), 3) –≥–∏–ø–æ–≥–ª–∏–∫–µ–º–∏—è (–¥–µ—Ñ–∏—Ü–∏—Ç —É–≥–ª–µ–≤–æ–¥–æ–≤ —Å–Ω–∏–∂–∞–µ—Ç —Å–µ—Ä–æ—Ç–æ–Ω–∏–Ω), 4) –¥–µ—Ñ–∏—Ü–∏—Ç –º–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤ (B12, –º–∞–≥–Ω–∏–π, omega-3). –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: low mood –≤ —Ç–µ—á–µ–Ω–∏–µ 2+ –Ω–µ–¥–µ–ª—å ‚Äî –∫—Ä–∏—Ç–µ—Ä–∏–π –¥–µ–ø—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ —ç–ø–∏–∑–æ–¥–∞ (DSM-5). Burnout —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∏—Å–∫ —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π –Ω–∞ 40-80% (J Psychosom Res, 2020).',
            actions: [
                '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–Ω (7-9—á) + —Å—Ç—Ä–µ—Å—Å (–ø—Ä–∞–∫—Ç–∏–∫–∏ —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏ 15-20 –º–∏–Ω –µ–∂–µ–¥–Ω–µ–≤–Ω–æ)',
                '–î–æ–±–∞–≤—å—Ç–µ 30 –º–∏–Ω –ø—Ä–æ–≥—É–ª–∫–∏ –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ –ø—Ä–∏ –¥–Ω–µ–≤–Ω–æ–º —Å–≤–µ—Ç–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å',
                '–ï—Å–ª–∏ —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è >14 –¥–Ω–µ–π ‚Äî –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É (–¥–µ–ø—Ä–µ—Å—Å–∏—è —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â–∏)'
            ]
        },
        WEIGHT_PLATEAU: {
            title: '–ü–ª–∞—Ç–æ –≤–µ—Å–∞',
            message: '–í–µ—Å –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è 14+ –¥–Ω–µ–π –ø—Ä–∏ —Ü–µ–ª–∏ —Å–Ω–∏–∂–µ–Ω–∏—è ‚Äî —Ç–µ–ª–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å.',
            insight: '–ü–ª–∞—Ç–æ ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ñ–∞–∑–∞ –ø–æ—Ö—É–¥–µ–Ω–∏—è. –û—Ä–≥–∞–Ω–∏–∑–º —Å–Ω–∏–∑–∏–ª –º–µ—Ç–∞–±–æ–ª–∏–∑–º –∏ NEAT. –†–µ—à–µ–Ω–∏–µ: refeed day (+10-15% –∫–∞–ª–æ—Ä–∏–π), –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–µ–π.',
            science: '–ü–ª–∞—Ç–æ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–∑-–∑–∞ metabolic adaptation: –±–∞–∑–æ–≤—ã–π –º–µ—Ç–∞–±–æ–ª–∏–∑–º –ø–∞–¥–∞–µ—Ç –Ω–∞ 10-25% –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–º –¥–µ—Ñ–∏—Ü–∏—Ç–µ, NEAT —Å–Ω–∏–∂–∞–µ—Ç—Å—è –Ω–∞ 15-30%, –ª–µ–ø—Ç–∏–Ω –ø–∞–¥–∞–µ—Ç, ghrelin —Ä–∞—Å—Ç—ë—Ç. –ü–ª–∞—Ç–æ 14+ –¥–Ω–µ–π ‚Äî —Å–∏–≥–Ω–∞–ª –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é. –†–µ—à–µ–Ω–∏—è: 1) Refeed day –∫–∞–∂–¥—ã–µ 7-10 –¥–Ω–µ–π –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ª–µ–ø—Ç–∏–Ω/–≥–æ—Ä–º–æ–Ω—ã, 2) Diet break (2 –Ω–µ–¥–µ–ª–∏ –Ω–∞ maintenance) –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –º–µ—Ç–∞–±–æ–ª–∏–∑–º, 3) –£–≤–µ–ª–∏—á–µ–Ω–∏–µ NEAT/—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (Int J Obes, 2019).',
            actions: [
                '–£—Å—Ç—Ä–æ–π—Ç–µ refeed day: +10-15% –∫–∞–ª–æ—Ä–∏–π —á–µ—Ä–µ–∑ —É–≥–ª–µ–≤–æ–¥—ã (300-500 –∫–∫–∞–ª) –Ω–∞ 1 –¥–µ–Ω—å',
                '–ü–µ—Ä–µ—Å—á–∏—Ç–∞–π—Ç–µ –Ω–æ—Ä–º—É –∫–∞–ª–æ—Ä–∏–π: –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –≤–µ—Å –≤ –ø—Ä–æ—Ñ–∏–ª—å, –≤–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–µ–Ω –Ω–æ–≤—ã–π target',
                '–£–≤–µ–ª–∏—á—å—Ç–µ NEAT: –ø–∞—Ä–∫—É–π—Ç–µ—Å—å –¥–∞–ª—å—à–µ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–µ—Å—Ç–Ω–∏—Ü—É, –≥—É–ª—è–π—Ç–µ –Ω–∞ —Å–æ–∑–≤–æ–Ω–∞—Ö (+200-400 –∫–∫–∞–ª/–¥–µ–Ω—å)'
            ]
        },
        WEEKEND_PATTERN: {
            title: '–í—ã—Ö–æ–¥–Ω—ã–µ —Å—Ä—ã–≤—ã',
            message: '–ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø–∏—Ç–∞–Ω–∏—è –≤ –°–±/–í—Å —Ö—É–∂–µ, —á–µ–º –≤ –±—É–¥–Ω–∏ ‚Äî –∞–ª–∫–æ–≥–æ–ª—å, —É–≥–ª–µ–≤–æ–¥—ã, —á–∏—Ç–º–∏–ª—ã —Å–±–∏–≤–∞—é—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å.',
            insight: '–í—ã—Ö–æ–¥–Ω—ã–µ —Å—Ä—ã–≤—ã +1500 –∫–∫–∞–ª –º–æ–≥—É—Ç –ø–µ—Ä–µ–∫—Ä—ã—Ç—å –¥–µ—Ñ–∏—Ü–∏—Ç 5 –±—É–¥–Ω–∏—Ö –¥–Ω–µ–π. –°—Ç—Ä–∞—Ç–µ–≥–∏—è: –≥–∏–±–∫–∞—è –¥–∏–µ—Ç–∞ (80/20), –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ refeed –¥–Ω–µ–π, –∫–æ–Ω—Ç—Ä–æ–ª—å –∞–ª–∫–æ–≥–æ–ª—è.',
            science: '–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –∫–∞–ª–æ—Ä–∏–π –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ –Ω–∞ 15-20% –≤—ã—à–µ, —á–µ–º –≤ –±—É–¥–Ω–∏, –∞–ª–∫–æ–≥–æ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç 300-800 –∫–∫–∞–ª (Obesity, 2008). Weekend warrior pattern ‚Äî –æ—á–µ–Ω—å —Å—Ç—Ä–æ–≥–æ –ü–Ω-–ü—Ç, –æ—Ç–∫–∞–∑ –°–±-–í—Å ‚Äî –≤–µ–¥—ë—Ç –∫ binge-restrict cycle. –ê–ª–∫–æ–≥–æ–ª—å –±–ª–æ–∫–∏—Ä—É–µ—Ç –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ –Ω–∞ 12-36 —á–∞—Å–æ–≤, —É—Ö—É–¥—à–∞–µ—Ç —Å–æ–Ω, —Å–Ω–∏–∂–∞–µ—Ç —Å–∏–Ω—Ç–µ–∑ –±–µ–ª–∫–∞ –Ω–∞ 20-30%. –°—Ç—Ä–∞—Ç–µ–≥–∏—è: –≤–∫–ª—é—á–∏—Ç—å –≤—ã—Ö–æ–¥–Ω—ã–µ –≤ –Ω–µ–¥–µ–ª—å–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (calorie cycling), –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—ë–º—ã –ø–∏—â–∏ –∑–∞—Ä–∞–Ω–µ–µ (Nutr J, 2017).',
            actions: [
                '–í–∫–ª—é—á–∏—Ç–µ –≤—ã—Ö–æ–¥–Ω—ã–µ –≤ –Ω–µ–¥–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω: calorie cycling 80/20 (5 –¥–Ω–µ–π –¥–µ—Ñ–∏—Ü–∏—Ç, 2 –¥–Ω—è maintenance)',
                '–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –∞–ª–∫–æ–≥–æ–ª—å –¥–æ 1-2 –ø–æ—Ä—Ü–∏–π: –≤–∏–Ω–æ 150 –º–ª –∏–ª–∏ –ø–∏–≤–æ 330 –º–ª (–±–ª–æ–∫–∏—Ä—É–µ—Ç –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ –Ω–∞ 12-36—á)',
                '–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏ –∑–∞—Ä–∞–Ω–µ–µ: —Å–æ—Å—Ç–∞–≤—å—Ç–µ menu –Ω–∞ –°–±-–í—Å –≤ –ø—è—Ç–Ω–∏—Ü—É –≤–µ—á–µ—Ä–æ–º'
            ]
        },

        // NEW v3.2: Advanced Warnings
        FIBER_DEFICIT: {
            title: '–•—Ä–æ–Ω–∏—á–µ—Å–∫–∏–π –¥–µ—Ñ–∏—Ü–∏—Ç –∫–ª–µ—Ç—á–∞—Ç–∫–∏',
            message: '–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –∫–ª–µ—Ç—á–∞—Ç–∫–∏ –Ω–∏–∂–µ –º–∏–Ω–∏–º—É–º–∞ 5+ –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ ‚Äî —Ä–∏—Å–∫ –¥–ª—è –∫–∏—à–µ—á–Ω–∏–∫–∞ –∏ –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞',
            insight: '–ö–ª–µ—Ç—á–∞—Ç–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞ –¥–ª—è –º–∏–∫—Ä–æ–±–∏–æ–º–∞, –Ω–∞—Å—ã—â–µ–Ω–∏—è –∏ —Ä–µ–≥—É–ª—è—Ü–∏–∏ —Å–∞—Ö–∞—Ä–∞ –∫—Ä–æ–≤–∏. –î–µ—Ñ–∏—Ü–∏—Ç (<15–≥/–¥–µ–Ω—å) –≤–µ–¥—ë—Ç –∫ –¥–∏—Å–±–∏–æ–∑—É, –∑–∞–ø–æ—Ä–∞–º, –ø–æ–≤—ã—à–µ–Ω–Ω–æ–º—É –∞–ø–ø–µ—Ç–∏—Ç—É.',
            science: 'Fiber ‚Äî prebiotic –¥–ª—è –º–∏–∫—Ä–æ–±–∏–æ–º–∞: –Ω–æ—Ä–º–∞ 25-35 –≥/–¥–µ–Ω—å (WHO). –î–µ—Ñ–∏—Ü–∏—Ç (<15 –≥) —Å–Ω–∏–∂–∞–µ—Ç SCFA production (–º–∞—Å–ª—è–Ω–∞—è –∫–∏—Å–ª–æ—Ç–∞ ‚Äî –ø–∏—Ç–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ—Ü–∏—Ç–æ–≤), —É—Ö—É–¥—à–∞–µ—Ç GLP-1 —Å–µ–∫—Ä–µ—Ü–∏—é (–≥–æ—Ä–º–æ–Ω –Ω–∞—Å—ã—â–µ–Ω–∏—è), –ø–æ–≤—ã—à–∞–µ—Ç spike –≥–ª—é–∫–æ–∑—ã –ø–æ—Å–ª–µ –µ–¥—ã. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ NHANES: —Å–≤—è–∑—å <15 –≥ –∫–ª–µ—Ç—á–∞—Ç–∫–∏ —Å +40% —Ä–∏—Å–∫–æ–º obesity, +25% CVD (Nutrients, 2020). –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–ª–µ—Ç—á–∞—Ç–∫–∏ (5 –≥/–Ω–µ–¥) –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≥–∞–∑–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ.',
            actions: [
                '–î–æ–±–∞–≤—å—Ç–µ 5-10–≥ –∫–ª–µ—Ç—á–∞—Ç–∫–∏: 1 —è–±–ª–æ–∫–æ (4–≥) + 30–≥ –æ–≤—Å—è–Ω–∫–∏ (3–≥) + 100–≥ –±—Ä–æ–∫–∫–æ–ª–∏ (3–≥)',
                '–í–∫–ª—é—á–∏—Ç–µ –±–æ–±–æ–≤—ã–µ/—á–µ—á–µ–≤–∏—Ü—É 3-4 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é (8-10–≥ –∫–ª–µ—Ç—á–∞—Ç–∫–∏ –Ω–∞ –ø–æ—Ä—Ü–∏—é)',
                '–ó–∞–º–µ–Ω–∏—Ç–µ –±–µ–ª—ã–π —Ä–∏—Å –Ω–∞ –±—É—Ä—ã–π/–∫–∏–Ω–æ–∞ (+2-3–≥ –∫–ª–µ—Ç—á–∞—Ç–∫–∏ –Ω–∞ –ø–æ—Ä—Ü–∏—é)'
            ]
        },

        SODIUM_EXCESS: {
            title: '–ò–∑–±—ã—Ç–æ–∫ –Ω–∞—Ç—Ä–∏—è',
            message: '–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Å–æ–ª–∏ >4000 –º–≥ 3+ –¥–Ω—è –ø–æ–¥—Ä—è–¥ ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –≤–æ–¥—ã, –ª–æ–∂–Ω—ã–π –≤–µ—Å, —Ä–∏—Å–∫ –¥–ª—è –¥–∞–≤–ª–µ–Ω–∏—è',
            insight: '–ò–∑–±—ã—Ç–æ–∫ –Ω–∞—Ç—Ä–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É 1-3 –∫–≥ –≤–æ–¥—ã, –º–∞—Å–∫–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –≤–µ—Å—É/–∂–∏—Ä—É. –•—Ä–æ–Ω–∏—á–µ—Å–∫–∏ –≤—ã—Å–æ–∫–∏–π –Ω–∞—Ç—Ä–∏–π (>3500 –º–≥) –ø–æ–≤—ã—à–∞–µ—Ç –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ.',
            science: '–ù–æ—Ä–º–∞ –Ω–∞—Ç—Ä–∏—è: 1500-2300 –º–≥/–¥–µ–Ω—å (AHA). –ö–∞–∂–¥—ã–π 1 –≥ –∏–∑–±—ã—Ç–∫–∞ –Ω–∞—Ç—Ä–∏—è –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ~400 –º–ª –≤–æ–¥—ã —á–µ—Ä–µ–∑ ADH/aldosterone –º–µ—Ö–∞–Ω–∏–∑–º. –í—ã—Å–æ–∫–∏–π –Ω–∞—Ç—Ä–∏–π (>4000 –º–≥/–¥–µ–Ω—å) –ø–æ–≤—ã—à–∞–µ—Ç systolic BP –Ω–∞ 5-8 mmHg —É —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –ª—é–¥–µ–π (Hypertension, 2018). Water retention –º–∞—Å–∫–∏—Ä—É–µ—Ç fat loss: –≤–µ—Å —Å—Ç–æ–∏—Ç, –Ω–æ –∂–∏—Ä —É—Ö–æ–¥–∏—Ç. –°—Ç—Ä–∞—Ç–µ–≥–∏—è: —Å–Ω–∏–∑–∏—Ç—å processed foods (70% –Ω–∞—Ç—Ä–∏—è), —É–≤–µ–ª–∏—á–∏—Ç—å –∫–∞–ª–∏–π (–æ–≤–æ—â–∏, —Ñ—Ä—É–∫—Ç—ã) ‚Äî K/Na ratio –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è BP.',
            actions: [
                '–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ processed foods: –∫–æ–ª–±–∞—Å—ã, —Å—ã—Ä, —Å–æ—É—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç 500-1200 –º–≥ –Ω–∞—Ç—Ä–∏—è –Ω–∞ –ø–æ—Ä—Ü–∏—é',
                '–£–≤–µ–ª–∏—á—å—Ç–µ –∫–∞–ª–∏–π –¥–æ 3500 –º–≥/–¥–µ–Ω—å: –±–∞–Ω–∞–Ω—ã, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, –∞–≤–æ–∫–∞–¥–æ (K/Na balance –¥–ª—è –¥–∞–≤–ª–µ–Ω–∏—è)',
                '–ì–æ—Ç–æ–≤—å—Ç–µ –¥–æ–º–∞ –±–µ–∑ —Å–æ–ª–∏: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∏/—Ç—Ä–∞–≤—ã –¥–ª—è –≤–∫—É—Å–∞'
            ]
        },

        CIRCADIAN_DISRUPTION: {
            title: '–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ü–∏—Ä–∫–∞–¥–Ω—ã—Ö —Ä–∏—Ç–º–æ–≤',
            message: '–ü–æ–∑–¥–Ω–∏–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏ (–ø–æ—Å–ª–µ 22:00) –∏–ª–∏ –±–æ–ª—å—à–∞—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏ —Å–Ω–∞ –Ω–∞—Ä—É—à–∞—é—Ç –º–µ—Ç–∞–±–æ–ª–∏–∑–º',
            insight: '–¶–∏—Ä–∫–∞–¥–Ω—ã–µ —Ä–∏—Ç–º—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç insulin sensitivity, cortisol, GHOST production. –ù–∞—Ä—É—à–µ–Ω–∏—è —Å–Ω–∏–∂–∞—é—Ç fat burning, –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞, –ø–æ–≤—ã—à–∞—é—Ç –∞–ø–ø–µ—Ç–∏—Ç.',
            science: 'Peripheral clocks (–ø–µ—á–µ–Ω—å, –∂–∏—Ä–æ–≤–∞—è —Ç–∫–∞–Ω—å, –º—ã—à—Ü—ã) —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å –µ–¥–æ–π. –ü–æ–∑–¥–Ω–∏–π —É–∂–∏–Ω (–ø–æ—Å–ª–µ 22:00) —Å–Ω–∏–∂–∞–µ—Ç insulin sensitivity –Ω–∞ 20-35% vs –¥–Ω–µ–≤–Ω–æ–π –ø—Ä–∏—ë–º (Obesity, 2019). Sleep timing variance >2h –º–µ–∂–¥—É –¥–Ω—è–º–∏ –Ω–∞—Ä—É—à–∞–µ—Ç cortisol rhythm (—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–∏–∫ –≤–∞–∂–µ–Ω –¥–ª—è –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏—è), —Å–Ω–∏–∂–∞–µ—Ç GHOST secretion –Ω–∞ 15-30%. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: eating within 10-hour window (14:00-22:00) vs –ø–æ–∑–¥–Ω–∏–µ –ø–µ—Ä–µ–∫—É—Å—ã ‚Äî +5% fat loss –ø—Ä–∏ —Ç–æ–π –∂–µ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏ (Cell Metab, 2021).',
            actions: [
                '–ó–∞–∫–æ–Ω—á–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∏—ë–º –ø–∏—â–∏ –¥–æ 21:00 (–º–∏–Ω–∏–º—É–º –∑–∞ 2—á –¥–æ —Å–Ω–∞)',
                '–°—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è –æ—Ç—Ö–æ–¥–∞ –∫–æ —Å–Ω—É: –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å <1—á –º–µ–∂–¥—É –¥–Ω—è–º–∏',
                '–ï—Å–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø–æ–∑–¥–Ω–æ ‚Äî –ª—ë–≥–∫–∏–π —É–∂–∏–Ω –ø–æ—Å–ª–µ (–±–µ–ª–æ–∫ + –æ–≤–æ—â–∏, –±–µ–∑ —É–≥–ª–µ–≤–æ–¥–æ–≤)'
            ]
        },

        TRAINING_WITHOUT_RECOVERY: {
            title: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –±–µ–∑ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è',
            message: '3+ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ 5 –¥–Ω–µ–π –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º —Å–Ω–µ (<6.5—á) –∏–ª–∏ –≤—ã—Å–æ–∫–æ–º —Å—Ç—Ä–µ—Å—Å–µ ‚Äî —Ä–∏—Å–∫ overtraining',
            insight: '–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –±–µ–∑ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (—Å–æ–Ω, –ø–∏—Ç–∞–Ω–∏–µ, –Ω–∏–∑–∫–∏–π —Å—Ç—Ä–µ—Å—Å) –≤–µ–¥—É—Ç –∫ overreaching: —Å–Ω–∏–∂–µ–Ω–∏–µ —Å–∏–ª—ã, –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞, —Ä–æ—Å—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª–∞, —Ç—Ä–∞–≤–º—ã.',
            science: 'Recovery triangle: —Å–æ–Ω (7-9—á), –ø–∏—Ç–∞–Ω–∏–µ (–±–µ–ª–æ–∫ 1.6-2.2 –≥/–∫–≥, —É–≥–ª–µ–≤–æ–¥—ã –¥–ª—è –≥–ª–∏–∫–æ–≥–µ–Ω–∞), low stress (cortisol <7). –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö (3+/–Ω–µ–¥–µ–ª—é) –≤–µ–¥—ë—Ç –∫ sympathetic dominance (HRV —Å–Ω–∏–∂–∞–µ—Ç—Å—è), –ø–æ–≤—ã—à–∞–µ—Ç —Ä–∏—Å–∫ injury –Ω–∞ 40-60% (Br J Sports Med, 2016). Sleep <6.5h –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å–Ω–∏–∂–∞–µ—Ç MPS (muscle protein synthesis) –Ω–∞ 18%, —É—Ö—É–¥—à–∞–µ—Ç glycogen replenishment. Stress >7 –ø—Ä–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö ‚Äî cortisol –±–ª–æ–∫–∏—Ä—É–µ—Ç testosterone, –∑–∞–º–µ–¥–ª—è–µ—Ç –∞–¥–∞–ø—Ç–∞—Ü–∏—é.',
            actions: [
                '–£–≤–µ–ª–∏—á—å—Ç–µ —Å–æ–Ω –¥–æ 7-8 —á–∞—Å–æ–≤: –µ—Å–ª–∏ —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç–µ—Å—å 3+ —Ä–∞–∑/–Ω–µ–¥–µ–ª—é, —Å–æ–Ω ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Ññ1',
                '–î–æ–±–∞–≤—å—Ç–µ 1 –¥–µ–Ω—å –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞ –º–µ–∂–¥—É –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–º–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏',
                '–°–Ω–∏–∑—å—Ç–µ —Å—Ç—Ä–µ—Å—Å: meditation 10 –º–∏–Ω/–¥–µ–Ω—å, –ø—Ä–æ–≥—É–ª–∫–∞ 20 –º–∏–Ω (—Å–Ω–∏–∂–∞–µ—Ç cortisol –Ω–∞ 15-25%)'
            ]
        },

        FAT_QUALITY_DECLINE: {
            title: '–°–Ω–∏–∂–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏—Ä–æ–≤',
            message: 'Omega Balancer score <40 –≤ —Ç–µ—á–µ–Ω–∏–µ 7+ –¥–Ω–µ–π ‚Äî –¥–∏—Å–±–∞–ª–∞–Ω—Å –æ–º–µ–≥–∞-3/–æ–º–µ–≥–∞-6, –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ',
            insight: '–ö–∞—á–µ—Å—Ç–≤–æ –∂–∏—Ä–æ–≤ (omega-3 vs omega-6, –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–µ vs –Ω–µ–Ω–∞—Å—ã—â–µ–Ω–Ω—ã–µ) –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ, insulin sensitivity, —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ.',
            science: 'Optimal omega-6/omega-3 ratio: 4:1 to 1:1 (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏–µ—Ç–∞: 15:1 ‚Äî proinflammatory). Omega-3 (EPA/DHA): —Å–Ω–∏–∂–∞—é—Ç TNF-alpha, IL-6 (–º–∞—Ä–∫–µ—Ä—ã –≤–æ—Å–ø–∞–ª–µ–Ω–∏—è), —É–ª—É—á—à–∞—é—Ç insulin sensitivity –Ω–∞ 10-20% (Lipids, 2018). –ò–∑–±—ã—Ç–æ–∫ –Ω–∞—Å—ã—â–µ–Ω–Ω—ã—Ö –∂–∏—Ä–æ–≤ (>10% –∫–∞–ª–æ—Ä–∏–π) –ø—Ä–∏ –Ω–∏–∑–∫–æ–º omega-3 –ø–æ–≤—ã—à–∞–µ—Ç LDL oxidation, endothelial dysfunction. –°—Ç—Ä–∞—Ç–µ–≥–∏—è: –∂–∏—Ä–Ω–∞—è —Ä—ã–±–∞ 2-3 —Ä–∞–∑–∞/–Ω–µ–¥–µ–ª—é (salmon, sardines), –ª—å–Ω—è–Ω–æ–µ –º–∞—Å–ª–æ, –≥—Ä–µ—Ü–∫–∏–µ –æ—Ä–µ—Ö–∏; –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å processed oils (–ø–æ–¥—Å–æ–ª–Ω–µ—á–Ω–æ–µ, –∫—É–∫—É—Ä—É–∑–Ω–æ–µ ‚Äî –≤—ã—Å–æ–∫–∏–π omega-6).',
            actions: [
                '–î–æ–±–∞–≤—å—Ç–µ –∂–∏—Ä–Ω—É—é —Ä—ã–±—É 2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é: –ª–æ—Å–æ—Å—å, —Å–∞—Ä–¥–∏–Ω—ã, —Å–∫—É–º–±—Ä–∏—è (EPA+DHA 1-2–≥)',
                '–ó–∞–º–µ–Ω–∏—Ç–µ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Å–ª–∞ –Ω–∞ –æ–ª–∏–≤–∫–æ–≤–æ–µ/–ª—å–Ω—è–Ω–æ–µ (–≤—ã—à–µ omega-3)',
                '–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ processed foods —Å trans fats: –º–∞—Ä–≥–∞—Ä–∏–Ω, –≤—ã–ø–µ—á–∫–∞ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è'
            ]
        },

        SUGAR_DEPENDENCY: {
            title: '–°–∞—Ö–∞—Ä–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å',
            message: 'Added Sugar Dependency score <35 –≤ —Ç–µ—á–µ–Ω–∏–µ 7+ –¥–Ω–µ–π ‚Äî —á–∞—Å—Ç—ã–µ —Å–ø–∞–π–∫–∏ –≥–ª—é–∫–æ–∑—ã, cravings',
            insight: '–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π —Å–∞—Ö–∞—Ä (>50 –≥/–¥–µ–Ω—å) —Å–æ–∑–¥–∞—ë—Ç dopamine-driven cravings, insulin spikes, accumulation –∂–∏—Ä–∞ –≤ –ø–µ—á–µ–Ω–∏ (NAFLD).',
            science: '–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π —Å–∞—Ö–∞—Ä: –Ω–æ—Ä–º–∞ <25-50 –≥/–¥–µ–Ω—å (WHO: <10% –∫–∞–ª–æ—Ä–∏–π). –ò–∑–±—ã—Ç–æ–∫ (>50 –≥) –ø–æ–≤—ã—à–∞–µ—Ç fructose –≤ –ø–µ—á–µ–Ω—å ‚Üí de novo lipogenesis (—Å–∏–Ω—Ç–µ–∑ –∂–∏—Ä–æ–≤), insulin resistance –≤ –ø–µ—á–µ–Ω–∏, visceral fat accumulation. Frequent sugar spikes –ø–æ–¥–∞–≤–ª—è—é—Ç leptin sensitivity (–≥–æ—Ä–º–æ–Ω –Ω–∞—Å—ã—â–µ–Ω–∏—è), —É—Å–∏–ª–∏–≤–∞—é—Ç dopamine cravings (–∫–∞–∫ addiction pattern). –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: —Å–Ω–∏–∂–µ–Ω–∏–µ added sugar —Å 100–≥ –¥–æ 25–≥/–¥–µ–Ω—å ‚Äî -4% –≤–∏—Å—Ü–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∂–∏—Ä–∞ –∑–∞ 8 –Ω–µ–¥–µ–ª—å –ø—Ä–∏ —Ç–æ–π –∂–µ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏ (Hepatology, 2020).',
            actions: [
                '–°–Ω–∏–∑—å—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π —Å–∞—Ö–∞—Ä –¥–æ <30–≥/–¥–µ–Ω—å: –∏—Å–∫–ª—é—á–∏—Ç–µ —Å–ª–∞–¥–∫–∏–µ –Ω–∞–ø–∏—Ç–∫–∏, —Å–æ–∫–∏ (30-40–≥ –Ω–∞ —Å—Ç–∞–∫–∞–Ω)',
                '–ó–∞–º–µ–Ω–∏—Ç–µ –¥–µ—Å–µ—Ä—Ç—ã –Ω–∞ —Ñ—Ä—É–∫—Ç—ã: 1-2 –ø–æ—Ä—Ü–∏–∏/–¥–µ–Ω—å (fructose –≤ —Ñ—Ä—É–∫—Ç–∞—Ö —Å –∫–ª–µ—Ç—á–∞—Ç–∫–æ–π –±–µ–∑–æ–ø–∞—Å–µ–Ω)',
                '–ß–∏—Ç–∞–π—Ç–µ —ç—Ç–∏–∫–µ—Ç–∫–∏: added sugar —Å–∫—Ä—ã—Ç –≤ —Å–æ—É—Å–∞—Ö, –π–æ–≥—É—Ä—Ç–∞—Ö, granola (5-15–≥ –Ω–∞ –ø–æ—Ä—Ü–∏—é)'
            ]
        },

        MICRONUTRIENT_GAP: {
            title: '–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –¥–µ—Ñ–∏—Ü–∏—Ç –º–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤',
            message: '2+ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –º–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤ —Å score <50 ‚Äî —Ä–∏—Å–∫ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–µ—Ñ–∏—Ü–∏—Ç–æ–≤ (D, Mg, Zn, Fe)',
            insight: '–î–µ—Ñ–∏—Ü–∏—Ç –º–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤ (–≤–∏—Ç–∞–º–∏–Ω D, –º–∞–≥–Ω–∏–π, —Ü–∏–Ω–∫, –∂–µ–ª–µ–∑–æ) —Å–Ω–∏–∂–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é, –∏–º–º—É–Ω–∏—Ç–µ—Ç, –º–µ—Ç–∞–±–æ–ª–∏–∑–º, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ.',
            science: '–ú–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç—ã ‚Äî cofactors –¥–ª—è 300+ —Ñ–µ—Ä–º–µ–Ω—Ç–æ–≤. Vitamin D (<30 ng/ml): —Å–Ω–∏–∂–∞–µ—Ç insulin sensitivity, –∏–º–º—É–Ω–∏—Ç–µ—Ç, testosterone synthesis. Magnesium (<400 mg/day): —É—Ö—É–¥—à–∞–µ—Ç sleep quality, –ø–æ–≤—ã—à–∞–µ—Ç cortisol, —Å–Ω–∏–∂–∞–µ—Ç ATP production (—ç–Ω–µ—Ä–≥–∏—è). Zinc (<11 mg/day –º—É–∂—á–∏–Ω—ã, <8 –º–≥ –∂–µ–Ω—â–∏–Ω—ã): –ø–æ–¥–∞–≤–ª—è–µ—Ç immune function, –∑–∞–º–µ–¥–ª—è–µ—Ç wound healing. Iron deficiency (ferritin <30 ng/ml): fatigue, —Å–Ω–∏–∂–µ–Ω–∏–µ VO2max –Ω–∞ 10-15%. –°—Ç—Ä–∞—Ç–µ–≥–∏—è: —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ (–º—è—Å–æ, —Ä—ã–±–∞, –æ—Ä–µ—Ö–∏, –∑–µ–ª–µ–Ω—å), sunlight 15 –º–∏–Ω/–¥–µ–Ω—å (D), supplementation –ø—Ä–∏ –¥–µ—Ñ–∏—Ü–∏—Ç–µ.',
            actions: [
                '–°–¥–∞–π—Ç–µ –∞–Ω–∞–ª–∏–∑—ã –Ω–∞ D, Mg, Zn, Fe: –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ –¥–µ—Ñ–∏—Ü–∏—Ç—ã —Å –ø–æ–º–æ—â—å—é –≤—Ä–∞—á–∞',
                '–î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ: —à–ø–∏–Ω–∞—Ç/–∑–µ–ª–µ–Ω—å (Mg, Fe), –º—è—Å–æ/–º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã (Zn), —è–π—Ü–∞ (D)',
                '–°–æ–ª–Ω—Ü–µ 15-20 –º–∏–Ω/–¥–µ–Ω—å –±–µ–∑ SPF: —Å–∏–Ω—Ç–µ–∑ –≤–∏—Ç–∞–º–∏–Ω–∞ D (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: D3 supplement 2000-4000 IU)'
            ]
        },

        STEP_DECLINE: {
            title: '–°–Ω–∏–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (—à–∞–≥–∏)',
            message: '–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π —É–ø–∞–ª–æ –Ω–∞ 50%+ –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ –∑–∞ 30 –¥–Ω–µ–π ‚Äî NEAT —Å–Ω–∏–∂–∞–µ—Ç—Å—è',
            insight: 'NEAT (Non-Exercise Activity Thermogenesis) ‚Äî –¥–æ 15-30% daily expenditure. –†–µ–∑–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —à–∞–≥–æ–≤ –∑–∞–º–µ–¥–ª—è–µ—Ç –º–µ—Ç–∞–±–æ–ª–∏–∑–º, —É–º–µ–Ω—å—à–∞–µ—Ç –¥–µ—Ñ–∏—Ü–∏—Ç.',
            science: 'NEAT (—à–∞–≥–∏, fidgeting, —Å—Ç–æ—è–Ω–∏–µ) ‚Äî 200-800 kcal/day —É –∞–∫—Ç–∏–≤–Ω—ã—Ö –ª—é–¥–µ–π. –°–Ω–∏–∂–µ–Ω–∏–µ —à–∞–≥–æ–≤ —Å 10k –¥–æ 5k/day = -200 kcal/day = -1.5 –∫–≥ –∂–∏—Ä–∞ –∑–∞ –º–µ—Å—è—Ü –ø–æ—Ç–µ—Ä—è–Ω–æ (–µ—Å–ª–∏ –Ω–µ –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å diet). –°–∏–¥—è—á–∏–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏ (<5k steps) —Å–Ω–∏–∂–∞–µ—Ç insulin sensitivity –Ω–∞ 15-20% vs 10k+ steps/day (Diabetes Care, 2016). Walking –ø–æ—Å–ª–µ –µ–¥—ã (10-15 –º–∏–Ω) —Å–Ω–∏–∂–∞–µ—Ç glucose spike –Ω–∞ 20-30%. –°—Ç—Ä–∞—Ç–µ–≥–∏—è: walking breaks –∫–∞–∂–¥—ã–µ 90 –º–∏–Ω, standing desk, parking –ø–æ–¥–∞–ª—å—à–µ.',
            actions: [
                '–£–≤–µ–ª–∏—á—å—Ç–µ —à–∞–≥–∏ –Ω–∞ 2000/–¥–µ–Ω—å: 2 –ø—Ä–æ–≥—É–ª–∫–∏ –ø–æ 10 –º–∏–Ω (—É—Ç—Ä–æ + –≤–µ—á–µ—Ä)',
                'Walking after meals: 10-15 –º–∏–Ω –ø–æ—Å–ª–µ –æ–±–µ–¥–∞/—É–∂–∏–Ω–∞ (—Å–Ω–∏–∂–∞–µ—Ç glucose spike –Ω–∞ 20-30%)',
                '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ standing desk 2-3 —á–∞—Å–∞/–¥–µ–Ω—å –∏–ª–∏ walking breaks –∫–∞–∂–¥—ã–µ 90 –º–∏–Ω'
            ]
        },

        MEAL_TIMING_DRIFT: {
            title: '–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏—ë–º–æ–≤ –ø–∏—â–∏',
            message: '–í—Ä–µ–º—è –∑–∞–≤—Ç—Ä–∞–∫–∞ –≤–∞—Ä—å–∏—Ä—É–µ—Ç—Å—è >2.5 —á–∞—Å–æ–≤ –º–µ–∂–¥—É –¥–Ω—è–º–∏ ‚Äî –Ω–∞—Ä—É—à–∞–µ—Ç circadian clocks –∏ –∞–ø–ø–µ—Ç–∏—Ç',
            insight: '–°—Ç–∞–±–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏—ë–º–æ–≤ –ø–∏—â–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç peripheral clocks (–ø–µ—á–µ–Ω—å, –ñ–ö–¢), —É–ª—É—á—à–∞–µ—Ç insulin sensitivity, —Å–Ω–∏–∂–∞–µ—Ç evening cravings.',
            science: 'Food timing ‚Äî zeitgeber (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ç–æ—Ä) –¥–ª—è peripheral clocks. –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è eating (variance >2h) –¥–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç clock genes –≤ –ø–µ—á–µ–Ω–∏/–∂–∏—Ä–æ–≤–æ–π —Ç–∫–∞–Ω–∏ –æ—Ç central circadian clock (SCN). –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: irregular meal timing —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç risk obesity –Ω–∞ 30%, —Å–Ω–∏–∂–∞–µ—Ç postprandial insulin sensitivity –Ω–∞ 10-15% (Proc Nutr Soc, 2020). Consistent breakfast timing —É–ª—É—á—à–∞–µ—Ç morning cortisol peak (–∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏–µ), —Å–Ω–∏–∂–∞–µ—Ç evening ghrelin (–≥–æ–ª–æ–¥). –°—Ç—Ä–∞—Ç–µ–≥–∏—è: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫–Ω–æ –µ–¥—ã (e.g., 08:00-20:00) ¬±1h.',
            actions: [
                '–°—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è –∑–∞–≤—Ç—Ä–∞–∫–∞: ¬±30 –º–∏–Ω –º–µ–∂–¥—É –¥–Ω—è–º–∏ (e.g., 08:00-08:30 –µ–∂–µ–¥–Ω–µ–≤–Ω–æ)',
                '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ eating window 10-12 —á–∞—Å–æ–≤: e.g., 08:00-20:00 (consistent front/back boundary)',
                '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—É–¥–∏–ª—å–Ω–∏–∫ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –æ –ø—Ä–∏—ë–º–∞—Ö –ø–∏—â–∏ –≤ –ø–µ—Ä–≤—ã–µ 2 –Ω–µ–¥–µ–ª–∏'
            ]
        },

        ELECTROLYTE_IMBALANCE: {
            title: '–î–∏—Å–±–∞–ª–∞–Ω—Å —ç–ª–µ–∫—Ç—Ä–æ–ª–∏—Ç–æ–≤',
            message: 'Electrolyte Homeostasis score <40 –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö ‚Äî —Ä–∏—Å–∫ —Å—É–¥–æ—Ä–æ–≥, –ø–∞–¥–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
            insight: '–≠–ª–µ–∫—Ç—Ä–æ–ª–∏—Ç—ã (Na, K, Mg, Ca) –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –º—ã—à–µ—á–Ω—ã—Ö —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π, hydration, nerve conduction. –î–∏—Å–±–∞–ª–∞–Ω—Å –ø—Ä–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö —Å–Ω–∏–∂–∞–µ—Ç —Å–∏–ª—É, –≤—ã–∑—ã–≤–∞–µ—Ç —Å—É–¥–æ—Ä–æ–≥–∏.',
            science: 'Electrolyte losses: –ø–æ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç Na 500-1200 mg/L, K 150-300 mg/L, Mg 20-50 mg/L. –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ (60+ –º–∏–Ω) ‚Äî –ø–æ—Ç–µ—Ä—è 1-2L –ø–æ—Ç–∞ = 1000-2000 mg Na, 200-400 mg K. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –≤–æ—Å–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Üí –º—ã—à–µ—á–Ω—ã–µ —Å—É–¥–æ—Ä–æ–≥–∏ (Mg, Ca), –ø–∞–¥–µ–Ω–∏–µ —Å–∏–ª—ã –Ω–∞ 10-15% (dehydration + electrolyte depletion), arrhythmias –ø—Ä–∏ severe –¥–µ—Ñ–∏—Ü–∏—Ç–µ. –°—Ç—Ä–∞—Ç–µ–≥–∏—è: electrolyte drink –ø—Ä–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö >60 –º–∏–Ω (Na 300-600 mg, K 100-200 mg –Ω–∞ –ø–æ—Ä—Ü–∏—é), —É–≤–µ–ª–∏—á–∏—Ç—å –æ–≤–æ—â–∏/—Ñ—Ä—É–∫—Ç—ã (K, Mg).',
            actions: [
                '–î–æ–±–∞–≤—å—Ç–µ electrolyte drink –ø—Ä–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö >60 –º–∏–Ω: Na 300-600 –º–≥, K 100-200 –º–≥',
                '–£–≤–µ–ª–∏—á—å—Ç–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ K/Mg: –±–∞–Ω–∞–Ω—ã, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å (K 400-600 –º–≥), —à–ø–∏–Ω–∞—Ç/–æ—Ä–µ—Ö–∏ (Mg 80-150 –º–≥)',
                '–°–æ–ª–∏—Ç–µ –ø–∏—â—É –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏: 1/4 —á.–ª. —Å–æ–ª–∏ (500 –º–≥ Na) –¥–ª—è –≤–æ—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—Ç–µ—Ä—å —Å –ø–æ—Ç–æ–º'
            ]
        }
    };

    // ========================================
    // Warning Trends Tracking (v3.1)
    // ========================================

    /**
     * Load warning trends from localStorage
     * @returns {Object} Trends data structure
     */
    function loadTrends() {
        console.info('ews / trends üöÄ load:', { key: TRENDS_STORAGE_KEY });

        try {
            const stored = localStorage.getItem(TRENDS_STORAGE_KEY);
            if (!stored) {
                console.info('ews / trends üì• load.empty:', { reason: 'no_stored_data' });
                return { version: 1, trends: {}, lastUpdated: null };
            }

            const parsed = JSON.parse(stored);
            console.info('ews / trends ‚úÖ load.success:', {
                warningTypes: Object.keys(parsed.trends || {}).length,
                lastUpdated: parsed.lastUpdated
            });
            return parsed;
        } catch (error) {
            console.error('ews / trends ‚ùå load.error:', error.message);
            return { version: 1, trends: {}, lastUpdated: null };
        }
    }

    /**
     * Save warning trends to localStorage
     * @param {Object} trendsData - Trends data structure
     */
    function saveTrends(trendsData) {
        console.info('ews / trends üöÄ save:', {
            warningTypesCount: Object.keys(trendsData.trends || {}).length
        });

        try {
            localStorage.setItem(TRENDS_STORAGE_KEY, JSON.stringify(trendsData));
            console.info('ews / trends ‚úÖ save.success:', {
                size: JSON.stringify(trendsData).length,
                lastUpdated: trendsData.lastUpdated
            });
        } catch (error) {
            console.error('ews / trends ‚ùå save.error:', error.message);
        }
    }

    /**
     * Track warning occurrences and calculate frequency
     * @param {Array} warnings - Current warnings from detectEarlyWarnings
     * @returns {Object} Top chronic warnings with frequency data
     */
    function trackWarningTrends(warnings) {
        console.info('ews / trends üöÄ start:', {
            currentWarnings: warnings.length,
            types: warnings.map(w => w.type)
        });

        // Load existing trends
        const trendsData = loadTrends();
        const today = new Date().toISOString().split('T')[0]; // 'YYYY-MM-DD'
        const todayTimestamp = new Date(today).getTime();

        console.info('ews / trends üì• input:', {
            date: today,
            existingTypes: Object.keys(trendsData.trends).length
        });

        // Update occurrences for each warning
        warnings.forEach(warning => {
            const warningType = warning.type;

            if (!trendsData.trends[warningType]) {
                trendsData.trends[warningType] = {
                    occurrences: [],
                    frequency14d: 0,
                    frequency30d: 0
                };
            }

            const trend = trendsData.trends[warningType];

            // Add today's occurrence if not already recorded
            const alreadyRecorded = trend.occurrences.some(occ => occ.date === today);
            if (!alreadyRecorded) {
                trend.occurrences.push({
                    date: today,
                    timestamp: todayTimestamp,
                    severity: warning.severity
                });
            }
        });

        console.info('ews / trends üßÆ compute:', {
            phase: 'cleanup_old_occurrences',
            maxAge: TRENDS_CONFIG.MAX_AGE_DAYS
        });

        // Cleanup old occurrences (>30 days) and calculate frequencies
        const cutoff30d = todayTimestamp - (TRENDS_CONFIG.MAX_AGE_DAYS * 24 * 60 * 60 * 1000);
        const cutoff14d = todayTimestamp - (TRENDS_CONFIG.FREQUENCY_WINDOW_14D * 24 * 60 * 60 * 1000);

        Object.keys(trendsData.trends).forEach(warningType => {
            const trend = trendsData.trends[warningType];

            // Keep only occurrences within 30 days
            trend.occurrences = trend.occurrences.filter(occ => occ.timestamp >= cutoff30d);

            // Calculate frequencies
            trend.frequency30d = trend.occurrences.length;
            trend.frequency14d = trend.occurrences.filter(occ => occ.timestamp >= cutoff14d).length;

            // Remove trend if no occurrences left
            if (trend.occurrences.length === 0) {
                delete trendsData.trends[warningType];
            }
        });

        // Update metadata
        trendsData.lastUpdated = today;

        console.info('ews / trends üßÆ compute.frequencies:', {
            activeTypes: Object.keys(trendsData.trends).length,
            totalOccurrences: Object.values(trendsData.trends).reduce((sum, t) => sum + t.frequency30d, 0)
        });

        // Save updated trends
        saveTrends(trendsData);

        // Calculate top-3 chronic warnings (by 30-day frequency)
        const chronicWarnings = Object.entries(trendsData.trends)
            .map(([type, trend]) => ({
                type,
                frequency14d: trend.frequency14d,
                frequency30d: trend.frequency30d,
                lastOccurrence: trend.occurrences[trend.occurrences.length - 1]?.date
            }))
            .sort((a, b) => b.frequency30d - a.frequency30d)
            .slice(0, TRENDS_CONFIG.TOP_CHRONIC_COUNT);

        console.info('ews / trends ‚úÖ result:', {
            topChronicCount: chronicWarnings.length,
            topTypes: chronicWarnings.map(w => w.type),
            frequencies: chronicWarnings.map(w => `${w.frequency14d}d14/${w.frequency30d}d30`)
        });

        console.group('ews / trends üñ•Ô∏è ui.chronic_warnings - Top 3');
        console.table(chronicWarnings.map(w => ({
            'Warning Type': w.type,
            '14d': w.frequency14d,
            '30d': w.frequency30d,
            'Last': w.lastOccurrence
        })));
        console.groupEnd();

        console.info('ews / trends üñ•Ô∏è ui.complete:', {
            chronicDisplayed: chronicWarnings.length
        });

        return {
            chronicWarnings,
            allTrends: trendsData.trends
        };
    }

    /**
     * Prioritize warnings by severity √ó frequency √ó health impact
     * @param {Array} warnings - Current warnings from detectEarlyWarnings
     * @param {Object} trendsData - Trends data with frequency information
     * @returns {Array} Prioritized warnings with priority scores
     */
    function prioritizeWarnings(warnings, trendsData) {
        console.info('ews / priority üöÄ start:', {
            warningsCount: warnings.length,
            hasTrends: !!trendsData
        });

        if (!warnings || warnings.length === 0) {
            console.info('ews / priority ‚ö†Ô∏è input.empty:', { reason: 'no_warnings' });
            return [];
        }

        console.info('ews / priority üì• input:', {
            warnings: warnings.map(w => w.type),
            trendsAvailable: Object.keys(trendsData?.trends || {}).length
        });

        console.info('ews / priority üßÆ compute:', {
            phase: 'calculating_scores',
            formula: 'severity_weight √ó frequency14d √ó health_impact'
        });

        // Calculate priority score for each warning
        const prioritizedWarnings = warnings.map(warning => {
            const warningType = warning.type;
            const severityWeight = SEVERITY_WEIGHTS[warning.severity] || 1;
            const healthImpact = HEALTH_IMPACT_SCORES[warningType] || 50; // default 50 if not defined
            const frequency14d = trendsData?.trends?.[warningType]?.frequency14d || 1; // at least 1 (today)

            // Priority formula: severity (1-3) √ó frequency (1-14) √ó health impact (0-100)
            const priorityScore = severityWeight * frequency14d * healthImpact;

            return {
                ...warning,
                priorityScore,
                frequency14d,
                healthImpact,
                severityWeight
            };
        });

        // Sort by priority score descending
        prioritizedWarnings.sort((a, b) => b.priorityScore - a.priorityScore);

        // Mark top-3 as critical priority
        const top3 = prioritizedWarnings.slice(0, 3);
        top3.forEach(w => {
            w.criticalPriority = true;
            w.priorityLabel = 'üî• Fix First!';
        });

        console.info('ews / priority ‚úÖ result:', {
            totalWarnings: prioritizedWarnings.length,
            top3Types: top3.map(w => w.type),
            top3Scores: top3.map(w => w.priorityScore),
            averageScore: Math.round(prioritizedWarnings.reduce((sum, w) => sum + w.priorityScore, 0) / prioritizedWarnings.length)
        });

        console.group('ews / priority üñ•Ô∏è ui.top3 - Critical Priority');
        console.table(top3.map(w => ({
            'Type': w.type,
            'Severity': w.severity,
            'Freq 14d': w.frequency14d,
            'Health Impact': w.healthImpact,
            'Priority Score': w.priorityScore,
            'Label': w.priorityLabel
        })));
        console.groupEnd();

        console.info('ews / priority üñ•Ô∏è ui.complete:', {
            criticalPriorityCount: top3.length,
            totalPrioritized: prioritizedWarnings.length
        });

        return prioritizedWarnings;
    }

    // ========================================
    // Weekly Progress Tracking (Wave 3.1)
    // ========================================

    /**
     * Load weekly progress data (localStorage + cloud sync)
     * @returns {Object} Weekly progress data structure
     */
    async function loadWeeklyProgress() {

        console.info('ews / weekly üöÄ load:', { key: WEEKLY_PROGRESS_STORAGE_KEY });

        // 1. Try cloud first (if enabled)
        if (CLOUD_SYNC_CONFIG.ENABLED && typeof HEYS?.YandexAPI?.rpc === 'function') {
            try {
                // Helper: validate token is not null/undefined/empty string
                const isValidToken = (token) => {
                    if (!token) return false;
                    const str = String(token).trim();
                    if (str === '' || str === 'null' || str === 'undefined') return false;
                    return true;
                };

                // Get session token for authentication (with multiple fallbacks)
                let sessionToken = null;

                // Attempt 1: HEYS.auth API
                sessionToken = HEYS.auth?.getSessionToken?.();
                console.info('ews / weekly üîç token.attempt1 (HEYS.auth):', sessionToken ? `found: ${String(sessionToken).slice(0, 16)}...` : 'NOT FOUND');
                if (!isValidToken(sessionToken)) sessionToken = null;

                // Attempt 2: Direct localStorage read
                if (!sessionToken) {
                    const raw = localStorage.getItem('heys_session_token');
                    console.info('ews / weekly üîç token.attempt2 (localStorage direct):', raw ? `found: ${String(raw).slice(0, 40)}...` : 'NOT FOUND');
                    if (raw && isValidToken(raw)) {
                        try {
                            const parsed = JSON.parse(raw);
                            sessionToken = isValidToken(parsed) ? parsed : null;
                        } catch {
                            sessionToken = raw;
                        }
                    }
                }

                // Attempt 3: Using HEYS.utils.lsGet (namespace-aware)
                if (!sessionToken && typeof HEYS?.utils?.lsGet === 'function') {
                    const tokenViaUtils = HEYS.utils.lsGet('heys_session_token', null);
                    console.info('ews / weekly üîç token.attempt3 (U.lsGet):', tokenViaUtils ? `found: ${String(tokenViaUtils).slice(0, 16)}...` : 'NOT FOUND');
                    if (isValidToken(tokenViaUtils)) {
                        sessionToken = tokenViaUtils;
                    }
                }

                // Attempt 4: Namespaced key (legacy migration)
                if (!sessionToken) {
                    const clientId = localStorage.getItem('heys_pin_auth_client') || localStorage.getItem('heys_client_current');
                    if (clientId) {
                        const cid = String(clientId).replace(/"/g, '');
                        const namespacedKey = `heys_${cid}_session_token`;
                        const namespacedToken = localStorage.getItem(namespacedKey);
                        console.info('ews / weekly üîç token.attempt4 (namespaced):', namespacedToken ? `found at ${namespacedKey}: ${String(namespacedToken).slice(0, 16)}...` : `NOT FOUND at ${namespacedKey}`);
                        if (namespacedToken && isValidToken(namespacedToken)) {
                            try {
                                const parsed = JSON.parse(namespacedToken);
                                sessionToken = isValidToken(parsed) ? parsed : null;
                            } catch {
                                sessionToken = namespacedToken;
                            }
                        }
                    } else {
                        console.info('ews / weekly üîç token.attempt4 (namespaced): SKIPPED (no clientId found)');
                    }
                }

                // Attempt 5: Curator session (for curator access)
                if (!sessionToken) {
                    const curatorToken = localStorage.getItem('heys_curator_session');
                    console.info('ews / weekly üîç token.attempt5 (curator_session):', curatorToken ? `found: ${String(curatorToken).slice(0, 16)}...` : 'NOT FOUND');
                    if (isValidToken(curatorToken)) {
                        sessionToken = curatorToken;
                    }
                }

                if (!sessionToken) {
                    console.warn('ews / weekly ‚òÅÔ∏è load.cloud.skip: no valid session token after 5 attempts');
                    throw new Error('No session token available');
                }

                console.info('ews / weekly ‚úÖ token.final:', `using token: ${String(sessionToken).slice(0, 16)}...`);
                console.info('ews / weekly ‚òÅÔ∏è load.cloud.start');
                const { data: cloudData, error: cloudError } = await Promise.race([
                    HEYS.YandexAPI.rpc('get_weekly_snapshots_by_session', {
                        p_session_token: sessionToken,
                        p_weeks_count: WEEKLY_CONFIG.WEEKS_TO_TRACK
                    }),
                    new Promise((_, reject) => setTimeout(
                        () => reject(new Error('Cloud load timeout')),
                        CLOUD_SYNC_CONFIG.LOAD_TIMEOUT_MS
                    ))
                ]);

                if (cloudError) {
                    throw new Error(cloudError.message || 'Cloud load failed');
                }

                if (cloudData && Array.isArray(cloudData) && cloudData.length > 0) {
                    const weeks = cloudData.map(row => ({
                        weekStart: row.week_start,
                        weekEnd: row.week_end,
                        weekNumber: row.week_number,
                        year: row.year,
                        warningsCount: row.warnings_count,
                        globalScore: row.global_score,
                        severityBreakdown: row.severity_breakdown,
                        topWarnings: row.top_warnings,
                        lastUpdate: row.updated_at?.split('T')[0] || row.week_start,
                        lastUpdateTimestamp: new Date(row.updated_at || row.week_start).getTime()
                    }));

                    console.info('ews / weekly ‚òÅÔ∏è load.cloud.success:', {
                        weeksLoaded: weeks.length,
                        source: 'cloud'
                    });

                    // Save to localStorage for fast access
                    const progressData = { version: 1, weeks, lastUpdated: weeks[0]?.lastUpdate || null };
                    try {
                        localStorage.setItem(WEEKLY_PROGRESS_STORAGE_KEY, JSON.stringify(progressData));
                        console.info('ews / weekly üíæ cached locally from cloud');
                    } catch (e) {
                        console.warn('ews / weekly ‚ö†Ô∏è localStorage cache failed:', e.message);
                    }

                    return progressData;
                }

                console.info('ews / weekly ‚òÅÔ∏è load.cloud.empty: no data in cloud');
            } catch (error) {
                console.error('ews / weekly ‚òÅÔ∏è load.cloud.error:', {
                    message: error.message,
                    code: error.code,
                    details: error.details,
                    raw: error.raw,
                    stack: error.stack?.split('\n')[0]
                });
                if (!CLOUD_SYNC_CONFIG.FALLBACK_TO_LOCAL) {
                    throw error;
                }
                console.info('ews / weekly üíæ falling back to localStorage');
            }
        }

        // 2. Fallback to localStorage
        try {
            const stored = localStorage.getItem(WEEKLY_PROGRESS_STORAGE_KEY);
            if (!stored) {
                console.info('ews / weekly üì• load.empty:', { reason: 'no_stored_data', source: 'localStorage' });
                return { version: 1, weeks: [], lastUpdated: null };
            }

            const parsed = JSON.parse(stored);
            console.info('ews / weekly ‚úÖ load.success:', {
                weeksStored: parsed.weeks?.length || 0,
                lastUpdated: parsed.lastUpdated,
                source: 'localStorage'
            });
            return parsed;
        } catch (error) {
            console.error('ews / weekly ‚ùå load.error:', error.message);
            return { version: 1, weeks: [], lastUpdated: null };
        }
    }

    /**
     * Save weekly progress data (localStorage + cloud sync)
     * @param {Object} progressData - Weekly progress data structure
     * @param {Object} currentWeekSnapshot - Current week snapshot for cloud upsert
     */
    async function saveWeeklyProgress(progressData, currentWeekSnapshot = null) {
        console.info('ews / weekly üöÄ save:', {
            weeksCount: progressData.weeks?.length || 0
        });

        // 1. Save to localStorage first (fast, always succeeds)
        try {
            localStorage.setItem(WEEKLY_PROGRESS_STORAGE_KEY, JSON.stringify(progressData));
            console.info('ews / weekly ‚úÖ save.success:', {
                size: JSON.stringify(progressData).length,
                lastUpdated: progressData.lastUpdated,
                target: 'localStorage'
            });
        } catch (error) {
            console.error('ews / weekly ‚ùå save.error:', error.message);
        }

        // 2. Sync current week to cloud (if enabled)
        if (CLOUD_SYNC_CONFIG.ENABLED && currentWeekSnapshot && typeof HEYS?.YandexAPI?.rpc === 'function') {
            try {
                // Helper function: validate token content (not just existence)
                const isValidToken = (token) => {
                    if (!token) return false;
                    const str = String(token).trim();
                    // Reject literal strings "null"/"undefined" and empty values
                    if (str === '' || str === 'null' || str === 'undefined') return false;
                    return true;
                };

                // Get session token: multi-tier fallback with validation
                let sessionToken = null;

                // Attempt 1: HEYS.auth API
                sessionToken = HEYS.auth?.getSessionToken?.();
                console.info('ews / weekly üîç token.attempt1 (HEYS.auth):', sessionToken ? `found: ${sessionToken.slice(0, 16)}...` : 'NOT FOUND');
                if (!isValidToken(sessionToken)) sessionToken = null;

                // Attempt 2: localStorage direct (JSON.parse safe)
                if (!sessionToken) {
                    const raw = localStorage.getItem('heys_session_token');
                    console.info('ews / weekly üîç token.attempt2 (localStorage direct):', raw ? `found: ${String(raw).slice(0, 16)}...` : 'NOT FOUND');
                    if (raw && isValidToken(raw)) {
                        try {
                            const parsed = JSON.parse(raw);
                            sessionToken = isValidToken(parsed) ? parsed : null;
                        } catch {
                            sessionToken = raw; // Use raw string if not JSON
                        }
                    }
                }

                // Attempt 3: HEYS.utils.lsGet (namespace-aware)
                if (!sessionToken) {
                    const tokenViaUtils = HEYS.utils.lsGet('heys_session_token', null);
                    console.info('ews / weekly üîç token.attempt3 (U.lsGet):', tokenViaUtils ? `found: ${String(tokenViaUtils).slice(0, 16)}...` : 'NOT FOUND');
                    if (isValidToken(tokenViaUtils)) {
                        sessionToken = tokenViaUtils;
                    }
                }

                // Attempt 4: Namespaced key (legacy migration)
                if (!sessionToken) {
                    const cid = HEYS.getCurrentClientId?.() || HEYS.clientId;
                    if (cid) {
                        const namespacedKey = `heys_${cid}_session_token`;
                        const namespacedToken = localStorage.getItem(namespacedKey);
                        console.info('ews / weekly üîç token.attempt4 (namespaced):', namespacedToken ? `found at ${namespacedKey}: ${String(namespacedToken).slice(0, 16)}...` : `NOT FOUND at ${namespacedKey}`);
                        if (namespacedToken && isValidToken(namespacedToken)) {
                            try {
                                const parsed = JSON.parse(namespacedToken);
                                sessionToken = isValidToken(parsed) ? parsed : null;
                            } catch {
                                sessionToken = namespacedToken;
                            }
                        }
                    } else {
                        console.info('ews / weekly üîç token.attempt4 (namespaced): SKIPPED (no clientId found)');
                    }
                }

                // Attempt 5: Curator session (alternative auth mechanism)
                if (!sessionToken) {
                    const curatorToken = localStorage.getItem('heys_curator_session');
                    console.info('ews / weekly üîç token.attempt5 (curator_session):', curatorToken ? `found: ${String(curatorToken).slice(0, 16)}...` : 'NOT FOUND');
                    if (isValidToken(curatorToken)) {
                        sessionToken = curatorToken;
                    }
                }

                // Final validation
                if (!sessionToken) {
                    console.warn('ews / weekly ‚òÅÔ∏è save.cloud.skip: no valid session token after 5 attempts');
                    return;
                }

                console.info('ews / weekly ‚úÖ token.final: using token:', `${String(sessionToken).slice(0, 16)}...`);
                console.info('ews / weekly ‚òÅÔ∏è save.cloud.start:', {
                    weekStart: currentWeekSnapshot.weekStart
                });

                const { data: result, error: saveError } = await Promise.race([
                    HEYS.YandexAPI.rpc('upsert_weekly_snapshot_by_session', {
                        p_session_token: sessionToken,
                        p_week_start: currentWeekSnapshot.weekStart,
                        p_week_end: currentWeekSnapshot.weekEnd,
                        p_week_number: currentWeekSnapshot.weekNumber,
                        p_year: currentWeekSnapshot.year,
                        p_warnings_count: currentWeekSnapshot.warningsCount,
                        p_global_score: currentWeekSnapshot.globalScore,
                        p_severity_breakdown: currentWeekSnapshot.severityBreakdown,
                        p_top_warnings: currentWeekSnapshot.topWarnings
                    }),
                    new Promise((_, reject) => setTimeout(
                        () => reject(new Error('Cloud save timeout')),
                        CLOUD_SYNC_CONFIG.SAVE_TIMEOUT_MS
                    ))
                ]);

                // Extract response (handle both array and object formats)
                const response = Array.isArray(result) ? result[0] : result;

                if (saveError) {
                    console.warn('ews / weekly ‚òÅÔ∏è save.cloud.error:', saveError.message);
                } else if (response?.success) {
                    console.info('ews / weekly ‚òÅÔ∏è save.cloud.success:', {
                        action: response.message,
                        snapshotId: response.snapshot_id
                    });
                } else if (response?.message === 'invalid_or_expired_session') {
                    // Graceful degradation: curator session token doesn't have write permissions
                    console.info('ews / weekly ‚òÅÔ∏è save.cloud.skip: curator_mode (no client session)');
                } else {
                    console.warn('ews / weekly ‚òÅÔ∏è save.cloud.failed:', {
                        message: response?.message || 'unknown_error',
                        response
                    });
                }
            } catch (error) {
                console.error('ews / weekly ‚òÅÔ∏è save.cloud.error:', {
                    message: error.message,
                    code: error.code,
                    details: error.details,
                    raw: error.raw,
                    stack: error.stack?.split('\n')[0]
                });
                // Non-critical: localStorage already saved
            }
        }
    }

    /**
     * Get week boundaries (Monday 00:00 to Sunday 23:59)
     * @param {Date} date - Reference date
     * @returns {Object} Week start and end dates
     */
    function getWeekBoundaries(date) {
        const d = new Date(date);
        const day = d.getDay(); // 0 = Sunday, 1 = Monday, ...
        const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Adjust to Monday

        const weekStart = new Date(d.setDate(diff));
        weekStart.setHours(0, 0, 0, 0);

        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6);
        weekEnd.setHours(23, 59, 59, 999);

        return {
            weekStart: weekStart.toISOString().split('T')[0],
            weekEnd: weekEnd.toISOString().split('T')[0],
            weekStartTimestamp: weekStart.getTime(),
            weekEndTimestamp: weekEnd.getTime()
        };
    }

    /**
     * Get ISO week number for a date
     * @param {Date} date - Date to get week number for
     * @returns {number} ISO week number (1-53)
     */
    function getWeekNumber(date) {
        const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        const dayNum = d.getUTCDay() || 7;
        d.setUTCDate(d.getUTCDate() + 4 - dayNum);
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
        return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }

    /**
     * Determine weekly trend (improving/stable/worsening)
     * @param {Array} weeks - Array of weekly snapshots (sorted newest first)
     * @returns {Object} Trend analysis
     */
    function determineWeeklyTrend(weeks) {
        console.info('ews / weekly üßÆ trend:', {
            phase: 'analysis',
            weeksCount: weeks.length
        });

        if (weeks.length < 2) {
            console.info('ews / weekly ‚ö†Ô∏è trend.insufficient:', {
                reason: 'need_at_least_2_weeks',
                current: weeks.length
            });
            return {
                status: 'insufficient_data',
                direction: null,
                percentChange: 0,
                description: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö (–Ω—É–∂–Ω–æ ‚â•2 –Ω–µ–¥–µ–ª—å)'
            };
        }

        const currentWeek = weeks[0]; // Newest
        const previousWeek = weeks[1];

        const currentCount = currentWeek.warningsCount;
        const previousCount = previousWeek.warningsCount;

        // Calculate percent change
        const percentChange = previousCount === 0
            ? (currentCount > 0 ? 100 : 0)
            : Math.round(((currentCount - previousCount) / previousCount) * 100);

        let status, direction, description;

        if (percentChange <= WEEKLY_CONFIG.IMPROVEMENT_THRESHOLD) {
            status = 'improving';
            direction = 'down';
            description = `–£–ª—É—á—à–µ–Ω–∏–µ: ${Math.abs(percentChange)}% –º–µ–Ω—å—à–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π`;
        } else if (percentChange >= WEEKLY_CONFIG.STABLE_THRESHOLD) {
            status = 'worsening';
            direction = 'up';
            description = `–£—Ö—É–¥—à–µ–Ω–∏–µ: +${percentChange}% –±–æ–ª—å—à–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π`;
        } else {
            status = 'stable';
            direction = 'flat';
            description = `–°—Ç–∞–±–∏–ª—å–Ω–æ: ¬±${Math.abs(percentChange)}% (–Ω–æ—Ä–º–∞)`;
        }

        console.info('ews / weekly ‚úÖ trend.result:', {
            status,
            direction,
            percentChange,
            current: currentCount,
            previous: previousCount
        });

        return {
            status,
            direction,
            percentChange,
            currentCount,
            previousCount,
            description
        };
    }

    /**
     * Backfill weekly snapshots from historical data
     * Creates snapshots for last N weeks using historical day data
     * @param {Array} allDays - All available historical day data (sorted newest first)
     * @param {Object} profile - User profile
     * @param {Array} pIndex - Product index
     * @param {number} weeksToBackfill - Number of weeks to backfill (default: 4)
     * @returns {Promise<Object>} { success, weeksCreated, snapshots }
     */
    async function backfillWeeklySnapshots(allDays, profile, pIndex, weeksToBackfill = 4) {
        console.info('ews / weekly üîÑ backfill.start:', {
            totalDays: allDays.length,
            weeksToBackfill
        });

        if (!allDays || allDays.length < 7) {
            console.warn('ews / weekly ‚ö†Ô∏è backfill.insufficient_data:', {
                daysAvailable: allDays?.length || 0,
                required: 7
            });
            return { success: false, weeksCreated: 0, reason: 'insufficient_data' };
        }

        const snapshots = [];
        const today = new Date();

        // Generate week boundaries for last N weeks
        for (let weekOffset = 0; weekOffset < weeksToBackfill; weekOffset++) {
            const weekDate = new Date(today);
            weekDate.setDate(weekDate.getDate() - (weekOffset * 7));

            const weekBoundaries = getWeekBoundaries(weekDate);
            console.info(`ews / weekly üîÑ backfill.week_${weekOffset + 1}:`, {
                weekStart: weekBoundaries.weekStart,
                weekEnd: weekBoundaries.weekEnd
            });

            // Filter days for this specific week
            const weekDays = allDays.filter(day => {
                const dayDate = day.date;
                return dayDate >= weekBoundaries.weekStart && dayDate <= weekBoundaries.weekEnd;
            });

            if (weekDays.length === 0) {
                console.info(`ews / weekly ‚è≠Ô∏è backfill.skip_week_${weekOffset + 1}: no data`);
                continue;
            }

            console.info(`ews / weekly üßÆ backfill.compute_week_${weekOffset + 1}:`, {
                daysInWeek: weekDays.length
            });

            // Run detect() for this week (use mode depending on days available)
            const mode = weekDays.length >= 14 ? 'full' : 'acute';
            try {
                const weekResult = await detectEarlyWarnings(weekDays, profile, pIndex, {
                    mode,
                    includeDetails: true
                });

                if (!weekResult.available) {
                    console.warn(`ews / weekly ‚ö†Ô∏è backfill.week_${weekOffset + 1}.unavailable`);
                    continue;
                }

                // Create snapshot for this week
                const snapshot = {
                    weekStart: weekBoundaries.weekStart,
                    weekEnd: weekBoundaries.weekEnd,
                    weekNumber: getWeekNumber(weekDate),
                    year: weekDate.getFullYear(),
                    warningsCount: weekResult.count || 0,
                    globalScore: weekResult.globalScore || 0,
                    severityBreakdown: {
                        high: weekResult.highSeverityCount || 0,
                        medium: (weekResult.count || 0) - (weekResult.highSeverityCount || 0),
                        low: 0
                    },
                    topWarnings: (weekResult.warnings || [])
                        .slice(0, 3)
                        .map(w => ({ type: w.type, severity: w.severity })),
                    lastUpdate: weekBoundaries.weekEnd, // Use week end as update date
                    lastUpdateTimestamp: new Date(weekBoundaries.weekEnd).getTime()
                };

                snapshots.push(snapshot);

                console.info(`ews / weekly ‚úÖ backfill.week_${weekOffset + 1}.created:`, {
                    warnings: snapshot.warningsCount,
                    globalScore: snapshot.globalScore
                });

                // Upload to cloud immediately
                if (CLOUD_SYNC_CONFIG.ENABLED && typeof HEYS?.YandexAPI?.rpc === 'function') {
                    try {
                        // Helper function: validate token content (not just existence)
                        const isValidToken = (token) => {
                            if (!token) return false;
                            const str = String(token).trim();
                            // Reject literal strings "null"/"undefined" and empty values
                            if (str === '' || str === 'null' || str === 'undefined') return false;
                            return true;
                        };

                        // Get session token: multi-tier fallback with validation
                        let sessionToken = null;

                        // Attempt 1: HEYS.auth API
                        sessionToken = HEYS.auth?.getSessionToken?.();
                        console.info('ews / weekly üîç token.attempt1 (HEYS.auth):', sessionToken ? `found: ${String(sessionToken).slice(0, 16)}...` : 'NOT FOUND');
                        if (!isValidToken(sessionToken)) sessionToken = null;

                        // Attempt 2: localStorage direct (JSON.parse safe)
                        if (!sessionToken) {
                            const raw = localStorage.getItem('heys_session_token');
                            console.info('ews / weekly üîç token.attempt2 (localStorage direct):', raw ? `found: ${String(raw).slice(0, 16)}...` : 'NOT FOUND');
                            if (raw && isValidToken(raw)) {
                                try {
                                    const parsed = JSON.parse(raw);
                                    sessionToken = isValidToken(parsed) ? parsed : null;
                                } catch {
                                    sessionToken = raw; // Use raw string if not JSON
                                }
                            }
                        }

                        // Attempt 3: HEYS.utils.lsGet (namespace-aware)
                        if (!sessionToken) {
                            const tokenViaUtils = HEYS.utils.lsGet('heys_session_token', null);
                            console.info('ews / weekly üîç token.attempt3 (U.lsGet):', tokenViaUtils ? `found: ${String(tokenViaUtils).slice(0, 16)}...` : 'NOT FOUND');
                            if (isValidToken(tokenViaUtils)) {
                                sessionToken = tokenViaUtils;
                            }
                        }

                        // Attempt 4: Namespaced key (legacy migration)
                        if (!sessionToken) {
                            const cid = HEYS.getCurrentClientId?.() || HEYS.clientId;
                            if (cid) {
                                const namespacedKey = `heys_${cid}_session_token`;
                                const namespacedToken = localStorage.getItem(namespacedKey);
                                console.info('ews / weekly üîç token.attempt4 (namespaced):', namespacedToken ? `found at ${namespacedKey}: ${String(namespacedToken).slice(0, 16)}...` : `NOT FOUND at ${namespacedKey}`);
                                if (namespacedToken && isValidToken(namespacedToken)) {
                                    try {
                                        const parsed = JSON.parse(namespacedToken);
                                        sessionToken = isValidToken(parsed) ? parsed : null;
                                    } catch {
                                        sessionToken = namespacedToken;
                                    }
                                }
                            } else {
                                console.info('ews / weekly üîç token.attempt4 (namespaced): SKIPPED (no clientId found)');
                            }
                        }

                        // Attempt 5: Curator session (alternative auth mechanism)
                        if (!sessionToken) {
                            const curatorToken = localStorage.getItem('heys_curator_session');
                            console.info('ews / weekly üîç token.attempt5 (curator_session):', curatorToken ? `found: ${String(curatorToken).slice(0, 16)}...` : 'NOT FOUND');
                            if (isValidToken(curatorToken)) {
                                sessionToken = curatorToken;
                            }
                        }

                        // Final validation
                        if (!sessionToken) {
                            console.warn(`ews / weekly ‚ö†Ô∏è backfill.week_${weekOffset + 1}.skip: no valid session token after 5 attempts`);
                            continue;
                        }

                        console.info('ews / weekly ‚úÖ token.final: using token:', `${String(sessionToken).slice(0, 16)}...`);

                        const { data: result, error: cloudError } = await HEYS.YandexAPI.rpc('upsert_weekly_snapshot_by_session', {
                            p_session_token: sessionToken,
                            p_week_start: snapshot.weekStart,
                            p_week_end: snapshot.weekEnd,
                            p_week_number: snapshot.weekNumber,
                            p_year: snapshot.year,
                            p_warnings_count: snapshot.warningsCount,
                            p_global_score: snapshot.globalScore,
                            p_severity_breakdown: snapshot.severityBreakdown,
                            p_top_warnings: snapshot.topWarnings
                        });

                        if (cloudError) {
                            throw cloudError;
                        }

                        if (result && Array.isArray(result) && result[0]?.success) {
                            console.info(`ews / weekly ‚òÅÔ∏è backfill.week_${weekOffset + 1}.uploaded`);
                        }
                    } catch (cloudError) {
                        console.warn(`ews / weekly ‚ö†Ô∏è backfill.week_${weekOffset + 1}.cloud_error:`, cloudError.message);
                    }
                }

            } catch (error) {
                console.error(`ews / weekly ‚ùå backfill.week_${weekOffset + 1}.error:`, error.message);
                continue;
            }
        }

        // Save all snapshots to localStorage
        if (snapshots.length > 0) {
            const progressData = {
                version: 1,
                weeks: snapshots.sort((a, b) =>
                    new Date(b.weekStart).getTime() - new Date(a.weekStart).getTime()
                ),
                lastUpdated: snapshots[0]?.lastUpdate || null
            };

            try {
                localStorage.setItem(WEEKLY_PROGRESS_STORAGE_KEY, JSON.stringify(progressData));
                console.info('ews / weekly ‚úÖ backfill.saved_to_localStorage:', {
                    snapshotsCount: snapshots.length
                });
            } catch (e) {
                console.error('ews / weekly ‚ùå backfill.localStorage_error:', e.message);
            }
        }

        console.info('ews / weekly ‚úÖ backfill.complete:', {
            weeksCreated: snapshots.length,
            weeksRequested: weeksToBackfill
        });

        return {
            success: true,
            weeksCreated: snapshots.length,
            snapshots
        };
    }

    /**
     * Calculate weekly progress summary from warnings and global score
     * @param {Array} warnings - Current warnings array
     * @param {number} globalScore - Current EWS global score (0-100)
     * @returns {Promise<Object>} Weekly summary with trend analysis
     */
    async function calculateWeeklyProgress(warnings, globalScore) {
        console.info('ews / weekly üöÄ start:', {
            currentWarnings: warnings.length,
            globalScore
        });

        const today = new Date();
        const weekBoundaries = getWeekBoundaries(today);
        const todayStr = today.toISOString().split('T')[0];

        console.info('ews / weekly üì• input:', {
            date: todayStr,
            weekStart: weekBoundaries.weekStart,
            weekEnd: weekBoundaries.weekEnd
        });

        // Load existing weekly data (cloud + localStorage)
        const progressData = await loadWeeklyProgress();

        // Check if current week already has a snapshot
        const existingWeekIndex = progressData.weeks.findIndex(
            w => w.weekStart === weekBoundaries.weekStart
        );

        // Create or update current week snapshot
        const weekSnapshot = {
            weekStart: weekBoundaries.weekStart,
            weekEnd: weekBoundaries.weekEnd,
            weekNumber: getWeekNumber(today),
            year: today.getFullYear(),
            warningsCount: warnings.length,
            globalScore: globalScore || 0,
            severityBreakdown: {
                high: warnings.filter(w => w.severity === 'high').length,
                medium: warnings.filter(w => w.severity === 'medium').length,
                low: warnings.filter(w => w.severity === 'low').length
            },
            topWarnings: warnings
                .slice(0, 3)
                .map(w => ({ type: w.type, severity: w.severity })),
            lastUpdate: todayStr,
            lastUpdateTimestamp: today.getTime()
        };

        console.info('ews / weekly üßÆ compute:', {
            phase: 'snapshot',
            weekNumber: weekSnapshot.weekNumber,
            warningsCount: weekSnapshot.warningsCount,
            globalScore: weekSnapshot.globalScore
        });

        // Update or add snapshot
        if (existingWeekIndex >= 0) {
            // Update existing week
            progressData.weeks[existingWeekIndex] = weekSnapshot;
            console.info('ews / weekly ‚ôªÔ∏è updated:', {
                weekStart: weekBoundaries.weekStart
            });
        } else {
            // Add new week at the beginning (newest first)
            progressData.weeks.unshift(weekSnapshot);
            console.info('ews / weekly ‚ûï added:', {
                weekStart: weekBoundaries.weekStart
            });
        }

        // Keep only last 4 weeks
        if (progressData.weeks.length > WEEKLY_CONFIG.WEEKS_TO_TRACK) {
            const removed = progressData.weeks.splice(WEEKLY_CONFIG.WEEKS_TO_TRACK);
            console.info('ews / weekly üóëÔ∏è pruned:', {
                removedCount: removed.length,
                oldestRemoved: removed[0]?.weekStart
            });
        }

        // Sort by week start descending (newest first)
        progressData.weeks.sort((a, b) =>
            new Date(b.weekStart).getTime() - new Date(a.weekStart).getTime()
        );

        // Update metadata
        progressData.lastUpdated = todayStr;

        // Calculate trend
        const trend = determineWeeklyTrend(progressData.weeks);

        console.info('ews / weekly ‚úÖ result:', {
            weeksTracked: progressData.weeks.length,
            trend: trend.status,
            trendDirection: trend.direction,
            percentChange: trend.percentChange
        });

        // Save updated data (localStorage + cloud sync)
        await saveWeeklyProgress(progressData, weekSnapshot);

        console.group('ews / weekly üñ•Ô∏è ui.summary - Last 4 Weeks');
        console.table(progressData.weeks.map((w, idx) => ({
            '#': idx + 1,
            'Week': `${w.weekStart} to ${w.weekEnd}`,
            'Warnings': w.warningsCount,
            'Global Score': w.globalScore,
            'High/Med/Low': `${w.severityBreakdown.high}/${w.severityBreakdown.medium}/${w.severityBreakdown.low}`,
            'Last Update': w.lastUpdate
        })));
        console.groupEnd();

        console.info('ews / weekly üñ•Ô∏è ui.trend:', {
            status: trend.status,
            description: trend.description
        });

        console.info('ews / weekly üñ•Ô∏è ui.complete:', {
            weeksDisplayed: progressData.weeks.length,
            trendAvailable: trend.status !== 'insufficient_data'
        });

        return {
            weeks: progressData.weeks,
            trend,
            currentWeek: weekSnapshot
        };
    }

    /**
     * Detect consecutive decline in values
     * @param {number[]} values - Array of numeric values (most recent last)
     * @param {number} consecutiveDays - Number of consecutive days to check
     * @returns {boolean}
     */
    function isConsecutiveDecline(values, consecutiveDays) {
        if (!Array.isArray(values) || values.length < consecutiveDays) {
            return false;
        }

        const recent = values.slice(-consecutiveDays);

        for (let i = 1; i < recent.length; i++) {
            if (recent[i] >= recent[i - 1]) {
                return false; // Not declining
            }
        }

        return true;
    }

    /**
     * Calculate average decline rate
     * @param {number[]} values
     * @returns {number} - Average change per day
     */
    function calculateDeclineRate(values) {
        if (!Array.isArray(values) || values.length < 2) return 0;

        let totalChange = 0;
        for (let i = 1; i < values.length; i++) {
            totalChange += (values[i] - values[i - 1]);
        }

        return totalChange / (values.length - 1);
    }

    /**
     * Warning 1: Health Score declining 3+ days
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @param {object} pIndex
     * @param {object} options - Additional options with currentPatterns/previousPatterns
     * @returns {object|null}
     */
    function checkHealthScoreDecline(days, profile, pIndex, options = {}) {
        console.log('ews / detect üìâ checking health score decline...');
        if (days.length < THRESHOLDS.MIN_DAYS_FOR_ANALYSIS) {
            console.log('ews / detect ‚è≠Ô∏è skip: insufficient days', days.length, '<', THRESHOLDS.MIN_DAYS_FOR_ANALYSIS);
            return null;
        }

        // Check if we have pattern data passed from UI
        const { currentPatterns, previousPatterns } = options;

        // Fallback path: detect decline from day-level health score calculation
        // (keeps backward compatibility for environments without pattern snapshots)
        if (!currentPatterns || !previousPatterns) {
            const calcDayHealthScore = HEYS.InsightsPI?.calculations?.calculateHealthScore;
            if (!calcDayHealthScore) {
                console.log('ews / detect ‚è≠Ô∏è skip: no pattern snapshots and no day-level health score calculator');
                return null;
            }

            try {
                const sortedDays = days
                    .slice()
                    .sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0)); // newest first

                const currentPeriod = sortedDays.slice(0, THRESHOLDS.HEALTH_SCORE_DECLINE_DAYS);
                const previousPeriod = sortedDays.slice(
                    THRESHOLDS.HEALTH_SCORE_DECLINE_DAYS,
                    THRESHOLDS.HEALTH_SCORE_DECLINE_DAYS * 2
                );

                if (currentPeriod.length < THRESHOLDS.HEALTH_SCORE_DECLINE_DAYS || previousPeriod.length < THRESHOLDS.HEALTH_SCORE_DECLINE_DAYS) {
                    return null;
                }

                const currentScores = currentPeriod
                    .map(day => calcDayHealthScore(day, profile, pIndex, days))
                    .map(score => score?.overall ?? score?.total ?? 0)
                    .filter(score => Number.isFinite(score) && score > 0);

                const previousScores = previousPeriod
                    .map(day => calcDayHealthScore(day, profile, pIndex, days))
                    .map(score => score?.overall ?? score?.total ?? 0)
                    .filter(score => Number.isFinite(score) && score > 0);

                if (currentScores.length < THRESHOLDS.HEALTH_SCORE_DECLINE_DAYS || previousScores.length < THRESHOLDS.HEALTH_SCORE_DECLINE_DAYS) {
                    console.log('ews / detect ‚è≠Ô∏è skip: insufficient valid scores after filtering');
                    return null;
                }

                const currentScore = currentScores.reduce((sum, v) => sum + v, 0) / currentScores.length;
                const previousScore = previousScores.reduce((sum, v) => sum + v, 0) / previousScores.length;
                const totalDrop = previousScore - currentScore;

                console.log(`ews / detect üìä health scores (fallback): prev=${Math.round(previousScore)}, curr=${Math.round(currentScore)}, drop=${Math.round(totalDrop)}`);

                if (totalDrop >= THRESHOLDS.HEALTH_SCORE_MIN_DELTA) {
                    const percentChange = Math.round((totalDrop / previousScore) * 100);

                    const humanMsg = WARNING_HUMAN_MESSAGES.HEALTH_SCORE_DECLINE;

                    const warning = {
                        type: 'HEALTH_SCORE_DECLINE',
                        severity: totalDrop >= 20 ? 'high' : 'medium',
                        days: THRESHOLDS.HEALTH_SCORE_DECLINE_DAYS,
                        currentScore: Math.round(currentScore),
                        previousScore: Math.round(previousScore),
                        totalDrop: Math.round(totalDrop),
                        percentChange,
                        patternName: humanMsg.title,
                        message: `üìâ ${humanMsg.title}`,
                        detail: `–ë—ã–ª–æ ${Math.round(previousScore)}, —Å—Ç–∞–ª–æ ${Math.round(currentScore)} (‚àí${percentChange}% –∑–∞ ${THRESHOLDS.HEALTH_SCORE_DECLINE_DAYS} –¥–Ω—è)`,
                        insight: humanMsg.insight,
                        science: humanMsg.science,
                        actionable: true
                    };
                    console.log(`ews / detect ‚úÖ HEALTH_SCORE_DECLINE warning: severity=${warning.severity}, drop=${warning.totalDrop}`);
                    return warning;
                }

                console.log('ews / detect ‚ûñ no significant health score decline (fallback)');
                return null;
            } catch (e) {
                console.error('ews / detect ‚ùå error in day-level health score fallback:', e);
                return null;
            }
        }

        // Use calculateHealthScore to compute scores from patterns
        const calculateHealthScore = HEYS.PredictiveInsights?.calculateHealthScore;
        if (!calculateHealthScore) {
            console.warn('ews / detect ‚ö†Ô∏è HEYS.PredictiveInsights.calculateHealthScore not available');
            return null;
        }

        try {
            // Calculate health scores from patterns
            const currentHealthScore = calculateHealthScore(currentPatterns, profile);
            const previousHealthScore = calculateHealthScore(previousPatterns, profile);

            const currentScore = currentHealthScore?.total || 0;
            const previousScore = previousHealthScore?.total || 0;

            console.log('ews / detect üìä health scores:', {
                previous: Math.round(previousScore),
                current: Math.round(currentScore),
                delta: Math.round(currentScore - previousScore)
            });

            if (currentScore === 0 || previousScore === 0) {
                console.log('ews / detect ‚è≠Ô∏è health score calculation returned 0, skipping');
                return null;
            }

            // Check for decline (previous > current = decline)
            const totalDrop = previousScore - currentScore; // Positive = decline

            if (totalDrop >= THRESHOLDS.HEALTH_SCORE_MIN_DELTA) {  // Significant drop (e.g., >= 10 points)
                const percentChange = Math.round((totalDrop / previousScore) * 100);

                const humanMsg = WARNING_HUMAN_MESSAGES.HEALTH_SCORE_DECLINE;

                return {
                    type: 'HEALTH_SCORE_DECLINE',
                    severity: totalDrop >= 20 ? 'high' : 'medium',
                    days: 7,
                    currentScore: Math.round(currentScore),
                    previousScore: Math.round(previousScore),
                    totalDrop: Math.round(totalDrop),
                    percentChange,
                    patternName: humanMsg.title,
                    message: `üìâ ${humanMsg.title}`,
                    detail: `–ë—ã–ª–æ ${Math.round(previousScore)}, —Å—Ç–∞–ª–æ ${Math.round(currentScore)} (‚àí${percentChange}% –∑–∞ 7 –¥–Ω–µ–π)`,
                    insight: humanMsg.insight,
                    science: humanMsg.science,
                    actionable: true
                };
            }

            console.log('ews / detect ‚ûñ health score stable (drop < threshold)');
            return null;

        } catch (e) {
            console.error('ews / detect ‚ùå error calculating health score decline:', e);
            return null;
        }
    }

    /**
     * Warning 2: Critical pattern degraded significantly OR current low scores
     * @param {object[]} days
     * @param {object} profile
     * @param {object} pIndex
     * @param {object} previousPatterns - patterns from 7 days ago (optional)
     * @param {object} currentPatterns - patterns from today (required)
     * @returns {object[]|null}
     */
    function checkCriticalPatternDegradation(days, profile, pIndex, previousPatterns, currentPatterns) {
        if (!currentPatterns) return null;

        const warnings = [];

        // Check 1: Pattern score degradation (change over time) - ONLY if we have previous data
        if (previousPatterns) {
            for (const patternId of CRITICAL_PATTERNS) {
                const prev = previousPatterns[patternId];
                const curr = currentPatterns[patternId];

                if (!prev || !curr || !prev.available || !curr.available) continue;

                const prevScore = prev.score || 0;
                const currScore = curr.score || 0;

                if (prevScore === 0) continue; // Avoid division by zero

                const relativeChange = (currScore - prevScore) / prevScore;

                if (relativeChange <= THRESHOLDS.CRITICAL_PATTERN_DEGRADATION) {
                    const absoluteChange = currScore - prevScore;

                    warnings.push({
                        type: 'CRITICAL_PATTERN_DEGRADATION',
                        severity: relativeChange <= -0.3 ? 'high' : 'medium',
                        pattern: patternId,
                        patternName: prev.pattern || patternId,
                        previousScore: Math.round(prevScore),
                        currentScore: Math.round(currScore),
                        absoluteChange: Math.round(absoluteChange),
                        relativeChange: Math.round(relativeChange * 100),
                        message: `‚ö†Ô∏è ${prev.pattern || patternId} —É—Ö—É–¥—à–∏–ª—Å—è –Ω–∞ ${Math.abs(Math.round(relativeChange * 100))}%`,
                        detail: `–° ${Math.round(prevScore)} –¥–æ ${Math.round(currScore)} –∑–∞ 7 –¥–Ω–µ–π`,
                        action: `–ò–∑—É—á–∏—Ç—å insight: ¬´${curr.insight || 'N/A'}¬ª`,
                        actionable: true
                    });
                }
            }
        }

        // Check 2: Current low pattern scores (absolute values) - ALWAYS check this
        console.log('ews / detect üîç checking current pattern scores...');

        // Convert patterns array to id-indexed object for easier lookup
        const patternsById = {};
        if (Array.isArray(currentPatterns)) {
            for (const p of currentPatterns) {
                if (p.pattern) patternsById[p.pattern] = p;
            }
        } else {
            // Already an object
            Object.assign(patternsById, currentPatterns);
        }

        const allPatternIds = Object.keys(patternsById);

        for (const patternId of allPatternIds) {
            const pattern = patternsById[patternId];
            if (!pattern || !pattern.available) continue;

            const score = pattern.score || 0;
            const isCritical = CRITICAL_PATTERNS.includes(patternId);

            console.log(`ews / detect üìä ${patternId}: score=${score}, critical=${isCritical}`);

            // Get human-friendly messages
            const humanMsg = PATTERN_HUMAN_MESSAGES[patternId] || {
                title: pattern.pattern || patternId,
                message: `–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è (score ${Math.round(score)})`,
                insight: pattern.insight || '–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —ç—Ç–æ—Ç –∞—Å–ø–µ–∫—Ç –ø–∏—Ç–∞–Ω–∏—è',
                science: '–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ Insights'
            };

            // Critical patterns: HIGH severity if below 35, MEDIUM if 35-50
            if (isCritical && score > 0 && score < PATTERN_LOW_SCORE_THRESHOLDS.critical) {
                warnings.push({
                    type: 'LOW_PATTERN_SCORE',
                    severity: 'high',
                    pattern: patternId,
                    patternName: humanMsg.title,
                    currentScore: Math.round(score),
                    threshold: PATTERN_LOW_SCORE_THRESHOLDS.critical,
                    message: `üö® ${humanMsg.title}`,
                    detail: humanMsg.message,
                    insight: humanMsg.insight,
                    science: humanMsg.science,
                    actionable: true
                });
            }
            // Critical patterns: MEDIUM severity if 35-50 (still needs attention)
            else if (isCritical && score >= PATTERN_LOW_SCORE_THRESHOLDS.critical && score < 50) {
                warnings.push({
                    type: 'LOW_PATTERN_SCORE',
                    severity: 'medium',
                    pattern: patternId,
                    patternName: humanMsg.title,
                    currentScore: Math.round(score),
                    threshold: 50,
                    message: `‚ö†Ô∏è ${humanMsg.title}`,
                    detail: humanMsg.message,
                    insight: humanMsg.insight,
                    science: humanMsg.science,
                    actionable: true
                });
            }
            // Non-critical patterns: warn if below 45
            else if (!isCritical && score > 0 && score < PATTERN_LOW_SCORE_THRESHOLDS.important) {
                warnings.push({
                    type: 'LOW_PATTERN_SCORE',
                    severity: 'medium',
                    pattern: patternId,
                    patternName: humanMsg.title,
                    currentScore: Math.round(score),
                    threshold: PATTERN_LOW_SCORE_THRESHOLDS.important,
                    message: `‚ö†Ô∏è ${humanMsg.title}`,
                    detail: humanMsg.message,
                    insight: humanMsg.insight,
                    science: humanMsg.science,
                    actionable: true
                });
            }
        }

        console.log(`ews / detect ‚úÖ found ${warnings.length} pattern-related warnings`);

        return warnings.length > 0 ? warnings : null;
    }

    /**
     * Warning 3: Status Score decline
     * @param {object[]} days - Array of day objects with statusScore property
     * @returns {object|null}
     */
    function checkStatusScoreDecline(days) {
        console.log('ews / detect üìä checking status score decline...');

        if (days.length < THRESHOLDS.STATUS_SCORE_DECLINE_DAYS) {
            console.log('ews / detect ‚è≠Ô∏è skip: insufficient days', days.length, '<', THRESHOLDS.STATUS_SCORE_DECLINE_DAYS);
            return null;
        }

        // Get Status Score for recent days
        const recentDays = days.slice(-7); // Most recent 7 days
        const statusScores = [];

        for (const day of recentDays) {
            // Try to get cached status or calculate
            let status = null;

            if (day.statusScore !== undefined) {
                status = day.statusScore;
            } else if (day._statusCalculated && day._statusCalculated.score !== undefined) {
                status = day._statusCalculated.score;
            } else if (typeof HEYS !== 'undefined' && HEYS.Status && typeof HEYS.Status.calculate === 'function') {
                // Try to calculate status Score on the fly
                try {
                    const result = HEYS.Status.calculate({ dayData: day });
                    if (result && result.score !== undefined) {
                        status = result.score;
                    }
                } catch (e) {
                    console.warn('ews / detect ‚ö†Ô∏è failed to calculate status for day', day.date, e.message);
                }
            }

            if (status !== null && status !== undefined) {
                statusScores.push({
                    date: day.date,
                    score: status
                });
            }
        }

        console.log(`ews / detect üìä collected ${statusScores.length} status scores from ${recentDays.length} days`);

        if (statusScores.length < THRESHOLDS.STATUS_SCORE_DECLINE_DAYS) {
            console.log('ews / detect ‚è≠Ô∏è skip: not enough status scores', statusScores.length, '<', THRESHOLDS.STATUS_SCORE_DECLINE_DAYS);
            return null;
        }

        // Check consecutive decline
        const recent = statusScores.slice(-THRESHOLDS.STATUS_SCORE_DECLINE_DAYS);
        const scores = recent.map(d => d.score);
        const isDecline = isConsecutiveDecline(scores, THRESHOLDS.STATUS_SCORE_DECLINE_DAYS);

        console.log(`ews / detect üìä status scores (${recent.length}d):`, scores.map(s => Math.round(s)));

        if (isDecline) {
            const totalDrop = scores[0] - scores[scores.length - 1];
            const avgDailyDrop = calculateDeclineRate(scores);

            console.log(`ews / detect üìâ decline detected: totalDrop=${totalDrop.toFixed(1)}, avgDaily=${avgDailyDrop.toFixed(1)}`);

            if (totalDrop >= THRESHOLDS.STATUS_SCORE_MIN_DELTA) {
                const startScore = Math.round(scores[0]);
                const endScore = Math.round(scores[scores.length - 1]);

                const humanMsg = WARNING_HUMAN_MESSAGES.STATUS_SCORE_DECLINE;

                const warning = {
                    type: 'STATUS_SCORE_DECLINE',
                    severity: totalDrop >= 20 ? 'high' : (totalDrop >= 15 ? 'medium' : 'low'),
                    days: THRESHOLDS.STATUS_SCORE_DECLINE_DAYS,
                    startScore,
                    endScore,
                    totalDrop: Math.round(totalDrop),
                    avgDailyDrop: Math.round(avgDailyDrop * 10) / 10,
                    patternName: humanMsg.title,
                    message: `üìä ${humanMsg.title}`,
                    detail: `–° ${startScore} –¥–æ ${endScore} (–ø–∞–¥–µ–Ω–∏–µ ${Math.round(totalDrop)} –±–∞–ª–ª–æ–≤ –∑–∞ ${THRESHOLDS.STATUS_SCORE_DECLINE_DAYS} –¥–Ω—è)`,
                    insight: humanMsg.insight,
                    science: humanMsg.science,
                    currentScore: endScore,
                    actionable: true
                };

                console.log(`ews / detect ‚úÖ STATUS_SCORE_DECLINE warning: severity=${warning.severity}, drop=${warning.totalDrop}`);
                return warning;
            }
        }

        console.log('ews / detect ‚ûñ no status score decline detected');
        return null;
    }

    /**
     * Warning 4: Sleep debt accumulation
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @returns {object|null}
     */
    function checkSleepDebt(days, profile) {
        console.log('ews / detect üõå checking sleep debt...');
        if (days.length < THRESHOLDS.SLEEP_DEFICIT_DAYS) {
            console.log('ews / detect ‚è≠Ô∏è skip: insufficient days', days.length, '<', THRESHOLDS.SLEEP_DEFICIT_DAYS);
            return null;
        }

        const targetSleep = profile?.sleepHours || 8;
        const recentDays = days.slice(-7); // Most recent first

        const sleepData = recentDays.map(day => {
            const sleep = day.sleepHours || (day.sleepStart && day.sleepEnd
                ? calculateSleepHours(day.sleepStart, day.sleepEnd)
                : null);
            return { date: day.date, sleep, deficit: sleep ? Math.max(0, targetSleep - sleep) : 0 };
        }).filter(d => d.sleep !== null);

        if (sleepData.length < THRESHOLDS.SLEEP_DEFICIT_DAYS) {
            console.log('ews / detect ‚è≠Ô∏è skip: not enough sleep data after filter', sleepData.length, '<', THRESHOLDS.SLEEP_DEFICIT_DAYS);
            return null;
        }

        // Check last N consecutive days (most recent first)
        const recent = sleepData.slice(0, THRESHOLDS.SLEEP_DEFICIT_DAYS);
        const allDeficit = recent.every(d => d.sleep < THRESHOLDS.SLEEP_DEFICIT_HOURS);

        console.log(`ews / detect üìä sleep stats: recent=${recent.length}d, avgSleep=${(recent.reduce((s, d) => s + d.sleep, 0) / recent.length).toFixed(1)}h, target=${targetSleep}h, allDeficit=${allDeficit}`);

        if (allDeficit) {
            const totalDeficit = recent.reduce((sum, d) => sum + d.deficit, 0);
            const avgSleep = recent.reduce((sum, d) => sum + d.sleep, 0) / recent.length;

            const humanMsg = WARNING_HUMAN_MESSAGES.SLEEP_DEBT;

            // Sleep quality score: 0-100 based on how close to target
            // If avgSleep < target: score shows percentage of target met
            // If avgSleep >= target: score is 100 (fully met)
            const sleepQualityScore = Math.min(100, Math.round((avgSleep / targetSleep) * 100));

            const warning = {
                type: 'SLEEP_DEBT',
                severity: totalDeficit > 6 ? 'high' : 'medium',
                days: THRESHOLDS.SLEEP_DEFICIT_DAYS,
                avgSleep: Math.round(avgSleep * 10) / 10,
                targetSleep,
                totalDeficit: Math.round(totalDeficit * 10) / 10,
                patternName: humanMsg.title,
                message: `üí§ ${humanMsg.title}`,
                detail: `–°—Ä–µ–¥–Ω–∏–π —Å–æ–Ω: ${Math.round(avgSleep * 10) / 10}—á (—Ü–µ–ª—å: ${targetSleep}—á), –¥–µ—Ñ–∏—Ü–∏—Ç: ${Math.round(totalDeficit * 10) / 10}—á`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                currentScore: sleepQualityScore,
                actionable: true
            };
            console.log(`ews / detect ‚úÖ SLEEP_DEBT warning: severity=${warning.severity}, totalDeficit=${warning.totalDeficit}h`);
            return warning;
        }

        console.log('ews / detect ‚ûñ no sleep debt detected');
        return null;
    }

    /**
     * Warning 4: Caloric debt accumulation
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @param {object} pIndex
     * @returns {object|null}
     */
    function checkCaloricDebt(days, profile, pIndex) {
        console.log('ews / detect üçΩÔ∏è checking caloric debt...');
        if (days.length < THRESHOLDS.CALORIC_DEBT_DAYS) {
            console.log('ews / detect ‚è≠Ô∏è skip: insufficient days', days.length, '<', THRESHOLDS.CALORIC_DEBT_DAYS);
            return null;
        }

        const calculateItemKcal = HEYS.InsightsPI?.calculations?.calculateItemKcal;
        if (!calculateItemKcal) {
            console.warn('ews / detect ‚è≠Ô∏è skip: calculateItemKcal not available');
            return null;
        }

        const recentDays = days.slice(-7); // Most recent first
        const optimum = profile?.optimum || profile?.norm?.kcal || 2000;

        const caloricData = recentDays.map(day => {
            let eaten = day.savedEatenKcal || 0;

            if (!eaten && day.meals) {
                eaten = day.meals.reduce((sum, meal) => {
                    if (!meal.items) return sum;
                    return sum + meal.items.reduce((mealSum, item) => {
                        return mealSum + calculateItemKcal(item, pIndex);
                    }, 0);
                }, 0);
            }

            const debt = Math.max(0, optimum - eaten);
            return { date: day.date, eaten, optimum, debt };
        });

        // Check last N consecutive days (most recent first)
        const recent = caloricData.slice(0, THRESHOLDS.CALORIC_DEBT_DAYS);
        const totalDebt = recent.reduce((sum, d) => sum + d.debt, 0);

        console.log(`ews / detect üìä caloric stats: recent=${recent.length}d, optimum=${optimum}kcal, totalDebt=${Math.round(totalDebt)}kcal, threshold=${THRESHOLDS.CALORIC_DEBT_THRESHOLD}kcal`);

        if (totalDebt > THRESHOLDS.CALORIC_DEBT_THRESHOLD) {
            const avgEaten = recent.reduce((sum, d) => sum + d.eaten, 0) / recent.length;
            const avgDebt = totalDebt / recent.length;

            const humanMsg = WARNING_HUMAN_MESSAGES.CALORIC_DEBT;

            // Caloric intake score: 0-100 based on how close to optimum
            // Shows percentage of target calories consumed
            const calorieIntakeScore = Math.min(100, Math.round((avgEaten / optimum) * 100));

            const warning = {
                type: 'CALORIC_DEBT',
                severity: totalDebt > 2500 ? 'high' : 'medium',
                days: THRESHOLDS.CALORIC_DEBT_DAYS,
                avgEaten: Math.round(avgEaten),
                optimum,
                totalDebt: Math.round(totalDebt),
                avgDebt: Math.round(avgDebt),
                patternName: humanMsg.title,
                message: `üçΩÔ∏è ${humanMsg.title}`,
                detail: `–°—Ä–µ–¥–Ω–∏–π –Ω–µ–¥–æ–±–æ—Ä: ${Math.round(avgDebt)} –∫–∫–∞–ª/–¥–µ–Ω—å (–≤—Å–µ–≥–æ ${Math.round(totalDebt)} –∫–∫–∞–ª)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                currentScore: calorieIntakeScore,
                actionable: true
            };
            console.log(`ews / detect ‚úÖ CALORIC_DEBT warning: severity=${warning.severity}, totalDebt=${warning.totalDebt}kcal`);
            return warning;
        }

        console.log('ews / detect ‚ûñ no caloric debt detected');
        return null;
    }

    /**
     * Warning 6: Weight spike (Tier 1 ‚Äî v2.0)
     * Detects rapid weight gain (1+ kg in 1-2 days)
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @returns {object|null}
     */
    function checkWeightSpike(days, profile) {
        console.info('ews / detect üîç checking weight spike...');
        if (days.length < 3) {
            console.info('ews / detect ‚è≠Ô∏è skip weight spike: insufficient days', days.length);
            return null;
        }

        const recentDays = days.slice(-3).reverse(); // Most recent first
        const weightData = recentDays
            .map(day => ({
                date: day.date,
                weight: day.weightMorning || null
            }))
            .filter(d => d.weight !== null && d.weight > 0);

        if (weightData.length < 2) {
            console.info('ews / detect ‚è≠Ô∏è skip weight spike: insufficient weight data', weightData.length);
            return null;
        }

        // Check difference between most recent and previous
        const current = weightData[0].weight;
        const previous = weightData[1].weight;
        const delta = current - previous;
        const daysDiff = 1; // –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ: —Å—á–∏—Ç–∞–µ–º —á—Ç–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è –∑–∞ 1-2 –¥–Ω—è

        console.info('ews / detect üìä weight data:', {
            current: current.toFixed(1),
            previous: previous.toFixed(1),
            delta: delta.toFixed(2),
            daysDiff
        });

        // Threshold: +1 kg or more
        if (delta >= 1.0) {
            const humanMsg = WARNING_HUMAN_MESSAGES.WEIGHT_SPIKE;
            const percentChange = Math.round((delta / previous) * 100 * 10) / 10;

            // Score: 100 = no spike, lower = bigger spike
            // Formula: max(0, 100 - (delta * 30)) where delta in kg
            const spikeScore = Math.max(0, Math.round(100 - (delta * 30)));

            const warning = {
                type: 'WEIGHT_SPIKE',
                severity: delta >= 1.5 ? 'high' : 'medium',
                delta: Math.round(delta * 10) / 10,
                current: Math.round(current * 10) / 10,
                previous: Math.round(previous * 10) / 10,
                percentChange,
                patternName: humanMsg.title,
                message: `‚öñÔ∏è ${humanMsg.title}`,
                detail: `–í–µ—Å –≤—ã—Ä–æ—Å —Å ${previous.toFixed(1)} –¥–æ ${current.toFixed(1)} –∫–≥ (+${delta.toFixed(1)} –∫–≥, +${percentChange}%)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                currentScore: spikeScore,
                actionable: true
            };
            console.info('ews / detect ‚úÖ WEIGHT_SPIKE warning:', {
                severity: warning.severity,
                delta: warning.delta,
                currentScore: warning.currentScore
            });
            return warning;
        }

        console.info('ews / detect ‚ûñ no weight spike detected');
        return null;
    }

    /**
     * Warning 7: Hydration deficit (Tier 1 ‚Äî v2.0)
     * Detects consistently low water intake (<1.5L for 3+ days)
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @returns {object|null}
     */
    function checkHydrationDeficit(days, profile) {
        console.info('ews / detect üíß checking hydration deficit...');
        if (days.length < 3) {
            console.info('ews / detect ‚è≠Ô∏è skip hydration: insufficient days', days.length);
            return null;
        }

        const targetWater = profile?.waterTarget || 2000; // ml
        const minThreshold = 1500; // ml (critical minimum)
        const consecutiveDays = 3;

        const recentDays = days.slice(-7); // Check last week
        const hydrationData = recentDays
            .map(day => ({
                date: day.date,
                water: day.waterMl || 0
            }))
            .filter(d => d.water >= 0); // Keep even 0 values (logged but no water)

        if (hydrationData.length < consecutiveDays) {
            console.info('ews / detect ‚è≠Ô∏è skip hydration: insufficient data', hydrationData.length);
            return null;
        }

        // Check last N consecutive days
        const recent = hydrationData.slice(-consecutiveDays);
        const allBelowThreshold = recent.every(d => d.water < minThreshold);

        console.info('ews / detect üìä hydration data:', {
            recent: recent.length,
            avgWater: Math.round(recent.reduce((s, d) => s + d.water, 0) / recent.length),
            target: targetWater,
            threshold: minThreshold,
            allBelow: allBelowThreshold
        });

        if (allBelowThreshold) {
            const avgWater = recent.reduce((s, d) => s + d.water, 0) / recent.length;
            const humanMsg = WARNING_HUMAN_MESSAGES.HYDRATION_DEFICIT;

            // Score: 0-100 based on % of target met
            const hydrationScore = Math.min(100, Math.round((avgWater / targetWater) * 100));

            const warning = {
                type: 'HYDRATION_DEFICIT',
                severity: avgWater < 1000 ? 'high' : 'medium',
                days: consecutiveDays,
                avgWater: Math.round(avgWater),
                targetWater,
                deficit: Math.round(targetWater - avgWater),
                patternName: humanMsg.title,
                message: `üíß ${humanMsg.title}`,
                detail: `–°—Ä–µ–¥–Ω–∏–π –æ–±—ä—ë–º: ${Math.round(avgWater)} –º–ª (—Ü–µ–ª—å: ${targetWater} –º–ª, –¥–µ—Ñ–∏—Ü–∏—Ç: ${Math.round(targetWater - avgWater)} –º–ª)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                currentScore: hydrationScore,
                actionable: true
            };
            console.info('ews / detect ‚úÖ HYDRATION_DEFICIT warning:', {
                severity: warning.severity,
                avgWater: warning.avgWater,
                currentScore: warning.currentScore
            });
            return warning;
        }

        console.info('ews / detect ‚ûñ no hydration deficit detected');
        return null;
    }

    /**
     * Warning 8: Logging gap (Tier 1 ‚Äî v2.0)
     * Detects missing food diary entries (2+ consecutive days)
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @returns {object|null}
     */
    function checkLoggingGap(days, profile) {
        console.info('ews / detect üìù checking logging gap...');
        if (days.length < 2) {
            console.info('ews / detect ‚è≠Ô∏è skip logging gap: insufficient days', days.length);
            return null;
        }

        const minConsecutiveGap = 2;
        const recentDays = days.slice(-7); // Check last week

        // Determine if a day has meaningful food logging
        const loggingData = recentDays.map(day => {
            const hasMeals = day.meals && day.meals.length > 0;
            const hasItems = hasMeals && day.meals.some(meal => meal.items && meal.items.length > 0);
            const logged = hasItems || (day.savedEatenKcal && day.savedEatenKcal > 0);
            return {
                date: day.date,
                logged
            };
        });

        // Find consecutive gaps (most recent first)
        let consecutiveGap = 0;
        const reversed = loggingData.slice().reverse();
        for (const entry of reversed) {
            if (!entry.logged) {
                consecutiveGap++;
            } else {
                break; // Stop at first logged day
            }
        }

        console.info('ews / detect üìä logging data:', {
            totalDays: loggingData.length,
            loggedDays: loggingData.filter(d => d.logged).length,
            consecutiveGap,
            threshold: minConsecutiveGap
        });

        if (consecutiveGap >= minConsecutiveGap) {
            const humanMsg = WARNING_HUMAN_MESSAGES.LOGGING_GAP;

            // Score: 100 = no gap, decreases with gap size
            // Formula: max(0, 100 - (gap * 20))
            const consistencyScore = Math.max(0, Math.round(100 - (consecutiveGap * 20)));

            const warning = {
                type: 'LOGGING_GAP',
                severity: consecutiveGap >= 4 ? 'high' : 'medium',
                consecutiveGap,
                patternName: humanMsg.title,
                message: `üìù ${humanMsg.title}`,
                detail: `–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π ${consecutiveGap} ${consecutiveGap === 2 ? '–¥–Ω—è' : '–¥–Ω–µ–π'} –ø–æ–¥—Ä—è–¥`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                currentScore: consistencyScore,
                actionable: true
            };
            console.info('ews / detect ‚úÖ LOGGING_GAP warning:', {
                severity: warning.severity,
                gap: warning.consecutiveGap,
                currentScore: warning.currentScore
            });
            return warning;
        }

        console.info('ews / detect ‚ûñ no logging gap detected');
        return null;
    }

    /**
     * Warning 9: Protein deficit (Tier 2 ‚Äî v2.0)
     * Detects insufficient protein intake (<1.2 g/kg for 3+ days)
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @param {object} pIndex
     * @returns {object|null}
     */
    function checkProteinDeficit(days, profile, pIndex) {
        // v2.0: Phenotype-aware protein target
        const proteinMultiplier = getEwsThreshold('proteinTarget', 1.0, profile);
        const targetProtein = 1.2 * proteinMultiplier; // g/kg (minimum for muscle preservation)

        console.info('ews / detect ü•© checking protein deficit...', {
            proteinMultiplier,
            targetProtein: targetProtein.toFixed(2)
        });

        if (days.length < 3) {
            console.info('ews / detect ‚è≠Ô∏è skip protein: insufficient days', days.length);
            return null;
        }

        const weight = profile?.weight || 70;
        // targetProtein defined at start of function
        const minProteinGrams = weight * targetProtein;
        const consecutiveDays = 3;

        const recentDays = days.slice(-7);
        const proteinData = recentDays.map(day => {
            const protein = day.savedEatenProt || 0;
            return {
                date: day.date,
                protein,
                deficit: protein < minProteinGrams
            };
        }).filter(d => d.protein > 0); // Only days with data

        if (proteinData.length < consecutiveDays) {
            console.info('ews / detect ‚è≠Ô∏è skip protein: insufficient data', proteinData.length);
            return null;
        }

        const recent = proteinData.slice(-consecutiveDays);
        const allDeficit = recent.every(d => d.deficit);

        console.info('ews / detect üìä protein data:', {
            recent: recent.length,
            avgProtein: Math.round(recent.reduce((s, d) => s + d.protein, 0) / recent.length),
            target: Math.round(minProteinGrams),
            allDeficit
        });

        if (allDeficit) {
            const avgProtein = recent.reduce((s, d) => s + d.protein, 0) / recent.length;
            const humanMsg = WARNING_HUMAN_MESSAGES.PROTEIN_DEFICIT;

            // Score: 0-100 based on % of target met
            const proteinScore = Math.min(100, Math.round((avgProtein / minProteinGrams) * 100));

            const warning = {
                type: 'PROTEIN_DEFICIT',
                severity: avgProtein < (minProteinGrams * 0.8) ? 'high' : 'medium',
                days: consecutiveDays,
                avgProtein: Math.round(avgProtein),
                targetProtein: Math.round(minProteinGrams),
                deficit: Math.round(minProteinGrams - avgProtein),
                patternName: humanMsg.title,
                message: `ü•© ${humanMsg.title}`,
                detail: `–°—Ä–µ–¥–Ω–∏–π –±–µ–ª–æ–∫: ${Math.round(avgProtein)}–≥ (—Ü–µ–ª—å: ${Math.round(minProteinGrams)}–≥, –¥–µ—Ñ–∏—Ü–∏—Ç: ${Math.round(minProteinGrams - avgProtein)}–≥)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                currentScore: proteinScore,
                actionable: true
            };
            console.info('ews / detect ‚úÖ PROTEIN_DEFICIT warning:', {
                severity: warning.severity,
                avgProtein: warning.avgProtein,
                currentScore: warning.currentScore
            });
            return warning;
        }

        console.info('ews / detect ‚ûñ no protein deficit detected');
        return null;
    }

    /**
     * Warning 10: Stress accumulation (Tier 2 ‚Äî v2.0)
     * Detects high stress without recovery (stress score or low recovery days)
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @returns {object|null}
     */
    function checkStressAccumulation(days, profile) {
        // v2.0: Phenotype-aware sensitivity
        const sensitivity = getEwsThreshold('stressEatingThreshold', 1.0, profile);
        // Lower limit = higher sensitivity
        const STRESS_LEVEL_LIMIT = 7 * sensitivity; // e.g. 5.6 for stress_eater
        const STATUS_SCORE_LIMIT = 50 / sensitivity; // e.g. 62.5 for stress_eater (easier to satisfy <62.5)

        console.info('ews / detect üò∞ checking stress accumulation...', {
            sensitivity,
            limits: { stress: STRESS_LEVEL_LIMIT.toFixed(1), status: STATUS_SCORE_LIMIT.toFixed(0) }
        });

        if (days.length < 5) {
            console.info('ews / detect ‚è≠Ô∏è skip stress: insufficient days', days.length);
            return null;
        }

        const recentDays = days.slice(-7);
        const stressData = recentDays.map(day => {
            // Multiple signals of stress:
            // 1. Explicit stress field
            const explicitStress = day.stress || 0;
            // 2. Poor sleep (<6h)
            const poorSleep = day.sleepHours && day.sleepHours < 6;
            // 3. High training load without recovery
            const highTraining = day.training && day.training.duration > 90;
            // 4. Low status score (<50 or dynamic)
            const lowStatus = day.statusScore !== undefined && day.statusScore < STATUS_SCORE_LIMIT;

            const stressSignals = [
                explicitStress > STRESS_LEVEL_LIMIT,
                poorSleep,
                highTraining,
                lowStatus
            ].filter(Boolean).length;

            return {
                date: day.date,
                stressLevel: explicitStress,
                stressSignals,
                highStress: stressSignals >= 2
            };
        });

        // Check for 3+ days with 2+ stress signals
        const consecutiveStress = 3;
        const recent = stressData.slice(-consecutiveStress);
        const highStressDays = recent.filter(d => d.highStress).length;

        console.info('ews / detect üìä stress data:', {
            recent: recent.length,
            highStressDays,
            avgSignals: (recent.reduce((s, d) => s + d.stressSignals, 0) / recent.length).toFixed(1),
            threshold: consecutiveStress
        });

        if (highStressDays >= consecutiveStress) {
            const avgStressLevel = recent.reduce((s, d) => s + d.stressLevel, 0) / recent.length;
            const humanMsg = WARNING_HUMAN_MESSAGES.STRESS_ACCUMULATION;

            // Score: 100 = no stress, decreases with stress signals
            const avgSignals = recent.reduce((s, d) => s + d.stressSignals, 0) / recent.length;
            const recoveryScore = Math.max(0, Math.round(100 - (avgSignals * 25)));

            const warning = {
                type: 'STRESS_ACCUMULATION',
                severity: avgSignals >= 3 ? 'high' : 'medium',
                days: highStressDays,
                avgStressLevel: Math.round(avgStressLevel),
                avgSignals: Math.round(avgSignals * 10) / 10,
                patternName: humanMsg.title,
                message: `üò∞ ${humanMsg.title}`,
                detail: `${highStressDays} –¥–Ω–µ–π —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ —Å—Ç—Ä–µ—Å—Å–∞ (—Å–æ–Ω, –Ω–∞–≥—Ä—É–∑–∫–∞, —Å–æ—Å—Ç–æ—è–Ω–∏–µ)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                currentScore: recoveryScore,
                actionable: true
            };
            console.info('ews / detect ‚úÖ STRESS_ACCUMULATION warning:', {
                severity: warning.severity,
                highStressDays: warning.days,
                currentScore: warning.currentScore
            });
            return warning;
        }

        console.info('ews / detect ‚ûñ no stress accumulation detected');
        return null;
    }

    /**
     * Warning 11: Meal skip pattern (Tier 2 ‚Äî v2.0)
     * Detects frequent meal skipping (irregular meal timing or missing meals)
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @returns {object|null}
     */
    function checkMealSkipPattern(days, profile) {
        // v2.0: Phenotype-aware tolerance
        const tolerance = getEwsThreshold('mealSkipTolerance', 1.0, profile);
        const GAP_THRESHOLD = 8 * tolerance; // Base 8h

        console.info('ews / detect üçΩÔ∏è checking meal skip pattern...', {
            tolerance,
            GAP_THRESHOLD
        });

        if (days.length < 5) {
            console.info('ews / detect ‚è≠Ô∏è skip meal pattern: insufficient days', days.length);
            return null;
        }

        const recentDays = days.slice(-7);
        const mealData = recentDays.map(day => {
            const meals = day.meals || [];
            const mealCount = meals.length;
            const hasMeals = mealCount > 0;

            // Check for long gaps (>8h) between meals
            let longGaps = 0;
            if (meals.length >= 2) {
                for (let i = 1; i < meals.length; i++) {
                    const prevTime = meals[i - 1].time;
                    const currTime = meals[i].time;
                    if (prevTime && currTime) {
                        const gap = calculateTimeGap(prevTime, currTime); // Helper function
                        // v2.0: Use dynamic gap threshold
                        if (gap > GAP_THRESHOLD) longGaps++;
                    }
                }
            }

            const irregular = mealCount < 2 || longGaps > 0;

            return {
                date: day.date,
                mealCount,
                longGaps,
                irregular
            };
        }).filter(d => d.mealCount > 0); // Only days with logged meals

        if (mealData.length < 5) {
            console.info('ews / detect ‚è≠Ô∏è skip meal pattern: insufficient meal data', mealData.length);
            return null;
        }

        const irregularDays = mealData.filter(d => d.irregular).length;
        const irregularRate = irregularDays / mealData.length;

        console.info('ews / detect üìä meal pattern data:', {
            totalDays: mealData.length,
            irregularDays,
            irregularRate: (irregularRate * 100).toFixed(0) + '%',
            threshold: '60%'
        });

        // Warning if >60% of days have irregular patterns
        if (irregularRate > 0.6 * tolerance) {
            const avgMealCount = mealData.reduce((s, d) => s + d.mealCount, 0) / mealData.length;
            const humanMsg = WARNING_HUMAN_MESSAGES.MEAL_SKIP_PATTERN;

            // Score: 100 = regular, decreases with irregularity
            const regularityScore = Math.max(0, Math.round((1 - irregularRate) * 100));

            const warning = {
                type: 'MEAL_SKIP_PATTERN',
                severity: irregularRate > 0.8 ? 'high' : 'medium',
                irregularDays,
                totalDays: mealData.length,
                irregularRate: Math.round(irregularRate * 100),
                avgMealCount: Math.round(avgMealCount * 10) / 10,
                patternName: humanMsg.title,
                message: `üçΩÔ∏è ${humanMsg.title}`,
                detail: `${irregularDays} –∏–∑ ${mealData.length} –¥–Ω–µ–π —Å –ø—Ä–æ–ø—É—Å–∫–∞–º–∏ –∏–ª–∏ –¥–ª–∏–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏ (>8—á)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                currentScore: regularityScore,
                actionable: true
            };
            console.info('ews / detect ‚úÖ MEAL_SKIP_PATTERN warning:', {
                severity: warning.severity,
                irregularRate: warning.irregularRate + '%',
                currentScore: warning.currentScore
            });
            return warning;
        }

        console.info('ews / detect ‚ûñ no meal skip pattern detected');
        return null;
    }

    /**
     * Warning 12: Binge risk (Tier 2 ‚Äî v2.0)
     * Detects binge eating patterns (large portions after long gaps)
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @param {object} pIndex
     * @returns {object|null}
     */
    function checkBingeRisk(days, profile, pIndex) {
        // v5.0: Phenotype-aware binge sensitivity
        const bingeLimitMultiplier = getEwsThreshold('bingeVolume', 1.0, profile);
        const SINGLE_MEAL_PERCENT = 40 * bingeLimitMultiplier; // default 40%
        const EXTREME_OVEREAT_PERCENT = 1.5 * bingeLimitMultiplier; // default 150%

        console.info('ews / detect üçî checking binge risk...', {
            bingeLimitMultiplier,
            SINGLE_MEAL_PERCENT: `${SINGLE_MEAL_PERCENT}%`,
            EXTREME_OVEREAT_PERCENT: `${(EXTREME_OVEREAT_PERCENT * 100).toFixed(0)}%`
        });

        if (days.length < 5) {
            console.info('ews / detect ‚è≠Ô∏è skip binge: insufficient days', days.length);
            return null;
        }

        const calculateItemKcal = HEYS.InsightsPI?.calculations?.calculateItemKcal;
        if (!calculateItemKcal) {
            console.info('ews / detect ‚è≠Ô∏è skip binge: calculateItemKcal not available');
            return null;
        }

        const optimum = profile?.optimum || profile?.norm?.kcal || 2000;
        const recentDays = days.slice(-7);

        const bingeData = recentDays.map(day => {
            const meals = day.meals || [];
            let bingeMeals = 0;

            // Check each meal for binge characteristics:
            // 1. Large meal (>40% daily optimum in one meal)
            // 2. Multiple large meals in same day
            meals.forEach(meal => {
                if (!meal.items) return;
                const mealKcal = meal.items.reduce((sum, item) => sum + calculateItemKcal(item, pIndex), 0);
                const mealPercent = (mealKcal / optimum) * 100;
                if (mealPercent > SINGLE_MEAL_PERCENT) {
                    bingeMeals++;
                }
            });

            const totalKcal = day.savedEatenKcal || meals.reduce((sum, meal) => {
                if (!meal.items) return sum;
                return sum + meal.items.reduce((mealSum, item) => mealSum + calculateItemKcal(item, pIndex), 0);
            }, 0);

            // Binge indicators:
            // - 2+ large meals in one day
            // - OR single huge meal (>50% optimum)
            // - OR extreme overeating (>150% optimum) after restriction
            const extremeOvereat = totalKcal > (optimum * EXTREME_OVEREAT_PERCENT);
            const bingeDay = bingeMeals >= 2 || extremeOvereat;

            return {
                date: day.date,
                bingeMeals,
                totalKcal,
                bingeDay
            };
        }).filter(d => d.totalKcal > 0);

        if (bingeData.length < 3) {
            console.info('ews / detect ‚è≠Ô∏è skip binge: insufficient data', bingeData.length);
            return null;
        }

        const bingeDays = bingeData.filter(d => d.bingeDay).length;
        const bingeRate = bingeDays / bingeData.length;

        console.info('ews / detect üìä binge data:', {
            totalDays: bingeData.length,
            bingeDays,
            bingeRate: (bingeRate * 100).toFixed(0) + '%',
            threshold: '30%'
        });

        // Warning if >30% of days show binge patterns
        if (bingeRate > 0.3) {
            const avgBingeMeals = bingeData.reduce((s, d) => s + d.bingeMeals, 0) / bingeData.length;
            const humanMsg = WARNING_HUMAN_MESSAGES.BINGE_RISK;

            // Score: 100 = no binge, decreases with binge frequency
            const controlScore = Math.max(0, Math.round((1 - bingeRate) * 100));

            const warning = {
                type: 'BINGE_RISK',
                severity: bingeRate > 0.5 ? 'high' : 'medium',
                bingeDays,
                totalDays: bingeData.length,
                bingeRate: Math.round(bingeRate * 100),
                avgBingeMeals: Math.round(avgBingeMeals * 10) / 10,
                patternName: humanMsg.title,
                message: `üçî ${humanMsg.title}`,
                detail: `${bingeDays} –∏–∑ ${bingeData.length} –¥–Ω–µ–π —Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –ø–µ—Ä–µ–µ–¥–∞–Ω–∏—è (–∫—Ä—É–ø–Ω—ã–µ –ø–æ—Ä—Ü–∏–∏ >40% –Ω–æ—Ä–º—ã)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                currentScore: controlScore,
                actionable: true
            };
            console.info('ews / detect ‚úÖ BINGE_RISK warning:', {
                severity: warning.severity,
                bingeRate: warning.bingeRate + '%',
                currentScore: warning.currentScore
            });
            return warning;
        }

        console.info('ews / detect ‚ûñ no binge risk detected');
        return null;
    }

    /**
     * Warning 13: Mood/wellbeing decline (Tier 3 ‚Äî v3.0)
     * Detects prolonged mood or wellbeing decline (7+ days)
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @returns {object|null}
     */
    function checkMoodWellbeingDecline(days, profile) {
        console.info('ews / detect üòî checking mood/wellbeing decline...');
        if (days.length < 7) {
            console.info('ews / detect ‚è≠Ô∏è skip mood: insufficient days', days.length);
            return null;
        }

        const recentDays = days.slice(-14); // Check last 2 weeks
        const moodData = recentDays.map(day => ({
            date: day.date,
            mood: day.mood || null,
            wellbeing: day.wellbeing || null,
            energy: day.energy || null
        })).filter(d => d.mood !== null || d.wellbeing !== null || d.energy !== null);

        if (moodData.length < 7) {
            console.info('ews / detect ‚è≠Ô∏è skip mood: insufficient mood data', moodData.length);
            return null;
        }

        // Check for consecutive decline trend (7+ days)
        const recent = moodData.slice(-7);
        const avgMood = recent.filter(d => d.mood !== null).length > 0
            ? recent.filter(d => d.mood !== null).reduce((s, d) => s + d.mood, 0) / recent.filter(d => d.mood !== null).length
            : null;

        const avgWellbeing = recent.filter(d => d.wellbeing !== null).length > 0
            ? recent.filter(d => d.wellbeing !== null).reduce((s, d) => s + d.wellbeing, 0) / recent.filter(d => d.wellbeing !== null).length
            : null;

        console.info('ews / detect üìä mood data:', {
            recent: recent.length,
            avgMood: avgMood !== null ? avgMood.toFixed(1) : 'N/A',
            avgWellbeing: avgWellbeing !== null ? avgWellbeing.toFixed(1) : 'N/A',
            threshold: '< 5.0'
        });

        // Warning if average mood or wellbeing <5 over 7 days (scale 1-10)
        const lowMood = avgMood !== null && avgMood < 5;
        const lowWellbeing = avgWellbeing !== null && avgWellbeing < 5;

        if (lowMood || lowWellbeing) {
            const humanMsg = WARNING_HUMAN_MESSAGES.MOOD_WELLBEING_DECLINE;
            const score = avgMood !== null ? Math.round(avgMood * 10) : Math.round(avgWellbeing * 10);

            const warning = {
                type: 'MOOD_WELLBEING_DECLINE',
                severity: score < 40 ? 'high' : 'medium',
                days: 7,
                avgMood: avgMood !== null ? Math.round(avgMood * 10) / 10 : null,
                avgWellbeing: avgWellbeing !== null ? Math.round(avgWellbeing * 10) / 10 : null,
                patternName: humanMsg.title,
                message: `üòî ${humanMsg.title}`,
                detail: `–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å: ${avgMood !== null ? 'mood ' + avgMood.toFixed(1) : ''}${avgMood && avgWellbeing ? ', ' : ''}${avgWellbeing !== null ? 'wellbeing ' + avgWellbeing.toFixed(1) : ''} (–Ω–æ—Ä–º–∞: ‚â•5)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                currentScore: score,
                actionable: true
            };
            console.info('ews / detect ‚úÖ MOOD_WELLBEING_DECLINE warning:', {
                severity: warning.severity,
                score: warning.currentScore
            });
            return warning;
        }

        console.info('ews / detect ‚ûñ no mood/wellbeing decline detected');
        return null;
    }

    /**
     * Warning 14: Weight plateau (Tier 3 ‚Äî v3.0)
     * Detects weight not changing for 14+ days when goal is weight loss
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @returns {object|null}
     */
    function checkWeightPlateau(days, profile) {
        console.info('ews / detect ‚öñÔ∏è checking weight plateau...');
        if (days.length < 14) {
            console.info('ews / detect ‚è≠Ô∏è skip plateau: insufficient days', days.length);
            return null;
        }

        // Only check if goal is weight loss
        const goal = profile?.goal;
        if (!goal || goal !== 'loss') {
            console.info('ews / detect ‚è≠Ô∏è skip plateau: goal is not weight loss', goal);
            return null;
        }

        const recentDays = days.slice(-21); // Check last 3 weeks
        const weightData = recentDays.map(day => ({
            date: day.date,
            weight: day.weightMorning || null
        })).filter(d => d.weight !== null && d.weight > 0);

        if (weightData.length < 14) {
            console.info('ews / detect ‚è≠Ô∏è skip plateau: insufficient weight data', weightData.length);
            return null;
        }

        // Check if weight variation is <1kg over 14 days
        const recent = weightData.slice(-14);
        const weights = recent.map(d => d.weight);
        const minWeight = Math.min(...weights);
        const maxWeight = Math.max(...weights);
        const variation = maxWeight - minWeight;

        console.info('ews / detect üìä weight plateau data:', {
            days: recent.length,
            minWeight: minWeight.toFixed(1),
            maxWeight: maxWeight.toFixed(1),
            variation: variation.toFixed(2),
            threshold: '< 1.0 kg'
        });

        // Warning if variation <1kg (plateau)
        if (variation < 1.0) {
            const humanMsg = WARNING_HUMAN_MESSAGES.WEIGHT_PLATEAU;
            const avgWeight = weights.reduce((s, w) => s + w, 0) / weights.length;

            // Score: lower = plateau (less variation)
            // 100 = normal progress (>2kg variation), 0 = complete plateau
            const progressScore = Math.min(100, Math.round(variation * 50));

            const warning = {
                type: 'WEIGHT_PLATEAU',
                severity: variation < 0.5 ? 'high' : 'medium',
                days: 14,
                variation: Math.round(variation * 100) / 100,
                avgWeight: Math.round(avgWeight * 10) / 10,
                patternName: humanMsg.title,
                message: `‚öñÔ∏è ${humanMsg.title}`,
                detail: `–í–µ—Å –∫–æ–ª–µ–±–ª–µ—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö ${variation.toFixed(1)} –∫–≥ –∑–∞ 14 –¥–Ω–µ–π (—Å—Ä–µ–¥–Ω–µ–µ: ${avgWeight.toFixed(1)} –∫–≥)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                currentScore: progressScore,
                actionable: true
            };
            console.info('ews / detect ‚úÖ WEIGHT_PLATEAU warning:', {
                severity: warning.severity,
                variation: warning.variation,
                currentScore: warning.currentScore
            });
            return warning;
        }

        console.info('ews / detect ‚ûñ no weight plateau detected');
        return null;
    }

    /**
     * Warning 15: Weekend pattern (Tier 3 ‚Äî v3.0)
     * Detects worse nutrition patterns on Sat/Sun (excess calories, alcohol, carbs)
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile
     * @param {object} pIndex
     * @returns {object|null}
     */
    function checkWeekendPattern(days, profile, pIndex) {
        console.info('ews / detect üçª checking weekend pattern...');
        if (days.length < 14) {
            console.info('ews / detect ‚è≠Ô∏è skip weekend: insufficient days', days.length);
            return null;
        }

        const calculateItemKcal = HEYS.InsightsPI?.calculations?.calculateItemKcal;
        if (!calculateItemKcal) {
            console.info('ews / detect ‚è≠Ô∏è skip weekend: calculateItemKcal not available');
            return null;
        }

        const optimum = profile?.optimum || profile?.norm?.kcal || 2000;
        const recentDays = days.slice(-21); // Last 3 weeks

        const weekdayData = [];
        const weekendData = [];

        recentDays.forEach(day => {
            const dayOfWeek = new Date(day.date).getDay(); // 0=Sun, 6=Sat
            const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;

            let totalKcal = day.savedEatenKcal || 0;
            if (!totalKcal && day.meals) {
                totalKcal = day.meals.reduce((sum, meal) => {
                    if (!meal.items) return sum;
                    return sum + meal.items.reduce((mealSum, item) => mealSum + calculateItemKcal(item, pIndex), 0);
                }, 0);
            }

            const excessKcal = totalKcal > optimum ? totalKcal - optimum : 0;

            const dataPoint = {
                date: day.date,
                totalKcal,
                excessKcal,
                hasAlcohol: day.alcohol || false
            };

            if (isWeekend) {
                weekendData.push(dataPoint);
            } else {
                weekdayData.push(dataPoint);
            }
        });

        if (weekendData.length < 4 || weekdayData.length < 10) {
            console.info('ews / detect ‚è≠Ô∏è skip weekend: insufficient data', {
                weekendDays: weekendData.length,
                weekdays: weekdayData.length
            });
            return null;
        }

        const avgWeekendKcal = weekendData.reduce((s, d) => s + d.totalKcal, 0) / weekendData.length;
        const avgWeekdayKcal = weekdayData.reduce((s, d) => s + d.totalKcal, 0) / weekdayData.length;
        const weekendExcess = avgWeekendKcal - avgWeekdayKcal;
        const weekendExcessPercent = (weekendExcess / avgWeekdayKcal) * 100;

        const weekendAlcoholDays = weekendData.filter(d => d.hasAlcohol).length;
        const weekendAlcoholRate = weekendAlcoholDays / weekendData.length;

        console.info('ews / detect üìä weekend pattern data:', {
            avgWeekendKcal: Math.round(avgWeekendKcal),
            avgWeekdayKcal: Math.round(avgWeekdayKcal),
            weekendExcess: Math.round(weekendExcess),
            weekendExcessPercent: weekendExcessPercent.toFixed(0) + '%',
            alcoholRate: (weekendAlcoholRate * 100).toFixed(0) + '%',
            threshold: '+20% or alcohol >50%'
        });

        // Warning if weekend excess >20% OR alcohol >50% of weekends
        if (weekendExcessPercent > 20 || weekendAlcoholRate > 0.5) {
            const humanMsg = WARNING_HUMAN_MESSAGES.WEEKEND_PATTERN;

            // Score: 100 = consistent week, lower = worse weekends
            const consistencyScore = Math.max(0, Math.round(100 - weekendExcessPercent));

            const warning = {
                type: 'WEEKEND_PATTERN',
                severity: weekendExcessPercent > 30 || weekendAlcoholRate > 0.7 ? 'high' : 'medium',
                avgWeekendKcal: Math.round(avgWeekendKcal),
                avgWeekdayKcal: Math.round(avgWeekdayKcal),
                weekendExcess: Math.round(weekendExcess),
                weekendExcessPercent: Math.round(weekendExcessPercent),
                weekendAlcoholRate: Math.round(weekendAlcoholRate * 100),
                patternName: humanMsg.title,
                message: `üçª ${humanMsg.title}`,
                detail: `–í—ã—Ö–æ–¥–Ω—ã–µ: ${Math.round(avgWeekendKcal)} –∫–∫–∞–ª (–±—É–¥–Ω–∏: ${Math.round(avgWeekdayKcal)} –∫–∫–∞–ª, +${Math.round(weekendExcessPercent)}%), –∞–ª–∫–æ–≥–æ–ª—å: ${Math.round(weekendAlcoholRate * 100)}% –¥–Ω–µ–π`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                currentScore: consistencyScore,
                actionable: true
            };
            console.info('ews / detect ‚úÖ WEEKEND_PATTERN warning:', {
                severity: warning.severity,
                excess: warning.weekendExcessPercent + '%',
                currentScore: warning.currentScore
            });
            return warning;
        }

        console.info('ews / detect ‚ûñ no weekend pattern detected');
        return null;
    }

    // ========================================
    // Warning 16: Fiber deficit (v3.2)
    // ========================================
    function checkFiberDeficit(days, profile) {
        console.info('ews / detect check_16:', { name: 'FiberDeficit', days: days.length });

        const MIN_DAYS = 5;
        // v5.0: Phenotype-aware threshold
        const FIBER_THRESHOLD = getEwsThreshold('fiberTarget', 15, profile); // default 15g
        console.info('ews / detect üåæ fiber params:', { FIBER_THRESHOLD: `${FIBER_THRESHOLD}g` });

        if (days.length < MIN_DAYS) return null;

        const lowFiberDays = [];
        for (const day of days) {
            const fiber = day.dayTot?.fiber || 0;
            if (fiber < FIBER_THRESHOLD) {
                lowFiberDays.push({ date: day.date, fiber });
            }
        }

        if (lowFiberDays.length >= MIN_DAYS) {
            const avgFiber = lowFiberDays.reduce((sum, d) => sum + d.fiber, 0) / lowFiberDays.length;
            const humanMsg = WARNING_HUMAN_MESSAGES.FIBER_DEFICIT;
            const fiberScore = Math.min(100, Math.round((avgFiber / 30) * 100)); // Optimal target: 30g
            console.info('ews / detect üî∂ FiberDeficit:', { lowDays: lowFiberDays.length, avgFiber: avgFiber.toFixed(1) });

            return {
                type: 'FIBER_DEFICIT',
                severity: 'medium',
                patternName: humanMsg.title,
                message: `üìä ${humanMsg.title}`,
                detail: `–°—Ä–µ–¥–Ω—è—è –∫–ª–µ—Ç—á–∞—Ç–∫–∞: ${avgFiber.toFixed(1)}–≥ (—Ü–µ–ª—å: ${FIBER_THRESHOLD}+–≥)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                dates: lowFiberDays.map(d => d.date),
                metrics: {
                    avgFiber: Math.round(avgFiber * 10) / 10,
                    threshold: FIBER_THRESHOLD,
                    lowDays: lowFiberDays.length
                },
                currentScore: fiberScore,
                actionable: true
            };
        }

        return null;
    }

    // ========================================
    // Warning 17: Sodium excess (v3.2)
    // ========================================
    function checkSodiumExcess(days, profile) {
        console.info('ews / detect check_17:', { name: 'SodiumExcess', days: days.length });

        const MIN_DAYS = 3;
        // v5.0: Phenotype-aware threshold
        const SODIUM_THRESHOLD = getEwsThreshold('sodiumLimit', 4000, profile); // default 4000mg
        console.info('ews / detect üßÇ sodium params:', { SODIUM_THRESHOLD: `${SODIUM_THRESHOLD}mg` });

        if (days.length < MIN_DAYS) return null;

        const highSodiumDays = [];
        for (const day of days) {
            const sodium = day.dayTot?.sodium || 0;
            if (sodium > SODIUM_THRESHOLD) {
                highSodiumDays.push({ date: day.date, sodium });
            }
        }

        if (highSodiumDays.length >= MIN_DAYS) {
            const avgSodium = highSodiumDays.reduce((sum, d) => sum + d.sodium, 0) / highSodiumDays.length;
            const humanMsg = WARNING_HUMAN_MESSAGES.SODIUM_EXCESS;
            const sodiumScore = Math.max(0, Math.round((1 - (avgSodium - 2300) / 2300) * 100)); // Optimal: 2300mg
            console.info('ews / detect üî∂ SodiumExcess:', { highDays: highSodiumDays.length, avgSodium: avgSodium.toFixed(0) });

            return {
                type: 'SODIUM_EXCESS',
                severity: 'medium',
                patternName: humanMsg.title,
                message: `üßÇ ${humanMsg.title}`,
                detail: `–°—Ä–µ–¥–Ω–∏–π –Ω–∞—Ç—Ä–∏–π: ${Math.round(avgSodium)} –º–≥ (—Ü–µ–ª—å: <${SODIUM_THRESHOLD} –º–≥)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                dates: highSodiumDays.map(d => d.date),
                metrics: {
                    avgSodium: Math.round(avgSodium),
                    threshold: SODIUM_THRESHOLD,
                    highDays: highSodiumDays.length
                },
                currentScore: sodiumScore,
                actionable: true
            };
        }

        return null;
    }

    // ========================================
    // Warning 18: Circadian disruption (v3.2)
    // ========================================
    function checkCircadianDisruption(days, profile) {
        console.info('ews / detect check_18:', { name: 'CircadianDisruption', days: days.length });

        const MIN_DAYS = 7;

        // v5.0: Phenotype-aware late meal threshold
        const lateHourDecimal = getEwsThreshold('lateEatingHour', 22.0, profile); // default 22:00
        const lateH = Math.floor(lateHourDecimal);
        const lateM = Math.round((lateHourDecimal % 1) * 60);
        const LATE_MEAL_TIME = `${String(lateH).padStart(2, '0')}:${String(lateM).padStart(2, '0')}`;

        const varianceThresholdBase = 2.0;
        // Apply sleep variability multiplier (if defined in phenotype)
        const SLEEP_VARIANCE_THRESHOLD = getEwsThreshold('sleepVariabilityHours', varianceThresholdBase, profile);
        console.info('ews / detect üåô circadian params:', { LATE_MEAL_TIME, SLEEP_VARIANCE_THRESHOLD: `${SLEEP_VARIANCE_THRESHOLD}h` });

        if (days.length < MIN_DAYS) return null;

        let lateMealCount = 0;
        const sleepTimes = [];

        for (const day of days) {
            // Check for late meals
            if (day.meals && Array.isArray(day.meals)) {
                for (const meal of day.meals) {
                    if (meal.time && meal.time >= LATE_MEAL_TIME) {
                        lateMealCount++;
                        break; // Count day once
                    }
                }
            }

            // Check sleep time
            if (day.sleep?.time) {
                const [h, m] = day.sleep.time.split(':').map(Number);
                sleepTimes.push(h + m / 60);
            }
        }

        const lateMealRatio = lateMealCount / days.length;

        let sleepVariance = 0;
        if (sleepTimes.length >= 3) {
            const avgSleep = sleepTimes.reduce((sum, t) => sum + t, 0) / sleepTimes.length;
            const maxDiff = Math.max(...sleepTimes.map(t => Math.abs(t - avgSleep)));
            sleepVariance = maxDiff;
        }

        const isDisrupted = (lateMealRatio >= 4 / 7) || (sleepVariance > SLEEP_VARIANCE_THRESHOLD);

        if (isDisrupted) {
            const humanMsg = WARNING_HUMAN_MESSAGES.CIRCADIAN_DISRUPTION;
            const circadianScore = Math.max(0, Math.round(100 - (lateMealRatio * 100 + sleepVariance * 10)));
            console.info('ews / detect üî∂ CircadianDisruption:', {
                lateMeals: lateMealCount,
                lateMealRatio: lateMealRatio.toFixed(2),
                sleepVariance: sleepVariance.toFixed(1)
            });

            return {
                type: 'CIRCADIAN_DISRUPTION',
                severity: 'high',
                patternName: humanMsg.title,
                message: `üåô ${humanMsg.title}`,
                detail: `–ü–æ–∑–¥–Ω–∏–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏: ${lateMealCount} –¥–Ω–µ–π, —Ä–∞–∑–±—Ä–æ—Å —Å–Ω–∞: ${sleepVariance.toFixed(1)}—á`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                dates: days.map(d => d.date),
                metrics: {
                    lateMealCount,
                    sleepVariance: Math.round(sleepVariance * 10) / 10
                },
                currentScore: circadianScore,
                actionable: true
            };
        }

        return null;
    }

    // ========================================
    // Warning 19: Training without recovery (v3.2)
    // ========================================
    function checkTrainingWithoutRecovery(days, profile) {
        console.info('ews / detect check_19:', { name: 'TrainingWithoutRecovery', days: days.length });

        const MIN_DAYS = 5;
        const TRAINING_THRESHOLD = 3; // trainings in 5 days
        const SLEEP_THRESHOLD = 6.5; // hours
        const STRESS_THRESHOLD = 7;

        if (days.length < MIN_DAYS) return null;

        const recentDays = days.slice(-MIN_DAYS);
        let trainingCount = 0;
        let poorRecoveryCount = 0;

        for (const day of recentDays) {
            if (day.training?.duration && day.training.duration > 0) {
                trainingCount++;

                const sleepHours = calculateSleepHours(day.sleep?.duration);
                const stress = day.stress || 0;

                if (sleepHours < SLEEP_THRESHOLD || stress > STRESS_THRESHOLD) {
                    poorRecoveryCount++;
                }
            }
        }

        if (trainingCount >= TRAINING_THRESHOLD && poorRecoveryCount >= 2) {
            const humanMsg = WARNING_HUMAN_MESSAGES.TRAINING_WITHOUT_RECOVERY;
            const recoveryScore = Math.max(0, Math.round(100 - (poorRecoveryCount / trainingCount) * 100));
            console.info('ews / detect üî¥ TrainingWithoutRecovery:', {
                trainings: trainingCount,
                poorRecovery: poorRecoveryCount
            });

            return {
                type: 'TRAINING_WITHOUT_RECOVERY',
                severity: 'high',
                patternName: humanMsg.title,
                message: `üí™ ${humanMsg.title}`,
                detail: `${trainingCount} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ ${MIN_DAYS} –¥–Ω–µ–π –ø—Ä–∏ ${poorRecoveryCount} –¥–Ω—è—Ö –ø–ª–æ—Ö–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                dates: recentDays.map(d => d.date),
                metrics: {
                    trainingCount,
                    poorRecoveryCount,
                    windowDays: MIN_DAYS
                },
                currentScore: recoveryScore,
                actionable: true
            };
        }

        return null;
    }

    // ========================================
    // Warning 20: Fat quality decline (v3.2)
    // ========================================
    function checkFatQualityDecline(days, profile, pIndex) {
        console.info('ews / detect check_20:', { name: 'FatQualityDecline', days: days.length });

        const MIN_DAYS = 7;
        const SCORE_THRESHOLD = 40;

        if (days.length < MIN_DAYS) return null;

        let lowScoreDays = 0;
        let totalScore = 0;

        for (const day of days) {
            const score = day.patterns?.omega_balancer?.score;
            if (typeof score === 'number') {
                totalScore += score;
                if (score < SCORE_THRESHOLD) {
                    lowScoreDays++;
                }
            }
        }

        if (lowScoreDays >= MIN_DAYS) {
            const avgScore = totalScore / days.length;
            const humanMsg = WARNING_HUMAN_MESSAGES.FAT_QUALITY_DECLINE;
            console.info('ews / detect üî∂ FatQualityDecline:', { lowDays: lowScoreDays, avgScore: avgScore.toFixed(1) });

            return {
                type: 'FAT_QUALITY_DECLINE',
                severity: 'medium',
                patternName: humanMsg.title,
                message: `ü•ë ${humanMsg.title}`,
                detail: `Omega Balancer: ${Math.round(avgScore)} –±–∞–ª–ª–æ–≤ (—Ü–µ–ª—å: ${SCORE_THRESHOLD}+)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                dates: days.map(d => d.date),
                metrics: {
                    avgScore: Math.round(avgScore),
                    threshold: SCORE_THRESHOLD,
                    lowDays: lowScoreDays
                },
                currentScore: Math.round(avgScore),
                actionable: true
            };
        }

        return null;
    }

    // ========================================
    // Warning 21: Sugar dependency (v3.2)
    // ========================================
    function checkSugarDependency(days, profile) {
        console.info('ews / detect check_21:', { name: 'SugarDependency', days: days.length });

        const MIN_DAYS = 7;

        // v5.0: Phenotype-aware sensitivity
        // Logic: Lower sugar limit (e.g. 0.5 multiplier for IR) -> Higher score threshold required
        // If multiplier < 1 (strict), we divide base threshold by it to raise the bar
        // Base threshold 35 / 0.5 = 70 (warn if score < 70)

        const sugarLimitMultiplier = getEwsThreshold('sugarLimit', 1.0, profile);
        const SCORE_THRESHOLD = Math.round(35 / (sugarLimitMultiplier > 0 ? sugarLimitMultiplier : 1));
        console.info('ews / detect üç¨ sugar params:', { sugarLimitMultiplier, SCORE_THRESHOLD });

        if (days.length < MIN_DAYS) return null;

        let lowScoreDays = 0;
        let totalScore = 0;

        for (const day of days) {
            const score = day.patterns?.added_sugar_dependency?.score;
            if (typeof score === 'number') {
                totalScore += score;
                if (score < SCORE_THRESHOLD) {
                    lowScoreDays++;
                }
            }
        }

        if (lowScoreDays >= MIN_DAYS) {
            const avgScore = totalScore / days.length;
            const humanMsg = WARNING_HUMAN_MESSAGES.SUGAR_DEPENDENCY;
            console.info('ews / detect üî∂ SugarDependency:', { lowDays: lowScoreDays, avgScore: avgScore.toFixed(1) });

            return {
                type: 'SUGAR_DEPENDENCY',
                severity: 'medium',
                patternName: humanMsg.title,
                message: `üç¨ ${humanMsg.title}`,
                detail: `Added Sugar Dependency: ${Math.round(avgScore)} –±–∞–ª–ª–æ–≤ (—Ü–µ–ª—å: ${SCORE_THRESHOLD}+)`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                dates: days.map(d => d.date),
                metrics: {
                    avgScore: Math.round(avgScore),
                    threshold: SCORE_THRESHOLD,
                    lowDays: lowScoreDays
                },
                currentScore: Math.round(avgScore),
                actionable: true
            };
        }

        return null;
    }

    // ========================================
    // Warning 22: Micronutrient gap (v3.2)
    // ========================================
    function checkMicronutrientGap(days, profile) {
        console.info('ews / detect check_22:', { name: 'MicronutrientGap', days: days.length });

        const MIN_DAYS = 7;
        const SCORE_THRESHOLD = 50;
        const MIN_LOW_PATTERNS = 2;

        if (days.length < MIN_DAYS) return null;

        const microPatterns = ['vitamin_d', 'magnesium', 'zinc', 'iron', 'calcium'];
        const patternScores = {};

        for (const pattern of microPatterns) {
            let totalScore = 0;
            let count = 0;
            for (const day of days) {
                const score = day.patterns?.[pattern]?.score;
                if (typeof score === 'number') {
                    totalScore += score;
                    count++;
                }
            }
            if (count > 0) {
                patternScores[pattern] = totalScore / count;
            }
        }

        const lowPatterns = Object.entries(patternScores)
            .filter(([_, score]) => score < SCORE_THRESHOLD)
            .map(([name, score]) => ({ name, score }));

        if (lowPatterns.length >= MIN_LOW_PATTERNS) {
            const humanMsg = WARNING_HUMAN_MESSAGES.MICRONUTRIENT_GAP;
            const avgLowScore = lowPatterns.reduce((sum, p) => sum + p.score, 0) / lowPatterns.length;
            console.info('ews / detect üî∂ MicronutrientGap:', {
                lowPatterns: lowPatterns.length,
                patterns: lowPatterns.map(p => p.name)
            });

            return {
                type: 'MICRONUTRIENT_GAP',
                severity: 'medium',
                patternName: humanMsg.title,
                message: `üî¨ ${humanMsg.title}`,
                detail: `${lowPatterns.length} –º–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤ —Å –Ω–∏–∑–∫–∏–º score: ${lowPatterns.map(p => p.name).join(', ')}`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                dates: days.map(d => d.date),
                metrics: {
                    lowPatternCount: lowPatterns.length,
                    patterns: lowPatterns
                },
                currentScore: Math.round(avgLowScore),
                actionable: true
            };
        }

        return null;
    }

    // ========================================
    // Warning 23: Step decline (v3.2)
    // ========================================
    function checkStepDecline(days, profile) {
        console.info('ews / detect check_23:', { name: 'StepDecline', days: days.length });

        const MIN_DAYS = 30;
        const RECENT_WINDOW = 7;
        const DECLINE_THRESHOLD = 0.5; // 50% decline

        if (days.length < MIN_DAYS) return null;

        const recentDays = days.slice(-RECENT_WINDOW);
        const allDays = days.slice(-MIN_DAYS);

        let recentSteps = 0;
        let recentCount = 0;
        for (const day of recentDays) {
            if (day.steps && day.steps > 0) {
                recentSteps += day.steps;
                recentCount++;
            }
        }

        let allSteps = 0;
        let allCount = 0;
        for (const day of allDays) {
            if (day.steps && day.steps > 0) {
                allSteps += day.steps;
                allCount++;
            }
        }

        if (recentCount < 3 || allCount < 15) return null;

        const recentAvg = recentSteps / recentCount;
        const allAvg = allSteps / allCount;

        const declineRatio = recentAvg / allAvg;

        if (declineRatio < DECLINE_THRESHOLD) {
            const humanMsg = WARNING_HUMAN_MESSAGES.STEP_DECLINE;
            const declinePercent = Math.round((1 - declineRatio) * 100);
            const stepScore = Math.max(0, Math.round(100 - declinePercent));
            console.info('ews / detect üî∂ StepDecline:', {
                recentAvg: recentAvg.toFixed(0),
                allAvg: allAvg.toFixed(0),
                decline: declinePercent + '%'
            });

            return {
                type: 'STEP_DECLINE',
                severity: 'low',
                patternName: humanMsg.title,
                message: `üö∂ ${humanMsg.title}`,
                detail: `–®–∞–≥–∏ —É–ø–∞–ª–∏ –Ω–∞ ${declinePercent}%: —Å ${Math.round(allAvg)} –¥–æ ${Math.round(recentAvg)} —à–∞–≥–æ–≤/–¥–µ–Ω—å`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                dates: recentDays.map(d => d.date),
                metrics: {
                    recentAvg: Math.round(recentAvg),
                    normalAvg: Math.round(allAvg),
                    declinePercent
                },
                currentScore: stepScore,
                actionable: true
            };
        }

        return null;
    }

    // ========================================
    // Warning 24: Meal timing drift (v3.2)
    // ========================================
    function checkMealTimingDrift(days, profile) {
        console.info('ews / detect check_24:', { name: 'MealTimingDrift', days: days.length });

        const MIN_DAYS = 7;

        // v5.0: Phenotype-aware stability check
        // Smaller window (e.g. 0.9 for IR) -> Stricter variance 
        const VARIANCE_THRESHOLD = getEwsThreshold('mealTimeWindow', 2.5, profile); // default 2.5h
        console.info('ews / detect ‚è∞ timing params:', { VARIANCE_THRESHOLD: `${VARIANCE_THRESHOLD}h` });

        if (days.length < MIN_DAYS) return null;

        const breakfastTimes = [];

        for (const day of days) {
            if (day.meals && Array.isArray(day.meals) && day.meals.length > 0) {
                const firstMeal = day.meals[0];
                if (firstMeal.time) {
                    const [h, m] = firstMeal.time.split(':').map(Number);
                    breakfastTimes.push(h + m / 60);
                }
            }
        }

        if (breakfastTimes.length < MIN_DAYS) return null;

        const avgTime = breakfastTimes.reduce((sum, t) => sum + t, 0) / breakfastTimes.length;
        const maxDiff = Math.max(...breakfastTimes.map(t => Math.abs(t - avgTime)));

        if (maxDiff > VARIANCE_THRESHOLD) {
            const humanMsg = WARNING_HUMAN_MESSAGES.MEAL_TIMING_DRIFT;
            const timingScore = Math.max(0, Math.round(100 - (maxDiff / 4) * 100)); // Score decreases with variance
            console.info('ews / detect üî∂ MealTimingDrift:', { variance: maxDiff.toFixed(1) });

            return {
                type: 'MEAL_TIMING_DRIFT',
                severity: 'low',
                patternName: humanMsg.title,
                message: `‚è∞ ${humanMsg.title}`,
                detail: `–í—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–∏—ë–º–∞ –ø–∏—â–∏ –∫–æ–ª–µ–±–ª–µ—Ç—Å—è –Ω–∞ ${maxDiff.toFixed(1)} —á–∞—Å–∞`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                dates: days.map(d => d.date),
                metrics: {
                    variance: Math.round(maxDiff * 10) / 10,
                    threshold: VARIANCE_THRESHOLD
                },
                currentScore: timingScore,
                actionable: true
            };
        }

        return null;
    }

    // ========================================
    // Warning 25: Electrolyte imbalance (v3.2)
    // ========================================
    function checkElectrolyteImbalance(days, profile) {
        console.info('ews / detect check_25:', { name: 'ElectrolyteImbalance', days: days.length });

        const MIN_DAYS = 5;
        const SCORE_THRESHOLD = 40;
        const MIN_TRAININGS = 2;

        if (days.length < MIN_DAYS) return null;

        let lowScoreDays = 0;
        let trainingCount = 0;
        let totalScore = 0;

        for (const day of days) {
            const score = day.patterns?.electrolyte_homeostasis?.score;
            if (typeof score === 'number') {
                totalScore += score;
                if (score < SCORE_THRESHOLD) {
                    lowScoreDays++;
                }
            }
            if (day.training?.duration && day.training.duration > 0) {
                trainingCount++;
            }
        }

        if (lowScoreDays >= 3 && trainingCount >= MIN_TRAININGS) {
            const avgScore = totalScore / days.length;
            const humanMsg = WARNING_HUMAN_MESSAGES.ELECTROLYTE_IMBALANCE;
            console.info('ews / detect üî∂ ElectrolyteImbalance:', {
                lowDays: lowScoreDays,
                trainings: trainingCount,
                avgScore: avgScore.toFixed(1)
            });

            return {
                type: 'ELECTROLYTE_IMBALANCE',
                severity: 'medium',
                patternName: humanMsg.title,
                message: `‚ö° ${humanMsg.title}`,
                detail: `Electrolyte Homeostasis: ${Math.round(avgScore)} –±–∞–ª–ª–æ–≤ –ø—Ä–∏ ${trainingCount} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö`,
                insight: humanMsg.insight,
                science: humanMsg.science,
                dates: days.map(d => d.date),
                metrics: {
                    avgScore: Math.round(avgScore),
                    threshold: SCORE_THRESHOLD,
                    lowDays: lowScoreDays,
                    trainingCount
                },
                currentScore: Math.round(avgScore),
                actionable: true
            };
        }

        return null;
    }

    /**
     * Helper: Calculate time gap between two time strings
     * @param {string} time1 - "08:30"
     * @param {string} time2 - "18:45"
     * @returns {number} - Hours between times
     */
    function calculateTimeGap(time1, time2) {
        if (!time1 || !time2) return 0;
        try {
            const [h1, m1] = time1.split(':').map(Number);
            const [h2, m2] = time2.split(':').map(Number);
            const minutes1 = h1 * 60 + m1;
            const minutes2 = h2 * 60 + m2;
            let diff = minutes2 - minutes1;
            if (diff < 0) diff += 24 * 60; // Handle overnight
            return diff / 60;
        } catch (e) {
            return 0;
        }
    }

    /**
     * Helper: Calculate sleep hours from start/end time
     * @param {string} start - "23:00"
     * @param {string} end - "07:30"
     * @returns {number}
     */
    function calculateSleepHours(start, end) {
        if (!start || !end) return 0;

        try {
            const [startH, startM] = start.split(':').map(Number);
            const [endH, endM] = end.split(':').map(Number);

            let hours = endH - startH;
            let minutes = endM - startM;

            if (hours < 0) hours += 24; // Overnight
            if (minutes < 0) {
                hours -= 1;
                minutes += 60;
            }

            return hours + minutes / 60;
        } catch (e) {
            return 0;
        }
    }

    /**
     * Calculate EWS Global Score (0-100) - Single summary metric of overall risk
     * Formula: Aggregate severity √ó healthImpact √ó chronicity, normalized to 0-100
     * Higher score = higher risk
     * 
     * @param {object[]} warnings - Array of detected warnings
     * @param {object} trends - Trends object with chronicWarnings and allTrends
     * @returns {object} { score: number, breakdown: object }
     */
    function calculateEwsGlobalScore(warnings, trends) {
        const LOG_PREFIX = 'ews / global_score';

        console.info(`${LOG_PREFIX} üöÄ start`, { warningsCount: warnings.length });

        // Graceful fallback for empty warnings
        if (!warnings || warnings.length === 0) {
            console.info(`${LOG_PREFIX} ‚úÖ result`, { score: 0, reason: 'no_warnings' });
            return { score: 0, breakdown: { totalWeight: 0, components: [] } };
        }

        console.info(`${LOG_PREFIX} üì• input`, {
            warnings: warnings.length,
            hasHighSeverity: warnings.filter(w => w.severity === 'high').length,
            hasChronicWarnings: trends?.chronicWarnings?.length || 0
        });

        // Severity weights
        const SEVERITY_WEIGHTS = { high: 3, medium: 2, low: 1 };

        // Calculate weighted score for each warning
        const components = warnings.map(w => {
            const severityWeight = SEVERITY_WEIGHTS[w.severity] || 1;
            const healthImpact = w.healthImpact || HEALTH_IMPACT_SCORES[w.type] || 50;

            // Chronicity factor from trends (1.0 baseline, up to 2.0 for chronic)
            let chronicityFactor = 1.0;
            if (trends?.allTrends && trends.allTrends[w.type]) {
                const trend = trends.allTrends[w.type];
                if (trend.chronic) chronicityFactor = 2.0;
                else if (trend.frequent) chronicityFactor = 1.5;
            }

            const componentWeight = severityWeight * (healthImpact / 100) * chronicityFactor;

            return {
                type: w.type,
                severity: w.severity,
                healthImpact,
                chronicityFactor,
                weight: componentWeight
            };
        });

        const totalWeight = components.reduce((sum, c) => sum + c.weight, 0);

        console.info(`${LOG_PREFIX} üßÆ compute`, {
            components: components.length,
            totalWeight: totalWeight.toFixed(2),
            maxTheoreticalPerWarning: 3 * 1.0 * 2.0, // high severity √ó max impact √ó max chronicity
            topContributors: components.sort((a, b) => b.weight - a.weight).slice(0, 3).map(c => c.type)
        });

        // Normalize to 0-100 scale
        // Max theoretical: if all warnings were high severity (3) √ó max health impact (1.0) √ó chronic (2.0) = 6 per warning
        // We'll use a more conservative normalization: score = totalWeight √ó 10, capped at 100
        // This gives meaningful scores: 1 high-impact chronic warning ‚âà 60 score
        const rawScore = Math.min(100, totalWeight * 10);
        const finalScore = Math.round(rawScore);

        console.info(`${LOG_PREFIX} ‚úÖ result`, {
            score: finalScore,
            totalWeight: totalWeight.toFixed(2),
            warningsCount: warnings.length,
            chronicCount: trends?.chronicWarnings?.length || 0
        });

        return {
            score: finalScore,
            breakdown: {
                totalWeight,
                components,
                normalizationFactor: 10
            }
        };
    }

    /**
     * Get phenotype-adjusted threshold for EWS check
     * @param {string} key - Threshold key (e.g., 'sodiumLimit')
     * @param {number} defaultVal - Default value if no adjustment
     * @param {object} profile - User profile
     * @returns {number} - Adjusted threshold
     */
    let _phenotypeHintShown = false; // Show friendly hint only once per session
    function getEwsThreshold(key, defaultVal, profile) {
        // v2.1: Smart auto-detection on first real usage (no setTimeout guessing!)
        const isFirstCall = !_phenotypeHintShown;

        // If no phenotype module or profile, return default
        if (!HEYS.InsightsPI?.phenotype?.applyMultipliers || !profile?.phenotype) {
            if (!_phenotypeHintShown) {
                console.warn(`%c[HEYS.ews.phenotype] ‚ö†Ô∏è Using DEFAULT thresholds (no phenotype set)`, 'color: #ffaa00; font-weight: bold');
                console.info(`%c  üí° Tip: Set phenotype for personalized thresholds:`, 'color: #ffaa00');
                console.info(`     HEYS.InsightsPI.phenotype.setPreset('IR_EVENING')  // insulin resistant + evening type`);
                console.info(`     HEYS.InsightsPI.phenotype.setPreset('OPTIMAL')     // optimal metabolism`);
                console.info(`  Then reload page to see üß¨ Adjusted thresholds in action`);
                _phenotypeHintShown = true;
            }
            return defaultVal;
        }

        // First call with active phenotype - show success message
        if (isFirstCall) {
            console.info('%c[HEYS.ews.phenotype] üß¨ Active phenotype detected:', 'color: #00ff00; font-weight: bold', profile.phenotype);
            console.info('%c  ‚úÖ Personalized thresholds enabled. Expected adjustments:', 'color: #00ff00');
            if (profile.phenotype.metabolic === 'insulin_resistant') {
                console.info('     ‚Ä¢ Fiber target: 15g ‚Üí ~23g (+56%)');
                console.info('     ‚Ä¢ Sodium limit: 4000mg ‚Üí ~3200mg (-20%)');
                console.info('     ‚Ä¢ Sugar tolerance: 1.0x ‚Üí ~0.3x (-70%)');
                console.info('     ‚Ä¢ Protein target: 1.0x ‚Üí ~1.4x (+40%)');
            }
            if (profile.phenotype.circadian === 'evening_type') {
                console.info('     ‚Ä¢ Late eating: 22:00 ‚Üí ~20:36 (-1.4h)');
                console.info('     ‚Ä¢ Sleep variability: 2h ‚Üí ~2.3h (+15%)');
            }
            if (profile.phenotype.satiety === 'low_satiety') {
                console.info('     ‚Ä¢ Meal skip tolerance: 1.0x ‚Üí ~0.8x (-20% stricter)');
                console.info('     ‚Ä¢ Binge volume: 1.0x ‚Üí ~0.7x (-30% stricter)');
            }
            if (profile.phenotype.stress === 'stress_eater') {
                console.info('     ‚Ä¢ Stress sensitivity: 1.0x ‚Üí ~1.3x (+30% more sensitive)');
            }
            _phenotypeHintShown = true;
        }

        // Apply multipliers
        const thresholds = { [key]: defaultVal };
        const adjusted = HEYS.InsightsPI.phenotype.applyMultipliers(thresholds, profile.phenotype);
        const result = adjusted[key];

        // Show individual adjustment (every time, for transparency)
        if (result !== defaultVal) {
            const categories = [
                profile.phenotype.metabolic,
                profile.phenotype.circadian,
                profile.phenotype.satiety,
                profile.phenotype.stress
            ].filter(Boolean).join('/');
            console.info(`[HEYS.ews.phenotype] üß¨ Adjusted ${key}: ${defaultVal} ‚Üí ${result} (${categories})`);
        }

        return result;
    }

    /**
     * Main API: Detect all early warning signals
     * @param {object[]} days - Array of day objects (sorted oldest to newest)
     * @param {object} profile - User profile
     * @param {object} pIndex - Product index
     * @param {object} [options] - Optional config: { mode: 'acute'|'full', includeDetails, currentPatterns, previousPatterns }
     * @returns {object}
     */
    function detectEarlyWarnings(days, profile, pIndex, options = {}) {
        // Mode validation & default
        const mode = options.mode || 'full';
        if (!['acute', 'full'].includes(mode)) {
            console.warn('ews / detect ‚ö†Ô∏è invalid mode:', mode, '‚Üí defaulting to "full"');
            mode = 'full';
        }

        const checksCount = mode === 'acute' ? 10 : 25;

        console.info('ews / detect üöÄ start:', {
            mode: mode,
            windowDays: days?.length || 0,
            checks: checksCount,
            tiers: mode === 'acute'
                ? '10 Acute (Health, Status, Sleep, Caloric, Weight, Hydration, Logging, Protein, Stress, Training)'
                : '25 Full (5 Baseline + 3 Tier1 + 4 Tier2 + 3 Tier3 + 10 Advanced)'
        });
        console.info('ews / detect üì• received options:', {
            mode: mode,
            includeDetails: options?.includeDetails || false,
            hasCurrentPatterns: !!options?.currentPatterns,
            patternsCount: options?.currentPatterns ? Object.keys(options.currentPatterns).length : 0,
            patternNames: options?.currentPatterns ? Object.keys(options.currentPatterns).slice(0, 5) : []
        });

        if (!Array.isArray(days) || days.length < THRESHOLDS.MIN_DAYS_FOR_ANALYSIS) {
            console.warn('ews / detect ‚ö†Ô∏è input.invalid:', {
                reason: 'insufficient_data',
                daysReceived: days?.length || 0,
                minRequired: THRESHOLDS.MIN_DAYS_FOR_ANALYSIS
            });
            return {
                available: false,
                reason: 'insufficient_data',
                minDaysRequired: THRESHOLDS.MIN_DAYS_FOR_ANALYSIS,
                warnings: [],
                trends: null
            };
        }

        console.info('ews / detect üì• input.valid:', {
            daysCount: days.length,
            profileId: profile?.id,
            hasPIndex: !!pIndex,
            hasPatternSnapshot: !!options.previousPatterns
        });

        const warnings = [];

        console.info('ews / detect üßÆ compute:', { phase: 'running_checks', checksTotal: checksCount, mode: mode });

        // Warning 1: Health Score decline (ACUTE)
        const scoreWarning = checkHealthScoreDecline(days, profile, pIndex, options);
        if (scoreWarning) {
            console.info('ews / detect üßÆ   ‚úÖ check_1:', { name: 'HealthScore', status: 'WARNING' });
            warnings.push(scoreWarning);
        } else {
            console.info('ews / detect üßÆ   ‚ûñ check_1:', { name: 'HealthScore', status: 'clean' });
        }

        // Warning 2: Critical pattern degradation OR low pattern scores (FULL-only)
        if ((mode === 'full') && options.currentPatterns) {
            const patternWarnings = checkCriticalPatternDegradation(
                days,
                profile,
                pIndex,
                options.previousPatterns,  // optional
                options.currentPatterns    // required
            );
            if (patternWarnings) {
                console.info(`ews / detect üßÆ   ‚úÖ check_2:`, { name: 'Patterns', status: 'WARNING', count: patternWarnings.length });
                warnings.push(...patternWarnings);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_2:', { name: 'Patterns', status: 'clean' });
            }
        } else {
            const skipReason = mode === 'acute' ? 'acute_mode' : 'no_currentPatterns';
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_2:', { name: 'Patterns', status: 'skipped', reason: skipReason });
        }

        // Warning 3: Status Score decline (ACUTE)
        const statusWarning = checkStatusScoreDecline(days);
        if (statusWarning) {
            console.info('ews / detect üßÆ   ‚úÖ check_3:', { name: 'Status', status: 'WARNING' });
            warnings.push(statusWarning);
        } else {
            console.info('ews / detect üßÆ   ‚ûñ check_3:', { name: 'Status', status: 'clean' });
        }

        // Warning 4: Sleep debt
        const sleepWarning = checkSleepDebt(days, profile);
        if (sleepWarning) {
            console.info('ews / detect üßÆ   ‚úÖ check_4:', { name: 'Sleep', status: 'WARNING' });
            warnings.push(sleepWarning);
        } else {
            console.info('ews / detect üßÆ   ‚ûñ check_4:', { name: 'Sleep', status: 'clean' });
        }

        // Warning 5: Caloric debt
        const caloricWarning = checkCaloricDebt(days, profile, pIndex);
        if (caloricWarning) {
            console.info('ews / detect üßÆ   ‚úÖ check_5:', { name: 'Caloric', status: 'WARNING' });
            warnings.push(caloricWarning);
        } else {
            console.info('ews / detect üßÆ   ‚ûñ check_5:', { name: 'Caloric', status: 'clean' });
        }

        // === Tier 1 Warnings (v2.0) ===

        // Warning 6: Weight spike
        const weightWarning = checkWeightSpike(days, profile);
        if (weightWarning) {
            console.info('ews / detect üßÆ   ‚úÖ check_6:', { name: 'WeightSpike', status: 'WARNING' });
            warnings.push(weightWarning);
        } else {
            console.info('ews / detect üßÆ   ‚ûñ check_6:', { name: 'WeightSpike', status: 'clean' });
        }

        // Warning 7: Hydration deficit
        const hydrationWarning = checkHydrationDeficit(days, profile);
        if (hydrationWarning) {
            console.info('ews / detect üßÆ   ‚úÖ check_7:', { name: 'Hydration', status: 'WARNING' });
            warnings.push(hydrationWarning);
        } else {
            console.info('ews / detect üßÆ   ‚ûñ check_7:', { name: 'Hydration', status: 'clean' });
        }

        // Warning 8: Logging gap
        const loggingWarning = checkLoggingGap(days, profile);
        if (loggingWarning) {
            console.info('ews / detect üßÆ   ‚úÖ check_8:', { name: 'LoggingGap', status: 'WARNING' });
            warnings.push(loggingWarning);
        } else {
            console.info('ews / detect üßÆ   ‚ûñ check_8:', { name: 'LoggingGap', status: 'clean' });
        }

        // === Tier 2 Warnings (v2.5) ===

        // Warning 9: Protein deficit
        const proteinWarning = checkProteinDeficit(days, profile, pIndex);
        if (proteinWarning) {
            console.info('ews / detect üßÆ   ‚úÖ check_9:', { name: 'ProteinDeficit', status: 'WARNING' });
            warnings.push(proteinWarning);
        } else {
            console.info('ews / detect üßÆ   ‚ûñ check_9:', { name: 'ProteinDeficit', status: 'clean' });
        }

        // Warning 10: Stress accumulation
        const stressWarning = checkStressAccumulation(days, profile);
        if (stressWarning) {
            console.info('ews / detect üßÆ   ‚úÖ check_10:', { name: 'Stress', status: 'WARNING' });
            warnings.push(stressWarning);
        } else {
            console.info('ews / detect üßÆ   ‚ûñ check_10:', { name: 'Stress', status: 'clean' });
        }

        // Warning 11: Meal skip pattern (FULL-only)
        if (mode === 'full') {
            const mealSkipWarning = checkMealSkipPattern(days, profile);
            if (mealSkipWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_11:', { name: 'MealSkip', status: 'WARNING' });
                warnings.push(mealSkipWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_11:', { name: 'MealSkip', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_11:', { name: 'MealSkip', status: 'skipped', reason: 'acute_mode' });
        }

        // Warning 12: Binge risk (FULL-only)
        if (mode === 'full') {
            const bingeWarning = checkBingeRisk(days, profile, pIndex);
            if (bingeWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_12:', { name: 'BingeRisk', status: 'WARNING' });
                warnings.push(bingeWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_12:', { name: 'BingeRisk', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_12:', { name: 'BingeRisk', status: 'skipped', reason: 'acute_mode' });
        }

        // === Tier 3 Warnings (v3.0) ===

        // Warning 13: Mood/wellbeing decline (FULL-only)
        if (mode === 'full') {
            const moodWarning = checkMoodWellbeingDecline(days, profile);
            if (moodWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_13:', { name: 'MoodDecline', status: 'WARNING' });
                warnings.push(moodWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_13:', { name: 'MoodDecline', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_13:', { name: 'MoodDecline', status: 'skipped', reason: 'acute_mode' });
        }

        // Warning 14: Weight plateau (FULL-only)
        if (mode === 'full') {
            const plateauWarning = checkWeightPlateau(days, profile);
            if (plateauWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_14:', { name: 'WeightPlateau', status: 'WARNING' });
                warnings.push(plateauWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_14:', { name: 'WeightPlateau', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_14:', { name: 'WeightPlateau', status: 'skipped', reason: 'acute_mode' });
        }

        // Warning 15: Weekend pattern (FULL-only)
        if (mode === 'full') {
            const weekendWarning = checkWeekendPattern(days, profile, pIndex);
            if (weekendWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_15:', { name: 'WeekendPattern', status: 'WARNING' });
                warnings.push(weekendWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_15:', { name: 'WeekendPattern', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_15:', { name: 'WeekendPattern', status: 'skipped', reason: 'acute_mode' });
        }

        // ========================================
        // Advanced Warnings (v3.2)
        // ========================================

        // Warning 16: Fiber deficit (FULL-only)
        if (mode === 'full') {
            const fiberWarning = checkFiberDeficit(days, profile);
            if (fiberWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_16:', { name: 'FiberDeficit', status: 'WARNING' });
                warnings.push(fiberWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_16:', { name: 'FiberDeficit', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_16:', { name: 'FiberDeficit', status: 'skipped', reason: 'acute_mode' });
        }

        // Warning 17: Sodium excess (FULL-only)
        if (mode === 'full') {
            const sodiumWarning = checkSodiumExcess(days, profile);
            if (sodiumWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_17:', { name: 'SodiumExcess', status: 'WARNING' });
                warnings.push(sodiumWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_17:', { name: 'SodiumExcess', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_17:', { name: 'SodiumExcess', status: 'skipped', reason: 'acute_mode' });
        }

        // Warning 18: Circadian disruption (FULL-only)
        if (mode === 'full') {
            const circadianWarning = checkCircadianDisruption(days, profile);
            if (circadianWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_18:', { name: 'CircadianDisruption', status: 'WARNING' });
                warnings.push(circadianWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_18:', { name: 'CircadianDisruption', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_18:', { name: 'CircadianDisruption', status: 'skipped', reason: 'acute_mode' });
        }

        // Warning 19: Training without recovery
        const trainingRecoveryWarning = checkTrainingWithoutRecovery(days, profile);
        if (trainingRecoveryWarning) {
            console.info('ews / detect üßÆ   ‚úÖ check_19:', { name: 'TrainingWithoutRecovery', status: 'WARNING' });
            warnings.push(trainingRecoveryWarning);
        } else {
            console.info('ews / detect üßÆ   ‚ûñ check_19:', { name: 'TrainingWithoutRecovery', status: 'clean' });
        }

        // Warning 20: Fat quality decline (FULL-only)
        if (mode === 'full') {
            const fatQualityWarning = checkFatQualityDecline(days, profile, pIndex);
            if (fatQualityWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_20:', { name: 'FatQualityDecline', status: 'WARNING' });
                warnings.push(fatQualityWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_20:', { name: 'FatQualityDecline', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_20:', { name: 'FatQualityDecline', status: 'skipped', reason: 'acute_mode' });
        }

        // Warning 21: Sugar dependency (FULL-only)
        if (mode === 'full') {
            const sugarWarning = checkSugarDependency(days, profile);
            if (sugarWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_21:', { name: 'SugarDependency', status: 'WARNING' });
                warnings.push(sugarWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_21:', { name: 'SugarDependency', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_21:', { name: 'SugarDependency', status: 'skipped', reason: 'acute_mode' });
        }

        // Warning 22: Micronutrient gap (FULL-only)
        if (mode === 'full') {
            const microWarning = checkMicronutrientGap(days, profile);
            if (microWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_22:', { name: 'MicronutrientGap', status: 'WARNING' });
                warnings.push(microWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_22:', { name: 'MicronutrientGap', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_22:', { name: 'MicronutrientGap', status: 'skipped', reason: 'acute_mode' });
        }

        // Warning 23: Step decline (FULL-only)
        if (mode === 'full') {
            const stepWarning = checkStepDecline(days, profile);
            if (stepWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_23:', { name: 'StepDecline', status: 'WARNING' });
                warnings.push(stepWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_23:', { name: 'StepDecline', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_23:', { name: 'StepDecline', status: 'skipped', reason: 'acute_mode' });
        }

        // Warning 24: Meal timing drift (FULL-only)
        if (mode === 'full') {
            const mealTimingWarning = checkMealTimingDrift(days, profile);
            if (mealTimingWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_24:', { name: 'MealTimingDrift', status: 'WARNING' });
                warnings.push(mealTimingWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_24:', { name: 'MealTimingDrift', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_24:', { name: 'MealTimingDrift', status: 'skipped', reason: 'acute_mode' });
        }

        // Warning 25: Electrolyte imbalance (FULL-only)
        if (mode === 'full') {
            const electrolyteWarning = checkElectrolyteImbalance(days, profile);
            if (electrolyteWarning) {
                console.info('ews / detect üßÆ   ‚úÖ check_25:', { name: 'ElectrolyteImbalance', status: 'WARNING' });
                warnings.push(electrolyteWarning);
            } else {
                console.info('ews / detect üßÆ   ‚ûñ check_25:', { name: 'ElectrolyteImbalance', status: 'clean' });
            }
        } else {
            console.info('ews / detect üßÆ   ‚è≠Ô∏è check_25:', { name: 'ElectrolyteImbalance', status: 'skipped', reason: 'acute_mode' });
        }

        // Sort by severity
        warnings.sort((a, b) => {
            const severityOrder = { high: 0, medium: 1, low: 2 };
            return severityOrder[a.severity] - severityOrder[b.severity];
        });

        console.info('ews / detect ‚úÖ result:', {
            warningsDetected: warnings.length,
            types: warnings.map(w => w.type),
            severities: warnings.map(w => w.severity),
            highSeverity: warnings.filter(w => w.severity === 'high').length,
            mediumSeverity: warnings.filter(w => w.severity === 'medium').length,
            lowSeverity: warnings.filter(w => w.severity === 'low').length
        });

        // Visual summary table of all 15 checks (v3.0 verification +  pipeline logs v3.1)
        console.group('ews / detect üñ•Ô∏è ui.summary - All 25 Checks');
        const checkMapping = [
            { num: 1, name: 'Health Score Decline', tier: 'Baseline', types: ['HEALTH_SCORE_DECLINE'] },
            { num: 2, name: 'Pattern Issues', tier: 'Baseline', types: ['CRITICAL_PATTERN_DEGRADATION', 'LOW_PATTERN_SCORE'] },
            { num: 3, name: 'Status Score Decline', tier: 'Baseline', types: ['STATUS_SCORE_DECLINE'] },
            { num: 4, name: 'Sleep Debt', tier: 'Baseline', types: ['SLEEP_DEBT'] },
            { num: 5, name: 'Caloric Debt', tier: 'Baseline', types: ['CALORIC_DEBT'] },
            { num: 6, name: 'Weight Spike', tier: 'Tier 1', types: ['WEIGHT_SPIKE'] },
            { num: 7, name: 'Hydration Deficit', tier: 'Tier 1', types: ['HYDRATION_DEFICIT'] },
            { num: 8, name: 'Logging Gap', tier: 'Tier 1', types: ['LOGGING_GAP'] },
            { num: 9, name: 'Protein Deficit', tier: 'Tier 2', types: ['PROTEIN_DEFICIT'] },
            { num: 10, name: 'Stress Accumulation', tier: 'Tier 2', types: ['STRESS_ACCUMULATION'] },
            { num: 11, name: 'Meal Skip Pattern', tier: 'Tier 2', types: ['MEAL_SKIP_PATTERN'] },
            { num: 12, name: 'Binge Risk', tier: 'Tier 2', types: ['BINGE_RISK'] },
            { num: 13, name: 'Mood/Wellbeing Decline', tier: 'Tier 3', types: ['MOOD_WELLBEING_DECLINE'] },
            { num: 14, name: 'Weight Plateau', tier: 'Tier 3', types: ['WEIGHT_PLATEAU'] },
            { num: 15, name: 'Weekend Pattern', tier: 'Tier 3', types: ['WEEKEND_PATTERN'] },
            { num: 16, name: 'Fiber Deficit', tier: 'Advanced', types: ['FIBER_DEFICIT'] },
            { num: 17, name: 'Sodium Excess', tier: 'Advanced', types: ['SODIUM_EXCESS'] },
            { num: 18, name: 'Circadian Disruption', tier: 'Advanced', types: ['CIRCADIAN_DISRUPTION'] },
            { num: 19, name: 'Training w/o Recovery', tier: 'Advanced', types: ['TRAINING_WITHOUT_RECOVERY'] },
            { num: 20, name: 'Fat Quality Decline', tier: 'Advanced', types: ['FAT_QUALITY_DECLINE'] },
            { num: 21, name: 'Sugar Dependency', tier: 'Advanced', types: ['SUGAR_DEPENDENCY'] },
            { num: 22, name: 'Micronutrient Gap', tier: 'Advanced', types: ['MICRONUTRIENT_GAP'] },
            { num: 23, name: 'Step Decline', tier: 'Advanced', types: ['STEP_DECLINE'] },
            { num: 24, name: 'Meal Timing Drift', tier: 'Advanced', types: ['MEAL_TIMING_DRIFT'] },
            { num: 25, name: 'Electrolyte Imbalance', tier: 'Advanced', types: ['ELECTROLYTE_IMBALANCE'] }
        ];
        const warningTypes = new Set(warnings.map(function (w) { return w.type; }));
        const checkSummary = checkMapping.map(function (check) {
            var hasWarning = check.types.some(function (t) { return warningTypes.has(t); });
            return {
                '#': check.num,
                'Check Name': check.name,
                'Tier': check.tier,
                'Status': hasWarning ? '‚ö†Ô∏è WARNING' : '‚úì Clean'
            };
        });
        console.table(checkSummary);
        console.info('ews / detect üñ•Ô∏è ui.legend:', 'Baseline(5) + Tier1(3) + Tier2(4) + Tier3(3) + Advanced(10) = 25 checks total');
        console.groupEnd();
        console.info('ews / detect üñ•Ô∏è ui.complete:', { warningsDisplayed: warnings.length, checksTotal: 25 });

        // Track warning trends (v3.1)
        const trendsResult = trackWarningTrends(warnings);

        // Prioritize warnings by severity √ó frequency √ó health impact (v3.1)
        const prioritizedWarnings = prioritizeWarnings(warnings, trendsResult.allTrends);

        // Calculate EWS Global Score (v4.0)
        const globalScoreResult = calculateEwsGlobalScore(prioritizedWarnings, trendsResult);

        console.info('ews / global_score üñ•Ô∏è ui', {
            score: globalScoreResult.score,
            interpretation: globalScoreResult.score >= 70 ? 'HIGH_RISK'
                : globalScoreResult.score >= 40 ? 'MEDIUM_RISK'
                    : globalScoreResult.score >= 20 ? 'LOW_RISK'
                        : 'MINIMAL_RISK'
        });

        // Calculate Weekly Progress Tracking (v4.1, Wave 3.1 + cloud sync)
        // Fire-and-forget: weekly progress runs in background (detect() must stay sync for callers)
        const weeklyProgressDefault = { weeks: [], trend: 'stable', currentWeek: null };
        calculateWeeklyProgress(prioritizedWarnings, globalScoreResult.score)
            .then(result => {
                console.info('ews / weekly ‚úÖ Background weekly progress computed:', {
                    weeks: result.weeks?.length || 0,
                    trend: result.trend
                });
            })
            .catch(err => {
                console.warn('ews / weekly ‚ö†Ô∏è Background weekly progress failed:', err?.message);
            });

        // Detect Causal Chains (v4.0)
        let causalChainsResult = [];
        if (typeof HEYS.InsightsPI?.causalChains?.detect === 'function') {
            causalChainsResult = HEYS.InsightsPI.causalChains.detect({
                warnings: prioritizedWarnings,
                patterns: options.currentPatterns || {},
                trends: trendsResult
            });

            console.info('ews / causal_chain üñ•Ô∏è ui', {
                chainsDetected: causalChainsResult.length,
                topChains: causalChainsResult.slice(0, 3).map(c => ({
                    id: c.chainId,
                    confidence: c.adjustedConfidence,
                    coverage: c.matchRatio + '%'
                }))
            });
        } else {
            console.info('ews / causal_chain ‚ö†Ô∏è skipped', { reason: 'module_not_loaded' });
        }

        return {
            available: true,
            count: warnings.length,
            warnings: prioritizedWarnings, // Prioritized warnings with scores
            summary: warnings.length === 0
                ? '‚úÖ –ù–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–Ω–¥–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ'
                : `‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${warnings.length} warning signal${warnings.length > 1 ? 's' : ''}`,
            highSeverityCount: warnings.filter(w => w.severity === 'high').length,
            mediumSeverityCount: warnings.filter(w => w.severity === 'medium').length,
            // Trends tracking (v3.1)
            trends: {
                chronicWarnings: trendsResult.chronicWarnings,
                allTrends: trendsResult.allTrends
            },
            // Priority queue (v3.1)
            criticalPriority: prioritizedWarnings.filter(w => w.criticalPriority),
            // Global Score (v4.0)
            globalScore: globalScoreResult.score,
            globalScoreBreakdown: globalScoreResult.breakdown,
            // Causal Chains (v4.0)
            causalChains: causalChainsResult,
            // Weekly Progress (v4.1, Wave 3.1)
            weeklyProgress: weeklyProgressDefault
        };
    }



    // Export API
    HEYS.InsightsPI.earlyWarning = {
        detect: detectEarlyWarnings,
        trackTrends: trackWarningTrends,
        prioritize: prioritizeWarnings,
        calculateGlobalScore: calculateEwsGlobalScore,
        calculateWeeklyProgress: calculateWeeklyProgress,
        backfillWeeklySnapshots: backfillWeeklySnapshots,
        thresholds: THRESHOLDS,
        healthImpact: HEALTH_IMPACT_SCORES,
        version: '4.2.0'
    };

    console.log('[HEYS.InsightsPI] ‚úÖ Early Warning System v4.2 loaded (25 checks + trends + priority + global score + weekly progress + cloud sync)');
    console.info('[HEYS.InsightsPI.earlyWarning] üéØ Module ready:', {
        detect: typeof HEYS.InsightsPI.earlyWarning.detect,
        trackTrends: typeof HEYS.InsightsPI.earlyWarning.trackTrends,
        calculateWeeklyProgress: typeof HEYS.InsightsPI.earlyWarning.calculateWeeklyProgress,
        backfillWeeklySnapshots: typeof HEYS.InsightsPI.earlyWarning.backfillWeeklySnapshots,
        version: HEYS.InsightsPI.earlyWarning.version,
        checks: 25,
        cloudSyncEnabled: CLOUD_SYNC_CONFIG.ENABLED
    });

    // === PHENOTYPE QUICK HELPERS (console API) ===
    if (HEYS.InsightsPI.phenotype && !HEYS.InsightsPI.phenotype.set) {
        const PRESETS = {
            IR_EVENING: { metabolic: 'insulin_resistant', circadian: 'evening_type', satiety: 'low_satiety', stress: 'stress_eater' },
            IR_MORNING: { metabolic: 'insulin_resistant', circadian: 'morning_type', satiety: 'high_satiety', stress: 'neutral' },
            METABOLIC_SYNDROME: { metabolic: 'metabolic_syndrome_risk', circadian: 'evening_type', satiety: 'volume_eater', stress: 'stress_eater' },
            OPTIMAL: { metabolic: 'insulin_sensitive', circadian: 'flexible', satiety: 'normal', stress: 'neutral' }
        };

        HEYS.InsightsPI.phenotype.set = function (metabolic, circadian, satiety, stress) {
            const utils = window.HEYS?.utils;
            if (!utils || !utils.lsGet || !utils.lsSet) {
                console.error('‚ùå HEYS.utils not available');
                return false;
            }
            const profile = utils.lsGet('heys_profile', {});
            if (!profile || Object.keys(profile).length === 0) {
                console.error('‚ùå Profile not found');
                return false;
            }
            profile.phenotype = { metabolic, circadian, satiety, stress };
            utils.lsSet('heys_profile', profile);
            console.info('‚úÖ Phenotype set:', profile.phenotype);
            console.info('üîÑ Refresh page or re-run EWS detect() to apply');
            return true;
        };

        HEYS.InsightsPI.phenotype.setPreset = function (presetName) {
            const preset = PRESETS[presetName];
            if (!preset) {
                console.error('‚ùå Unknown preset. Available:', Object.keys(PRESETS));
                return false;
            }
            return HEYS.InsightsPI.phenotype.set(preset.metabolic, preset.circadian, preset.satiety, preset.stress);
        };

        HEYS.InsightsPI.phenotype.clear = function () {
            const utils = window.HEYS?.utils;
            if (!utils || !utils.lsGet || !utils.lsSet) return false;
            const profile = utils.lsGet('heys_profile', {});
            if (!profile) return false;
            delete profile.phenotype;
            utils.lsSet('heys_profile', profile);
            console.info('‚úÖ Phenotype cleared (defaults restored)');
            return true;
        };

        HEYS.InsightsPI.phenotype.status = function () {
            const utils = window.HEYS?.utils;
            if (!utils || !utils.lsGet) return null;
            const profile = utils.lsGet('heys_profile', {});
            if (!profile || !profile.phenotype) {
                console.info('‚ö†Ô∏è No phenotype set (using defaults)');
                return null;
            }
            console.info('üß¨ Current phenotype:', profile.phenotype);
            return profile.phenotype;
        };

        console.info('[HEYS.InsightsPI.phenotype] üõ†Ô∏è Quick API loaded:');
        console.info('  ‚Ä¢ HEYS.InsightsPI.phenotype.set(metabolic, circadian, satiety, stress)');
        console.info('  ‚Ä¢ HEYS.InsightsPI.phenotype.setPreset("IR_EVENING" | "IR_MORNING" | "METABOLIC_SYNDROME" | "OPTIMAL")');
        console.info('  ‚Ä¢ HEYS.InsightsPI.phenotype.clear()');
        console.info('  ‚Ä¢ HEYS.InsightsPI.phenotype.status()');
    }

    // Dispatch event for components waiting for EWS module
    if (typeof window !== 'undefined') {
        window.dispatchEvent(new CustomEvent('heys-ews-ready', {
            detail: { version: '4.2.0', timestamp: Date.now() }
        }));
        console.info('[HEYS.InsightsPI.earlyWarning] üì° Dispatched heys-ews-ready event');
        // Note: Phenotype status auto-displays on first detect() via getEwsThreshold() smart logging
    }

})(typeof window !== 'undefined' ? window : global);
