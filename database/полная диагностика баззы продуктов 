// === –ü–û–õ–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê LOCALSTORAGE ===
(function() {
  const MY_CLIENT = 'ccfe6ea3-54d9-4c83-902b-f10e6e8e6d9a';
  const allKeys = Object.keys(localStorage);
  const heysKeys = allKeys.filter(k => k.startsWith('heys_'));
  
  console.log('='.repeat(60));
  console.log('üìä –ü–û–õ–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê HEYS LOCALSTORAGE');
  console.log('='.repeat(60));
  console.log('–í—Å–µ–≥–æ –∫–ª—é—á–µ–π:', allKeys.length);
  console.log('HEYS –∫–ª—é—á–µ–π:', heysKeys.length);
  console.log('');
  
  // 1. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏
  const globalKeys = ['heys_client_current', 'heys_clients', 'heys_products', 'heys_theme'];
  console.log('üåç –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ö–õ–Æ–ß–ò:');
  globalKeys.forEach(k => {
    const val = localStorage.getItem(k);
    if (val) {
      const preview = val.substring(0, 50);
      const isCorrupted = preview.includes('¬§');
      console.log(`  ${k}: ${isCorrupted ? '‚ùå –ü–û–í–†–ï–ñ–î–Å–ù' : '‚úÖ'} (${val.length} bytes)`);
    } else {
      console.log(`  ${k}: ‚ö™ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç`);
    }
  });
  console.log('');
  
  // 2. –ö–ª—é—á–∏ —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
  const myKeys = heysKeys.filter(k => k.includes(MY_CLIENT));
  console.log(`üë§ –ú–û–ò –ö–õ–Æ–ß–ò (${MY_CLIENT.substring(0,8)}...): ${myKeys.length}`);
  
  const myKeyTypes = {};
  myKeys.forEach(k => {
    const type = k.replace(`heys_${MY_CLIENT}_`, '').replace(/dayv2_\d{4}-\d{2}-\d{2}/, 'dayv2_*');
    myKeyTypes[type] = (myKeyTypes[type] || 0) + 1;
  });
  Object.entries(myKeyTypes).sort((a,b) => b[1] - a[1]).forEach(([type, count]) => {
    console.log(`  ${type}: ${count}`);
  });
  console.log('');
  
  // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
  console.log('üì¶ –ü–†–û–í–ï–†–ö–ê –ü–†–û–î–£–ö–¢–û–í:');
  const productKeys = heysKeys.filter(k => k.includes('product'));
  productKeys.forEach(k => {
    try {
      const data = JSON.parse(localStorage.getItem(k));
      const count = Array.isArray(data) ? data.length : 'not array';
      const isMine = k.includes(MY_CLIENT);
      console.log(`  ${isMine ? '‚úÖ' : '‚ö†Ô∏è –ß–£–ñ–û–ô'} ${k.substring(0, 50)}: ${count} items`);
    } catch(e) {
      console.log(`  ‚ùå ${k.substring(0, 50)}: PARSE ERROR`);
    }
  });
  console.log('');
  
  // 4. –ß—É–∂–∏–µ –∫–ª—é—á–∏ (—Å UUID –Ω–æ –Ω–µ –º–æ–π)
  const uuidPattern = /[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi;
  const foreignKeys = heysKeys.filter(k => {
    if (globalKeys.includes(k)) return false;
    const matches = k.match(uuidPattern);
    if (!matches) return false;
    return !matches.some(id => id.toLowerCase() === MY_CLIENT.toLowerCase());
  });
  
  console.log(`üö® –ß–£–ñ–ò–ï –ö–õ–Æ–ß–ò: ${foreignKeys.length}`);
  if (foreignKeys.length > 0) {
    foreignKeys.slice(0, 10).forEach(k => console.log(`  ‚ö†Ô∏è ${k.substring(0, 60)}`));
    if (foreignKeys.length > 10) console.log(`  ... –∏ –µ—â—ë ${foreignKeys.length - 10}`);
  } else {
    console.log('  ‚úÖ –ß—É–∂–∏—Ö –∫–ª—é—á–µ–π –Ω–µ—Ç!');
  }
  console.log('');
  
  // 5. –î–≤–æ–π–Ω—ã–µ clientId
  const doubleKeys = heysKeys.filter(k => {
    const matches = k.match(uuidPattern);
    return matches && matches.length >= 2;
  });
  console.log(`üîÑ –î–í–û–ô–ù–´–ï CLIENT_ID: ${doubleKeys.length}`);
  if (doubleKeys.length > 0) {
    doubleKeys.slice(0, 5).forEach(k => console.log(`  ‚ö†Ô∏è ${k.substring(0, 70)}`));
  } else {
    console.log('  ‚úÖ –î–≤–æ–π–Ω—ã—Ö –∫–ª—é—á–µ–π –Ω–µ—Ç!');
  }
  console.log('');
  
  // 6. –ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  console.log('üíî –ü–û–í–†–ï–ñ–î–Å–ù–ù–´–ï –î–ê–ù–ù–´–ï:');
  let corruptedCount = 0;
  heysKeys.forEach(k => {
    const val = localStorage.getItem(k);
    if (val && val.includes('¬§')) {
      console.log(`  ‚ùå ${k.substring(0, 50)}`);
      corruptedCount++;
    }
  });
  if (corruptedCount === 0) {
    console.log('  ‚úÖ –ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç!');
  }
  console.log('');
  
  // 7. –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
  let totalSize = 0;
  heysKeys.forEach(k => totalSize += (localStorage.getItem(k) || '').length);
  console.log(`üíæ –†–ê–ó–ú–ï–†: ${(totalSize / 1024).toFixed(1)} KB`);
  
  // 8. –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
  console.log('');
  console.log('='.repeat(60));
  const issues = foreignKeys.length + doubleKeys.length + corruptedCount;
  if (issues === 0) {
    console.log('‚úÖ –í–°–Å –ß–ò–°–¢–û! –ü—Ä–æ–±–ª–µ–º –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ.');
  } else {
    console.log(`‚ö†Ô∏è –ù–ê–ô–î–ï–ù–û –ü–†–û–ë–õ–ï–ú: ${issues}`);
    console.log('   –ß—É–∂–∏—Ö:', foreignKeys.length);
    console.log('   –î–≤–æ–π–Ω—ã—Ö:', doubleKeys.length);
    console.log('   –ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã—Ö:', corruptedCount);
  }
  console.log('='.repeat(60));
  
  return { foreignKeys, doubleKeys, corruptedCount, myKeys: myKeys.length };
})();