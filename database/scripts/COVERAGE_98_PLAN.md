# Product Coverage 98% ‚Äî –†–∞–±–æ—á–∏–π –ü–ª–∞–Ω

## üéØ –¶–µ–ª—å

–ó–∞–ø–æ–ª–Ω–∏—Ç—å **–≤—Å–µ 35 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** –¥–ª—è –≤—Å–µ—Ö 288 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤
`shared_products` –¥–æ —É—Ä–æ–≤–Ω—è **‚â•98% coverage**.

## üìä –°—Ç–∞—Ç—É—Å (2026-02-11)

- **–¢–µ–∫—É—â–∏–π coverage**: ~14% (–º–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç—ã), 99% (–º–∞–∫—Ä–æ/sodium/NOVA)
- **–¶–µ–ª–µ–≤–æ–π coverage**: 98% (282/288 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å 34/35 –ø–æ–ª—è–º–∏)
- **–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: 30-48 —á–∞—Å–æ–≤ —á–∏—Å—Ç–æ–π —Ä–∞–±–æ—Ç—ã (6 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π)
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**: USDA FoodData Central API
- **–ú–µ—Ç–æ–¥**: SQL UPDATE –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î

---

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1. SQL —Å–∫—Ä–∏–ø—Ç—ã

- **`database/scripts/coverage_check_98.sql`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è –ø–æ
  –ø–æ–ª—è–º –∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º
- **`database/scripts/product_update_template.sql`** ‚Äî —à–∞–±–ª–æ–Ω UPDATE –¥–ª—è —Ä—É—á–Ω–æ–≥–æ
  –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è

### 2. Python —Å–∫—Ä–∏–ø—Ç

- **`database/scripts/usda_enrichment.py`** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å USDA API + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
  SQL
  - Interactive mode: –ø–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–∞ ‚Üí –≤—ã–±–æ—Ä ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SQL
  - Batch mode: –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ JSON

### 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- **Host**: (–∏–∑ .env yandex-cloud-functions)
- **Database**: heys_db
- **Password**: heys007670
- **Connection**: —á–µ—Ä–µ–∑ psql –∏–ª–∏ DBeaver

---

## üìã –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### –î–µ–Ω—å 1 ‚Äî –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø–∏–ª–æ—Ç (40 –ø—Ä–æ–¥—É–∫—Ç–æ–≤)

**–®–∞–≥ 1.1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ coverage**

```bash
psql -h <host> -U <user> -d heys_db -f database/scripts/coverage_check_98.sql
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: —Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π —Å lowest coverage + —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å lowest
completeness.

**–®–∞–≥ 1.2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ USDA API**

1. –ü–æ–ª—É—á–∏—Ç—å API key: https://fdc.nal.usda.gov/api-key-signup.html
2. –ó–∞–º–µ–Ω–∏—Ç—å `DEMO_KEY` –≤ `usda_enrichment.py`

**–®–∞–≥ 1.3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∏–ª–æ—Ç–Ω–æ–π –ø–∞—Ä—Ç–∏–∏ (40 –ø—Ä–æ–¥—É–∫—Ç–æ–≤)**

- –í—ã–±—Ä–∞—Ç—å 40 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å lowest completeness
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ:
  1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `python3 database/scripts/usda_enrichment.py`
  2. –í–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, "chicken breast raw")
  3. –í—ã–±—Ä–∞—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ USDA
  4. –í–≤–µ—Å—Ç–∏ ID –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–∑ HEYS –ë–î
  5. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SQL
  6. –í—ã–ø–æ–ª–Ω–∏—Ç—å UPDATE –≤ –ë–î
  7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ SELECT

**–í—Ä–µ–º—è**: ~6-8 —á–∞—Å–æ–≤ (10-12 –º–∏–Ω—É—Ç –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç).

**QA**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å 10% —Å–ª—É—á–∞–π–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (4 —à—Ç):

- –ó–Ω–∞—á–µ–Ω–∏—è –≤ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö?
- Omega-3 —É —Ä—ã–±—ã > 0?
- Sodium —É —Å–æ–ª—ë–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ > 100?

---

### –î–µ–Ω—å 2-5 ‚Äî –û—Å–Ω–æ–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (200 –ø—Ä–æ–¥—É–∫—Ç–æ–≤)

**–®–∞–≥ 2.1: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–ø–æ 50 –≤ –¥–µ–Ω—å)**

- –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏–∑ –î–Ω—è 1.3 –¥–ª—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- –§–æ–∫—É—Å –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–∞—Ö (—Ç–æ–ø –ø–æ usage stats)

**–®–∞–≥ 2.2: –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ coverage**

```bash
psql -h <host> -U <user> -d heys_db -f database/scripts/coverage_check_98.sql
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:

- –ö–∞–∂–¥–æ–µ –ø–æ–ª–µ >= 80% coverage –∫ –î–Ω—é 4
- –°–ª–æ–∂–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã (–≥–æ—Ç–æ–≤—ã–µ –±–ª—é–¥–∞, —Å–æ—Å—Ç–∞–≤–Ω—ã–µ) –ø–æ–º–µ—á–∞—Ç—å –¥–ª—è —Ä—É—á–Ω–æ–π –¥–æ–∫—Ä—É—Ç–∫–∏

**–í—Ä–µ–º—è**: ~40 —á–∞—Å–æ–≤ (4 –¥–Ω—è √ó 10 —á–∞—Å–æ–≤).

---

### –î–µ–Ω—å 6 ‚Äî –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ QA (48 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ + –ø—Ä–æ–≤–µ—Ä–∫–∞)

**–®–∞–≥ 6.1: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤**

- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 48 –ø—Ä–æ–¥—É–∫—Ç–æ–≤
- –§–æ–∫—É—Å –Ω–∞ "—Ç—Ä—É–¥–Ω—ã—Ö" –ø—Ä–æ–¥—É–∫—Ç–∞—Ö (–Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –≤ USDA)

**–®–∞–≥ 6.2: –§–∏–Ω–∞–ª—å–Ω–∞—è QA –ø—Ä–æ–≤–µ—Ä–∫–∞**

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å coverage check:
   ```bash
   psql -h <host> -U <user> -d heys_db -f database/scripts/coverage_check_98.sql
   ```
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ overall_coverage_pct >= 98%
3. Random sampling: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å 10% –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (28 —à—Ç) –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å

**–®–∞–≥ 6.3: –§–∏–∫—Å–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**

- –≠–∫—Å–ø–æ—Ä—Ç coverage report –≤ CSV
- Commit –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î
- Backup —Ç–∞–±–ª–∏—Ü—ã `shared_products` –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

**–í—Ä–µ–º—è**: ~6-8 —á–∞—Å–æ–≤.

---

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ USDA

**–†–µ—à–µ–Ω–∏–µ**:

1. –ò—Å–∫–∞—Ç—å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ (–Ω–µ —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è)
2. –ò—Å–∫–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç ("buckwheat" –≤–º–µ—Å—Ç–æ "buckwheat porridge")
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–æ–≥ (–µ—Å–ª–∏ –Ω–µ—Ç "—Ç–≤–æ—Ä–æ–≥" ‚Üí –∏—Å–∫–∞—Ç—å "cottage cheese")
4. –ü–æ—Å–ª–µ–¥–Ω–∏–π resort: manual estimation –∏–∑ –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–Ω–∞—á–µ–Ω–∏—è —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–µ (>300% DV)

**–†–µ—à–µ–Ω–∏–µ**:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å unit conversion (mg vs g)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –ø—Ä–æ–¥—É–∫—Ç–∞ (raw vs cooked)
3. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Ä—É—á–Ω—É—é –ø–æ USDA —Ç–∞–±–ª–∏—Ü–µ

### –ü—Ä–æ–±–ª–µ–º–∞: Omega-3/6 = 0 —É –∂–∏—Ä–Ω–æ–π —Ä—ã–±—ã

**–†–µ—à–µ–Ω–∏–µ**:

- USDA –∏–Ω–æ–≥–¥–∞ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç EPA/DHA –≤ –±–∞–∑–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å
- –ò—Å–∫–∞—Ç—å "with fatty acids" –≤–µ—Ä—Å–∏—é –≤ USDA
- –ò–ª–∏ –±—Ä–∞—Ç—å –∏–∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (NIH databases)

### –ü—Ä–æ–±–ª–µ–º–∞: –ì–æ—Ç–æ–≤—ã–µ/—Å–æ—Å—Ç–∞–≤–Ω—ã–µ –±–ª—é–¥–∞

**–†–µ—à–µ–Ω–∏–µ**:

- –†–∞—Å—á—ë—Ç –ø–æ —Ä–µ—Ü–µ–ø—Ç—É—Ä–µ (weighted average –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤)
- –ò–ª–∏ –∏—Å–∫–∞—Ç—å –≤ USDA "branded foods" (–µ—Å–ª–∏ –µ—Å—Ç—å –±—Ä–µ–Ω–¥)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å generic "mixed dish" –ø—Ä–æ—Ñ–∏–ª—å

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

1. **Overall coverage**: ‚â•98% –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–º–µ—é—Ç ‚â•34/35 –ø–æ–ª–µ–π –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏
2. **Field coverage**: –∫–∞–∂–¥–æ–µ –∫—Ä–∏—Ç–∏—á–Ω–æ–µ –ø–æ–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —É ‚â•95% –ø—Ä–æ–¥—É–∫—Ç–æ–≤
3. **QA passed**: random 10% sample –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω (–±–µ–∑ –≤—ã–±—Ä–æ—Å–æ–≤/–æ—à–∏–±–æ–∫)
4. **Source documented**: –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ USDA –∏–ª–∏ —è–≤–Ω–æ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ estimated

---

## üì¶ Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å —É—Å–∫–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å:

**–®–∞–≥ 1**: –°–æ–∑–¥–∞—Ç—å JSON —Ñ–∞–π–ª —Å–æ —Å–ø–∏—Å–∫–æ–º –ø—Ä–æ–¥—É–∫—Ç–æ–≤

```json
[
  {
    "id": "f47ac10b-58cc-4372-a567-0e02b2c3d479",
    "name": "–ö—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞",
    "usda_query": "chicken breast raw"
  },
  {
    "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "name": "–ì—Ä–µ—á–∫–∞",
    "usda_query": "buckwheat groats"
  }
]
```

**–®–∞–≥ 2**: –ó–∞–ø—É—Å—Ç–∏—Ç—å batch mode

```bash
python3 database/scripts/usda_enrichment.py products_list.json
```

**–®–∞–≥ 3**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `batch_update_products.sql` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤
–ë–î.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 50-100 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∑–∞ —á–∞—Å (vs 5-6 –≤ —á–∞—Å –≤—Ä—É—á–Ω—É—é).

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**: —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ JSON —Å–ø–∏—Å–∫–∞ + –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞
–ø–æ—Å–ª–µ.

---

## üéØ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**–ö–∞–∫ —Ç–æ–ª—å–∫–æ coverage 98% –¥–æ—Å—Ç–∏–≥–Ω—É—Ç:**

1. –û–±–Ω–æ–≤–∏—Ç—å `pi_calculations.js` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∞–≥—Ä–µ–≥–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ `dayTot`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã C10/C11/C12 (Tier 1)
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å C7/C9 —Å –º–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–∞–º–∏ (Tier 2)
4. –§–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è UI (radar charts, zone bars, body timeline)
