# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–¥–∏–Ω ngrok, –æ–¥–∏–Ω –¥–æ–º–µ–Ω —á–µ—Ä–µ–∑ Vite proxy

## üéØ –ß—Ç–æ –±—ã–ª–æ –Ω–µ —Ç–∞–∫

### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑:

‚ùå "Vite proxy –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ ngrok"

### –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:

‚ùå –ö–æ–¥ –æ–±—Ä–∞—â–∞–ª—Å—è –∫ `localhost:4001` –∏–ª–∏ –∞–±—Å–æ–ª—é—Ç–Ω–æ–º—É URL –≤–º–µ—Å—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö
–ø—É—Ç–µ–π

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
Telegram WebView
    ‚Üì
https://tressy-cotyledonoid-vergie.ngrok-free.dev
    ‚Üì fetch('/api/...')
Ngrok —Ç—É–Ω–Ω–µ–ª—å
    ‚Üì
localhost:3002 (Vite dev server)
    ‚Üì Vite proxy: /api ‚Üí localhost:4001
localhost:4001 (API server)
```

### –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

1. **–û–¥–∏–Ω –¥–æ–º–µ–Ω** ‚Äî –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–∞ `tressy-...ngrok-free.dev`
2. **–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏** ‚Äî `fetch('/api/...')` –≤–º–µ—Å—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö URL
3. **Vite proxy —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚Äî –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç `/api` –Ω–∞ `localhost:4001`
4. **CORS –Ω–µ –Ω—É–∂–µ–Ω** ‚Äî origin –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ
5. **–û–¥–∏–Ω ngrok** ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ—Ä—Ç 3002

---

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### apps/tg-mini/.env.telegram:

```env
# –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ = –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏
VITE_API_URL=
VITE_USE_CLIENT_MOCKS=false
```

### apps/tg-mini/vite.config.ts:

```typescript
server: {
  port: 3002,
  proxy: {
    '/api': {
      target: 'http://localhost:4001',
      changeOrigin: true,
      secure: false,
    }
  }
}
```

### apps/tg-mini/src/api/httpClient.ts:

```typescript
const API_BASE_URL = (import.meta.env.VITE_API_URL ?? '').replace(/\/$/, '');

// –ö–æ–≥–¥–∞ VITE_API_URL –ø—É—Å—Ç–∞—è:
// fetch('/api/...') ‚Üí –∏–¥—ë—Ç –Ω–∞ —Ç–æ—Ç –∂–µ –¥–æ–º–µ–Ω ‚Üí Vite proxy
```

---

## üöÄ –ó–∞–ø—É—Å–∫

```bash
./start-tg-mini-debug.sh
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è API –Ω–∞ `localhost:4001` (–ë–ï–ó CORS)
2. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Vite –Ω–∞ `localhost:3002` —Å proxy
3. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ngrok –¢–û–õ–¨–ö–û –Ω–∞ `3002`
4. ‚úÖ Telegram –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É –¥–æ–º–µ–Ω—É

---

## üêõ –û—Ç–ª–∞–¥–∫–∞ —á–µ—Ä–µ–∑ Debug Console

–û—Ç–∫—Ä–æ–π Telegram ‚Üí @heys_curator_bot ‚Üí —Ç–∞–ø–Ω–∏ üêõ

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–æ–≥–∏:**

```
üîµ INFO | HTTP Request
url: /api/telegram/auth/verify  ‚úÖ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å!)
method: POST

‚úÖ SUCCESS | HTTP 200
status: 200
```

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–æ–≥–∏ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–Ω–æ):**

```
‚ùå ERROR | HTTP Error
url: http://localhost:4001/api/...  ‚ùå (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å!)
error: Failed to fetch
```

---

## üîß –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### TELEGRAM_BOT_TOKEN:

–í —Å–∫—Ä–∏–ø—Ç–µ `start-tg-mini-debug.sh` —Ç–æ–∫–µ–Ω –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ placeholder:

```bash
TELEGRAM_BOT_TOKEN="YOUR_TOKEN_REVOKED"
```

**–°–æ–∑–¥–∞–π `.env.development.local`:**

```env
TELEGRAM_BOT_TOKEN=—Ç–≤–æ–π_—Ä–µ–∞–ª—å–Ω—ã–π_—Ç–æ–∫–µ–Ω
TELEGRAM_ALLOWED_USER_IDS=1393964759
```

**–û–±–Ω–æ–≤–∏ —Å–∫—Ä–∏–ø—Ç:**

```bash
# –ó–∞–≥—Ä—É–∂–∞–µ–º env –∏–∑ —Ñ–∞–π–ª–∞
if [ -f .env.development.local ]; then
  export $(cat .env.development.local | xargs)
fi

# –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
node packages/core/src/server.js ...
```

---

## üìö –ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–µ

| –ö—Ä–∏—Ç–µ—Ä–∏–π              | –î–≤–∞ ngrok                | –û–¥–∏–Ω ngrok       |
| --------------------- | ------------------------ | ---------------- |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤  | 4                        | 3                |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏   | –í—ã—Å–æ–∫–∞—è                  | –ù–∏–∑–∫–∞—è           |
| CORS                  | –ù—É–∂–µ–Ω                    | –ù–µ –Ω—É–∂–µ–Ω         |
| –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å URL      | –ú–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ | –°—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ–º–µ–Ω |
| –ë–ª–∏–∑–æ—Å—Ç—å –∫ production | –ù–µ—Ç                      | –î–∞               |

---

## ‚úÖ –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**

- ‚úÖ –û–¥–∏–Ω ngrok –Ω–∞ –ø–æ—Ä—Ç 3002
- ‚úÖ Vite proxy —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- ‚úÖ –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ `/api/...`
- ‚úÖ CORS –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–°–ø–∞—Å–∏–±–æ –∑–∞ –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –æ—à–∏–±–∫–∏! üôè**
