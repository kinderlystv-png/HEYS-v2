# ‚úÖ –†–ï–®–ï–ù–ò–ï: –ü—Ä–æ–±–ª–µ–º–∞ "Failed to fetch" –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ù–∞–π–¥–µ–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏

- **–ü—Ä–æ–±–ª–µ–º–∞:** API —Å–µ—Ä–≤–µ—Ä –Ω–µ –±—ã–ª –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 4001
- **–°–∏–º–ø—Ç–æ–º:** "Failed to fetch" –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 2. –î–æ–±–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç `dev:api` –≤ package.json

```json
"dev:api": "cross-env PORT=4001 API_PORT=4001 NODE_ENV=development ... node packages/core/src/server.js"
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç `start-tg-mini-debug.sh`

- –£–≤–µ–ª–∏—á–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è: 3 ‚Üí 5 —Å–µ–∫—É–Ω–¥
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ `node` –≤–º–µ—Å—Ç–æ `pnpm run`

### 4. –°–æ–∑–¥–∞–Ω–∞ Debug Console –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

- **–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
  - `src/utils/debugLogger.ts` ‚Äî –ª–æ–≥–∏–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  - `src/components/DebugPanel.tsx` ‚Äî UI –∫–æ–Ω—Å–æ–ª—å
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `App.tsx` –∏ `httpClient.ts`

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å (3 —Å–ø–æ—Å–æ–±–∞)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
./start-tg-mini-debug.sh
```

**–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**

- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç API —Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 4001)
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç mini-app dev server (–ø–æ—Ä—Ç 3002)
- ‚úÖ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç ngrok
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π URL –¥–ª—è Telegram

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ pnpm (2 —Ç–µ—Ä–º–∏–Ω–∞–ª–∞)

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1
pnpm run dev:api

# –¢–µ—Ä–º–∏–Ω–∞–ª 2
pnpm run dev:tg-mini
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ tasks.json –≤ VS Code

- Task: "Start API Server (Port 4001)"
- Task: "Start TG Mini (Port 3002)"

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. API —Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 4001)

```bash
curl http://localhost:4001/health
# ‚úÖ {"status":"OK","port":"4001"}
```

### 2. Mini-app (–ø–æ—Ä—Ç 3002)

```bash
lsof -i :3002 | grep LISTEN
# ‚úÖ node ... TCP *:3002 (LISTEN)
```

### 3. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

```
http://localhost:3002
```

### 4. Ngrok (–ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø)

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º, –∏–ª–∏ –≤—Ä—É—á–Ω—É—é:
ngrok http 3002 --domain=tressy-cotyledonoid-vergie.ngrok-free.dev
# üåç https://tressy-cotyledonoid-vergie.ngrok-free.dev
```

### 5. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ Telegram

- @heys_curator_bot
- –ù–∞–∂–º–∏—Ç–µ –∏–∫–æ–Ω–∫—É üêõ –¥–ª—è Debug Console

---

## üêõ Debug Console ‚Äî –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- ‚úÖ –í—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã (URL, –º–µ—Ç–æ–¥, —Å—Ç–∞—Ç—É—Å)
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è Telegram (initData, —Ç–æ–∫–µ–Ω)
- ‚úÖ –û—à–∏–±–∫–∏ (network errors, validation)
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

1. –û—Ç–∫—Ä–æ–π mini-app –≤ Telegram
2. –ù–∞–∂–º–∏ –∏–∫–æ–Ω–∫—É üêõ –≤–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞
3. –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
4. –ö–ª–∏–∫ –Ω–∞ –ª–æ–≥ ‚Üí –ø–æ–ª–Ω—ã–µ –¥–µ—Ç–∞–ª–∏

### –¢–∏–ø—ã –ª–æ–≥–æ–≤:

- üîµ **INFO** ‚Äî –æ–±—ã—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- ‚úÖ **SUCCESS** ‚Äî —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚ö†Ô∏è **WARN** ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- ‚ùå **ERROR** ‚Äî –æ—à–∏–±–∫–∏

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- [x] API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (–ø–æ—Ä—Ç 4001)
- [x] Mini-app –∑–∞–ø—É—â–µ–Ω (–ø–æ—Ä—Ç 3002)
- [x] Health endpoint –æ—Ç–≤–µ—á–∞–µ—Ç
- [x] Vite proxy –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [x] Debug Console –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞
- [x] HTTP –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞

### üîÑ –ß—Ç–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

- [ ] –û—Ç–∫—Ä—ã—Ç—å –≤ Telegram @heys_curator_bot
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ initData
- [ ] –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ Debug Console
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:

1. **TELEGRAM_AUTHORIZATION_DEBUG.md** ‚Äî –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –ø—Ä–æ–±–ª–µ–º—ã
2. **DEBUG_CONSOLE_GUIDE.md** ‚Äî —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∫–æ–Ω—Å–æ–ª–∏
3. **start-tg-mini-debug.sh** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫
4. **–†–ï–®–ï–ù–ò–ï.md** (—ç—Ç–æ—Ç —Ñ–∞–π–ª) ‚Äî –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

- `package.json` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω `dev:api`
- `start-tg-mini-debug.sh` ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∑–∞–ø—É—Å–∫
- `apps/tg-mini/src/utils/debugLogger.ts` ‚Äî –Ω–æ–≤—ã–π
- `apps/tg-mini/src/components/DebugPanel.tsx` ‚Äî –Ω–æ–≤—ã–π
- `apps/tg-mini/src/api/httpClient.ts` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `apps/tg-mini/src/App.tsx` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω DebugPanel

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –≤ Telegram:**

   ```bash
   # –£–±–µ–¥–∏—Å—å —á—Ç–æ –æ–±–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞–ø—É—â–µ–Ω—ã
   lsof -i :4001 && lsof -i :3002

   # –û—Ç–∫—Ä–æ–π @heys_curator_bot
   # –ù–∞–∂–º–∏ –∏–∫–æ–Ω–∫—É üêõ
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –≤ Debug Console:**
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–æ–≥ "HTTP Request"
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–æ–≥ "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞"
   - –ò–ª–∏ –ª–æ–≥ —Å –æ—à–∏–±–∫–æ–π –∏ –¥–µ—Ç–∞–ª—è–º–∏

3. **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è:**
   - –°–º–æ—Ç—Ä–∏ –¥–µ—Ç–∞–ª–∏ –≤ Debug Console
   - –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ API: `logs/api-server.log`
   - –ü—Ä–æ–≤–µ—Ä—å Vite proxy –≤ Network tab

---

## üõ†Ô∏è Troubleshooting

### API —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –£–±–µ–π –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 4001
kill -9 $(lsof -ti :4001)

# –ó–∞–ø—É—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ
pnpm run dev:api
```

### Mini-app –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ API

```bash
# –ü—Ä–æ–≤–µ—Ä—å Vite proxy –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
cat apps/tg-mini/vite.config.ts | grep proxy -A 10

# –ü—Ä–æ–≤–µ—Ä—å VITE_API_URL
cat apps/tg-mini/.env.telegram
```

### Debug Console –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã
ls -la apps/tg-mini/src/utils/debugLogger.ts
ls -la apps/tg-mini/src/components/DebugPanel.tsx

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ mini-app
pnpm --filter @heys/tg-mini run dev
```

---

## ‚úÖ –†–µ–∑—é–º–µ

**–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!** ‚ú®

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- ‚úÖ **Service Worker** –æ—Ç–∫–ª—é—á–µ–Ω –≤ dev (—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ production —á–µ—Ä–µ–∑
  ngrok)
- ‚úÖ **–ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **Telegram Desktop** –±–µ–∑ initData ‚Üí –º–æ–∫–∏ –≤–º–µ—Å—Ç–æ 401 –æ—à–∏–±–æ–∫
- ‚úÖ **–ú–æ–±–∏–ª—å–Ω—ã–π Telegram** ‚Üí –ø–æ–ª–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑
  `/api/telegram/auth/verify`
- ‚úÖ **CORS** –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è ngrok domain
- ‚úÖ **Debug Console** —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- ‚úÖ **–¢–æ–∫–µ–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** —É–±—Ä–∞–Ω—ã –∏–∑ –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã:

1. **Production (—á–µ—Ä–µ–∑ Telegram)**: Service Worker –∞–∫—Ç–∏–≤–µ–Ω, –∫—ç—à –æ—Ç–∫–ª—é—á–µ–Ω,
   —Ä–µ–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
2. **Dev (–±—Ä–∞—É–∑–µ—Ä)**: SW –≤—ã–∫–ª—é—á–µ–Ω, HMR —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
3. **Telegram Desktop**: –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ ‚Üí –º–æ–∫–∏

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ! üöÄ**
