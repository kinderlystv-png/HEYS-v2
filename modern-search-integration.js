/*
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üó∫Ô∏è –ù–ê–í–ò–ì–ê–¶–ò–û–ù–ù–ê–Ø –ö–ê–†–¢–ê –§–ê–ô–õ–ê modern-search-integration.js (347 —Å—Ç—Ä–æ–∫)                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üìã –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–ê:                                                                       ‚îÇ
‚îÇ                                                                                           ‚îÇ
‚îÇ üöÄ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø (—Å—Ç—Ä–æ–∫–∏ 1-30):                                                          ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –û–±—ä–µ–∫—Ç modernSearchIntegration (5-10)                                            ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –§—É–Ω–∫—Ü–∏—è initializeModernSearch() (13-30)                                         ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (15-20)                                                    ‚îÇ
‚îÇ                                                                                           ‚îÇ
‚îÇ üîç –£–ú–ù–´–ô –ü–û–ò–°–ö (—Å—Ç—Ä–æ–∫–∏ 31-120):                                                          ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ SmartSearchEngine –∫–ª–∞—Å—Å (31-60)                                                  ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–∏—Å–∫–∞ —Å –æ–ø–µ—á–∞—Ç–∫–∞–º–∏ (61-90)                                            ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (91-120)                                                     ‚îÇ
‚îÇ                                                                                           ‚îÇ
‚îÇ üóÑÔ∏è –ö–ï–®–ò–†–û–í–ê–ù–ò–ï (—Å—Ç—Ä–æ–∫–∏ 121-200):                                                        ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ CacheManager –∫–ª–∞—Å—Å (121-150)                                                     ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (151-180)                                                  ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ (181-200)                                                       ‚îÇ
‚îÇ                                                                                           ‚îÇ
‚îÇ ‚ö° WEB WORKERS (—Å—Ç—Ä–æ–∫–∏ 201-280):                                                          ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ WorkerManager –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (201-230)                                               ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ (231-260)                                          ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (261-280)                                         ‚îÇ
‚îÇ                                                                                           ‚îÇ
‚îÇ üîß API –ò –°–û–ë–´–¢–ò–Ø (—Å—Ç—Ä–æ–∫–∏ 281-347):                                                       ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ –ü—É–±–ª–∏—á–Ω—ã–π API (281-310)                                                          ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ Event listeners (311-330)                                                        ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ –ê–≤—Ç–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (331-347)                                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
*/

// modern-search-integration.js - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ HEYS
(function () {
  'use strict';

  // –°—Ä–∞–∑—É —Å–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤
  window.modernSearchIntegration = {
    loaded: false,
    version: '1.0',
    features: ['smart_search', 'cache_invalidation', 'worker_integration'],
    error: null,
  };

  // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  function initializeModernSearch() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
    if (!window.HEYS || !window.HEYS.integration) {
      console.warn('[ModernSearch] Integration Layer –Ω–µ –Ω–∞–π–¥–µ–Ω, –æ–∂–∏–¥–∞–µ–º...');
      window.modernSearchIntegration.error = 'Integration Layer –Ω–µ –Ω–∞–π–¥–µ–Ω';
      return false;
    }

    console.log('[ModernSearch] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞...');

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
    const originalSearchProducts = window.HEYS.searchProducts;
    const originalAddProduct = window.HEYS.addProduct;
    // –°–æ–∑–¥–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    window.HEYS.ModernSearch = {
      loaded: true,
      version: '1.0',
      features: ['smart_search', 'cache_invalidation', 'worker_integration'],
      smartSearch: async function (query, options = {}) {
        if (window.HEYS.integration?.smartSearch) {
          return await window.HEYS.integration.smartSearch(query, options);
        }
        // Fallback –∫ –æ–±—ã—á–Ω–æ–º—É –ø–æ–∏—Å–∫—É
        return await window.HEYS.searchProducts(query, options);
      },
      clearCache: function () {
        if (window.HEYS.integration?.clearSearchCache) {
          return window.HEYS.integration.clearSearchCache();
        }
        console.log('[ModernSearch] Cache cleared (fallback)');
        return true;
      },
    };

    // === –°–û–í–†–ï–ú–ï–ù–ù–´–ô –ü–û–ò–°–ö ===

    window.HEYS.searchProducts = async function (query, options = {}) {
      const startTime = performance.now();

      console.log('[ModernSearch] –ü–æ–∏—Å–∫:', query);

      try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–π –ø–æ–∏—Å–∫ –∏–∑ Integration Layer
        const result = await HEYS.integration.smartSearch(query, {
          limit: options.limit || 20,
          useCache: true,
          useWorker: true,
        });

        const duration = performance.now() - startTime;

        // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        if (HEYS.analytics) {
          HEYS.analytics.trackComponentRender('search_products', duration);
        }

        console.log(
          `[ModernSearch] –†–µ–∑—É–ª—å—Ç–∞—Ç: ${result.results.length} –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∑–∞ ${duration.toFixed(1)}ms –∏–∑ ${result.source}`,
        );

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∏—Å—Ç–æ—á–Ω–∏–∫–µ
        if (result.source === 'cache') {
          showSearchNotification('‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –∏–∑ –∫–µ—à–∞', 'success');
        } else if (result.source === 'worker') {
          showSearchNotification('üöÄ –ü–æ–∏—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ', 'info');
        }

        return result.results;
      } catch (error) {
        console.warn('[ModernSearch] –û—à–∏–±–∫–∞ —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, fallback –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É:', error);

        // Fallback –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É –º–µ—Ç–æ–¥—É
        if (originalSearchProducts) {
          return originalSearchProducts(query, options);
        }

        return [];
      }
    };

    // === –°–û–í–†–ï–ú–ï–ù–ù–û–ï –î–û–ë–ê–í–õ–ï–ù–ò–ï –ü–†–û–î–£–ö–¢–û–í ===

    window.HEYS.addProduct = async function (productData) {
      console.log('[ModernSearch] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞:', productData.name);

      try {
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ IndexedDB
        if (HEYS.indexedDB) {
          await HEYS.indexedDB.saveProducts([productData]);
          console.log('[ModernSearch] –ü—Ä–æ–¥—É–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ IndexedDB');
        }

        // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ (localStorage, Supabase)
        if (originalAddProduct) {
          const result = await originalAddProduct(productData);

          // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫–µ—à –ø–æ–∏—Å–∫–∞
          if (HEYS.indexedDB) {
            // –û—á–∏—â–∞–µ–º –∫–µ—à –ø–æ–∏—Å–∫–∞ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞
            await invalidateSearchCache(productData.name);
          }

          return result;
        }

        return productData;
      } catch (error) {
        console.error('[ModernSearch] –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞:', error);
        throw error;
      }
    };

    // === –°–û–í–†–ï–ú–ï–ù–ù–û–ï –°–û–•–†–ê–ù–ï–ù–ò–ï –î–ù–Ø ===

    const originalSaveDay = window.HEYS.saveDay;

    window.HEYS.saveDay = async function (dayData) {
      console.log('[ModernSearch] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–Ω—è:', dayData.date);

      try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        const result = await HEYS.integration.saveDay(dayData, {
          syncImmediately: navigator.onLine,
          updateCache: true,
        });

        // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
        if (originalSaveDay) {
          await originalSaveDay(dayData);
        }

        showSearchNotification(`üìÖ –î–µ–Ω—å ${dayData.date} —Å–æ—Ö—Ä–∞–Ω–µ–Ω`, 'success');

        return result;
      } catch (error) {
        console.error('[ModernSearch] –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–Ω—è:', error);

        // Fallback
        if (originalSaveDay) {
          return originalSaveDay(dayData);
        }

        throw error;
      }
    };

    // === –°–û–í–†–ï–ú–ï–ù–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê ===

    window.HEYS.generateModernAnalytics = async function (dateRange, options = {}) {
      console.log('[ModernSearch] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:', dateRange);

      try {
        const analytics = await HEYS.integration.generateAnalytics(dateRange, {
          useWorker: true,
          useCache: true,
          includeCharts: true,
          includeTrends: true,
          ...options,
        });

        console.log('[ModernSearch] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥–æ—Ç–æ–≤–∞:', analytics);
        return analytics;
      } catch (error) {
        console.error('[ModernSearch] –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:', error);
        throw error;
      }
    };

    // === –£–¢–ò–õ–ò–¢–´ ===

    async function invalidateSearchCache(productName) {
      try {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–µ—à–∞
        console.log('[ModernSearch] –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –¥–ª—è:', productName);
      } catch (error) {
        console.warn('[ModernSearch] –û—à–∏–±–∫–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–µ—à–∞:', error);
      }
    }

    function showSearchNotification(message, type = 'info') {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ñ—É–Ω–∫—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
      if (window.showNotification) {
        window.showNotification(message, type);
      } else {
        // Fallback - –ø—Ä–æ—Å—Ç–æ–π console.log
        console.log(`[Notification ${type.toUpperCase()}] ${message}`);
      }
    }

    // === –ú–û–ù–ò–¢–û–†–ò–ù–ì –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò ===

    let searchStats = {
      totalSearches: 0,
      cacheHits: 0,
      workerSearches: 0,
      avgDuration: 0,
      lastSearch: null,
    };

    // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –ø–æ–∏—Å–∫–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    HEYS.integration.on('smart_search_complete', (event) => {
      const { query, source, duration, results } = event.detail;

      searchStats.totalSearches++;
      searchStats.avgDuration =
        (searchStats.avgDuration * (searchStats.totalSearches - 1) + duration) /
        searchStats.totalSearches;
      searchStats.lastSearch = { query, source, duration, resultsCount: results.length };

      if (source === 'cache') {
        searchStats.cacheHits++;
      } else if (source === 'worker') {
        searchStats.workerSearches++;
      }
    });

    // –ü—É–±–ª–∏—á–Ω—ã–π API –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    window.HEYS.getSearchStats = function () {
      return {
        ...searchStats,
        cacheHitRate:
          searchStats.totalSearches > 0
            ? ((searchStats.cacheHits / searchStats.totalSearches) * 100).toFixed(1) + '%'
            : '0%',
        workerUsageRate:
          searchStats.totalSearches > 0
            ? ((searchStats.workerSearches / searchStats.totalSearches) * 100).toFixed(1) + '%'
            : '0%',
      };
    };

    // === –ê–í–¢–û–ó–ê–ü–û–õ–ù–ï–ù–ò–ï –ü–†–û–î–£–ö–¢–û–í ===

    window.HEYS.preloadPopularProducts = async function () {
      const popularProducts = [
        {
          id: 1001,
          name: '–•–ª–µ–± –±–µ–ª—ã–π',
          kcal100: 250,
          proteins100: 8,
          fats100: 1,
          carbs100: 50,
          category: '–•–ª–µ–±–æ–±—É–ª–æ—á–Ω—ã–µ',
        },
        {
          id: 1002,
          name: '–ú–æ–ª–æ–∫–æ 2.5%',
          kcal100: 60,
          proteins100: 3,
          fats100: 2.5,
          carbs100: 5,
          category: '–ú–æ–ª–æ—á–Ω—ã–µ',
        },
        {
          id: 1003,
          name: '–ö—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞',
          kcal100: 165,
          proteins100: 31,
          fats100: 3.6,
          carbs100: 0,
          category: '–ú—è—Å–æ',
        },
        {
          id: 1004,
          name: '–†–∏—Å –æ—Ç–≤–∞—Ä–Ω–æ–π',
          kcal100: 130,
          proteins100: 2.7,
          fats100: 0.3,
          carbs100: 28,
          category: '–ö—Ä—É–ø—ã',
        },
        {
          id: 1005,
          name: '–Ø–±–ª–æ–∫–æ',
          kcal100: 52,
          proteins100: 0.3,
          fats100: 0.4,
          carbs100: 14,
          category: '–§—Ä—É–∫—Ç—ã',
        },
        {
          id: 1006,
          name: '–ë–∞–Ω–∞–Ω',
          kcal100: 89,
          proteins100: 1.1,
          fats100: 0.3,
          carbs100: 23,
          category: '–§—Ä—É–∫—Ç—ã',
        },
        {
          id: 1007,
          name: '–¢–≤–æ—Ä–æ–≥ 5%',
          kcal100: 121,
          proteins100: 17,
          fats100: 5,
          carbs100: 1.8,
          category: '–ú–æ–ª–æ—á–Ω—ã–µ',
        },
        {
          id: 1008,
          name: '–ì—Ä–µ—á–∫–∞ –æ—Ç–≤–∞—Ä–Ω–∞—è',
          kcal100: 92,
          proteins100: 3.4,
          fats100: 0.6,
          carbs100: 18,
          category: '–ö—Ä—É–ø—ã',
        },
        {
          id: 1009,
          name: '–Ø–π—Ü–æ –∫—É—Ä–∏–Ω–æ–µ',
          kcal100: 157,
          proteins100: 12.7,
          fats100: 11.5,
          carbs100: 0.7,
          category: '–Ø–π—Ü–∞',
        },
        {
          id: 1010,
          name: '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –æ—Ç–≤–∞—Ä–Ω–æ–π',
          kcal100: 77,
          proteins100: 2,
          fats100: 0.4,
          carbs100: 16,
          category: '–û–≤–æ—â–∏',
        },
      ];

      try {
        if (HEYS.indexedDB) {
          await HEYS.indexedDB.saveProducts(popularProducts);
          console.log(
            '[ModernSearch] –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–æ',
            popularProducts.length,
            '–ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤',
          );
          showSearchNotification(
            `üì¶ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${popularProducts.length} –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤`,
            'success',
          );
        }
      } catch (error) {
        console.error('[ModernSearch] –û—à–∏–±–∫–∞ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏:', error);
      }
    };

    // === OFFLINE –ò–ù–î–ò–ö–ê–¢–û–† ===

    function updateOfflineStatus() {
      const isOnline = navigator.onLine;
      const indicator = document.getElementById('offline-indicator');

      if (!indicator) {
        // –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
        const div = document.createElement('div');
        div.id = 'offline-indicator';
        div.style.cssText = `
        position: fixed;
        top: 10px;
        right: 10px;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: bold;
        z-index: 10000;
        transition: all 0.3s ease;
        display: none;
      `;
        document.body.appendChild(div);
      }

      const indicatorElement = document.getElementById('offline-indicator');

      if (!isOnline) {
        indicatorElement.textContent = 'üì± –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º';
        indicatorElement.style.backgroundColor = '#fed7d7';
        indicatorElement.style.color = '#9b2c2c';
        indicatorElement.style.display = 'block';
      } else {
        indicatorElement.style.display = 'none';
      }
    }

    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Ç–∏
    window.addEventListener('online', updateOfflineStatus);
    window.addEventListener('offline', updateOfflineStatus);

    // –ù–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    updateOfflineStatus();

    // === –ê–í–¢–û–ó–ê–ü–£–°–ö ===

    // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    HEYS.integration.on('integration_ready', () => {
      setTimeout(() => {
        HEYS.preloadPopularProducts();
      }, 1000);
    });

    // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π
    window.modernSearchIntegration.loaded = true;
    window.modernSearchIntegration.error = null;

    // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤ HEYS namespace –¥–ª—è —Ç–µ—Å—Ç–æ–≤
    if (window.HEYS) {
      window.HEYS.ModernSearch = window.modernSearchIntegration;
      console.log('‚úÖ Modern Search Integration –¥–æ–±–∞–≤–ª–µ–Ω –≤ HEYS namespace');
    }

    console.log('[HEYS] Modern Search Integration –∑–∞–≥—Ä—É–∂–µ–Ω');
    return true;
  }

  // –ü—ã—Ç–∞–µ–º—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É
  if (!initializeModernSearch()) {
    // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
    const retryInterval = setInterval(() => {
      if (initializeModernSearch()) {
        clearInterval(retryInterval);
      }
    }, 100);

    // –ú–∞–∫—Å–∏–º—É–º 5 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è
    setTimeout(() => {
      clearInterval(retryInterval);
      if (!window.modernSearchIntegration.loaded) {
        console.error('[ModernSearch] –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞ 5 —Å–µ–∫—É–Ω–¥');
        window.modernSearchIntegration.error = 'Timeout waiting for dependencies';
      }
    }, 5000);
  }
})();
