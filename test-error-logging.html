<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Enhanced Error Logging</title>
  </head>
  <body>
    <h1>üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Enhanced Error Logging</h1>

    <div>
      <button onclick="testError()">üî• –°–æ–∑–¥–∞—Ç—å –æ—à–∏–±–∫—É</button>
      <button onclick="testWarning()">‚ö†Ô∏è –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</button>
      <button onclick="testInfo()">‚ÑπÔ∏è –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
      <button onclick="showStats()">üìä –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
      <button onclick="exportLogs()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤</button>
      <button onclick="clearLogs()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
    </div>

    <div
      id="output"
      style="margin-top: 20px; padding: 10px; background: #f0f0f0; font-family: monospace"
    ></div>

    <!-- Enhanced Error Logging System -->
    <script src="TOOLS/enhanced-error-logger.js"></script>
    <script src="TOOLS/stack-trace-analyzer.js"></script>
    <script src="TOOLS/error-classification-engine.js"></script>
    <script src="TOOLS/real-time-error-dashboard.js"></script>
    <script src="TOOLS/enhanced-error-logging-tests.js"></script>

    <script>
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
      let logger;

      function initLogger() {
        logger = new EnhancedErrorLogger({
          logLevels: ['error', 'warning', 'info', 'debug'],
          autoClassify: true,
          detailedStackTrace: true,
          performanceTracking: true,
          realTimeUpdates: true,
        });

        log('‚úÖ Enhanced Error Logger –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        log(`üìç Session ID: ${logger.sessionId}`);
      }

      function testError() {
        console.error('–¢–µ—Å—Ç–æ–≤–∞—è –æ—à–∏–±–∫–∞ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏');

        // –¢–∞–∫–∂–µ —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º–Ω—É—é –æ—à–∏–±–∫—É
        try {
          throw new Error('–ü—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –æ—à–∏–±–∫–∞');
        } catch (e) {
          logger.logError('Test Error', {
            message: e.message,
            source: 'manual_test',
            stackTrace: e.stack,
          });
        }

        log('üî• –û—à–∏–±–∫–∏ —Å–æ–∑–¥–∞–Ω—ã');
      }

      function testWarning() {
        console.warn('–¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏');

        logger.logWarning('Test Warning', {
          message: '–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ',
          source: 'manual_test',
        });

        log('‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã');
      }

      function testInfo() {
        logger.logInfo('Test Info', {
          message: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
          source: 'manual_test',
        });

        log('‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ');
      }

      function showStats() {
        const stats = logger.getStats();
        log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:');
        log(`   –í—Å–µ–≥–æ: ${stats.total}`);
        log(`   –û—à–∏–±–∫–∏: ${stats.byLevel.error || 0}`);
        log(`   –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: ${stats.byLevel.warning || 0}`);
        log(`   –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: ${stats.byLevel.info || 0}`);
        log(`   –û—Ç–ª–∞–¥–∫–∞: ${stats.byLevel.debug || 0}`);
        log(`   –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏: ${Math.round(stats.sessionDuration / 1000)}s`);
      }

      function exportLogs() {
        const exportData = logger.exportLogs('json');

        // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        const blob = new Blob([exportData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `error-report-${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);

        log('üì§ –õ–æ–≥–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª');
      }

      function clearLogs() {
        logger.clearLogs();
        log('üßπ –õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã');
      }

      function log(message) {
        const output = document.getElementById('output');
        const time = new Date().toLocaleTimeString();
        output.innerHTML += `[${time}] ${message}<br>`;
        output.scrollTop = output.scrollHeight;
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      window.addEventListener('load', () => {
        initLogger();

        // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è –æ—Ç Enhanced Error Logger
        window.addEventListener('enhancedLogEntry', event => {
          const logEntry = event.detail;
          log(`üì• –ù–æ–≤—ã–π –ª–æ–≥: [${logEntry.level.toUpperCase()}] ${logEntry.title}`);
        });
      });

      // –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      window.addEventListener('load', () => {
        setTimeout(() => {
          log('üöÄ –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è...');
          testInfo();
          setTimeout(() => testWarning(), 1000);
          setTimeout(() => testError(), 2000);
        }, 1000);
      });
    </script>
  </body>
</html>
